(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},9575:function(e,t,n){var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(0,t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0!==(s="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=s)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},5378:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++)n=arguments[r]??{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))});return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){var e;return null!==(e=h)&&void 0!==e?e:document}var l={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},c=n({},l),u={},h=null,d=function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0},p=function(){function e(t){var n=this;r(this,e),this.element=a().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),s=["notification",this.extraClasses];if(this.type&&s.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),l=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";s.push("animate__animated ".concat(o," ").concat(l)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=s.join(" "),this.dismissible){var c=a().createElement("button");c.className="delete",c.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",c)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var u=new f(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){u.pause()}),this.element.addEventListener("mouseout",function(){u.resume()}))}return s(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete u.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete u.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),f=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return s(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){c=n({},l)},e.setDefaults=function(e){c=n(n({},l),e)},e.setDoc=function(e){for(var t in u)u[t].remove();u={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},c),e),r=new p(t),i=function(e,t,n,r,i,s){if(u.position)return u.position;var o=a().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+d(t,n,r,i,s)),e.appendChild(o),u.position=o,o}(t.appendTo||a().body,t.position||c.position,t.offsetTop||c.offsetTop,t.offsetBottom||c.offsetBottom,t.offsetLeft||c.offsetLeft,t.offsetRight||c.offsetRight);if(t.single)for(var s=i.lastElementChild;s;)i.removeChild(s),s=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},6676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function r(e,t,r){var i,s=new Promise(function(s,o){n(i=e[t].apply(e,r)).then(s,o)});return s.request=i,s}function i(e,t,n){var i=r(e,t,n);return i.then(function(e){if(e)return new u(e,i.request)})}function s(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,t,n,i){i.forEach(function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})})}function a(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function l(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})})}function c(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function h(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function f(e){this._db=e}s(c,"_index",["name","keyPath","multiEntry","unique"]),o(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),l(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(u,"_cursor",["direction","key","primaryKey","value"]),o(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),h.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},s(h,"_store",["name","keyPath","indexNames","autoIncrement"]),o(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),l(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(h,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[h,c].forEach(function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,s=i[e].apply(i,n.slice(0,-1));s.onsuccess=function(){r(s.result)}})})}),[c,h].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(i){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)})})})}),e.openDb=function(e,t,n){var i=r(indexedDB,"open",[e,t]),s=i.request;return s&&(s.onupgradeneeded=function(e){n&&n(new p(s.result,e.oldVersion,s.transaction))}),i.then(function(e){return new f(e)})},e.deleteDb=function(e){return r(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})}(t)},4009:function(e,t,n){"use strict";function r(e){return"function"==typeof e}function i(e){const t=e(e=>{Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const s=i(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function o(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class a{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const e of i)e.remove(this);else i.remove(this);const{initialTeardown:o}=this;if(r(o))try{o()}catch(t){e=t instanceof s?t.errors:[t]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const t of a)try{u(t)}catch(n){e=e??[],n instanceof s?e=[...e,...n.errors]:e.push(n)}}if(e)throw new s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)u(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&o(t,e)}remove(e){const{_teardowns:t}=this;t&&o(t,e),e instanceof a&&e._removeParent(this)}}a.EMPTY=(()=>{const e=new a;return e.closed=!0,e})();const l=a.EMPTY;function c(e){return e instanceof a||e&&"closed"in e&&r(e.remove)&&r(e.add)&&r(e.unsubscribe)}function u(e){r(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function p(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function f(){}const g=m("C",void 0,void 0);function m(e,t,n){return{kind:e,value:t,error:n}}let y=null;function v(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!y;if(t&&(y={errorThrown:!1,error:null}),e(),t){const{errorThrown:e,error:t}=y;if(y=null,e)throw t}}else e()}class _ extends a{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,c(e)&&e.add(this)):this.destination=b}static create(e,t,n){return new C(e,t,n)}next(e){this.isStopped?S(m("N",e,void 0),this):this._next(e)}error(e){this.isStopped?S(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?S(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class C extends _{constructor(e,t,n){let i;if(super(),r(e))i=e;else if(e){let r;({next:i,error:t,complete:n}=e),this&&h.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe()):r=e,i=null==i?void 0:i.bind(r),t=null==t?void 0:t.bind(r),n=null==n?void 0:n.bind(r)}this.destination={next:i?E(i):f,error:E(t??w),complete:n?E(n):f}}}function E(e,t){return(...t)=>{try{e(...t)}catch(n){h.useDeprecatedSynchronousErrorHandling?function(e){h.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):p(n)}}}function w(e){throw e}function S(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const b={closed:!0,next:f,error:w,complete:f},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(e){return e}let T=(()=>{class e{constructor(e){e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const i=function(e){return e&&e instanceof _||function(e){return e&&r(e.next)&&r(e.error)&&r(e.complete)}(e)&&c(e)}(e)?e:new C(e,t,n);return v(()=>{const{operator:e,source:t}=this;i.add(e?e.call(i,t):t?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return new(t=I(t))((t,n)=>{const r=new C({next:t=>{try{e(t)}catch(i){n(i),r.unsubscribe()}},error:n,complete:t});this.subscribe(r)})}_subscribe(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}[P](){return this}pipe(...e){return function(e){return 0===e.length?O:1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}}(e)(this)}toPromise(e){return new(e=I(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function I(e){var t;return null!==(t=e??h.Promise)&&void 0!==t?t:Promise}const k=i(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let A=(()=>{class e extends T{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const t=new M(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new k}next(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){const t=this.observers.slice();for(const n of t)n.next(e)}})}error(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:t,isStopped:n,observers:r}=this;return t||n?l:(r.push(e),new a(()=>o(r,e)))}_checkFinalizedStatuses(e){const{hasError:t,thrownError:n,isStopped:r}=this;t?e.error(n):r&&e.complete()}asObservable(){const e=new T;return e.source=this,e}}return e.create=(e,t)=>new M(e,t),e})();class M extends A{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:l}}function N(e){return r(null==e?void 0:e.lift)}function x(e){return t=>{if(N(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class R extends _{constructor(e,t,n,r,i){super(e),this.onFinalize=i,this._next=t?function(n){try{t(n)}catch(r){e.error(r)}}:super._next,this._error=r?function(t){try{r(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function D(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>{r.next(e.call(t,n,i++))}))})}function L(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function U(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(l,c):u(s[0][2],e)}(i[e](t))}catch(n){u(s[0][3],n)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function B(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}const V=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $(e){return r(null==e?void 0:e.then)}function z(e){return r(e[P])}function H(e){return Symbol.asyncIterator&&r(null==e?void 0:e[Symbol.asyncIterator])}function G(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const q="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function W(e){return r(null==e?void 0:e[q])}function j(e){return U(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:e,done:n}=yield F(t.read());if(n)return yield F(void 0);yield yield F(e)}}finally{t.releaseLock()}})}function Z(e){return r(null==e?void 0:e.getReader)}function Y(e){if(e instanceof T)return e;if(null!=e){if(z(e))return function(e){return new T(t=>{const n=e[P]();if(r(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(V(e))return function(e){return new T(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($(e))return function(e){return new T(t=>{e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,p)})}(e);if(H(e))return K(e);if(W(e))return function(e){return new T(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Z(e))return function(e){return K(j(e))}(e)}throw G(e)}function K(e){return new T(t=>{(function(e,t){var n,r,i,s;return function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=B(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(e=>t.error(e))})}function J(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Q(e,t,n=1/0){return r(t)?Q((n,r)=>D((e,i)=>t(n,e,r,i))(Y(e(n,r))),n):("number"==typeof t&&(n=t),x((t,r)=>function(e,t,n,r,i,s,o,a){const l=[];let c=0,u=0,h=!1;const d=()=>{h&&!l.length&&!c&&t.complete()},p=e=>c<r?f(e):l.push(e),f=e=>{c++;let i=!1;Y(n(e,u++)).subscribe(new R(t,e=>{t.next(e)},()=>{i=!0},void 0,()=>{if(i)try{for(c--;l.length&&c<r;){const e=l.shift();f(e)}d()}catch(e){t.error(e)}}))};return e.subscribe(new R(t,p,()=>{h=!0,d()})),()=>{}}(t,r,e,n)))}function X(e=1/0){return Q(O,e)}const ee=new T(e=>e.complete());function te(e){return e[e.length-1]}function ne(e){return r(te(e))?e.pop():void 0}function re(e){return function(e){return e&&r(e.schedule)}(te(e))?e.pop():void 0}function ie(e,t=0){return x((n,r)=>{n.subscribe(new R(r,n=>J(r,e,()=>r.next(n),t),()=>J(r,e,()=>r.complete(),t),n=>J(r,e,()=>r.error(n),t)))})}function se(e,t=0){return x((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(n=>{J(n,t,()=>{const r=e[Symbol.asyncIterator]();J(n,t,()=>{r.next().then(e=>{e.done?n.complete():n.next(e.value)})},0,!0)})})}function ae(e,t){return t?function(e,t){if(null!=e){if(z(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(V(e))return function(e,t){return new T(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if($(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(H(e))return oe(e,t);if(W(e))return function(e,t){return new T(n=>{let i;return J(n,t,()=>{i=e[q](),J(n,t,()=>{let e,t;try{({value:e,done:t}=i.next())}catch(r){return void n.error(r)}t?n.complete():n.next(e)},0,!0)}),()=>r(null==i?void 0:i.return)&&i.return()})}(e,t);if(Z(e))return function(e,t){return oe(j(e),t)}(e,t)}throw G(e)}(e,t):Y(e)}function le(e){return e<=0?()=>ee:x((t,n)=>{let r=0;t.subscribe(new R(n,t=>{++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function ce(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(le(1)).subscribe(()=>e())}function ue(e){for(let t in e)if(e[t]===ue)return t;throw Error("Could not find renamed property on target object.")}function he(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function de(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(de).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function pe(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const fe=ue({__forward_ref__:ue});function ge(e){return e.__forward_ref__=ge,e.toString=function(){return de(this())},e}function me(e){return ye(e)?e():e}function ye(e){return"function"==typeof e&&e.hasOwnProperty(fe)&&e.__forward_ref__===ge}class ve extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function _e(e){return"string"==typeof e?e:null==e?"":String(e)}function Ce(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_e(e)}function Ee(e,t){const n=t?` in ${t}`:"";throw new ve("201",`No provider for ${Ce(e)} found${n}`)}function we(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}function Se(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function be(e){return{providers:e.providers||[],imports:e.imports||[]}}function Pe(e){return Oe(e,Ie)||Oe(e,Ae)}function Oe(e,t){return e.hasOwnProperty(t)?e[t]:null}function Te(e){return e&&(e.hasOwnProperty(ke)||e.hasOwnProperty(Me))?e[ke]:null}const Ie=ue({"\u0275prov":ue}),ke=ue({"\u0275inj":ue}),Ae=ue({ngInjectableDef:ue}),Me=ue({ngInjectorDef:ue});var Ne=(()=>((Ne=Ne||{})[Ne.Default=0]="Default",Ne[Ne.Host=1]="Host",Ne[Ne.Self=2]="Self",Ne[Ne.SkipSelf=4]="SkipSelf",Ne[Ne.Optional=8]="Optional",Ne))();let xe;function Re(e){const t=xe;return xe=e,t}function De(e,t,n){const r=Pe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Ne.Optional?null:void 0!==t?t:void Ee(de(e),"Injector")}function Le(e){return{toString:e}.toString()}var Fe=(()=>((Fe=Fe||{})[Fe.OnPush=0]="OnPush",Fe[Fe.Default=1]="Default",Fe))(),Ue=(()=>((Ue=Ue||{})[Ue.Emulated=0]="Emulated",Ue[Ue.None=2]="None",Ue[Ue.ShadowDom=3]="ShadowDom",Ue))();const Be="undefined"!=typeof globalThis&&globalThis,Ve="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ze=Be||"undefined"!=typeof global&&global||Ve||$e,He={},Ge=[],qe=ue({"\u0275cmp":ue}),We=ue({"\u0275dir":ue}),je=ue({"\u0275pipe":ue}),Ze=ue({"\u0275mod":ue}),Ye=ue({"\u0275loc":ue}),Ke=ue({"\u0275fac":ue}),Je=ue({__NG_ELEMENT_ID__:ue});let Qe=0;function Xe(e){return Le(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Fe.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Ge,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Ue.Emulated,id:"c",styles:e.styles||Ge,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Qe++,n.inputs=it(e.inputs,t),n.outputs=it(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(et):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(tt):null,n})}function et(e){return at(e)||function(e){return e[We]||null}(e)}function tt(e){return function(e){return e[je]||null}(e)}const nt={};function rt(e){return Le(()=>{const t={type:e.type,bootstrap:e.bootstrap||Ge,declarations:e.declarations||Ge,imports:e.imports||Ge,exports:e.exports||Ge,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nt[e.id]=e.type),t})}function it(e,t){if(null==e)return He;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const st=Xe;function ot(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function at(e){return e[qe]||null}function lt(e,t){const n=e[Ze]||null;if(!n&&!0===t)throw new Error(`Type ${de(e)} does not have '\u0275mod' property.`);return n}function ct(e){return Array.isArray(e)&&"object"==typeof e[1]}function ut(e){return Array.isArray(e)&&!0===e[1]}function ht(e){return 0!=(8&e.flags)}function dt(e){return 2==(2&e.flags)}function pt(e){return 1==(1&e.flags)}function ft(e){return null!==e.template}function gt(e){return 0!=(512&e[2])}function mt(e,t){return e.hasOwnProperty(Ke)?e[Ke]:null}class yt{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function vt(){return _t}function _t(e){return e.type.prototype.ngOnChanges&&(e.setInput=Et),Ct}function Ct(){const e=St(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===He)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Et(e,t,n,r){const i=St(e)||function(e,t){return e[wt]=t}(e,{previous:He,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],l=o[a];s[a]=new yt(l&&l.currentValue,t,o===He),e[r]=t}vt.ngInherit=!0;const wt="__ngSimpleChanges__";function St(e){return e[wt]||null}const bt="http://www.w3.org/2000/svg";let Pt;function Ot(){return void 0!==Pt?Pt:"undefined"!=typeof document?document:void 0}function Tt(e){return!!e.listen}const It={createRenderer:(e,t)=>Ot()};function kt(e){for(;Array.isArray(e);)e=e[0];return e}function At(e,t){return kt(t[e])}function Mt(e,t){return kt(t[e.index])}function Nt(e,t){return e.data[t]}function xt(e,t){return e[t]}function Rt(e,t){const n=t[e];return ct(n)?n:n[0]}function Dt(e){return 4==(4&e[2])}function Lt(e){return 128==(128&e[2])}function Ft(e,t){return null==t?null:e[t]}function Ut(e){e[18]=0}function Bt(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Vt={lFrame:pn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function $t(){return Vt.bindingsEnabled}function zt(){return Vt.lFrame.lView}function Ht(){return Vt.lFrame.tView}function Gt(e){return Vt.lFrame.contextLView=e,e[8]}function qt(){let e=Wt();for(;null!==e&&64===e.type;)e=e.parent;return e}function Wt(){return Vt.lFrame.currentTNode}function jt(){const e=Vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Zt(e,t){const n=Vt.lFrame;n.currentTNode=e,n.isParent=t}function Yt(){return Vt.lFrame.isParent}function Kt(){Vt.lFrame.isParent=!1}function Jt(){return Vt.isInCheckNoChangesMode}function Qt(e){Vt.isInCheckNoChangesMode=e}function Xt(){const e=Vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function en(){return Vt.lFrame.bindingIndex}function tn(){return Vt.lFrame.bindingIndex++}function nn(e){const t=Vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function rn(e){Vt.lFrame.inI18n=e}function sn(e,t){const n=Vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,on(t)}function on(e){Vt.lFrame.currentDirectiveIndex=e}function an(){return Vt.lFrame.currentQueryIndex}function ln(e){Vt.lFrame.currentQueryIndex=e}function cn(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function un(e,t,n){if(n&Ne.SkipSelf){let r=t,i=e;for(;!(r=r.parent,null!==r||n&Ne.Host||(r=cn(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}const r=Vt.lFrame=dn();return r.currentTNode=t,r.lView=e,!0}function hn(e){const t=dn(),n=e[1];Vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function dn(){const e=Vt.lFrame,t=null===e?null:e.child;return null===t?pn(e):t}function pn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function fn(){const e=Vt.lFrame;return Vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gn=fn;function mn(){const e=fn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function yn(){return Vt.lFrame.selectedIndex}function vn(e){Vt.lFrame.selectedIndex=e}function _n(){const e=Vt.lFrame;return Nt(e.tView,e.selectedIndex)}function Cn(){Vt.lFrame.currentNamespace=bt}function En(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function wn(e,t,n){Pn(e,t,3,n)}function Sn(e,t,n,r){(3&e[2])===n&&Pn(e,t,n,r)}function bn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Pn(e,t,n,r){const i=r??-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(On(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function On(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}class Tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function In(e,t,n){const r=Tt(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],l=n[i++];r?e.setAttribute(t,a,l,o):t.setAttributeNS(o,a,l)}else{const o=s,a=n[++i];An(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function kn(e){return 3===e||4===e||6===e}function An(e){return 64===e.charCodeAt(0)}function Mn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Nn(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Nn(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function xn(e){return-1!==e}function Rn(e){return 32767&e}function Dn(e,t){let n=function(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ln=!0;function Fn(e){const t=Ln;return Ln=e,t}let Un=0;function Bn(e,t){const n=$n(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Vn(r.data,e),Vn(t,null),Vn(r.blueprint,null));const i=zn(e,t),s=e.injectorIndex;if(xn(i)){const e=Rn(i),n=Dn(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function Vn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $n(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function zn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hn(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Je)&&(r=n[Je]),null==r&&(r=n[Je]=Un++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Gn(e,t,n){if(n&Ne.Optional)return e;Ee(t,"NodeInjector")}function qn(e,t,n,r){if(n&Ne.Optional&&void 0===r&&(r=null),0==(n&(Ne.Self|Ne.Host))){const i=e[9],s=Re(void 0);try{return i?i.get(t,r,n&Ne.Optional):De(t,r,n&Ne.Optional)}finally{Re(s)}}return Gn(r,t,n)}function Wn(e,t,n,r=Ne.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Je)?e[Je]:void 0;return"number"==typeof t?t>=0?255&t:Zn:t}(n);if("function"==typeof s){if(!un(t,e,r))return r&Ne.Host?Gn(i,n,r):qn(t,n,r,i);try{const e=s(r);if(null!=e||r&Ne.Optional)return e;Ee(n)}finally{gn()}}else if("number"==typeof s){let i=null,o=$n(e,t),a=-1,l=r&Ne.Host?t[16][6]:null;for((-1===o||r&Ne.SkipSelf)&&(a=-1===o?zn(e,t):t[o+8],-1!==a&&Xn(r,!1)?(i=t[1],o=Rn(a),t=Dn(a,t)):o=-1);-1!==o;){const e=t[1];if(Qn(s,o,e.data)){const e=Yn(o,t,n,i,r,l);if(e!==jn)return e}a=t[o+8],-1!==a&&Xn(r,t[1].data[o+8]===l)&&Qn(s,o,t)?(i=e,o=Rn(a),t=Dn(a,t)):o=-1}}}return qn(t,n,r,i)}const jn={};function Zn(){return new er(qt(),zt())}function Yn(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],l=Kn(a,o,n,null==r?dt(a)&&Ln:r!=o&&0!=(3&a.type),i&Ne.Host&&s===a);return null!==l?Jn(t,o,l,a):jn}function Kn(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,l=e.directiveStart,c=s>>20,u=i?a+c:e.directiveEnd;for(let h=r?a:a+c;h<u;h++){const e=o[h];if(h<l&&n===e||h>=l&&e.type===n)return h}if(i){const e=o[l];if(e&&ft(e)&&e.type===n)return l}return null}function Jn(e,t,n,r){let i=e[n];const s=t.data;if(function(e){return e instanceof Tn}(i)){const o=i;o.resolving&&function(e,t){throw new ve("200",`Circular dependency in DI detected for ${e}`)}(Ce(s[n]));const a=Fn(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Re(o.injectImpl):null;un(e,r,Ne.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=_t(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==l&&Re(l),Fn(a),o.resolving=!1,gn()}}return i}function Qn(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Xn(e,t){return!(e&Ne.Self||e&Ne.Host&&t)}class er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Wn(this._tNode,this._lView,e,n,t)}}function tr(e){return Le(()=>{const t=e.prototype.constructor,n=t[Ke]||nr(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Ke]||nr(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function nr(e){return ye(e)?()=>{const t=nr(me(e));return t&&t()}:mt(e)}function rr(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(kn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(qt(),e)}const ir="__parameters__";function sr(e,t,n){return Le(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(ir)?e[ir]:Object.defineProperty(e,ir,{value:[]})[ir];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class or{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Se({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ar=new or("AnalyzeForEntryComponents"),lr=Function;function cr(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),cr(r,t)):t!==e&&t.push(r)}return t}function ur(e,t){e.forEach(e=>Array.isArray(e)?ur(e,t):t(e))}function hr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function pr(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function fr(e,t,n){let r=mr(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function gr(e,t){const n=mr(e,t);if(n>=0)return e[1|n]}function mr(e,t){return function(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const s=r+(i-r>>1),o=e[s<<n];if(t===o)return s<<n;o>t?i=s:r=s+1}return~(i<<n)}(e,t,1)}const yr={},vr="__NG_DI_FLAG__",_r="ngTempTokenPath",Cr=/\n/gm,Er="__source",wr=ue({provide:String,useValue:ue});let Sr;function br(e){const t=Sr;return Sr=e,t}function Pr(e,t=Ne.Default){if(void 0===Sr)throw new Error("inject() must be called from an injection context");return null===Sr?De(e,void 0,t):Sr.get(e,t&Ne.Optional?null:void 0,t)}function Or(e,t=Ne.Default){return(xe||Pr)(me(e),t)}function Tr(e){const t=[];for(let n=0;n<e.length;n++){const r=me(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=Ne.Default;for(let t=0;t<r.length;t++){const i=r[t],s=kr(i);"number"==typeof s?-1===s?e=i.token:n|=s:e=i}t.push(Or(e,n))}else t.push(Or(r))}return t}function Ir(e,t){return e[vr]=t,e.prototype[vr]=t,e}function kr(e){return e[vr]}function Ar(e,t,n,r){const i=e[_r];throw t[Er]&&i.unshift(t[Er]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=de(t);if(Array.isArray(t))i=t.map(de).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):de(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Cr,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[_r]=null,e}const Mr=Ir(sr("Inject",e=>({token:e})),-1),Nr=Ir(sr("Optional"),8),xr=Ir(sr("SkipSelf"),4);let Rr,Dr;function Lr(e){var t;return(null===(t=function(){if(void 0===Rr&&(Rr=null,ze.trustedTypes))try{Rr=ze.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Rr}())||void 0===t?void 0:t.createHTML(e))||e}function Fr(e){var t;return(null===(t=function(){if(void 0===Dr&&(Dr=null,ze.trustedTypes))try{Dr=ze.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dr}())||void 0===t?void 0:t.createHTML(e))||e}class Ur{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Br extends Ur{getTypeName(){return"HTML"}}class Vr extends Ur{getTypeName(){return"Style"}}class $r extends Ur{getTypeName(){return"Script"}}class zr extends Ur{getTypeName(){return"URL"}}class Hr extends Ur{getTypeName(){return"ResourceURL"}}function Gr(e){return e instanceof Ur?e.changingThisBreaksApplicationSecurity:e}function qr(e,t){const n=Wr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Wr(e){return e instanceof Ur&&e.getTypeName()||null}function jr(e){const t=new Yr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Lr(""),"text/html")}catch{return!1}}()?new Zr(t):t}class Zr{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Lr(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class Yr{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Lr(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=Lr(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kr=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Jr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qr(e){return(e=String(e)).match(Kr)||e.match(Jr)?e:"unsafe:"+e}function Xr(e){return(e=String(e)).split(",").map(e=>Qr(e.trim())).join(", ")}function ei(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function ti(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const ni=ei("area,br,col,hr,img,wbr"),ri=ei("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ii=ei("rp,rt"),si=ti(ni,ti(ri,ei("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ti(ii,ei("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ti(ii,ri)),oi=ei("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ai=ei("srcset"),li=ti(oi,ai,ei("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ei("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ci=ei("script,style,template");class ui{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!si.hasOwnProperty(t))return this.sanitizedSomething=!0,!ci.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let r=0;r<n.length;r++){const e=n.item(r),t=e.name,i=t.toLowerCase();if(!li.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let s=e.value;oi[i]&&(s=Qr(s)),ai[i]&&(s=Xr(s)),this.buf.push(" ",t,'="',pi(s),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();si.hasOwnProperty(t)&&!ni.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(pi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const hi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,di=/([^\#-~ |!])/g;function pi(e){return e.replace(/&/g,"&amp;").replace(hi,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(di,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let fi;function gi(e,t){let n=null;try{fi=fi||jr(e);let r=t?String(t):"";n=fi.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=fi.getInertBodyElement(r)}while(r!==s);return Lr((new ui).sanitizeChildren(mi(n)||n))}finally{if(n){const e=mi(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function mi(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var yi=(()=>((yi=yi||{})[yi.NONE=0]="NONE",yi[yi.HTML=1]="HTML",yi[yi.STYLE=2]="STYLE",yi[yi.SCRIPT=3]="SCRIPT",yi[yi.URL=4]="URL",yi[yi.RESOURCE_URL=5]="RESOURCE_URL",yi))();function vi(e){const t=Ci();return t?Fr(t.sanitize(yi.HTML,e)||""):qr(e,"HTML")?Fr(Gr(e)):gi(Ot(),_e(e))}function _i(e){const t=Ci();return t?t.sanitize(yi.URL,e)||"":qr(e,"URL")?Gr(e):Qr(_e(e))}function Ci(){const e=zt();return e&&e[12]}const Ei="__ngContext__";function wi(e,t){e[Ei]=t}function Si(e){const t=function(e){return e[Ei]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function bi(e){return e.ngOriginalError}function Pi(e,...t){e.error(...t)}class Oi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=(i=e)&&i.ngErrorLogger||Pi;var i;r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(bi(e)):null}_findOriginalError(e){let t=e&&bi(e);for(;t&&bi(t);)t=bi(t);return t||null}}const Ti=/^>|^->|<!--|-->|--!>|<!-$/g,Ii=/(<|>)/;const ki=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ze))();function Ai(e){return e instanceof Function?e():e}var Mi=(()=>((Mi=Mi||{})[Mi.Important=1]="Important",Mi[Mi.DashCase=2]="DashCase",Mi))();let Ni;function xi(e,t){return Ni(e,t)}function Ri(e){const t=e[3];return ut(t)?t[3]:t}function Di(e){return Fi(e[13])}function Li(e){return Fi(e[4])}function Fi(e){for(;null!==e&&!ut(e);)e=e[4];return e}function Ui(e,t,n,r,i){if(null!=r){let s,o=!1;ut(r)?s=r:ct(r)&&(o=!0,r=r[0]);const a=kt(r);0===e&&null!==n?null==i?Ki(t,n,a):Yi(t,n,a,i||null,!0):1===e&&null!==n?Yi(t,n,a,i||null,!0):2===e?ls(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==kt(n)&&Ui(t,e,r,s,i);for(let o=10;o<n.length;o++){const i=n[o];us(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function Bi(e,t){return Tt(e)?e.createText(t):e.createTextNode(t)}function Vi(e,t,n){Tt(e)?e.setValue(t,n):t.textContent=n}function $i(e,t){return e.createComment(function(e){return e.replace(Ti,e=>e.replace(Ii,"\u200b$1\u200b"))}(t))}function zi(e,t,n){return Tt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Hi(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Bt(i,-1)),n.splice(r,1)}function Gi(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Hi(i,r),t>0&&(e[n-1][4]=r[4]);const s=dr(e,10+t);!function(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function qi(e,t){if(!(256&t[2])){const n=t[11];Tt(n)&&n.destroyNode&&us(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Wi(e[1],e);for(;t;){let n=null;if(ct(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)ct(t)&&Wi(t[1],t),t=t[3];null===t&&(t=e),ct(t)&&Wi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Wi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):kt(t[e]),a=r[i=n[s+2]],l=n[s+3];"boolean"==typeof l?o.removeEventListener(n[s],a,l):l>=0?r[i=l]():r[i=-l].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)r[e]();t[7]=null}}(e,t),1===t[1].type&&Tt(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ut(t[3])){n!==t[3]&&Hi(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function ji(e,t,n){return Zi(e,t.parent,n)}function Zi(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Ue.None||t===Ue.Emulated)return null}return Mt(r,n)}function Yi(e,t,n,r,i){Tt(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Ki(e,t,n){Tt(e)?e.appendChild(t,n):t.appendChild(n)}function Ji(e,t,n,r,i){null!==r?Yi(e,t,n,r,i):Ki(e,t,n)}function Qi(e,t){return Tt(e)?e.parentNode(t):t.parentNode}function Xi(e,t,n){return ns(e,t,n)}function es(e,t,n){return 40&e.type?Mt(e,n):null}let ts,ns=es;function rs(e,t){ns=e,ts=t}function is(e,t,n,r){const i=ji(e,r,t),s=t[11],o=Xi(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)Ji(s,i,n[a],o,!1);else Ji(s,i,n,o,!1);void 0!==ts&&ts(s,r,t,n,i)}function ss(e,t){if(null!==t){const n=t.type;if(3&n)return Mt(t,e);if(4&n)return as(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return ss(e,n);{const n=e[t.index];return ut(n)?as(-1,n):kt(n)}}if(32&n)return xi(t,e)()||kt(e[t.index]);{const n=os(e,t);return null!==n?Array.isArray(n)?n[0]:ss(Ri(e[16]),n):ss(e,t.next)}}return null}function os(e,t){return null!==t?e[16][6].projection[t.projection]:null}function as(e,t){const n=10+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return ss(e,r)}return t[7]}function ls(e,t,n){const r=Qi(e,t);r&&function(e,t,n,r){Tt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function cs(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],l=n.type;if(o&&0===t&&(a&&wi(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&l)cs(e,t,n.child,r,i,s,!1),Ui(t,e,i,a,s);else if(32&l){const o=xi(n,r);let l;for(;l=o();)Ui(t,e,i,l,s);Ui(t,e,i,a,s)}else 16&l?hs(e,t,r,n,i,s):Ui(t,e,i,a,s);n=o?n.projectionNext:n.next}}function us(e,t,n,r,i,s){cs(n,r,e.firstChild,t,i,s,!1)}function hs(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)Ui(t,e,i,a[l],s);else cs(e,t,a,o[3],i,s,!0)}function ds(e,t,n){Tt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function ps(e,t,n){Tt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function fs(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const gs="ng-template";function ms(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==fs(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ys(e){return 4===e.type&&e.value!==gs}function vs(e,t,n){return t===(4!==e.type||n?e.value:gs)}function _s(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(kn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!vs(e,l,n)||""===l&&1===t.length){if(Cs(r))return!1;o=!0}}else{const c=8&r?l:t[++a];if(8&r&&null!==e.attrs){if(!ms(e.attrs,c,n)){if(Cs(r))return!1;o=!0}continue}const u=Es(8&r?"class":l,i,ys(e),n);if(-1===u){if(Cs(r))return!1;o=!0;continue}if(""!==c){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==fs(t,c,0)||2&r&&c!==e){if(Cs(r))return!1;o=!0}}}}else{if(!o&&!Cs(r)&&!Cs(l))return!1;if(o&&Cs(l))continue;o=!1,r=l|1&r}}return Cs(r)||o}function Cs(e){return 0==(1&e)}function Es(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ws(e,t,n=!1){for(let r=0;r<t.length;r++)if(_s(e,t[r],n))return!0;return!1}function Ss(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function bs(e,t){return e?":not("+t.trim()+")":t}function Ps(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Cs(o)&&(t+=bs(s,i),i=""),r=o,s=s||!Cs(r);n++}return""!==i&&(t+=bs(s,i)),t}const Os={};function Ts(e){Is(Ht(),zt(),yn()+e,Jt())}function Is(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&wn(t,r,n)}else{const r=e.preOrderHooks;null!==r&&Sn(t,r,0,n)}vn(n)}function ks(e,t){return e<<17|t<<2}function As(e){return e>>17&32767}function Ms(e){return 2|e}function Ns(e){return(131068&e)>>2}function xs(e,t){return-131069&e|t<<2}function Rs(e){return 1|e}function Ds(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];ln(i),n.contentQueries(2,t[s],s)}}}function Ls(e,t,n,r,i,s,o,a,l,c){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,Ut(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=l||e&&e[12]||null,u[9]=c||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function Fs(e,t,n,r,i){let s=e.data[t];if(null===s)s=Us(e,t,n,r,i),Vt.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=jt();s.injectorIndex=null===e?-1:e.injectorIndex}return Zt(s,!0),s}function Us(e,t,n,r,i){const s=Wt(),o=Yt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}function Bs(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Vs(e,t,n){hn(t);try{const r=e.viewQuery;null!==r&&_o(1,r,n);const i=e.template;null!==i&&Hs(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ds(e,t),e.staticViewQueries&&_o(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)fo(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,mn()}}function $s(e,t,n,r){const i=t[2];if(256==(256&i))return;hn(t);const s=Jt();try{Ut(t),function(e){Vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Hs(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&wn(t,n,null)}else{const n=e.preOrderHooks;null!==n&&Sn(t,n,0,null),bn(t,0)}if(function(e){for(let t=Di(e);null!==t;t=Li(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Bt(r,1),n[2]|=1024}}}(t),function(e){for(let t=Di(e);null!==t;t=Li(t))for(let e=10;e<t.length;e++){const n=t[e],r=n[1];Lt(n)&&$s(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Ds(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&wn(t,n)}else{const n=e.contentHooks;null!==n&&Sn(t,n,1),bn(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)vn(~r);else{const i=r,s=n[++e],o=n[++e];sn(s,i),o(2,t[i])}}}finally{vn(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)ho(e,t[n])}(t,a);const l=e.viewQuery;if(null!==l&&_o(2,l,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&wn(t,n)}else{const n=e.viewHooks;null!==n&&Sn(t,n,2),bn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Bt(t[3],-1))}finally{mn()}}function zs(e,t,n,r){const i=t[10],s=!Jt(),o=Dt(t);try{s&&!o&&i.begin&&i.begin(),o&&Vs(e,t,r),$s(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function Hs(e,t,n,r,i){const s=yn(),o=2&r;try{vn(-1),o&&t.length>20&&Is(e,t,20,Jt()),n(r,i)}finally{vn(s)}}function Gs(e,t,n){if(ht(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function qs(e,t,n){!$t()||(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Bn(n,t),wi(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=ft(r);s&&so(t,n,r);const l=Jn(t,e,a,n);wi(l,t),null!==o&&lo(0,a-i,l,r,0,o),s&&(Rt(n.index,t)[8]=l)}}(e,t,n,Mt(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Vt.lFrame.currentDirectiveIndex;try{vn(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];on(n),(null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs)&&eo(r,i)}}finally{vn(-1),on(o)}}(e,t,n))}function Ws(e,t,n=Mt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function js(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zs(e,t,n,r,i,s,o,a,l,c){const u=20+r,h=u+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Os);return n}(u,h),p="function"==typeof c?c():c;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function Ys(e,t,n,r){const i=Eo(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&wo(e).push(r,i.length-1))}function Ks(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Js(e,t,n,r,i,s,o,a){const l=Mt(t,n);let c,u=t.inputs;!a&&null!=u&&(c=u[r])?(bo(e,n,c,r,i),dt(t)&&function(e,t){const n=Rt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,Tt(s)?s.setProperty(l,r,i):An(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function Qs(e,t,n,r){let i=!1;if($t()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];ws(n,o.selectors,!1)&&(i||(i=[]),Hn(Bn(n,t),e,o.type),ft(o)?(to(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,ro(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,l=Bs(e,t,s.length,null);for(let i=0;i<s.length;i++){const c=s[i];n.mergedAttrs=Mn(n.mergedAttrs,c.hostAttrs),io(e,n,t,l,c),no(l,c,o),null!==c.contentQueries&&(n.flags|=8),(null!==c.hostBindings||null!==c.hostAttrs||0!==c.hostVars)&&(n.flags|=128);const u=c.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),l++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let l=t.directiveStart;l<n;l++){const e=r[l],n=e.inputs,c=null===i||ys(t)?null:co(n,i);s.push(c),o=Ks(n,l,o),a=Ks(e.outputs,l,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new ve("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Mn(n.mergedAttrs,n.attrs),i}function Xs(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function eo(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function to(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function no(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;ft(t)&&(n[""]=e)}}function ro(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function io(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=mt(i.type)),o=new Tn(s,ft(i),null);e.blueprint[r]=o,n[r]=o,Xs(e,t,0,r,Bs(e,n,i.hostVars,Os),i)}function so(e,t,n){const r=Mt(t,e),i=js(n),s=e[10],o=go(e,Ls(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function oo(e,t,n,r,i,s){const o=Mt(e,t);ao(t[11],o,s,e.value,n,r,i)}function ao(e,t,n,r,i,s,o){if(null==s)Tt(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==o?_e(s):o(s,r||"",i);Tt(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}function lo(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function co(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function uo(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function ho(e,t){const n=Rt(t,e);if(Lt(n)){const e=n[1];80&n[2]?$s(e,n,e.template,n[8]):n[5]>0&&po(n)}}function po(e){for(let n=Di(e);null!==n;n=Li(n))for(let e=10;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];$s(e,t,e.template,t[8])}else t[5]>0&&po(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=Rt(t[n],e);Lt(r)&&r[5]>0&&po(r)}}function fo(e,t){const n=Rt(t,e),r=n[1];(function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Vs(r,n,n[8])}function go(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function mo(e){for(;e;){e[2]|=64;const t=Ri(e);if(gt(e)&&!t)return e;e=t}return null}function yo(e,t,n){const r=t[10];r.begin&&r.begin();try{$s(e,t,e.template,n)}catch(i){throw So(t,i),i}finally{r.end&&r.end()}}function vo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=Si(n),i=r[1];zs(i,r,i.template,n)}}(e[8])}function _o(e,t,n){ln(0),t(e,n)}const Co=(()=>Promise.resolve(null))();function Eo(e){return e[7]||(e[7]=[])}function wo(e){return e.cleanup||(e.cleanup=[])}function So(e,t){const n=e[9],r=n?n.get(Oi,null):null;r&&r.handleError(t)}function bo(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],l=t[o],c=e.data[o];null!==c.setInput?c.setInput(l,i,r,a):l[a]=i}}function Po(e,t,n){const r=At(t,e);Vi(e[11],r,n)}function Oo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=pe(i,e):2==s&&(r=pe(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const To=new or("INJECTOR",-1);class Io{get(e,t=yr){if(t===yr){const t=new Error(`NullInjectorError: No provider for ${de(e)}!`);throw t.name="NullInjectorError",t}return t}}const ko=new or("Set Injector scope."),Ao={},Mo={};let No;function xo(){return void 0===No&&(No=new Io),No}function Ro(e,t=null,n=null,r){return new Do(e,n,t||xo(),r)}class Do{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&ur(t,n=>this.processProvider(n,e,t)),ur([e],e=>this.processInjectorType(e,[],i)),this.records.set(To,Uo(void 0,this));const s=this.records.get(ko);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:de(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=yr,n=Ne.Default){this.assertNotDestroyed();const r=br(this),i=Re(void 0);try{if(!(n&Ne.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(s=e)||"object"==typeof s&&s instanceof or)&&Pe(e);t=n&&this.injectableDefInScope(n)?Uo(Lo(e),Ao):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&Ne.Self?xo():this.parent).get(e,t=n&Ne.Optional&&t===yr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_r]=o[_r]||[]).unshift(de(e)),r)throw o;return Ar(o,e,"R3InjectorError",this.source)}throw o}finally{Re(i),br(r)}var s}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(de(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=me(e)))return!1;let r=Te(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=Te(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{ur(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];ur(r,e=>this.processProvider(e,n,r||Ge))}}this.injectorDefTypes.add(s);const a=mt(s)||(()=>new s);this.records.set(s,Uo(a,Ao));const l=r.providers;if(null!=l&&!o){const t=e;ur(l,e=>this.processProvider(e,t,l))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=Vo(e=me(e))?e:me(e&&e.provide);const i=function(e,t,n){return Bo(e)?Uo(void 0,e.useValue):Uo(Fo(e),Ao)}(e);if(Vo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Uo(void 0,Ao,!0),t.factory=()=>Tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){return t.value===Ao&&(t.value=Mo,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}injectableDefInScope(e){if(!e.providedIn)return!1;const t=me(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Lo(e){const t=Pe(e),n=null!==t?t.factory:mt(e);if(null!==n)return n;if(e instanceof or)throw new Error(`Token ${de(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=pr(t,"?");throw new Error(`Can't resolve all parameters for ${de(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[Ie]||e[Ae]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Fo(e,t,n){let r;if(Vo(e)){const t=me(e);return mt(t)||Lo(t)}if(Bo(e))r=()=>me(e.useValue);else if(function(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Or(me(e.useExisting));else{const t=me(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return mt(t)||Lo(t);r=()=>new t(...Tr(e.deps))}return r}function Uo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Bo(e){return null!==e&&"object"==typeof e&&wr in e}function Vo(e){return"function"==typeof e}const $o=function(e,t,n){return function(e,t=null,n=null,r){const i=Ro(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let zo=(()=>{class e{static create(e,t){return Array.isArray(e)?$o(e,t,""):$o(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=yr,e.NULL=new Io,e.\u0275prov=Se({token:e,providedIn:"any",factory:()=>Or(To)}),e.__NG_ELEMENT_ID__=-1,e})();function Ho(e,t){En(Si(e)[1],qt())}function Go(e){let t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let i;if(ft(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=qo(e.inputs),t.declaredInputs=qo(e.declaredInputs),t.outputs=qo(e.outputs);const n=i.hostBindings;n&&Zo(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&Wo(e,s),o&&jo(e,o),he(e.inputs,i.inputs),he(e.declaredInputs,i.declaredInputs),he(e.outputs,i.outputs),ft(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Go&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Mn(i.hostAttrs,n=Mn(n,i.hostAttrs))}}(r)}function qo(e){return e===He?{}:e===Ge?[]:e}function Wo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function jo(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function Zo(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Yo=null;function Ko(){if(!Yo){const e=ze.Symbol;if(e&&e.iterator)Yo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Yo=n)}}}return Yo}class Jo{constructor(e){this.wrapped=e}static wrap(e){return new Jo(e)}static unwrap(e){return Jo.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Jo}}function Qo(e){return!!Xo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ko()in e)}function Xo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ea(e,t,n){return e[t]=n}function ta(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function na(e,t,n,r){const i=ta(e,t,n);return ta(e,t+1,r)||i}function ra(e,t,n,r){const i=zt();return ta(i,tn(),t)&&(Ht(),oo(_n(),i,e,t,n,r)),ra}function ia(e,t,n,r){return ta(e,tn(),n)?t+_e(n)+r:Os}function sa(e,t,n,r,i,s){const o=na(e,en(),n,i);return nn(2),o?t+_e(n)+r+_e(i)+s:Os}function oa(e,t,n,r,i,s,o,a){const l=function(e,t,n,r,i){const s=na(e,t,n,r);return ta(e,t+2,i)||s}(e,en(),n,i,o);return nn(3),l?t+_e(n)+r+_e(i)+s+_e(o)+a:Os}function aa(e,t,n,r,i,s){const o=zt(),a=ia(o,t,n,r);return a!==Os&&oo(_n(),o,e,a,i,s),aa}function la(e,t,n,r,i,s,o,a){const l=zt(),c=Ht(),u=e+20,h=c.firstCreatePass?function(e,t,n,r,i,s,o,a,l){const c=t.consts,u=Fs(t,e,4,o||null,Ft(c,a));Qs(t,n,u,Ft(c,l)),En(t,u);const h=u.tViews=Zs(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,c,l,t,n,r,i,s,o):c.data[u];Zt(h,!1);const d=l[11].createComment("");is(c,l,d,h),wi(d,l),go(l,l[u]=uo(d,l,d,h)),pt(h)&&qs(c,l,h),null!=o&&Ws(l,h,a)}function ca(e){return xt(Vt.lFrame.contextLView,20+e)}function ua(e,t=Ne.Default){const n=zt();return null===n?Or(e,t):Wn(qt(),n,me(e),t)}function ha(e,t,n){const r=zt();return ta(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!1),ha}function da(e,t,n,r,i){const s=i?"class":"style";bo(e,n,t.inputs[s],s,r)}function pa(e,t,n,r){const i=zt(),s=Ht(),o=20+e,a=i[11],l=i[o]=zi(a,t,Vt.lFrame.currentNamespace),c=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,l=Fs(t,e,2,i,Ft(a,s));return Qs(t,n,l,Ft(a,o)),null!==l.attrs&&Oo(l,l.attrs,!1),null!==l.mergedAttrs&&Oo(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(o,s,i,0,t,n,r):s.data[o];Zt(c,!0);const u=c.mergedAttrs;null!==u&&In(a,l,u);const h=c.classes;null!==h&&ps(a,l,h);const d=c.styles;null!==d&&ds(a,l,d),64!=(64&c.flags)&&is(s,i,l,c),0===Vt.lFrame.elementDepthCount&&wi(l,i),Vt.lFrame.elementDepthCount++,pt(c)&&(qs(s,i,c),Gs(s,c,i)),null!==r&&Ws(i,c)}function fa(){let e=qt();Yt()?Kt():(e=e.parent,Zt(e,!1));const t=e;Vt.lFrame.elementDepthCount--;const n=Ht();n.firstCreatePass&&(En(n,e),ht(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&da(n,t,zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&da(n,t,zt(),t.stylesWithoutHost,!1)}function ga(e,t,n,r){pa(e,t,n,r),fa()}function ma(e,t,n){const r=zt(),i=Ht(),s=e+20,o=i.firstCreatePass?function(e,t,n,r,i){const s=t.consts,o=Ft(s,r),a=Fs(t,e,8,"ng-container",o);return null!==o&&Oo(a,o,!0),Qs(t,n,a,Ft(s,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(s,i,r,t,n):i.data[s];Zt(o,!0);const a=r[s]=r[11].createComment("");is(i,r,a,o),wi(a,r),pt(o)&&(qs(i,r,o),Gs(i,o,r)),null!=n&&Ws(r,o)}function ya(){let e=qt();const t=Ht();Yt()?Kt():(e=e.parent,Zt(e,!1)),t.firstCreatePass&&(En(t,e),ht(e)&&t.queries.elementEnd(e))}function va(){return zt()}function _a(e){return!!e&&"function"==typeof e.then}const Ca=function(e){return!!e&&"function"==typeof e.subscribe};function Ea(e,t,n,r){const i=zt(),s=Ht(),o=qt();return function(e,t,n,r,i,s,o,a){const l=pt(r),c=e.firstCreatePass&&wo(e),u=t[8],h=Eo(t);let d=!0;if(3&r.type||a){const p=Mt(r,t),f=a?a(p):p,g=h.length,m=a?e=>a(kt(e[r.index])):r.index;if(Tt(n)){let o=null;if(!a&&l&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=Sa(r,t,u,s,!1);const e=n.listen(f,i,s);h.push(s,e),c&&c.push(i,m,g,g+1)}}else s=Sa(r,t,u,s,!0),f.addEventListener(i,s,o),h.push(s),c&&c.push(i,m,g,o)}else s=Sa(r,t,u,s,!1);const p=r.outputs;let f;if(d&&null!==p&&(f=p[i])){const e=f.length;if(e)for(let n=0;n<e;n+=2){const e=t[f[n]][f[n+1]].subscribe(s),o=h.length;h.push(s,e),c&&c.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,!!n,r),Ea}function wa(e,t,n,r){try{return!1!==n(r)}catch(i){return So(e,i),!1}}function Sa(e,t,n,r,i){return function n(s){if(s===Function)return r;const o=2&e.flags?Rt(e.index,t):t;0==(32&t[2])&&mo(o);let a=wa(t,0,r,s),l=n.__ngNextListenerFn__;for(;l;)a=wa(t,0,l,s)&&a,l=l.__ngNextListenerFn__;return i&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function ba(e=1){return function(e){return(Vt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Vt.lFrame.contextLView))[8]}(e)}function Pa(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const s=t[i];if("*"!==s){if(null===r?ws(e,s,!0):Ss(r,s))return i}else n=i}return n}function Oa(e,t,n){return Ta(e,"",t,"",n),Oa}function Ta(e,t,n,r,i){const s=zt(),o=ia(s,t,n,r);return o!==Os&&Js(Ht(),_n(),s,e,o,s[11],i,!1),Ta}function Ia(e,t,n,r,i,s,o){const a=zt(),l=sa(a,t,n,r,i,s);return l!==Os&&Js(Ht(),_n(),a,e,l,a[11],o,!1),Ia}function ka(e,t,n,r,i,s,o,a,l){const c=zt(),u=oa(c,t,n,r,i,s,o,a);return u!==Os&&Js(Ht(),_n(),c,e,u,c[11],l,!1),ka}function Aa(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?As(s):Ns(s),l=!1;for(;0!==a&&(!1===l||o);){const n=e[a+1];Ma(e[a],t)&&(l=!0,e[a+1]=r?Rs(n):Ms(n)),a=r?As(n):Ns(n)}l&&(e[n+1]=r?Ms(s):Rs(s))}function Ma(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&mr(e,t)>=0}function Na(e,t){return function(e,t,n,r){const i=zt(),s=Ht(),o=nn(2);s.firstUpdatePass&&function(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[yn()],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(e.flags&(t?16:32))})(s,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Vt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=Ra(n=xa(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=xa(i,e,t,n,r),null===s){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Ns(r))return e[As(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=xa(null,e,t,n[1],r),n=Ra(n,t.attrs,r),function(e,t,n,r){e[As(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else s=function(e,t,n){let r;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=Ra(r,e[s].hostAttrs,n);return Ra(r,t.attrs,n)}(e,t,r)}return void 0!==s&&(r?t.residualClasses=s:t.residualStyles=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=s?t.classBindings:t.styleBindings,a=As(o),l=Ns(o);e[r]=n;let c,u=!1;if(Array.isArray(n)){const e=n;c=e[1],(null===c||mr(e,c)>0)&&(u=!0)}else c=n;if(i)if(0!==l){const t=As(e[a+1]);e[r+1]=ks(t,a),0!==t&&(e[t+1]=xs(e[t+1],r)),e[a+1]=function(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=ks(a,0),0!==a&&(e[a+1]=xs(e[a+1],r)),a=r;else e[r+1]=ks(l,0),0===a?a=r:e[l+1]=xs(e[l+1],r),l=r;u&&(e[r+1]=Ms(e[r+1])),Aa(e,c,r,!0),Aa(e,c,r,!1),function(e,t,n,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&mr(s,t)>=0&&(n[r+1]=Rs(n[r+1]))}(t,c,e,r,s),o=ks(a,l),s?t.classBindings=o:t.styleBindings=o}(i,s,t,n,o,r)}}(s,e,o,r),t!==Os&&ta(i,o,t)&&function(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const l=e.data,c=l[a+1];La(function(e){return 1==(1&e)}(c)?Da(l,t,n,i,Ns(c),o):void 0)||(La(s)||function(e){return 2==(2&e)}(c)&&(s=Da(l,null,n,i,a,o)),function(e,t,n,r,i){const s=Tt(e);if(t)i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Mi.DashCase;if(null==i)s?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const o="string"==typeof i&&i.endsWith("!important");o&&(i=i.slice(0,-10),t|=Mi.Important),s?e.setStyle(n,r,i,t):n.style.setProperty(r,i,o?"important":"")}}}(r,o,At(yn(),n),i,s))}(s,s.data[yn()],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=de(Gr(e)))),e}(t,n),r,o)}(e,t,null,!0),Na}function xa(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=Ra(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function Ra(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),fr(e,o,!!n||t[++s]))}return void 0===e?null:e}function Da(e,t,n,r,i,s){const o=null===t;let a;for(;i>0;){const t=e[i],s=Array.isArray(t),l=s?t[1]:t,c=null===l;let u=n[i+1];u===Os&&(u=c?Ge:void 0);let h=c?gr(u,r):l===r?u:void 0;if(s&&!La(h)&&(h=gr(t,r)),La(h)&&(a=h,o))return a;const d=e[i+1];i=o?As(d):Ns(d)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=gr(e,r))}return a}function La(e){return void 0!==e}function Fa(e,t=""){const n=zt(),r=Ht(),i=e+20,s=r.firstCreatePass?Fs(r,i,1,t,null):r.data[i],o=n[i]=Bi(n[11],t);is(r,n,o,s),Zt(s,!1)}function Ua(e){return Ba("",e,""),Ua}function Ba(e,t,n){const r=zt(),i=ia(r,e,t,n);return i!==Os&&Po(r,yn(),i),Ba}function Va(e,t,n,r,i){const s=zt(),o=sa(s,e,t,n,r,i);return o!==Os&&Po(s,yn(),o),Va}function $a(e,t,n,r,i,s,o){const a=zt(),l=oa(a,e,t,n,r,i,s,o);return l!==Os&&Po(a,yn(),l),$a}function za(e,t,n){const r=zt();return ta(r,tn(),t)&&Js(Ht(),_n(),r,e,t,r[11],n,!0),za}const Ha=void 0;var Ga=["en",[["a","p"],["AM","PM"],Ha],[["AM","PM"],Ha,Ha],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ha,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ha,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ha,"{1} 'at' {0}",Ha],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){const t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let qa={};function Wa(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Za(t);if(n)return n;const r=t.split("-")[0];if(n=Za(r),n)return n;if("en"===r)return Ga;throw new Error(`Missing locale data for the locale "${e}".`)}function ja(e){return Wa(e)[Ya.PluralCase]}function Za(e){return e in qa||(qa[e]=ze.ng&&ze.ng.common&&ze.ng.common.locales&&ze.ng.common.locales[e]),qa[e]}var Ya=(()=>((Ya=Ya||{})[Ya.LocaleId=0]="LocaleId",Ya[Ya.DayPeriodsFormat=1]="DayPeriodsFormat",Ya[Ya.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ya[Ya.DaysFormat=3]="DaysFormat",Ya[Ya.DaysStandalone=4]="DaysStandalone",Ya[Ya.MonthsFormat=5]="MonthsFormat",Ya[Ya.MonthsStandalone=6]="MonthsStandalone",Ya[Ya.Eras=7]="Eras",Ya[Ya.FirstDayOfWeek=8]="FirstDayOfWeek",Ya[Ya.WeekendRange=9]="WeekendRange",Ya[Ya.DateFormat=10]="DateFormat",Ya[Ya.TimeFormat=11]="TimeFormat",Ya[Ya.DateTimeFormat=12]="DateTimeFormat",Ya[Ya.NumberSymbols=13]="NumberSymbols",Ya[Ya.NumberFormats=14]="NumberFormats",Ya[Ya.CurrencyCode=15]="CurrencyCode",Ya[Ya.CurrencySymbol=16]="CurrencySymbol",Ya[Ya.CurrencyName=17]="CurrencyName",Ya[Ya.Currencies=18]="Currencies",Ya[Ya.Directionality=19]="Directionality",Ya[Ya.PluralCase=20]="PluralCase",Ya[Ya.ExtraData=21]="ExtraData",Ya))();const Ka=["zero","one","two","few","many"],Ja="en-US",Qa={marker:"element"},Xa={marker:"ICU"};var el=(()=>((el=el||{})[el.SHIFT=2]="SHIFT",el[el.APPEND_EAGERLY=1]="APPEND_EAGERLY",el[el.COMMENT=2]="COMMENT",el))();let tl=Ja;function nl(e){(function(e,t){null==e&&we(t,e,null,"!=")})(e,"Expected localeId to be defined"),"string"==typeof e&&(tl=e.toLowerCase().replace(/_/g,"-"))}function rl(e,t,n){const r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?es(e,0,n):kt(n[i])}function il(e,t,n,r,i){const s=t.insertBeforeIndex;if(Array.isArray(s)){let o=r,a=null;if(3&t.type||(a=o,o=i),null!==o&&0==(2&t.flags))for(let t=1;t<s.length;t++)Yi(e,o,n[s[t]],a,!1)}}function sl(e,t){if(e.push(t),e.length>1)for(let n=e.length-2;n>=0;n--){const r=e[n];ol(r)||al(r,t)&&null===ll(r)&&cl(r,t.index)}}function ol(e){return!(64&e.type)}function al(e,t){return ol(t)||e.index>t.index}function ll(e){const t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function cl(e,t){const n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(rs(rl,il),e.insertBeforeIndex=t)}function ul(e,t){const n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function hl(e,t,n){const r=Us(e,n,64,null,null);return sl(t,r),r}function dl(e,t){const n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function pl(e){return e>>>17}function fl(e){return(131070&e)>>>1}let gl=0,ml=0;function yl(e,t,n,r){const i=n[11];let s,o=null;for(let a=0;a<t.length;a++){const l=t[a];if("string"==typeof l){const e=t[++a];null===n[e]&&(n[e]=Bi(i,l))}else if("number"==typeof l)switch(1&l){case 0:const c=pl(l);let u,h;if(null===o&&(o=c,s=Qi(i,r)),c===o?(u=r,h=s):(u=null,h=kt(n[c])),null!==h){const t=fl(l);Yi(i,h,n[t],u,!1);const r=ul(e,t);if(null!==r&&"object"==typeof r){const t=dl(r,n);null!==t&&yl(e,r.create[t],n,n[r.anchorIdx])}}break;case 1:const d=t[++a],p=t[++a];ao(i,At(l>>>1,n),null,null,d,p,null);break;default:throw new Error(`Unable to determine the type of mutate operation for "${l}"`)}else switch(l){case Xa:const e=t[++a],r=t[++a];null===n[r]&&wi(n[r]=$i(i,e),n);break;case Qa:const s=t[++a],o=t[++a];null===n[o]&&wi(n[o]=zi(i,s,null),n)}}}function vl(e,t,n,r,i){for(let s=0;s<n.length;s++){const o=n[s],a=n[++s];if(o&i){let i="";for(let o=s+1;o<=s+a;o++){const s=n[o];if("string"==typeof s)i+=s;else if("number"==typeof s)if(s<0)i+=_e(t[r-s]);else{const a=s>>>2;switch(3&s){case 1:const s=n[++o],l=n[++o],c=e.data[a];"string"==typeof c?ao(t[11],t[a],null,c,s,i,l):Js(e,c,t,s,i,t[11],l,!1);break;case 0:const u=t[a];null!==u&&Vi(t[11],u,i);break;case 2:Cl(e,ul(e,a),t,i);break;case 3:_l(e,ul(e,a),r,t)}}}}else{const i=n[s+1];if(i>0&&3==(3&i)){const n=ul(e,i>>>2);t[n.currentCaseLViewIndex]<0&&_l(e,n,r,t)}}s+=a}}function _l(e,t,n,r){let i=r[t.currentCaseLViewIndex];if(null!==i){let s=gl;i<0&&(i=r[t.currentCaseLViewIndex]=~i,s=-1),vl(e,r,t.update[i],n,s)}}function Cl(e,t,n,r){const i=function(e,t){let n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:{const r=function(e,t){const n=ja(t)(parseInt(e,10)),r=Ka[n];return void 0!==r?r:"other"}(t,tl);n=e.cases.indexOf(r),-1===n&&"other"!==r&&(n=e.cases.indexOf("other"));break}case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(dl(t,n)!==i&&(El(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){const r=n[t.anchorIdx];r&&yl(e,t.create[i],n,r)}}function El(e,t,n){let r=dl(t,n);if(null!==r){const i=t.remove[r];for(let t=0;t<i.length;t++){const r=i[t];if(r>0){const e=At(r,n);null!==e&&ls(n[11],e)}else El(e,ul(e,~r),n)}}}function wl(){const e=[];let t,n,r=-1;function i(e,t){r=0;const i=dl(e,t);n=null!==i?e.remove[i]:Ge}function s(){if(r<n.length){const o=n[r++];return o>0?t[o]:(e.push(r,n),i(t[1].data[~o],t),s())}return 0===e.length?null:(n=e.pop(),r=e.pop(),s())}return function(n,r){for(t=r;e.length;)e.pop();return i(n.value,r),s}}const Sl=/\ufffd(\d+):?\d*\ufffd/gi,bl=/\ufffd(\d+)\ufffd/,Pl=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,Ol=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,Tl=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,Il=/\uE500/g;function kl(e,t,n,r,i,s,o){const a=Bs(e,r,1,null);let l=a<<el.SHIFT,c=jt();t===c&&(c=null),null===c&&(l|=el.APPEND_EAGERLY),o&&(l|=el.COMMENT,function(e){void 0===Ni&&(Ni=e())}(wl)),i.push(l,null===s?"":s);const u=Us(e,a,o?32:1,null===s?"":s,null);sl(n,u);const h=u.index;return Zt(u,!1),null!==c&&t!==c&&function(e,t){let n=e.insertBeforeIndex;null===n?(rs(rl,il),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){e!=t&&we(n,e,t,"==")}(Array.isArray(n),!0,"Expecting array here"),n.push(t))}(c,h),u}function Al(e,t,n,r,i,s,o){const a=o.match(Sl),l=kl(e,t,n,s,r,a?null:o,!1);a&&Ml(i,o,l.index,null,0,null)}function Ml(e,t,n,r,i,s){const o=e.length,a=o+1;e.push(null,null);const l=o+2,c=t.split(Sl);let u=0;for(let h=0;h<c.length;h++){const t=c[h];if(1&h){const n=i+parseInt(t,10);e.push(-1-n),u|=Nl(n)}else""!==t&&e.push(t)}return e.push(n<<2|(r?1:0)),r&&e.push(r,s),e[o]=u,e[a]=e.length-l,u}function Nl(e){return 1<<Math.min(e,31)}function xl(e){let t,n,r="",i=0,s=!1;for(;null!==(t=Ol.exec(e));)s?t[0]===`\ufffd/*${n}\ufffd`&&(i=t.index,s=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],s=!0);return r+=e.substr(i),r}function Rl(e,t,n,r,i,s){let o=0;const a={type:i.type,currentCaseLViewIndex:Bs(e,t,1,null),anchorIdx:s,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(Nl(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,s),function(e,t,n){const r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,s,a);const l=i.values;for(let c=0;c<l.length;c++){const s=l[c],u=[];for(let e=0;e<s.length;e++){const t=s[e];if("string"!=typeof t){const n=u.push(t)-1;s[e]=`\x3c!--\ufffd${n}\ufffd--\x3e`}}o=Fl(e,a,t,n,r,i.cases[c],s.join(""),u)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,s)}function Dl(e){const t=[],n=[];let r=1,i=0;const s=Ll(e=e.replace(Pl,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""}));for(let o=0;o<s.length;){let e=s[o++].trim();1===r&&(e=e.replace(/\s*(?:=)?(\w+)\s*/,"$1")),e.length&&t.push(e);const i=Ll(s[o++]);t.length>n.length&&n.push(i)}return{type:r,mainBinding:i,cases:t,values:n}}function Ll(e){if(!e)return[];let t=0;const n=[],r=[],i=/[{}]/g;let s;for(i.lastIndex=0;s=i.exec(e);){const i=s.index;if("}"==s[0]){if(n.pop(),0==n.length){const n=e.substring(t,i);Pl.test(n)?r.push(Dl(n)):r.push(n),t=i+1}}else{if(0==n.length){const n=e.substring(t,i);r.push(n),t=i+1}n.push("{")}}const o=e.substring(t);return r.push(o),r}function Fl(e,t,n,r,i,s,o,a){const l=[],c=[],u=[];t.cases.push(s),t.create.push(l),t.remove.push(c),t.update.push(u);const h=jr(Ot()).getInertBodyElement(o),d=mi(h)||h;return d?Ul(e,t,n,r,l,c,u,d,i,a,0):0}function Ul(e,t,n,r,i,s,o,a,l,c,u){let h=0,d=a.firstChild;for(;d;){const a=Bs(e,n,1,null);switch(d.nodeType){case Node.ELEMENT_NODE:const p=d,f=p.tagName.toLowerCase();if(si.hasOwnProperty(f)){$l(i,Qa,f,l,a),e.data[a]=f;const g=p.attributes;for(let e=0;e<g.length;e++){const t=g.item(e),n=t.name.toLowerCase();t.value.match(Sl)?li.hasOwnProperty(n)&&Ml(o,t.value,a,t.name,0,oi[n]?Qr:ai[n]?Xr:null):zl(i,a,t)}h=Ul(e,t,n,r,i,s,o,d,a,c,u+1)|h,Bl(s,a,u)}break;case Node.TEXT_NODE:const g=d.textContent||"",m=g.match(Sl);$l(i,null,m?"":g,l,a),Bl(s,a,u),m&&(h=Ml(o,g,a,null,0,null)|h);break;case Node.COMMENT_NODE:const y=bl.exec(d.textContent||"");if(y){const t=c[parseInt(y[1],10)];$l(i,Xa,"",l,a),Rl(e,n,r,l,t,a),Vl(s,a,u)}}d=d.nextSibling}return h}function Bl(e,t,n){0===n&&e.push(t)}function Vl(e,t,n){0===n&&(e.push(~t),e.push(t))}function $l(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function zl(e,t,n){e.push(t<<1|1,n.name,n.value)}function Hl(e,t,n=-1){const r=Ht(),i=zt(),s=20+e,o=Ft(r.consts,t),a=jt();r.firstCreatePass&&function(e,t,n,r,i,s){const o=jt(),a=[],l=[],c=[[]],u=function(e){return e.replace(Il," ")}(i=function(e,t){if(function(e){return-1===e}(t))return xl(e);{const n=e.indexOf(`:${t}\ufffd`)+2+t.toString().length,r=e.search(new RegExp(`\ufffd\\/\\*\\d+:${t}\ufffd`));return xl(e.substring(n,r))}}(i,s)).split(Tl);for(let h=0;h<u.length;h++){let r=u[h];if(0==(1&h)){const s=Ll(r);for(let r=0;r<s.length;r++){let u=s[r];if(0==(1&r)){const t=u;""!==t&&Al(e,o,c[0],a,l,n,t)}else{const r=u;if("object"!=typeof r)throw new Error(`Unable to parse ICU expression in "${i}" message.`);Rl(e,n,l,t,r,kl(e,o,c[0],n,a,"",!0).index)}}}else{const t=47===r.charCodeAt(0),n=(r.charCodeAt(t?1:0),20+Number.parseInt(r.substring(t?2:1)));if(t)c.shift(),Zt(jt(),!1);else{const t=hl(e,c[0],n);c.unshift([]),Zt(t,!0)}}}e.data[r]={create:a,update:l}}(r,null===a?0:a.index,i,s,o,n);const l=r.data[s],c=Zi(r,a===i[6]?null:a,i);(function(e,t,n,r){const i=e[11];for(let s=0;s<t.length;s++){const o=t[s++],a=t[s],l=(o&el.COMMENT)===el.COMMENT,c=(o&el.APPEND_EAGERLY)===el.APPEND_EAGERLY,u=o>>>el.SHIFT;let h=e[u];null===h&&(h=e[u]=l?i.createComment(a):Bi(i,a)),c&&null!==n&&Yi(i,n,h,r,!1)}})(i,l.create,c,a&&8&a.type?i[a.index]:null),rn(!0)}function Gl(){rn(!1)}function ql(e,t,n){Hl(e,t,n),Gl()}function Wl(e){return function(e){e&&(gl|=1<<Math.min(ml,31)),ml++}(ta(zt(),tn(),e)),Wl}function jl(e){!function(e,t,n){if(ml>0){const r=e.data[n];vl(e,t,Array.isArray(r)?r:r.update,en()-ml-1,gl)}gl=0,ml=0}(Ht(),zt(),e+20)}function Zl(e,t,n,r,i){if(e=me(e),Array.isArray(e))for(let s=0;s<e.length;s++)Zl(e[s],t,n,r,i);else{const s=Ht(),o=zt();let a=Vo(e)?e:me(e.provide),l=Fo(e);const c=qt(),u=1048575&c.providerIndexes,h=c.directiveStart,d=c.providerIndexes>>20;if(Vo(e)||!e.multi){const r=new Tn(l,i,ua),p=Jl(a,t,i?u:u+d,h);-1===p?(Hn(Bn(c,o),s,a),Yl(s,e,t.length),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(r),o.push(r)):(n[p]=r,o[p]=r)}else{const p=Jl(a,t,u+d,h),f=Jl(a,t,u,u+d),g=p>=0&&n[p],m=f>=0&&n[f];if(i&&!m||!i&&!g){Hn(Bn(c,o),s,a);const u=function(e,t,n,r,i){const s=new Tn(e,n,ua);return s.multi=[],s.index=t,s.componentProviders=0,Kl(s,i,r&&!n),s}(i?Xl:Ql,n.length,i,r,l);!i&&m&&(n[f].providerFactory=u),Yl(s,e,t.length,0),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(u),o.push(u)}else Yl(s,e,p>-1?p:f,Kl(n[i?f:p],l,!i&&r));!i&&r&&m&&n[f].componentProviders++}}}function Yl(e,t,n,r){const i=Vo(t);if(i||function(e){return!!e.useClass}(t)){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function Kl(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function Jl(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function Ql(e,t,n,r){return ec(this.multi,[])}function Xl(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Jn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),ec(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],ec(i,s);return s}function ec(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function tc(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ht();if(r.firstCreatePass){const i=ft(e);Zl(n,r.data,r.blueprint,i,!0),Zl(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class nc{}const rc="ngComponent";class ic{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${de(e)}. Did you add it to @NgModule.entryComponents?`);return t[rc]=e,t}(e)}}let sc=(()=>{class e{}return e.NULL=new ic,e})();function oc(...e){}function ac(e,t){return new cc(Mt(e,t))}const lc=function(){return ac(qt(),zt())};let cc=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=lc,e})();function uc(e){return e instanceof cc?e.nativeElement:e}class hc{}let dc=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>pc(),e})();const pc=function(){const e=zt(),t=Rt(qt().index,e);return function(e){return e[11]}(ct(t)?t:e)};let fc=(()=>{class e{}return e.\u0275prov=Se({token:e,providedIn:"root",factory:()=>null}),e})();class gc{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const mc=new gc("12.2.16");class yc{constructor(){}supports(e){return Qo(e)}create(e){return new _c(e)}}const vc=(e,t)=>t;class _c{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||vc}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<Sc(n,r,i)?t:n,o=Sc(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Qo(e))throw new Error(`Error trying to diff '${de(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Ko()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new Cc(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new wc),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new wc),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class Cc{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Ec{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class wc{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new Ec,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Sc(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class bc{constructor(){}supports(e){return e instanceof Map||Xo(e)}create(){return new Pc}}class Pc{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Xo(e)))throw new Error(`Error trying to diff '${de(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Oc(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Oc{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Tc(){return new Ic([new yc])}let Ic=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Tc()),deps:[[e,new xr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}return e.\u0275prov=Se({token:e,providedIn:"root",factory:Tc}),e})();function kc(){return new Ac([new bc])}let Ac=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||kc()),deps:[[e,new xr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=Se({token:e,providedIn:"root",factory:kc}),e})();function Mc(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(kt(s)),ut(s))for(let e=10;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&Mc(t[1],t,n,r)}const o=n.type;if(8&o)Mc(e,t,n.child,r);else if(32&o){const e=xi(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=os(t,n);if(Array.isArray(e))r.push(...e);else{const n=Ri(t[16]);Mc(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class Nc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Mc(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ut(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Gi(e,n),dr(t,n))}this._attachedToViewContainer=!1}qi(this._lView[1],this._lView)}onDestroy(e){Ys(this._lView[1],this._lView,null,e)}markForCheck(){mo(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){yo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Qt(!0);try{yo(e,t,n)}finally{Qt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,us(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class xc extends Nc{constructor(e){super(e),this._view=e}detectChanges(){vo(this._view)}checkNoChanges(){!function(e){Qt(!0);try{vo(e)}finally{Qt(!1)}}(this._view)}get context(){return null}}const Rc=function(e){return function(e,t,n){if(dt(e)&&!n){const n=Rt(e.index,t);return new Nc(n,n)}return 47&e.type?new Nc(t[16],t):null}(qt(),zt(),16==(16&e))};let Dc=(()=>{class e{}return e.__NG_ELEMENT_ID__=Rc,e})();const Lc=[new bc],Fc=new Ic([new yc]),Uc=new Ac(Lc),Bc=function(){return Hc(qt(),zt())};let Vc=(()=>{class e{}return e.__NG_ELEMENT_ID__=Bc,e})();const $c=Vc,zc=class extends $c{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ls(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vs(t,n,e),new Nc(n)}};function Hc(e,t){return 4&e.type?new zc(t,e,ac(e,t)):null}class Gc{}class qc{}const Wc=function(){return Qc(qt(),zt())};let jc=(()=>{class e{}return e.__NG_ELEMENT_ID__=Wc,e})();const Zc=jc,Yc=class extends Zc{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return ac(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const e=zn(this._hostTNode,this._hostLView);if(xn(e)){const t=Dn(e,this._hostLView),n=Rn(e);return new er(t[1].data[n+8],t)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Kc(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(Gc,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(ut(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new Yc(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-10?(t[4]=n[i],hr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=as(i,s),a=n[11],l=Qi(a,s[7]);return null!==l&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,us(e,r,n,1,i,s)}(r,s[6],a,n,l,o),e.attachToViewContainerRef(),hr(Jc(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Kc(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);n&&(dr(Jc(this._lContainer),t),qi(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);return n&&null!=dr(Jc(this._lContainer),t)?new Nc(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function Kc(e){return e[8]}function Jc(e){return e[8]||(e[8]=[])}function Qc(e,t){let n;const r=t[e.index];if(ut(r))n=r;else{let i;if(8&e.type)i=kt(r);else{const n=t[11];i=n.createComment("");const r=Mt(e,t);Yi(n,Qi(n,r),i,function(e,t){return Tt(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=uo(r,t,i,e),go(t,n)}return new Yc(n,e,t)}const Xc={};class eu extends sc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=at(e);return new ru(t,this.ngModule)}}function tu(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const nu=new or("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ki});class ru extends nc{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ps).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return tu(this.componentDef.inputs)}get outputs(){return tu(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,Xc,i);return s!==Xc||r===Xc?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(hc,It),o=i.get(fc,null),a=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=n?function(e,t,n){if(Tt(e))return e.selectRootElement(t,n===Ue.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):zi(s.createRenderer(null,this.componentDef),l,function(e){const t=e.toLowerCase();return"svg"===t?bt:"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),u=this.componentDef.onPush?576:528,h=function(e,t){return{components:[],scheduler:e||ki,clean:Co,playerHandler:t||null,flags:0}}(),d=Zs(0,null,null,1,0,null,null,null,null,null),p=Ls(null,d,h,u,null,null,s,a,o,i);let f,g;hn(p);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=Fs(o,20,2,"#host",null),l=a.mergedAttrs=t.hostAttrs;null!==l&&(Oo(a,l,!0),null!==e&&(In(i,e,l),null!==a.classes&&ps(i,e,a.classes),null!==a.styles&&ds(i,e,a.styles)));const c=r.createRenderer(e,t),u=Ls(n,js(t),null,t.onPush?64:16,n[20],a,r,c,s||null,null);return o.firstCreatePass&&(Hn(Bn(a,n),o,t.type),to(o,a),ro(a,n.length,1)),go(n,u),n[20]=u}(c,this.componentDef,p,s,a);if(c)if(n)In(a,c,["ng-version",mc.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Cs(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&In(a,c,e),t&&t.length>0&&ps(a,c,t.join(" "))}if(g=Nt(d,20),void 0!==t){const e=g.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}f=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=qt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),io(e,r,t,Bs(e,t,1,null),n));const i=Jn(t,e,r.directiveStart,r);wi(i,t);const s=Mt(r,t);return s&&wi(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=qt();t.contentQueries(1,o,e.directiveStart)}const a=qt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(vn(a.index),Xs(n[1],a,0,a.directiveStart,a.directiveEnd,t),eo(t,o)),o}(e,this.componentDef,p,h,[Ho]),Vs(d,p,null)}finally{mn()}return new iu(this.componentType,f,ac(g,p),p,g)}}class iu extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new xc(r),this.componentType=e}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const su=new Map;class ou extends Gc{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new eu(this);const n=lt(e),r=e[Ye]||null;r&&nl(r),this._bootstrapComponents=Ai(n.bootstrap),this._r3Injector=Ro(e,t,[{provide:Gc,useValue:this},{provide:sc,useValue:this.componentFactoryResolver}],de(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=zo.THROW_IF_NOT_FOUND,n=Ne.Default){return e===zo||e===Gc||e===To?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class au extends qc{constructor(e){super(),this.moduleType=e,null!==lt(e)&&function(e){const t=new Set;!function e(n){const r=lt(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${de(t)} vs ${de(t.name)}`)}(i,su.get(i),n),su.set(i,n));const s=Ai(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new ou(this.moduleType,e)}}function lu(e,t,n){const r=Xt()+e,i=zt();return i[r]===Os?ea(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function cu(e,t,n,r){return pu(zt(),Xt(),e,t,n,r)}function uu(e,t,n,r,i){return fu(zt(),Xt(),e,t,n,r,i)}function hu(e,t,n,r,i,s,o){return function(e,t,n,r,i,s,o,a,l){const c=t+n;return function(e,t,n,r,i,s){const o=na(e,t,n,r);return na(e,t+2,i,s)||o}(e,c,i,s,o,a)?ea(e,c+4,l?r.call(l,i,s,o,a):r(i,s,o,a)):du(e,c+4)}(zt(),Xt(),e,t,n,r,i,s,o)}function du(e,t){const n=e[t];return n===Os?void 0:n}function pu(e,t,n,r,i,s){const o=t+n;return ta(e,o,i)?ea(e,o+1,s?r.call(s,i):r(i)):du(e,o+1)}function fu(e,t,n,r,i,s,o){const a=t+n;return na(e,a,i,s)?ea(e,a+2,o?r.call(o,i,s):r(i,s)):du(e,a+2)}function gu(e,t){const n=Ht();let r;const i=e+20;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new ve("302",`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=mt(r.type)),o=Re(ua);try{const e=Fn(!1),t=s();return Fn(e),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,zt(),i,t),t}finally{Re(o)}}function mu(e,t,n){const r=e+20,i=zt(),s=xt(i,r);return vu(i,yu(i,r)?pu(i,Xt(),t,s.transform,n,s):s.transform(n))}function yu(e,t){return e[1].data[t].pure}function vu(e,t){return Jo.isWrapped(t)&&(t=Jo.unwrap(t),e[en()]=Os),t}function _u(e){return t=>{setTimeout(e,void 0,t)}}const Cu=class extends A{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,i,s;let o=e,l=t||(()=>null),c=n;if(e&&"object"==typeof e){const t=e;o=null===(r=t.next)||void 0===r?void 0:r.bind(t),l=null===(i=t.error)||void 0===i?void 0:i.bind(t),c=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(l=_u(l),o&&(o=_u(o)),c&&(c=_u(c)));const u=super.subscribe({next:o,error:l,complete:c});return e instanceof a&&e.add(u),u}};function Eu(){return this._results[Ko()]()}class wu{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Ko(),n=wu.prototype;n[t]||(n[t]=Eu)}get changes(){return this._changes||(this._changes=new Cu)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=cr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Su{constructor(e){this.queryList=e,this.matches=null}clone(){return new Su(this.queryList)}setDirty(){this.queryList.setDirty()}}class bu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new bu(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==Du(e,t).matches&&this.queries[t].setDirty()}}class Pu{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Ou{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new Ou(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Tu{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Tu(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,Iu(t,i)),this.matchTNodeWithReadOption(e,t,Kn(t,e,i,!1,!1))}else n===Vc?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kn(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===cc||r===jc||r===Vc&&4&t.type)this.addMatch(t.index,-2);else{const n=Kn(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function Iu(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function ku(e,t,n,r){return-1===n?function(e,t){return 11&e.type?ac(e,t):4&e.type?Hc(e,t):null}(t,e):-2===n?function(e,t,n){return n===cc?ac(t,e):n===Vc?Hc(t,e):n===jc?Qc(t,e):void 0}(e,t,r):Jn(e,e[1],n,t)}function Au(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,s=n.matches,o=[];for(let e=0;e<s.length;e+=2){const i=s[e];o.push(i<0?null:ku(t,r[i],s[e+1],n.metadata.read))}i.matches=o}return i.matches}function Mu(e,t,n,r){const i=e.queries.getByIndex(n),s=i.matches;if(null!==s){const o=Au(e,t,i,n);for(let e=0;e<s.length;e+=2){const n=s[e];if(n>0)r.push(o[e/2]);else{const i=s[e+1],o=t[-n];for(let e=10;e<o.length;e++){const t=o[e];t[17]===t[3]&&Mu(t[1],t,i,r)}if(null!==o[9]){const e=o[9];for(let t=0;t<e.length;t++){const n=e[t];Mu(n[1],n,i,r)}}}}}return r}function Nu(e){const t=zt(),n=Ht(),r=an();ln(r+1);const i=Du(n,r);if(e.dirty&&Dt(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?Mu(n,t,r,[]):Au(n,t,i,r);e.reset(s,uc),e.notifyOnChanges()}return!0}return!1}function xu(e,t,n){const r=Ht();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Ou),e.queries.track(new Tu(t,n))}(r,new Pu(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){const r=new wu(4==(4&n));Ys(e,t,r,r.destroy),null===t[19]&&(t[19]=new bu),t[19].queries.push(new Su(r))}(r,zt(),t)}function Ru(){return e=zt(),t=an(),e[19].queries[t].queryList;var e,t}function Du(e,t){return e.queries.getByIndex(t)}function Lu(e,t){return Hc(e,t)}const Fu=new or("Application Initializer");let Uu=(()=>{class e{constructor(e){this.appInits=e,this.resolve=oc,this.reject=oc,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(_a(t))e.push(t);else if(Ca(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(Fu,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Bu=new or("AppId"),Vu={provide:Bu,useFactory:function(){return`${$u()}${$u()}${$u()}`},deps:[]};function $u(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const zu=new or("Platform Initializer"),Hu=new or("Platform ID"),Gu=new or("appBootstrapListener");let qu=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Wu=new or("LocaleId"),ju=new or("DefaultCurrencyCode");class Zu{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Yu=function(e){return new au(e)},Ku=Yu,Ju=function(e){return Promise.resolve(Yu(e))},Qu=function(e){const t=Yu(e),n=Ai(lt(e).declarations).reduce((e,t)=>{const n=at(t);return n&&e.push(new ru(n)),e},[]);return new Zu(t,n)},Xu=Qu,eh=function(e){return Promise.resolve(Qu(e))};let th=(()=>{class e{constructor(){this.compileModuleSync=Ku,this.compileModuleAsync=Ju,this.compileModuleAndAllComponentsSync=Xu,this.compileModuleAndAllComponentsAsync=eh}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const nh=(()=>Promise.resolve(0))();function rh(e){"undefined"==typeof Zone?nh.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ih{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Cu(!1),this.onMicrotaskEmpty=new Cu(!1),this.onStable=new Cu(!1),this.onError=new Cu(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ze,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,ah(e),e.isCheckStableRunning=!0,oh(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),ah(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return lh(e),n.invokeTask(i,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),ch(e)}},onInvoke:(n,r,i,s,o,a,l)=>{try{return lh(e),n.invoke(i,s,o,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),ch(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,ah(e),oh(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ih.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ih.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,sh,oc,oc);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const sh={};function oh(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function ah(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function lh(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ch(e){e._nesting--,oh(e)}class uh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Cu,this.onMicrotaskEmpty=new Cu,this.onStable=new Cu,this.onError=new Cu}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let hh=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ih.assertNotInAngularZone(),rh(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())rh(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Or(ih))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),dh=(()=>{class e{constructor(){this._applications=new Map,fh.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return fh.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class ph{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let fh=new ph,gh=!0,mh=!1;let yh;const vh=new or("AllowMultipleToken");class _h{constructor(e,t){this.name=e,this.token=t}}function Ch(e,t,n=[]){const r=`Platform: ${t}`,i=new or(r);return(t=[])=>{let s=Eh();if(!s||s.injector.get(vh,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:ko,useValue:"platform"});!function(e){if(yh&&!yh.destroyed&&!yh.injector.get(vh,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");yh=e.get(wh);const t=e.get(zu,null);t&&t.forEach(e=>e())}(zo.create({providers:e,name:r}))}return function(e){const t=Eh();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Eh(){return yh&&!yh.destroyed?yh:null}let wh=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new uh:("zone.js"===e?void 0:e)||new ih({enableLongStackTrace:(mh=!0,gh),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:ih,useValue:n}];return n.run(()=>{const i=zo.create({providers:r,parent:this.injector,name:e.moduleType.name}),s=e.create(i),o=s.injector.get(Oi,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});s.onDestroy(()=>{Ph(this._modules,s),e.unsubscribe()})}),function(e,n,r){try{const t=r();return _a(t)?t.catch(t=>{throw n.runOutsideAngular(()=>e.handleError(t)),t}):t}catch(t){throw n.runOutsideAngular(()=>e.handleError(t)),t}}(o,n,()=>{const e=s.injector.get(Uu);return e.runInitializers(),e.donePromise.then(()=>(nl(s.injector.get(Wu,Ja)||Ja),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const n=Sh({},t);return function(e,t,n){const r=new au(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(bh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${de(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Sh(e,t){return Array.isArray(t)?t.reduce(Sh,e):Object.assign(Object.assign({},e),t)}let bh=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new T(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),o=new T(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{ih.assertNotInAngularZone(),rh(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{ih.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){const t=re(e),n=function(e,t){return"number"==typeof te(e)?e.pop():1/0}(e),r=e;return r.length?1===r.length?Y(r[0]):X(n)(ae(r,t)):ee}(s,o.pipe(function(e={}){const{connector:t=(()=>new A),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return e=>{let s=null,o=null,a=null,l=0,c=!1,u=!1;const h=()=>{null==o||o.unsubscribe(),o=null},d=()=>{h(),s=a=null,c=u=!1},p=()=>{const e=s;d(),null==e||e.unsubscribe()};return x((e,f)=>{l++,!u&&!c&&h();const g=a=a??t();f.add(()=>{l--,0===l&&!u&&!c&&(o=ce(p,i))}),g.subscribe(f),s||(s=new C({next:e=>g.next(e),error:e=>{u=!0,h(),o=ce(d,n,e),g.error(e)},complete:()=>{c=!0,h(),o=ce(d,r),g.complete()}}),ae(e).subscribe(s))})(e)}}()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof nc?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(Gc),i=n.create(zo.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(hh,null),a=o&&i.injector.get(dh);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),Ph(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Ph(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Gu,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Or(ih),Or(zo),Or(Oi),Or(sc),Or(Uu))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Ph(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Oh{}class Th{}const Ih={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let kh=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||Ih}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>Ah(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>Ah(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Or(th),Or(Th,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Ah(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const Mh=Ch(null,"core",[{provide:Hu,useValue:"unknown"},{provide:wh,deps:[zo]},{provide:dh,deps:[]},{provide:qu,deps:[]}]),Nh=[{provide:bh,useClass:bh,deps:[ih,zo,Oi,sc,Uu]},{provide:nu,deps:[ih],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Uu,useClass:Uu,deps:[[new Nr,Fu]]},{provide:th,useClass:th,deps:[]},Vu,{provide:Ic,useFactory:function(){return Fc},deps:[]},{provide:Ac,useFactory:function(){return Uc},deps:[]},{provide:Wu,useFactory:function(e){return nl(e=e||"undefined"!=typeof $localize&&$localize.locale||Ja),e},deps:[[new Mr(Wu),new Nr,new xr]]},{provide:ju,useValue:"USD"}];let xh=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Or(bh))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:Nh}),e})(),Rh=null;function Dh(){return Rh}const Lh=new or("DocumentToken");let Fh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:Uh,token:e,providedIn:"platform"}),e})();function Uh(){return Or(Vh)}const Bh=new or("Location Initialized");let Vh=(()=>{class e extends Fh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dh().getBaseHref(this._doc)}onPopState(e){const t=Dh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=Dh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){$h()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){$h()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh))},e.\u0275prov=Se({factory:zh,token:e,providedIn:"platform"}),e})();function $h(){return!!window.history.pushState}function zh(){return new Vh(Or(Lh))}function Hh(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Gh(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function qh(e){return e&&"?"!==e[0]?"?"+e:e}let Wh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:jh,token:e,providedIn:"root"}),e})();function jh(e){const t=Or(Lh).location;return new Yh(Or(Fh),t&&t.origin||"")}const Zh=new or("appBaseHref");let Yh=(()=>{class e extends Wh{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Hh(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+qh(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+qh(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+qh(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Fh),Or(Zh,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Kh=(()=>{class e extends Wh{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=Hh(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+qh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+qh(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Fh),Or(Zh,8))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Jh=(()=>{class e{constructor(e,t){this._subject=new Cu,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=Gh(Xh(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+qh(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Xh(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+qh(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+qh(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Or(Wh),Or(Fh))},e.normalizeQueryParams=qh,e.joinWithSlash=Hh,e.stripTrailingSlash=Gh,e.\u0275prov=Se({factory:Qh,token:e,providedIn:"root"}),e})();function Qh(){return new Jh(Or(Wh),Or(Fh))}function Xh(e){return e.replace(/\/index.html$/,"")}var ed=(()=>((ed=ed||{})[ed.Decimal=0]="Decimal",ed[ed.Percent=1]="Percent",ed[ed.Currency=2]="Currency",ed[ed.Scientific=3]="Scientific",ed))(),td=(()=>((td=td||{})[td.Zero=0]="Zero",td[td.One=1]="One",td[td.Two=2]="Two",td[td.Few=3]="Few",td[td.Many=4]="Many",td[td.Other=5]="Other",td))(),nd=(()=>((nd=nd||{})[nd.Format=0]="Format",nd[nd.Standalone=1]="Standalone",nd))(),rd=(()=>((rd=rd||{})[rd.Narrow=0]="Narrow",rd[rd.Abbreviated=1]="Abbreviated",rd[rd.Wide=2]="Wide",rd[rd.Short=3]="Short",rd))(),id=(()=>((id=id||{})[id.Short=0]="Short",id[id.Medium=1]="Medium",id[id.Long=2]="Long",id[id.Full=3]="Full",id))(),sd=(()=>((sd=sd||{})[sd.Decimal=0]="Decimal",sd[sd.Group=1]="Group",sd[sd.List=2]="List",sd[sd.PercentSign=3]="PercentSign",sd[sd.PlusSign=4]="PlusSign",sd[sd.MinusSign=5]="MinusSign",sd[sd.Exponential=6]="Exponential",sd[sd.SuperscriptingExponent=7]="SuperscriptingExponent",sd[sd.PerMille=8]="PerMille",sd[sd.Infinity=9]="Infinity",sd[sd.NaN=10]="NaN",sd[sd.TimeSeparator=11]="TimeSeparator",sd[sd.CurrencyDecimal=12]="CurrencyDecimal",sd[sd.CurrencyGroup=13]="CurrencyGroup",sd))();function od(e,t){return dd(Wa(e)[Ya.DateFormat],t)}function ad(e,t){return dd(Wa(e)[Ya.TimeFormat],t)}function ld(e,t){return dd(Wa(e)[Ya.DateTimeFormat],t)}function cd(e,t){const n=Wa(e),r=n[Ya.NumberSymbols][t];if(void 0===r){if(t===sd.CurrencyDecimal)return n[Ya.NumberSymbols][sd.Decimal];if(t===sd.CurrencyGroup)return n[Ya.NumberSymbols][sd.Group]}return r}const ud=ja;function hd(e){if(!e[Ya.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[Ya.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function dd(e,t){for(let n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function pd(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const fd=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,gd={},md=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var yd=(()=>((yd=yd||{})[yd.Short=0]="Short",yd[yd.ShortGMT=1]="ShortGMT",yd[yd.Long=2]="Long",yd[yd.Extended=3]="Extended",yd))(),vd=(()=>((vd=vd||{})[vd.FullYear=0]="FullYear",vd[vd.Month=1]="Month",vd[vd.Date=2]="Date",vd[vd.Hours=3]="Hours",vd[vd.Minutes=4]="Minutes",vd[vd.Seconds=5]="Seconds",vd[vd.FractionalSeconds=6]="FractionalSeconds",vd[vd.Day=7]="Day",vd))(),_d=(()=>((_d=_d||{})[_d.DayPeriods=0]="DayPeriods",_d[_d.Days=1]="Days",_d[_d.Months=2]="Months",_d[_d.Eras=3]="Eras",_d))();function Cd(e,t,n,r){let i=function(e){if(xd(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[t,n=1,r=1]=e.split("-").map(e=>+e);return Ed(t,n-1,r)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let n;if(n=e.match(fd))return function(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,s=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const o=Number(e[4]||0)-n,a=Number(e[5]||0)-r,l=Number(e[6]||0),c=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return s.call(t,o,a,l,c),t}(n)}const t=new Date(e);if(!xd(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=wd(n,t)||t;let s,o=[];for(;t;){if(s=md.exec(t),!s){o.push(t);break}{o=o.concat(s.slice(1));const e=o.pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();r&&(a=Nd(r,a),i=function(e,t,n){const r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(Nd(t,r)-r))}(i,r));let l="";return o.forEach(e=>{const t=function(e){if(Md[e])return Md[e];let t;switch(e){case"G":case"GG":case"GGG":t=Od(_d.Eras,rd.Abbreviated);break;case"GGGG":t=Od(_d.Eras,rd.Wide);break;case"GGGGG":t=Od(_d.Eras,rd.Narrow);break;case"y":t=Pd(vd.FullYear,1,0,!1,!0);break;case"yy":t=Pd(vd.FullYear,2,0,!0,!0);break;case"yyy":t=Pd(vd.FullYear,3,0,!1,!0);break;case"yyyy":t=Pd(vd.FullYear,4,0,!1,!0);break;case"Y":t=Ad(1);break;case"YY":t=Ad(2,!0);break;case"YYY":t=Ad(3);break;case"YYYY":t=Ad(4);break;case"M":case"L":t=Pd(vd.Month,1,1);break;case"MM":case"LL":t=Pd(vd.Month,2,1);break;case"MMM":t=Od(_d.Months,rd.Abbreviated);break;case"MMMM":t=Od(_d.Months,rd.Wide);break;case"MMMMM":t=Od(_d.Months,rd.Narrow);break;case"LLL":t=Od(_d.Months,rd.Abbreviated,nd.Standalone);break;case"LLLL":t=Od(_d.Months,rd.Wide,nd.Standalone);break;case"LLLLL":t=Od(_d.Months,rd.Narrow,nd.Standalone);break;case"w":t=kd(1);break;case"ww":t=kd(2);break;case"W":t=kd(1,!0);break;case"d":t=Pd(vd.Date,1);break;case"dd":t=Pd(vd.Date,2);break;case"c":case"cc":t=Pd(vd.Day,1);break;case"ccc":t=Od(_d.Days,rd.Abbreviated,nd.Standalone);break;case"cccc":t=Od(_d.Days,rd.Wide,nd.Standalone);break;case"ccccc":t=Od(_d.Days,rd.Narrow,nd.Standalone);break;case"cccccc":t=Od(_d.Days,rd.Short,nd.Standalone);break;case"E":case"EE":case"EEE":t=Od(_d.Days,rd.Abbreviated);break;case"EEEE":t=Od(_d.Days,rd.Wide);break;case"EEEEE":t=Od(_d.Days,rd.Narrow);break;case"EEEEEE":t=Od(_d.Days,rd.Short);break;case"a":case"aa":case"aaa":t=Od(_d.DayPeriods,rd.Abbreviated);break;case"aaaa":t=Od(_d.DayPeriods,rd.Wide);break;case"aaaaa":t=Od(_d.DayPeriods,rd.Narrow);break;case"b":case"bb":case"bbb":t=Od(_d.DayPeriods,rd.Abbreviated,nd.Standalone,!0);break;case"bbbb":t=Od(_d.DayPeriods,rd.Wide,nd.Standalone,!0);break;case"bbbbb":t=Od(_d.DayPeriods,rd.Narrow,nd.Standalone,!0);break;case"B":case"BB":case"BBB":t=Od(_d.DayPeriods,rd.Abbreviated,nd.Format,!0);break;case"BBBB":t=Od(_d.DayPeriods,rd.Wide,nd.Format,!0);break;case"BBBBB":t=Od(_d.DayPeriods,rd.Narrow,nd.Format,!0);break;case"h":t=Pd(vd.Hours,1,-12);break;case"hh":t=Pd(vd.Hours,2,-12);break;case"H":t=Pd(vd.Hours,1);break;case"HH":t=Pd(vd.Hours,2);break;case"m":t=Pd(vd.Minutes,1);break;case"mm":t=Pd(vd.Minutes,2);break;case"s":t=Pd(vd.Seconds,1);break;case"ss":t=Pd(vd.Seconds,2);break;case"S":t=Pd(vd.FractionalSeconds,1);break;case"SS":t=Pd(vd.FractionalSeconds,2);break;case"SSS":t=Pd(vd.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Td(yd.Short);break;case"ZZZZZ":t=Td(yd.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Td(yd.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Td(yd.Long);break;default:return null}return Md[e]=t,t}(e);l+=t?t(i,n,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function Ed(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function wd(e,t){const n=function(e){return Wa(e)[Ya.LocaleId]}(e);if(gd[n]=gd[n]||{},gd[n][t])return gd[n][t];let r="";switch(t){case"shortDate":r=od(e,id.Short);break;case"mediumDate":r=od(e,id.Medium);break;case"longDate":r=od(e,id.Long);break;case"fullDate":r=od(e,id.Full);break;case"shortTime":r=ad(e,id.Short);break;case"mediumTime":r=ad(e,id.Medium);break;case"longTime":r=ad(e,id.Long);break;case"fullTime":r=ad(e,id.Full);break;case"short":const t=wd(e,"shortTime"),n=wd(e,"shortDate");r=Sd(ld(e,id.Short),[t,n]);break;case"medium":const i=wd(e,"mediumTime"),s=wd(e,"mediumDate");r=Sd(ld(e,id.Medium),[i,s]);break;case"long":const o=wd(e,"longTime"),a=wd(e,"longDate");r=Sd(ld(e,id.Long),[o,a]);break;case"full":const l=wd(e,"fullTime"),c=wd(e,"fullDate");r=Sd(ld(e,id.Full),[l,c])}return r&&(gd[n][t]=r),r}function Sd(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function bd(e,t,n="-",r,i){let s="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,s=n));let o=String(e);for(;o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),s+o}function Pd(e,t,n=0,r=!1,i=!1){return function(s,o){let a=function(e,t){switch(e){case vd.FullYear:return t.getFullYear();case vd.Month:return t.getMonth();case vd.Date:return t.getDate();case vd.Hours:return t.getHours();case vd.Minutes:return t.getMinutes();case vd.Seconds:return t.getSeconds();case vd.FractionalSeconds:return t.getMilliseconds();case vd.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,s);if((n>0||a>-n)&&(a+=n),e===vd.Hours)0===a&&-12===n&&(a=12);else if(e===vd.FractionalSeconds)return function(e,t){return bd(e,3).substr(0,t)}(a,t);const l=cd(o,sd.MinusSign);return bd(a,t,l,r,i)}}function Od(e,t,n=nd.Format,r=!1){return function(i,s){return function(e,t,n,r,i,s){switch(n){case _d.Months:return function(e,t,n){const r=Wa(e),i=dd([r[Ya.MonthsFormat],r[Ya.MonthsStandalone]],t);return dd(i,n)}(t,i,r)[e.getMonth()];case _d.Days:return function(e,t,n){const r=Wa(e),i=dd([r[Ya.DaysFormat],r[Ya.DaysStandalone]],t);return dd(i,n)}(t,i,r)[e.getDay()];case _d.DayPeriods:const o=e.getHours(),a=e.getMinutes();if(s){const e=function(e){const t=Wa(e);return hd(t),(t[Ya.ExtraData][2]||[]).map(e=>"string"==typeof e?pd(e):[pd(e[0]),pd(e[1])])}(t),n=function(e,t,n){const r=Wa(e);hd(r);const i=dd([r[Ya.ExtraData][0],r[Ya.ExtraData][1]],t)||[];return dd(i,n)||[]}(t,i,r),s=e.findIndex(e=>{if(Array.isArray(e)){const[t,n]=e,r=o>=t.hours&&a>=t.minutes,i=o<n.hours||o===n.hours&&a<n.minutes;if(t.hours<n.hours){if(r&&i)return!0}else if(r||i)return!0}else if(e.hours===o&&e.minutes===a)return!0;return!1});if(-1!==s)return n[s]}return function(e,t,n){const r=Wa(e),i=dd([r[Ya.DayPeriodsFormat],r[Ya.DayPeriodsStandalone]],t);return dd(i,n)}(t,i,r)[o<12?0:1];case _d.Eras:return function(e,t){return dd(Wa(e)[Ya.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,s,e,t,n,r)}}function Td(e){return function(t,n,r){const i=-1*r,s=cd(n,sd.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case yd.Short:return(i>=0?"+":"")+bd(o,2,s)+bd(Math.abs(i%60),2,s);case yd.ShortGMT:return"GMT"+(i>=0?"+":"")+bd(o,1,s);case yd.Long:return"GMT"+(i>=0?"+":"")+bd(o,2,s)+":"+bd(Math.abs(i%60),2,s);case yd.Extended:return 0===r?"Z":(i>=0?"+":"")+bd(o,2,s)+":"+bd(Math.abs(i%60),2,s);default:throw new Error(`Unknown zone width "${e}"`)}}}function Id(e){return Ed(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function kd(e,t=!1){return function(n,r){let i;if(t){const e=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,t=n.getDate();i=1+Math.floor((t+e)/7)}else{const e=Id(n),t=function(e){const t=Ed(e,0,1).getDay();return Ed(e,0,1+(t<=4?4:11)-t)}(e.getFullYear()),r=e.getTime()-t.getTime();i=1+Math.round(r/6048e5)}return bd(i,e,cd(r,sd.MinusSign))}}function Ad(e,t=!1){return function(n,r){return bd(Id(n).getFullYear(),e,cd(r,sd.MinusSign),t)}}const Md={};function Nd(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function xd(e){return e instanceof Date&&!isNaN(e.valueOf())}const Rd=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Dd(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class Ld{}let Fd=(()=>{class e extends Ld{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(ud(t||this.locale)(e)){case td.Zero:return"zero";case td.One:return"one";case td.Two:return"two";case td.Few:return"few";case td.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Or(Wu))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function Ud(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let Bd=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Qo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${de(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(ua(Ic),ua(Ac),ua(cc),ua(dc))},e.\u0275dir=st({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class Vd{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let $d=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch{throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new Vd(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new zd(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new zd(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(jc),ua(Vc),ua(Ic))},e.\u0275dir=st({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class zd{constructor(e,t){this.record=e,this.view=t}}let Hd=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new Gd,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){qd("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){qd("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(jc),ua(Vc))},e.\u0275dir=st({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class Gd{constructor(){this.$implicit=null,this.ngIf=null}}function qd(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${de(t)}'.`)}let Wd=(()=>{class e{constructor(e){this._locale=e}transform(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,s,o=!1){let a="",l=!1;if(isFinite(e)){let c=function(e){let t,n,r,i,s,o=Math.abs(e)+"",a=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(s=o.length))t=[0],n=1;else{for(s--;"0"===o.charAt(s);)s--;for(n-=r,t=[],i=0;r<=s;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),a=n-1,n=1),{digits:t,exponent:a,integerLen:n}}(e);o&&(c=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(c));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(s){const e=s.match(Rd);if(null===e)throw new Error(`${s} is not a valid digit info`);const t=e[1],n=e[3],r=e[5];null!=t&&(u=Dd(t)),null!=n&&(h=Dd(n)),null!=r?d=Dd(r):null!=n&&h>d&&(d=h)}!function(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let o=s+e.integerLen,a=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(let e=o;e<r.length;e++)r[e]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let e=1;e<o;e++)r[e]=0}if(a>=5)if(o-1<0){for(let t=0;t>o;t--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let l=0!==s;const c=t+e.integerLen,u=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,l&&(0===r[n]&&n>=c?r.pop():l=!1),t>=10?1:0},0);u&&(r.unshift(u),e.integerLen++)}(c,h,d);let p=c.digits,f=c.integerLen;const g=c.exponent;let m=[];for(l=p.every(e=>!e);f<u;f++)p.unshift(0);for(;f<0;f++)p.unshift(0);f>0?m=p.splice(f,p.length):(m=p,p=[0]);const y=[];for(p.length>=t.lgSize&&y.unshift(p.splice(-t.lgSize,p.length).join(""));p.length>t.gSize;)y.unshift(p.splice(-t.gSize,p.length).join(""));p.length&&y.unshift(p.join("")),a=y.join(cd(n,r)),m.length&&(a+=cd(n,i)+m.join("")),g&&(a+=cd(n,sd.Exponential)+"+"+g)}else a=cd(n,sd.Infinity);return a=e<0&&!l?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf,a}(e,function(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=o[0],l=o[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<l.length;u++){const e=l.charAt(u);"0"===e?n.minFrac=n.maxFrac=u+1:"#"===e?n.maxFrac=u+1:n.posSuf+=e}const c=a.split(",");if(n.gSize=c[1]?c[1].length:0,n.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,s){const e=i.length-n.posPre.length-n.posSuf.length,t=s.indexOf("#");n.negPre=s.substr(0,t).replace(/'/g,""),n.negSuf=s.substr(t+e).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return Wa(e)[Ya.NumberFormats][t]}(t,ed.Decimal),cd(t,sd.MinusSign)),t,sd.Group,sd.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),r,n)}catch(i){throw function(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${de(e)}'`)}(e,i.message)}}}return e.\u0275fac=function(t){return new(t||e)(ua(Wu,16))},e.\u0275pipe=ot({name:"number",type:e,pure:!0}),e})();let jd=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[{provide:Ld,useClass:Fd}]}),e})();let Zd=(()=>{class e{}return e.\u0275prov=Se({token:e,providedIn:"root",factory:()=>new Yd(Or(Lh),window)}),e})();class Yd{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Kd(this.window.history)||Kd(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Kd(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Jd{}class Qd extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new Qd,Rh||(Rh=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(ep=ep||document.querySelector("base"),ep?ep.getAttribute("href"):null);return null==t?null:function(e){Xd=Xd||document.createElement("a"),Xd.setAttribute("href",e);const t=Xd.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){ep=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Ud(document.cookie,e)}}let Xd,ep=null;const tp=new or("TRANSITION_ID"),np=[{provide:Fu,useFactory:function(e,t,n){return()=>{n.get(Uu).donePromise.then(()=>{const n=Dh(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let e=0;e<r.length;e++)n.remove(r[e])})}},deps:[tp,Lh,zo],multi:!0}];class rp{static init(){var e;e=new rp,fh=e}addToWindow(e){ze.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),ze.getAllAngularRootElements=()=>e.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(e=>{const t=ze.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){return null==t?null:e.getTestability(t)??(n?Dh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}let ip=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const sp=new or("EventManagerPlugins");let op=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Or(sp),Or(ih))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class ap{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=Dh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let lp=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),cp=(()=>{class e extends lp{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(up),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(up))}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function up(e){Dh().remove(e)}const hp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},dp=/%COMP%/g;function pp(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?pp(e,i,n):(i=i.replace(dp,e),n.push(i))}return n}function fp(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let gp=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new mp(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Ue.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new yp(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Ue.ShadowDom:return new vp(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=pp(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Or(op),Or(cp),Or(Bu))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class mp{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(hp[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=hp[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=hp[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(Mi.DashCase|Mi.Important)?e.style.setProperty(t,n,r&Mi.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Mi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,fp(n)):this.eventManager.addEventListener(e,t,fp(n))}}class yp extends mp{constructor(e,t,n,r){super(e),this.component=n;const i=pp(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(dp,r+"-"+n.id),this.hostAttr=function(e){return"_nghost-%COMP%".replace(dp,e)}(r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class vp extends mp{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=pp(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let _p=(()=>{class e extends ap{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Cp=["alt","control","meta","shift"],Ep={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},wp={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Sp={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let bp=(()=>{class e extends ap{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Dh().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(Cp.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&wp.hasOwnProperty(t)&&(t=wp[t]))}return Ep[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),Cp.forEach(r=>{r!=n&&Sp[r](e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Pp=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:function(){return Or(Op)},token:e,providedIn:"root"}),e})(),Op=(()=>{class e extends Pp{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case yi.NONE:return t;case yi.HTML:return qr(t,"HTML")?Gr(t):gi(this._doc,String(t)).toString();case yi.STYLE:return qr(t,"Style")?Gr(t):t;case yi.SCRIPT:if(qr(t,"Script"))return Gr(t);throw new Error("unsafe value used in a script context");case yi.URL:return Wr(t),qr(t,"URL")?Gr(t):Qr(String(t));case yi.RESOURCE_URL:if(qr(t,"ResourceURL"))return Gr(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(e){return new Br(e)}(e)}bypassSecurityTrustStyle(e){return function(e){return new Vr(e)}(e)}bypassSecurityTrustScript(e){return function(e){return new $r(e)}(e)}bypassSecurityTrustUrl(e){return function(e){return new zr(e)}(e)}bypassSecurityTrustResourceUrl(e){return function(e){return new Hr(e)}(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh))},e.\u0275prov=Se({factory:function(){return function(e){return new Op(e.get(Lh))}(Or(To))},token:e,providedIn:"root"}),e})();const Tp=Ch(Mh,"browser",[{provide:Hu,useValue:"browser"},{provide:zu,useValue:function(){Qd.makeCurrent(),rp.init()},multi:!0},{provide:Lh,useFactory:function(){return e=document,Pt=e,document;var e},deps:[]}]),Ip=[[],{provide:ko,useValue:"root"},{provide:Oi,useFactory:function(){return new Oi},deps:[]},{provide:sp,useClass:_p,multi:!0,deps:[Lh,ih,Hu]},{provide:sp,useClass:bp,multi:!0,deps:[Lh]},[],{provide:gp,useClass:gp,deps:[op,cp,Bu]},{provide:hc,useExisting:gp},{provide:lp,useExisting:cp},{provide:cp,useClass:cp,deps:[Lh]},{provide:hh,useClass:hh,deps:[ih]},{provide:op,useClass:op,deps:[sp,ih]},{provide:Jd,useClass:ip,deps:[]},[]];let kp=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:Bu,useValue:t.appId},{provide:tp,useExisting:Bu},np]}}}return e.\u0275fac=function(t){return new(t||e)(Or(e,12))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:Ip,imports:[jd,xh]}),e})();"undefined"!=typeof window&&window;const{isArray:Ap}=Array,{getPrototypeOf:Mp,prototype:Np,keys:xp}=Object;function Rp(e){if(1===e.length){const t=e[0];if(Ap(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&Mp(e)===Np}(t)){const e=xp(t);return{args:e.map(e=>t[e]),keys:e}}}return{args:e,keys:null}}const{isArray:Dp}=Array;function Lp(e){return D(t=>function(e,t){return Dp(t)?e(...t):e(t)}(e,t))}function Fp(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}let Up=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(ua(dc),ua(cc))},e.\u0275dir=st({type:e}),e})(),Bp=(()=>{class e extends Up{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();const Vp=new or("NgValueAccessor"),$p={provide:Vp,useExisting:ge(()=>Hp),multi:!0},zp=new or("CompositionEventMode");let Hp=(()=>{class e extends Up{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=Dh()?Dh().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(dc),ua(cc),ua(zp,8))},e.\u0275dir=st({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&Ea("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[tc([$p]),Go]}),e})();function Gp(e){return null==e||0===e.length}function qp(e){return null!=e&&"number"==typeof e.length}const Wp=new or("NgValidators"),jp=new or("NgAsyncValidators"),Zp=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Yp{static min(e){return function(e){return t=>{if(Gp(t.value)||Gp(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(e)}static max(e){return function(e){return t=>{if(Gp(t.value)||Gp(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(e)}static required(e){return Kp(e)}static requiredTrue(e){return function(e){return!0===e.value?null:{required:!0}}(e)}static email(e){return function(e){return Gp(e.value)||Zp.test(e.value)?null:{email:!0}}(e)}static minLength(e){return function(e){return t=>Gp(t.value)||!qp(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(e)}static maxLength(e){return Jp(e)}static pattern(e){return function(e){if(!e)return Qp;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(Gp(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return sf(e)}static composeAsync(e){return af(e)}}function Kp(e){return Gp(e.value)?{required:!0}:null}function Jp(e){return t=>qp(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function Qp(e){return null}function Xp(e){return null!=e}function ef(e){const t=_a(e)?ae(e):e;return Ca(t),t}function tf(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function nf(e,t){return t.map(t=>t(e))}function rf(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function sf(e){if(!e)return null;const t=e.filter(Xp);return 0==t.length?null:function(e){return tf(nf(e,t))}}function of(e){return null!=e?sf(rf(e)):null}function af(e){if(!e)return null;const t=e.filter(Xp);return 0==t.length?null:function(e){return function(...e){const t=ne(e),{args:n,keys:r}=Rp(e),i=new T(e=>{const{length:t}=n;if(!t)return void e.complete();const i=new Array(t);let s=t,o=t;for(let a=0;a<t;a++){let t=!1;Y(n[a]).subscribe(new R(e,e=>{t||(t=!0,o--),i[a]=e},()=>s--,void 0,()=>{(!s||!t)&&(o||e.next(r?Fp(r,i):i),e.complete())}))}});return t?i.pipe(Lp(t)):i}(nf(e,t).map(ef)).pipe(D(tf))}}function lf(e){return null!=e?af(rf(e)):null}function cf(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function uf(e){return e._rawValidators}function hf(e){return e._rawAsyncValidators}function df(e){return e?Array.isArray(e)?e:[e]:[]}function pf(e,t){return Array.isArray(e)?e.includes(t):e===t}function ff(e,t){const n=df(t);return df(e).forEach(e=>{pf(n,e)||n.push(e)}),n}function gf(e,t){return df(t).filter(t=>!pf(e,t))}let mf=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=of(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=lf(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e}),e})(),yf=(()=>{class e extends mf{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();class vf extends mf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class _f{constructor(e){this._cd=e}is(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}let Cf=(()=>{class e extends _f{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(vf,2))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Na("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[Go]}),e})(),Ef=(()=>{class e extends _f{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(yf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&Na("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[Go]}),e})();function wf(e,t){return[...t.path,e]}function Sf(e,t){Of(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&If(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&If(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function bf(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),Tf(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Pf(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Of(e,t){const n=uf(e);null!==t.validator?e.setValidators(cf(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=hf(e);null!==t.asyncValidator?e.setAsyncValidators(cf(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();Pf(t._rawValidators,i),Pf(t._rawAsyncValidators,i)}function Tf(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=uf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=hf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return Pf(t._rawValidators,r),Pf(t._rawAsyncValidators,r),n}function If(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function kf(e,t){Of(e,t)}function Af(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function Mf(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function Nf(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===Hp?n=e:function(e){return Object.getPrototypeOf(e.constructor)===Bp}(e)?r=e:i=e}),i||r||n||null}function xf(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Rf="VALID",Df="INVALID",Lf="PENDING",Ff="DISABLED";function Uf(e){return(zf(e)?e.validators:e)||null}function Bf(e){return Array.isArray(e)?of(e):e||null}function Vf(e,t){return(zf(t)?t.asyncValidators:e)||null}function $f(e){return Array.isArray(e)?lf(e):e||null}function zf(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class Hf{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Bf(this._rawValidators),this._composedAsyncValidatorFn=$f(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Rf}get invalid(){return this.status===Df}get pending(){return this.status==Lf}get disabled(){return this.status===Ff}get enabled(){return this.status!==Ff}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Bf(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=$f(e)}addValidators(e){this.setValidators(ff(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(ff(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(gf(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(gf(e,this._rawAsyncValidators))}hasValidator(e){return pf(this._rawValidators,e)}hasAsyncValidator(e){return pf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Lf,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ff,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Rf,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Rf||this.status===Lf)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ff:Rf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Lf,this._hasOwnPendingAsyncValidator=!0;const t=ef(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;let r=e;return t.forEach(e=>{r=r instanceof qf?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof Wf&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Cu,this.statusChanges=new Cu}_calculateStatus(){return this._allControlsDisabled()?Ff:this.errors?Df:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Lf)?Lf:this._anyControlsHaveStatus(Df)?Df:Rf}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){zf(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Gf extends Hf{constructor(e=null,t,n){super(Uf(t),Vf(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){xf(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){xf(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class qf extends Hf{constructor(e,t,n){super(Uf(t),Vf(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof Gf?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class Wf extends Hf{constructor(e,t,n){super(Uf(t),Vf(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof Gf?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const jf={provide:yf,useExisting:ge(()=>Yf)},Zf=(()=>Promise.resolve(null))();let Yf=(()=>{class e extends yf{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new Cu,this.form=new qf({},of(e),lf(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Zf.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Sf(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Zf.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),xf(this._directives,e)})}addFormGroup(e){Zf.then(()=>{const t=this._findContainer(e.path),n=new qf({});kf(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Zf.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){Zf.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,Mf(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(ua(Wp,10),ua(jp,10))},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[tc([jf]),Go]}),e})();const Kf={provide:vf,useExisting:ge(()=>Qf)},Jf=(()=>Promise.resolve(null))();let Qf=(()=>{class e extends vf{constructor(e,t,n,r){super(),this.control=new Gf,this._registered=!1,this.update=new Cu,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Nf(0,r)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),Af(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?wf(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Sf(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){Jf.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,n=""===t||t&&"false"!==t;Jf.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(ua(yf,9),ua(Wp,10),ua(jp,10),ua(Vp,10))},e.\u0275dir=st({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[tc([Kf]),Go,vt]}),e})(),Xf=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),eg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();const tg={provide:Vp,useExisting:ge(()=>ng),multi:!0};let ng=(()=>{class e extends Bp{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=t=>{e(""==t?null:parseFloat(t))}}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[tc([tg]),Go]}),e})();const rg=new or("NgModelWithFormControlWarning"),ig={provide:yf,useExisting:ge(()=>sg)};let sg=(()=>{class e extends yf{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Cu,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Tf(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Sf(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){bf(e.control||null,e,!1),xf(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,Mf(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(bf(t||null,e),n instanceof Gf&&(Sf(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);kf(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return Tf(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Of(this.form,this),this._oldForm&&Tf(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(ua(Wp,10),ua(jp,10))},e.\u0275dir=st({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[tc([ig]),Go,vt]}),e})();const og={provide:vf,useExisting:ge(()=>ag)};let ag=(()=>{class e extends vf{constructor(e,t,n,r,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new Cu,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=Nf(0,r)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),Af(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return wf(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(ua(yf,13),ua(Wp,10),ua(jp,10),ua(Vp,10),ua(rg,8))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[tc([og]),Go,vt]}),e._ngModelWarningSentOnce=!1,e})();const lg={provide:Vp,useExisting:ge(()=>ug),multi:!0};function cg(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let ug=(()=>{class e extends Bp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const n=cg(t,e);this.setProperty("value",n)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[tc([lg]),Go]}),e})(),hg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(cg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(cc),ua(dc),ua(ug,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const dg={provide:Vp,useExisting:ge(()=>fg),multi:!0};function pg(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let fg=(()=>{class e extends Bp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const n=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(n.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const n=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const r=e.item(t),i=this._getOptionValue(r.value);n.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const r=e.item(t);if(r.selected){const e=this._getOptionValue(r.value);n.push(e)}}}this.value=n,e(n)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[tc([dg]),Go]}),e})(),gg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(pg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(pg(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(cc),ua(dc),ua(fg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const mg={provide:Wp,useExisting:ge(()=>yg),multi:!0};let yg=(()=>{class e{constructor(){this._required=!1}get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!=`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?Kp(e):null}registerOnValidatorChange(e){this._onChange=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&ra("required",t.required?"":null)},inputs:{required:"required"},features:[tc([mg])]}),e})();const vg={provide:Wp,useExisting:ge(()=>_g),multi:!0};let _g=(()=>{class e{constructor(){this._validator=Qp}ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this.enabled()?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=this.enabled()?Jp(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):Qp}enabled(){return null!=this.maxlength}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&ra("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[tc([vg]),vt]}),e})(),Cg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[[eg]]}),e})(),Eg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[Cg]}),e})(),wg=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:rg,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({imports:[Cg]}),e})(),Sg=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,s=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,s=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,s=null!=t.asyncValidator?t.asyncValidator:null)),new qf(n,{asyncValidators:s,updateOn:r,validators:i})}control(e,t,n){return new Gf(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new Wf(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof Gf||e instanceof qf||e instanceof Wf?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({factory:function(){return new e},token:e,providedIn:wg}),e})();function bg(...e){return ae(e,re(e))}function Pg(e,t){return r(t)?Q(e,t,1):Q(e,1)}function Og(e,t){return x((n,r)=>{let i=0;n.subscribe(new R(r,n=>e.call(t,n,i++)&&r.next(n)))})}class Tg{}class Ig{}class kg{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof kg?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new kg;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof kg?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Ag{encodeKey(e){return xg(e)}encodeValue(e){return xg(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const Mg=/%(\d[a-f0-9])/gi,Ng={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function xg(e){return encodeURIComponent(e).replace(Mg,(e,t)=>{var n;return null!==(n=Ng[t])&&void 0!==n?n:e})}function Rg(e){return`${e}`}class Dg{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Ag,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Dg({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Rg(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(Rg(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Lg{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Fg(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Ug(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Bg(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Vg{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new kg),this.context||(this.context=new Lg),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new Dg,this.urlWithParams=t}serializeBody(){return null===this.body?null:Fg(this.body)||Ug(this.body)||Bg(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Dg?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Bg(this.body)?null:Ug(this.body)?this.body.type||null:Fg(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Dg?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let l=e.headers||this.headers,c=e.params||this.params;const u=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(l=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),l)),e.setParams&&(c=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),c)),new Vg(n,r,s,{params:c,headers:l,context:u,reportProgress:a,responseType:i,withCredentials:o})}}var $g=(()=>(($g=$g||{})[$g.Sent=0]="Sent",$g[$g.UploadProgress=1]="UploadProgress",$g[$g.ResponseHeader=2]="ResponseHeader",$g[$g.DownloadProgress=3]="DownloadProgress",$g[$g.Response=4]="Response",$g[$g.User=5]="User",$g))();class zg{constructor(e,t=200,n="OK"){this.headers=e.headers||new kg,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Hg extends zg{constructor(e={}){super(e),this.type=$g.ResponseHeader}clone(e={}){return new Hg({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Gg extends zg{constructor(e={}){super(e),this.type=$g.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Gg({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class qg extends zg{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Wg(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let jg=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof Vg)r=e;else{let i,s;i=n.headers instanceof kg?n.headers:new kg(n.headers),n.params&&(s=n.params instanceof Dg?n.params:new Dg({fromObject:n.params})),r=new Vg(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=bg(r).pipe(Pg(e=>this.handler.handle(e)));if(e instanceof Vg||"events"===n.observe)return i;const s=i.pipe(Og(e=>e instanceof Gg));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(D(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(D(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Dg).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,Wg(n,t))}post(e,t,n={}){return this.request("POST",e,Wg(n,t))}put(e,t,n={}){return this.request("PUT",e,Wg(n,t))}}return e.\u0275fac=function(t){return new(t||e)(Or(Tg))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class Zg{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const Yg=new or("HTTP_INTERCEPTORS");let Kg=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Jg=/^\)\]\}',?\n/;let Qg=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new T(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new kg(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new Hg({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),l=null;204!==i&&(l=void 0===n.response?n.responseText:n.response),0===i&&(i=l?200:0);let c=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof l){const e=l;l=l.replace(Jg,"");try{l=""!==l?JSON.parse(l):null}catch(u){l=e,c&&(c=!1,l={error:u,text:l})}}c?(t.next(new Gg({body:l,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new qg({error:l,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new qg({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let l=!1;const c=r=>{l||(t.next(s()),l=!0);let i={type:$g.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&!!n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:$g.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",c),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:$g.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",o),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",c),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Or(Jd))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const Xg=new or("XSRF_COOKIE_NAME"),em=new or("XSRF_HEADER_NAME");class tm{}let nm=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ud(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh),Or(Hu),Or(Xg))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),rm=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(tm),Or(em))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),im=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(Yg,[]);this.chain=e.reduceRight((e,t)=>new Zg(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Ig),Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),sm=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:rm,useClass:Kg}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:Xg,useValue:t.cookieName}:[],t.headerName?{provide:em,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[rm,{provide:Yg,useExisting:rm,multi:!0},{provide:tm,useClass:nm},{provide:Xg,useValue:"XSRF-TOKEN"},{provide:em,useValue:"X-XSRF-TOKEN"}]}),e})(),om=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[jg,{provide:Tg,useClass:im},Qg,{provide:Ig,useExisting:Qg}],imports:[[sm.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class am extends A{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function lm(e,t,n){e?J(n,e,t):t()}const cm=i(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function um(...e){return X(1)(ae(e,re(e)))}function hm(e){return new T(t=>{Y(e()).subscribe(t)})}function dm(){return x((e,t)=>{let n=null;e._refCount++;const r=new R(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class pm extends T{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,N(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new a;const t=this.getSubject();e.add(this.source.subscribe(new R(t,void 0,()=>{this._teardown(),t.complete()},e=>{this._teardown(),t.error(e)},()=>this._teardown()))),e.closed&&(this._connection=null,e=a.EMPTY)}return e}refCount(){return dm()(this)}}function fm(e,t){return x((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(new R(r,n=>{null==i||i.unsubscribe();let o=0;const l=s++;Y(e(n,l)).subscribe(i=new R(r,e=>r.next(t?t(n,e,l,o++):e),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function gm(e,t,n,r,i){return(s,o)=>{let a=n,l=t,c=0;s.subscribe(new R(o,t=>{const n=c++;l=a?e(l,t,n):(a=!0,t),r&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}function mm(e,t){return x(gm(e,t,arguments.length>=2,!0))}function ym(e){return x((t,n)=>{let r,i=null,s=!1;i=t.subscribe(new R(n,void 0,void 0,o=>{r=Y(e(o,ym(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}function vm(e){return e<=0?()=>ee:x((t,n)=>{let r=[];t.subscribe(new R(n,t=>{r.push(t),e<r.length&&r.shift()},()=>{for(const e of r)n.next(e);n.complete()},void 0,()=>{r=null}))})}function _m(e=Cm){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>r?n.complete():n.error(e())))})}function Cm(){return new cm}function Em(e){return x((t,n)=>{let r=!1;t.subscribe(new R(n,e=>{r=!0,n.next(e)},()=>{r||n.next(e),n.complete()}))})}function wm(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Og((t,n)=>e(t,n,r)):O,le(1),n?Em(t):_m(()=>new cm))}function Sm(e,t,n){const i=r(e)||t||n?{next:e,error:t,complete:n}:e;return i?x((e,t)=>{var n;null===(n=i.subscribe)||void 0===n||n.call(i);let r=!0;e.subscribe(new R(t,e=>{var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},()=>{var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},e=>{var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},()=>{var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):O}class bm{constructor(e,t){this.id=e,this.url=t}}class Pm extends bm{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Om extends bm{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Tm extends bm{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Im extends bm{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class km extends bm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Am extends bm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mm extends bm{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Nm extends bm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xm extends bm{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Rm{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Dm{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Lm{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fm{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Um{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bm{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vm{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const $m="primary";class zm{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Hm(e){return new zm(e)}const Gm="ngNavigationCancelingError";function qm(e){const t=Error("NavigationCancelingError: "+e);return t[Gm]=!0,t}function Wm(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function jm(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!Zm(e[i],t[i]))return!1;return!0}function Zm(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function Ym(e){return Array.prototype.concat.apply([],e)}function Km(e){return e.length>0?e[e.length-1]:null}function Jm(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Qm(e){return Ca(e)?e:_a(e)?ae(Promise.resolve(e)):bg(e)}const Xm={exact:function e(t,n,r){if(!ly(t.segments,n.segments)||!iy(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:ny},ey={exact:function(e,t){return jm(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Zm(e[n],t[n]))},ignored:()=>!0};function ty(e,t,n){return Xm[n.paths](e.root,t.root,n.matrixParams)&&ey[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ny(e,t,n){return ry(e,t,t.segments,n)}function ry(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!ly(i,n)||t.hasChildren()||!iy(i,n,r))}if(e.segments.length===n.length){if(!ly(e.segments,n)||!iy(e.segments,n,r))return!1;for(const n in t.children)if(!e.children[n]||!ny(e.children[n],t.children[n],r))return!1;return!0}{const i=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(ly(e.segments,i)&&iy(e.segments,i,r)&&e.children[$m])&&ry(e.children[$m],t,s,r)}}function iy(e,t,n){return t.every((t,r)=>ey[n](e[r].parameters,t.parameters))}class sy{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hm(this.queryParams)),this._queryParamMap}toString(){return hy.serialize(this)}}class oy{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Jm(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return dy(this)}}class ay{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Hm(this.parameters)),this._parameterMap}toString(){return _y(this)}}function ly(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class cy{}class uy{parse(e){const t=new by(e);return new sy(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`${`/${py(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${gy(t)}=${gy(e)}`).join("&"):`${gy(t)}=${gy(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const hy=new uy;function dy(e){return e.segments.map(e=>_y(e)).join("/")}function py(e,t){if(!e.hasChildren())return dy(e);if(t){const t=e.children[$m]?py(e.children[$m],!1):"",n=[];return Jm(e.children,(e,t)=>{t!==$m&&n.push(`${t}:${py(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return Jm(e.children,(e,r)=>{r===$m&&(n=n.concat(t(e,r)))}),Jm(e.children,(e,r)=>{r!==$m&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===$m?[py(e.children[$m],!1)]:[`${n}:${py(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[$m]?`${dy(e)}/${t[0]}`:`${dy(e)}/(${t.join("//")})`}}function fy(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gy(e){return fy(e).replace(/%3B/gi,";")}function my(e){return fy(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function yy(e){return decodeURIComponent(e)}function vy(e){return yy(e.replace(/\+/g,"%20"))}function _y(e){return`${my(e.path)}${function(e){return Object.keys(e).map(t=>`;${my(t)}=${my(e[t])}`).join("")}(e.parameters)}`}const Cy=/^[^\/()?;=#]+/;function Ey(e){const t=e.match(Cy);return t?t[0]:""}const wy=/^[^=?&#]+/,Sy=/^[^?&#]+/;class by{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new oy([],{}):new oy([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[$m]=new oy(e,t)),n}parseSegment(){const e=Ey(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new ay(yy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Ey(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=Ey(this.remaining);e&&(n=e,this.capture(n))}e[yy(t)]=yy(n)}parseQueryParam(e){const t=function(e){const t=e.match(wy);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Sy);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=vy(t),i=vy(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=Ey(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=$m);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s[$m]:new oy([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class Py{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Oy(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Oy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Ty(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return Ty(e,this._root).map(e=>e.value)}}function Oy(e,t){if(e===t.value)return t;for(const n of t.children){const t=Oy(e,n);if(t)return t}return null}function Ty(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Ty(e,n);if(r.length)return r.unshift(t),r}return[]}class Iy{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ky(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class Ay extends Py{constructor(e,t){super(e),this.snapshot=t,Ly(this,e)}toString(){return this.snapshot.toString()}}function My(e,t){const n=function(e,t){const n=new Ry([],{},{},"",{},$m,t,null,e.root,-1,{});return new Dy("",new Iy(n,[]))}(e,t),r=new am([new ay("",{})]),i=new am({}),s=new am({}),o=new am({}),a=new am(""),l=new Ny(r,i,o,a,s,$m,t,n.root);return l.snapshot=n.root,new Ay(new Iy(l,[]),n)}class Ny{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(D(e=>Hm(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(D(e=>Hm(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function xy(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Ry{constructor(e,t,n,r,i,s,o,a,l,c,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Hm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Dy extends Py{constructor(e,t){super(t),this.url=e,Ly(this,t)}toString(){return Fy(this._root)}}function Ly(e,t){t.value._routerState=e,t.children.forEach(t=>Ly(e,t))}function Fy(e){const t=e.children.length>0?` { ${e.children.map(Fy).join(", ")} } `:"";return`${e.value}${t}`}function Uy(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,jm(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),jm(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!jm(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),jm(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function By(e,t){return jm(e.params,t.params)&&function(e,t){return ly(e,t)&&e.every((e,n)=>jm(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||By(e.parent,t.parent))}function Vy(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return Vy(e,t,r);return Vy(e,t)})}(e,t,n);return new Iy(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return $y(t,e),e}}const n=function(e){return new Ny(new am(e.url),new am(e.params),new am(e.queryParams),new am(e.fragment),new am(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(t=>Vy(e,t));return new Iy(n,r)}}function $y(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)$y(e.children[n],t.children[n])}function zy(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Hy(e){return"object"==typeof e&&null!=e&&e.outlets}function Gy(e,t,n,r,i){let s={};return r&&Jm(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new sy(n.root===e?t:qy(n.root,e,t),s,i)}function qy(e,t,n){const r={};return Jm(e.children,(e,i)=>{r[i]=e===t?n:qy(e,t,n)}),new oy(e.segments,r)}class Wy{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&zy(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(Hy);if(r&&r!==Km(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class jy{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Zy(e,t,n){if(e||(e=new oy([],{})),0===e.segments.length&&e.hasChildren())return Yy(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if(Hy(o))break;const a=`${o}`,l=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&l&&"object"==typeof l&&void 0===l.outlets){if(!Xy(a,l,t))return s;r+=2}else{if(!Xy(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new oy(e.segments.slice(0,r.pathIndex),{});return t.children[$m]=new oy(e.segments.slice(r.pathIndex),e.children),Yy(t,0,i)}return r.match&&0===i.length?new oy(e.segments,{}):r.match&&!e.hasChildren()?Ky(e,t,n):r.match?Yy(e,0,i):Ky(e,t,n)}function Yy(e,t,n){if(0===n.length)return new oy(e.segments,{});{const r=function(e){return Hy(e[0])?e[0].outlets:{[$m]:e}}(n),i={};return Jm(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=Zy(e.children[r],t,n))}),Jm(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new oy(e.segments,i)}}function Ky(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if(Hy(s)){const e=Jy(s.outlets);return new oy(r,e)}if(0===i&&zy(n[0])){r.push(new ay(e.segments[t].path,Qy(n[0]))),i++;continue}const o=Hy(s)?s.outlets[$m]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&zy(a)?(r.push(new ay(o,Qy(a))),i+=2):(r.push(new ay(o,{})),i++)}return new oy(r,{})}function Jy(e){const t={};return Jm(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=Ky(new oy([],{}),0,e))}),t}function Qy(e){const t={};return Jm(e,(e,n)=>t[n]=`${e}`),t}function Xy(e,t,n){return e==n.path&&jm(t,n.parameters)}class ev{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Uy(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=ky(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Jm(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=ky(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=ky(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Bm(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Fm(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Uy(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),tv(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function tv(e){Uy(e.value),e.children.forEach(tv)}class nv{constructor(e,t){this.routes=e,this.module=t}}function rv(e){return"function"==typeof e}function iv(e){return e instanceof sy}const sv=Symbol("INITIAL_VALUE");function ov(){return fm(e=>function(...e){const t=re(e),n=ne(e),{args:r,keys:i}=Rp(e);if(0===r.length)return ae([],t);const s=new T(function(e,t,n=O){return r=>{lm(t,()=>{const{length:i}=e,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)lm(t,()=>{const i=ae(e[l],t);let c=!1;i.subscribe(new R(r,e=>{s[l]=e,c||(c=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,t,i?e=>Fp(i,e):O));return n?s.pipe(Lp(n)):s}(e.map(e=>e.pipe(le(1),function(...e){const t=re(e);return x((n,r)=>{(t?um(e,n,t):um(e,n)).subscribe(r)})}(sv)))).pipe(mm((e,t)=>{let n=!1;return t.reduce((e,r,i)=>e!==sv?e:(r===sv&&(n=!0),n||!1!==r&&i!==t.length-1&&!iv(r)?e:r),e)},sv),Og(e=>e!==sv),D(e=>iv(e)?e:!0===e),le(1)))}let av=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&ga(0,"router-outlet")},directives:function(){return[s_]},encapsulation:2}),e})();function lv(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];cv(r,uv(t,r))}}function cv(e,t){e.children&&lv(e.children,t)}function uv(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function hv(e){const t=e.children&&e.children.map(hv),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==$m&&(n.component=av),n}function dv(e){return e.outlet||$m}function pv(e,t){const n=e.filter(e=>dv(e)===t);return n.push(...e.filter(e=>dv(e)!==t)),n}const fv={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function gv(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},fv):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||Wm)(n,e,t);if(!i)return Object.assign({},fv);const s={};Jm(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function mv(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>yv(e,t,n)&&dv(n)!==$m)}(e,n,r)){const i=new oy(t,function(e,t,n,r){const i={};i[$m]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&dv(s)!==$m){const n=new oy([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[dv(s)]=n}return i}(e,t,r,new oy(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>yv(e,t,n))}(e,n,r)){const s=new oy(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(yv(e,n,a)&&!i[dv(a)]){const n=new oy([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[dv(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new oy(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function yv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function vv(e,t,n,r){return!!(dv(e)===r||r!==$m&&yv(t,n,e))&&("**"===e.path||gv(t,e,n).matched)}function _v(e,t,n){return 0===t.length&&!e.children[n]}class Cv{constructor(e){this.segmentGroup=e||null}}class Ev{constructor(e){this.urlTree=e}}function wv(e){return new T(t=>t.error(new Cv(e)))}function Sv(e){return new T(t=>t.error(new Ev(e)))}function bv(e){return new T(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Pv{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(Gc)}apply(){const e=mv(this.urlTree.root,[],[],this.config).segmentGroup,t=new oy(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,$m).pipe(D(e=>this.createUrlTree(Ov(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ym(e=>{if(e instanceof Ev)return this.allowRedirects=!1,this.match(e.urlTree);throw e instanceof Cv?this.noMatchError(e):e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,$m).pipe(D(t=>this.createUrlTree(Ov(t),e.queryParams,e.fragment))).pipe(ym(e=>{throw e instanceof Cv?this.noMatchError(e):e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new oy([],{[$m]:e}):e;return new sy(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(D(e=>new oy([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return ae(r).pipe(Pg(r=>{const i=n.children[r],s=pv(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(D(e=>({segment:e,outlet:r})))}),mm((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Og((t,n)=>e(t,n,r)):O,vm(1),n?Em(t):_m(()=>new cm))}())}expandSegment(e,t,n,r,i,s){return ae(n).pipe(Pg(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(ym(e=>{if(e instanceof Cv)return bg(null);throw e}))),wm(e=>!!e),ym((e,n)=>{if(e instanceof cm||"EmptyError"===e.name){if(_v(t,r,i))return bg(new oy([],{}));throw new Cv(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return vv(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):wv(t):wv(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Sv(i):this.lineralizeSegments(n,i).pipe(Q(n=>{const i=new oy(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:l,positionalParamSegments:c}=gv(t,r,i);if(!o)return wv(t);const u=this.applyRedirectCommands(a,r.redirectTo,c);return r.redirectTo.startsWith("/")?Sv(u):this.lineralizeSegments(r,u).pipe(Q(r=>this.expandSegment(e,t,n,r.concat(i.slice(l)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?bg(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(D(e=>(n._loadedConfig=e,new oy(r,{})))):bg(new oy(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=gv(t,n,r);if(!s)return wv(t);const l=r.slice(a);return this.getChildConfig(e,n,r).pipe(Q(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:c}=mv(t,o,l,s),u=new oy(a.segments,a.children);if(0===c.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(D(e=>new oy(o,e)));if(0===s.length&&0===c.length)return bg(new oy(o,{}));const h=dv(n)===i;return this.expandSegment(r,u,s,c,h?$m:i,!0).pipe(D(e=>new oy(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?bg(new nv(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?bg(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Q(n=>{return n?this.configLoader.load(e.injector,t).pipe(D(e=>(t._loadedConfig=e,e))):(r=t,new T(e=>e.error(qm(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))));var r})):bg(new nv([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?bg(r.map(r=>{const i=e.get(r);let s;if((o=i)&&rv(o.canLoad))s=i.canLoad(t,n);else{if(!rv(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}var o;return Qm(s)})).pipe(ov(),Sm(e=>{if(!iv(e))return;const t=qm(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),D(e=>!0===e)):bg(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return bg(n);if(r.numberOfChildren>1||!r.children[$m])return bv(e.redirectTo);r=r.children[$m]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new sy(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Jm(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return Jm(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new oy(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Ov(e){const t={};for(const n of Object.keys(e.children)){const r=Ov(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children[$m]){const t=e.children[$m];return new oy(e.segments.concat(t.segments),t.children)}return e}(new oy(e.segments,t))}class Tv{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Iv{constructor(e,t){this.component=e,this.route=t}}function kv(e,t,n){const r=e._root;return Mv(r,t?t._root:null,n,[r.value])}function Av(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Mv(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=ky(t);return e.children.forEach(e=>{(function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!ly(e.url,t.url);case"pathParamsOrQueryParamsChange":return!ly(e.url,t.url)||!jm(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!By(e,t)||!jm(e.queryParams,t.queryParams);case"paramsChange":default:return!By(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new Tv(r)):(s.data=o.data,s._resolvedData=o._resolvedData),Mv(e,t,s.component?a?a.children:null:n,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Iv(a.outlet.component,o))}else o&&Nv(t,a,i),i.canActivateChecks.push(new Tv(r)),Mv(e,null,s.component?a?a.children:null:n,r,i)})(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),Jm(s,(e,t)=>Nv(e,n.getContext(t),i)),i}function Nv(e,t,n){const r=ky(e),i=e.value;Jm(r,(e,r)=>{Nv(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new Iv(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class xv{}function Rv(e){return new T(t=>t.error(e))}class Dv{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=mv(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,$m);if(null===t)return null;const n=new Ry([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},$m,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Iy(n,t),i=new Dy(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=xy(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=pv(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=Fv(n);return r.sort((e,t)=>e.value.outlet===$m?-1:t.value.outlet===$m?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return _v(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!vv(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?Km(n).parameters:{};i=new Ry(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Vv(e),dv(e),e.component,e,Uv(t),Bv(t)+n.length,$v(e))}else{const r=gv(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new Ry(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Vv(e),dv(e),e.component,e,Uv(t),Bv(t)+s.length,$v(e))}const a=(u=e).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:l,slicedSegments:c}=mv(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);var u;if(0===c.length&&l.hasChildren()){const e=this.processChildren(a,l);return null===e?null:[new Iy(i,e)]}if(0===a.length&&0===c.length)return[new Iy(i,[])];const h=dv(e)===r,d=this.processSegment(a,l,c,h?$m:r);return null===d?null:[new Iy(i,d)]}}function Lv(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function Fv(e){const t=[],n=new Set;for(const r of e){if(!Lv(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=Fv(r.children);t.push(new Iy(r.value,e))}return t.filter(e=>!n.has(e))}function Uv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Bv(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Vv(e){return e.data||{}}function $v(e){return e.resolve||{}}function zv(e){return fm(t=>{const n=e(t);return n?ae(n).pipe(D(()=>t)):bg(t)})}class Hv extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const Gv=new or("ROUTES");class qv{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe(D(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new nv(Ym(r.injector.get(Gv,void 0,Ne.Self|Ne.Optional)).map(hv),r)}),ym(e=>{throw t._loader$=void 0,e}));return t._loader$=new pm(n,()=>new A).pipe(dm()),t._loader$}loadModuleFactory(e){return"string"==typeof e?ae(this.loader.load(e)):Qm(e()).pipe(Q(e=>e instanceof qc?bg(e):ae(this.compiler.compileModuleAsync(e))))}}class Wv{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new jv,this.attachRef=null}}class jv{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Wv,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Zv{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function Yv(e){throw e}function Kv(e,t,n){return t.parse("/")}function Jv(e,t){return bg(null)}const Qv={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Xv={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let e_=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=Yv,this.malformedUriErrorHandler=Kv,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Jv,afterPreactivation:Jv},this.urlHandlingStrategy=new Zv,this.routeReuseStrategy=new Hv,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(Gc),this.console=i.get(qu);const l=i.get(ih);this.isNgZoneEnabled=l instanceof ih&&ih.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new sy(new oy([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new qv(s,o,e=>this.triggerEvent(new Rm(e)),e=>this.triggerEvent(new Dm(e))),this.routerState=My(this.currentUrlTree,this.rootComponentType),this.transitions=new am({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const t=this.events;return e.pipe(Og(e=>0!==e.id),D(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),fm(e=>{let n=!1,r=!1;return bg(e).pipe(Sm(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),fm(e=>{const n=this.browserUrlTree.toString(),i=!this.navigated||e.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||i)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return t_(e.source)&&(this.browserUrlTree=e.extractedUrl),bg(e).pipe(fm(e=>{const n=this.transitions.getValue();return t.next(new Pm(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?ee:Promise.resolve(e)}),function(e,t,n,r){return fm(i=>function(e,t,n,r,i){return new Pv(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(D(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Sm(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,i,s){return Q(o=>function(e,t,n,i,s="emptyOnly",o="legacy"){try{const r=new Dv(e,t,n,i,s,o).recognize();return null===r?Rv(new xv):bg(r)}catch(r){return Rv(r)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),i,s).pipe(D(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Sm(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new km(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(i&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new Pm(n,this.serializeUrl(r),i,s);t.next(a);const l=My(r,this.rootComponentType).snapshot;return bg(Object.assign(Object.assign({},e),{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ee}),zv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Sm(e=>{const t=new Am(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),D(e=>Object.assign(Object.assign({},e),{guards:kv(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return Q(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?bg(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ae(e).pipe(Q(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?bg(s.map(s=>{const o=Av(s,t,i);let a;if(function(e){return e&&rv(e.canDeactivate)}(o))a=Qm(o.canDeactivate(e,t,n,r));else{if(!rv(o))throw new Error("Invalid CanDeactivate guard");a=Qm(o(e,t,n,r))}return a.pipe(wm())})).pipe(ov()):bg(!0)}(e.component,e.route,n,t,r)),wm(e=>!0!==e,!0))}(o,r,i,e).pipe(Q(n=>n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ae(t).pipe(Pg(t=>um(function(e,t){return null!==e&&t&&t(new Lm(e)),bg(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Um(e)),bg(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>hm(()=>bg(t.guards.map(i=>{const s=Av(i,t.node,n);let o;if(function(e){return e&&rv(e.canActivateChild)}(s))o=Qm(s.canActivateChild(r,e));else{if(!rv(s))throw new Error("Invalid CanActivateChild guard");o=Qm(s(r,e))}return o.pipe(wm())})).pipe(ov())));return bg(i).pipe(ov())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?bg(r.map(r=>hm(()=>{const i=Av(r,t,n);let s;if(function(e){return e&&rv(e.canActivate)}(i))s=Qm(i.canActivate(t,e));else{if(!rv(i))throw new Error("Invalid CanActivate guard");s=Qm(i(t,e))}return s.pipe(wm())}))).pipe(ov()):bg(!0)}(e,t.route,n))),wm(e=>!0!==e,!0))}(r,s,e,t):bg(n)),D(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Sm(e=>{if(iv(e.guardsResult)){const t=qm(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new Mm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Og(e=>!!e.guardsResult||(this.restoreHistory(e),this.cancelNavigationTransition(e,""),!1)),zv(e=>{if(e.guards.canActivateChecks.length)return bg(e).pipe(Sm(e=>{const t=new Nm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),fm(e=>{let t=!1;return bg(e).pipe(function(e,t){return Q(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return bg(n);let s=0;return ae(i).pipe(Pg(n=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return bg({});const s={};return ae(i).pipe(Q(i=>function(e,t,n,r){const i=Av(e,t,r);return Qm(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Sm(e=>{s[i]=e}))),vm(1),Q(()=>Object.keys(s).length===i.length?bg(s):ee))}(e._resolve,e,t,r).pipe(D(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),xy(e,n).resolve),null)))}(n.route,r,e,t)),Sm(()=>s++),vm(1),Q(e=>s===i.length?bg(n):ee))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Sm({next:()=>t=!0,complete:()=>{t||(this.restoreHistory(e),this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),Sm(e=>{const t=new xm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),zv(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),D(e=>{const t=function(e,t,n){const r=Vy(e,t._root,n?n._root:void 0);return new Ay(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Sm(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),((e,t,n)=>D(r=>(new ev(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,e=>this.triggerEvent(e)),Sm({next(){n=!0},complete(){n=!0}}),function(e){return x((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var t;if(!n&&!r){const t=`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(e),this.cancelNavigationTransition(e,t)):this.cancelNavigationTransition(e,t)}(null===(t=this.currentNavigation)||void 0===t?void 0:t.id)===e.id&&(this.currentNavigation=null)}),ym(n=>{if(r=!0,function(e){return e&&e[Gm]}(n)){const r=iv(n.url);r||(this.navigated=!0,this.restoreHistory(e,!0));const i=new Tm(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),r={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||t_(e.source)};this.scheduleNavigation(t,"imperative",null,r,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.restoreHistory(e,!0);const r=new Im(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(i){e.reject(i)}}return ee}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){lv(e),this.config=e.map(hv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,l=o?this.currentUrlTree.fragment:i;let c=null;switch(s){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return Gy(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Wy(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Jm(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new Wy(n,t,r)}(n);if(s.toRoot())return Gy(t.root,new oy([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new jy(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new jy(e,e===t.root,0)}const r=zy(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new jy(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?Yy(o.segmentGroup,o.index,s.commands):Zy(o.segmentGroup,o.index,s.commands);return Gy(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,c,l??null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=iv(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},Qv):!1===t?Object.assign({},Xv):t,iv(e))return ty(this.currentUrlTree,e,n);const r=this.parseUrl(e);return ty(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Om(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,t,n,r,i){var s,o;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),l=t_(t)&&a&&!t_(a.source),c=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(l&&c)return Promise.resolve(!0);let u,h,d;i?(u=i.resolve,h=i.reject,d=i.promise):d=new Promise((e,t)=>{u=e,h=t});const p=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),f=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(s=this.browserPageId)&&void 0!==s?s:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):f=0,this.setTransition({id:p,targetPageId:f,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}restoreHistory(e,t=!1){var n,r;if("computed"===this.canceledNavigationResolution){const t=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===t?this.currentUrlTree===(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)&&0===t&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(t)}else"replace"===this.canceledNavigationResolution&&(t&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){const n=new Tm(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(Or(lr),Or(cy),Or(jv),Or(Jh),Or(zo),Or(Oh),Or(th),Or(void 0))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function t_(e){return"imperative"!==e}let n_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.commands=[],this.onChanges=new A,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}onClick(){const e={skipLocationChange:i_(this.skipLocationChange),replaceUrl:i_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:i_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(e_),ua(Ny),rr("tabindex"),ua(dc),ua(cc))},e.\u0275dir=st({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&Ea("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})(),r_=(()=>{class e{constructor(e,t,n){this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.onChanges=new A,this.subscription=e.events.subscribe(e=>{e instanceof Om&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;const s={skipLocationChange:i_(this.skipLocationChange),replaceUrl:i_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,s),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:i_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(e_),ua(Ny),ua(Wh))},e.\u0275dir=st({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&Ea("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(za("href",t.href,_i),ra("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})();function i_(e){return""===e||!!e}let s_=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new Cu,this.deactivateEvents=new Cu,this.name=r||$m,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new o_(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(ua(jv),ua(jc),ua(sc),rr("name"),ua(Dc))},e.\u0275dir=st({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class o_{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===Ny?this.route:e===jv?this.childContexts:this.parent.get(e,t)}}class a_{}class l_{preload(e,t){return bg(null)}}let c_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new qv(t,n,t=>e.triggerEvent(new Rm(t)),t=>e.triggerEvent(new Dm(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Og(e=>e instanceof Om),Pg(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(Gc);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ae(n).pipe(X(),D(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?bg(t._loadedConfig):this.loader.load(e.injector,t)).pipe(Q(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Or(e_),Or(Oh),Or(th),Or(zo),Or(a_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),u_=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Pm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Om&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Vm&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new Vm(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(e_),Or(Zd),Or(void 0))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const h_=new or("ROUTER_CONFIGURATION"),d_=new or("ROUTER_FORROOT_GUARD"),p_=[Jh,{provide:cy,useClass:uy},{provide:e_,useFactory:function(e,t,n,r,i,s,o,a={},l,c){const u=new e_(null,e,t,n,r,i,s,Ym(o));return l&&(u.urlHandlingStrategy=l),c&&(u.routeReuseStrategy=c),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[cy,jv,Jh,zo,Oh,th,Gv,h_,[class{},new Nr],[class{},new Nr]]},jv,{provide:Ny,useFactory:function(e){return e.routerState.root},deps:[e_]},{provide:Oh,useClass:kh},c_,l_,class{preload(e,t){return t().pipe(ym(()=>bg(null)))}},{provide:h_,useValue:{enableTracing:!1}}];function f_(){return new _h("Router",e_)}let g_=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[p_,__(t),{provide:d_,useFactory:v_,deps:[[e_,new Nr,new xr]]},{provide:h_,useValue:n||{}},{provide:Wh,useFactory:y_,deps:[Fh,[new Mr(Zh),new Nr],h_]},{provide:u_,useFactory:m_,deps:[e_,Zd,h_]},{provide:a_,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:l_},{provide:_h,multi:!0,useFactory:f_},[C_,{provide:Fu,multi:!0,useFactory:E_,deps:[C_]},{provide:S_,useFactory:w_,deps:[C_]},{provide:Gu,multi:!0,useExisting:S_}]]}}static forChild(t){return{ngModule:e,providers:[__(t)]}}}return e.\u0275fac=function(t){return new(t||e)(Or(d_,8),Or(e_,8))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();function m_(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new u_(e,t,n)}function y_(e,t,n={}){return n.useHash?new Kh(e,t):new Yh(e,t)}function v_(e){return"guarded"}function __(e){return[{provide:ar,multi:!0,useValue:e},{provide:Gv,multi:!0,useValue:e}]}let C_=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(Bh,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let e=null;const t=new Promise(t=>e=t),n=this.injector.get(e_),r=this.injector.get(h_);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?bg(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(h_),n=this.injector.get(c_),r=this.injector.get(u_),i=this.injector.get(e_),s=this.injector.get(bh);e===s.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();function E_(e){return e.appInitializer.bind(e)}function w_(e){return e.bootstrapListener.bind(e)}const S_=new or("Router Initializer");class b_{}const P_="*";function O_(e,t=null){return{type:2,steps:e,options:t}}function T_(e){return{type:6,styles:e,offset:null}}function I_(e){Promise.resolve(null).then(e)}class k_{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){I_(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class A_{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?I_(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function M_(){return"undefined"!=typeof window&&void 0!==window.document}function N_(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function x_(e){switch(e.length){case 0:return new k_;case 1:return e[0];default:return new A_(e)}}function R_(e,t,n,r,i={},s={}){const o=[],a=[];let l=-1,c=null;if(r.forEach(e=>{const n=e.offset,r=n==l,u=r&&c||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),a){case"!":a=i[n];break;case P_:a=s[n];break;default:a=t.normalizeStyleValue(n,r,a,o)}u[r]=a}),r||a.push(u),c=u,l=n}),o.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${o.join(e)}`)}return a}function D_(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&L_(n,"start",e)));break;case"done":e.onDone(()=>r(n&&L_(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&L_(n,"destroy",e)))}}function L_(e,t,n){const r=F_(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),i=e._data;return null!=i&&(r._data=i),r}function F_(e,t,n,r,i="",s=0,o){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function U_(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function B_(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let V_=(e,t)=>!1,$_=(e,t)=>!1,z_=(e,t,n)=>[];const H_=N_();(H_||"undefined"!=typeof Element)&&(V_=M_()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),$_=(()=>{if(H_||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):$_}})(),z_=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let G_=null,q_=!1;function W_(e){G_||(G_=("undefined"!=typeof document?document.body:null)||{},q_=!!G_.style&&"WebkitAppearance"in G_.style);let t=!0;return G_.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in G_.style,!t&&q_&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in G_.style)),t}const j_=$_,Z_=V_,Y_=z_;function K_(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let J_=(()=>{class e{validateStyleProperty(e){return W_(e)}matchesElement(e,t){return j_(e,t)}containsElement(e,t){return Z_(e,t)}query(e,t,n){return Y_(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,s=[],o){return new k_(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})(),Q_=(()=>{class e{}return e.NOOP=new J_,e})();const X_="ng-enter",eC="ng-leave",tC="ng-trigger",nC=".ng-trigger",rC="ng-animating",iC=".ng-animating";function sC(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:oC(parseFloat(t[1]),t[2])}function oC(e,t){switch(t){case"s":return 1e3*e;default:return e}}function aC(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,s="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=oC(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=oC(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=e;if(!n){let n=!1,s=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(s,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:s}}(e,t,n)}function lC(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function cC(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else lC(e,n);return n}function uC(e,t,n){return n?t+":"+n+";":""}function hC(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=uC(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=uC(0,EC(n),e.style[n]));e.setAttribute("style",t)}function dC(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=CC(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),N_()&&hC(e))}function pC(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=CC(t);e.style[n]=""}),N_()&&hC(e))}function fC(e){return Array.isArray(e)?1==e.length?e[0]:O_(e):e}const gC=new RegExp("{{\\s*(.+?)\\s*}}","g");function mC(e){let t=[];if("string"==typeof e){let n;for(;n=gC.exec(e);)t.push(n[1]);gC.lastIndex=0}return t}function yC(e,t,n){const r=e.toString(),i=r.replace(gC,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function vC(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const _C=/-+([a-z0-9])/g;function CC(e){return e.replace(_C,(...e)=>e[1].toUpperCase())}function EC(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function wC(e,t){return 0===e||0===t}function SC(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let s=t[0],o=[];if(r.forEach(e=>{s.hasOwnProperty(e)||o.push(e),s[e]=n[e]}),o.length)for(var i=1;i<t.length;i++){let n=t[i];o.forEach(function(t){n[t]=PC(e,t)})}}return t}function bC(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function PC(e,t){return window.getComputedStyle(e)[t]}function OC(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],s=r[2],o=r[3];t.push(kC(i,o));"<"==s[0]&&!("*"==i&&"*"==o)&&t.push(kC(o,i))}(e,n,t)):n.push(e),n}const TC=new Set(["true","1"]),IC=new Set(["false","0"]);function kC(e,t){const n=TC.has(e)||IC.has(e),r=TC.has(t)||IC.has(t);return(i,s)=>{let o="*"==e||e==i,a="*"==t||t==s;return!o&&n&&"boolean"==typeof i&&(o=i?TC.has(e):IC.has(e)),!a&&r&&"boolean"==typeof s&&(a=s?TC.has(t):IC.has(t)),o&&a}}const AC=new RegExp("s*:selfs*,?","g");function MC(e,t,n){return new NC(e).build(t,n)}class NC{constructor(e){this._driver=e}build(e,t){const n=new xC(t);return this._resetContextStyleTimingState(n),bC(this,fC(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],s=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,s.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(e=>{if(RC(e)){const t=e;Object.keys(t).forEach(e=>{mC(t[e]).forEach(e=>{s.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=vC(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=bC(this,fC(e.animation),t);return{type:1,matchers:OC(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:DC(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>bC(this,e,t)),options:DC(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=bC(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:DC(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return LC(aC(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=LC(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||aC(r,t),LC(n.duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;let r,i=e.styles?e.styles:T_({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,s=!1;if(!i){s=!0;const e={};n.easing&&(e.easing=n.easing),i=T_(e)}t.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,t);o.isEmptyStep=s,r=o}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==P_?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(RC(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=t.collectedStyles[t.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=mC(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const l=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let l=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(RC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(RC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),c=0;return null!=l&&(r++,c=n.offset=l),o=o||c<0||c>1,s=s||c<a,a=c,i.push(c),n});o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&t.errors.push("Please ensure that all keyframe offsets are in order");const c=e.steps.length;let u=0;r>0&&r<c?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(u=1/(c-1));const h=c-1,d=t.currentTime,p=t.currentAnimateTimings,f=p.duration;return l.forEach((e,r)=>{const s=u>0?r==h?1:u*r:i[r],o=s*f;t.currentTime=d+p.delay+o,p.duration=o,this._validateStyleAst(e,t),e.offset=s,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:bC(this,fC(e.animation),t),options:DC(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:DC(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:DC(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,s]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(AC,"")),[e=e.replace(/@\*/g,nC).replace(/@\w+/g,e=>nC+"-"+e.substr(1)).replace(/:animating/g,iC),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,U_(t.collectedStyles,t.currentQuerySelector,{});const o=bC(this,fC(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:e.selector,options:DC(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:aC(e.timings,t.errors,!0);return{type:12,animation:bC(this,fC(e.animation),t),timings:n,options:null}}}class xC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function RC(e){return!Array.isArray(e)&&"object"==typeof e}function DC(e){return e?(e=lC(e)).params&&(e.params=function(e){return e?lC(e):null}(e.params)):e={},e}function LC(e,t,n){return{duration:e,delay:t,easing:n}}function FC(e,t,n,r,i,s,o=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class UC{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const BC=new RegExp(":enter","g"),VC=new RegExp(":leave","g");function $C(e,t,n,r,i,s={},o={},a,l,c=[]){return(new zC).buildKeyframes(e,t,n,r,i,s,o,a,l,c)}class zC{buildKeyframes(e,t,n,r,i,s,o,a,l,c=[]){l=l||new UC;const u=new GC(e,t,l,r,i,c,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),bC(this,n,u);const h=u.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(o).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([o],null,u.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[FC(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&t.transformIntoNewTimeline(s)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?sC(n.duration):null,s=null!=n.delay?sC(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),bC(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=HC);const e=sC(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>bC(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?sC(e.options.delay):0;e.steps.forEach(s=>{const o=t.createSubContext(e.options);i&&o.delayNextStep(i),bC(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return aC(t.params?yC(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,s=t.createSubContext().currentTimeline;s.easing=n.easing,e.styles.forEach(e=>{s.forwardTime((e.offset||0)*i),s.setStyles(e.styles,e.easing,t.errors,t.options),s.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(s),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?sC(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=HC);let s=n;const o=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{t.currentQueryIndex=r;const o=t.createSubContext(e.options,n);i&&o.delayNextStep(i),n===t.element&&(a=o.currentTimeline),bC(this,e.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(s),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,s=Math.abs(i.duration),o=s*(t.currentQueryTotal-1);let a=s*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const l=t.currentTimeline;a&&l.delayNextStep(a);const c=l.currentTime;bC(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}const HC={};class GC{constructor(e,t,n,r,i,s,o,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=HC,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new qC(this._driver,t,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=sC(n.duration)),null!=n.delay&&(r.delay=sC(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{(!t||!e.hasOwnProperty(n))&&(e[n]=yC(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new GC(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=HC,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},i=new WC(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,s){let o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(BC,"."+this._enterClassName)).replace(VC,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),o.push(...t)}return!i&&0==o.length&&s.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),o}}class qC{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new qC(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||P_,this._currentKeyframe[e]=P_}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},s=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=P_})):cC(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(s).forEach(e=>{const t=yC(s[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:P_),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=cC(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?e.add(n):r==P_&&t.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=e.size?vC(e.values()):[],s=t.size?vC(t.values()):[];if(n){const e=r[0],t=lC(e);e.offset=0,t.offset=1,r=[e,t]}return FC(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class WC extends qC{constructor(e,t,n,r,i,s,o=!1){super(e,t,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],s=n+t,o=t/s,a=cC(e[0],!1);a.offset=0,i.push(a);const l=cC(e[0],!1);l.offset=jC(o),i.push(l);const c=e.length-1;for(let r=1;r<=c;r++){let o=cC(e[r],!1);o.offset=jC((t+o.offset*n)/s),i.push(o)}n=s,t=0,r="",e=i}return FC(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function jC(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class ZC{}class YC extends ZC{normalizePropertyName(e,t){return CC(e)}normalizeStyleValue(e,t,n,r){let i="";const s=n.toString().trim();if(KC[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return s+i}}const KC=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function JC(e,t,n,r,i,s,o,a,l,c,u,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}const QC={};class XC{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],s=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):s}build(e,t,n,r,i,s,o,a,l,c){const u=[],h=this.ast.options&&this.ast.options.params||QC,d=this.buildStyles(n,o&&o.params||QC,u),p=a&&a.params||QC,f=this.buildStyles(r,p,u),g=new Set,m=new Map,y=new Map,v="void"===r,_={params:Object.assign(Object.assign({},h),p)},C=c?[]:$C(e,t,this.ast.animation,i,s,d,f,_,l,u);let E=0;if(C.forEach(e=>{E=Math.max(e.duration+e.delay,E)}),u.length)return JC(t,this._triggerName,n,r,v,d,f,[],[],m,y,E,u);C.forEach(e=>{const n=e.element,r=U_(m,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=U_(y,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&g.add(n)});const w=vC(g.values());return JC(t,this._triggerName,n,r,v,d,f,C,w,m,y,E)}}class eE{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){const n={},r=lC(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let s=i[e];s.length>1&&(s=yC(s,r,t));const o=this.normalizer.normalizePropertyName(e,t);s=this.normalizer.normalizeStyleValue(e,o,s,t),n[o]=s})}}),n}}class tE{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new eE(e.style,e.options&&e.options.params||{},n)}),nE(this.states,"true","1"),nE(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new XC(e,t,this.states))}),this.fallbackTransition=function(e,t,n){return new XC(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},t)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function nE(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const rE=new UC;class iE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=MC(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=R_(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let s;const o=new Map;if(i?(s=$C(this._driver,t,i,X_,eC,{},{},n,rE,r),s.forEach(e=>{const t=U_(o,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);o.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,P_)})});const a=x_(s.map(e=>{const t=o.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=F_(t,"","","");return D_(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const sE="ng-animate-queued",oE="ng-animate-disabled",aE=".ng-animate-disabled",lE=[],cE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},uE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},hE="__ng_removed";class dE{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=(n?e.value:e)??null,n){const t=lC(e);delete t.value,this.options=t}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const pE="void",fE=new dE(pE);class gE{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,SE(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const s=U_(this._elementListeners,e,[]),o={name:t,phase:n,callback:r};s.push(o);const a=U_(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(SE(e,tC),SE(e,tC+"-"+t),a[t]=fE),()=>{this._engine.afterFlush(()=>{const e=s.indexOf(o);e>=0&&s.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),s=new yE(this.id,t,e);let o=this._engine.statesByElement.get(e);o||(SE(e,tC),SE(e,tC+"-"+t),this._engine.statesByElement.set(e,o={}));let a=o[t];const l=new dE(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&l.absorbOptions(a.options),o[t]=l,a||(a=fE),l.value!==pE&&a.value===l.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,l.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(l.value,l.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{pC(e,n),dC(e,r)})}return}const c=U_(this._engine.playersByElement,e,[]);c.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let u=i.matchTransition(a.value,l.value,e,l.params),h=!1;if(!u){if(!r)return;u=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:u,fromState:a,toState:l,player:s,isFallbackTransition:h}),h||(SE(e,sE),s.onStart(()=>{bE(e,sE)})),s.onDone(()=>{let t=this.players.indexOf(s);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(s);e>=0&&n.splice(e,1)}}),this.players.push(s),c.push(s),s}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,nC,!0);n.forEach(e=>{if(e[hE])return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const s=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,pE,r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&x_(s).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const s=this._triggers[i].fallbackTransition,o=n[i]||fE,a=new dE(pE),l=new yE(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:s,fromState:o,toState:a,player:l,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e[hE];(!r||r===cE)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){SE(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(t=>{if(t.name==n.triggerName){const r=F_(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,D_(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class mE{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new gE(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(vE(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!vE(t))return;const i=t[hE];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),SE(e,oE)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),bE(e,oE))}removeNode(e,t,n,r){if(vE(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t[hE]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return vE(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,nC,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,iC,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return x_(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[hE];if(t&&t.setForRemoval){if(e[hE]=cE,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,aE)&&this.markElementAsDisabled(e,!1),this.driver.query(e,aE,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)SE(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?x_(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new UC,r=[],i=new Map,s=[],o=new Map,a=new Map,l=new Map,c=new Set;this.disabledNodes.forEach(e=>{c.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)c.add(t[n])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=EE(h,this.collectedEnterElements),p=new Map;let f=0;d.forEach((e,t)=>{const n=X_+f++;p.set(t,n),e.forEach(e=>SE(e,n))});const g=[],m=new Set,y=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const e=this.collectedLeaveElements[A],t=e[hE];t&&t.setForRemoval&&(g.push(e),m.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>m.add(e)):y.add(e))}const v=new Map,_=EE(h,Array.from(m));_.forEach((e,t)=>{const n=eC+f++;v.set(t,n),e.forEach(e=>SE(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=p.get(t);e.forEach(e=>bE(e,n))}),_.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>bE(e,n))}),g.forEach(e=>{this.processLeaveNode(e)})});const C=[],E=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(C.push(t),this.collectedEnterElements.length){const e=i[hE];if(e&&e.setForMove)return void t.destroy()}const c=!u||!this.driver.containsElement(u,i),h=v.get(i),d=p.get(i),f=this._buildInstruction(e,n,d,h,c);if(f.errors&&f.errors.length)E.push(f);else{if(c)return t.onStart(()=>pC(i,f.fromStyles)),t.onDestroy(()=>dC(i,f.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>pC(i,f.fromStyles)),t.onDestroy(()=>dC(i,f.toStyles)),void r.push(t);f.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,f.timelines),s.push({instruction:f,player:t,element:i}),f.queriedElements.forEach(e=>U_(o,e,[]).push(t)),f.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),f.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=l.get(t);r||l.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(E.length){const e=[];E.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),C.forEach(e=>e.destroy()),this.reportError(e)}const w=new Map,S=new Map;s.forEach(e=>{const t=e.element;n.has(t)&&(S.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,w))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{U_(w,t,[]).push(e),e.destroy()})});const b=g.filter(e=>TE(e,a,l)),P=new Map;CE(P,this.driver,y,l,P_).forEach(e=>{TE(e,a,l)&&b.push(e)});const O=new Map;d.forEach((e,t)=>{CE(O,this.driver,new Set(e),a,"!")}),b.forEach(e=>{const t=P.get(e),n=O.get(e);P.set(e,Object.assign(Object.assign({},t),n))});const T=[],I=[],k={};s.forEach(e=>{const{element:t,player:s,instruction:o}=e;if(n.has(t)){if(c.has(t))return s.onDestroy(()=>dC(t,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let e=k;if(S.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=S.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>S.set(t,e))}const n=this._buildAnimation(s.namespaceId,o,w,i,O,P);if(s.setRealPlayer(n),e===k)T.push(s);else{const t=this.playersByElement.get(e);t&&t.length&&(s.parentPlayer=x_(t)),r.push(s)}}else pC(t,o.fromStyles),s.onDestroy(()=>dC(t,o.toStyles)),I.push(s),c.has(t)&&r.push(s)}),I.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=x_(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let A=0;A<g.length;A++){const e=g[A],t=e[hE];if(bE(e,eC),t&&t.hasAnimation)continue;let n=[];if(o.size){let t=o.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,iC,!0);for(let e=0;e<r.length;e++){let t=o.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?PE(this,e,r):this.processLeaveNode(e)}return g.length=0,T.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),T}elementContainsData(e,t){let n=!1;const r=t[hE];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let s=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(s=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==pE;t.forEach(t=>{t.queued||!e&&t.triggerName!=r||s.push(t)})}}return(n||r)&&(s=s.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),s}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName;for(const o of t.timelines){const e=o.element,a=e!==r,l=U_(n,e,[]);this._getPreviousPlayers(e,a,i,s,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),l.push(e)})}pC(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,s){const o=t.triggerName,a=t.element,l=[],c=new Set,u=new Set,h=t.timelines.map(t=>{const h=t.element;c.add(h);const d=h[hE];if(d&&d.removedBeforeQueried)return new k_(t.duration,t.delay);const p=h!==a,f=function(e){const t=[];return OE(e,t),t}((n.get(h)||lE).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),g=i.get(h),m=s.get(h),y=R_(0,this._normalizer,0,t.keyframes,g,m),v=this._buildPlayer(t,y,f);if(t.subTimeline&&r&&u.add(h),p){const t=new yE(e,o,h);t.setRealPlayer(v),l.push(t)}return v});l.forEach(e=>{U_(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),c.forEach(e=>SE(e,rC));const d=x_(h);return d.onDestroy(()=>{c.forEach(e=>bE(e,rC)),dC(a,t.toStyles)}),u.forEach(e=>{U_(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new k_(e.duration,e.delay)}}class yE{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new k_,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>D_(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){U_(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function vE(e){return e&&1===e.nodeType}function _E(e,t){const n=e.style.display;return e.style.display=t??"none",n}function CE(e,t,n,r,i){const s=[];n.forEach(e=>s.push(_E(e)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(e=>{const n=s[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[hE]=uE,o.push(r))}),e.set(r,s)});let a=0;return n.forEach(e=>_E(e,s[a++])),o}function EE(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function s(e){if(!e)return 1;let t=i.get(e);if(t)return t;const o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:s(o),i.set(e,t),t}return t.forEach(e=>{const t=s(e);1!==t&&n.get(t).push(e)}),n}const wE="$$classes";function SE(e,t){if(e.classList)e.classList.add(t);else{let n=e[wE];n||(n=e[wE]={}),n[t]=!0}}function bE(e,t){if(e.classList)e.classList.remove(t);else{let n=e[wE];n&&delete n[t]}}function PE(e,t,n){x_(n).onDone(()=>e.processLeaveNode(t))}function OE(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof A_?OE(r.players,t):t.push(r)}}function TE(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class IE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new mE(e,t,n),this._timelineEngine=new iE(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const s=e+"-"+r;let o=this._triggerCache[s];if(!o){const e=[],t=MC(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);o=function(e,t,n){return new tE(e,t,n)}(r,t,this._normalizer),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(t,r,o)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=B_(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=B_(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function kE(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=ME(t[0]),t.length>1&&(r=ME(t[t.length-1]))):t&&(n=ME(t)),n||r?new AE(e,n,r):null}let AE=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&dC(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(dC(this._element,this._initialStyles),this._endStyles&&(dC(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(pC(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(pC(this._element,this._endStyles),this._endStyles=null),dC(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function ME(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];NE(i)&&(t=t||{},t[i]=e[i])}return t}function NE(e){return"display"===e||"position"===e}const xE="animation",RE="animationend";class DE{constructor(e,t,n,r,i,s,o){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){(function(e,t){const n=$E(e,"").trim();let r=0;n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++;return n}(n)+1,t=`${n}, ${t}`),VE(e,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),BE(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){LE(this._element,this._name,"paused")}resume(){LE(this._element,this._name,"running")}setPosition(e){const t=FE(this._element,this._name);this._position=e*this._duration,VE(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),BE(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=$E(e,"").split(","),r=UE(n,t);r>=0&&(n.splice(r,1),VE(e,"",n.join(",")))}(this._element,this._name))}}function LE(e,t,n){VE(e,"PlayState",n,FE(e,t))}function FE(e,t){const n=$E(e,"");return n.indexOf(",")>0?UE(n.split(","),t):UE([n],t)}function UE(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function BE(e,t,n){n?e.removeEventListener(RE,t):e.addEventListener(RE,t)}function VE(e,t,n,r){const i=xE+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function $E(e,t){return e.style[xE+t]||""}class zE{constructor(e,t,n,r,i,s,o,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new DE(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:PC(this.element,n))})}this.currentSnapshot=e}}class HE extends k_{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=K_(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class GE{constructor(){this._count=0}validateStyleProperty(e){return W_(e)}matchesElement(e,t){return j_(e,t)}containsElement(e,t){return Z_(e,t)}query(e,t,n){return Y_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>K_(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const s=document.createElement("style");return s.textContent=r,s}animate(e,t,n,r,i,s=[],o){const a=s.filter(e=>e instanceof zE),l={};wC(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const c=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=SC(e,t,l));if(0==n)return new HE(e,c);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,u,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=kE(e,t),p=new zE(e,t,u,n,r,i,c,d);return p.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),p}}class qE{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:PC(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class WE{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(jE().toString()),this._cssKeyframesDriver=new GE}validateStyleProperty(e){return W_(e)}matchesElement(e,t){return j_(e,t)}containsElement(e,t){return Z_(e,t)}query(e,t,n){return Y_(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const l={},c=s.filter(e=>e instanceof qE);wC(n,r)&&c.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const u=kE(e,t=SC(e,t=t.map(e=>cC(e,!1)),l));return new qE(e,t,a,u)}}function jE(){return M_()&&Element.prototype.animate||{}}let ZE=(()=>{class e extends b_{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:Ue.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?O_(e):e;return JE(this._renderer,null,t,"register",[n]),new YE(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(Or(hc),Or(Lh))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class YE extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new KE(this._id,e,t||{},this._renderer)}}class KE{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return JE(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function JE(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const QE="@.disabled";let XE=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new ew("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const s=t=>{Array.isArray(t)?t.forEach(s):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(s),new tw(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(Or(hc),Or(IE),Or(ih))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();class ew{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){"@"==t.charAt(0)&&t==QE?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class tw extends ew{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==QE?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if("@"==t.charAt(0)){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let nw=(()=>{class e extends IE{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh),Or(Q_),Or(ZC))},e.\u0275prov=Se({token:e,factory:e.\u0275fac}),e})();const rw=new or("AnimationModuleType"),iw=[{provide:b_,useClass:ZE},{provide:ZC,useFactory:function(){return new YC}},{provide:IE,useClass:nw},{provide:hc,useFactory:function(e,t,n){return new XE(e,t,n)},deps:[gp,IE,ih]}],sw=[{provide:Q_,useFactory:function(){return"function"==typeof jE()?new WE:new GE}},{provide:rw,useValue:"BrowserAnimations"},...iw],ow=[{provide:Q_,useClass:J_},{provide:rw,useValue:"NoopAnimations"},...iw];let aw=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?ow:sw}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:sw,imports:[kp]}),e})();var lw=n(9575),cw=n.n(lw);function uw(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function hw(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){uw(s,r,i,o,a,"next",e)}function a(e){uw(s,r,i,o,a,"throw",e)}o(void 0)})}}class dw{static expectToBe(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error(`A default switch case did not observe the correct value, expected ${t}, but got ${e} instead.`)}static expectToBeMultiple(e,t){let n=!1;for(const r of t)if(e===r){n=!0;break}if(!1===n)throw new Error(`A default switch case did not observe the correct value, expected a value among ${t}, but got ${e} instead.`)}static getNonNullable(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}function pw(e,t){e&&console.log(t)}function fw(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);{const n=e,r=t;for(const e of Object.keys(n)){if(!(e in r))return!1;if(!1===fw(n[e],r[e]))return!1}return!0}}return e===t}function gw(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(const t in e)if(null!=e[t]&&!1===gw(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function mw(e,t){if(gw(e)&&gw(t))return fw(e,t);throw new Error(`Comparing non comparable objects: ${e.constructor.name} and ${t.constructor.name}`)}class yw{constructor(e){this.value=e}static of(e){return new yw(e)}static ofNullable(e){return null==e?yw.empty():yw.of(e)}static empty(){return new yw(null)}isPresent(){return null!=this.value}isAbsent(){return null==this.value}get(){if(this.isPresent())return this.value;throw new Error("Value is absent")}getOrElse(e){return this.isPresent()?this.value:e}equals(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&mw(this.value,e.value)}equalsValue(e){return this.equals(yw.of(e))}toString(){return this.isAbsent()?"MGPOptional.empty()":`MGPOptional.of(${this.value})`}map(e){return this.isPresent()?yw.of(e(this.get())):yw.empty()}}const vw=function(e,t){if(!e)throw _w(t)},_w=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},Cw=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Ew={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0;let c=(15&o)<<2|l>>6,u=63&l;a||(u=64,s||(c=64)),r.push(n[t>>2],n[(3&t)<<4|o>>4],n[c],n[u])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Cw(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();r.push(t<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},ww=function(e){const t=Cw(e);return Ew.encodeByteArray(t,!0)},Sw=function(e){return ww(e).replace(/\./g,"")},bw=function(e){try{return Ew.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Pw(e){return Ow(void 0,e)}function Ow(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)!t.hasOwnProperty(n)||!Tw(n)||(e[n]=Ow(e[n],t[n]));return e}function Tw(e){return"__proto__"!==e}class Iw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function kw(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Sw(JSON.stringify({alg:"none",type:"JWT"})),Sw(JSON.stringify(s)),""].join(".")}function Aw(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Mw(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Aw())}function Nw(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function xw(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Rw(){const e=Aw();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Dw(){return"object"==typeof indexedDB}function Lw(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function Fw(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Uw extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Uw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bw.prototype.create)}}class Bw{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Vw,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error";return new Uw(r,`${this.serviceName}: ${s} (${r}).`,n)}}const Vw=/\{\$([^}]+)}/g;function $w(e){return JSON.parse(e)}function zw(e){return JSON.stringify(e)}const Hw=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=$w(bw(s[0])||""),n=$w(bw(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}};function Gw(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function qw(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Ww(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function jw(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Zw(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(Yw(n)&&Yw(s)){if(!Zw(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Yw(e){return null!==e&&"object"==typeof e}function Kw(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Jw(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Qw(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Xw{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=l^o&(a^l),i=1518500249):(r=o^a^l,i=1859775393):u<60?(r=o&a|l&(o|a),i=2400959708):(r=o^a^l,i=3395469782);const e=(s<<5|s>>>27)+r+c+i+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class eS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of["next","error","complete"])if(n in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=tS),void 0===r.error&&(r.error=tS),void 0===r.complete&&(r.complete=tS);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tS(){}function nS(e,t){return`${e} failed: ${t} argument `}const rS=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function iS(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function sS(e){return e&&e._delegate?e._delegate:e}class oS{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const aS="[DEFAULT]";class lS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Iw;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:aS})}catch{}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=aS){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return hw(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=aS){return this.instances.has(e)}getOptions(e=aS){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===aS?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=aS){return this.component?this.component.multipleInstances?e:aS:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class cS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const uS=[];var hS=(()=>{return(e=hS||(hS={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",hS;var e})();const dS={debug:hS.DEBUG,verbose:hS.VERBOSE,info:hS.INFO,warn:hS.WARN,error:hS.ERROR,silent:hS.SILENT},pS=hS.INFO,fS={[hS.DEBUG]:"log",[hS.VERBOSE]:"log",[hS.INFO]:"info",[hS.WARN]:"warn",[hS.ERROR]:"error"},gS=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=fS[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class mS{constructor(e){this.name=e,this._logLevel=pS,this._logHandler=gS,this._userLogHandler=null,uS.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in hS))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?dS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,hS.DEBUG,...e),this._logHandler(this,hS.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,hS.VERBOSE,...e),this._logHandler(this,hS.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,hS.INFO,...e),this._logHandler(this,hS.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,hS.WARN,...e),this._logHandler(this,hS.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,hS.ERROR,...e),this._logHandler(this,hS.ERROR,...e)}}class yS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const vS="@firebase/app",_S=new mS("@firebase/app"),CS="[DEFAULT]",ES={[vS]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},wS=new Map,SS=new Map;function bS(e,t){try{e.container.addComponent(t)}catch(n){_S.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function PS(e){const t=e.name;if(SS.has(t))return _S.debug(`There were multiple attempts to register component ${t}.`),!1;SS.set(t,e);for(const n of wS.values())bS(n,e);return!0}function OS(e,t){return e.container.getProvider(t)}const TS=new Bw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class IS{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new oS("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw TS.create("app-deleted",{appName:this._name})}}const kS="9.6.6";function AS(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:CS,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw TS.create("bad-app-name",{appName:String(r)});const i=wS.get(r);if(i){if(Zw(e,i.options)&&Zw(n,i.config))return i;throw TS.create("duplicate-app",{appName:r})}const s=new cS(r);for(const a of SS.values())s.addComponent(a);const o=new IS(e,n,s);return wS.set(r,o),o}function MS(e=CS){const t=wS.get(e);if(!t)throw TS.create("no-app",{appName:e});return t}function NS(){return Array.from(wS.values())}function xS(e,t,n){var r;let i=null!==(r=ES[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void _S.warn(e.join(" "))}PS(new oS(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}PS(new oS("platform-logger",e=>new yS(e),"PRIVATE")),xS(vS,"0.7.16",""),xS(vS,"0.7.16","esm2017"),xS("fire-js",""),xS("firebase","9.6.6","app");var RS=n(6676);const DS="@firebase/installations",LS="w:0.5.5",FS="FIS_v2",US=new Bw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function BS(e){return e instanceof Uw&&e.code.includes("request-failed")}function VS({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function $S(e){return{token:e.token,requestStatus:2,expiresIn:ZS(e.expiresIn),creationTime:Date.now()}}function zS(e,t){return HS.apply(this,arguments)}function HS(){return(HS=hw(function*(e,t){const n=(yield t.json()).error;return US.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})).apply(this,arguments)}function GS({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function qS(e,{refreshToken:t}){const n=GS(e);return n.append("Authorization",function(e){return`${FS} ${e}`}(t)),n}function WS(e){return jS.apply(this,arguments)}function jS(){return(jS=hw(function*(e){const t=yield e();return t.status>=500&&t.status<600?e():t})).apply(this,arguments)}function ZS(e){return Number(e.replace("s","000"))}function YS(e,t){return KS.apply(this,arguments)}function KS(){return(KS=hw(function*(e,{fid:t}){const n=VS(e),r={method:"POST",headers:GS(e),body:JSON.stringify({fid:t,authVersion:FS,appId:e.appId,sdkVersion:LS})},i=yield WS(()=>fetch(n,r));if(i.ok){const e=yield i.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:$S(e.authToken)}}throw yield zS("Create Installation",i)})).apply(this,arguments)}function JS(e){return new Promise(t=>{setTimeout(t,e)})}const QS=/^[cdef][\w-]{21}$/;function XS(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return QS.test(t)?t:""}catch{return""}}function eb(e){return`${e.appName}!${e.appId}`}const tb=new Map;function nb(e,t){const n=eb(e);rb(n,t),function(e,t){const n=(!ib&&"BroadcastChannel"in self&&(ib=new BroadcastChannel("[Firebase] FID Change"),ib.onmessage=e=>{rb(e.data.key,e.data.fid)}),ib);n&&n.postMessage({key:e,fid:t}),0===tb.size&&ib&&(ib.close(),ib=null)}(n,t)}function rb(e,t){const n=tb.get(e);if(n)for(const r of n)r(t)}let ib=null;const sb="firebase-installations-store";let ob=null;function ab(){return ob||(ob=(0,RS.openDb)("firebase-installations-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(sb)}})),ob}function lb(e,t){return cb.apply(this,arguments)}function cb(){return(cb=hw(function*(e,t){const n=eb(e),r=(yield ab()).transaction(sb,"readwrite"),i=r.objectStore(sb),s=yield i.get(n);return yield i.put(t,n),yield r.complete,(!s||s.fid!==t.fid)&&nb(e,t.fid),t})).apply(this,arguments)}function ub(e){return hb.apply(this,arguments)}function hb(){return(hb=hw(function*(e){const t=eb(e),n=(yield ab()).transaction(sb,"readwrite");yield n.objectStore(sb).delete(t),yield n.complete})).apply(this,arguments)}function db(e,t){return pb.apply(this,arguments)}function pb(){return(pb=hw(function*(e,t){const n=eb(e),r=(yield ab()).transaction(sb,"readwrite"),i=r.objectStore(sb),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.complete,o&&(!s||s.fid!==o.fid)&&nb(e,o.fid),o})).apply(this,arguments)}function fb(e){return gb.apply(this,arguments)}function gb(){return(gb=hw(function*(e){let t;const n=yield db(e,n=>{const r=mb(n),i=yb(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})).apply(this,arguments)}function mb(e){return wb(e||{fid:XS(),registrationStatus:0})}function yb(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(US.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return vb.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:_b(e)}:{installationEntry:t}}function vb(){return(vb=hw(function*(e,t){try{return lb(e,yield YS(e,t))}catch(n){throw BS(n)&&409===n.customData.serverCode?yield ub(e):yield lb(e,{fid:t.fid,registrationStatus:0}),n}})).apply(this,arguments)}function _b(e){return Cb.apply(this,arguments)}function Cb(){return(Cb=hw(function*(e){let t=yield Eb(e);for(;1===t.registrationStatus;)yield JS(100),t=yield Eb(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield fb(e);return n||t}return t})).apply(this,arguments)}function Eb(e){return db(e,e=>{if(!e)throw US.create("installation-not-found");return wb(e)})}function wb(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function Sb(e,t){return bb.apply(this,arguments)}function bb(){return(bb=hw(function*({appConfig:e,platformLoggerProvider:t},n){const r=Pb(e,n),i=qS(e,n),s=t.getImmediate({optional:!0});s&&i.append("x-firebase-client",s.getPlatformInfoString());const o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:LS}})},a=yield WS(()=>fetch(r,o));if(a.ok)return $S(yield a.json());throw yield zS("Generate Auth Token",a)})).apply(this,arguments)}function Pb(e,{fid:t}){return`${VS(e)}/${t}/authTokens:generate`}function Ob(e){return Tb.apply(this,arguments)}function Tb(){return(Tb=hw(function*(e,t=!1){let n;const r=yield db(e.appConfig,r=>{if(!xb(r))throw US.create("not-registered");const i=r.authToken;if(!t&&Rb(i))return r;if(1===i.requestStatus)return n=Ib(e,t),r;{if(!navigator.onLine)throw US.create("app-offline");const t=Db(r);return n=Mb(e,t),t}});return n?yield n:r.authToken})).apply(this,arguments)}function Ib(e,t){return kb.apply(this,arguments)}function kb(){return(kb=hw(function*(e,t){let n=yield Ab(e.appConfig);for(;1===n.authToken.requestStatus;)yield JS(100),n=yield Ab(e.appConfig);const r=n.authToken;return 0===r.requestStatus?Ob(e,t):r})).apply(this,arguments)}function Ab(e){return db(e,e=>{if(!xb(e))throw US.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Mb(e,t){return Nb.apply(this,arguments)}function Nb(){return(Nb=hw(function*(e,t){try{const n=yield Sb(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield lb(e.appConfig,r),n}catch(n){if(!BS(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield lb(e.appConfig,n)}else yield ub(e.appConfig);throw n}})).apply(this,arguments)}function xb(e){return void 0!==e&&2===e.registrationStatus}function Rb(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function Db(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function Lb(){return(Lb=hw(function*(e){const t=e,{installationEntry:n,registrationPromise:r}=yield fb(t.appConfig);return r?r.catch(console.error):Ob(t).catch(console.error),n.fid})).apply(this,arguments)}function Fb(){return(Fb=hw(function*(e,t=!1){const n=e;return yield Ub(n.appConfig),(yield Ob(n,t)).token})).apply(this,arguments)}function Ub(e){return Bb.apply(this,arguments)}function Bb(){return(Bb=hw(function*(e){const{registrationPromise:t}=yield fb(e);t&&(yield t)})).apply(this,arguments)}function Vb(e){return US.create("missing-app-config-values",{valueName:e})}const $b="installations";PS(new oS($b,e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw Vb("App Configuration");if(!e.name)throw Vb("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Vb(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:OS(t,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),PS(new oS("installations-internal",e=>{const t=OS(e.getProvider("app").getImmediate(),$b).getImmediate();return{getId:()=>function(e){return Lb.apply(this,arguments)}(t),getToken:e=>function(e){return Fb.apply(this,arguments)}(t,e)}},"PRIVATE")),xS(DS,"0.5.5"),xS(DS,"0.5.5","esm2017");const zb="@firebase/remote-config",Hb=new Bw("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class Gb{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}fetch(e){var t=this;return hw(function*(){const[n,r]=yield Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);if(r&&t.isCachedDataFresh(e.cacheMaxAgeMillis,n))return r;e.eTag=r&&r.eTag;const i=yield t.client.fetch(e),s=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===i.status&&s.push(t.storage.setLastSuccessfulFetchResponse(i)),yield Promise.all(s),i})()}}function qb(e=navigator){return e.languages&&e.languages[0]||e.language}class Wb{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}fetch(e){var t=this;return hw(function*(){const[n,r]=yield Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${t.projectId}/namespaces/${t.namespace}:fetch?key=${t.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},o={sdk_version:t.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:t.appId,language_code:qb()},a={method:"POST",headers:s,body:JSON.stringify(o)},l=fetch(i,a),c=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let u;try{yield Promise.race([l,c]),u=yield l}catch(g){let e="fetch-client-network";throw"AbortError"===g.name&&(e="fetch-timeout"),Hb.create(e,{originalErrorMessage:g.message})}let h=u.status;const d=u.headers.get("ETag")||void 0;let p,f;if(200===u.status){let e;try{e=yield u.json()}catch(m){throw Hb.create("fetch-client-parse",{originalErrorMessage:m.message})}p=e.entries,f=e.state}if("INSTANCE_STATE_UNSPECIFIED"===f?h=500:"NO_CHANGE"===f?h=304:("NO_TEMPLATE"===f||"EMPTY_CONFIG"===f)&&(p={}),304!==h&&200!==h)throw Hb.create("fetch-status",{httpStatus:h});return{status:h,eTag:d,config:p}})()}}class jb{constructor(e,t){this.client=e,this.storage=t}fetch(e){var t=this;return hw(function*(){const n=(yield t.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return t.attemptFetch(e,n)})()}attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r=this;return hw(function*(){yield function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(Hb.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,t);try{const t=yield r.client.fetch(e);return yield r.storage.deleteThrottleMetadata(),t}catch(i){if(!function(e){if(!(e instanceof Uw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(i))throw i;const t={throttleEndTimeMillis:Date.now()+iS(n),backoffCount:n+1};return yield r.storage.setThrottleMetadata(t),r.attemptFetch(e,t)}})()}}class Zb{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function Yb(e,t){const n=e.target.error||void 0;return Hb.create(t,{originalErrorMessage:n&&n.message})}const Kb="app_namespace_store";class Jb{constructor(e,t,n,r=function(){return new Promise((e,n)=>{try{const t=indexedDB.open("firebase_remote_config",1);t.onerror=e=>{n(Yb(e,"storage-open"))},t.onsuccess=t=>{e(t.target.result)},t.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(Kb,{keyPath:"compositeKey"})}}}catch(t){n(Hb.create("storage-open",{originalErrorMessage:t}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(e){var t=this;return hw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([Kb],"readonly").objectStore(Kb),o=t.createCompositeKey(e);try{const e=s.get(o);e.onerror=e=>{i(Yb(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;r(t?t.value:void 0)}}catch(a){i(Hb.create("storage-get",{originalErrorMessage:a&&a.message}))}})})()}set(e,t){var n=this;return hw(function*(){const r=yield n.openDbPromise;return new Promise((i,s)=>{const o=r.transaction([Kb],"readwrite").objectStore(Kb),a=n.createCompositeKey(e);try{const e=o.put({compositeKey:a,value:t});e.onerror=e=>{s(Yb(e,"storage-set"))},e.onsuccess=()=>{i()}}catch(l){s(Hb.create("storage-set",{originalErrorMessage:l&&l.message}))}})})()}delete(e){var t=this;return hw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{const s=n.transaction([Kb],"readwrite").objectStore(Kb),o=t.createCompositeKey(e);try{const e=s.delete(o);e.onerror=e=>{i(Yb(e,"storage-delete"))},e.onsuccess=()=>{r()}}catch(a){i(Hb.create("storage-delete",{originalErrorMessage:a&&a.message}))}})})()}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class Qb{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var e=this;return hw(function*(){const t=e.storage.getLastFetchStatus(),n=e.storage.getLastSuccessfulFetchTimestampMillis(),r=e.storage.getActiveConfig(),i=yield t;i&&(e.lastFetchStatus=i);const s=yield n;s&&(e.lastSuccessfulFetchTimestampMillis=s);const o=yield r;o&&(e.activeConfig=o)})()}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function Xb(){return eP.apply(this,arguments)}function eP(){return(eP=hw(function*(){if(!Dw())return!1;try{return yield Lw()}catch{return!1}})).apply(this,arguments)}PS(new oS("remote-config",function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw Hb.create("registration-window");if(!Dw())throw Hb.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw Hb.create("registration-project-id");if(!s)throw Hb.create("registration-api-key");if(!o)throw Hb.create("registration-app-id");const a=new Jb(o,n.name,t=t||"firebase"),l=new Qb(a),c=new mS(zb);c.logLevel=hS.ERROR;const u=new Wb(r,kS,t,i,s,o),h=new jb(u,a),d=new Gb(h,a,l,c),p=new Zb(n,d,l,a,c);return function(e){const t=sS(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0}))}(p),p},"PUBLIC").setMultipleInstances(!0)),xS(zb,"0.3.4"),xS(zb,"0.3.4","esm2017");const tP="/firebase-messaging-sw.js",nP="/firebase-cloud-messaging-push-scope",rP="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",iP="google.c.a.c_id",sP="google.c.a.c_l",oP="google.c.a.ts",aP="google.c.a.e";var lP=(()=>(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(lP||(lP={})),lP))();function cP(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function uP(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}const hP="fcm_token_details_db",dP="fcm_token_object_Store";function pP(e){return fP.apply(this,arguments)}function fP(){return(fP=hw(function*(e){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(hP))return null;let t=null;return(yield(0,RS.openDb)(hP,5,function(){var n=hw(function*(n){var r;if(n.oldVersion<2||!n.objectStoreNames.contains(dP))return;const i=n.transaction.objectStore(dP),s=yield i.index("fcmSenderId").get(e);if(yield i.clear(),s)if(2===n.oldVersion){const e=s;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(r=e.createTime)&&void 0!==r?r:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:cP(e.vapidKey)}}}else if(3===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:cP(e.auth),p256dh:cP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:cP(e.vapidKey)}}}else if(4===n.oldVersion){const e=s;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:cP(e.auth),p256dh:cP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:cP(e.vapidKey)}}}});return function(e){return n.apply(this,arguments)}}())).close(),yield(0,RS.deleteDb)(hP),yield(0,RS.deleteDb)("fcm_vapid_details_db"),yield(0,RS.deleteDb)("undefined"),gP(t)?t:null})).apply(this,arguments)}function gP(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}const mP="firebase-messaging-store";let yP=null;function vP(){return yP||(yP=(0,RS.openDb)("firebase-messaging-database",1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(mP)}})),yP}function _P(e){return CP.apply(this,arguments)}function CP(){return(CP=hw(function*(e){const t=PP(e),n=yield(yield vP()).transaction(mP).objectStore(mP).get(t);if(n)return n;{const t=yield pP(e.appConfig.senderId);if(t)return yield EP(e,t),t}})).apply(this,arguments)}function EP(e,t){return wP.apply(this,arguments)}function wP(){return(wP=hw(function*(e,t){const n=PP(e),r=(yield vP()).transaction(mP,"readwrite");return yield r.objectStore(mP).put(t,n),yield r.complete,t})).apply(this,arguments)}function SP(e){return bP.apply(this,arguments)}function bP(){return(bP=hw(function*(e){const t=PP(e),n=(yield vP()).transaction(mP,"readwrite");yield n.objectStore(mP).delete(t),yield n.complete})).apply(this,arguments)}function PP({appConfig:e}){return e.appId}const OP=new Bw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function TP(e,t){return IP.apply(this,arguments)}function IP(){return(IP=hw(function*(e,t){const n=yield RP(e),r=LP(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(xP(e.appConfig),i)).json()}catch(o){throw OP.create("token-subscribe-failed",{errorInfo:o})}if(s.error)throw OP.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw OP.create("token-subscribe-no-token");return s.token})).apply(this,arguments)}function kP(e,t){return AP.apply(this,arguments)}function AP(){return(AP=hw(function*(e,t){const n=yield RP(e),r=LP(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{s=yield(yield fetch(`${xP(e.appConfig)}/${t.token}`,i)).json()}catch(o){throw OP.create("token-update-failed",{errorInfo:o})}if(s.error)throw OP.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw OP.create("token-update-no-token");return s.token})).apply(this,arguments)}function MP(e,t){return NP.apply(this,arguments)}function NP(){return(NP=hw(function*(e,t){const n={method:"DELETE",headers:yield RP(e)};try{const r=yield(yield fetch(`${xP(e.appConfig)}/${t}`,n)).json();if(r.error)throw OP.create("token-unsubscribe-failed",{errorInfo:r.error.message})}catch(r){throw OP.create("token-unsubscribe-failed",{errorInfo:r})}})).apply(this,arguments)}function xP({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function RP(e){return DP.apply(this,arguments)}function DP(){return(DP=hw(function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})).apply(this,arguments)}function LP({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==rP&&(i.web.applicationPubKey=r),i}function FP(e){return UP.apply(this,arguments)}function UP(){return(UP=hw(function*(e){const t=yield qP(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:cP(t.getKey("auth")),p256dh:cP(t.getKey("p256dh"))},r=yield _P(e.firebaseDependencies);if(r){if(jP(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?$P(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{yield MP(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return HP(e.firebaseDependencies,n)}return HP(e.firebaseDependencies,n)})).apply(this,arguments)}function BP(e){return VP.apply(this,arguments)}function VP(){return(VP=hw(function*(e){const t=yield _P(e.firebaseDependencies);t&&(yield MP(e.firebaseDependencies,t.token),yield SP(e.firebaseDependencies));const n=yield e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()})).apply(this,arguments)}function $P(e,t){return zP.apply(this,arguments)}function zP(){return(zP=hw(function*(e,t){try{const n=yield kP(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield EP(e.firebaseDependencies,r),n}catch(n){throw yield BP(e),n}})).apply(this,arguments)}function HP(e,t){return GP.apply(this,arguments)}function GP(){return(GP=hw(function*(e,t){const n={token:yield TP(e,t),createTime:Date.now(),subscriptionOptions:t};return yield EP(e,n),n.token})).apply(this,arguments)}function qP(e,t){return WP.apply(this,arguments)}function WP(){return(WP=hw(function*(e,t){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:uP(t)})})).apply(this,arguments)}function jP(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function ZP(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i)}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){if(!t.fcmOptions)return;e.fcmOptions={};const n=t.fcmOptions.link;n&&(e.fcmOptions.link=n);const r=t.fcmOptions.analytics_label;r&&(e.fcmOptions.analyticsLabel=r)}(t,e),t}function YP(e){return"object"==typeof e&&!!e&&iP in e}function KP(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function JP(e){return OP.create("missing-app-config-values",{valueName:e})}KP("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),KP("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class QP{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw JP("App Configuration Object");if(!e.name)throw JP("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw JP(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function XP(e){return eO.apply(this,arguments)}function eO(){return(eO=hw(function*(e){try{e.swRegistration=yield navigator.serviceWorker.register(tP,{scope:nP}),e.swRegistration.update().catch(()=>{})}catch(t){throw OP.create("failed-service-worker-registration",{browserErrorMessage:t.message})}})).apply(this,arguments)}function tO(e,t){return nO.apply(this,arguments)}function nO(){return(nO=hw(function*(e,t){if(!t&&!e.swRegistration&&(yield XP(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw OP.create("invalid-sw-registration");e.swRegistration=t}})).apply(this,arguments)}function rO(e,t){return iO.apply(this,arguments)}function iO(){return(iO=hw(function*(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=rP)})).apply(this,arguments)}function sO(){return(sO=hw(function*(e,t){if(!navigator)throw OP.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw OP.create("permission-blocked");return yield rO(e,null==t?void 0:t.vapidKey),yield tO(e,null==t?void 0:t.serviceWorkerRegistration),FP(e)})).apply(this,arguments)}function oO(e,t,n){return aO.apply(this,arguments)}function aO(){return(aO=hw(function*(e,t,n){const r=lO(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[iP],message_name:n[sP],message_time:n[oP],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function lO(e){switch(e){case lP.NOTIFICATION_CLICKED:return"notification_open";case lP.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function cO(){return(cO=hw(function*(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===lP.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(ZP(n)):e.onMessageHandler.next(ZP(n)));const r=n.data;YP(r)&&"1"===r[aP]&&(yield oO(e,n.messageType,r))})).apply(this,arguments)}const uO="@firebase/messaging";function hO(){return dO.apply(this,arguments)}function dO(){return(dO=hw(function*(){try{yield Lw()}catch{return!1}return"undefined"!=typeof window&&Dw()&&Fw()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}PS(new oS("messaging",e=>{const t=new QP(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>function(e,t){return cO.apply(this,arguments)}(t,e)),t},"PUBLIC")),PS(new oS("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>function(e,t){return sO.apply(this,arguments)}(t,e)}},"PRIVATE")),xS(uO,"0.9.8"),xS(uO,"0.9.8","esm2017");const pO="analytics",fO="firebase_id",gO="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",mO="https://www.googletagmanager.com/gtag/js",yO=new mS("@firebase/analytics");function vO(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function _O(e,t){const n=document.createElement("script");n.src=`${mO}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function CO(e,t,n,r,i,s){return EO.apply(this,arguments)}function EO(){return(EO=hw(function*(e,t,n,r,i,s){const o=r[i];try{if(o)yield t[o];else{const e=(yield vO(n)).find(e=>e.measurementId===i);e&&(yield t[e.appId])}}catch(a){yO.error(a)}e("config",i,s)})).apply(this,arguments)}function wO(e,t,n,r,i){return SO.apply(this,arguments)}function SO(){return(SO=hw(function*(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=yield vO(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),yield Promise.all(s),e("event",r,i||{})}catch(s){yO.error(s)}})).apply(this,arguments)}function bO(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(mO))return t;return null}const PO=new Bw("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),OO=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function TO(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function IO(e){return kO.apply(this,arguments)}function kO(){return(kO=hw(function*(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:TO(r)},s=gO.replace("{app-id}",n),o=yield fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=yield o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch{}throw PO.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()})).apply(this,arguments)}function AO(e){return MO.apply(this,arguments)}function MO(){return(MO=hw(function*(e,t=OO,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw PO.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw PO.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new LO;return setTimeout(hw(function*(){a.abort()}),void 0!==n?n:6e4),NO({appId:r,apiKey:i,measurementId:s},o,a,t)})).apply(this,arguments)}function NO(e,t,n){return xO.apply(this,arguments)}function xO(){return(xO=hw(function*(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=OO){const{appId:s,measurementId:o}=e;try{yield RO(r,t)}catch(a){if(o)return yO.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}try{const t=yield IO(e);return i.deleteThrottleMetadata(s),t}catch(a){if(!DO(a)){if(i.deleteThrottleMetadata(s),o)return yO.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}const t=503===Number(a.customData.httpStatus)?iS(n,i.intervalMillis,30):iS(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return i.setThrottleMetadata(s,l),yO.debug(`Calling attemptFetch again in ${t} millis`),NO(e,l,r,i)}})).apply(this,arguments)}function RO(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(PO.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function DO(e){if(!(e instanceof Uw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class LO{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}function FO(){return UO.apply(this,arguments)}function UO(){return(UO=hw(function*(){if(!Dw())return yO.warn(PO.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield Lw()}catch(e){return yO.warn(PO.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0})).apply(this,arguments)}function BO(){return(BO=hw(function*(e,t,n,r,i,s,o){var a;const l=AO(e);l.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&yO.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>yO.error(e)),t.push(l);const c=FO().then(e=>{if(e)return r.getId()}),[u,h]=yield Promise.all([l,c]);bO()||_O(s,u.measurementId),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d[fO]=h),i("config",u.measurementId,d),u.measurementId})).apply(this,arguments)}class VO{constructor(e){this.app=e}_delete(){return delete $O[this.app.options.appId],Promise.resolve()}}let $O={},zO=[];const HO={};let GO,qO,WO="dataLayer",jO=!1;function ZO(e,t,n){!function(){const e=[];if(Nw()&&e.push("This is a browser extension environment."),Fw()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=PO.create("invalid-analytics-context",{errorInfo:t});yO.warn(n.message)}}();const r=e.options.appId;if(!r)throw PO.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw PO.create("no-api-key");yO.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=$O[r])throw PO.create("already-exists",{id:r});if(!jO){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(WO);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){function i(){return(i=hw(function*(i,s,o){try{"event"===i?yield wO(e,t,n,s,o):"config"===i?yield CO(e,t,n,r,s,o):e("set",s)}catch(a){yO.error(a)}})).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}($O,zO,HO,WO,"gtag");qO=e,GO=t,jO=!0}return $O[r]=function(e,t,n,r,i,s,o){return BO.apply(this,arguments)}(e,zO,HO,t,GO,WO,n),new VO(e)}function YO(){return(YO=hw(function*(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=yield t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}})).apply(this,arguments)}function KO(){return JO.apply(this,arguments)}function JO(){return(JO=hw(function*(){if(Nw()||!Fw()||!Dw())return!1;try{return yield Lw()}catch{return!1}})).apply(this,arguments)}const QO="@firebase/analytics";PS(new oS(pO,(e,{options:t})=>ZO(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),PS(new oS("analytics-internal",function(e){try{const t=e.getProvider(pO).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=sS(e),function(e,t,n,r,i){return YO.apply(this,arguments)}(qO,$O[e.app.options.appId],t,n,r).catch(e=>yO.error(e))}(t,e,n,r)}}catch(t){throw PO.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),xS(QO,"0.7.5"),xS(QO,"0.7.5","esm2017");class XO extends a{constructor(e,t){super()}schedule(e,t=0){return this}}const eT={setInterval(...e){const{delegate:t}=eT;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=eT;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0};class tT extends XO{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return eT.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;eT.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,o(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const nT={now:()=>(nT.delegate||Date).now(),delegate:void 0};class rT{constructor(e,t=rT.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}rT.now=nT.now;class iT extends rT{constructor(e,t=rT.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}const sT=new class extends iT{}(class extends tT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!=n&&n>0||null==n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}),oT=new iT(tT),aT=new gc("7.2.0"),lT="__angularfire_symbol__analyticsIsSupported",cT="__angularfire_symbol__remoteConfigIsSupported",uT="__angularfire_symbol__messagingIsSupported";function hT(e,t,n){if(t){if(1===t.length)return t[0];const e=t.filter(e=>e.app===n);if(1===e.length)return e[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[lT]||(globalThis[lT]=KO().then(e=>globalThis.__angularfire_symbol__analyticsIsSupportedValue=e)),globalThis[uT]||(globalThis[uT]=hO().then(e=>globalThis.__angularfire_symbol__messagingIsSupportedValue=e)),globalThis[cT]||(globalThis[cT]=Xb().then(e=>globalThis.__angularfire_symbol__remoteConfigIsSupportedValue=e));const dT=(e,t)=>{const n=t?[t]:NS(),r=[];return n.forEach(t=>{t.container.getProvider(e).instances.forEach(e=>{r.includes(e)||r.push(e)})}),r};function pT(){}class fT{constructor(e,t=sT){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class gT{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",pT,{},pT,pT)),t.pipe(Sm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let mT=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new fT(Zone.current)),this.insideAngular=e.run(()=>new fT(Zone.current,oT)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(Or(ih))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function yT(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function vT(e){return yT().ngZone.runOutsideAngular(()=>e())}function _T(e){return yT().ngZone.run(()=>e())}function CT(e){return yT(),function(e){return function(t){return(t=t.lift(new gT(e.ngZone))).pipe(se(e.outsideAngular),ie(e.insideAngular))}}(yT())(e)}const ET=(e,t)=>{const n=void 0;return function(){return t&&setTimeout(()=>{"scheduled"===t.state&&t.invoke()},10),_T(()=>e.apply(n,arguments))}},wT=(e,t)=>function(){let n;for(let e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&(t&&(n||(n=_T(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",pT,{},pT,pT)))),arguments[e]=ET(arguments[e],n));const r=vT(()=>e.apply(this,arguments));if(!t){if(r instanceof T){const e=yT();return r.pipe(se(e.outsideAngular),ie(e.insideAngular))}return _T(()=>r)}return r instanceof T?r.pipe(CT):r instanceof Promise?_T(()=>new Promise((e,t)=>r.then(t=>_T(()=>e(t)),e=>_T(()=>t(e))))):"function"==typeof r&&n?function(){return setTimeout(()=>{n&&"scheduled"===n.state&&n.invoke()},10),r.apply(this,arguments)}:_T(()=>r)};class ST{constructor(e){return e}}class bT{constructor(){return NS()}}const PT=new or("angularfire2._apps"),OT={provide:ST,useFactory:function(e){return e&&1===e.length?e[0]:new ST(MS())},deps:[[new Nr,PT]]},TT={provide:bT,deps:[[new Nr,PT]]};function IT(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new ST(r)}}let kT=(()=>{class e{constructor(e){xS("angularfire",aT.full,"core"),xS("angularfire",aT.full,"app"),xS("angular",mc.full,e.toString())}}return e.\u0275fac=function(t){return new(t||e)(Or(Hu))},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[OT,TT]}),e})();const AT=wT(AS,!0),MT=new Map,NT={activated:!1,tokenObservers:[]},xT={initialized:!1,enabled:!1};function RT(e){return MT.get(e)||NT}function DT(e,t){MT.set(e,t)}function LT(){return xT}class FT{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return hw(function*(){t.stop();try{t.pending=new Iw,yield function(e){return new Promise(t=>{setTimeout(t,e)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new Iw,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(n){t.retryPolicy(n)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const UT=new Bw("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function BT(e){if(!RT(e).activated)throw UT.create("use-before-activation",{appName:e.name})}function VT(e,t){return $T.apply(this,arguments)}function $T(){return($T=hw(function*({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=yield fetch(e,s)}catch(h){throw UT.create("fetch-network-error",{originalErrorMessage:h.message})}if(200!==o.status)throw UT.create("fetch-status-error",{httpStatus:o.status});try{a=yield o.json()}catch(h){throw UT.create("fetch-parse-error",{originalErrorMessage:h.message})}const l=a.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw UT.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const c=1e3*Number(l[1]),u=Date.now();return{token:a.attestationToken,expireTimeMillis:u+c,issuedAtTimeMillis:u}})).apply(this,arguments)}function zT(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}const HT="firebase-app-check-store";let GT=null;function qT(){return GT||(GT=new Promise((e,t)=>{try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(UT.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(HT,{keyPath:"compositeKey"})}}}catch(n){t(UT.create("storage-open",{originalErrorMessage:n.message}))}}),GT)}function WT(){return(WT=hw(function*(e,t){const n=(yield qT()).transaction(HT,"readwrite"),r=n.objectStore(HT).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(UT.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})})).apply(this,arguments)}const jT=new mS("@firebase/app-check");function ZT(e,t){return Dw()?function(e,t){return function(e,t){return WT.apply(this,arguments)}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{jT.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function YT(){return LT().enabled}function KT(){return JT.apply(this,arguments)}function JT(){return(JT=hw(function*(){const e=LT();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const QT={error:"UNKNOWN_ERROR"};function XT(e){return Ew.encodeString(JSON.stringify(e),!1)}function eI(e){return tI.apply(this,arguments)}function tI(){return(tI=hw(function*(e,t=!1){const n=e.app;BT(n);const r=RT(n);let i,s=r.token;if(!s){const e=yield r.cachedTokenPromise;e&&sI(e)&&(s=e)}if(!t&&s&&sI(s))return{token:s.token};let o,a=!1;if(YT()){r.exchangeTokenPromise||(r.exchangeTokenPromise=VT(zT(n,yield KT()),e.platformLoggerProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=yield r.exchangeTokenPromise;return yield ZT(n,t),DT(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=yield r.exchangeTokenPromise}catch(l){"appCheck/throttled"===l.code?jT.warn(l.message):jT.error(l),i=l}return s?(o={token:s.token},DT(n,Object.assign(Object.assign({},r),{token:s})),yield ZT(n,s)):o=oI(i),a&&iI(n,o),o})).apply(this,arguments)}function nI(e,t){const n=RT(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),DT(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function rI(e){const{app:t}=e,n=RT(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new FT(hw(function*(){let n;if(n=RT(t).token?yield eI(e,!0):yield eI(e),n.error)throw n.error}),()=>!0,()=>{const e=RT(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),DT(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function iI(e,t){const n=RT(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch{}}function sI(e){return e.expireTimeMillis-Date.now()>0}function oI(e){return{token:XT(QT),error:e}}class aI{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=RT(this.app);for(const t of e)nI(this.app,t.next);return Promise.resolve()}}const lI="app-check-internal";PS(new oS("app-check",e=>function(e,t){return new aI(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("platform-logger")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(lI).initialize()})),PS(new oS(lI,e=>function(e){return{getToken:t=>eI(e,t),addTokenListener:t=>function(e,t,n,r){const{app:i}=e,s=RT(i),o={next:n,error:r,type:t};if(DT(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&sI(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),rI(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>rI(e))}(e,"INTERNAL",t),removeTokenListener:t=>nI(e.app,t)}}(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),xS("@firebase/app-check","0.5.3");class cI{constructor(){return dT("app-check")}}"undefined"!=typeof window&&window;const uI=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},hI=new Bw("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),dI=new mS("@firebase/auth");function pI(e,...t){dI.logLevel<=hS.ERROR&&dI.error(`Auth (9.6.6): ${e}`,...t)}function fI(e,...t){throw vI(e,...t)}function gI(e,...t){return vI(e,...t)}function mI(e,t,n){const r=Object.assign(Object.assign({},uI()),{[t]:n});return new Bw("auth","Firebase",r).create(t,{appName:e.name})}function yI(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&fI(e,"argument-error"),mI(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function vI(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return hI.create(e,...t)}function _I(e,t,...n){if(!e)throw vI(t,...n)}function CI(e){const t="INTERNAL ASSERTION FAILED: "+e;throw pI(t),new Error(t)}function EI(e,t){e||CI(t)}const wI=new Map;function SI(e){EI(e instanceof Function,"Expected a class definition");let t=wI.get(e);return t?(EI(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,wI.set(e,t),t)}function bI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function PI(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class OI{constructor(e,t){this.shortDelay=e,this.longDelay=t,EI(t>e,"Short delay should be less than long delay!"),this.isMobile=Mw()||xw()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===PI()||"https:"===PI()||Nw()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function TI(e,t){EI(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class II{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void CI("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void CI("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void CI("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const kI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},AI=new OI(3e4,6e4);function MI(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function NI(e,t,n,r){return xI.apply(this,arguments)}function xI(){return(xI=hw(function*(e,t,n,r,i={}){return RI(e,i,hw(function*(){let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=Kw(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),II.fetch()(UI(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))})).apply(this,arguments)}function RI(e,t,n){return DI.apply(this,arguments)}function DI(){return(DI=hw(function*(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},kI),t);try{const t=new BI(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw VI(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw VI(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw VI(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw mI(e,a,o);fI(e,a)}}catch(i){if(i instanceof Uw)throw i;fI(e,"network-request-failed")}})).apply(this,arguments)}function LI(e,t,n,r){return FI.apply(this,arguments)}function FI(){return(FI=hw(function*(e,t,n,r,i={}){const s=yield NI(e,t,n,r,i);return"mfaPendingCredential"in s&&fI(e,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function UI(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?TI(e.config,i):`${e.config.apiScheme}://${i}`}class BI{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(gI(this.auth,"network-request-failed")),AI.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function VI(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=gI(e,t,r);return i.customData._tokenResponse=n,i}function $I(){return($I=hw(function*(e,t){return NI(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function zI(e,t){return HI.apply(this,arguments)}function HI(){return(HI=hw(function*(e,t){return NI(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function GI(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function qI(){return(qI=hw(function*(e,t=!1){const n=sS(e),r=yield n.getIdToken(t),i=jI(r);_I(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:GI(WI(i.auth_time)),issuedAtTime:GI(WI(i.iat)),expirationTime:GI(WI(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function WI(e){return 1e3*Number(e)}function jI(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return pI("JWT malformed, contained fewer than 3 sections"),null;try{const e=bw(n);return e?JSON.parse(e):(pI("Failed to decode base64 JWT payload"),null)}catch(i){return pI("Caught error parsing JWT payload as JSON",i),null}}function ZI(e,t){return YI.apply(this,arguments)}function YI(){return(YI=hw(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(r){throw r instanceof Uw&&KI(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})).apply(this,arguments)}function KI({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class JI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(hw(function*(){yield t.iteration()}),n)}iteration(){var e=this;return hw(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&e.schedule(!0))}e.schedule()})()}}class QI{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=GI(this.lastLoginAt),this.creationTime=GI(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function XI(e){return ek.apply(this,arguments)}function ek(){return(ek=hw(function*(e){var t;const n=e.auth,r=yield e.getIdToken(),i=yield ZI(e,zI(n,{idToken:r}));_I(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?rk(s.providerUserInfo):[],a=nk(e.providerData,o),l=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new QI(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,c)})).apply(this,arguments)}function tk(){return(tk=hw(function*(e){const t=sS(e);yield XI(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function nk(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function rk(e){return e.map(e=>{var{providerId:t}=e,n=L(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function ik(){return(ik=hw(function*(e,t){const n=yield RI(e,{},hw(function*(){const n=Kw({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=UI(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",II.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class sk{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_I(e.idToken,"internal-error"),_I(void 0!==e.idToken,"internal-error"),_I(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=jI(e);return _I(t,"internal-error"),_I(void 0!==t.exp,"internal-error"),_I(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return hw(function*(){return _I(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return hw(function*(){const{accessToken:r,refreshToken:i,expiresIn:s}=yield function(e,t){return ik.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(r,i,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new sk;return n&&(_I("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(_I("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(_I("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sk,this.toJSON())}_performRefresh(){return CI("not implemented")}}function ok(e,t){_I("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ak{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=L(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new JI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new QI(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){var t=this;return hw(function*(){const n=yield ZI(t,t.stsTokenManager.getToken(t.auth,e));return _I(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return qI.apply(this,arguments)}(this,e)}reload(){return function(e){return tk.apply(this,arguments)}(this)}_assign(e){this!==e&&(_I(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new ak(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){_I(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return hw(function*(){let r=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield XI(n)),yield n.auth._persistUserIfCurrent(n),r&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return hw(function*(){const t=yield e.getIdToken();return yield ZI(e,function(e,t){return $I.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:_,isAnonymous:C,providerData:E,stsTokenManager:w}=t;_I(v&&w,e,"internal-error");const S=sk.fromJSON(this.name,w);_I("string"==typeof v,e,"internal-error"),ok(u,e.name),ok(h,e.name),_I("boolean"==typeof _,e,"internal-error"),_I("boolean"==typeof C,e,"internal-error"),ok(d,e.name),ok(p,e.name),ok(f,e.name),ok(g,e.name),ok(m,e.name),ok(y,e.name);const b=new ak({uid:v,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:C,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:S,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(b.providerData=E.map(e=>Object.assign({},e))),g&&(b._redirectEventId=g),b}static _fromIdTokenResponse(e,t,n=!1){return hw(function*(){const r=new sk;r.updateFromServerResponse(t);const i=new ak({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield XI(i),i})()}}const lk=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return hw(function*(){return!0})()}_set(e,t){var n=this;return hw(function*(){n.storage[e]=t})()}_get(e){var t=this;return hw(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return hw(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function ck(e,t,n){return`firebase:${e}:${t}:${n}`}class uk{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=ck(this.userKey,r.apiKey,i),this.fullPersistenceKey=ck("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return hw(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?ak._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return hw(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return hw(function*(){if(!t.length)return new uk(SI(lk),e,n);const r=(yield Promise.all(t.map(function(){var e=hw(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let i=r[0]||SI(lk);const s=ck(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){const r=ak._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&(yield i._set(s,o.toJSON())),yield Promise.all(t.map(function(){var e=hw(function*(e){if(e!==i)try{yield e._remove(s)}catch{}});return function(t){return e.apply(this,arguments)}}())),new uk(i,e,n)):new uk(i,e,n)})()}}function hk(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(gk(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(dk(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(yk(t))return"Blackberry";if(vk(t))return"Webos";if(pk(t))return"Safari";if((t.includes("chrome/")||fk(t))&&!t.includes("edge/"))return"Chrome";if(mk(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function dk(e=Aw()){return/firefox\//i.test(e)}function pk(e=Aw()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function fk(e=Aw()){return/crios\//i.test(e)}function gk(e=Aw()){return/iemobile/i.test(e)}function mk(e=Aw()){return/android/i.test(e)}function yk(e=Aw()){return/blackberry/i.test(e)}function vk(e=Aw()){return/webos/i.test(e)}function _k(e=Aw()){return/iphone|ipad|ipod/i.test(e)}function Ck(e=Aw()){return _k(e)||mk(e)||vk(e)||yk(e)||/windows phone/i.test(e)||gk(e)}function Ek(e,t=[]){let n;switch(e){case"Browser":n=hk(Aw());break;case"Worker":n=`${hk(Aw())}-${e}`;break;default:n=e}return`${n}/JsCore/9.6.6/${t.length?t.join(","):"FirebaseCore-web"}`}class wk{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bk(this),this.idTokenSubscription=new bk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=hI,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=SI(t)),this._initializationPromise=this.queue(hw(function*(){var r,i;if(!n._deleted&&(n.persistenceManager=yield uk.create(n,e),!n._deleted)){if(null===(r=n._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(i=n.currentUser)||void 0===i?void 0:i.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return hw(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t)}})()}initializeCurrentUser(e){var t=this;return hw(function*(){var n;let r=yield t.assertedPersistence.getCurrentUser();if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const i=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null==r?void 0:r._redirectEventId,o=yield t.tryRedirectSignIn(e);(!i||i===s)&&(null==o?void 0:o.user)&&(r=o.user)}return r?r._redirectEventId?(_I(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===r._redirectEventId?t.directlySetCurrentUser(r):t.reloadAndSetCurrentUserOrClear(r)):t.reloadAndSetCurrentUserOrClear(r):t.directlySetCurrentUser(null)})()}tryRedirectSignIn(e){var t=this;return hw(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return hw(function*(){try{yield XI(e)}catch(n){if("auth/network-request-failed"!==n.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return hw(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return hw(function*(){const n=e?sS(e):null;return n&&_I(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e){var t=this;return hw(function*(){if(!t._deleted)return e&&_I(t.tenantId===e.tenantId,t,"tenant-id-mismatch"),t.queue(hw(function*(){yield t.directlySetCurrentUser(e),t.notifyAuthListeners()}))})()}signOut(){var e=this;return hw(function*(){return(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null)})()}setPersistence(e){var t=this;return this.queue(hw(function*(){yield t.assertedPersistence.setPersistence(SI(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Bw("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return hw(function*(){const r=yield n.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return hw(function*(){if(!t.redirectPersistenceManager){const n=e&&SI(e)||t._popupRedirectResolver;_I(n,t,"argument-error"),t.redirectPersistenceManager=yield uk.create(t,[SI(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return hw(function*(){var n,r;return t._isInitialized&&(yield t.queue(hw(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return hw(function*(){if(e===t.currentUser)return t.queue(hw(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return _I(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return hw(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _I(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ek(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return hw(function*(){const t={"X-Client-Version":e.clientVersion};return e.app.options.appId&&(t["X-Firebase-gmpid"]=e.app.options.appId),t})()}}function Sk(e){return sS(e)}class bk{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new eS(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return _I(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Pk(e,t,n){const r=Sk(e);_I(r._canInitEmulator,r,"emulator-config-failed"),_I(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Ok(t),{host:o,port:a}=function(e){const t=Ok(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Tk(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Tk(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ok(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Tk(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ik{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return CI("not implemented")}_getIdTokenResponse(e){return CI("not implemented")}_linkToIdToken(e,t){return CI("not implemented")}_getReauthenticationResolver(e){return CI("not implemented")}}function kk(){return(kk=hw(function*(e,t){return NI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function Ak(){return(Ak=hw(function*(e,t){return LI(e,"POST","/v1/accounts:signInWithPassword",MI(e,t))})).apply(this,arguments)}function Mk(e,t){return Nk.apply(this,arguments)}function Nk(){return(Nk=hw(function*(e,t){return NI(e,"POST","/v1/accounts:sendOobCode",MI(e,t))})).apply(this,arguments)}function xk(e,t){return Rk.apply(this,arguments)}function Rk(){return(Rk=hw(function*(e,t){return Mk(e,t)})).apply(this,arguments)}function Dk(e,t){return Lk.apply(this,arguments)}function Lk(){return(Lk=hw(function*(e,t){return Mk(e,t)})).apply(this,arguments)}function Fk(){return(Fk=hw(function*(e,t){return LI(e,"POST","/v1/accounts:signInWithEmailLink",MI(e,t))})).apply(this,arguments)}function Uk(){return(Uk=hw(function*(e,t){return LI(e,"POST","/v1/accounts:signInWithEmailLink",MI(e,t))})).apply(this,arguments)}class Bk extends Ik{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Bk(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Bk(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return hw(function*(){switch(t.signInMethod){case"password":return function(e,t){return Ak.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return Fk.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:fI(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return hw(function*(){switch(n.signInMethod){case"password":return function(e,t){return kk.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return Uk.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:fI(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function Vk(e,t){return $k.apply(this,arguments)}function $k(){return($k=hw(function*(e,t){return LI(e,"POST","/v1/accounts:signInWithIdp",MI(e,t))})).apply(this,arguments)}class zk extends Ik{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new zk(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):fI("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=L(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new zk(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Vk(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Vk(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vk(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Kw(t)}return e}}class Hk{constructor(e){var t,n,r,i,s,o;const a=Jw(Qw(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);_I(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Jw(Qw(e)).link,n=t?Jw(Qw(t)).deep_link_id:null,r=Jw(Qw(e)).deep_link_id;return(r?Jw(Qw(r)).link:null)||r||n||t||e}(e);try{return new Hk(t)}catch{return null}}}let Gk=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Bk._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Hk.parseLink(t);return _I(n,"argument-error"),Bk._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class qk{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Wk extends qk{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let jk=(()=>{class e extends Wk{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return zk._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})();function Zk(e,t){return Yk.apply(this,arguments)}function Yk(){return(Yk=hw(function*(e,t){return LI(e,"POST","/v1/accounts:signUp",MI(e,t))})).apply(this,arguments)}class Kk{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return hw(function*(){const i=yield ak._fromIdTokenResponse(e,n,r),s=Jk(n);return new Kk({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return hw(function*(){yield e._updateTokensIfNecessary(n,!0);const r=Jk(n);return new Kk({user:e,providerId:r,_tokenResponse:n,operationType:t})})()}}function Jk(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Qk extends Uw{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Qk.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Qk(e,t,n,r)}}function Xk(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw"auth/multi-factor-auth-required"===n.code?Qk._fromErrorAndOperation(e,n,t,r):n})}function eA(e,t){return tA.apply(this,arguments)}function tA(){return(tA=hw(function*(e,t,n=!1){const r=yield ZI(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return Kk._forOperation(e,"link",r)})).apply(this,arguments)}function nA(){return(nA=hw(function*(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=yield ZI(e,Xk(r,i,t,e),n);_I(s.idToken,r,"internal-error");const o=jI(s.idToken);_I(o,r,"internal-error");const{sub:a}=o;return _I(e.uid===a,r,"user-mismatch"),Kk._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&fI(r,"user-mismatch"),s}})).apply(this,arguments)}function rA(e,t){return iA.apply(this,arguments)}function iA(){return(iA=hw(function*(e,t,n=!1){const r="signIn",i=yield Xk(e,r,t),s=yield Kk._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function sA(){return(sA=hw(function*(e,t){return rA(Sk(e),t)})).apply(this,arguments)}function oA(e,t,n){var r;_I((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),_I(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(_I(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(_I(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function aA(e,t,n){return lA.apply(this,arguments)}function lA(){return(lA=hw(function*(e,t,n){const r=sS(e),i={requestType:"PASSWORD_RESET",email:t};n&&oA(r,i,n),yield Dk(r,i)})).apply(this,arguments)}function cA(e,t,n){return uA.apply(this,arguments)}function uA(){return(uA=hw(function*(e,t,n){const r=Sk(e),i=yield Zk(r,{returnSecureToken:!0,email:t,password:n}),s=yield Kk._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(s.user),s})).apply(this,arguments)}function hA(e,t,n){return function(e,t){return sA.apply(this,arguments)}(sS(e),Gk.credential(t,n))}function dA(e,t){return pA.apply(this,arguments)}function pA(){return(pA=hw(function*(e,t){const n=sS(e),r={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&oA(n.auth,r,t);const{email:i}=yield xk(n.auth,r);i!==e.email&&(yield e.reload())})).apply(this,arguments)}function fA(e,t){return gA.apply(this,arguments)}function gA(){return(gA=hw(function*(e,t){return NI(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function mA(e,t){return yA.apply(this,arguments)}function yA(){return(yA=hw(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=sS(e),i={idToken:yield r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield ZI(r,fA(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),yield r._updateTokensIfNecessary(s)})).apply(this,arguments)}function vA(e,t,n,r){return sS(e).onAuthStateChanged(t,n,r)}new WeakMap;const _A="__sak";class CA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_A,"1"),this.storage.removeItem(_A),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const EA=(()=>{class e extends CA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Aw();return pk(e)||_k(e)}()&&function(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Ck(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Rw()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return hw(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return hw(function*(){const r=yield t().call(n,e);return n.localCache[e]=JSON.stringify(r),r})()}_remove(e){var t=()=>super._remove,n=this;return hw(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),wA=(()=>{class e extends CA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let SA=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return hw(function*(){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=t.handlersMap[i];if(!(null==o?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(function(){var e=hw(function*(e){return e(n.origin,s)});return function(t){return e.apply(this,arguments)}}()),l=yield function(e){return Promise.all(e.map(function(){var e=hw(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function bA(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class PA{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return hw(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=bA("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function OA(){return window}function TA(){return void 0!==OA().WorkerGlobalScope&&"function"==typeof OA().importScripts}function IA(){return(IA=hw(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const kA="firebaseLocalStorageDb",AA="firebaseLocalStorage",MA="fbase_key";class NA{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function xA(e,t){return e.transaction([AA],t?"readwrite":"readonly").objectStore(AA)}function RA(){const e=indexedDB.open(kA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(AA,{keyPath:MA})}catch(r){n(r)}}),e.addEventListener("success",hw(function*(){const n=e.result;n.objectStoreNames.contains(AA)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(kA);return new NA(e).toPromise()}(),t(yield RA()))}))})}function DA(e,t,n){return LA.apply(this,arguments)}function LA(){return(LA=hw(function*(e,t,n){const r=xA(e,!0).put({[MA]:t,value:n});return new NA(r).toPromise()})).apply(this,arguments)}function FA(){return(FA=hw(function*(e,t){const n=xA(e,!1).get(t),r=yield new NA(n).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function UA(e,t){const n=xA(e,!0).delete(t);return new NA(n).toPromise()}const BA=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return hw(function*(){return e.db||(e.db=yield RA()),e.db})()}_withRetries(e){var t=this;return hw(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(r){if(n++>3)throw r;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return hw(function*(){return TA()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return hw(function*(){e.receiver=SA._getInstance(TA()?self:null),e.receiver._subscribe("keyChanged",function(){var t=hw(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=hw(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return hw(function*(){var t,n;if(e.activeServiceWorker=yield function(){return IA.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new PA(e.activeServiceWorker);const r=yield e.sender._send("ping",{},800);!r||(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return hw(function*(){if(t.sender&&t.activeServiceWorker&&function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return hw(function*(){try{if(!indexedDB)return!1;const e=yield RA();return yield DA(e,_A,"1"),yield UA(e,_A),!0}catch{}return!1})()}_withPendingWrite(e){var t=this;return hw(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return hw(function*(){return n._withPendingWrite(hw(function*(){return yield n._withRetries(n=>DA(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return hw(function*(){const n=yield t._withRetries(t=>function(e,t){return FA.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return hw(function*(){return t._withPendingWrite(hw(function*(){return yield t._withRetries(t=>UA(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return hw(function*(){const t=yield e._withRetries(e=>{const t=xA(e,!1).getAll();return new NA(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of t)r.add(i),JSON.stringify(e.localCache[i])!==JSON.stringify(s)&&(e.notifyListeners(i,s),n.push(i));for(const i of Object.keys(e.localCache))e.localCache[i]&&!r.has(i)&&(e.notifyListeners(i,null),n.push(i));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval(hw(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function VA(e){return`__${e}${Math.floor(1e6*Math.random())}`}function $A(e,t){return t?SI(t):(_I(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}VA("rcb"),new OI(3e4,6e4);class zA extends Ik{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vk(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Vk(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Vk(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function HA(e){return rA(e.auth,new zA(e),e.bypassAuthState)}function GA(e){const{auth:t,user:n}=e;return _I(n,t,"internal-error"),function(e,t){return nA.apply(this,arguments)}(n,new zA(e),e.bypassAuthState)}function qA(e){return WA.apply(this,arguments)}function WA(){return(WA=hw(function*(e){const{auth:t,user:n}=e;return _I(n,t,"internal-error"),eA(n,new zA(e),e.bypassAuthState)})).apply(this,arguments)}class jA{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=hw(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(r){e.reject(r)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return hw(function*(){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const l={auth:t.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(l))}catch(c){t.reject(c)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return HA;case"linkViaPopup":case"linkViaRedirect":return qA;case"reauthViaPopup":case"reauthViaRedirect":return GA;default:fI(this.auth,"internal-error")}}resolve(e){EI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){EI(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ZA=new OI(2e3,1e4);function YA(e,t,n){return KA.apply(this,arguments)}function KA(){return(KA=hw(function*(e,t,n){const r=Sk(e);yI(e,t,qk);const i=$A(r,n);return new JA(r,"signInViaPopup",t,i).executeNotNull()})).apply(this,arguments)}let JA=(()=>{class e extends jA{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return hw(function*(){const t=yield e.execute();return _I(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return hw(function*(){EI(1===e.filter.length,"Popup operations only handle one event");const t=bA();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(gI(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(gI(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(gI(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,ZA.get())};e()}}return e.currentPopupAction=null,e})();const QA=new Map;class XA extends jA{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return hw(function*(){let n=QA.get(t.auth._key());if(!n){try{const r=(yield function(e,t){return eM.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(r)}catch(r){n=()=>Promise.reject(r)}QA.set(t.auth._key(),n)}return t.bypassAuthState||QA.set(t.auth._key(),()=>Promise.resolve(null)),n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return hw(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const r=yield n.auth._redirectUserForId(e.eventId);if(r)return n.user=r,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return hw(function*(){})()}cleanUp(){}}function eM(){return(eM=hw(function*(e,t){const n=nM(t),r=tM(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})).apply(this,arguments)}function tM(e){return SI(e._redirectPersistence)}function nM(e){return ck("pendingRedirect",e.config.apiKey,e.name)}function rM(e,t){return iM.apply(this,arguments)}function iM(){return(iM=hw(function*(e,t,n=!1){const r=Sk(e),i=$A(r,t),s=yield new XA(r,i,n).execute();return s&&!n&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})).apply(this,arguments)}class sM{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return aM(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!aM(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(gI(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(oM(e))}saveEventToCache(e){this.cachedEventUids.add(oM(e)),this.lastProcessedEventTime=Date.now()}}function oM(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function aM({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function lM(e){return cM.apply(this,arguments)}function cM(){return(cM=hw(function*(e,t={}){return NI(e,"GET","/v1/projects",t)})).apply(this,arguments)}const uM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hM=/^https?/;function dM(){return(dM=hw(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield lM(e);for(const n of t)try{if(pM(n))return}catch{}fI(e,"unauthorized-domain")})).apply(this,arguments)}function pM(e){const t=bI(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!hM.test(n))return!1;if(uM.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const fM=new OI(3e4,6e4);function gM(){const e=OA().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let mM=null;function yM(e){return mM=mM||function(e){return new Promise((t,n)=>{var r,i,s;function o(){gM(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{gM(),n(gI(e,"network-request-failed"))},timeout:fM.get()})}if(null===(i=null===(r=OA().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=OA().gapi)||void 0===s?void 0:s.load)){const t=VA("iframefcb");return OA()[t]=()=>{gapi.load?o():n(gI(e,"network-request-failed"))},function(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=gI("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw mM=null,e})}(e),mM}const vM=new OI(5e3,15e3),_M={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},CM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function EM(e){const t=e.config;_I(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?TI(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:kS},i=CM.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Kw(r).slice(1)}`}function wM(){return(wM=hw(function*(e){const t=yield yM(e),n=OA().gapi;return _I(n,e,"internal-error"),t.open({where:document.body,url:EM(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_M,dontclear:!0},t=>new Promise(function(){var n=hw(function*(n,r){yield t.restyle({setHideOnLeave:!1});const i=gI(e,"network-request-failed"),s=OA().setTimeout(()=>{r(i)},vM.get());function o(){OA().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const SM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class bM{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function PM(e,t,n,r,i,s){_I(e.config.authDomain,e,"auth-domain-config-required"),_I(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:kS,eventId:i};if(t instanceof qk){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Ww(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Wk){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];return`${function({config:e}){return e.emulator?TI(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Kw(a).slice(1)}`}const OM="webStorageSupport",TM=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wA,this._completeRedirectFn=rM}_openPopup(e,t,n,r){var i=this;return hw(function*(){var s;EI(null===(s=i.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");const o=PM(e,t,n,bI(),r);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},SM),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Aw().toLowerCase();n&&(a=fk(c)?"_blank":n),dk(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=Aw()){var t;return _k(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new bM(null);const h=window.open(t||"",a,u);_I(h,e,"popup-blocked");try{h.focus()}catch{}return new bM(h)}(e,o,bA())})()}_openRedirect(e,t,n,r){var i=this;return hw(function*(){return yield i._originValidation(e),function(e){OA().location.href=e}(PM(e,t,n,bI(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(EI(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){var t=this;return hw(function*(){const n=yield function(e){return wM.apply(this,arguments)}(e),r=new sM(e);return n.register("authEvent",t=>(_I(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=n,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(OM,{type:OM},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[OM];void 0!==i&&t(!!i),fI(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return dM.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ck()||pk()||_k()}};var IM="@firebase/auth";class kM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return hw(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_I(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function AM(e=MS()){const t=OS(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=OS(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Zw(n.getOptions(),t??{}))return e;fI(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:TM,persistence:[BA,EA,wA]})}!function(e){PS(new oS("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),{apiKey:i,authDomain:s}=r.options;return(t=>{_I(i&&!i.includes(":"),"invalid-api-key",{appName:t.name}),_I(!(null==s?void 0:s.includes(":")),"argument-error",{appName:t.name});const r={apiKey:i,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ek(e)},o=new wk(t,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(SI);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,n),o})(r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),PS(new oS("auth-internal",e=>{const t=Sk(e.getProvider("auth").getImmediate());return new kM(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),xS(IM,"0.19.8",void 0),xS(IM,"0.19.8","esm2017")}("Browser");class MM{constructor(e){return e}}class NM{constructor(){return dT("auth")}}const xM=new or("angularfire2.auth-instances");function RM(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new MM(r)}}const DM={provide:NM,deps:[[new Nr,xM]]},LM={provide:MM,useFactory:function(e,t){const n=hT("auth",e,t);return n&&new MM(n)},deps:[[new Nr,xM],ST]};let FM=(()=>{class e{constructor(){xS("angularfire",aT.full,"auth")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[LM,DM]}),e})();const UM=wT(Pk,!0),BM=wT(cA,!0),VM=wT(AM,!0),$M=wT(vA,!0),zM=wT(dA,!0),HM=wT(aA,!0),GM=wT(hA,!0),qM=wT(YA,!0),WM=wT(mA,!0);var jM,ZM="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},YM={},KM=KM||{},JM=ZM||self;function QM(){}function XM(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function eN(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var tN="closure_uid_"+(1e9*Math.random()>>>0),nN=0;function rN(e,t,n){return e.call.apply(e.bind,arguments)}function iN(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function sN(e,t,n){return(sN=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?rN:iN).apply(null,arguments)}function oN(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function aN(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function lN(){this.s=this.s,this.o=this.o}var cN={};lN.prototype.s=!1,lN.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,tN)&&e[tN]||(e[tN]=++nN)}(this);delete cN[e]}},lN.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const uN=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},hN=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function dN(e){return Array.prototype.concat.apply([],arguments)}function pN(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function fN(e){return/^[\s\xa0]*$/.test(e)}var gN,mN=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function yN(e,t){return-1!=e.indexOf(t)}function vN(e,t){return e<t?-1:e>t?1:0}e:{var _N=JM.navigator;if(_N){var CN=_N.userAgent;if(CN){gN=CN;break e}}gN=""}function EN(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function wN(e){const t={};for(const n in e)t[n]=e[n];return t}var SN="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bN(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<SN.length;t++)n=SN[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function PN(e){return PN[" "](e),e}PN[" "]=QM;var ON,TN=yN(gN,"Opera"),IN=yN(gN,"Trident")||yN(gN,"MSIE"),kN=yN(gN,"Edge"),AN=kN||IN,MN=yN(gN,"Gecko")&&!(yN(gN.toLowerCase(),"webkit")&&!yN(gN,"Edge"))&&!(yN(gN,"Trident")||yN(gN,"MSIE"))&&!yN(gN,"Edge"),NN=yN(gN.toLowerCase(),"webkit")&&!yN(gN,"Edge");function xN(){var e=JM.document;return e?e.documentMode:void 0}e:{var RN="",DN=function(){var e=gN;return MN?/rv:([^\);]+)(\)|;)/.exec(e):kN?/Edge\/([\d\.]+)/.exec(e):IN?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):NN?/WebKit\/(\S+)/.exec(e):TN?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(DN&&(RN=DN?DN[1]:""),IN){var LN=xN();if(null!=LN&&LN>parseFloat(RN)){ON=String(LN);break e}}ON=RN}var FN={};function UN(){return e=FN,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=mN(String(ON)).split("."),n=mN("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=vN(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||vN(0==i[2].length,0==s[2].length)||vN(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}var BN=JM.document&&IN&&(xN()||parseInt(ON,10))||void 0,VN=function(){if(!JM.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{JM.addEventListener("test",QM,t),JM.removeEventListener("test",QM,t)}catch{}return e}();function $N(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function zN(e,t){if($N.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(MN){e:{try{PN(t.nodeName);var i=!0;break e}catch{}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:HN[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&zN.Z.h.call(this)}}$N.prototype.h=function(){this.defaultPrevented=!0},aN(zN,$N);var HN={2:"touch",3:"pen",4:"mouse"};zN.prototype.h=function(){zN.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var GN="closure_listenable_"+(1e6*Math.random()|0),qN=0;function WN(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++qN,this.ca=this.fa=!1}function jN(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function ZN(e){this.src=e,this.g={},this.h=0}function YN(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=uN(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(jN(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function KN(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}ZN.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=KN(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new WN(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var JN="closure_lm_"+(1e6*Math.random()|0),QN={};function XN(e,t,n,r,i){if(r&&r.once)return tx(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)XN(e,t[s],n,r,i);return null}return n=lx(n),e&&e[GN]?e.N(t,n,eN(r)?!!r.capture:!!r,i):ex(e,t,n,!1,r,i)}function ex(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=eN(i)?!!i.capture:!!i,a=ox(e);if(a||(e[JN]=a=new ZN(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=sx;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)VN||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ix(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function tx(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)tx(e,t[s],n,r,i);return null}return n=lx(n),e&&e[GN]?e.O(t,n,eN(r)?!!r.capture:!!r,i):ex(e,t,n,!0,r,i)}function nx(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)nx(e,t[s],n,r,i);else r=eN(r)?!!r.capture:!!r,n=lx(n),e&&e[GN]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=KN(s=e.g[t],n,r,i))&&(jN(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ox(e))&&(t=e.g[t.toString()],e=-1,t&&(e=KN(t,n,r,i)),(n=-1<e?t[e]:null)&&rx(n))}function rx(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[GN])YN(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ix(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ox(t))?(YN(n,e),0==n.h&&(n.src=null,t[JN]=null)):jN(e)}}}function ix(e){return e in QN?QN[e]:QN[e]="on"+e}function sx(e,t){if(e.ca)e=!0;else{t=new zN(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&rx(e),e=n.call(r,t)}return e}function ox(e){return(e=e[JN])instanceof ZN?e:null}var ax="__closure_events_fn_"+(1e9*Math.random()>>>0);function lx(e){return"function"==typeof e?e:(e[ax]||(e[ax]=function(t){return e.handleEvent(t)}),e[ax])}function cx(){lN.call(this),this.i=new ZN(this),this.P=this,this.I=null}function ux(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new $N(t,e);else if(t instanceof $N)t.target=t.target||e;else{var i=t;bN(t=new $N(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=hx(o,r,!0,t)&&i}if(i=hx(o=t.g=e,r,!0,t)&&i,i=hx(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=hx(o=t.g=n[s],r,!1,t)&&i}function hx(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,l=o.ia||o.src;o.fa&&YN(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}aN(cx,lN),cx.prototype[GN]=!0,cx.prototype.removeEventListener=function(e,t,n,r){nx(this,e,t,n,r)},cx.prototype.M=function(){if(cx.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)jN(n[r]);delete t.g[e],t.h--}}this.I=null},cx.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},cx.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var dx=JM.JSON.stringify;function px(){var e=Cx;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var fx,gx=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new mx,e=>e.reset());class mx{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function yx(e){JM.setTimeout(()=>{throw e},0)}function vx(e,t){fx||function(){var e=JM.Promise.resolve(void 0);fx=function(){e.then(Ex)}}(),_x||(fx(),_x=!0),Cx.add(e,t)}var _x=!1,Cx=new class{constructor(){this.h=this.g=null}add(e,t){const n=gx.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Ex(){for(var e;e=px();){try{e.h.call(e.g)}catch(n){yx(n)}var t=gx;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}_x=!1}function wx(e,t){cx.call(this),this.h=e||1,this.g=t||JM,this.j=sN(this.kb,this),this.l=Date.now()}function Sx(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function bx(e,t,n){if("function"==typeof e)n&&(e=sN(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=sN(e.handleEvent,e)}return 2147483647<Number(t)?-1:JM.setTimeout(e,t||0)}function Px(e){e.g=bx(()=>{e.g=null,e.i&&(e.i=!1,Px(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}aN(wx,cx),(jM=wx.prototype).da=!1,jM.S=null,jM.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ux(this,"tick"),this.da&&(Sx(this),this.start()))}},jM.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},jM.M=function(){wx.Z.M.call(this),Sx(this),delete this.g};class Ox extends lN{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Px(this)}M(){super.M(),this.g&&(JM.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Tx(e){lN.call(this),this.h=e,this.g={}}aN(Tx,lN);var Ix=[];function kx(e,t,n,r){Array.isArray(n)||(n&&(Ix[0]=n.toString()),n=Ix);for(var i=0;i<n.length;i++){var s=XN(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ax(e){EN(e.g,function(e,t){this.g.hasOwnProperty(t)&&rx(e)},e),e.g={}}function Mx(){this.g=!0}function Nx(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return dx(n)}catch{return t}}(e,n)+(r?" "+r:"")})}Tx.prototype.M=function(){Tx.Z.M.call(this),Ax(this)},Tx.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mx.prototype.Aa=function(){this.g=!1},Mx.prototype.info=function(){};var xx={},Rx=null;function Dx(){return Rx=Rx||new cx}function Lx(e){$N.call(this,xx.Ma,e)}function Fx(e){const t=Dx();ux(t,new Lx(t,e))}function Ux(e,t){$N.call(this,xx.STAT_EVENT,e),this.stat=t}function Bx(e){const t=Dx();ux(t,new Ux(t,e))}function Vx(e,t){$N.call(this,xx.Na,e),this.size=t}function $x(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return JM.setTimeout(function(){e()},t)}xx.Ma="serverreachability",aN(Lx,$N),xx.STAT_EVENT="statevent",aN(Ux,$N),xx.Na="timingevent",aN(Vx,$N);var zx={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Hx={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Gx(){}function qx(){}Gx.prototype.h=null;var Wx,jx={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Zx(){$N.call(this,"d")}function Yx(){$N.call(this,"c")}function Kx(){}function Jx(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Tx(this),this.P=Xx,this.W=new wx(e=AN?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Qx}function Qx(){this.i=null,this.g="",this.h=!1}aN(Zx,$N),aN(Yx,$N),aN(Kx,Gx),Kx.prototype.g=function(){return new XMLHttpRequest},Kx.prototype.i=function(){return{}},Wx=new Kx;var Xx=45e3,eR={},tR={};function nR(e,t,n){e.K=1,e.v=PR(_R(t)),e.s=n,e.U=!0,rR(e,null)}function rR(e,t){e.F=Date.now(),aR(e),e.A=_R(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),UR(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Qx,e.g=UD(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Ox(sN(e.Ia,e,e.g),e.O)),kx(e.V,e.g,"readystatechange",e.gb),t=e.H?wN(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Fx(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function iR(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function sR(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=oR(e,n),r==tR){4==t&&(e.o=4,Bx(14),i=!1),Nx(e.j,e.m,null,"[Incomplete Response]");break}if(r==eR){e.o=4,Bx(15),Nx(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Nx(e.j,e.m,r,null),dR(e,r)}iR(e)&&r!=tR&&r!=eR&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Bx(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),AD(t),t.L=!0,Bx(11))):(Nx(e.j,e.m,n,"[Invalid Chunked Response]"),hR(e),uR(e))}function oR(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?tR:(n=Number(t.substring(n,r)),isNaN(n)?eR:(r+=1)+n>t.length?tR:(t=t.substr(r,n),e.C=r+n,t))}function aR(e){e.Y=Date.now()+e.P,lR(e,e.P)}function lR(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=$x(sN(e.eb,e),t)}function cR(e){e.B&&(JM.clearTimeout(e.B),e.B=null)}function uR(e){0==e.l.G||e.I||xD(e.l,e)}function hR(e){cR(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Sx(e.W),Ax(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function dR(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||GR(n.i,e)))if(n.I=e.N,!e.J&&GR(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=$x(sN(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;ND(n),ED(n)}kD(n),Bx(18)}if(1>=HR(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else DD(n,11)}else if((e.J||n.g==e)&&ND(n),!fN(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.U=c[0],c=c[1],2==n.G)if("c"==c[0]){n.J=c[1],n.la=c[2];const t=c[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=c[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(yN(e,"spdy")||yN(e,"quic")||yN(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(qR(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,bR(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=FD(r,r.H?r.la:null,r.W),o.J){WR(r.i,o);var a=o,l=r.K;l&&a.setTimeout(l),a.B&&(cR(a),aR(a)),r.g=o}else ID(r);0<n.l.length&&bD(n)}else"stop"!=c[0]&&"close"!=c[0]||DD(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?DD(n,7):CD(n):"noop"!=c[0]&&n.j&&n.j.wa(c),n.A=0)}Fx(4)}catch{}}function pR(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(XM(e)||"string"==typeof e)hN(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(XM(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(XM(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function fR(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof fR)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function gR(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];mR(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)mR(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function mR(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(jM=Jx.prototype).setTimeout=function(e){this.P=e},jM.gb=function(e){e=e.target;const t=this.L;t&&3==gD(e)?t.l():this.Ia(e)},jM.Ia=function(e){try{if(e==this.g)e:{const u=gD(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>u)&&(3!=u||AN||this.g&&(this.h.h||this.g.ga()||mD(this.g)))){this.I||4!=u||7==t||Fx(8==t||0>=h?3:2),cR(this);var n=this.g.ba();this.N=n;t:if(iR(this)){var r=mD(this.g);e="";var i=r.length,s=4==gD(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){hR(this),uR(this);var o="";break t}this.h.i=new JM.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!fN(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,Bx(12),hR(this),uR(this);break e}Nx(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,dR(this,n)}this.U?(sR(this,u,o),AN&&this.i&&3==u&&(kx(this.V,this.W,"tick",this.fb),this.W.start())):(Nx(this.j,this.m,o,null),dR(this,o)),4==u&&hR(this),this.i&&!this.I&&(4==u?xD(this.l,this):(this.i=!1,aR(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Bx(12)):(this.o=0,Bx(13)),hR(this),uR(this)}}}catch{}},jM.fb=function(){if(this.g){var e=gD(this.g),t=this.g.ga();this.C<t.length&&(cR(this),sR(this,e,t),this.i&&4!=e&&aR(this))}},jM.cancel=function(){this.I=!0,hR(this)},jM.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(Fx(3),Bx(17)),hR(this),this.o=2,uR(this)):lR(this,this.Y-e)},(jM=fR.prototype).R=function(){gR(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},jM.T=function(){return gR(this),this.g.concat()},jM.get=function(e,t){return mR(this.h,e)?this.h[e]:t},jM.set=function(e,t){mR(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},jM.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var yR=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function vR(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof vR){this.g=void 0!==t?t:e.g,CR(this,e.j),this.s=e.s,ER(this,e.i),wR(this,e.m),this.l=e.l,t=e.h;var n=new RR;n.i=t.i,t.g&&(n.g=new fR(t.g),n.h=t.h),SR(this,n),this.o=e.o}else e&&(n=String(e).match(yR))?(this.g=!!t,CR(this,n[1]||"",!0),this.s=OR(n[2]||""),ER(this,n[3]||"",!0),wR(this,n[4]),this.l=OR(n[5]||"",!0),SR(this,n[6]||"",!0),this.o=OR(n[7]||"")):(this.g=!!t,this.h=new RR(null,this.g))}function _R(e){return new vR(e)}function CR(e,t,n){e.j=n?OR(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ER(e,t,n){e.i=n?OR(t,!0):t}function wR(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function SR(e,t,n){t instanceof RR?(e.h=t,function(e,t){t&&!e.j&&(DR(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(LR(this,t),UR(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=TR(t,NR)),e.h=new RR(t,e.g))}function bR(e,t,n){e.h.set(t,n)}function PR(e){return bR(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function OR(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function TR(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,IR),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function IR(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}vR.prototype.toString=function(){var e=[],t=this.j;t&&e.push(TR(t,kR,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(TR(t,kR,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(TR(n,"/"==n.charAt(0)?MR:AR,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",TR(n,xR)),e.join("")};var kR=/[#\/\?@]/g,AR=/[#\?:]/g,MR=/[#\?]/g,NR=/[#\?@]/g,xR=/#/g;function RR(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function DR(e){e.g||(e.g=new fR,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function LR(e,t){DR(e),t=BR(e,t),mR(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,mR((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&gR(e)))}function FR(e,t){return DR(e),t=BR(e,t),mR(e.g.h,t)}function UR(e,t,n){LR(e,t),0<n.length&&(e.i=null,e.g.set(BR(e,t),pN(n)),e.h+=n.length)}function BR(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function VR(e){this.l=e||$R,e=JM.PerformanceNavigationTiming?0<(e=JM.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(JM.g&&JM.g.Ea&&JM.g.Ea()&&JM.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(jM=RR.prototype).add=function(e,t){DR(this),this.i=null,e=BR(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},jM.forEach=function(e,t){DR(this),this.g.forEach(function(n,r){hN(n,function(n){e.call(t,n,r,this)},this)},this)},jM.T=function(){DR(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},jM.R=function(e){DR(this);var t=[];if("string"==typeof e)FR(this,e)&&(t=dN(t,this.g.get(BR(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=dN(t,e[n])}return t},jM.set=function(e,t){return DR(this),this.i=null,FR(this,e=BR(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},jM.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},jM.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var $R=10;function zR(e){return!!e.h||!!e.g&&e.g.size>=e.j}function HR(e){return e.h?1:e.g?e.g.size:0}function GR(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function qR(e,t){e.g?e.g.add(t):e.h=t}function WR(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function jR(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return pN(e.i)}function ZR(){}function YR(){this.g=new ZR}function KR(e,t,n){const r=n||"";try{pR(e,function(e,n){let i=e;eN(e)&&(i=dx(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function JR(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function QR(e){this.l=e.$b||null,this.j=e.ib||!1}function XR(e,t){cx.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=eD,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}VR.prototype.cancel=function(){if(this.i=jR(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ZR.prototype.stringify=function(e){return JM.JSON.stringify(e,void 0)},ZR.prototype.parse=function(e){return JM.JSON.parse(e,void 0)},aN(QR,Gx),QR.prototype.g=function(){return new XR(this.l,this.j)},QR.prototype.i=function(e){return function(){return e}}({}),aN(XR,cx);var eD=0;function tD(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function nD(e){e.readyState=4,e.l=null,e.j=null,e.A=null,rD(e)}function rD(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(jM=XR.prototype).open=function(e,t){if(this.readyState!=eD)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,rD(this)},jM.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||JM).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},jM.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,nD(this)),this.readyState=eD},jM.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,rD(this)),this.g&&(this.readyState=3,rD(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==JM.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;tD(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},jM.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?nD(this):rD(this),3==this.readyState&&tD(this)}},jM.Ua=function(e){this.g&&(this.response=this.responseText=e,nD(this))},jM.Ta=function(e){this.g&&(this.response=e,nD(this))},jM.ha=function(){this.g&&nD(this)},jM.setRequestHeader=function(e,t){this.v.append(e,t)},jM.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},jM.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(XR.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var iD=JM.JSON.parse;function sD(e){cx.call(this),this.headers=new fR,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=oD,this.K=this.L=!1}aN(sD,cx);var oD="",aD=/^https?$/i,lD=["POST","PUT"];function cD(e){return"content-type"==e.toLowerCase()}function uD(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,hD(e),pD(e)}function hD(e){e.D||(e.D=!0,ux(e,"complete"),ux(e,"error"))}function dD(e){if(e.h&&void 0!==KM&&(!e.C[1]||4!=gD(e)||2!=e.ba()))if(e.v&&4==gD(e))bx(e.Fa,0,e);else if(ux(e,"readystatechange"),4==gD(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(yR)[1]||null;if(!i&&JM.self&&JM.self.location){var s=JM.self.location.protocol;i=s.substr(0,s.length-1)}r=!aD.test(i?i.toLowerCase():"")}n=r}if(n)ux(e,"complete"),ux(e,"success");else{e.m=6;try{var o=2<gD(e)?e.g.statusText:""}catch{o=""}e.j=o+" ["+e.ba()+"]",hD(e)}}finally{pD(e)}}}function pD(e,t){if(e.g){fD(e);const n=e.g,r=e.C[0]?QM:null;e.g=null,e.C=null,t||ux(e,"ready");try{n.onreadystatechange=r}catch{}}}function fD(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(JM.clearTimeout(e.A),e.A=null)}function gD(e){return e.g?e.g.readyState:0}function mD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case oD:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function yD(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return EN(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):bR(e,t,n))}function vD(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function _D(e){this.za=0,this.l=[],this.h=new Mx,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=vD("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=vD("baseRetryDelayMs",5e3,e),this.$a=vD("retryDelaySeedMs",1e4,e),this.Ya=vD("forwardChannelMaxRetries",2,e),this.ra=vD("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new VR(e&&e.concurrentRequestLimit),this.Ca=new YR,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function CD(e){if(wD(e),3==e.G){var t=e.V++,n=_R(e.F);bR(n,"SID",e.J),bR(n,"RID",t),bR(n,"TYPE","terminate"),OD(e,n),(t=new Jx(e,e.h,t,void 0)).K=2,t.v=PR(_R(n)),n=!1,JM.navigator&&JM.navigator.sendBeacon&&(n=JM.navigator.sendBeacon(t.v.toString(),"")),!n&&JM.Image&&((new Image).src=t.v,n=!0),n||(t.g=UD(t.l,null),t.g.ea(t.v)),t.F=Date.now(),aR(t)}LD(e)}function ED(e){e.g&&(AD(e),e.g.cancel(),e.g=null)}function wD(e){ED(e),e.u&&(JM.clearTimeout(e.u),e.u=null),ND(e),e.i.cancel(),e.m&&("number"==typeof e.m&&JM.clearTimeout(e.m),e.m=null)}function SD(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&bD(e)}function bD(e){zR(e.i)||e.m||(e.m=!0,vx(e.Ha,e),e.C=0)}function PD(e,t){var n;n=t?t.m:e.V++;const r=_R(e.F);bR(r,"SID",e.J),bR(r,"RID",n),bR(r,"AID",e.U),OD(e,r),e.o&&e.s&&yD(r,e.o,e.s),n=new Jx(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=TD(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),qR(e.i,n),nR(n,r,t)}function OD(e,t){e.j&&pR({},function(e,n){bR(t,n,e)})}function TD(e,t,n){n=Math.min(e.l.length,n);var r=e.j?sN(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{KR(a,e,"req"+n+"_")}catch{r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function ID(e){e.g||e.u||(e.Y=1,vx(e.Ga,e),e.A=0)}function kD(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=$x(sN(e.Ga,e),RD(e,e.A)),e.A++,0))}function AD(e){null!=e.B&&(JM.clearTimeout(e.B),e.B=null)}function MD(e){e.g=new Jx(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=_R(e.oa);bR(t,"RID","rpc"),bR(t,"SID",e.J),bR(t,"CI",e.N?"0":"1"),bR(t,"AID",e.U),OD(e,t),bR(t,"TYPE","xmlhttp"),e.o&&e.s&&yD(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=PR(_R(t)),n.s=null,n.U=!0,rR(n,e)}function ND(e){null!=e.v&&(JM.clearTimeout(e.v),e.v=null)}function xD(e,t){var n=null;if(e.g==t){ND(e),AD(e),e.g=null;var r=2}else{if(!GR(e.i,t))return;n=t.D,WR(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;ux(r=Dx(),new Vx(r,n,t,i)),bD(e)}else ID(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(HR(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=$x(sN(e.Ha,e,t),RD(e,e.C)),e.C++,0)))}(e,t)||2==r&&kD(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:DD(e,5);break;case 4:DD(e,10);break;case 3:DD(e,6);break;default:DD(e,2)}}function RD(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function DD(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=sN(e.jb,e);n||(n=new vR("//www.google.com/images/cleardot.gif"),JM.location&&"http"==JM.location.protocol||CR(n,"https"),PR(n)),function(e,t){const n=new Mx;if(JM.Image){const r=new Image;r.onload=oN(JR,n,r,"TestLoadImage: loaded",!0,t),r.onerror=oN(JR,n,r,"TestLoadImage: error",!1,t),r.onabort=oN(JR,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=oN(JR,n,r,"TestLoadImage: timeout",!1,t),JM.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else Bx(2);e.G=0,e.j&&e.j.va(t),LD(e),wD(e)}function LD(e){e.G=0,e.I=-1,e.j&&((0!=jR(e.i).length||0!=e.l.length)&&(e.i.i.length=0,pN(e.l),e.l.length=0),e.j.ua())}function FD(e,t,n){let r=function(e){return e instanceof vR?_R(e):new vR(e,void 0)}(n);if(""!=r.i)t&&ER(r,t+"."+r.i),wR(r,r.m);else{const e=JM.location;r=function(e,t,n,r){var i=new vR(null,void 0);return e&&CR(i,e),t&&ER(i,t),n&&wR(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&EN(e.aa,function(e,t){bR(r,t,e)}),n=e.sa,(t=e.D)&&n&&bR(r,t,n),bR(r,"VER",e.ma),OD(e,r),r}function UD(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new sD(n&&e.Ba&&!e.qa?new QR({ib:!0}):e.qa)).L=e.H,t}function BD(){}function VD(){if(IN&&!(10<=Number(BN)))throw Error("Environmental error: no available transport.")}function $D(e,t){cx.call(this),this.g=new _D(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!fN(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!fN(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new GD(this)}function zD(e){Zx.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function HD(){Yx.call(this),this.status=1}function GD(e){this.g=e}(jM=sD.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Wx.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:Wx),this.g.onreadystatechange=sN(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void uD(this,s)}e=n||"";const i=new fR(this.headers);r&&pR(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=cD;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=JM.FormData&&e instanceof JM.FormData,!(0<=uN(lD,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{fD(this),0<this.B&&((this.K=function(e){return IN&&UN()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=sN(this.pa,this)):this.A=bx(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){uD(this,s)}},jM.pa=function(){void 0!==KM&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ux(this,"timeout"),this.abort(8))},jM.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ux(this,"complete"),ux(this,"abort"),pD(this))},jM.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),pD(this,!0)),sD.Z.M.call(this)},jM.Fa=function(){this.s||(this.F||this.v||this.l?dD(this):this.cb())},jM.cb=function(){dD(this)},jM.ba=function(){try{return 2<gD(this)?this.g.status:-1}catch{return-1}},jM.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},jM.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),iD(t)}},jM.Da=function(){return this.m},jM.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(jM=_D.prototype).ma=8,jM.G=1,jM.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}},jM.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Jx(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=wN(s),bN(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=TD(this,i,t),bR(n=_R(this.F),"RID",e),bR(n,"CVER",22),this.D&&bR(n,"X-HTTP-Session-Id",this.D),OD(this,n),this.o&&s&&yD(n,this.o,s),qR(this.i,i),this.Ra&&bR(n,"TYPE","init"),this.ja?(bR(n,"$req",t),bR(n,"SID","null"),i.$=!0,nR(i,n,null)):nR(i,n,t),this.G=2}}else 3==this.G&&(e?PD(this,e):0==this.l.length||zR(this.i)||PD(this))},jM.Ga=function(){if(this.u=null,MD(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=$x(sN(this.bb,this),e)}},jM.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Bx(10),ED(this),MD(this))},jM.ab=function(){null!=this.v&&(this.v=null,ED(this),kD(this),Bx(19))},jM.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Bx(2)):(this.h.info("Failed to ping google.com"),Bx(1))},(jM=BD.prototype).xa=function(){},jM.wa=function(){},jM.va=function(){},jM.ua=function(){},jM.Oa=function(){},VD.prototype.g=function(e,t){return new $D(e,t)},aN($D,cx),$D.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),vx(sN(e.hb,e,t))),Bx(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=FD(e,null,e.W),bD(e)},$D.prototype.close=function(){CD(this.g)},$D.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,SD(this.g,t)}else this.v?((t={}).__data__=dx(e),SD(this.g,t)):SD(this.g,e)},$D.prototype.M=function(){this.g.j=null,delete this.j,CD(this.g),delete this.g,$D.Z.M.call(this)},aN(zD,Zx),aN(HD,Yx),aN(GD,BD),GD.prototype.xa=function(){ux(this.g,"a")},GD.prototype.wa=function(e){ux(this.g,new zD(e))},GD.prototype.va=function(e){ux(this.g,new HD(e))},GD.prototype.ua=function(){ux(this.g,"b")},VD.prototype.createWebChannel=VD.prototype.g,$D.prototype.send=$D.prototype.u,$D.prototype.open=$D.prototype.m,$D.prototype.close=$D.prototype.close,zx.NO_ERROR=0,zx.TIMEOUT=8,zx.HTTP_ERROR=6,Hx.COMPLETE="complete",qx.EventType=jx,jx.OPEN="a",jx.CLOSE="b",jx.ERROR="c",jx.MESSAGE="d",cx.prototype.listen=cx.prototype.N,sD.prototype.listenOnce=sD.prototype.O,sD.prototype.getLastError=sD.prototype.La,sD.prototype.getLastErrorCode=sD.prototype.Da,sD.prototype.getStatus=sD.prototype.ba,sD.prototype.getResponseJson=sD.prototype.Qa,sD.prototype.getResponseText=sD.prototype.ga,sD.prototype.send=sD.prototype.ea;var qD=YM.createWebChannelTransport=function(){return new VD},WD=YM.getStatEventTarget=function(){return Dx()},jD=YM.ErrorCode=zx,ZD=YM.EventType=Hx,YD=YM.Event=xx,KD=YM.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},JD=YM.FetchXmlHttpFactory=QR,QD=YM.WebChannel=qx,XD=YM.XhrIo=sD;const eL="@firebase/firestore";class tL{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tL.UNAUTHENTICATED=new tL(null),tL.GOOGLE_CREDENTIALS=new tL("google-credentials-uid"),tL.FIRST_PARTY=new tL("first-party-uid"),tL.MOCK_USER=new tL("mock-user");let nL="9.6.5";const rL=new mS("@firebase/firestore");function iL(){return rL.logLevel}function sL(e,...t){if(rL.logLevel<=hS.DEBUG){const n=t.map(lL);rL.debug(`Firestore (${nL}): ${e}`,...n)}}function oL(e,...t){if(rL.logLevel<=hS.ERROR){const n=t.map(lL);rL.error(`Firestore (${nL}): ${e}`,...n)}}function aL(e,...t){if(rL.logLevel<=hS.WARN){const n=t.map(lL);rL.warn(`Firestore (${nL}): ${e}`,...n)}}function lL(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return e}}function cL(e="Unexpected state"){const t=`FIRESTORE (${nL}) INTERNAL ASSERTION FAILED: `+e;throw oL(t),new Error(t)}function uL(e,t){e||cL()}function hL(e,t){return e}const dL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pL extends Uw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class fL{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class gL{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class mL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tL.UNAUTHENTICATED))}shutdown(){}}class yL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vL{constructor(e){this.t=e,this.currentUser=tL.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let r=this.i;const i=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new fL;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new fL,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(hw(function*(){yield t.promise,yield i(n.currentUser)}))},a=e=>{sL("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(sL("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new fL)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(sL("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(uL("string"==typeof t.accessToken),new gL(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return uL(null===e||"string"==typeof e),new tL(e)}}class _L{constructor(e,t,n){this.type="FirstParty",this.user=tL.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class CL{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new _L(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(tL.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class EL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wL{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable(()=>{return null!=(e=n).error&&sL("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token);var e})};const n=e=>{sL("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):sL("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(uL("string"==typeof e.token),new EL(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class SL{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function bL(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}SL.I=-1;class PL{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=bL(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function OL(e,t){return e<t?-1:e>t?1:0}function TL(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class IL{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pL(dL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pL(dL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pL(dL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pL(dL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return IL.fromMillis(Date.now())}static fromDate(e){return IL.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new IL(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?OL(this.nanoseconds,e.nanoseconds):OL(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class kL{constructor(e){this.timestamp=e}static fromTimestamp(e){return new kL(e)}static min(){return new kL(new IL(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function AL(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ML(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function NL(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class xL{constructor(e,t,n){void 0===t?t=0:t>e.length&&cL(),void 0===n?n=e.length-t:n>e.length-t&&cL(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===xL.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof xL?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class RL extends xL{construct(e,t,n){return new RL(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new pL(dL.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new RL(t)}static emptyPath(){return new RL([])}}const DL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class LL extends xL{construct(e,t,n){return new LL(e,t,n)}static isValidIdentifier(e){return DL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),LL.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new LL(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new pL(dL.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new pL(dL.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new pL(dL.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new pL(dL.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new LL(t)}static emptyPath(){return new LL([])}}class FL{constructor(e){this.fields=e,e.sort(LL.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return TL(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class UL{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new UL(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new UL(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return OL(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}UL.EMPTY_BYTE_STRING=new UL("");const BL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function VL(e){if(uL(!!e),"string"==typeof e){let t=0;const n=BL.exec(e);if(uL(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:$L(e.seconds),nanos:$L(e.nanos)}}function $L(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function zL(e){return"string"==typeof e?UL.fromBase64String(e):UL.fromUint8Array(e)}function HL(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function GL(e){const t=e.mapValue.fields.__previous_value__;return HL(t)?GL(t):t}function qL(e){const t=VL(e.mapValue.fields.__local_write_time__.timestampValue);return new IL(t.seconds,t.nanos)}function WL(e){return null==e}function jL(e){return 0===e&&1/e==-1/0}class ZL{constructor(e){this.path=e}static fromPath(e){return new ZL(RL.fromString(e))}static fromName(e){return new ZL(RL.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===RL.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return RL.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ZL(new RL(e.slice()))}}function YL(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?HL(e)?4:10:cL()}function KL(e,t){if(e===t)return!0;const n=YL(e);if(n!==YL(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return qL(e).isEqual(qL(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=VL(e.timestampValue),r=VL(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,zL(e.bytesValue).isEqual(zL(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return $L(e.geoPointValue.latitude)===$L(t.geoPointValue.latitude)&&$L(e.geoPointValue.longitude)===$L(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return $L(e.integerValue)===$L(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=$L(e.doubleValue),r=$L(t.doubleValue);return n===r?jL(n)===jL(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return TL(e.arrayValue.values||[],t.arrayValue.values||[],KL);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(AL(n)!==AL(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!KL(n[i],r[i])))return!1;return!0}(e,t);default:return cL()}var r}function JL(e,t){return void 0!==(e.values||[]).find(e=>KL(e,t))}function QL(e,t){if(e===t)return 0;const n=YL(e),r=YL(t);if(n!==r)return OL(n,r);switch(n){case 0:return 0;case 1:return OL(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=$L(e.integerValue||e.doubleValue),r=$L(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return XL(e.timestampValue,t.timestampValue);case 4:return XL(qL(e),qL(t));case 5:return OL(e.stringValue,t.stringValue);case 6:return function(e,t){const n=zL(e),r=zL(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=OL(n[i],r[i]);if(0!==e)return e}return OL(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=OL($L(e.latitude),$L(t.latitude));return 0!==n?n:OL($L(e.longitude),$L(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=QL(n[i],r[i]);if(e)return e}return OL(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=OL(r[o],s[o]);if(0!==e)return e;const t=QL(n[r[o]],i[s[o]]);if(0!==t)return t}return OL(r.length,s.length)}(e.mapValue,t.mapValue);default:throw cL()}}function XL(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return OL(e,t);const n=VL(e),r=VL(t),i=OL(n.seconds,r.seconds);return 0!==i?i:OL(n.nanos,r.nanos)}function eF(e){return tF(e)}function tF(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=VL(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?zL(e.bytesValue).toBase64():"referenceValue"in e?ZL.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=tF(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${tF(e.fields[i])}`;return n+"}"}(e.mapValue):cL();var t}function nF(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rF(e){return!!e&&"integerValue"in e}function iF(e){return!!e&&"arrayValue"in e}function sF(e){return!!e&&"nullValue"in e}function oF(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aF(e){return!!e&&"mapValue"in e}function lF(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ML(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=lF(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=lF(e.arrayValue.values[n]);return t}return Object.assign({},e)}class cF{constructor(e){this.value=e}static empty(){return new cF({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!aF(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=lF(t)}setAll(e){let t=LL.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=lF(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());aF(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return KL(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];aF(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ML(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new cF(lF(this.value))}}function uF(e){const t=[];return ML(e.fields,(e,n)=>{const r=new LL([e]);if(aF(n)){const e=uF(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new FL(t)}class hF{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new hF(e,0,kL.min(),cF.empty(),0)}static newFoundDocument(e,t,n){return new hF(e,1,t,n,0)}static newNoDocument(e,t){return new hF(e,2,t,cF.empty(),0)}static newUnknownDocument(e,t){return new hF(e,3,t,cF.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cF.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cF.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof hF&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hF(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class dF{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function pF(e,t=null,n=[],r=[],i=null,s=null,o=null){return new dF(e,t,n,r,i,s,o)}function fF(e){const t=hL(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+eF(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),WL(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=TF(t.startAt)),t.endAt&&(e+="|ub:",e+=TF(t.endAt)),t.R=e}return t.R}function gF(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!kF(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!KL(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!MF(e.startAt,t.startAt)&&MF(e.endAt,t.endAt)}function mF(e){return ZL.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class yF extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new vF(e,t,n):"array-contains"===t?new wF(e,n):"in"===t?new SF(e,n):"not-in"===t?new bF(e,n):"array-contains-any"===t?new PF(e,n):new yF(e,t,n)}static P(e,t,n){return"in"===t?new _F(e,n):new CF(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(QL(t,this.value)):null!==t&&YL(this.value)===YL(t)&&this.v(QL(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return cL()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class vF extends yF{constructor(e,t,n){super(e,t,n),this.key=ZL.fromName(n.referenceValue)}matches(e){const t=ZL.comparator(e.key,this.key);return this.v(t)}}class _F extends yF{constructor(e,t){super(e,"in",t),this.keys=EF(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class CF extends yF{constructor(e,t){super(e,"not-in",t),this.keys=EF(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function EF(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ZL.fromName(e.referenceValue))}class wF extends yF{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return iF(t)&&JL(t.arrayValue,this.value)}}class SF extends yF{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&JL(this.value.arrayValue,t)}}class bF extends yF{constructor(e,t){super(e,"not-in",t)}matches(e){if(JL(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!JL(this.value.arrayValue,t)}}class PF extends yF{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!iF(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>JL(this.value.arrayValue,e))}}class OF{constructor(e,t){this.position=e,this.before=t}}function TF(e){return`${e.before?"b":"a"}:${e.position.map(e=>eF(e)).join(",")}`}class IF{constructor(e,t="asc"){this.field=e,this.dir=t}}function kF(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function AF(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ZL.comparator(ZL.fromName(o.referenceValue),n.key):QL(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function MF(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!KL(e.position[n],t.position[n]))return!1;return!0}class NF{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null}}function xF(e){return new NF(e)}function RF(e){return!WL(e.limit)&&"F"===e.limitType}function DF(e){return!WL(e.limit)&&"L"===e.limitType}function LF(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function FF(e){for(const t of e.filters)if(t.V())return t.field;return null}function UF(e){return null!==e.collectionGroup}function BF(e){const t=hL(e);if(null===t.S){t.S=[];const e=FF(t),n=LF(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new IF(e)),t.S.push(new IF(LL.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new IF(LL.keyField(),e))}}}return t.S}function VF(e){const t=hL(e);if(!t.D)if("F"===t.limitType)t.D=pF(t.path,t.collectionGroup,BF(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of BF(t))e.push(new IF(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new OF(t.endAt.position,!t.endAt.before):null,r=t.startAt?new OF(t.startAt.position,!t.startAt.before):null;t.D=pF(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function $F(e,t,n){return new NF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function zF(e,t){return gF(VF(e),VF(t))&&e.limitType===t.limitType}function HF(e){return`${fF(VF(e))}|lt:${e.limitType}`}function GF(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${eF(t.value)}`;var t}).join(", ")}]`),WL(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: "+TF(e.startAt)),e.endAt&&(t+=", endAt: "+TF(e.endAt)),`Target(${t})`}(VF(e))}; limitType=${e.limitType})`}function qF(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ZL.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!AF(n.startAt,BF(n),r)||n.endAt&&AF(n.endAt,BF(n),r)));var n,r}function WF(e){return(t,n)=>{let r=!1;for(const i of BF(e)){const e=jF(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function jF(e,t,n){const r=e.field.isKeyField()?ZL.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?QL(r,i):cL()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return cL()}}function ZF(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jL(t)?"-0":t}}function YF(e){return{integerValue:""+e}}function KF(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!jL(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?YF(t):ZF(e,t)}class JF{constructor(){this._=void 0}}function QF(e,t,n){return e instanceof tU?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof nU?rU(e,t):e instanceof iU?sU(e,t):function(e,t){const n=eU(e,t),r=aU(n)+aU(e.N);return rF(n)&&rF(e.N)?YF(r):ZF(e.k,r)}(e,t)}function XF(e,t,n){return e instanceof nU?rU(e,t):e instanceof iU?sU(e,t):n}function eU(e,t){return e instanceof oU?rF(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}class tU extends JF{}class nU extends JF{constructor(e){super(),this.elements=e}}function rU(e,t){const n=lU(t);for(const r of e.elements)n.some(e=>KL(e,r))||n.push(r);return{arrayValue:{values:n}}}class iU extends JF{constructor(e){super(),this.elements=e}}function sU(e,t){let n=lU(t);for(const r of e.elements)n=n.filter(e=>!KL(e,r));return{arrayValue:{values:n}}}class oU extends JF{constructor(e,t){super(),this.k=e,this.N=t}}function aU(e){return $L(e.integerValue||e.doubleValue)}function lU(e){return iF(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class cU{constructor(e,t){this.field=e,this.transform=t}}class uU{constructor(e,t){this.version=e,this.transformResults=t}}class hU{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hU}static exists(e){return new hU(void 0,e)}static updateTime(e){return new hU(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function dU(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class pU{}function fU(e,t,n){e instanceof _U?function(e,t,n){const r=e.value.clone(),i=wU(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof CU?function(e,t,n){if(!dU(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=wU(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(EU(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function gU(e,t,n){var r;e instanceof _U?function(e,t,n){if(!dU(e.precondition,t))return;const r=e.value.clone(),i=SU(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(vU(t),r).setHasLocalMutations()}(e,t,n):e instanceof CU?function(e,t,n){if(!dU(e.precondition,t))return;const r=SU(e.fieldTransforms,n,t),i=t.data;i.setAll(EU(e)),i.setAll(r),t.convertToFoundDocument(vU(t),i).setHasLocalMutations()}(e,t,n):dU(e.precondition,r=t)&&r.convertToNoDocument(kL.min())}function mU(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=eU(r.transform,e||null);null!=i&&(null==n&&(n=cF.empty()),n.set(r.field,i))}return n||null}function yU(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&TL(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof nU&&r instanceof nU||n instanceof iU&&r instanceof iU?TL(n.elements,r.elements,KL):n instanceof oU&&r instanceof oU?KL(n.N,r.N):n instanceof tU&&r instanceof tU);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}function vU(e){return e.isFoundDocument()?e.version:kL.min()}class _U extends pU{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class CU extends pU{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function EU(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function wU(e,t,n){const r=new Map;uL(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,XF(o,a,n[i]))}return r}function SU(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,QF(e,s,t))}return r}class bU extends pU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class PU extends pU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class OU{constructor(e){this.count=e}}var TU,IU;function kU(e){switch(e){default:return cL();case dL.CANCELLED:case dL.UNKNOWN:case dL.DEADLINE_EXCEEDED:case dL.RESOURCE_EXHAUSTED:case dL.INTERNAL:case dL.UNAVAILABLE:case dL.UNAUTHENTICATED:return!1;case dL.INVALID_ARGUMENT:case dL.NOT_FOUND:case dL.ALREADY_EXISTS:case dL.PERMISSION_DENIED:case dL.FAILED_PRECONDITION:case dL.ABORTED:case dL.OUT_OF_RANGE:case dL.UNIMPLEMENTED:case dL.DATA_LOSS:return!0}}function AU(e){if(void 0===e)return oL("GRPC error has no .code"),dL.UNKNOWN;switch(e){case TU.OK:return dL.OK;case TU.CANCELLED:return dL.CANCELLED;case TU.UNKNOWN:return dL.UNKNOWN;case TU.DEADLINE_EXCEEDED:return dL.DEADLINE_EXCEEDED;case TU.RESOURCE_EXHAUSTED:return dL.RESOURCE_EXHAUSTED;case TU.INTERNAL:return dL.INTERNAL;case TU.UNAVAILABLE:return dL.UNAVAILABLE;case TU.UNAUTHENTICATED:return dL.UNAUTHENTICATED;case TU.INVALID_ARGUMENT:return dL.INVALID_ARGUMENT;case TU.NOT_FOUND:return dL.NOT_FOUND;case TU.ALREADY_EXISTS:return dL.ALREADY_EXISTS;case TU.PERMISSION_DENIED:return dL.PERMISSION_DENIED;case TU.FAILED_PRECONDITION:return dL.FAILED_PRECONDITION;case TU.ABORTED:return dL.ABORTED;case TU.OUT_OF_RANGE:return dL.OUT_OF_RANGE;case TU.UNIMPLEMENTED:return dL.UNIMPLEMENTED;case TU.DATA_LOSS:return dL.DATA_LOSS;default:return cL()}}(IU=TU||(TU={}))[IU.OK=0]="OK",IU[IU.CANCELLED=1]="CANCELLED",IU[IU.UNKNOWN=2]="UNKNOWN",IU[IU.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",IU[IU.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",IU[IU.NOT_FOUND=5]="NOT_FOUND",IU[IU.ALREADY_EXISTS=6]="ALREADY_EXISTS",IU[IU.PERMISSION_DENIED=7]="PERMISSION_DENIED",IU[IU.UNAUTHENTICATED=16]="UNAUTHENTICATED",IU[IU.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",IU[IU.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",IU[IU.ABORTED=10]="ABORTED",IU[IU.OUT_OF_RANGE=11]="OUT_OF_RANGE",IU[IU.UNIMPLEMENTED=12]="UNIMPLEMENTED",IU[IU.INTERNAL=13]="INTERNAL",IU[IU.UNAVAILABLE=14]="UNAVAILABLE",IU[IU.DATA_LOSS=15]="DATA_LOSS";class MU{constructor(e,t){this.comparator=e,this.root=t||xU.EMPTY}insert(e,t){return new MU(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xU.BLACK,null,null))}remove(e){return new MU(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xU.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new NU(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new NU(this.root,e,this.comparator,!1)}getReverseIterator(){return new NU(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new NU(this.root,e,this.comparator,!0)}}class NU{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xU{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??xU.RED,this.left=r??xU.EMPTY,this.right=i??xU.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new xU(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return xU.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return xU.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xU.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xU.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw cL();const e=this.left.check();if(e!==this.right.check())throw cL();return e+(this.isRed()?0:1)}}xU.EMPTY=null,xU.RED=!0,xU.BLACK=!1,xU.EMPTY=new class{constructor(){this.size=0}get key(){throw cL()}get value(){throw cL()}get color(){throw cL()}get left(){throw cL()}get right(){throw cL()}copy(e,t,n,r,i){return this}insert(e,t,n){return new xU(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class RU{constructor(e){this.comparator=e,this.data=new MU(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new DU(this.data.getIterator())}getIteratorFrom(e){return new DU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof RU)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new RU(this.comparator);return t.data=e,t}}class DU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const LU=new MU(ZL.comparator);function FU(){return LU}const UU=new MU(ZL.comparator);function BU(){return UU}const VU=new MU(ZL.comparator);const $U=new RU(ZL.comparator);function zU(...e){let t=$U;for(const n of e)t=t.add(n);return t}const HU=new RU(OL);function GU(){return HU}class qU{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,WU.createSynthesizedTargetChangeForCurrentChange(e,t)),new qU(kL.min(),n,GU(),FU(),zU())}}class WU{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new WU(UL.EMPTY_BYTE_STRING,t,zU(),zU(),zU())}}class jU{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class ZU{constructor(e,t){this.targetId=e,this.M=t}}class YU{constructor(e,t,n=UL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class KU{constructor(){this.F=0,this.L=XU(),this.B=UL.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=zU(),t=zU(),n=zU();return this.L.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:cL()}}),new WU(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=XU()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class JU{constructor(e){this.et=e,this.nt=new Map,this.st=FU(),this.it=QU(),this.rt=new RU(OL)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:cL()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((e,n)=>{this.lt(n)&&t(n)})}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(mF(e))if(0===n){const n=new ZL(e.path);this.at(t,n,hF.newNoDocument(n,kL.min()))}else uL(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((n,r)=>{const i=this.wt(r);if(i){if(n.current&&mF(i.target)){const t=new ZL(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,hF.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}});let n=zU();this.it.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))});const r=new qU(e,t,this.rt,this.st,n);return this.st=FU(),this.it=QU(),this.rt=new RU(OL),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new KU,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new RU(OL),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||sL("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new KU),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function QU(){return new MU(ZL.comparator)}function XU(){return new MU(ZL.comparator)}const eB={asc:"ASCENDING",desc:"DESCENDING"},tB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class nB{constructor(e,t){this.databaseId=e,this.C=t}}function rB(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iB(e,t){return e.C?t.toBase64():t.toUint8Array()}function sB(e,t){return rB(e,t.toTimestamp())}function oB(e){return uL(!!e),kL.fromTimestamp(function(e){const t=VL(e);return new IL(t.seconds,t.nanos)}(e))}function aB(e,t){return(n=e,new RL(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function lB(e){const t=RL.fromString(e);return uL(IB(t)),t}function cB(e,t){return aB(e.databaseId,t.path)}function uB(e,t){const n=lB(t);if(n.get(1)!==e.databaseId.projectId)throw new pL(dL.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new pL(dL.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ZL(pB(n))}function hB(e,t){return aB(e.databaseId,t)}function dB(e){return new RL(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function pB(e){return uL(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function fB(e,t,n){return{name:cB(e,t),fields:n.value.mapValue.fields}}function gB(e,t){return{documents:[hB(e,t.path)]}}function mB(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=hB(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=hB(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(oF(e.value))return{unaryFilter:{field:SB(e.field),op:"IS_NAN"}};if(sF(e.value))return{unaryFilter:{field:SB(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(oF(e.value))return{unaryFilter:{field:SB(e.field),op:"IS_NOT_NAN"}};if(sF(e.value))return{unaryFilter:{field:SB(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:SB(e.field),op:wB(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>{return{field:SB((t=e).field),direction:EB(t.dir)};var t})}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=(a=t.limit,e.C||WL(a)?a:{value:a});var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=_B(t.startAt)),t.endAt&&(n.structuredQuery.endAt=_B(t.endAt)),n}function yB(e){let t=function(e){const t=lB(e);return 4===t.length?RL.emptyPath():pB(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){uL(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=vB(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new IF(bB((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,WL(t)?null:t}(n.limit));let l=null;n.startAt&&(l=CB(n.startAt));let c=null;return n.endAt&&(c=CB(n.endAt)),function(e,t,n,r,i,s,o,a){return new NF(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",l,c)}function vB(e){return e?void 0!==e.unaryFilter?[OB(e)]:void 0!==e.fieldFilter?[PB(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>vB(e)).reduce((e,t)=>e.concat(t)):cL():[]}function _B(e){return{before:e.before,values:e.position}}function CB(e){return new OF(e.values||[],!!e.before)}function EB(e){return eB[e]}function wB(e){return tB[e]}function SB(e){return{fieldPath:e.canonicalString()}}function bB(e){return LL.fromServerFormat(e.fieldPath)}function PB(e){return yF.create(bB(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return cL()}}(e.fieldFilter.op),e.fieldFilter.value)}function OB(e){switch(e.unaryFilter.op){case"IS_NAN":const t=bB(e.unaryFilter.field);return yF.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=bB(e.unaryFilter.field);return yF.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=bB(e.unaryFilter.field);return yF.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=bB(e.unaryFilter.field);return yF.create(i,"!=",{nullValue:"NULL_VALUE"});default:return cL()}}function TB(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function IB(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function kB(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=MB(t)),t=AB(e.get(n),t);return MB(t)}function AB(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function MB(e){return e+"\x01\x01"}class NB{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}NB.store="owner",NB.key="owner";class xB{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}xB.store="mutationQueues",xB.keyPath="userId";class RB{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}RB.store="mutations",RB.keyPath="batchId",RB.userMutationsIndex="userMutationsIndex",RB.userMutationsKeyPath=["userId","batchId"];class DB{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,kB(t)]}static key(e,t,n){return[e,kB(t),n]}}DB.store="documentMutations",DB.PLACEHOLDER=new DB;class LB{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}LB.store="remoteDocuments",LB.readTimeIndex="readTimeIndex",LB.readTimeIndexPath="readTime",LB.collectionReadTimeIndex="collectionReadTimeIndex",LB.collectionReadTimeIndexPath=["parentPath","readTime"];class FB{constructor(e){this.byteSize=e}}FB.store="remoteDocumentGlobal",FB.key="remoteDocumentGlobalKey";class UB{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}UB.store="targets",UB.keyPath="targetId",UB.queryTargetsIndexName="queryTargetsIndex",UB.queryTargetsKeyPath=["canonicalId","targetId"];class BB{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}BB.store="targetDocuments",BB.keyPath=["targetId","path"],BB.documentTargetsIndex="documentTargetsIndex",BB.documentTargetsKeyPath=["path","targetId"];class VB{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}VB.key="targetGlobalKey",VB.store="targetGlobal";class $B{constructor(e,t){this.collectionId=e,this.parent=t}}$B.store="collectionParents",$B.keyPath=["collectionId","parent"];class zB{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}zB.store="clientMetadata",zB.keyPath="clientId";class HB{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}HB.store="bundles",HB.keyPath="bundleId";class GB{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}GB.store="namedQueries",GB.keyPath="name";const qB="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WB{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&cL(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new WB((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof WB?t:WB.resolve(t)}catch(t){return WB.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):WB.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):WB.reject(t)}static resolve(e){return new WB((t,n)=>{t(e)})}static reject(e){return new WB((t,n)=>{n(e)})}static waitFor(e){return new WB((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=WB.resolve(!1);for(const n of e)t=t.next(e=>e?WB.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}}function jB(e){return"IndexedDbTransactionError"===e.name}class ZB{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&fU(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&gU(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&gU(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(kL.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),zU())}isEqual(e){return this.batchId===e.batchId&&TL(this.mutations,e.mutations,(e,t)=>yU(e,t))&&TL(this.baseMutations,e.baseMutations,(e,t)=>yU(e,t))}}class YB{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){uL(e.mutations.length===n.length);let r=VU;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new YB(e,t,n,r)}}class KB{constructor(e,t,n,r,i=kL.min(),s=kL.min(),o=UL.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new KB(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new KB(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new KB(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class JB{constructor(e){this.Gt=e}}function QB(e){const t=yB({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?$F(t,t.limit,"L"):t}class XB{constructor(){this.zt=new eV}addToCollectionParentIndex(e,t){return this.zt.add(t),WB.resolve()}getCollectionParents(e,t){return WB.resolve(this.zt.getEntries(t))}}class eV{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new RU(RL.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new RU(RL.comparator)).toArray()}}class tV{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new tV(e,tV.DEFAULT_COLLECTION_PERCENTILE,tV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}tV.DEFAULT_COLLECTION_PERCENTILE=10,tV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tV.DEFAULT=new tV(41943040,tV.DEFAULT_COLLECTION_PERCENTILE,tV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tV.DISABLED=new tV(-1,0,0);class nV{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new nV(0)}static re(){return new nV(-1)}}function rV(e){return iV.apply(this,arguments)}function iV(){return(iV=hw(function*(e){if(e.code!==dL.FAILED_PRECONDITION||e.message!==qB)throw e;sL("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class sV{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){ML(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return NL(this.inner)}}class oV{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(n=>this.bn(e,t,n))}bn(e,t,n){return this.Je.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,t){e.forEach((e,n)=>{for(const r of t)r.applyToLocalView(n)})}vn(e,t){return this.Je.getEntries(e,t).next(t=>this.Vn(e,t).next(()=>t))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return ZL.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.Sn(e,t.path):UF(t)?this.Dn(e,t,n):this.Cn(e,t,n);var r}Sn(e,t){return this.Rn(e,new ZL(t)).next(e=>{let t=BU();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Dn(e,t,n){const r=t.collectionGroup;let i=BU();return this.Jt.getCollectionParents(e,r).next(s=>WB.forEach(s,s=>{const o=(a=t,l=s.child(r),new NF(l,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,l;return this.Cn(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next(n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(t=>(i=t,this.Nn(e,i,r).next(e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=hF.newInvalidDocument(n),r=r.insert(n,i)),gU(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((e,n)=>{qF(t,n)||(r=r.remove(e))}),r))}Nn(e,t,n){let r=zU();for(const s of t)for(const e of s.mutations)e instanceof CU&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class aV{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=zU(),r=zU();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new aV(e,t.fromCache,n,r)}}class lV{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(kL.min())?this.Fn(e,t):this.Mn.vn(e,r).next(i=>{const s=this.Ln(t,i);return(RF(t)||DF(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(iL()<=hS.DEBUG&&sL("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),GF(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next(e=>(s.forEach(t=>{e=e.insert(t.key,t)}),e)))});var i}Ln(e,t){let n=new RU(WF(e));return t.forEach((t,r)=>{qF(e,r)&&(n=n.add(r))}),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return iL()<=hS.DEBUG&&sL("QueryEngine","Using full collection scan to execute query:",GF(t)),this.Mn.getDocumentsMatchingQuery(e,t,kL.min())}}class cV{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new MU(OL),this.Kn=new sV(e=>fF(e),gF),this.jn=kL.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new oV(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function uV(e,t){return hV.apply(this,arguments)}function hV(){return(hV=hw(function*(e,t){const n=hL(e);let r=n.An,i=n.Wn;const s=yield n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.An.getAllMutationBatches(e).next(o=>(s=o,r=n.persistence.getMutationQueue(t),i=new oV(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e))).next(t=>{const n=[],r=[];let o=zU();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next(e=>({Gn:e,removedBatchIds:n,addedBatchIds:r}))})});return n.An=r,n.Wn=i,n.Un.On(n.Wn),s})).apply(this,arguments)}function dV(e,t){const n=hL(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=WB.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);uL(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),o.next(()=>e.An.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}function pV(e){const t=hL(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.He.getLastRemoteSnapshotVersion(e))}function fV(e,t){const n=hL(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach((s,a)=>{const l=i.get(a);if(!l)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.He.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);var u,h,d;t.targetMismatches.has(a)?c=c.withResumeToken(UL.EMPTY_BYTE_STRING,kL.min()).withLastLimboFreeSnapshotVersion(kL.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),h=c,d=s,(0===(u=l).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.He.updateTargetData(e,c))});let a=FU();if(t.documentUpdates.forEach((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n,r,i){let s=zU();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=FU();return n.forEach((n,o)=>{const a=e.get(n),l=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(kL.min())?(t.removeEntry(n,l),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,l),s=s.insert(n,o)):sL("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),s})}(e,s,t.documentUpdates,r,void 0).next(e=>{a=e})),!r.isEqual(kL.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next(t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return WB.waitFor(o).next(()=>s.apply(e)).next(()=>n.Wn.Vn(e,a)).next(()=>a)}).then(e=>(n.qn=i,e))}function gV(e,t){const n=hL(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)))}function mV(e,t){const n=hL(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.He.getTargetData(e,t).next(i=>i?(r=i,WB.resolve(r)):n.He.allocateTargetId(e).next(i=>(r=new KB(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e})}function yV(e,t,n){return vV.apply(this,arguments)}function vV(){return(vV=hw(function*(e,t,n){const r=hL(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!jB(o))throw o;sL("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)})).apply(this,arguments)}function _V(e,t,n){const r=hL(e);let i=kL.min(),s=zU();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=hL(e),i=r.Kn.get(n);return void 0!==i?WB.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,VF(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:kL.min(),n?s:zU())).next(e=>({documents:e,zn:s})))}class CV{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return WB.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:oB(n.createTime)}),WB.resolve()}getNamedQuery(e,t){return WB.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(n=t).name,query:QB(n.bundledQuery),readTime:oB(n.readTime)}),WB.resolve();var n}}class EV{constructor(){this.ts=new RU(wV.es),this.ns=new RU(wV.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new wV(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.os(new wV(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new ZL(new RL([])),n=new wV(t,e),r=new wV(t,e+1),i=[];return this.ns.forEachInRange([n,r],e=>{this.os(e),i.push(e.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new ZL(new RL([])),n=new wV(t,e),r=new wV(t,e+1);let i=zU();return this.ns.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new wV(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class wV{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return ZL.comparator(e.key,t.key)||OL(e.fs,t.fs)}static ss(e,t){return OL(e.fs,t.fs)||ZL.comparator(e.key,t.key)}}class SV{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new RU(wV.es)}checkEmpty(e){return WB.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++;const s=new ZB(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new wV(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return WB.resolve(s)}lookupMutationBatch(e,t){return WB.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.gs(t+1),r=n<0?0:n;return WB.resolve(this.An.length>r?this.An[r]:null)}getHighestUnacknowledgedBatchId(){return WB.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return WB.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wV(t,0),r=new wV(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],e=>{const t=this._s(e.fs);i.push(t)}),WB.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new RU(OL);return t.forEach(e=>{const t=new wV(e,0),r=new wV(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],e=>{n=n.add(e.fs)})}),WB.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ZL.isDocumentKey(i)||(i=i.child(""));const s=new wV(new ZL(i),0);let o=new RU(OL);return this.ws.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)},s),WB.resolve(this.ys(o))}ys(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){uL(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return WB.forEach(t.mutations,r=>{const i=new wV(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ws=n})}ee(e){}containsKey(e,t){const n=new wV(t,0),r=this.ws.firstAfterOrEqual(n);return WB.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return WB.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class bV{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new MU(ZL.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return WB.resolve(n?n.document.mutableCopy():hF.newInvalidDocument(t))}getEntries(e,t){let n=FU();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():hF.newInvalidDocument(e))}),WB.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=FU();const i=new ZL(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||qF(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return WB.resolve(r)}Es(e,t){return WB.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new PV(this)}getSize(e){return WB.resolve(this.size)}}class PV extends class{constructor(){this.changes=new sV(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:kL.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:hF.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?WB.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)}),WB.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class OV{constructor(e){this.persistence=e,this.Is=new sV(e=>fF(e),gF),this.lastRemoteSnapshotVersion=kL.min(),this.highestTargetId=0,this.As=0,this.Rs=new EV,this.targetCount=0,this.bs=nV.ie()}forEachTarget(e,t){return this.Is.forEach((e,n)=>t(n)),WB.resolve()}getLastRemoteSnapshotVersion(e){return WB.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return WB.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),WB.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),WB.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new nV(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,WB.resolve()}updateTargetData(e,t){return this.ae(t),WB.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,WB.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),WB.waitFor(i).next(()=>r)}getTargetCount(e){return WB.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return WB.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),WB.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),WB.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),WB.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return WB.resolve(n)}containsKey(e,t){return WB.resolve(this.Rs.containsKey(t))}}class TV{constructor(e,t){this.Ps={},this.Be=new SL(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new OV(this),this.Jt=new XB,this.Je=new bV(this.Jt,e=>this.referenceDelegate.vs(e)),this.k=new JB(t),this.Ye=new CV(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new SV(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){sL("MemoryPersistence","Starting transaction:",e);const r=new IV(this.Be.next());return this.referenceDelegate.Vs(),n(r).next(e=>this.referenceDelegate.Ss(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ds(e,t){return WB.or(Object.values(this.Ps).map(n=>()=>n.containsKey(e,t)))}}class IV extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}{constructor(e){super(),this.currentSequenceNumber=e}}class kV{constructor(e){this.persistence=e,this.Cs=new EV,this.Ns=null}static ks(e){return new kV(e)}get xs(){if(this.Ns)return this.Ns;throw cL()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),WB.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),WB.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),WB.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return WB.forEach(this.xs,n=>{const r=ZL.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return WB.or([()=>WB.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}class AV{constructor(){this.activeTargetIds=GU()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class MV{constructor(){this.pi=new AV,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new AV,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class NV{Ei(e){}shutdown(){}}class xV{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){sL("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){sL("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const RV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class DV{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class LV extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);sL("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then(e=>(sL("RestConnection","Received: ",e),e),t=>{throw aL("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+nL,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Ui(e,t){return`${this.Fi}/v1/${t}:${RV[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise((i,s)=>{const o=new XD;o.listenOnce(ZD.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case jD.NO_ERROR:const t=o.getResponseJson();sL("Connection","XHR received:",JSON.stringify(t)),i(t);break;case jD.TIMEOUT:sL("Connection",'RPC "'+e+'" timed out'),s(new pL(dL.DEADLINE_EXCEEDED,"Request time out"));break;case jD.HTTP_ERROR:const n=o.getStatus();if(sL("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(dL).indexOf(t)>=0?t:dL.UNKNOWN}(e.status);s(new pL(t,e.message))}else s(new pL(dL.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new pL(dL.UNAVAILABLE,"Connection failed."));break;default:cL()}}finally{sL("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=qD(),s=WD(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new JD({})),this.qi(o.initMessageHeaders,t,n),Mw()||xw()||Aw().indexOf("Electron/")>=0||Rw()||Aw().indexOf("MSAppHost/")>=0||Nw()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");sL("Connection","Creating WebChannel: "+a,o);const l=i.createWebChannel(a,o);let c=!1,u=!1;const h=new DV({Vi:e=>{u?sL("Connection","Not sending because WebChannel is closed:",e):(c||(sL("Connection","Opening WebChannel transport."),l.open(),c=!0),sL("Connection","WebChannel sending:",e),l.send(e))},Si:()=>l.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return d(l,QD.EventType.OPEN,()=>{u||sL("Connection","WebChannel transport opened.")}),d(l,QD.EventType.CLOSE,()=>{u||(u=!0,sL("Connection","WebChannel transport closed"),h.Oi())}),d(l,QD.EventType.ERROR,e=>{u||(u=!0,aL("Connection","WebChannel transport errored:",e),h.Oi(new pL(dL.UNAVAILABLE,"The operation could not be completed")))}),d(l,QD.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];uL(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){sL("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=TU[e];if(void 0!==t)return AU(t)}(e),n=i.message;void 0===t&&(t=dL.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.Oi(new pL(t,n)),l.close()}else sL("Connection","WebChannel received:",n),h.Mi(n)}}),d(s,YD.STAT_EVENT,e=>{e.stat===KD.PROXY?sL("Connection","Detected buffering proxy"):e.stat===KD.NOPROXY&&sL("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.$i()},0),h}}function FV(){return"undefined"!=typeof document?document:null}function UV(e){return new nB(e,!0)}class BV{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&sL("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class VV{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new BV(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return hw(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return hw(function*(){if(e.lr())return e.close(0)})()}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}close(e,t){var n=this;return hw(function*(){n.yr(),n.pr(),n.ur.cancel(),n.rr++,4!==e?n.ur.reset():t&&t.code===dL.RESOURCE_EXHAUSTED?(oL(t.toString()),oL("Using maximum backoff delay to prevent overloading the backend."),n.ur.Xi()):t&&t.code===dL.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Tr(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.rr===t&&this.Ir(e,n)},t=>{e(()=>{const e=new pL(dL.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)})})}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{n(()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(e=>{n(()=>this.Ar(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}dr(){var e=this;this.state=5,this.ur.Zi(hw(function*(){e.state=0,e.start()}))}Ar(e){return sL("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget(()=>this.rr===e?t():(sL("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $V extends VV{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:cL(),s=t.targetChange.targetIds||[],o=function(e,t){return e.C?(uL(void 0===t||"string"==typeof t),UL.fromBase64String(t||"")):(uL(void 0===t||t instanceof Uint8Array),UL.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(e){const t=void 0===e.code?dL.UNKNOWN:AU(e.code);return new pL(t,e.message||"")}(a);n=new YU(i,s,o,l||null)}else if("documentChange"in t){const r=t.documentChange,i=uB(e,r.document.name),s=oB(r.document.updateTime),o=new cF({mapValue:{fields:r.document.fields}}),a=hF.newFoundDocument(i,s,o);n=new jU(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=uB(e,r.document),s=r.readTime?oB(r.readTime):kL.min(),o=hF.newNoDocument(i,s);n=new jU([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=uB(e,r.document);n=new jU([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return cL();{const e=t.filter,r=new OU(e.count||0);n=new ZU(e.targetId,r)}}var r;return n}(this.k,e),n=function(e){if(!("targetChange"in e))return kL.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?kL.min():t.readTime?oB(t.readTime):kL.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=dB(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=mF(r)?{documents:gB(e,r)}:{query:mB(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=iB(e,t.resumeToken):t.snapshotVersion.compareTo(kL.min())>0&&(n.readTime=rB(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return cL()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=dB(this.k),t.removeTarget=e,this.gr(t)}}class zV extends VV{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(uL(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(uL(void 0!==t),e.map(e=>function(e,t){let n=oB(e.updateTime?e.updateTime:t);return n.isEqual(kL.min())&&(n=oB(t)),new uU(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=oB(e.commitTime);return this.listener.Cr(n,t)}return uL(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=dB(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof _U)n={update:fB(e,t.key,t.value)};else if(t instanceof bU)n={delete:cB(e,t.key)};else if(t instanceof CU)n={update:fB(e,t.key,t.data),updateMask:TB(t.fieldMask)};else{if(!(t instanceof PU))return cL();n={verify:cB(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof tU)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof nU)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof iU)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof oU)return{fieldPath:t.field.canonicalString(),increment:n.N};throw cL()}(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:sB(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:cL()),n;var r}(this.k,e))};this.gr(t)}}class HV extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new pL(dL.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.Bi(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===dL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pL(dL.UNKNOWN,e.toString())})}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.ir.ji(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===dL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pL(dL.UNKNOWN,e.toString())})}terminate(){this.$r=!0}}class GV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(oL(t),this.Lr=!1):sL("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class qV{constructor(e,t,n,r,i){var s=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(e=>{n.enqueueAndForget(hw(function*(){var e;n$(s)&&(sL("RemoteStore","Restarting streams for network reachability change."),yield(e=hw(function*(e){const t=hL(e);t.Gr.add(4),yield ZV(t),t.Jr.set("Unknown"),t.Gr.delete(4),yield WV(t)}),function(t){return e.apply(this,arguments)})(s))}))}),this.Jr=new GV(n,r)}}function WV(e){return jV.apply(this,arguments)}function jV(){return(jV=hw(function*(e){if(n$(e))for(const t of e.zr)yield t(!0)})).apply(this,arguments)}function ZV(e){return YV.apply(this,arguments)}function YV(){return(YV=hw(function*(e){for(const t of e.zr)yield t(!1)})).apply(this,arguments)}function KV(e,t){const n=hL(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),t$(n)?e$(n):A$(n).lr()&&QV(n,t))}function JV(e,t){const n=hL(e),r=A$(n);n.Wr.delete(t),r.lr()&&XV(n,t),0===n.Wr.size&&(r.lr()?r._r():n$(n)&&n.Jr.set("Unknown"))}function QV(e,t){e.Yr.X(t.targetId),A$(e).Pr(t)}function XV(e,t){e.Yr.X(t),A$(e).vr(t)}function e$(e){e.Yr=new JU({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),A$(e).start(),e.Jr.Br()}function t$(e){return n$(e)&&!A$(e).hr()&&e.Wr.size>0}function n$(e){return 0===hL(e).Gr.size}function r$(e){e.Yr=void 0}function i$(e){return s$.apply(this,arguments)}function s$(){return(s$=hw(function*(e){e.Wr.forEach((t,n)=>{QV(e,t)})})).apply(this,arguments)}function o$(e,t){return a$.apply(this,arguments)}function a$(){return(a$=hw(function*(e,t){r$(e),t$(e)?(e.Jr.Kr(t),e$(e)):e.Jr.set("Unknown")})).apply(this,arguments)}function l$(e,t,n){return c$.apply(this,arguments)}function c$(){return(c$=hw(function*(e,t,n){if(e.Jr.set("Online"),t instanceof YU&&2===t.state&&t.cause)try{yield(r=hw(function*(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}),function(e,t){return r.apply(this,arguments)})(e,t)}catch(r){sL("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield u$(e,r)}else if(t instanceof jU?e.Yr.ot(t):t instanceof ZU?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(kL.min()))try{const t=yield pV(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(UL.EMPTY_BYTE_STRING,n.snapshotVersion)),XV(e,t);const r=new KB(n.target,t,1,n.sequenceNumber);QV(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){sL("RemoteStore","Failed to raise snapshot:",r),yield u$(e,r)}var r})).apply(this,arguments)}function u$(e,t,n){return h$.apply(this,arguments)}function h$(){return(h$=hw(function*(e,t,n){if(!jB(t))throw t;e.Gr.add(1),yield ZV(e),e.Jr.set("Offline"),n||(n=()=>pV(e.localStore)),e.asyncQueue.enqueueRetryable(hw(function*(){sL("RemoteStore","Retrying IndexedDB access"),yield n(),e.Gr.delete(1),yield WV(e)}))})).apply(this,arguments)}function d$(e,t){return t().catch(n=>u$(e,n,t))}function p$(e){return f$.apply(this,arguments)}function f$(){return(f$=hw(function*(e){const t=hL(e),n=M$(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;g$(t);)try{const e=yield gV(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,m$(t,e)}catch(i){yield u$(t,i)}y$(t)&&v$(t)})).apply(this,arguments)}function g$(e){return n$(e)&&e.Qr.length<10}function m$(e,t){e.Qr.push(t);const n=M$(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function y$(e){return n$(e)&&!M$(e).hr()&&e.Qr.length>0}function v$(e){M$(e).start()}function _$(e){return C$.apply(this,arguments)}function C$(){return(C$=hw(function*(e){M$(e).kr()})).apply(this,arguments)}function E$(e){return w$.apply(this,arguments)}function w$(){return(w$=hw(function*(e){const t=M$(e);for(const n of e.Qr)t.Dr(n.mutations)})).apply(this,arguments)}function S$(e,t,n){return b$.apply(this,arguments)}function b$(){return(b$=hw(function*(e,t,n){const r=e.Qr.shift(),i=YB.from(r,t,n);yield d$(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield p$(e)})).apply(this,arguments)}function P$(e,t){return O$.apply(this,arguments)}function O$(){return(O$=hw(function*(e,t){var n;t&&M$(e).Sr&&(yield(n=hw(function*(e,t){if(kU(n=t.code)&&n!==dL.ABORTED){const n=e.Qr.shift();M$(e).wr(),yield d$(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield p$(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),y$(e)&&v$(e)})).apply(this,arguments)}function T$(e,t){return I$.apply(this,arguments)}function I$(){return(I$=hw(function*(e,t){const n=hL(e);n.asyncQueue.verifyOperationInProgress(),sL("RemoteStore","RemoteStore received new credentials");const r=n$(n);n.Gr.add(3),yield ZV(n),r&&n.Jr.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),yield WV(n)})).apply(this,arguments)}function k$(){return(k$=hw(function*(e,t){const n=hL(e);t?(n.Gr.delete(2),yield WV(n)):t||(n.Gr.add(2),yield ZV(n),n.Jr.set("Unknown"))})).apply(this,arguments)}function A$(e){return e.Xr||(e.Xr=function(e,t,n){const r=hL(e);return r.Or(),new $V(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:i$.bind(null,e),Ni:o$.bind(null,e),br:l$.bind(null,e)}),e.zr.push(function(){var t=hw(function*(t){t?(e.Xr.wr(),t$(e)?e$(e):e.Jr.set("Unknown")):(yield e.Xr.stop(),r$(e))});return function(e){return t.apply(this,arguments)}}())),e.Xr}function M$(e){return e.Zr||(e.Zr=function(e,t,n){const r=hL(e);return r.Or(),new zV(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:_$.bind(null,e),Ni:P$.bind(null,e),Nr:E$.bind(null,e),Cr:S$.bind(null,e)}),e.zr.push(function(){var t=hw(function*(t){t?(e.Zr.wr(),yield p$(e)):(yield e.Zr.stop(),e.Qr.length>0&&(sL("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))});return function(e){return t.apply(this,arguments)}}())),e.Zr}class N${constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new fL,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new N$(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new pL(dL.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function x$(e,t){if(oL("AsyncQueue",`${t}: ${e}`),jB(e))return new pL(dL.UNAVAILABLE,`${t}: ${e}`);throw e}class R${constructor(e){this.comparator=e?(t,n)=>e(t,n)||ZL.comparator(t.key,n.key):(e,t)=>ZL.comparator(e.key,t.key),this.keyedMap=BU(),this.sortedSet=new MU(this.comparator)}static emptySet(e){return new R$(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof R$)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new R$;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class D${constructor(){this.eo=new MU(ZL.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):cL():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,n)=>{e.push(n)}),e}}class L${constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new L$(e,t,R$.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zF(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class F${constructor(){this.so=void 0,this.listeners=[]}}class U${constructor(){this.queries=new sV(e=>HF(e),zF),this.onlineState="Unknown",this.io=new Set}}function B$(e,t){return V$.apply(this,arguments)}function V$(){return(V$=hw(function*(e,t){const n=hL(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new F$),i)try{s.so=yield n.onListen(r)}catch(o){const e=x$(o,`Initialization of query '${GF(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&q$(n)})).apply(this,arguments)}function $$(e,t){return z$.apply(this,arguments)}function z$(){return(z$=hw(function*(e,t){const n=hL(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)})).apply(this,arguments)}function H$(e,t){const n=hL(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.oo(i)&&(r=!0);e.so=i}}r&&q$(n)}function G$(e,t,n){const r=hL(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function q$(e){e.io.forEach(e=>{e.next()})}class W${constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new L$(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=L$.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class j${constructor(e){this.key=e}}class Z${constructor(e){this.key=e}}class Y${constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=zU(),this.mutatedKeys=zU(),this.Ao=WF(e),this.Ro=new R$(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new D$,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=RF(this.query)&&r.size===this.query.limit?r.last():null,l=DF(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=qF(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.Vo(c,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.Ao(u,a)>0||l&&this.Ao(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),RF(this.query)||DF(this.query))for(;s.size>this.query.limit;){const e=RF(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cL()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc)),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new L$(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new D$,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(e=>this.To=this.To.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.To=this.To.delete(e)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=zU(),this.Ro.forEach(e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))});const t=[];return e.forEach(e=>{this.Io.has(e)||t.push(new Z$(e))}),this.Io.forEach(n=>{e.has(n)||t.push(new j$(n))}),t}ko(e){this.To=e.zn,this.Io=zU();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return L$.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class K${constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class J${constructor(e){this.key=e,this.$o=!1}}class Q${constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new sV(e=>HF(e),zF),this.Fo=new Map,this.Lo=new Set,this.Bo=new MU(ZL.comparator),this.Uo=new Map,this.qo=new EV,this.Ko={},this.jo=new Map,this.Qo=nV.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function X$(e,t){return ez.apply(this,arguments)}function ez(){return(ez=hw(function*(e,t){const n=Tz(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=yield mV(n.localStore,VF(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=yield tz(n,t,r,"current"===s),n.isPrimaryClient&&KV(n.remoteStore,e)}return i})).apply(this,arguments)}function tz(e,t,n,r){return nz.apply(this,arguments)}function nz(){return(nz=hw(function*(e,t,n,r){e.Go=(t,n,r)=>{return(i=hw(function*(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=yield _V(e.localStore,t.query,!1).then(({documents:e})=>t.view.Po(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return _z(e,t.targetId,o.Co),o.snapshot}),function(e,t,n,r){return i.apply(this,arguments)})(e,t,n,r);var i};const i=yield _V(e.localStore,t,!0),s=new Y$(t,i.zn),o=s.Po(i.documents),a=WU.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),l=s.applyChanges(o,e.isPrimaryClient,a);_z(e,n,l.Co);const c=new K$(t,n,s);return e.Mo.set(t,c),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),l.snapshot})).apply(this,arguments)}function rz(e,t){return iz.apply(this,arguments)}function iz(){return(iz=hw(function*(e,t){const n=hL(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter(e=>!zF(e,t))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield yV(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),JV(n.remoteStore,r.targetId),yz(n,r.targetId)}).catch(rV))):(yz(n,r.targetId),yield yV(n.localStore,r.targetId,!0))})).apply(this,arguments)}function sz(){return(sz=hw(function*(e,t,n){const r=Iz(e);try{const e=yield function(e,t){const n=hL(e),r=IL.now(),i=t.reduce((e,t)=>e.add(t.key),zU());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>n.Wn.vn(e,i).next(i=>{s=i;const o=[];for(const e of t){const t=mU(e,s.get(e.key));null!=t&&o.push(new CU(e.key,t,uF(t.value.mapValue),hU.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})).then(e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new MU(OL)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),yield wz(r,e.changes),yield p$(r.remoteStore)}catch(i){const e=x$(i,"Failed to persist write");n.reject(e)}})).apply(this,arguments)}function oz(e,t){return az.apply(this,arguments)}function az(){return(az=hw(function*(e,t){const n=hL(e);try{const e=yield fV(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Uo.get(t);r&&(uL(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?uL(r.$o):e.removedDocuments.size>0&&(uL(r.$o),r.$o=!1))}),yield wz(n,e,t)}catch(r){yield rV(r)}})).apply(this,arguments)}function lz(e,t,n){const r=hL(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=hL(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)}),r&&q$(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function cz(e,t,n){return uz.apply(this,arguments)}function uz(){return(uz=hw(function*(e,t,n){const r=hL(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new MU(ZL.comparator);e=e.insert(s,hF.newNoDocument(s,kL.min()));const n=zU().add(s),i=new qU(kL.min(),new Map,new RU(OL),e,n);yield oz(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),Ez(r)}else yield yV(r.localStore,t,!1).then(()=>yz(r,t,n)).catch(rV)})).apply(this,arguments)}function hz(e,t){return dz.apply(this,arguments)}function dz(){return(dz=hw(function*(e,t){const n=hL(e),r=t.batch.batchId;try{const e=yield dV(n.localStore,t);mz(n,r,null),gz(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield wz(n,e)}catch(i){yield rV(i)}})).apply(this,arguments)}function pz(e,t,n){return fz.apply(this,arguments)}function fz(){return(fz=hw(function*(e,t,n){const r=hL(e);try{const e=yield function(e,t){const n=hL(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.An.lookupMutationBatch(e,t).next(t=>(uL(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t))).next(()=>n.An.performConsistencyCheck(e)).next(()=>n.Wn.vn(e,r))})}(r.localStore,t);mz(r,t,n),gz(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield wz(r,e)}catch(i){yield rV(i)}})).apply(this,arguments)}function gz(e,t){(e.jo.get(t)||[]).forEach(e=>{e.resolve()}),e.jo.delete(t)}function mz(e,t,n){const r=hL(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function yz(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach(t=>{e.qo.containsKey(t)||vz(e,t)})}function vz(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(JV(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Ez(e))}function _z(e,t,n){for(const r of n)r instanceof j$?(e.qo.addReference(r.key,t),Cz(e,r)):r instanceof Z$?(sL("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||vz(e,r.key)):cL()}function Cz(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(sL("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Ez(e))}function Ez(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new ZL(RL.fromString(t)),r=e.Qo.next();e.Uo.set(r,new J$(n)),e.Bo=e.Bo.insert(n,r),KV(e.remoteStore,new KB(VF(xF(n.path)),r,2,SL.I))}}function wz(e,t,n){return Sz.apply(this,arguments)}function Sz(){return(Sz=hw(function*(e,t,n){const r=hL(e),i=[],s=[],o=[];var a;r.Mo.isEmpty()||(r.Mo.forEach((e,a)=>{o.push(r.Go(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=aV.$n(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),r.Oo.br(i),yield(a=hw(function*(e,t){const n=hL(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>WB.forEach(t,t=>WB.forEach(t.kn,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>WB.forEach(t.xn,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!jB(r))throw r;sL("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.qn.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.qn=n.qn.insert(e,r)}}}),function(e,t){return a.apply(this,arguments)})(r.localStore,s))})).apply(this,arguments)}function bz(e,t){return Pz.apply(this,arguments)}function Pz(){return(Pz=hw(function*(e,t){const n=hL(e);if(!n.currentUser.isEqual(t)){sL("SyncEngine","User change. New user:",t.toKey());const e=yield uV(n.localStore,t);n.currentUser=t,(r=n).jo.forEach(e=>{e.forEach(e=>{e.reject(new pL(dL.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.jo.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield wz(n,e.Gn)}var r})).apply(this,arguments)}function Oz(e,t){const n=hL(e),r=n.Uo.get(t);if(r&&r.$o)return zU().add(r.key);{let e=zU();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}function Tz(e){const t=hL(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=oz.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Oz.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=cz.bind(null,t),t.Oo.br=H$.bind(null,t.eventManager),t.Oo.zo=G$.bind(null,t.eventManager),t}function Iz(e){const t=hL(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=hz.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=pz.bind(null,t),t}class kz{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return hw(function*(){t.k=UV(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return function(e,t,n,r){return new cV(e,t,n,r)}(this.persistence,new lV,e.initialUser,this.k)}Yo(e){return new TV(kV.ks,this.k)}Jo(e){return new MV}terminate(){var e=this;return hw(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Az{initialize(e,t){var n=this;return hw(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>lz(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=bz.bind(null,n.syncEngine),yield function(e,t){return k$.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new U$}createDatastore(e){const t=UV(e.databaseInfo.databaseId),n=new LV(e.databaseInfo);return new HV(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>lz(this.syncEngine,e,0),s=xV.Pt()?new xV:new NV,new qV(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Q$(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=hw(function*(e){const t=hL(e);sL("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),yield ZV(t),t.Hr.shutdown(),t.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class Mz{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Nz{constructor(e,t,n,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tL.UNAUTHENTICATED,this.clientId=PL.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var e=hw(function*(e){sL("FirestoreClient","Received user=",e.uid),yield i.authCredentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(n,e=>(sL("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}getConfiguration(){var e=this;return hw(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new pL(dL.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new fL;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(hw(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const e=x$(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function xz(e,t){return Rz.apply(this,arguments)}function Rz(){return(Rz=hw(function*(e,t){e.asyncQueue.verifyOperationInProgress(),sL("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(function(){var e=hw(function*(e){r.isEqual(e)||(yield uV(t.localStore,e),r=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function Dz(e,t){return Lz.apply(this,arguments)}function Lz(){return(Lz=hw(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield Fz(e);sL("FirestoreClient","Initializing OnlineComponentProvider");const r=yield e.getConfiguration();yield t.initialize(n,r),e.setCredentialChangeListener(e=>T$(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>T$(t.remoteStore,n)),e.onlineComponents=t})).apply(this,arguments)}function Fz(e){return Uz.apply(this,arguments)}function Uz(){return(Uz=hw(function*(e){return e.offlineComponents||(sL("FirestoreClient","Using default OfflineComponentProvider"),yield xz(e,new kz)),e.offlineComponents})).apply(this,arguments)}function Bz(e){return Vz.apply(this,arguments)}function Vz(){return(Vz=hw(function*(e){return e.onlineComponents||(sL("FirestoreClient","Using default OnlineComponentProvider"),yield Dz(e,new Az)),e.onlineComponents})).apply(this,arguments)}function $z(e){return zz.apply(this,arguments)}function zz(){return(zz=hw(function*(e){const t=yield Bz(e),n=t.eventManager;return n.onListen=X$.bind(null,t.syncEngine),n.onUnlisten=rz.bind(null,t.syncEngine),n})).apply(this,arguments)}class Hz{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Gz{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gz&&e.projectId===this.projectId&&e.database===this.database}}const qz=new Map;function Wz(e,t,n){if(!n)throw new pL(dL.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function jz(e){if(!ZL.isDocumentKey(e))throw new pL(dL.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Zz(e){if(ZL.isDocumentKey(e))throw new pL(dL.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Yz(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":cL()}function Kz(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new pL(dL.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yz(e);throw new pL(dL.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Jz{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new pL(dL.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new pL(dL.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new pL(dL.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qz{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jz({}),this._settingsFrozen=!1,e instanceof Gz?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new pL(dL.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gz(e.options.projectId)}(e))}get app(){if(!this._app)throw new pL(dL.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new pL(dL.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jz(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new mL;switch(e.type){case"gapi":const t=e.client;return uL(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new CL(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new pL(dL.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=qz.get(e);t&&(sL("ComponentProvider","Removing Datastore"),qz.delete(e),t.terminate())}(this),Promise.resolve()}}function Xz(e,t,n,r={}){var i;const s=(e=Kz(e,Qz))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&aL("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tL.MOCK_USER;else{t=kw(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new pL(dL.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tL(s)}e._authCredentials=new yL(new gL(t,n))}}class eH{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nH(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new eH(this.firestore,e,this._key)}}class tH{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new tH(this.firestore,e,this._query)}}class nH extends tH{constructor(e,t,n){super(e,t,xF(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new eH(this.firestore,null,new ZL(e))}withConverter(e){return new nH(this.firestore,e,this._path)}}function rH(e,t,...n){if(e=sS(e),Wz("collection","path",t),e instanceof Qz){const r=RL.fromString(t,...n);return Zz(r),new nH(e,null,r)}{if(!(e instanceof eH||e instanceof nH))throw new pL(dL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(RL.fromString(t,...n));return Zz(r),new nH(e.firestore,null,r)}}function iH(e,t,...n){if(e=sS(e),1===arguments.length&&(t=PL.A()),Wz("doc","path",t),e instanceof Qz){const r=RL.fromString(t,...n);return jz(r),new eH(e,null,new ZL(r))}{if(!(e instanceof eH||e instanceof nH))throw new pL(dL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(RL.fromString(t,...n));return jz(r),new eH(e.firestore,e instanceof nH?e.converter:null,new ZL(r))}}class sH{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new BV(this,"async_queue_retry"),this.bc=()=>{const e=FV();e&&sL("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=FV();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=FV();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise(()=>{});const t=new fL;return this.vc(()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.gc.push(e),this.Vc()))}Vc(){var e=this;return hw(function*(){if(0!==e.gc.length){try{yield e.gc[0](),e.gc.shift(),e.ur.reset()}catch(t){if(!jB(t))throw t;sL("AsyncQueue","Operation failed with retryable error: "+t)}e.gc.length>0&&e.ur.Zi(()=>e.Vc())}})()}vc(e){const t=this.mc.then(()=>(this.Ic=!0,e().catch(e=>{throw this.Ec=e,this.Ic=!1,oL("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ic=!1,e))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=N$.createAndSchedule(this,e,t,n,e=>this.Sc(e));return this.Tc.push(r),r}Pc(){this.Ec&&cL()}verifyOperationInProgress(){}Dc(){var e=this;return hw(function*(){let t;do{t=e.mc,yield t}while(t!==e.mc)})()}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then(()=>{this.Tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()})}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function oH(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class aH extends Qz{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new sH,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||uH(this),this._firestoreClient.terminate()}}function lH(e=MS()){return OS(e,"firestore").getImmediate()}function cH(e){return e._firestoreClient||uH(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function uH(e){var t;const n=e._freezeSettings(),r=(i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new Hz(e._databaseId,i,e._persistenceKey,(s=n).host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));var i,s;e._firestoreClient=new Nz(e._authCredentials,e._appCheckCredentials,e._queue,r)}class hH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new pL(dL.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new LL(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class dH{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dH(UL.fromBase64String(e))}catch(t){throw new pL(dL.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new dH(UL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pH{constructor(e){this._methodName=e}}class fH{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pL(dL.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pL(dL.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return OL(this._lat,e._lat)||OL(this._long,e._long)}}const gH=/^__.*__$/;class mH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new CU(e,this.data,this.fieldMask,t,this.fieldTransforms):new _U(e,this.data,t,this.fieldTransforms)}}class yH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new CU(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vH(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cL()}}class _H{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new _H(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return NH(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(vH(this.$c)&&gH.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class CH{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||UV(e)}Qc(e,t,n,r=!1){return new _H({$c:e,methodName:t,jc:n,path:LL.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function EH(e){const t=e._freezeSettings(),n=UV(e._databaseId);return new CH(e._databaseId,!!t.ignoreUndefinedProperties,n)}function wH(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);IH("Data must be an object, but it was:",o,r);const a=OH(r,o);let l,c;if(s.merge)l=new FL(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=kH(t,r,n);if(!o.contains(i))throw new pL(dL.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);xH(e,i)||e.push(i)}l=new FL(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new mH(new cF(a),l,c)}class SH extends pH{_toFieldTransform(e){if(2!==e.$c)throw e.qc(1===e.$c?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof SH}}class bH extends pH{_toFieldTransform(e){return new cU(e.path,new tU)}isEqual(e){return e instanceof bH}}function PH(e,t){if(TH(e=sS(e)))return IH("Unsupported field value:",t,e),OH(e,t);if(e instanceof pH)return function(e,t){if(!vH(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=PH(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=sS(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return KF(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=IL.fromDate(e);return{timestampValue:rB(t.k,n)}}if(e instanceof IL){const n=new IL(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:rB(t.k,n)}}if(e instanceof fH)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof dH)return{bytesValue:iB(t.k,e._byteString)};if(e instanceof eH){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aB(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${Yz(e)}`)}(e,t)}function OH(e,t){const n={};return NL(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ML(e,(e,r)=>{const i=PH(r,t.Mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function TH(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof IL||e instanceof fH||e instanceof dH||e instanceof eH||e instanceof pH)}function IH(e,t,n){if(!TH(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Yz(n);throw t.qc("an object"===r?e+" a custom object":e+" "+r)}var r}function kH(e,t,n){if((t=sS(t))instanceof hH)return t._internalPath;if("string"==typeof t)return MH(e,t);throw NH("Field path arguments must be of type string or ",e,!1,void 0,n)}const AH=new RegExp("[~\\*/\\[\\]]");function MH(e,t,n){if(t.search(AH)>=0)throw NH(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new hH(...t.split("."))._internalPath}catch{throw NH(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function NH(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new pL(dL.INVALID_ARGUMENT,a+e+l)}function xH(e,t){return e.some(e=>e.isEqual(t))}class RH{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new eH(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new DH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(LH("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class DH extends RH{data(){return super.data()}}function LH(e,t){return"string"==typeof t?MH(e,t):t instanceof hH?t._internalPath:t._delegate._internalPath}class FH{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class UH extends RH{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new BH(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(LH("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class BH extends UH{data(e={}){return super.data(e)}}class VH{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new FH(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new BH(this._firestore,this._userDataWriter,n.key,n,new FH(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pL(dL.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new BH(e._firestore,e._userDataWriter,n.doc.key,n.doc,new FH(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new BH(e._firestore,e._userDataWriter,t.doc.key,t.doc,new FH(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:$H(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function $H(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cL()}}function zH(e){if(DF(e)&&0===e.explicitOrderBy.length)throw new pL(dL.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class HH{}function GH(e,...t){for(const n of t)e=n._apply(e);return e}class qH extends HH{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=EH(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new pL(dL.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){QH(o,s);const t=[];for(const n of o)t.push(JH(r,e,n));a={arrayValue:{values:t}}}else a=JH(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||QH(o,s),a=function(e,t,n,r=!1){return PH(n,e.Qc(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);const l=yF.create(i,s,a);return function(e,t){if(t.V()){const n=FF(e);if(null!==n&&!n.isEqual(t.field))throw new pL(dL.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=LF(e);null!==r&&XH(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new pL(dL.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,l),l}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new tH(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new NF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function WH(e,t,n){const r=t,i=LH("where",e);return new qH(i,r,n)}class jH extends HH{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new pL(dL.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new pL(dL.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new IF(t,n);return function(e,t){if(null===LF(e)){const n=FF(e);null!==n&&XH(0,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new tH(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new NF(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function ZH(e,t="asc"){const n=t,r=LH("orderBy",e);return new jH(r,n)}class YH extends HH{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new tH(e.firestore,e.converter,$F(e._query,this.Xc,this.Zc))}}function KH(e){return function(e,t){if(t<=0)throw new pL(dL.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),new YH("limit",e,"F")}function JH(e,t,n){if("string"==typeof(n=sS(n))){if(""===n)throw new pL(dL.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!UF(t)&&-1!==n.indexOf("/"))throw new pL(dL.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(RL.fromString(n));if(!ZL.isDocumentKey(r))throw new pL(dL.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return nF(e,new ZL(r))}if(n instanceof eH)return nF(e,n._key);throw new pL(dL.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yz(n)}.`)}function QH(e,t){if(!Array.isArray(e)||0===e.length)throw new pL(dL.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new pL(dL.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function XH(e,t,n){if(!n.isEqual(t))throw new pL(dL.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function eG(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function tG(e){e=Kz(e,eH);const t=Kz(e.firestore,aH);return function(e,t,n={}){const r=new fL;return e.asyncQueue.enqueueAndForget(hw(function*(){return function(e,t,n,r,i){const s=new Mz({next:s=>{t.enqueueAndForget(()=>$$(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new pL(dL.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new pL(dL.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new W$(xF(n.path),s,{includeMetadataChanges:!0,wo:!0});return B$(e,o)}(yield $z(e),e.asyncQueue,t,n,r)})),r.promise}(cH(t),e._key).then(n=>uG(t,e,n))}class nG extends class{convertValue(e,t="none"){switch(YL(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $L(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zL(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw cL()}}convertObject(e,t){const n={};return ML(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new fH($L(e.latitude),$L(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=GL(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qL(e));default:return null}}convertTimestamp(e){const t=VL(e);return new IL(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=RL.fromString(e);uL(IB(n));const r=new Gz(n.get(1),n.get(3)),i=new ZL(n.popFirst(5));return r.isEqual(t)||oL(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new dH(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new eH(this.firestore,null,t)}}function rG(e){e=Kz(e,tH);const t=Kz(e.firestore,aH),n=cH(t),r=new nG(t);return zH(e._query),function(e,t,n={}){const r=new fL;return e.asyncQueue.enqueueAndForget(hw(function*(){return function(e,t,n,r,i){const s=new Mz({next:n=>{t.enqueueAndForget(()=>$$(e,o)),n.fromCache&&"server"===r.source?i.reject(new pL(dL.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new W$(n,s,{includeMetadataChanges:!0,wo:!0});return B$(e,o)}(yield $z(e),e.asyncQueue,t,n,r)})),r.promise}(n,e._query).then(n=>new VH(t,r,e,n))}function iG(e,t,n){e=Kz(e,eH);const r=Kz(e.firestore,aH),i=eG(e.converter,t,n);return cG(r,[wH(EH(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,hU.none())])}function sG(e,t,n,...r){e=Kz(e,eH);const i=Kz(e.firestore,aH),s=EH(i);let o;return o="string"==typeof(t=sS(t))||t instanceof hH?function(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[kH(t,r,n)],l=[i];if(s.length%2!=0)throw new pL(dL.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(kH(t,s[d])),l.push(s[d+1]);const c=[],u=cF.empty();for(let d=a.length-1;d>=0;--d)if(!xH(c,a[d])){const e=a[d];let t=l[d];t=sS(t);const n=o.Bc(e);if(t instanceof SH)c.push(e);else{const r=PH(t,n);null!=r&&(c.push(e),u.set(e,r))}}const h=new FL(c);return new yH(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qc(1,t,n);IH("Data must be an object, but it was:",i,r);const s=[],o=cF.empty();ML(r,(e,r)=>{const a=MH(t,e,n);r=sS(r);const l=i.Bc(a);if(r instanceof SH)s.push(a);else{const e=PH(r,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new FL(s);return new yH(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),cG(i,[o.toMutation(e._key,hU.exists(!0))])}function oG(e){return cG(Kz(e.firestore,aH),[new bU(e._key,hU.none())])}function aG(e,t){const n=Kz(e.firestore,aH),r=iH(e),i=eG(e.converter,t);return cG(n,[wH(EH(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,hU.exists(!1))]).then(()=>r)}function lG(e,...t){var n,r,i;e=sS(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||oH(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(oH(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let l,c,u;if(e instanceof eH)c=Kz(e.firestore,aH),u=xF(e._key.path),l={next:n=>{t[o]&&t[o](uG(c,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Kz(e,tH);c=Kz(n.firestore,aH),u=n._query;const r=new nG(c);l={next:e=>{t[o]&&t[o](new VH(c,r,n,e))},error:t[o+1],complete:t[o+2]},zH(e._query)}return function(e,t,n,r){const i=new Mz(r),s=new W$(t,i,n);return e.asyncQueue.enqueueAndForget(hw(function*(){return B$(yield $z(e),s)})),()=>{i.nc(),e.asyncQueue.enqueueAndForget(hw(function*(){return $$(yield $z(e),s)}))}}(cH(c),u,a,l)}function cG(e,t){return function(e,t){const n=new fL;return e.asyncQueue.enqueueAndForget(hw(function*(){return function(e,t,n){return sz.apply(this,arguments)}(yield function(e){return Bz(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(cH(e),t)}function uG(e,t,n){const r=n.docs.get(t._key),i=new nG(e);return new UH(e,i,t._key,r,new FH(n.hasPendingWrites,n.fromCache),t.converter)}function hG(){return new bH("serverTimestamp")}!function(e,t=!0){nL="9.6.6",PS(new oS("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new aH(r,new vL(e.getProvider("auth-internal")),new wL(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),xS(eL,"3.4.4",e),xS(eL,"3.4.4","esm2017")}();class dG{constructor(e){return e}}const pG=new or("angularfire2.firestore-instances");function fG(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new dG(r)}}const gG={provide:class{constructor(){return dT("firestore")}},deps:[[new Nr,pG]]},mG={provide:dG,useFactory:function(e,t){const n=hT("firestore",e,t);return n&&new dG(n)},deps:[[new Nr,pG],ST]};let yG=(()=>{class e{constructor(){xS("angularfire",aT.full,"fst")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[mG,gG]}),e})();const vG=wT(aG,!0),_G=wT(rH,!0),CG=wT(Xz,!0),EG=wT(oG,!0),wG=wT(iH,!0),SG=wT(tG,!0),bG=wT(rG,!0),PG=wT(lH,!0),OG=wT(KH,!0),TG=wT(lG,!0),IG=wT(ZH,!0),kG=wT(GH,!0),AG=wT(iG,!0),MG=wT(sG,!0),NG=wT(WH,!0);let xG=(()=>{class e{constructor(e,t){this.collectionName=e,this.firestore=t,this.subDAOs={};this.collection=_G(t,this.collectionName).withConverter({fromFirestore:e=>e.data(),toFirestore:e=>e})}create(e){var t=this;return hw(function*(){return(yield vG(t.collection,e)).id})()}read(e){var t=this;return hw(function*(){const n=yield SG(wG(t.collection,e));return n.exists()?yw.of(dw.getNonNullable(n.data())):yw.empty()})()}exists(e){var t=this;return hw(function*(){return(yield t.read(e)).isPresent()})()}update(e,t){var n=this;return hw(function*(){return MG(wG(n.collection,e),t)})()}delete(e){return EG(wG(this.collection,e))}set(t,n){return pw(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),AG(wG(this.collection,t),n)}subscribeToChanges(e,t){return TG(wG(this.collection,e),e=>{t(yw.ofNullable(e.data()))})}findWhere(e,t,n){var r=this;return hw(function*(){const i=r.constructQuery(e,t,n);return(yield bG(i)).docs.map(e=>({id:e.id,data:e.data()}))})()}observingWhere(t,n,r){const i=this.constructQuery(t,r);return TG(i,t=>{const r=[],i=[],s=[];t.docChanges().forEach(e=>{const t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":i.push(t);break;case"removed":s.push(t)}}),r.length>0&&(pw(e.VERBOSE,"firebase gave us "+r.length+" NEW "+this.collectionName),n.onDocumentCreated(r)),i.length>0&&(pw(e.VERBOSE,"firebase gave us "+i.length+" MODIFIED "+this.collectionName),n.onDocumentModified(i)),s.length>0&&(pw(e.VERBOSE,"firebase gave us "+s.length+" DELETED "+this.collectionName),n.onDocumentDeleted(s))})}constructQuery(e,t,n){let r=kG(this.collection);null!=t&&(r=kG(r,IG(t))),null!=n&&(r=kG(r,OG(n)));for(const i of e)r=kG(r,NG(i[0],i[1],i[2]));return r}subCollectionDAO(t,n){const r=`${this.collection.path}/${t}/${n}`;if(r in this.subDAOs)return this.subDAOs[r];{const t=new class extends e{constructor(e){super(r,e)}}(this.firestore);return this.subDAOs[r]=t,t}}}return e.VERBOSE=!1,e})();class RG{static success(e){return new DG(e)}static failure(e){return new LG(e)}constructor(){}equals(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&mw(this.get(),e.get())}}class DG extends RG{constructor(e){super(),this.value=e}isSuccess(){return!0}isFailure(){return!1}get(){return this.value}getReason(){throw new Error("Cannot get failure reason from a success")}getReasonOr(e){return e}toOptional(){return yw.of(this.value)}toString(){return`MGPFallible.success(${this.value})`}}class LG extends RG{constructor(e){super(),this.reason=e}isSuccess(){return!1}isFailure(){return!0}get(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}getReason(){return this.reason}getReasonOr(e){return this.getReason()}toOptional(){return yw.empty()}toString(){return`MGPFallible.failure(${this.reason})`}}class FG{constructor(e){this.reason=e}static ofFallible(e){return e.isSuccess()?FG.SUCCESS:FG.failure(e.getReason())}static failure(e){return new FG(e)}isFailure(){return!1===this.isSuccess()}isSuccess(){return null==this.reason}getReason(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}toFallible(e){return this.isSuccess()?RG.success(e):RG.failure(this.getReason())}toFailedFallible(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return RG.failure(this.getReason())}}FG.SUCCESS=new FG(null);let UG=(()=>{class e extends xG{constructor(e){super("errors",e)}findErrors(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}return e.\u0275fac=function(t){return new(t||e)(Or(dG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var BG=n(5378);let VG=(()=>{class e{infoMessage(e){this.message(e,"is-info")}gameMessage(e){this.message(e,"is-warning")}criticalMessage(e){this.message(e,"is-danger")}message(e,t){(0,BG.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class $G{constructor(e,t,n){this.errorDAO=e,this.router=t,this.messageDisplayer=n,$G.setSingletonInstance(this)}static setSingletonInstance(e){$G.singleton=yw.of(e)}static logErrorAndFail(e,t,n){throw $G.logError(e,t,n),new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`)}static logError(e,t,n){if(this.singleton.isAbsent())throw new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`);return this.singleton.get().logError(e,t,n),FG.failure(e+": "+t)}logError(e,t,n){var r=this;return hw(function*(){r.messageDisplayer.criticalMessage($localize`An unexpected error was encountered. We have logged it and will try to fix its cause as soon as possible.`);const i=r.router.url,s=yield r.errorDAO.findErrors(e,i,t,n);if(0===s.length){const s={component:e,route:i,message:t,firstEncounter:hG(),lastEncounter:hG(),occurences:1};null!=n&&(s.data=n),yield r.errorDAO.create(s)}else{const e=s[0].id,t=s[0].data;yield r.errorDAO.update(e,{lastEncounter:hG(),occurences:t.occurences+1})}})()}}function zG(e,t){if(!1===e)throw $G.logError("Assertion failure",t),new Error(`Assertion failure: ${t}`)}$G.singleton=yw.empty(),$G.\u0275fac=function(e){return new(e||$G)(Or(UG),Or(e_),Or(VG))},$G.\u0275prov=Se({token:$G,factory:$G.\u0275fac,providedIn:"root"});class HG{constructor(e){this.value=e}}HG.HARD_DRAW=new HG(0),HG.RESIGN=new HG(1),HG.ESCAPE=new HG(2),HG.VICTORY=new HG(3),HG.TIMEOUT=new HG(4),HG.UNACHIEVED=new HG(5),HG.AGREED_DRAW_BY_ZERO=new HG(6),HG.AGREED_DRAW_BY_ONE=new HG(7);class GG{constructor(e,t){this.id=e,this.data=t}getTurn(){return this.data.turn}isHardDraw(){return this.data.result===HG.HARD_DRAW.value}isAgreedDraw(){return this.data.result===HG.AGREED_DRAW_BY_ZERO.value||this.data.result===HG.AGREED_DRAW_BY_ONE.value}getDrawAccepter(){return this.data.result===HG.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(zG(this.data.result===HG.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),dw.getNonNullable(this.data.playerOne))}isWin(){return this.data.result===HG.VICTORY.value}isTimeout(){return this.data.result===HG.TIMEOUT.value}isResign(){return this.data.result===HG.RESIGN.value}getWinner(){return yw.ofNullable(this.data.winner)}getLoser(){return yw.ofNullable(this.data.loser)}setWinnerAndLoser(e,t){return new GG(this.id,{...this.data,winner:e,loser:t})}}let qG=(()=>{class e extends xG{constructor(t){super("parties",t),pw(e.VERBOSE,"PartDAO.constructor")}updateAndBumpIndex(e,t,n,r){var i=this;return hw(function*(){return r={...r,lastUpdate:{index:n+1,player:t.value}},i.update(e,r)})()}observeActiveParts(e){return this.observingWhere([["result","==",HG.UNACHIEVED.value]],e)}userHasActivePart(e){var t=this;return hw(function*(){const n=yield t.findWhere([["playerZero","==",e],["result","==",HG.UNACHIEVED.value]]),r=yield t.findWhere([["playerOne","==",e],["result","==",HG.UNACHIEVED.value]]);return n.length>0||r.length>0})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(dG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),WG=(()=>{class e extends xG{constructor(t){super("chats",t),pw(e.VERBOSE,"ChatDAO.constructor")}addMessage(e,t){var n=this;return hw(function*(){return n.subCollectionDAO(e,"messages").create(t)})()}getLastMessages(e,t){var n=this;return hw(function*(){return n.subCollectionDAO(e,"messages").findWhere([],"postedTime",t)})()}subscribeToMessages(e,t){return this.subCollectionDAO(e,"messages").observingWhere([],t,"postedTime")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(dG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),jG=(()=>{class e{}return e.CANNOT_SEND_MESSAGE=()=>$localize`You're not allowed to send a message here.`,e.FORBIDDEN_MESSAGE=()=>$localize`This message is forbidden.`,e})(),ZG=(()=>{class e{constructor(t){this.chatDAO=t,this.followedChatId=yw.empty(),pw(e.VERBOSE,"ChatService.constructor")}startObserving(t,n){pw(e.VERBOSE,"ChatService.startObserving "+t),this.followedChatId.isAbsent()?(pw(e.VERBOSE,"[start watching chat "+t),this.followedChatId=yw.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToMessages(t,n)):this.followedChatId.equalsValue(t)?$G.logErrorAndFail("ChatService","Already observing same chat",{chatId:t}):$G.logErrorAndFail("ChatService","Already observing another chat",{chatId:t,followedChatId:this.followedChatId.get()})}stopObserving(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");pw(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=yw.empty(),this.followedChatUnsubscribe()}isObserving(){return this.followedChatId.isPresent()}deleteChat(t){var n=this;return hw(function*(){return pw(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)})()}createNewChat(e){var t=this;return hw(function*(){return t.chatDAO.set(e,{})})()}sendMessage(e,t,n){var r=this;return hw(function*(){if(r.followedChatId.isAbsent())return FG.failure("Cannot send message if not observing chat");const i=r.followedChatId.get();if(!1===r.userCanSendMessage(e.name,i))return FG.failure(jG.CANNOT_SEND_MESSAGE());if(r.isForbiddenMessage(t))return FG.failure(jG.FORBIDDEN_MESSAGE());const s={content:t,sender:e,postedTime:hG(),currentTurn:n};return yield r.chatDAO.addMessage(i,s),FG.SUCCESS})()}userCanSendMessage(e,t){return""!==e}isForbiddenMessage(e){return""===e}ngOnDestroy(){this.isObserving()&&this.stopObserving()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(WG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class YG{constructor(e,t,n){this.onDocumentCreated=e,this.onDocumentModified=t,this.onDocumentDeleted=n}}let KG=(()=>{class e extends xG{constructor(t){super(e.COLLECTION_NAME,t),pw(e.VERBOSE,"UserDAO.constructor")}usernameIsAvailable(e){var t=this;return hw(function*(){return 0===(yield t.findWhere([["username","==",e]])).length})()}setUsername(e,t){var n=this;return hw(function*(){yield n.update(e,{username:t})})()}markVerified(e){var t=this;return hw(function*(){yield t.update(e,{verified:!0})})()}observeUserByUsername(e,t){return this.observingWhere([["username","==",e]],t)}observeActiveUsers(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}updatePresenceToken(e){return this.update(e,{last_changed:hG()})}}return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(Or(dG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),JG=(()=>{class e{constructor(e){this.userDAO=e,this.activeUsersBS=new am([]),this.activeUsersObs=this.activeUsersBS.asObservable()}startObserving(){pw(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");const t=new YG(t=>{pw(e.VERBOSE,"our DAO gave us "+t.length+" new user(s)");const n=this.activeUsersBS.value.concat(...t);this.activeUsersBS.next(this.sort(n))},t=>{let n=this.activeUsersBS.value;pw(e.VERBOSE,"our DAO updated "+t.length+" user(s)");for(const e of t)n.forEach(t=>{t.id===e.id&&(t.data=e.data)}),n=this.sort(n);this.activeUsersBS.next(n)},e=>{const t=this.activeUsersBS.value.filter(t=>!e.some(e=>e.id===t.id));this.activeUsersBS.next(this.sort(t))});this.unsubscribe=this.userDAO.observeActiveUsers(t)}stopObserving(){this.unsubscribe(),this.activeUsersBS.next([])}sort(e){return e.sort((e,t)=>{const n=dw.getNonNullable(e.data).last_changed,r=dw.getNonNullable(n).seconds,i=dw.getNonNullable(t.data).last_changed;return r-dw.getNonNullable(i).seconds})}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(KG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),QG=(()=>{class e{constructor(e,t){this.activeUsersService=e,this.userDAO=t}getActiveUsersObs(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}unSubFromActiveUsersObs(){this.activeUsersService.stopObserving()}observeUserByUsername(e,t){return this.userDAO.observeUserByUsername(e,t)}observeUser(e,t){return this.userDAO.subscribeToChanges(e,t)}getUserLastChanged(e){var t=this;return hw(function*(){const n=yield t.userDAO.read(e);if(n.isAbsent())return yw.empty();{const e=n.get().last_changed;return zG(null!=e,"should not receive a last_changed equal to null"),yw.of(e)}})()}}return e.\u0275fac=function(t){return new(t||e)(Or(JG),Or(KG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class XG extends A{constructor(e=1/0,t=1/0,n=nT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:i,_windowTime:s}=this;t||(n.push(e),!r&&n.push(i.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:r}=this,i=r.slice();for(let s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2)r=t;r&&n.splice(0,r+1)}}}const eq="@firebase/database";let tq="";class nq{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),zw(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:$w(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class rq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Gw(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const iq=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new nq(t)}}catch{}return new rq},sq=iq("localStorage"),oq=iq("sessionStorage"),aq=new mS("@firebase/database"),lq=function(){let e=1;return function(){return e++}}(),cq=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,vw(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new Xw;n.update(t);const r=n.digest();return Ew.encodeByteArray(r)},uq=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=uq.apply(null,r):t+="object"==typeof r?zw(r):r,t+=" "}return t};let hq=null,dq=!0;const pq=function(...e){if(!0===dq&&(dq=!1,null===hq&&!0===oq.get("logging_enabled")&&function(e,t){vw(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(aq.logLevel=hS.VERBOSE,hq=aq.log.bind(aq),t&&oq.set("logging_enabled",!0)):"function"==typeof e?hq=e:(hq=null,oq.remove("logging_enabled"))}(!0)),hq){const t=uq.apply(null,e);hq(t)}},fq=function(e){return function(...t){pq(e,...t)}},gq=function(...e){const t="FIREBASE INTERNAL ERROR: "+uq(...e);aq.error(t)},mq=function(...e){const t=`FIREBASE FATAL ERROR: ${uq(...e)}`;throw aq.error(t),new Error(t)},yq=function(...e){const t="FIREBASE WARNING: "+uq(...e);aq.warn(t)},vq=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},_q="[MIN_NAME]",Cq="[MAX_NAME]",Eq=function(e,t){if(e===t)return 0;if(e===_q||t===Cq)return-1;if(t===_q||e===Cq)return 1;{const n=kq(e),r=kq(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},wq=function(e,t){return e===t?0:e<t?-1:1},Sq=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+zw(t))},bq=function(e){if("object"!=typeof e||null===e)return zw(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=zw(t[r]),n+=":",n+=bq(e[t[r]]);return n+="}",n},Pq=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function Oq(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Tq=function(e){vw(!vq(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,1-t)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()},Iq=new RegExp("^-?(0*)\\d{1,10}$"),kq=function(e){if(Iq.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Aq=function(e){try{e()}catch(t){setTimeout(()=>{throw yq("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},Mq=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class Nq{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){yq(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class xq{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(pq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',yq(e)}}let Rq=(()=>{class e{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return e.OWNER="owner",e})();const Dq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Lq="long_polling";class Fq{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=sq.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&sq.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Uq(e,t,n){let r;if(vw("string"==typeof t,"typeof type must == string"),vw("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Lq)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return Oq(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Bq{constructor(){this.counters_={}}incrementCounter(e,t=1){Gw(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Pw(this.counters_)}}const Vq={},$q={};function zq(e){const t=e.toString();return Vq[t]||(Vq[t]=new Bq),Vq[t]}class Hq{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Aq(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Gq{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=fq(e),this.stats_=zq(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Uq(t,Lq,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Hq(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new qq((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Dq.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Gq.forceAllow_=!0}static forceDisallow(){Gq.forceDisallow_=!0}static isAvailable(){return!(!Gq.forceAllow_&&(Gq.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=zw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ww(t),r=Pq(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=zw(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class qq{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=lq(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=qq.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){pq("frame writing exception"),i.stack&&pq(i.stack),pq(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||pq("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;(!e||"loaded"===e||"complete"===e)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{pq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}let Wq=null;"undefined"!=typeof MozWebSocket?Wq=MozWebSocket:"undefined"!=typeof WebSocket&&(Wq=WebSocket);let jq=(()=>{class e{constructor(t,n,r,i,s,o,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=fq(this.connId),this.stats_=zq(n),this.connURL=e.connectionURL_(n,o,a,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Dq.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Uq(e,"websocket",i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,sq.set("previous_websocket_failure",!0);try{this.mySock=new Wq(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Wq&&!e.forceDisallow_}static previouslyFailed(){return sq.isInMemoryStorage||!0===sq.get("previous_websocket_failure")}markConnectionHealthy(){sq.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=$w(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(vw(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=zw(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Pq(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e})();class Zq{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Gq,jq]}initTransports_(e){const t=jq&&jq.isAvailable();let n=t&&!jq.previouslyFailed();if(e.webSocketOnly&&(t||yq("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[jq];else{const e=this.transports_=[];for(const t of Zq.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class Yq{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=fq("c:"+this.id+":"),this.transportManager_=new Zq(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Mq(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Sq("t",e),n=Sq("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Sq("t",e),n=Sq("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Sq("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?gq("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):gq("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&yq("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Mq(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Mq(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(sq.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Kq{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Jq{constructor(e){this.allowedEvents_=e,this.listeners_={},vw(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){vw(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Qq extends Jq{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!Mw()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Qq}getInitialEvent(e){return vw("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Xq{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function eW(){return new Xq("")}function tW(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nW(e){return e.pieces_.length-e.pieceNum_}function rW(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Xq(e.pieces_,t)}function iW(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sW(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function oW(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Xq(t,0)}function aW(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Xq)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Xq(n,0)}function lW(e){return e.pieceNum_>=e.pieces_.length}function cW(e,t){const n=tW(e),r=tW(t);if(null===n)return t;if(n===r)return cW(rW(e),rW(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function uW(e,t){const n=sW(e,0),r=sW(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=Eq(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function hW(e,t){if(nW(e)!==nW(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function dW(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(nW(e)>nW(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class pW{constructor(e,t){this.errorPrefix_=t,this.parts_=sW(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=rS(this.parts_[n]);fW(this)}}function fW(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+gW(e))}function gW(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class mW extends Jq{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new mW}getInitialEvent(e){return vw("visible"===e,"Unknown event type: "+e),[this.visible_]}}const yW=1e3;let vW,_W=(()=>{class e extends Kq{constructor(t,n,r,i,s,o,a,l){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=e.nextPersistentConnectionId_++,this.log_=fq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yW,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");mW.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Qq.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(zw(i)),vw(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Iw,n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const r=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,r,!1,null),t.resolve(r)):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const e=this.outstandingGets_[i];void 0===e||r!==e||(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),t.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),vw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),vw(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){const n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r};t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const o=s.d,a=s.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_("listen response",s),"ok"!==a&&this.removeListen_(r,i),t.onComplete&&t.onComplete(a,o))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Gw(e,"w")){const n=qw(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();yq(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Hw(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Hw(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),vw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{"ok"!==e.s&&this.log_("reportStats","Error sending stats: "+e.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+zw(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):gq("Unrecognized action received from server: "+zw(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){vw(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yW,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=yW,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=yW),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return hw(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+e.nextConnectionId_++,a=t.lastSessionId;let l=!1,c=null;const u=function(){c?c.close():(l=!0,s())};t.realtime_={close:u,sendRequest:function(e){vw(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}};const h=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[e,n]=yield Promise.all([t.authTokenProvider_.getToken(h),t.appCheckTokenProvider_.getToken(h)]);l?pq("getToken() completed but was canceled"):(pq("getToken() completed. Creating connection."),t.authToken_=e&&e.accessToken,t.appCheckToken_=n&&n.token,c=new Yq(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,i,s,e=>{yq(e+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(n){t.log_("Failed to get token: "+n),l||(t.repoInfo_.nodeAdmin&&yq(n),u())}}})()}interrupt(e){pq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ww(this.interruptReasons_)&&(this.reconnectDelay_=yW,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>bq(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Xq(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){pq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+tq.replace(/\./g,"-")]=1,Mw()?e["framework.cordova"]=1:xw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Qq.getInstance().currentlyOnline();return Ww(this.interruptReasons_)&&e}}return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e})();class CW{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new CW(e,t)}}class EW{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new CW(_q,e),r=new CW(_q,t);return 0!==this.compare(n,r)}minPost(){return CW.MIN}}class wW extends EW{static get __EMPTY_NODE(){return vW}static set __EMPTY_NODE(e){vW=e}compare(e,t){return Eq(e.name,t.name)}isDefinedOn(e){throw _w("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return CW.MIN}maxPost(){return new CW(Cq,vW)}makePost(e,t){return vw("string"==typeof e,"KeyIndex indexValue must always be a string."),new CW(e,vW)}toString(){return".key"}}const SW=new wW;class bW{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let PW,OW=(()=>{class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??TW.EMPTY_NODE,this.right=s??TW.EMPTY_NODE}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return TW.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return TW.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})();class TW{constructor(e,t=TW.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new TW(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,OW.BLACK,null,null))}remove(e){return new TW(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,OW.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bW(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bW(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bW(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bW(this.root_,null,this.comparator_,!0,e)}}function IW(e,t){return Eq(e.name,t.name)}function kW(e,t){return Eq(e,t)}TW.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new OW(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const AW=function(e){return"number"==typeof e?"number:"+Tq(e):"string:"+e},MW=function(e){if(e.isLeafNode()){const t=e.val();vw("string"==typeof t||"number"==typeof t||"object"==typeof t&&Gw(t,".sv"),"Priority must be a string or number.")}else vw(e===PW||e.isEmpty(),"priority of unexpected type.");vw(e===PW||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let NW,xW,RW,DW=(()=>{class e{constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,vw(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),MW(this.priorityNode_)}static set __childrenNodeConstructor(e){NW=e}static get __childrenNodeConstructor(){return NW}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return lW(t)?this:".priority"===tW(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const r=tW(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(vw(".priority"!==r||1===nW(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(rW(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+AW(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Tq(this.value_):this.value_,this.lazyHash_=cq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(vw(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return vw(i>=0,"Unknown leaf type: "+n),vw(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e})();const LW=new class extends EW{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Eq(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return CW.MIN}maxPost(){return new CW(Cq,new DW("[PRIORITY-POST]",RW))}makePost(e,t){const n=xW(e);return new CW(t,new DW("[PRIORITY-POST]",n))}toString(){return".priority"}},FW=Math.log(2);class UW{constructor(e){this.count=parseInt(Math.log(e+1)/FW,10),this.current_=this.count-1;const t=(e=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&t}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const BW=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new OW(a,o.node,OW.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),u=i(l+1,r);return o=e[l],a=n?n(o):o,new OW(a,o.node,OW.BLACK,c,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const c=i(s+1,a),u=e[s],h=n?n(u):u;l(new OW(h,u.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,OW.BLACK):(a(r,OW.BLACK),a(r,OW.RED))}return s}(new UW(e.length));return new TW(r||t,s)};let VW;const $W={};class zW{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return vw($W&&LW,"ChildrenNode.ts has not been loaded"),VW=VW||new zW({".priority":$W},{".priority":LW}),VW}get(e){const t=qw(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof TW?t:null}hasIndex(e){return Gw(this.indexSet_,e.toString())}addIndex(e,t){vw(e!==SW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(CW.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?BW(n,e.getCompare()):$W;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=s,new zW(c,l)}addToIndexes(e,t){const n=jw(this.indexes_,(n,r)=>{const i=qw(this.indexSet_,r);if(vw(i,"Missing index implementation for "+r),n===$W){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(CW.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),BW(n,i.getCompare())}return $W}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new CW(e.name,r))),i.insert(e,e.node)}});return new zW(n,this.indexSet_)}removeFromIndexes(e,t){const n=jw(this.indexes_,n=>{if(n===$W)return n;{const r=t.get(e.name);return r?n.remove(new CW(e.name,r)):n}});return new zW(n,this.indexSet_)}}let HW,GW=(()=>{class e{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&MW(this.priorityNode_),this.children_.isEmpty()&&vw(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return HW||(HW=new e(new TW(kW),null,zW.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||HW}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?HW:t}}getChild(e){const t=tW(e);return null===t?this:this.getImmediateChild(t).getChild(rW(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(vw(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const r=new CW(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?HW:this.priorityNode_;return new e(i,o,s)}}updateChild(e,t){const n=tW(e);if(null===n)return t;{vw(".priority"!==tW(e)||1===nW(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(rW(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(LW,(o,a)=>{n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){const e=[];for(const t in n)e[t]=n[t];return e}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+AW(this.getPriority().val())+":"),this.forEachChild(LW,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":cq(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new CW(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new CW(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new CW(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,CW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,CW.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===qW?-1:0}withIndex(t){if(t===SW||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===SW||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(LW),n=t.getIterator(LW);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===SW?null:this.indexMap_.get(e.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})();const qW=new class extends GW{constructor(){super(new TW(kW),GW.EMPTY_NODE,zW.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return GW.EMPTY_NODE}isEmpty(){return!1}};function WW(e,t=null){if(null===e)return GW.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),vw(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new DW(e,WW(t));if(e instanceof Array){let n=GW.EMPTY_NODE;return Oq(e,(t,r)=>{if(Gw(e,t)&&"."!==t.substring(0,1)){const e=WW(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(WW(t))}{const n=[];let r=!1;if(Oq(e,(e,t)=>{if("."!==e.substring(0,1)){const i=WW(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new CW(e,i)))}}),0===n.length)return GW.EMPTY_NODE;const i=BW(n,IW,e=>e.name,kW);if(r){const e=BW(n,LW.getCompare());return new GW(i,WW(t),new zW({".priority":e},{".priority":LW}))}return new GW(i,WW(t),zW.Default)}}Object.defineProperties(CW,{MIN:{value:new CW(_q,GW.EMPTY_NODE)},MAX:{value:new CW(Cq,qW)}}),wW.__EMPTY_NODE=GW.EMPTY_NODE,DW.__childrenNodeConstructor=GW,function(e){PW=e}(qW),function(e){RW=e}(qW),function(e){xW=e}(WW);class jW extends EW{constructor(e){super(),this.indexPath_=e,vw(!lW(e)&&".priority"!==tW(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Eq(e.name,t.name):i}makePost(e,t){const n=WW(e),r=GW.EMPTY_NODE.updateChild(this.indexPath_,n);return new CW(t,r)}maxPost(){const e=GW.EMPTY_NODE.updateChild(this.indexPath_,qW);return new CW(Cq,e)}toString(){return sW(this.indexPath_,0).join("/")}}const ZW=new class extends EW{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Eq(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return CW.MIN}maxPost(){return CW.MAX}makePost(e,t){const n=WW(e);return new CW(t,n)}toString(){return".value"}};function YW(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class KW{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=LW}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return vw(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return vw(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:_q}hasEnd(){return this.endSet_}getIndexEndValue(){return vw(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return vw(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Cq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return vw(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===LW}copy(){const e=new KW;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function JW(e){const t={};if(e.isDefault())return t;let n;return e.index_===LW?n="$priority":e.index_===ZW?n="$value":e.index_===SW?n="$key":(vw(e.index_ instanceof jW,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=zw(n),e.startSet_&&(t.startAt=zw(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+zw(e.indexStartName_))),e.endSet_&&(t.endAt=zw(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+zw(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function QW(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==LW&&(t.i=e.index_.toString()),t}class XW extends Kq{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=fq("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(vw(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=XW.getListenId_(e,n),o={};this.listens_[s]=o;const a=JW(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),qw(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=XW.getListenId_(e,t);delete this.listens_[n]}get(e){const t=JW(e._queryParams),n=e._path.toString(),r=new Iw;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Kw(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=$w(o.responseText)}catch{yq("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&yq("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class ej{constructor(){this.rootNode_=GW.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function tj(){return{value:null,children:new Map}}function nj(e,t,n){if(lW(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=tW(t);e.children.has(r)||e.children.set(r,tj()),nj(e.children.get(r),t=rW(t),n)}}function rj(e,t){if(lW(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(LW,(t,n)=>{nj(e,new Xq(t),n)}),rj(e,t)}}if(e.children.size>0){const n=tW(t);return t=rW(t),e.children.has(n)&&rj(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function ij(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{ij(r,new Xq(t.toString()+"/"+e),n)})}class sj{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Oq(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class oj{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sj(e);const n=1e4+2e4*Math.random();Mq(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Oq(e,(e,r)=>{r>0&&Gw(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),Mq(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var aj=(()=>(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(aj||(aj={})),aj))();function lj(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class cj{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=aj.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(lW(this.path)){if(null!=this.affectedTree.value)return vw(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Xq(e));return new cj(eW(),t,this.revert)}}return vw(tW(this.path)===e,"operationForChild called for unrelated child."),new cj(rW(this.path),this.affectedTree,this.revert)}}class uj{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=aj.OVERWRITE}operationForChild(e){return lW(this.path)?new uj(this.source,eW(),this.snap.getImmediateChild(e)):new uj(this.source,rW(this.path),this.snap)}}class hj{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=aj.MERGE}operationForChild(e){if(lW(this.path)){const t=this.children.subtree(new Xq(e));return t.isEmpty()?null:t.value?new uj(this.source,eW(),t.value):new hj(this.source,eW(),t)}return vw(tW(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new hj(this.source,rW(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class dj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(lW(e))return this.isFullyInitialized()&&!this.filtered_;const t=tW(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function pj(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw _w("Should only compare child_ events.");const r=new CW(t.childName,t.snapshotNode),i=new CW(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function fj(e,t){return{eventCache:e,serverCache:t}}function gj(e,t,n,r){return fj(new dj(t,n,r),e.serverCache)}function mj(e,t,n,r){return fj(e.eventCache,new dj(t,n,r))}function yj(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function vj(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let _j;class Cj{constructor(e,t=(()=>(_j||(_j=new TW(wq)),_j))()){this.value=e,this.children=t}static fromObject(e){let t=new Cj(null);return Oq(e,(e,n)=>{t=t.set(new Xq(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:eW(),value:this.value};if(lW(e))return null;{const n=tW(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(rW(e),t);return null!=i?{path:aW(new Xq(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(lW(e))return this;{const t=tW(e),n=this.children.get(t);return null!==n?n.subtree(rW(e)):new Cj(null)}}set(e,t){if(lW(e))return new Cj(t,this.children);{const n=tW(e),r=(this.children.get(n)||new Cj(null)).set(rW(e),t),i=this.children.insert(n,r);return new Cj(this.value,i)}}remove(e){if(lW(e))return this.children.isEmpty()?new Cj(null):new Cj(null,this.children);{const t=tW(e),n=this.children.get(t);if(n){const r=n.remove(rW(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Cj(null):new Cj(this.value,i)}return this}}get(e){if(lW(e))return this.value;{const t=tW(e),n=this.children.get(t);return n?n.get(rW(e)):null}}setTree(e,t){if(lW(e))return t;{const n=tW(e),r=(this.children.get(n)||new Cj(null)).setTree(rW(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Cj(this.value,i)}}fold(e){return this.fold_(eW(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(aW(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,eW(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(lW(e))return null;{const r=tW(e),i=this.children.get(r);return i?i.findOnPath_(rW(e),aW(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,eW(),t)}foreachOnPath_(e,t,n){if(lW(e))return this;{this.value&&n(t,this.value);const r=tW(e),i=this.children.get(r);return i?i.foreachOnPath_(rW(e),aW(t,r),n):new Cj(null)}}foreach(e){this.foreach_(eW(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(aW(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Ej{constructor(e){this.writeTree_=e}static empty(){return new Ej(new Cj(null))}}function wj(e,t,n){if(lW(t))return new Ej(new Cj(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=cW(i,t);return s=s.updateChild(o,n),new Ej(e.writeTree_.set(i,s))}{const r=new Cj(n),i=e.writeTree_.setTree(t,r);return new Ej(i)}}}function Sj(e,t,n){let r=e;return Oq(n,(e,n)=>{r=wj(r,aW(t,e),n)}),r}function bj(e,t){if(lW(t))return Ej.empty();{const n=e.writeTree_.setTree(t,new Cj(null));return new Ej(n)}}function Pj(e,t){return null!=Oj(e,t)}function Oj(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(cW(n.path,t)):null}function Tj(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(LW,(e,n)=>{t.push(new CW(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new CW(e,n.value))}),t}function Ij(e,t){if(lW(t))return e;{const n=Oj(e,t);return new Ej(null!=n?new Cj(n):e.writeTree_.subtree(t))}}function kj(e){return e.writeTree_.isEmpty()}function Aj(e,t){return Mj(eW(),e.writeTree_,t)}function Mj(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(vw(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Mj(aW(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(aW(e,".priority"),r)),n}}function Nj(e,t){return Hj(t,e)}function xj(e,t){if(e.snap)return dW(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&dW(aW(e.path,n),t))return!0;return!1}function Rj(e){return e.visible}function Dj(e,t,n){let r=Ej.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)dW(n,e)?(t=cW(n,e),r=wj(r,t,s.snap)):dW(e,n)&&(t=cW(e,n),r=wj(r,eW(),s.snap.getChild(t)));else{if(!s.children)throw _w("WriteRecord should have .snap or .children");if(dW(n,e))t=cW(n,e),r=Sj(r,t,s.children);else if(dW(e,n))if(t=cW(e,n),lW(t))r=Sj(r,eW(),s.children);else{const e=qw(s.children,tW(t));if(e){const n=e.getChild(rW(t));r=wj(r,eW(),n)}}}}}return r}function Lj(e,t,n,r,i){if(r||i){const s=Ij(e.visibleWrites,t);return!i&&kj(s)?n:i||null!=n||Pj(s,eW())?Aj(Dj(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(dW(e.path,t)||dW(t,e.path))},t),n||GW.EMPTY_NODE):null}{const r=Oj(e.visibleWrites,t);if(null!=r)return r;{const r=Ij(e.visibleWrites,t);return kj(r)?n:null!=n||Pj(r,eW())?Aj(r,n||GW.EMPTY_NODE):null}}}function Fj(e,t,n,r){return Lj(e.writeTree,e.treePath,t,n,r)}function Uj(e,t){return function(e,t,n){let r=GW.EMPTY_NODE;const i=Oj(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(LW,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=Ij(e.visibleWrites,t);return n.forEachChild(LW,(e,t)=>{const n=Aj(Ij(i,new Xq(e)),t);r=r.updateImmediateChild(e,n)}),Tj(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Tj(Ij(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Bj(e,t,n,r){return function(e,t,n,r,i){vw(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=aW(t,n);if(Pj(e.visibleWrites,s))return null;{const t=Ij(e.visibleWrites,s);return kj(t)?i.getChild(n):Aj(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Vj(e,t){return function(e,t){return Oj(e.visibleWrites,t)}(e.writeTree,aW(e.treePath,t))}function $j(e,t,n){return function(e,t,n,r){const i=aW(t,n),s=Oj(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?Aj(Ij(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function zj(e,t){return Hj(aW(e.treePath,t),e.writeTree)}function Hj(e,t){return{treePath:e,writeTree:t}}class Gj{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;vw("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),vw(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,YW(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw _w("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,YW(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const qj=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Wj{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new dj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return $j(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:vj(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const l=Ij(e.visibleWrites,t),c=Oj(l,eW());if(null!=c)a=c;else{if(null==n)return[];a=Aj(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function jj(e,t,n,r,i,s){const o=t.eventCache;if(null!=Vj(r,n))return t;{let a,l;if(lW(n))if(vw(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=vj(t),i=Uj(r,n instanceof GW?n:GW.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Fj(r,vj(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=tW(n);if(".priority"===c){vw(1===nW(n),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=Bj(r,n,i,l);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=rW(n);let h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Bj(r,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else h=$j(r,c,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),c,h,u,i,s):o.getNode()}}return gj(t,a,o.isFullyInitialized()||lW(n),e.filter.filtersNodes())}}function Zj(e,t,n,r,i,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(lW(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),e,null)}else{const e=tW(n);if(!l.isCompleteForPath(n)&&nW(n)>1)return t;const i=rW(n),s=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,i,qj,null)}const h=mj(t,c,l.isFullyInitialized()||lW(n),u.filtersNodes());return jj(e,h,n,i,new Wj(i,h,s),a)}function Yj(e,t,n,r,i,s,o){const a=t.eventCache;let l,c;const u=new Wj(i,t,s);if(lW(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=gj(t,c,!0,e.filter.filtersNodes());else{const i=tW(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=gj(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=rW(n),c=a.getNode().getImmediateChild(i);let h;if(lW(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===iW(s)&&e.getChild(oW(s)).isEmpty()?e:e.updateChild(s,r):GW.EMPTY_NODE}l=c.equals(h)?t:gj(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return l}function Kj(e,t){return e.eventCache.isCompleteForChild(t)}function Jj(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function Qj(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=lW(n)?r:new Cj(null).setTree(n,r);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const l=Jj(0,t.serverCache.getNode().getImmediateChild(n),r);c=Zj(e,c,new Xq(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!l){const l=Jj(0,t.serverCache.getNode().getImmediateChild(n),r);c=Zj(e,c,new Xq(n),l,i,s,o,a)}}),c}function Xj(e,t){const n=vj(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!lW(t)&&!n.getImmediateChild(tW(t)).isEmpty())?n.getChild(t):null}function eZ(e,t,n,r){t.type===aj.MERGE&&null!==t.source.queryId&&(vw(vj(e.viewCache_),"We should always have a full cache before handling merges"),vw(yj(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new Gj;let o,a;if(n.type===aj.OVERWRITE){const l=n;l.source.fromUser?o=Yj(e,t,l.path,l.snap,r,i,s):(vw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!lW(l.path),o=Zj(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===aj.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,l)=>{const c=aW(n,r);Kj(t,tW(c))&&(a=Yj(e,a,c,l,i,s,o))}),r.foreach((r,l)=>{const c=aW(n,r);Kj(t,tW(c))||(a=Yj(e,a,c,l,i,s,o))}),a}(e,t,l.path,l.children,r,i,s):(vw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=Qj(e,t,l.path,l.children,r,i,a,s))}else if(n.type===aj.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=Vj(r,n))return t;{const a=new Wj(r,t,i),l=t.eventCache.getNode();let c;if(lW(n)||".priority"===tW(n)){let n;if(t.serverCache.isFullyInitialized())n=Fj(r,vj(t));else{const e=t.serverCache.getNode();vw(e instanceof GW,"serverChildren would be complete if leaf node"),n=Uj(r,e)}n=n,c=e.filter.updateFullNode(l,n,s)}else{const i=tW(n);let u=$j(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?e.filter.updateChild(l,i,u,rW(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,GW.EMPTY_NODE,rW(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Fj(r,vj(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=Vj(r,eW()),gj(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=Vj(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(lW(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Zj(e,t,n,l.getNode().getChild(n),i,s,a,o);if(lW(n)){let r=new Cj(null);return l.getNode().forEachChild(SW,(e,t)=>{r=r.set(new Xq(e),t)}),Qj(e,t,n,r,i,s,a,o)}return t}{let c=new Cj(null);return r.foreach((e,t)=>{const r=aW(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))}),Qj(e,t,n,c,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==aj.LISTEN_COMPLETE)throw _w("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache;return jj(e,mj(t,s.getNode(),s.isFullyInitialized()||lW(n),s.isFiltered()),n,r,qj,i)}(e,t,n.path,r,s)}const l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=yj(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(yj(t)))}}(t,o,l),{viewCache:o,changes:l}}(e.processor_,i,t,n,r);return function(e,t){vw(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),vw(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,s.viewCache),vw(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,function(e,t,n,r){return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),pj(e,i,"child_removed",t,r,n),pj(e,i,"child_added",t,r,n),pj(e,i,"child_moved",s,r,n),pj(e,i,"child_changed",t,r,n),pj(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r?[r]:e.eventRegistrations_)}(e,s.changes,s.viewCache.eventCache.getNode(),null)}let tZ,nZ;function rZ(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return vw(null!=s,"SyncTree gave us an op for an invalid query."),eZ(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(eZ(s,t,n,r));return i}}function iZ(e,t){let n=null;for(const r of e.views.values())n=n||Xj(r,t);return n}class sZ{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Cj(null),this.pendingWriteTree_={visibleWrites:Ej.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function oZ(e,t,n,r,i){return function(e,t,n,r,i){vw(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=wj(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?uZ(e,new uj({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function aZ(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);vw(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&xj(t,r.path)?i=!1:dW(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(function(e){e.visibleWrites=Dj(e.allWrites,Rj,eW()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=bj(e.visibleWrites,r.path):Oq(r.children,t=>{e.visibleWrites=bj(e.visibleWrites,aW(r.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new Cj(null);return null!=r.snap?t=t.set(eW(),!0):Oq(r.children,e=>{t=t.set(new Xq(e),!0)}),uZ(e,new cj(r.path,t,n))}return[]}function lZ(e,t,n){return uZ(e,new uj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function cZ(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=iZ(n,cW(e,t));if(r)return r});return Lj(r,t,i,n,!0)}function uZ(e,t){return hZ(t,e.syncPointTree_,null,Nj(e.pendingWriteTree_,eW()))}function hZ(e,t,n,r){if(lW(e.path))return dZ(e,t,n,r);{const i=t.get(eW());null==n&&null!=i&&(n=iZ(i,eW()));let s=[];const o=tW(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=zj(r,o);s=s.concat(hZ(a,l,e,t))}return i&&(s=s.concat(rZ(i,e,r,n))),s}}function dZ(e,t,n,r){const i=t.get(eW());null==n&&null!=i&&(n=iZ(i,eW()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=zj(r,t),l=e.operationForChild(t);l&&(s=s.concat(dZ(l,i,o,a)))}),i&&(s=s.concat(rZ(i,e,r,n))),s}function pZ(e,t){return e.tagToQueryMap.get(t)}function fZ(e){const t=e.indexOf("$");return vw(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Xq(e.substr(0,t))}}function gZ(e,t,n){const r=e.syncPointTree_.get(t);return vw(r,"Missing sync point for query tag that we're tracking"),rZ(r,n,Nj(e.pendingWriteTree_,t),null)}class mZ{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new mZ(t)}node(){return this.node_}}class yZ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=aW(this.path_,e);return new yZ(this.syncTree_,t)}node(){return cZ(this.syncTree_,this.path_)}}const vZ=function(e,t,n){return e&&"object"==typeof e?(vw(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?_Z(e[".sv"],t,n):"object"==typeof e[".sv"]?CZ(e[".sv"],t):void vw(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},_Z=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:vw(!1,"Unexpected server value: "+e)}},CZ=function(e,t,n){e.hasOwnProperty("increment")||vw(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&vw(!1,"Unexpected increment value: "+r);const i=t.node();if(vw(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},EZ=function(e,t,n){return wZ(e,new mZ(t),n)};function wZ(e,t,n){const r=e.getPriority().val(),i=vZ(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=vZ(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new DW(s,WW(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new DW(i))),r.forEachChild(LW,(e,r)=>{const i=wZ(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class SZ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function bZ(e,t){let n=t instanceof Xq?t:new Xq(t),r=e,i=tW(n);for(;null!==i;){const e=qw(r.node.children,i)||{children:{},childCount:0};r=new SZ(i,r,e),n=rW(n),i=tW(n)}return r}function PZ(e){return e.node.value}function OZ(e,t){e.node.value=t,MZ(e)}function TZ(e){return e.node.childCount>0}function IZ(e,t){Oq(e.node.children,(n,r)=>{t(new SZ(n,e,r))})}function kZ(e,t,n,r){n&&!r&&t(e),IZ(e,e=>{kZ(e,t,!0,r)}),n&&r&&t(e)}function AZ(e){return new Xq(null===e.parent?e.name:AZ(e.parent)+"/"+e.name)}function MZ(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===PZ(e)&&!TZ(e)}(n),i=Gw(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,MZ(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,MZ(e))}(e.parent,e.name,e)}const NZ=/[\[\].#$\/\u0000-\u001F\u007F]/,xZ=/[\[\].#$\u0000-\u001F\u007F]/,RZ=10485760,DZ=function(e){return"string"==typeof e&&0!==e.length&&!NZ.test(e)},LZ=function(e){return"string"==typeof e&&0!==e.length&&!xZ.test(e)},FZ=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!vq(e)||e&&"object"==typeof e&&Gw(e,".sv")},UZ=function(e,t,n,r){r&&void 0===t||BZ(nS(e,"value"),t,n)},BZ=function(e,t,n){const r=n instanceof Xq?new pW(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+gW(r));if("function"==typeof t)throw new Error(e+"contains a function "+gW(r)+" with contents = "+t.toString());if(vq(t))throw new Error(e+"contains "+t.toString()+" "+gW(r));if("string"==typeof t&&t.length>RZ/3&&rS(t)>RZ)throw new Error(e+"contains a string greater than "+RZ+" utf8 bytes "+gW(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(Oq(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!DZ(t)))throw new Error(e+" contains an invalid key ("+t+") "+gW(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=rS(t),fW(e)})(r,t),BZ(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=rS(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+gW(r)+" in addition to actual children.")}},VZ=function(e,t,n,r){if(!(r&&void 0===n||LZ(n)))throw new Error(nS(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},$Z=function(e,t){if(".info"===tW(t))throw new Error(e+" failed = Can't modify data under /.info/")};class zZ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function HZ(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null!==n&&!hW(s,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function GZ(e,t,n){HZ(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(qZ(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>dW(e,t)||dW(t,e))}function qZ(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();hq&&pq("event: "+n.toString()),Aq(r)}}}class WZ{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new zZ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tj(),this.transactionQueueTree_=new SZ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function jZ(e){const t=e.infoData_.getNode(new Xq(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ZZ(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:jZ(e)})}function YZ(e,t,n,r,i){e.dataUpdateCount++;const s=new Xq(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=jw(n,e=>WW(e));o=function(e,t,n,r){const i=pZ(e,r);if(i){const r=fZ(i),s=r.path,o=r.queryId,a=cW(s,t),l=Cj.fromObject(n);return gZ(e,s,new hj(lj(o),a,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=WW(n);o=function(e,t,n,r){const i=pZ(e,r);if(null!=i){const r=fZ(i),s=r.path,o=r.queryId,a=cW(s,t);return gZ(e,s,new uj(lj(o),a,n))}return[]}(e.serverSyncTree_,s,t,i)}else if(r){const t=jw(n,e=>WW(e));o=function(e,t,n){const r=Cj.fromObject(n);return uZ(e,new hj({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=WW(n);o=lZ(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=sY(e,s)),GZ(e.eventQueue_,a,o)}function KZ(e,t){JZ(e,"connected",t),!1===t&&function(e){tY(e,"onDisconnectEvents");const t=ZZ(e),n=tj();ij(e.onDisconnect_,eW(),(r,i)=>{const s=function(e,t,n,r){return wZ(t,new yZ(n,e),r)}(r,i,e.serverSyncTree_,t);nj(n,r,s)});let r=[];ij(n,eW(),(t,n)=>{r=r.concat(lZ(e.serverSyncTree_,t,n));const i=uY(e,t);sY(e,i)}),e.onDisconnect_=tj(),GZ(e.eventQueue_,eW(),r)}(e)}function JZ(e,t,n){const r=new Xq("/.info/"+t),i=WW(n);e.infoData_.updateSnapshot(r,i);const s=lZ(e.infoSyncTree_,r,i);GZ(e.eventQueue_,r,s)}function QZ(e){return e.nextWriteId_++}function XZ(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&rj(e.onDisconnect_,t),nY(0,n,r,i)})}function eY(e,t,n,r){const i=WW(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&nj(e.onDisconnect_,t,i),nY(0,r,n,s)})}function tY(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),pq(n,...t)}function nY(e,t,n,r){t&&Aq(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function rY(e,t,n){return cZ(e.serverSyncTree_,t,n)||GW.EMPTY_NODE}function iY(e,t=e.transactionQueueTree_){if(t||cY(e,t),PZ(t)){const n=aY(e,t);vw(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=rY(e,t,r);let s=i;const o=i.hash();for(let c=0;c<n.length;c++){const e=n[c];vw(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=cW(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,r=>{tY(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(aZ(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();cY(e,bZ(e.transactionQueueTree_,t)),iY(e,e.transactionQueueTree_),GZ(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Aq(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)n[e].status=3===n[e].status?4:0;else{yq("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}sY(e,t)}},o)}(e,AZ(t),n)}else TZ(t)&&IZ(t,t=>{iY(e,t)})}function sY(e,t){const n=oY(e,t),r=AZ(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],l=cW(n,a.path);let c,u=!1;if(vw(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,c=a.abortReason,i=i.concat(aZ(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,c="maxretry",i=i.concat(aZ(e.serverSyncTree_,a.currentWriteId,!0));else{const n=rY(e,a.path,s);a.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){BZ("transaction failed: Data returned ",r,a.path);let t=WW(r);"object"==typeof r&&null!=r&&Gw(r,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,l=ZZ(e),c=EZ(t,n,l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=c,a.currentWriteId=QZ(e),s.splice(s.indexOf(o),1),i=i.concat(oZ(e.serverSyncTree_,a.path,c,a.currentWriteId,a.applyLocally)),i=i.concat(aZ(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",i=i.concat(aZ(e.serverSyncTree_,a.currentWriteId,!0))}GZ(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===c?()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot):()=>t[o].onComplete(new Error(c),!1,null)))}cY(e,e.transactionQueueTree_);for(let o=0;o<r.length;o++)Aq(r[o]);iY(e,e.transactionQueueTree_)}(e,aY(e,n),r),r}function oY(e,t){let n,r=e.transactionQueueTree_;for(n=tW(t);null!==n&&void 0===PZ(r);)r=bZ(r,n),n=tW(t=rW(t));return r}function aY(e,t){const n=[];return lY(e,t,n),n.sort((e,t)=>e.order-t.order),n}function lY(e,t,n){const r=PZ(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);IZ(t,t=>{lY(e,t,n)})}function cY(e,t){const n=PZ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,OZ(t,n.length>0?n:void 0)}IZ(t,t=>{cY(e,t)})}function uY(e,t){const n=AZ(oY(e,t)),r=bZ(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{hY(e,t)}),hY(e,r),kZ(r,t=>{hY(e,t)}),n}function hY(e,t){const n=PZ(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(vw(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(vw(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(aZ(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?OZ(t,void 0):n.length=s+1,GZ(e.eventQueue_,AZ(t),i);for(let e=0;e<r.length;e++)Aq(r[e])}}const dY=function(e,t){const n=pY(e),r=n.namespace;return"firebase.com"===n.domain&&mq(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&mq("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&yq("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Fq(n.host,n.secure,r,t,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new Xq(n.pathString)}},pY=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch{}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):yq(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class fY{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Iw;return XZ(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){$Z("OnDisconnect.remove",this._path);const e=new Iw;return eY(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){$Z("OnDisconnect.set",this._path),UZ("OnDisconnect.set",e,this._path,!1);const t=new Iw;return eY(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){$Z("OnDisconnect.setWithPriority",this._path),UZ("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(vq(t))throw new Error(nS(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!FZ(t))throw new Error(nS(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new Iw;return function(e,t,n,r,i){const s=WW(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&nj(e.onDisconnect_,t,s),nY(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){$Z("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=nS(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Oq(t,(e,t)=>{const r=new Xq(e);if(BZ(i,t,aW(n,r)),".priority"===iW(r)&&!FZ(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=sW(r);for(let t=0;t<i.length;t++)if((".priority"!==i[t]||t!==i.length-1)&&!DZ(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(uW);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&dW(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new Iw;return function(e,t,n,r){if(Ww(n))return pq("onDisconnect().update() called with empty data.  Don't do anything."),void nY(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&Oq(n,(n,r)=>{const i=WW(r);nj(e.onDisconnect_,aW(t,n),i)}),nY(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class gY{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return lW(this._path)?null:iW(this._path)}get ref(){return new mY(this._repo,this._path)}get _queryIdentifier(){const e=QW(this._queryParams),t=bq(e);return"{}"===t?"default":t}get _queryObject(){return QW(this._queryParams)}isEqual(e){if(!((e=sS(e))instanceof gY))return!1;const t=this._repo===e._repo,n=hW(this._path,e._path);return t&&n&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class mY extends gY{constructor(e,t){super(e,t,new KW,!1)}get parent(){const e=oW(this._path);return null===e?null:new mY(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function yY(e,t){return(e=sS(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===tW((e=sS(e))._path)?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),VZ(e,t,n,r)}("child","path",t,!1):VZ("child","path",t,!1),new mY(e._repo,aW(e._path,t))}(e._root,t):e._root}function vY(e){return e=sS(e),new fY(e._repo,e._path)}function _Y(e,t){e=sS(e),$Z("set",e._path),UZ("set",t,e._path,!1);const n=new Iw;return function(e,t,n,r,i){tY(e,"set",{path:t.toString(),value:n,priority:r});const s=ZZ(e),o=WW(n,r),a=cZ(e.serverSyncTree_,t),l=EZ(o,a,s),c=QZ(e),u=oZ(e.serverSyncTree_,t,l,c,!0);HZ(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||yq("set at "+t+" failed: "+n);const o=aZ(e.serverSyncTree_,c,!s);GZ(e.eventQueue_,t,o),nY(0,i,n,r)});const h=uY(e,t);sY(e,h),GZ(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}(function(e){vw(!tZ,"__referenceConstructor has already been defined"),tZ=e})(mY),function(e){vw(!nZ,"__referenceConstructor has already been defined"),nZ=e}(mY);const CY={};function EY(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||mq("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pq("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=dY(s,i),c=l.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${c.namespace}`,l=dY(s,i),c=l.repoInfo):o=!l.repoInfo.secure;const u=i&&o?new Rq(Rq.OWNER):new xq(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!DZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),LZ(e)}(n))throw new Error(nS(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",l),lW(l.path)||mq("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=CY[t.name];i||(i={},CY[t.name]=i);let s=i[e.toURLString()];return s&&mq("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new WZ(e,false,n,r),i[e.toURLString()]=s,s}(c,e,u,new Nq(e.name,n));return new wY(h,e)}class wY{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=zq(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new XW(e.repoInfo_,(t,n,r,i)=>{YZ(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>KZ(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{zw(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new _W(e.repoInfo_,t,(t,n,r,i)=>{YZ(e,t,n,r,i)},t=>{KZ(e,t)},t=>{!function(e,t){Oq(t,(t,n)=>{JZ(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return $q[n]||($q[n]=t()),$q[n]}(e.repoInfo_,()=>new oj(e.stats_,e.server_)),e.infoData_=new ej,e.infoSyncTree_=new sZ({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=lZ(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),JZ(e,"connected",!1),e.serverSyncTree_=new sZ({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);GZ(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new mY(this._repo,eW())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=CY[t];(!n||n[e.key]!==e)&&mq(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&mq("Cannot call "+e+" on a deleted database.")}}function SY(e=MS(),t){return OS(e,"database").getImmediate({identifier:t})}function bY(e,t,n,r={}){(e=sS(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&mq("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&mq('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Rq(Rq.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:kw(r.mockUserToken,e.app.options.projectId);s=new Rq(t)}!function(e,t,n,r){e.repoInfo_=new Fq(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}const PY={".sv":"timestamp"};function OY(){return PY}_W.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},_W.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},tq="9.6.6",PS(new oS("database",(e,{instanceIdentifier:t})=>EY(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),xS(eq,"0.12.5",void 0),xS(eq,"0.12.5","esm2017");class TY{constructor(e){return e}}const IY=new or("angularfire2.database-instances");function kY(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new TY(r)}}const AY={provide:class{constructor(){return dT("database")}},deps:[[new Nr,IY]]},MY={provide:TY,useFactory:function(e,t){const n=hT("database",e,t);return n&&new TY(n)},deps:[[new Nr,IY],ST]};let NY=(()=>{class e{constructor(){xS("angularfire",aT.full,"rtdb")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({providers:[MY,AY]}),e})();const xY=wT(bY,!0),RY=wT(SY,!0),DY=wT(vY,!0),LY=wT(yY,!0),FY=wT(_Y,!0);class UY{constructor(e){this.db=e}setOffline(e){return FY(LY(this.db,"/status/"+e),UY.OFFLINE)}launchAutomaticPresenceUpdate(e){var t=this;return hw(function*(){const n=LY(t.db,"/status/"+e);yield FY(n,UY.ONLINE),yield DY(n).set(UY.OFFLINE)})()}}UY.OFFLINE={last_changed:OY()},UY.ONLINE={last_changed:OY()},UY.\u0275fac=function(e){return new(e||UY)(Or(TY))},UY.\u0275prov=Se({token:UY,factory:UY.\u0275fac,providedIn:"root"});class BY{static createUserWithEmailAndPassword(e,t,n){return BM(e,t,n)}static sendEmailVerification(e){return zM(e)}static sendPasswordResetEmail(e,t){return HM(e,t)}static signInWithEmailAndPassword(e,t,n){return hw(function*(){return(yield GM(e,t,n)).user})()}static signInWithPopup(e,t){return hw(function*(){return(yield qM(e,t)).user})()}static updateProfile(e,t){return WM(e,t)}}class VY{constructor(e,t,n,r){this.id=e,this.email=t,this.username=n,this.verified=r}isConnected(){return this.email.isPresent()}toMinimalUser(){return{id:this.id,name:this.username.get()}}}VY.NOT_CONNECTED=new VY("",yw.empty(),yw.empty(),!1);let $Y=(()=>{class e{constructor(t,n,r){var i=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=yw.empty(),this.userUnsubscribe=yw.empty(),pw(e.VERBOSE,"ConnectedUserService constructor"),this.userRS=new XG(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=$M(this.auth,function(){var t=hw(function*(t){null==t?(pw(e.VERBOSE,"User is not connected"),i.userUnsubscribe.isPresent()&&i.userUnsubscribe.get()(),i.userRS.next(VY.NOT_CONNECTED),i.user=yw.empty()):(zG(i.user.isAbsent(),"ConnectedUserService received a double update for an user, this is unexpected"),yield i.connectivityDAO.launchAutomaticPresenceUpdate(t.uid),i.userUnsubscribe=yw.of(i.userDAO.subscribeToChanges(t.uid,n=>{if(n.isPresent()){const r=n.get().username;pw(e.VERBOSE,`User ${r} is connected, and the verified status is ${i.emailVerified(t)}`);const s=!0===i.emailVerified(t)&&null!=r;if(!0===s&&!1===n.get().verified)return i.userDAO.markVerified(t.uid);const o=new VY(t.uid,yw.ofNullable(t.email),yw.ofNullable(r),s);i.user=yw.of(o),i.userRS.next(o)}})))});return function(e){return t.apply(this,arguments)}}())}emailVerified(e){return e.emailVerified}sendPasswordResetEmail(e){var t=this;return hw(function*(){try{return yield BY.sendPasswordResetEmail(t.auth,e),FG.SUCCESS}catch(n){return FG.failure(t.mapFirebaseError(n))}})()}doRegister(t,n,r){var i=this;return hw(function*(){return pw(e.VERBOSE,"ConnectedUserService.doRegister("+n+")"),(yield i.userDAO.usernameIsAvailable(t))?i.registerAfterUsernameCheck(t,n,r):RG.failure($localize`This username is already in use.`)})()}registerAfterUsernameCheck(e,t,n){var r=this;return hw(function*(){try{const i=yield BY.createUserWithEmailAndPassword(r.auth,t,n),s=dw.getNonNullable(i.user);return yield r.createUser(s.uid,e),RG.success(s)}catch(i){return RG.failure(r.mapFirebaseError(i))}})()}mapFirebaseError(e){switch(e.code){case"auth/email-already-in-use":return $localize`This email address is already in use.`;case"auth/invalid-email":return $localize`This email address is invalid.`;case"auth/user-not-found":case"auth/wrong-password":return $localize`You have entered invalid credentials.`;case"auth/invalid-credential":return $localize`The credential is invalid or has expired, please try again.`;case"auth/weak-password":return $localize`Your password is too weak, please use a stronger password.`;case"auth/too-many-requests":return $localize`There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later.`;case"auth/popup-closed-by-user":return $localize`You closed the authentication popup without finalizing your log in.`;case"auth/popup-blocked":return $localize`The authentication popup was blocked. Try again after disabling popup blocking.`;default:return $G.logError("ConnectedUserService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}sendEmailVerification(){var t=this;return hw(function*(){pw(e.VERBOSE,"ConnectedUserService.sendEmailVerification()");const n=yw.ofNullable(t.auth.currentUser);if(!n.isPresent())return $G.logError("ConnectedUserService","Unlogged users cannot request for email verification");if(t.emailVerified(n.get()))return $G.logError("ConnectedUserService","Verified users should not ask email verification after being verified");try{return yield BY.sendEmailVerification(n.get()),FG.SUCCESS}catch(r){return FG.failure(t.mapFirebaseError(r))}})()}doEmailLogin(t,n){var r=this;return hw(function*(){pw(e.VERBOSE,"ConnectedUserService.doEmailLogin("+t+")");try{return yield BY.signInWithEmailAndPassword(r.auth,t,n),FG.SUCCESS}catch(i){return FG.failure(r.mapFirebaseError(i))}})()}createUser(e,t){var n=this;return hw(function*(){null==t?yield n.userDAO.set(e,{verified:!1}):yield n.userDAO.set(e,{username:t,verified:!1})})()}doGoogleLogin(){var e=this;return hw(function*(){return FG.ofFallible(yield e.registerOrLoginWithGoogle())})()}registerOrLoginWithGoogle(){var e=this;return hw(function*(){try{const t=new jk;t.addScope("profile"),t.addScope("email");const n=yield BY.signInWithPopup(e.auth,t);return!1===(yield e.userDAO.exists(n.uid))&&(yield e.createUser(n.uid)),RG.success(n)}catch(t){return RG.failure(e.mapFirebaseError(t))}})()}disconnect(){var e=this;return hw(function*(){const t=yw.ofNullable(e.auth.currentUser);if(t.isPresent()){const n=t.get().uid;return yield e.connectivityDAO.setOffline(n),yield e.auth.signOut(),FG.SUCCESS}return FG.failure("Cannot disconnect a non-connected user")})()}getUserObs(){return this.userObs}setUsername(e){var t=this;return hw(function*(){if(""===e)return FG.failure($localize`Your username may not be empty.`);try{if(!1===(yield t.userDAO.usernameIsAvailable(e)))return FG.failure($localize`This username is already in use, please select a different one.`);const n=dw.getNonNullable(t.auth.currentUser);return yield BY.updateProfile(n,{displayName:e}),yield t.userDAO.setUsername(n.uid,e),yield t.userDAO.markVerified(n.uid),yield t.reloadUser(),FG.SUCCESS}catch(n){return FG.failure(t.mapFirebaseError(n))}})()}setPicture(e){var t=this;return hw(function*(){try{const n=dw.getNonNullable(t.auth.currentUser);return yield BY.updateProfile(n,{photoURL:e}),FG.SUCCESS}catch(n){return FG.failure(t.mapFirebaseError(n))}})()}reloadUser(){var e=this;return hw(function*(){const t=dw.getNonNullable(e.auth.currentUser);yield t.getIdToken(!0),yield t.reload()})()}updateObservedPart(e){return zG(this.user.isPresent(),"Should not call updateObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:e})}removeObservedPart(){return zG(this.user.isPresent(),"Should not call removeObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:null})}sendPresenceToken(){return zG(this.user.isPresent(),"Should not call sendPresenceToken when not connected"),this.userDAO.updatePresenceToken(this.user.get().id)}ngOnDestroy(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(KG),Or(MM),Or(UY))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class zY{constructor(e){this.value=e}static of(e){switch(e){case"CREATOR":return zY.CREATOR;case"RANDOM":return zY.RANDOM;default:return zG("CHOSEN_PLAYER"===e,"Invalid value for FirstPlayer: "+e+"."),zY.CHOSEN_PLAYER}}}zY.CREATOR=new zY("CREATOR"),zY.RANDOM=new zY("RANDOM"),zY.CHOSEN_PLAYER=new zY("CHOSEN_PLAYER");class HY{constructor(e){this.value=e}static of(e){switch(e){case"STANDARD":return HY.STANDARD;case"BLITZ":return HY.BLITZ;case"CUSTOM":return HY.CUSTOM;default:throw new Error("Invalid part type: "+e+".")}}}HY.STANDARD=new HY("STANDARD"),HY.BLITZ=new HY("BLITZ"),HY.CUSTOM=new HY("CUSTOM"),HY.NORMAL_MOVE_DURATION=120,HY.NORMAL_PART_DURATION=1800,HY.BLITZ_MOVE_DURATION=30,HY.BLITZ_PART_DURATION=900;class GY{constructor(e){this.value=e}}GY.PART_CREATED=new GY(0),GY.CONFIG_PROPOSED=new GY(2),GY.PART_STARTED=new GY(3),GY.PART_FINISHED=new GY(4);class qY{}class WY extends qY{static disjunction3(e,t,n,r,i){return new class extends WY{encodeMove(s){return r(s)?{type:"T1",encoded:e.encode(s)}:i(s)?{type:"T2",encoded:t.encode(s)}:{type:"T3",encoded:n.encode(s)}}decodeMove(r){const i=dw.getNonNullable(r).type,s=dw.getNonNullable(r).encoded;return"T1"===i?e.decode(s):"T2"===i?t.decode(s):n.decode(s)}}}encode(e){return this.encodeMove(e)}decode(e){return zG(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}class jY extends WY{static ofN(e,t,n){return new class extends jY{maxValue(){return e}encodeNumber(e){return t(e)}decodeNumber(e){return n(e)}}}static tuple(e,t,n){return new class extends jY{maxValue(){let t=0;return Object.keys(e).forEach(n=>{t=t*e[n].shift()+e[n].maxValue()}),t}encodeNumber(n){const r=t(n);let i=0;return Object.keys(r).forEach(t=>{i=i*e[t].shift()+e[t].encode(r[t])}),i}decodeNumber(t){const r={};let i=t;return Object.keys(e).reverse().forEach(t=>{const n=i%e[t].shift();i=(i-n)/e[t].shift(),r[t]=e[t].decode(n)}),n(r)}}}static disjunction(e,t,n){return new class extends jY{maxValue(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}encodeNumber(r){return n(r)?2*e.encodeNumber(r):2*t.encodeNumber(r)+1}decodeNumber(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}}static numberEncoder(e){return new class extends jY{maxValue(){return e}encodeNumber(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}decodeNumber(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}}shift(){return this.maxValue()+1}encodeMove(e){return this.encodeNumber(e)}decodeMove(e){return zG("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}jY.booleanEncoder=new class extends jY{maxValue(){return 1}encodeNumber(e){return e?1:0}decodeNumber(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}};class ZY{constructor(){this.value=2}isPlayer(){return!1}toString(){return"PlayerNone"}equals(e){return this===e}}ZY.NONE=new ZY;class YY{constructor(e){this.value=e}static of(e){switch(e){case 0:return YY.ZERO;default:return dw.expectToBe(e,1),YY.ONE}}static fromTurn(e){return e%2==0?YY.ZERO:YY.ONE}isPlayer(){return!0}toString(){return"Player "+this.value}equals(e){return this===e}getScoreModifier(){return 0===this.value?-1:1}getPreVictory(){return this.getVictoryValue()-this.getScoreModifier()}getDefeatValue(){return this===YY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}getVictoryValue(){return this===YY.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}getOpponent(){switch(this){case YY.ZERO:return YY.ONE;default:return dw.expectToBe(this,YY.ONE),YY.ZERO}}}var KY;YY.numberEncoder=jY.ofN(2,e=>e.value,e=>2===e?KY.NONE:YY.of(e)),YY.ZERO=new YY(0),YY.ONE=new YY(1),YY.PLAYERS=[YY.ZERO,YY.ONE],function(e){e.ZERO=YY.ZERO,e.ONE=YY.ONE,e.NONE=ZY.NONE}(KY||(KY={}));class JY{static rematchAccepted(e,t){return QY("RematchAccepted",{typeGame:e,partId:t})}static getPlayer(e){return YY.of(dw.getNonNullable(e.data).player)}static getTypeGame(e){return dw.getNonNullable(e.data).typeGame}static getPartId(e){return dw.getNonNullable(e.data).partId}}function QY(e,t){return{code:e,data:t}}function XY(e){return t=>QY(e,{player:t.value})}JY.drawProposed=XY("DrawProposed"),JY.drawAccepted=QY("DrawAccepted",{}),JY.drawRefused=XY("DrawRefused"),JY.takeBackAsked=XY("TakeBackAsked"),JY.takeBackRefused=XY("TakeBackRefused"),JY.takeBackAccepted=XY("TakeBackAccepted"),JY.rematchProposed=XY("RematchProposed"),JY.addTurnTime=XY("AddTurnTime"),JY.addGlobalTime=XY("AddGlobalTime");class eK{static mapBiArray(e,t){const n=[];let r=0;for(;r<e.length;){n[r]=[];let i=0;for(;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}static createTable(e,t,n){const r=[];let i=t-1;for(;i>=0;){r[i]=[];let t=e-1;for(;t>=0;)r[i][t]=n,t--;i--}return r}static copyBiArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=eK.copyImmutableArray(e[n]),n++;return t}static copyImmutableArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=e[n],n++;return t}static sortByDescending(e,t){e.sort((e,n)=>{const r=t(e),i=t(n);return r<i?1:r>i?-1:0})}static compareArray(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===mw(e[n],t[n]))return!1;return!0}static compareTable(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===eK.compareArray(e[n],t[n]))return!1;return!0}}let tK=(()=>{class e extends xG{constructor(t){super("joiners",t),pw(e.VERBOSE,"JoinerDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(dG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),nK=(()=>{class e{constructor(t){this.joinerDAO=t,this.joinerUnsubscribe=yw.empty(),pw(e.VERBOSE,"JoinerService.constructor")}subscribeToChanges(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=yw.of(this.joinerDAO.subscribeToChanges(e,t))}unsubscribe(){zG(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=yw.empty()}createInitialJoiner(t,n){var r=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.createInitialJoiner("+t.id+", "+n+")"),r.set(n,{candidates:[],chosenOpponent:null,firstPlayer:zY.RANDOM.value,partType:HY.STANDARD.value,partStatus:GY.PART_CREATED.value,maximalMoveDuration:HY.NORMAL_MOVE_DURATION,totalPartDuration:HY.NORMAL_PART_DURATION,creator:t})})()}joinGame(t,n){var r=this;return hw(function*(){pw(e.VERBOSE,"JoinerService.joinGame("+t+", "+n.id+")");const i=yield r.joinerDAO.read(t);if(i.isAbsent())return FG.failure(e.GAME_DOES_NOT_EXIST());const s=eK.copyImmutableArray(i.get().candidates);return s.some(e=>e.id===n.id)?FG.failure(e.USER_ALREADY_IN_GAME()):(n.id===i.get().creator.id||(s[s.length]=n,yield r.joinerDAO.update(t,{candidates:s})),FG.SUCCESS)})()}cancelJoining(t){var n=this;return hw(function*(){if(pw(e.VERBOSE,"JoinerService.cancelJoining("+t.name+"); this.observedJoinerId = "+n.observedJoinerId),null==n.observedJoinerId)throw new Error("cannot cancel joining when not observing a joiner");const r=yield n.joinerDAO.read(n.observedJoinerId);if(!r.isAbsent()){const e=r.get(),i=eK.copyImmutableArray(e.candidates),s=i.findIndex(e=>e.id===t.id);let o=e.chosenOpponent,a=e.partStatus;if(i.splice(s,1),o?.id===t.id)o=null,a=GY.PART_CREATED.value;else if(-1===s)throw new Error("someone that was not candidate nor ChosenOpponent just left the chat: "+t.name);return n.joinerDAO.update(n.observedJoinerId,{chosenOpponent:o,partStatus:a,candidates:i})}})()}updateCandidates(t){var n=this;return hw(function*(){pw(e.VERBOSE,"JoinerService.reviewConfig"),zG(null!=n.observedJoinerId,"JoinerService is not observing a joiner");const r={candidates:t};return n.joinerDAO.update(dw.getNonNullable(n.observedJoinerId),r)})()}deleteJoiner(){var t=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),zG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(dw.getNonNullable(t.observedJoinerId))})()}proposeConfig(t,n,r,i,s){var o=this;return hw(function*(){return pw(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:s}}),pw(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),zG(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(dw.getNonNullable(o.observedJoinerId),{partStatus:GY.CONFIG_PROPOSED.value,chosenOpponent:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:s,firstPlayer:i.value})})()}setChosenOpponent(t){return pw(e.VERBOSE,`JoinerService.setChosenOpponent(${t.name})`),zG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(dw.getNonNullable(this.observedJoinerId),{chosenOpponent:t})}reviewConfig(){var t=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.reviewConfig"),zG(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(dw.getNonNullable(t.observedJoinerId),{partStatus:GY.PART_CREATED.value})})()}reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(t){var n=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.reviewConfig"),zG(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(dw.getNonNullable(n.observedJoinerId),{partStatus:GY.PART_CREATED.value,candidates:t,chosenOpponent:null})})()}acceptConfig(){return pw(e.VERBOSE,"JoinerService.acceptConfig"),zG(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(dw.getNonNullable(this.observedJoinerId),{partStatus:GY.PART_STARTED.value})}createJoiner(t){var n=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)})()}readJoinerById(t){var n=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),(yield n.joinerDAO.read(t)).get()})()}set(t,n){var r=this;return hw(function*(){return pw(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)})()}updateJoinerById(t,n){var r=this;return hw(function*(){return pw(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)})()}}return e.VERBOSE=!1,e.USER_ALREADY_IN_GAME=()=>$localize`You cannot join this game because you are already in another one.`,e.GAME_DOES_NOT_EXIST=()=>$localize`Game does not exist`,e.\u0275fac=function(t){return new(t||e)(Or(tK))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),rK=(()=>{class e{constructor(t,n,r){this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=yw.empty(),pw(e.VERBOSE,"GameService.constructor")}getPartValidity(e,t){var n=this;return hw(function*(){const r=yield n.partDAO.read(e);return r.isAbsent()?FG.failure("NONEXISTENT_PART"):r.get().typeGame===t?FG.SUCCESS:FG.failure("WRONG_GAME_TYPE")})()}createUnstartedPart(t,n){return pw(e.VERBOSE,"GameService.createPart("+t.name+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t.name,turn:-1,result:HG.UNACHIEVED.value,listMoves:[]})}createChat(t){return pw(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}createPartJoinerAndChat(t,n){var r=this;return hw(function*(){pw(e.VERBOSE,`GameService.createGame(${t.id}, ${n})`);const i=yield r.createUnstartedPart(t,n);return yield r.joinerService.createInitialJoiner(t,i),yield r.createChat(i),i})()}startGameWithConfig(t,n,r,i){pw(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));const s=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,s)}getStartingConfig(e){let t,n,r=zY.of(e.firstPlayer);return r===zY.RANDOM&&(r=Math.random()<.5?zY.CREATOR:zY.CHOSEN_PLAYER),r===zY.CREATOR?(t=e.creator.name,n=dw.getNonNullable(e.chosenOpponent).name):(t=dw.getNonNullable(e.chosenOpponent).name,n=e.creator.name),{playerZero:t,playerOne:n,turn:0,beginning:hG(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}deletePart(t){var n=this;return hw(function*(){return pw(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)})()}acceptConfig(t,n){var r=this;return hw(function*(){return pw(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),yield r.joinerService.acceptConfig(),r.startGameWithConfig(t,YY.ONE,0,n)})()}startObserving(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");pw(e.VERBOSE,"[start watching part "+t),this.followedPartId=yw.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}resign(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:HG.RESIGN.value,request:null})}notifyTimeout(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:HG.TIMEOUT.value,request:null})}sendRequest(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}proposeDraw(e,t,n){return this.sendRequest(e,n,t,JY.drawProposed(n))}acceptDraw(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===YY.ZERO?HG.AGREED_DRAW_BY_ZERO:HG.AGREED_DRAW_BY_ONE).value,request:null})}refuseDraw(e,t,n){return this.sendRequest(e,n,t,JY.drawRefused(n))}proposeRematch(e,t,n){return this.sendRequest(e,n,t,JY.rematchProposed(n))}acceptRematch(t,n,r){var i=this;return hw(function*(){pw(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t});const s=dw.getNonNullable(t.data),o=yield i.joinerService.readJoinerById(t.id);let a;a=s.playerZero===o.creator.name?zY.CHOSEN_PLAYER:zY.CREATOR;const l={...o,candidates:[],firstPlayer:a.value,partStatus:GY.PART_STARTED.value},c=yield i.joinerService.createJoiner(l),u=i.getStartingConfig(l),h={lastUpdate:{index:0,player:r.value},typeGame:s.typeGame,result:HG.UNACHIEVED.value,listMoves:[],...u};return yield i.partDAO.set(c,h),yield i.createChat(c),i.sendRequest(t.id,r,n,JY.rematchAccepted(s.typeGame,c))})()}askTakeBack(e,t,n){return this.sendRequest(e,n,t,JY.takeBackAsked(n))}acceptTakeBack(e,t,n,r){var i=this;return hw(function*(){zG(JY.getPlayer(dw.getNonNullable(t.data.request))!==n,"Illegal to accept your own request");const s=JY.takeBackAccepted(n);let o=t.data.listMoves.slice(0,t.data.listMoves.length-1);o.length%2===n.value&&(o=o.slice(0,o.length-1));const a={request:s,listMoves:o,turn:o.length,lastUpdateTime:hG(),remainingMsForZero:dw.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:dw.getNonNullable(t.data.remainingMsForOne)-r[1]},l=t.data.lastUpdate.index;return yield i.partDAO.updateAndBumpIndex(e,n,l,a)})()}refuseTakeBack(e,t,n){const r=JY.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}addGlobalTime(e,t,n,r){var i=this;return hw(function*(){let s={request:JY.addGlobalTime(r.getOpponent())};return s=r===YY.ZERO?{...s,remainingMsForOne:dw.getNonNullable(n.remainingMsForOne)+3e5}:{...s,remainingMsForZero:dw.getNonNullable(n.remainingMsForZero)+3e5},yield i.partDAO.updateAndBumpIndex(e,r,t,s)})()}addTurnTime(e,t,n){var r=this;return hw(function*(){const i={request:JY.addTurnTime(e.getOpponent())};return yield r.partDAO.updateAndBumpIndex(n,e,t,i)})()}stopObserving(){pw(e.VERBOSE,"GameService.stopObserving();"),this.followedPartId=yw.empty(),this.followedPartUnsubscribe()}updateDBBoard(t,n,r,i,s,o,a,l){var c=this;return hw(function*(){pw(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:s,msToSubstract:i,notifyDraw:o,winner:a,loser:l}});const u=(yield c.partDAO.read(t)).get(),h=u.lastUpdate.index,d=u.turn+1,p=eK.copyImmutableArray(u.listMoves);p[p.length]=r;let f={listMoves:p,turn:d,request:null,lastUpdateTime:hG()};return f=c.updateScore(f,s),f=c.substractMs(f,u,i),null!=a?f={...f,winner:a,loser:l,result:HG.VICTORY.value}:!0===o&&(f={...f,result:HG.HARD_DRAW.value}),yield c.partDAO.updateAndBumpIndex(t,n,h,f)})()}updateScore(e,t){return void 0!==t?{...e,scorePlayerZero:t[0],scorePlayerOne:t[1]}:e}substractMs(e,t,n){return n[0]>0?{...e,remainingMsForZero:dw.getNonNullable(t.remainingMsForZero)-n[0]}:n[1]>0?{...e,remainingMsForOne:dw.getNonNullable(t.remainingMsForOne)-n[1]}:e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(qG),Or(nK),Or(ZG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class iK{static getNavigatorLanguage(){return navigator.language}static getLocale(){const e=(localStorage.getItem("locale")??iK.getNavigatorLanguage()??"fr").slice(0,2).toLowerCase();return["en","fr"].some(t=>t===e)?e:"fr"}}let sK=(()=>{class e{changeTheme(e){localStorage.setItem("theme",e)}getTheme(){return yw.ofNullable(localStorage.getItem("theme"))}changeLanguage(e){localStorage.setItem("locale",e.toLowerCase())}getLanguage(){return iK.getLocale()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),oK=(()=>{class e{constructor(e,t){this.document=e,this.userSettingsService=t,this.availableThemes=["dark","light"];const n=this.getStoredTheme();n.isPresent()?this.loadTheme(n.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}getStoredTheme(){const e=this.userSettingsService.getTheme();if(e.isPresent()){const t=e.get();if(this.availableThemes.some(e=>e===t))return yw.of(t)}return yw.empty()}loadTheme(e){this.loadStyle(e+".css"),this.theme=e}loadStyle(e){const t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{const n=this.document.createElement("link");n.id="theme",n.rel="stylesheet",n.href=`${e}`,t.appendChild(n)}}getTheme(){return this.theme}}return e.\u0275fac=function(t){return new(t||e)(Or(Lh),Or(sK))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var aK={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},lK={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},cK={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},uK={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},hK={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},dK={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]};function pK(e){return(pK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){gK(e,t,n[t])})}return e}function yK(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,s=l}finally{try{!r&&null!=a.return&&a.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var vK={},_K={};try{"undefined"!=typeof window&&(vK=window),"undefined"!=typeof document&&(_K=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch{}var CK=(vK.navigator||{}).userAgent,EK=void 0===CK?"":CK,wK=vK,SK=_K,bK=!!SK.documentElement&&!!SK.head&&"function"==typeof SK.addEventListener&&"function"==typeof SK.createElement,PK=(~EK.indexOf("MSIE")||EK.indexOf("Trident/"),"___FONT_AWESOME___"),OK="svg-inline--fa",TK=[1,2,3,4,5,6,7,8,9,10],IK=TK.concat([11,12,13,14,15,16,17,18,19,20]),kK={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},AK=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",kK.GROUP,kK.SWAP_OPACITY,kK.PRIMARY,kK.SECONDARY].concat(TK.map(function(e){return"".concat(e,"x")})).concat(IK.map(function(e){return"w-".concat(e)})),wK.FontAwesomeConfig||{});SK&&"function"==typeof SK.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=yK(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=SK.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(AK[n]=r)});var MK=mK({},{familyPrefix:"fa",replacementClass:OK,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},AK);MK.autoReplaceSvg||(MK.observeMutations=!1);var NK=mK({},MK);wK.FontAwesomeConfig=NK;var xK=wK||{};xK[PK]||(xK[PK]={}),xK[PK].styles||(xK[PK].styles={}),xK[PK].hooks||(xK[PK].hooks={}),xK[PK].shims||(xK[PK].shims=[]);var RK=xK[PK],DK=[];bK&&((SK.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(SK.readyState)||SK.addEventListener("DOMContentLoaded",function e(){SK.removeEventListener("DOMContentLoaded",e),DK.map(function(e){return e()})}));var LK,FK="pending",UK="fulfilled",BK="rejected",VK=function(){},$K="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,zK="undefined"==typeof setImmediate?setTimeout:setImmediate,HK=[];function GK(){for(var e=0;e<HK.length;e++)HK[e][0](HK[e][1]);HK=[],LK=!1}function qK(e,t){HK.push([e,t]),LK||(LK=!0,zK(GK,0))}function WK(e){var t=e.owner,n=t._state,r=t._data,i=e[n],s=e.then;if("function"==typeof i){n=UK;try{r=i(r)}catch(o){KK(s,o)}}jK(s,r)||(n===UK&&ZK(s,r),n===BK&&KK(s,r))}function jK(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===pK(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?YK(e,r):ZK(e,r))},function(t){n||(n=!0,KK(e,t))}),!0}}catch(i){return n||KK(e,i),!0}return!1}function ZK(e,t){(e===t||!jK(e,t))&&YK(e,t)}function YK(e,t){e._state===FK&&(e._state="settled",e._data=t,qK(QK,e))}function KK(e,t){e._state===FK&&(e._state="settled",e._data=t,qK(XK,e))}function JK(e){e._then=e._then.forEach(WK)}function QK(e){e._state=UK,JK(e)}function XK(e){e._state=BK,JK(e),!e._handled&&$K&&global.process.emit("unhandledRejection",e._data,e)}function eJ(e){global.process.emit("rejectionHandled",e)}function tJ(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof tJ))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){KK(t,e)}try{e(function(e){ZK(t,e)},n)}catch(r){n(r)}}(e,this)}tJ.prototype={constructor:tJ,_state:FK,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(VK),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===BK&&$K&&qK(eJ,this)),this._state===UK||this._state===BK?qK(WK,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},tJ.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new tJ(function(t,n){var r=[],i=0;function s(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,a=0;a<e.length;a++)(o=e[a])&&"function"==typeof o.then?o.then(s(a),n):r[a]=o;i||t(r)})},tJ.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new tJ(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},tJ.resolve=function(e){return e&&"object"===pK(e)&&e.constructor===tJ?e:new tJ(function(t){t(e)})},tJ.reject=function(e){return new tJ(function(t,n){n(e)})};var nJ={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function rJ(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function iJ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function sJ(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function oJ(e){return e.size!==nJ.size||e.x!==nJ.x||e.y!==nJ.y||e.rotate!==nJ.rotate||e.flipX||e.flipY}function aJ(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),s="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(s," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var lJ={x:0,y:0,width:"100%",height:"100%"};function cJ(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function uJ(e){return"g"===e.tag?e.children:[e]}function hJ(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,s=e.iconName,o=e.transform,a=e.symbol,l=e.title,c=e.maskId,u=e.titleId,h=e.extra,d=e.watchable,p=void 0!==d&&d,f=r.found?r:n,g=f.width,m=f.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(g/m*16)),_=[NK.replacementClass,s?"".concat(NK.familyPrefix,"-").concat(s):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),C={children:[],attributes:mK({},h.attributes,{"data-prefix":i,"data-icon":s,class:_,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(g," ").concat(m)})},E=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(g/m*16*.0625,"em")}:{};p&&(C.attributes["data-fa-i2svg"]=""),l&&C.children.push({tag:"title",attributes:{id:C.attributes["aria-labelledby"]||"title-".concat(u||rJ())},children:[l]});var w=mK({},C,{prefix:i,iconName:s,main:n,mask:r,maskId:c,transform:o,symbol:a,styles:mK({},E,h.styles)}),S=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,s=e.maskId,o=r.icon,a=i.icon,l=aJ({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),c={tag:"rect",attributes:mK({},lJ,{fill:"white"})},u=o.children?{children:o.children.map(cJ)}:{},h={tag:"g",attributes:mK({},l.inner),children:[cJ(mK({tag:o.tag,attributes:mK({},o.attributes,l.path)},u))]},d={tag:"g",attributes:mK({},l.outer),children:[h]},p="mask-".concat(s||rJ()),f="clip-".concat(s||rJ()),g={tag:"mask",attributes:mK({},lJ,{id:p,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[c,d]},m={tag:"defs",children:[{tag:"clipPath",attributes:{id:f},children:uJ(a)},g]};return t.push(m,{tag:"rect",attributes:mK({fill:"currentColor","clip-path":"url(#".concat(f,")"),mask:"url(#".concat(p,")")},lJ)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,s=sJ(e.styles);if(s.length>0&&(n.style=s),oJ(i)){var o=aJ({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:mK({},o.outer),children:[{tag:"g",attributes:mK({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:mK({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),b=S.attributes;return w.children=S.children,w.attributes=b,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:mK({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(NK.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,s=e.styles,o=e.transform;if(oJ(o)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=sJ(mK({},s,{"transform-origin":"".concat(a.x+o.x/16,"em ").concat(a.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var dJ=function(e,t,n,r){var i,s,o,a=Object.keys(e),l=a.length,c=void 0!==r?function(e,t){return function(n,r,i,s){return e.call(t,n,r,i,s)}}(t,r):t;for(void 0===n?(i=1,o=e[a[0]]):(i=0,o=n);i<l;i++)o=c(o,e[s=a[i]],s,e);return o};function pJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,s=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof RK.hooks.addPack||i?RK.styles[e]=mK({},RK.styles[e]||{},s):RK.hooks.addPack(e,s),"fas"===e&&pJ("fa",t)}var fJ=RK.styles,gJ=RK.shims,mJ=function(){var e=function(e){return dJ(fJ,function(t,n,r){return t[r]=dJ(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in fJ;dJ(gJ,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function yJ(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function vJ(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,s=void 0===i?[]:i;return"string"==typeof e?iJ(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(iJ(e[n]),'" ')},"").trim()}(r),">").concat(s.map(vJ).join(""),"</").concat(t,">")}mJ();function _J(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}(_J.prototype=Object.create(Error.prototype)).constructor=_J;var CJ={fill:"currentColor"},EJ={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},wJ=(mK({},CJ,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),mK({},EJ,{attributeName:"opacity"}));function SJ(e){var t=e[0],n=e[1],r=yK(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(NK.familyPrefix,"-").concat(kK.GROUP)},children:[{tag:"path",attributes:{class:"".concat(NK.familyPrefix,"-").concat(kK.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(NK.familyPrefix,"-").concat(kK.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function bJ(){NK.autoAddCss&&!IJ&&(function(e){if(e&&bK){var t=SK.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=SK.head.childNodes,r=null,i=n.length-1;i>-1;i--){var s=n[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}SK.head.insertBefore(t,r)}}(function(){var e="fa",t=OK,n=NK.familyPrefix,r=NK.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var s=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(s,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),IJ=!0)}function PJ(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return vJ(e)})}}),Object.defineProperty(e,"node",{get:function(){if(bK){var t=SK.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function OJ(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return yJ(TJ.definitions,n,r)||yJ(RK.styles,n,r)}mK({},CJ,{cx:"256",cy:"364",r:"28"}),mK({},EJ,{attributeName:"r",values:"28;14;28;28;14;28;"}),mK({},wJ,{values:"1;0;1;1;0;1;"}),mK({},CJ,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),mK({},wJ,{values:"1;0;0;0;0;1;"}),mK({},CJ,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),mK({},wJ,{values:"0;0;1;1;0;0;"});var TJ=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&fK(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=mK({},e.definitions[t]||{},i[t]),pJ(t,i[t]),mJ()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,s=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][s]=o}),e}}]),e}()),IJ=!1,kJ=function(e){return function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(e)},AJ=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:OJ(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:OJ(i||{})),e(r,mK({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?nJ:n,i=t.symbol,s=void 0!==i&&i,o=t.mask,a=void 0===o?null:o,l=t.maskId,c=void 0===l?null:l,u=t.title,h=void 0===u?null:u,d=t.titleId,p=void 0===d?null:d,f=t.classes,g=void 0===f?[]:f,m=t.attributes,y=void 0===m?{}:m,v=t.styles,_=void 0===v?{}:v;if(e){var C=e.prefix,E=e.iconName,w=e.icon;return PJ(mK({type:"icon"},e),function(){return bJ(),NK.autoA11y&&(h?y["aria-labelledby"]="".concat(NK.replacementClass,"-title-").concat(p||rJ()):(y["aria-hidden"]="true",y.focusable="false")),hJ({icons:{main:SJ(w),mask:a?SJ(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:C,iconName:E,transform:mK({},nJ,r),symbol:s,title:h,maskId:c,titleId:p,extra:{attributes:y,styles:_,classes:g}})})}});const MJ=["*"],NJ=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let xJ=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),RJ=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e){t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t;for(const e of t.icon[2])"string"==typeof e&&(this.definitions[t.prefix][e]=t)}}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),DJ=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[vt]}),e})(),LJ=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(ua(dc),ua(cc))},e.\u0275cmp=Xe({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[vt],ngContentSelectors:MJ,decls:1,vars:0,template:function(e,t){1&e&&(function(e){const t=zt()[16][6];if(!t.projection){const n=t.projection=pr(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?Pa(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}(),function(e,t=0,n){const r=zt(),i=Ht(),s=Fs(i,20+e,16,null,n||null);null===s.projection&&(s.projection=t),Kt(),64!=(64&s.flags)&&function(e,t,n){hs(t[11],0,t,n,ji(e,n,t),Xi(n.parent||t[6],n,t))}(i,r,s)}(0))},encapsulation:2}),e})(),FJ=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=this.icon??this.config.fallbackIcon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=((e,t)=>(e=>void 0!==e.prefix&&void 0!==e.iconName)(e)?e:Array.isArray(e)&&2===e.length?{prefix:e[0],iconName:e[1]}:"string"==typeof e?{prefix:t,iconName:e}:void 0)(e,this.config.defaultPrefix);return"icon"in t?t:this.iconLibrary.getIconDefinition(t.prefix,t.iconName)??((e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null)}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?kJ(this.transform):this.transform;return{title:this.title,transform:t,classes:[...NJ(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=AJ(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(ua(Pp),ua(xJ),ua(RJ),ua(DJ,8),ua(LJ,8))},e.\u0275cmp=Xe({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(za("innerHTML",t.renderedIconHTML,vi),ra("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[vt],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),UJ=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=be({}),e})();function BJ(e,t){if(1&e){const e=va();ma(0),pa(1,"div",9),pa(2,"a",10),Fa(3),fa(),pa(4,"div",12),pa(5,"a",24),Ea("click",function(){return Gt(e),ba().logout()}),ql(6,25),fa(),fa(),fa(),ya()}if(2&e){const e=ba();Ts(3),Ua(e.username)}}const VJ=function(){return["/register"]},$J=function(){return["/login"]};function zJ(e,t){1&e&&(pa(0,"div",26),pa(1,"a",27),pa(2,"strong"),ql(3,28),fa(),fa(),pa(4,"a",29),ql(5,30),fa(),fa()),2&e&&(Ts(1),ha("routerLink",lu(2,VJ)),Ts(3),ha("routerLink",lu(3,$J)))}const HJ=function(){return["/"]},GJ=function(){return["/play"]},qJ=function(){return["/lobby"]},WJ=function(){return["/local"]},jJ=function(){return["/tutorial"]},ZJ=function(){return["/settings"]};let YJ=(()=>{class e{constructor(e,t,n){this.router=e,this.connectedUserService=t,this.userService=n,this.username="connecting...",this.faCog=lK,this.showMenu=!1}ngOnInit(){this.userSub=this.connectedUserService.getUserObs().subscribe(e=>{this.username=e.username.isPresent()?e.username.get():e.email.getOrElse("")})}logout(){var e=this;return hw(function*(){yield e.connectedUserService.disconnect(),yield e.router.navigate(["/"])})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua(e_),ua($Y),ua(QG))},e.\u0275cmp=Xe({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Home`,t=$localize`Play online`,n=$localize`Create a game`,r=$localize`Join a game`,i=$localize`Play offline`,s=$localize`Create a game`,o=$localize`Learn the rules`,a=$localize`Settings`,l=$localize`Log out`,c=$localize`Register`,u=$localize`Log in`,[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],e,[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],t,[1,"navbar-dropdown"],n,r,i,s,o,[1,"navbar-end"],["data-tooltip",a,1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["connect",""],["id","logout",1,"navbar-item",3,"click"],l,[1,"buttons"],[1,"button","is-primary",3,"routerLink"],c,[1,"button","is-light",3,"routerLink"],u]},template:function(e,t){if(1&e&&(pa(0,"nav",0),pa(1,"div",1),pa(2,"a",2),ga(3,"img",3),fa(),pa(4,"a",4),Ea("click",function(){return t.showMenu=!t.showMenu}),ga(5,"span",5),ga(6,"span",5),ga(7,"span",5),fa(),fa(),pa(8,"div",6),Ea("click",function(){return t.showMenu=!t.showMenu}),pa(9,"div",7),pa(10,"a",2),ql(11,8),fa(),pa(12,"div",9),pa(13,"a",10),ql(14,11),fa(),pa(15,"div",12),pa(16,"a",2),ql(17,13),fa(),pa(18,"a",2),ql(19,14),fa(),fa(),fa(),pa(20,"div",9),pa(21,"a",10),ql(22,15),fa(),pa(23,"div",12),pa(24,"a",2),ql(25,16),fa(),pa(26,"a",2),ql(27,17),fa(),fa(),fa(),fa(),pa(28,"div",18),pa(29,"a",19),ga(30,"fa-icon",20),fa(),pa(31,"div",21),la(32,BJ,7,1,"ng-container",22),la(33,zJ,6,4,"ng-template",null,23,Lu),fa(),fa(),fa(),fa()),2&e){const e=ca(34);Ts(2),ha("routerLink",lu(12,HJ)),Ts(2),ha("ngClass",t.showMenu?"is-active":""),Ts(4),ha("ngClass",t.showMenu?"is-active":""),Ts(2),ha("routerLink",lu(13,HJ)),Ts(6),ha("routerLink",lu(14,GJ)),Ts(2),ha("routerLink",lu(15,qJ)),Ts(6),ha("routerLink",lu(16,WJ)),Ts(2),ha("routerLink",lu(17,jJ)),Ts(3),ha("routerLink",lu(18,ZJ)),Ts(1),ha("icon",t.faCog),Ts(2),ha("ngIf",t.username)("ngIfElse",e)}},directives:[r_,Bd,FJ,Hd],encapsulation:2}),e})(),KJ=(()=>{class e{constructor(e,t){this._themeService=e,this._errorLoggerService=t}}return e.\u0275fac=function(t){return new(t||e)(ua(oK),ua($G))},e.\u0275cmp=Xe({type:e,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container","mt-2"]],template:function(e,t){1&e&&(ga(0,"app-header"),pa(1,"main",0),ga(2,"router-outlet"),fa())},directives:[YJ,s_],encapsulation:2}),e})();class JJ{constructor(e,t){this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}}class QJ extends JJ{isDown(){return 1===this.y}isUp(){return-1===this.y}isLeft(){return-1===this.x}isRight(){return 1===this.x}toInt(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}toString(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}class XJ{of(e,t){for(const n of this.all)if(n.x===e&&n.y===t)return RG.success(n);return RG.failure("Invalid x and y in direction construction")}fromDelta(e,t){return 0===e&&0===t?RG.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):RG.failure(`Invalid delta for direction: ${e}, ${t}`)}fromMove(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}fromString(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return RG.failure(`Invalid direction string ${e}`)}}fromInt(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return RG.failure(`Invalid int direction: ${e}`)}}}class eQ extends QJ{constructor(e,t){super(e,t)}isDiagonal(){return 0!==this.x&&0!==this.y}getOpposite(){return eQ.factory.of(-this.x,-this.y).get()}}eQ.UP=new eQ(0,-1),eQ.UP_RIGHT=new eQ(1,-1),eQ.RIGHT=new eQ(1,0),eQ.DOWN_RIGHT=new eQ(1,1),eQ.DOWN=new eQ(0,1),eQ.DOWN_LEFT=new eQ(-1,1),eQ.LEFT=new eQ(-1,0),eQ.UP_LEFT=new eQ(-1,-1),eQ.factory=new class extends XJ{constructor(){super(...arguments),this.all=[eQ.UP,eQ.UP_RIGHT,eQ.RIGHT,eQ.DOWN_RIGHT,eQ.DOWN,eQ.DOWN_LEFT,eQ.LEFT,eQ.UP_LEFT]}},eQ.DIRECTIONS=eQ.factory.all,eQ.DIAGONALS=[eQ.UP_RIGHT,eQ.DOWN_RIGHT,eQ.DOWN_LEFT,eQ.UP_LEFT],eQ.ORTHOGONALS=[eQ.UP,eQ.RIGHT,eQ.DOWN,eQ.LEFT],eQ.encoder=new class extends qY{encode(e){return e.toString()}decode(e){return zG("string"==typeof e,"Invalid encoded direction"),eQ.factory.fromString(e).get()}};class tQ extends QJ{constructor(e,t){super(e,t)}getOpposite(){return tQ.factory.of(-this.x,-this.y).get()}}tQ.UP=new tQ(0,-1),tQ.RIGHT=new tQ(1,0),tQ.DOWN=new tQ(0,1),tQ.LEFT=new tQ(-1,0),tQ.factory=new class extends XJ{constructor(){super(...arguments),this.all=[tQ.UP,tQ.RIGHT,tQ.DOWN,tQ.LEFT]}of(e,t){return 0===e&&-1===t?RG.success(tQ.UP):1===e&&0===t?RG.success(tQ.RIGHT):0===e&&1===t?RG.success(tQ.DOWN):-1===e&&0===t?RG.success(tQ.LEFT):RG.failure("Invalid orthogonal from x and y")}},tQ.ORTHOGONALS=tQ.factory.all,tQ.encoder=new class extends qY{encode(e){return e.toString()}decode(e){return zG("string"==typeof e,"Invalid encoded orthogonal"),tQ.factory.fromString(e).get()}};class nQ{constructor(e,t){this.x=e,this.y=t}static numberEncoder(e,t){return jY.tuple([jY.numberEncoder(e),jY.numberEncoder(t)],e=>[e.x,e.y],e=>new nQ(e[0],e[1]))}getNext(e,t){return new nQ(this.x+(t=t??1)*e.x,this.y+t*e.y)}getPrevious(e,t){return this.getNext(e,-(t=t??1))}getLeft(e){return new nQ(this.x+e.y,this.y+-e.x)}getRight(e){return new nQ(this.x+-e.y,this.y+e.x)}getOpposite(){return new nQ(-this.x,-this.y)}isInRange(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}isNotInRange(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}getDirectionToward(e){return eQ.factory.fromMove(this,e)}getOrthogonalDistance(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}getDistance(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");const t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}isHexagonallyAlignedWith(e){const t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}isAlignedWith(e){const t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}getVectorToward(e){return new nQ(e.x-this.x,e.y-this.y)}getMinimalVectorToward(e){return this.getVectorToward(e).toVector()}getCoordsToward(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];const t=this.getDirectionToward(e).get();let n=this.getNext(t,1);const r=[];for(;!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}toVector(){const e=Math.abs(this.x),t=Math.abs(this.y),n=Math.max(e,t);let r=this.x,i=this.y,s=2;for(;s<=n;)r%s==0&&i%s==0?(r/=s,i/=s):s++;return new nQ(r,i)}isBetween(e,t){const n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}equals(e){return this===e||e.x===this.x&&e.y===this.y}compareTo(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}toString(){return"("+this.x+", "+this.y+")"}}nQ.encoder=new class extends qY{encode(e){return{x:e.x,y:e.y}}decode(e){const t=e;return zG(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new nQ(t.x,t.y)}};let rQ=(()=>{class e{constructor(e){this.messageDisplayer=e,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=yw.empty(),this.imagesLocation="assets/images/"}message(e){this.messageDisplayer.gameMessage(e)}cancelMove(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?FG.SUCCESS:(this.messageDisplayer.gameMessage(e),FG.failure(e))}cancelMoveAttempt(){}getPlayerClass(e){switch(e){case YY.ZERO:return"player0";case YY.ONE:return"player1";default:return dw.expectToBe(e,KY.NONE),""}}pass(){var e=this;return hw(function*(){return $G.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name})})()}getTurn(){return this.rules.node.gameState.turn}getCurrentPlayer(){return this.rules.node.gameState.getCurrentPlayer()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}range(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),iQ=(()=>{class e extends rQ{getHexaCoordsBy(e,t){const n=new nQ(e,t);return this.getHexaCoordsAt(n)}getHexaCoordsAt(e){let t="";const n=this.hexaLayout.getHexaCoordsAt(e);for(const r of n)t+=r.x+" "+r.y+" ";return t+=n[0].x+" "+n[0].y,t}getCenterBy(e,t){const n=new nQ(e,t);return this.getCenterAt(n)}getCenterAt(e){return this.hexaLayout.getCenterAt(e)}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class sQ{constructor(e){this.value=e}static from(e){switch(e){case sQ.ZERO.value:return sQ.ZERO;case sQ.ONE.value:return sQ.ONE;case sQ.EMPTY.value:return sQ.EMPTY;case sQ.UNREACHABLE.value:return sQ.UNREACHABLE;default:throw new Error("FourStatePiece has no value matching "+e)}}static ofPlayer(e){switch(e){case YY.ZERO:return sQ.ZERO;default:return dw.expectToBe(e,YY.ONE),sQ.ONE}}equals(e){return this===e}is(e){return this.value===e.value}isPlayer(){return this===sQ.ZERO||this===sQ.ONE}}sQ.ZERO=new sQ(YY.ZERO.value),sQ.ONE=new sQ(YY.ONE.value),sQ.EMPTY=new sQ(KY.NONE.value),sQ.UNREACHABLE=new sQ(3);class oQ extends QJ{constructor(e,t){super(e,t)}static getAngle(e){switch(e){case oQ.UP:return 0;case oQ.UP_RIGHT:return 60;case oQ.RIGHT:return 120;case oQ.DOWN:return 180;case oQ.DOWN_LEFT:return 240;default:return dw.expectToBe(e,oQ.LEFT),300}}getOpposite(){return oQ.factory.of(-this.x,-this.y).get()}}oQ.UP=new oQ(0,-1),oQ.LEFT=new oQ(-1,0),oQ.UP_RIGHT=new oQ(1,-1),oQ.DOWN_LEFT=new oQ(-1,1),oQ.RIGHT=new oQ(1,0),oQ.DOWN=new oQ(0,1),oQ.factory=new class extends XJ{constructor(){super(...arguments),this.all=[oQ.UP,oQ.UP_RIGHT,oQ.RIGHT,oQ.DOWN,oQ.DOWN_LEFT,oQ.LEFT]}},oQ.encoder=new class extends jY{maxValue(){return 5}encodeNumber(e){switch(e){case oQ.UP:return 0;case oQ.UP_RIGHT:return 1;case oQ.RIGHT:return 2;case oQ.DOWN:return 3;case oQ.DOWN_LEFT:return 4;default:return 5}}decodeNumber(e){return zG(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),oQ.factory.all[e]}};class aQ{constructor(e,t,n){this.size=e,this.origin=t,this.orientation=n}getCenterAt(e){const t=this.orientation.conversionMatrix;return new nQ(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}getCornerOffset(e){const t=2*Math.PI*(this.orientation.startAngle+e)/6;return new nQ(this.size*Math.cos(t),this.size*Math.sin(t))}getHexaCoordsAt(e){const t=this.getCenterAt(e),n=[];for(let r=0;r<6;r+=1){const e=this.getCornerOffset(r);n.push(new nQ(t.x+e.x,t.y+e.y))}return n}}class lQ{}class cQ extends lQ{constructor(){super(),this.startAngle=.5,this.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],this.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3]}}cQ.INSTANCE=new cQ;class uQ extends lQ{constructor(){super(),this.startAngle=0,this.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],this.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3]}isOnBorder(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}isOnTopRightBorder(e,t){return 0===t.y}isOnRightBorder(e,t){return t.x===e.width-1}isOnLeftBorder(e,t){return 0===t.x}isOnBottomLeftBorder(e,t){return t.y===e.height-1}isOnTopLeftBorder(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}isOnBottomRightBorder(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}getAllBorders(e){const t=[];return e.forEachCoord((n,r)=>{this.isOnBorder(e,n)&&t.push(n)}),t}isTopCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}isTopLeftCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isTopRightCorner(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}isBottomCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}isBottomLeftCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isBottomRightCorner(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}uQ.INSTANCE=new uQ;let hQ=(()=>{class e{}return e.CANNOT_CHOOSE_OPPONENT_PIECE=()=>$localize`You cannot pick a piece of the opponent.`,e.MUST_CLICK_ON_EMPTY_SPACE=()=>$localize`You must click on an empty space.`,e.MUST_CLICK_ON_EMPTY_SQUARE=()=>$localize`You must click on an empty square.`,e.CANNOT_SELF_CAPTURE=()=>$localize`Your landing space should be empty or contain a piece of the opponent.`,e.MUST_CHOOSE_PLAYER_PIECE=()=>$localize`You must pick one of your pieces.`,e.CANNOT_PASS=()=>$localize`You cannot pass your turn.`,e.MUST_LAND_ON_EMPTY_SPACE=()=>$localize`You must drop your piece on an empty space.`,e.MUST_PASS=()=>$localize`You must pass your turn.`,e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=()=>$localize`You have selected an empty space, you must select one of your own pieces.`,e.MOVE_CANNOT_BE_STATIC=()=>$localize`You must choose different starting and ending coordinates.`,e})();class dQ{constructor(e,t){this.ruler=e,this.name=t}toString(){return this.name}}class pQ{constructor(e){this.value=e}static fromWinner(e){return e.isPlayer()?new pQ(e.getVictoryValue()):new pQ(0)}toString(){return""+this.value}}class fQ{static toComparableObjectSet(e){const t=[];return e.forEach(e=>{t.some(t=>t.equals(e))||t.push(e)}),t}static toComparableSet(e){const t=[];return e.forEach(e=>{t.some(t=>mw(t,e))||t.push(e)}),t}}class gQ{constructor(e){this.values=void 0===e?[]:fQ.toComparableSet(e)}equals(e){if(e.size()!==this.size())return!1;for(const t of this)if(!1===e.contains(t))return!1;return!0}toString(){let e="";for(const t of this)e+=null==t?"null, ":t.toString()+", ";return"["+e.slice(0,-2)+"]"}add(e){return!this.contains(e)&&(this.values.push(e),!0)}union(e){for(const t of e)this.add(t)}contains(e){for(const t of this.values)if(mw(t,e))return!0;return!1}size(){return this.values.length}toList(){const e=[];for(const t of this)e.push(t);return e}getAnyElement(){return this.size()>0?yw.of(this.values[0]):yw.empty()}[Symbol.iterator](){return this.values.values()}}class mQ{constructor(e){this.turn=e}getCurrentPlayer(){return YY.fromTurn(this.turn)}getCurrentOpponent(){return this.turn%2==1?YY.ZERO:YY.ONE}}class yQ extends mQ{constructor(e,t){super(t),this.board=e}getPieceAt(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}isOnBoard(e){return e.isInRange(this.board[0].length,this.board.length)}getPieceAtXY(e,t){return this.getPieceAt(new nQ(e,t))}forEachCoord(e){for(const[t,n]of this.getCoordsAndContents())e(t,n)}getCoordsAndContents(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++){const r=new nQ(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}getCopiedBoard(){return eK.copyBiArray(this.board)}}class vQ extends yQ{static getInitialState(){const e=sQ.EMPTY,t=sQ.UNREACHABLE,n=sQ.ZERO,r=sQ.ONE;return new vQ([[t,t,t,t,r,r,r,r,r],[t,t,t,r,r,r,r,r,r],[t,t,e,e,r,r,r,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,n,n,n,e,e,t,t],[n,n,n,n,n,n,t,t,t],[n,n,n,n,n,t,t,t,t]],0)}isInBoard(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==sQ.UNREACHABLE}isPiece(e){return this.getPieceAt(e).isPlayer()}getScores(){const e=[14,14];for(let t=0;t<9;t++)for(let n=0;n<9;n++)this.getPieceAtXY(n,t)===sQ.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===sQ.ONE&&(e[0]=e[0]-1);return e}}class _Q{}class CQ extends _Q{constructor(e,t){super(),this.coord=new nQ(e,t)}}class EQ extends CQ{constructor(e,t,n){if(super(e.x,e.y),this.dir=t,this.lastPiece=n,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!")}static fromSingleCoord(e,t){try{return RG.success(new EQ(e,t,yw.empty()))}catch(n){return RG.failure(n.message)}}static fromDoubleCoord(e,t,n){const r=[e,t];eK.sortByDescending(r,EQ.sortCoord);const i=r[1].getDirectionToward(r[0]).get(),s=oQ.factory.fromDelta(i.x,i.y);if(s.isFailure())return RG.failure("Invalid direction");const o=s.get();return r[1].getDistance(r[0])>2?RG.failure("Distance between first coord and last coord is too great"):o.equals(n)?EQ.fromSingleCoord(r[1],n):o.getOpposite().equals(n)?EQ.fromSingleCoord(r[0],n):RG.success(new EQ(r[1],n,yw.of(r[0])))}static sortCoord(e){return 9*e.y+e.x}toString(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}isSingleCoord(){return this.lastPiece.isAbsent()}equals(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}EQ.encoder=new class extends jY{maxValue(){return 104831}encodeNumber(e){const t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;{const n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}}decodeNumber(e){const t=e%8;e=(e-t)/8;const n=oQ.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;const s=new nQ(i,r);if(0===e)return EQ.fromSingleCoord(s,n).get();{const t=(e=(e-1)/2)%9,r=(e=(e-t)/9)%9;e=(e-r)/9;const i=new nQ(r,t);return EQ.fromDoubleCoord(s,i,n).get()}}};var wQ=(()=>(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(wQ||(wQ={})),wQ))();class SQ{constructor(e=[],t=!1){this.map=e,this.isImmutable=t}static from(e){const t=Object.keys(e),n=new SQ;for(const r of t)n.set(r,e[r]);return n}makeImmutable(){this.isImmutable=!0}get(e){for(const t of this.map)if(mw(t.key,e))return yw.of(t.value);return yw.empty()}forEach(e){for(let t=0;t<this.map.length;t++)e(this.getByIndex(t))}getByIndex(e){return this.map[e]}putAll(e){this.checkImmutability("putAll");for(const t of e.map)this.put(t.key,t.value)}checkImmutability(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}put(e,t){this.checkImmutability("put");for(const n of this.map)if(mw(n.key,e)){const e=n.value;return n.value=t,yw.of(e)}return this.map.push({key:e,value:t}),yw.empty()}containsKey(e){return this.map.some(t=>mw(t.key,e))}size(){return this.map.length}listKeys(){return this.map.map(e=>e.key)}getKeySet(){return new gQ(this.listKeys())}filter(e){const t=new SQ;for(const n of this.map)e(n.key,n.value)&&t.set(n.key,n.value);return t}replace(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}set(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}delete(e){this.checkImmutability("delete");for(let t=0;t<this.map.length;t++)if(mw(this.map[t].key,e)){const e=this.map[t].value,n=this.map.slice(0,t),r=this.map.slice(t+1);return this.map=n.concat(r),e}throw new Error('No Value to delete for key "'+e.toString()+'"!')}getCopy(){const e=new this.constructor;for(const t of this.listKeys())e.set(t,this.get(t).get());return e}equals(e){const t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;for(const r of t){const t=this.get(r).get(),n=e.get(r);if(zG(n.isPresent(),"value is absent in a map even though its key is present!"),!1===mw(t,n.get()))return!1}return!0}}class bQ extends SQ{reverse(){const e=new bQ;for(const t of this.listKeys()){const n=this.get(t).get();if(e.containsKey(n))e.get(n).get().add(t);else{const r=new gQ;r.add(t),e.set(n,r)}}return e}}let PQ=(()=>{class e{}return e.createdNodes=0,e.minimaxTime=0,e})();class OQ{constructor(e,t=yw.empty(),n=yw.empty(),r){if(this.gameState=e,this.mother=t,this.move=n,this.minimaxCreator=r,this.childs=yw.empty(),this.hopedValue=new SQ,this.ownValue=new SQ,this.possibleMoves=new SQ,this.ownValue=new SQ,null!=r){const e=r.getBoardValue(this);this.ownValue.set(r.name,e),this.hopedValue.set(r.name,e.value)}PQ.createdNodes++,pw(OQ.VERBOSE||!1,"creating "+this.myToString())}static getScoreStatus(e){const t=!1;return e===Number.MAX_SAFE_INTEGER||e===Number.MIN_SAFE_INTEGER?(pw(OQ.VERBOSE||t,"VICTORY"),wQ.VICTORY):e===Number.MIN_SAFE_INTEGER+1?(pw(OQ.VERBOSE||t,"PRE_VICTORY_MIN"),wQ.PRE_VICTORY):e===Number.MAX_SAFE_INTEGER-1?(pw(OQ.VERBOSE||t,"PRE_VICTORY_MAX"),wQ.PRE_VICTORY):(pw(OQ.VERBOSE||t,"DEFAULT"),wQ.DEFAULT)}findBestMove(e,t,n=!1,r=!0){const i=(new Date).getTime();let s=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);for(;s.gameState.turn>this.gameState.turn+1;)s=s.mother.get(),e--;return PQ.minimaxTime+=(new Date).getTime()-i,s.move.get()}alphaBeta(e,t,n,r,i,s){if(e<1)return pw(OQ.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+e),this;if(r.ruler.getGameStatus(this).isEndGame)return pw(OQ.VERBOSE||!1,"isLeaf-EndGame("+OQ.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+e),this;const o=this.getPossibleMoves(r);zG(o.length>0,"Minimax "+r.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=yw.of([]));let a=[];const l=this.gameState.getCurrentPlayer();let c=l===YY.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER;const u=l===YY.ZERO?(e,t)=>e<t:(e,t)=>e>t;for(const p of o){const o=this.getOrCreateChild(p,r).alphaBeta(e-1,t,n,r,i,s),h=o.getHopedValue(r);if(u(h,c)||0===a.length?(c=h,a=[o]):h===c&&a.push(o),s&&u(c,l===YY.ZERO?t:n))break;l===YY.ZERO?n=Math.min(c,n):t=Math.max(c,t)}let h;h=i?a[Math.floor(Math.random()*a.length)]:a[0];const d=h.hopedValue.get(r.toString()).get();return this.hopedValue.put(r.toString(),d),h}getPossibleMoves(e){const t=this.possibleMoves.get(e.name);if(t.isAbsent()){const t=e.getListMoves(this);return this.possibleMoves.set(e.name,new gQ(t)),t}return t.get().toList()}getOrCreateChild(e,t){let n=this.getSonByMove(e);if(n.isAbsent()){const r=t.ruler.isLegal(e,this.gameState);zG(r.isSuccess(),`The minimax has proposed an illegal move: ${e.toString()}, this should not happen.`);const i=t.ruler.applyLegalMove(e,this.gameState,r.get());n=yw.of(new OQ(i,yw.of(this),yw.of(e),t)),this.childs.get().push(n.get())}return n.get()}getSonByMove(e){zG(this.childs.isPresent(),"Cannot get son of uncalculated node");for(const t of this.childs.get())if(t.move.isPresent()&&t.move.equalsValue(e))return yw.of(t);return yw.empty()}getInitialNode(){let e=this;for(;e.mother.isPresent();)e=e.mother.get();return e}getHopedValue(e){return this.hopedValue.get(e.name).get()}getOwnValue(e){const t=this.ownValue.get(e.name);if(t.isAbsent()){const t=e.getBoardValue(this);return this.ownValue.set(e.name,t),t}return t.get()}myToString(){let e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}hasMoves(){return this.childs.isPresent()}countDescendants(){if(this.childs.isAbsent())return 0;let e=this.childs.get().length;for(const t of this.childs.get())e+=t.countDescendants();return e}}OQ.VERBOSE=!1,OQ.minimaxes=new SQ;class TQ{constructor(e,t){this.isEndGame=e,this.winner=t}static getVictory(e){return e===YY.ZERO?TQ.ZERO_WON:TQ.ONE_WON}static getDefeat(e){return e===YY.ZERO?TQ.ONE_WON:TQ.ZERO_WON}toBoardValue(){return this.winner.isPlayer()?this.winner.getVictoryValue():0}}TQ.ZERO_WON=new TQ(!0,YY.ZERO),TQ.ONE_WON=new TQ(!0,YY.ONE),TQ.DRAW=new TQ(!0,KY.NONE),TQ.ONGOING=new TQ(!1,KY.NONE);class IQ{constructor(e){this.stateType=e,this.setInitialBoard()}choose(e){const t=!1;pw(t,"Rules.choose: "+e.toString()+" was proposed");const n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){pw(t,"Rules.choose: current node has moves");const r=this.node.getSonByMove(e);if(r.isPresent())return zG(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),pw(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(pw(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return pw(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;pw(t,"Rules.choose: Move is legal, let's apply it");const r=this.applyLegalMove(e,this.node.gameState,n.get()),i=new OQ(r,yw.of(this.node),yw.of(e));return this.node=i,!0}setInitialBoard(){if(null==this.node){const e=this.stateType.getInitialState();OQ.ruler=this,this.node=new OQ(e)}else this.node=this.node.getInitialNode()}applyMoves(e,t,n){let r=0;for(const i of e){const e=n(i),s=this.isLegal(e,t);zG(s.isSuccess(),"Can't create state from invalid moves ("+r+"): "+s.toString()+"."),t=this.applyLegalMove(e,t,s.get()),r++}return t}}let kQ=(()=>{class e{}return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=()=>$localize`You cannot move more than 3 of your pieces!`,e.NOT_ENOUGH_PIECE_TO_PUSH=()=>$localize`You don't have enough pieces to push that group!`,e.CANNOT_PUSH_YOUR_OWN_PIECES=()=>$localize`You cannot push this piece because it is blocked by one of yours!`,e.MUST_ONLY_TRANSLATE_YOUR_PIECES=()=>$localize`This line contains pieces of your opponent or empty spaces, which is forbidden.`,e.TRANSLATION_IMPOSSIBLE=()=>$localize`This move is impossible, some landing spaces are occupied.`,e.LINE_AND_COORD_NOT_ALIGNED=()=>$localize`This space is not aligned with the current line.`,e})();class AQ extends IQ{static isLegal(e,t){const n=this.getFirstPieceValidity(e,t);return n.isFailure()?n.toFailedFallible():e.isSingleCoord()?AQ.isLegalPush(e,t):AQ.isLegalSideStep(e,t)}static getFirstPieceValidity(e,t){const n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?FG.failure(hQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===sQ.ofPlayer(t.getCurrentOpponent())?FG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):FG.SUCCESS}static isLegalPush(e,t){let n=1,r=e.coord.getNext(e.dir);const i=sQ.ofPlayer(t.getCurrentPlayer()),s=sQ.EMPTY,o=t.getCopiedBoard();for(o[e.coord.y][e.coord.x]=s;n<=3&&t.isOnBoard(r)&&t.getPieceAt(r)===i;)n++,r=r.getNext(e.dir);return n>3?RG.failure(kQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(r)||(o[r.y][r.x]=i,t.getPieceAt(r)===s)?RG.success(o):AQ.isLegalRealPush(r,e,t,n,o)}static isLegalRealPush(e,t,n,r,i){let s=0;const o=sQ.ofPlayer(n.getCurrentOpponent()),a=sQ.ofPlayer(n.getCurrentPlayer());for(;s<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)s++,e=e.getNext(t.dir);return s>=r?RG.failure(kQ.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===sQ.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===a)?RG.failure(kQ.CANNOT_PUSH_YOUR_OWN_PIECES()):RG.success(i)}static isLegalSideStep(e,t){let n=e.lastPiece.get();const r=e.coord.getDirectionToward(n).get();n=n.getNext(r);let i=e.coord;const s=sQ.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();for(;!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==s)return RG.failure(kQ.MUST_ONLY_TRANSLATE_YOUR_PIECES());const n=i.getNext(e.dir);if(o[i.y][i.x]=sQ.EMPTY,n.isInRange(9,9)){if(t.isPiece(n))return RG.failure(kQ.TRANSLATION_IMPOSSIBLE());t.getPieceAt(n)===sQ.EMPTY&&(o[n.y][n.x]=s)}i=i.getNext(r)}return RG.success(o)}static getGameStatus(e){const t=e.gameState.getScores();return t[0]>5?TQ.ZERO_WON:t[1]>5?TQ.ONE_WON:TQ.ONGOING}applyLegalMove(e,t,n){return new vQ(n,t.turn+1)}isLegal(e,t){return AQ.isLegal(e,t)}getGameStatus(e){return AQ.getGameStatus(e)}}class MQ extends dQ{getListMoves(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<9;i++)for(let e=0;e<9;e++){const s=new nQ(e,i);if(!1!==n.getPieceAt(s).is(r))for(const e of oQ.factory.all){const r=EQ.fromSingleCoord(s,e).get();if(this.isAcceptablePush(r,n)){t.push(r);for(const r of oQ.factory.all)for(let i=1;i<=2&&!r.equals(e);i++){const o=s.getNext(r,i);if(!o.isInRange(9,9))break;{const r=EQ.fromDoubleCoord(s,o,e).get();AQ.isLegal(r,n).isSuccess()&&t.push(r)}}}}}return new gQ(t).toList()}isAcceptablePush(e,t){const n=t.getScores(),r=AQ.isLegal(e,t);if(r.isSuccess()){const e=t.getCurrentOpponent().value;return!(new vQ(r.get(),t.turn+1).getScores()[e]>n[e])}return!1}getBoardValue(e){const t=AQ.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState.getScores();return new pQ(n[1]-n[0])}}class NQ{constructor(e,t,n){this.title=e,this.instruction=t,this.state=n,this.previousMove=yw.empty()}static fromMove(e,t,n,r,i,s){return new RQ(e,t,n,r,i,s)}static forClick(e,t,n,r,i,s){return new LQ(e,t,n,r,i,s)}static anyMove(e,t,n,r,i){return new DQ(e,t,n,r,i)}static fromPredicate(e,t,n,r,i,s){return new FQ(e,t,n,r,i,s)}static informational(e,t,n){return new UQ(e,t,n)}isMove(){return!1}isAnyMove(){return!1}isClick(){return!1}isPredicate(){return!1}isInformation(){return!1}hasSolution(){return!1}withPreviousMove(e){return this.previousMove=yw.of(e),this}}class xQ extends NQ{constructor(e,t,n,r){super(e,t,n),this.successMessage=r}hasSolution(){return!0}getSuccessMessage(){return this.successMessage}}class RQ extends xQ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedMoves=r,this.failureMessage=s,zG(r.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational")}isMove(){return!0}getSolution(){return this.acceptedMoves[0]}getFailureMessage(){return this.failureMessage}}class DQ extends xQ{constructor(e,t,n,r,i){super(e,t,n,i),this.solutionMove=r}getSolution(){return this.solutionMove}isAnyMove(){return!0}}class LQ extends xQ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedClicks=r,this.failureMessage=s}isClick(){return!0}getSolution(){return this.acceptedClicks[0]}getFailureMessage(){return this.failureMessage}}class FQ extends xQ{constructor(e,t,n,r,i,s){super(e,t,n,s),this.solutionMove=r,this.predicate=i}getSolution(){return this.solutionMove}isPredicate(){return!0}}class UQ extends NQ{isInformation(){return!0}}const BQ=sQ.EMPTY,VQ=sQ.UNREACHABLE,$Q=sQ.ZERO,zQ=sQ.ONE;class HQ{constructor(){this.tutorial=[NQ.informational($localize`Initial board and goal of the game`,$localize`At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!`,vQ.getInitialState()),NQ.anyMove($localize`Moving a piece`,$localize`At each turn, move one, two, or three pieces either along their line, or on their side.
        For your moves you can therefore choose between up to 6 directions.
        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).
        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>
        You're playing Dark, make any move!`,vQ.getInitialState(),EQ.fromSingleCoord(new nQ(2,6),oQ.UP).get(),$localize`Congratulations!`),NQ.fromMove($localize`Pushing`,$localize`To push one opponent piece, you must move at least two of your pieces.
        To push two opponent pieces, you must move three of your pieces.
        If one of your pieces is in the way, it will be impossible to push.
        You cannot move more than three pieces.<br/><br/>
        Only one push towards the right is possible here, find it. (You're playing Dark).`,new vQ([[VQ,VQ,VQ,VQ,BQ,$Q,$Q,zQ,zQ],[VQ,VQ,VQ,BQ,BQ,BQ,BQ,BQ,BQ],[VQ,VQ,BQ,$Q,$Q,$Q,zQ,$Q,BQ],[VQ,BQ,BQ,BQ,BQ,BQ,BQ,BQ,BQ],[BQ,BQ,BQ,BQ,$Q,$Q,$Q,zQ,zQ],[BQ,BQ,BQ,BQ,BQ,BQ,BQ,BQ,VQ],[BQ,BQ,BQ,BQ,$Q,zQ,BQ,VQ,VQ],[BQ,BQ,BQ,$Q,BQ,BQ,VQ,VQ,VQ],[BQ,BQ,$Q,BQ,BQ,VQ,VQ,VQ,VQ]],0),[EQ.fromSingleCoord(new nQ(4,4),oQ.RIGHT).get()],$localize`Congratulations! You know everything you need to start a game!`,$localize`Failed!`)]}}function GQ(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onPieceClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ia("id","piece_",e,"_",t,""),ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.getCenterBy(e,t).x)("cy",n.getCenterBy(e,t).y)("r",.5*n.SPACE_SIZE)}}function qQ(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",4),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onCaseClick(t,n)}),fa(),la(2,GQ,1,6,"circle",5),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Ia("id","case_",t,"_",r,""),ha("ngClass",i.getSquareClasses(t,r)),ra("points",i.getHexaCoordsBy(t,r)),Ts(1),ha("ngIf",i.isPiece(n))}}function WQ(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,qQ,3,5,"g",3),fa()),2&e){const e=t.$implicit,n=ba(2);Ts(1),ha("ngIf",n.isBoard(e))}}function jQ(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,WQ,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function ZQ(e,t){1&e&&(Cn(),pa(0,"marker",7),ga(1,"polygon",8),fa()),2&e&&Ta("id","arrowhead_",t.$implicit.dir.toString(),"")}function YQ(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),ga(1,"line",9),pa(2,"line",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),pa(3,"polygon",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().chooseDirection(t.dir)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),Ta("id","line_start_",e.dir.toString(),""),ra("x1",e.startCenter.x)("y1",e.startCenter.y)("x2",e.middle.x)("y2",e.middle.y),Ts(1),Ta("id","line_end_",e.dir.toString(),""),ra("x1",e.middle.x)("y1",e.middle.y)("x2",e.landingCenter.x)("y2",e.landingCenter.y),Ts(1),Ta("id","direction_",e.dir.toString(),""),ra("transform",e.transformation)}}class KQ{constructor(e,t,n,r,i,s){this.startCenter=e,this.middle=t,this.landingCenter=n,this.landing=r,this.dir=i,this.transformation=s}}let JQ=(()=>{class e extends iQ{constructor(e){super(e),this.moveds=[],this.directions=[],this.selecteds=[],this.rules=new AQ(vQ),this.availableMinimaxes=[new MQ(this.rules,"Dummy")],this.encoder=EQ.encoder,this.tutorial=(new HQ).tutorial,this.scores=yw.of([0,0]),this.SPACE_SIZE=30,this.hexaLayout=new aQ(this.SPACE_SIZE,new nQ(-8*this.SPACE_SIZE,2*this.SPACE_SIZE),cQ.INSTANCE),this.updateBoard()}updateBoard(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=yw.of(this.rules.node.gameState.getScores())}hidePreviousMove(){this.moveds=[]}cancelMoveAttempt(){this.directions=[],this.selecteds=[]}showPreviousMove(){const e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}showPushingMove(e){const t=this.rules.node.mother.get().gameState;let n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}showSideStepMove(e){let t=e.lastPiece.get();const n=e.coord.getDirectionToward(t).get();t=t.getNext(n);let r=e.coord;for(;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}onPieceClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#piece_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=n.rules.node.gameState.getCurrentOpponent();return n.hexaBoard[t][e].is(i)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t)})()}opponentClick(e,t){var n=this;return hw(function*(){return(yield n.tryChoosingDirection(e,t)).isSuccess()?FG.SUCCESS:n.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE())})()}firstClick(e,t){var n=this;return hw(function*(){return n.selecteds=[new nQ(e,t)],n.showPossibleDirections(),FG.SUCCESS})()}showPossibleDirections(){this.directions=[],this.showDirection(1===this.selecteds.length)}showDirection(e){const t=this.rules.node.gameState,n=sQ.ofPlayer(t.getCurrentPlayer()),r=this.selecteds[0],i=this.selecteds[this.selecteds.length-1];for(const s of oQ.factory.all){let o,a=r.getNext(s,1);if(t.isOnBoard(a)&&t.getPieceAt(a)===n){if(e)continue;if(a=i.getNext(s,1),t.isOnBoard(a)&&t.getPieceAt(a)===n)continue}if(o=e?EQ.fromSingleCoord(r,s).get():EQ.fromDoubleCoord(r,i,s).get(),this.rules.isLegal(o,t).isSuccess()){const e=this.getCenterAt(r),t=this.getCenterAt(a),n=this.getMiddleOfArrow(s,a,t),i=t.x+" "+t.y,o=oQ.getAngle(s)+150,l=new KQ(e,n,t,a,s,"rotate("+o+" "+i+") translate("+i+")");this.directions.push(l)}}}getMiddleOfArrow(e,t,n){const r=t.getPrevious(e),i=this.getCenterAt(r);return new nQ(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}isBoard(e){return e!==sQ.UNREACHABLE}isPiece(e){return e!==sQ.EMPTY}secondClick(e,t){var n=this;return hw(function*(){const r=n.selecteds[0],i=new nQ(e,t);if(i.equals(r))return n.cancelMoveAttempt(),FG.SUCCESS;if(!1===i.isHexagonallyAlignedWith(r))return n.cancelMoveAttempt(),n.firstClick(e,t);const s=i.getDistance(r);if(s>2)return n.cancelMove(kQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES());const o=r.getDirectionToward(i).get();n.selecteds=[r];for(let e=0;e<s;e++)n.selecteds.push(r.getNext(o,e+1));if(3===n.selecteds.length){const r=n.selecteds[1],i=n.rules.node.gameState.getCurrentPlayer();if(!1===n.hexaBoard[r.y][r.x].is(i))return n.cancelMoveAttempt(),n.firstClick(e,t)}return n.showPossibleDirections(),FG.SUCCESS})()}thirdClick(e,t){var n=this;return hw(function*(){const r=new nQ(e,t),i=n.selecteds[0];if(r.equals(i))return n.deselectExtremity(!0);const s=n.selecteds[n.selecteds.length-1];return r.equals(s)?n.deselectExtremity(!1):3===n.selecteds.length&&r.equals(n.selecteds[1])?(n.cancelMoveAttempt(),FG.SUCCESS):n.tryExtension(r,i,s)})()}tryExtension(e,t,n){var r=this;return hw(function*(){const i=eQ.factory.fromMove(t,e);if(i.isSuccess()){const s=eQ.factory.fromMove(n,e);if(i.equals(s)){const i=t.getDistance(e),s=n.getDistance(e);return 2===Math.max(i,s)?(r.selecteds.push(e),eK.sortByDescending(r.selecteds,EQ.sortCoord),r.showPossibleDirections(),FG.SUCCESS):r.cancelMove(kQ.CANNOT_MOVE_MORE_THAN_THREE_PIECES())}}const s=r.cancelMove(kQ.LINE_AND_COORD_NOT_ALIGNED());return yield r.firstClick(e.x,e.y),s})()}deselectExtremity(e){var t=this;return hw(function*(){return t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),FG.SUCCESS})()}chooseDirection(e){var t=this;return hw(function*(){const n=t.canUserPlay("#direction_"+e.toString());return n.isFailure()?t.cancelMove(n.getReason()):t._chooseDirection(e)})()}_chooseDirection(e){var t=this;return hw(function*(){const n=t.rules.node.gameState;let r;const i=t.selecteds[0];return r=1===t.selecteds.length?EQ.fromSingleCoord(i,e).get():EQ.fromDoubleCoord(i,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(r,n,t.scores.get())})()}onCaseClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#case_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.tryChoosingDirection(e,t)})()}tryChoosingDirection(e,t){var n=this;return hw(function*(){const r=new nQ(e,t);for(const e of n.directions)if(e.landing.equals(r))return n._chooseDirection(e.dir);return FG.failure("not a direction")})()}getSquareClasses(e,t){const n=new nQ(e,t),r=[];return this.moveds.some(e=>e.equals(n))&&r.push("moved"),r}getPieceClasses(e,t){const n=new nQ(e,t),r=YY.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(e=>e.equals(n))&&i.push("highlighted"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-abalone"]],features:[Go],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,jQ,2,1,"g",1),pa(2,"defs"),la(3,ZQ,2,1,"marker",2),fa(),la(4,YQ,4,12,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.hexaBoard),Ts(2),ha("ngForOf",t.directions),Ts(1),ha("ngForOf",t.directions))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class QQ{constructor(e){this.x=e}static from(e){switch(e){case 0:return QQ.ZERO;case 1:return QQ.ONE;case 2:return QQ.TWO;default:return zG(3===e,"Invalid Apagos Coord "+e),QQ.THREE}}equals(e){return this.x===e.x}}QQ.ZERO=new QQ(0),QQ.ONE=new QQ(1),QQ.TWO=new QQ(2),QQ.THREE=new QQ(3);let XQ=(()=>{class e{}return e.PIECE_SHOULD_MOVE_DOWNWARD=()=>$localize`Pieces should only move downward!`,e.CANNOT_LAND_ON_A_FULL_SQUARE=()=>$localize`That square is already full, you cannot put a piece in it!`,e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=()=>$localize`You have no pieces in that square, select one that contains at least one of your pieces!`,e.NO_PIECE_REMAINING_TO_DROP=()=>$localize`There are no remaining pieces of that color to drop!`,e.NO_POSSIBLE_TRANSFER_REMAINS=()=>$localize`There is no possible transfer from that square!`,e})();class eX extends _Q{constructor(e,t,n){super(),this.landing=e,this.piece=t,this.starting=n}static drop(e,t){return dw.getNonNullable(eX.ALL_MOVES.find(n=>n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(yw.empty())))}static transfer(e,t){if(e.x<=t.x)return RG.failure(XQ.PIECE_SHOULD_MOVE_DOWNWARD());const n=dw.getNonNullable(eX.ALL_MOVES.find(n=>n.landing.equals(t)&&n.piece.equals(yw.empty())&&n.starting.equals(yw.of(e))));return RG.success(n)}isDrop(){return this.piece.isPresent()}toString(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}equals(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}eX.ALL_MOVES=[new eX(QQ.ZERO,yw.of(YY.ZERO),yw.empty()),new eX(QQ.ONE,yw.of(YY.ZERO),yw.empty()),new eX(QQ.TWO,yw.of(YY.ZERO),yw.empty()),new eX(QQ.THREE,yw.of(YY.ZERO),yw.empty()),new eX(QQ.ZERO,yw.of(YY.ONE),yw.empty()),new eX(QQ.ONE,yw.of(YY.ONE),yw.empty()),new eX(QQ.TWO,yw.of(YY.ONE),yw.empty()),new eX(QQ.THREE,yw.of(YY.ONE),yw.empty()),new eX(QQ.TWO,yw.empty(),yw.of(QQ.THREE)),new eX(QQ.ONE,yw.empty(),yw.of(QQ.THREE)),new eX(QQ.ZERO,yw.empty(),yw.of(QQ.THREE)),new eX(QQ.ONE,yw.empty(),yw.of(QQ.TWO)),new eX(QQ.ZERO,yw.empty(),yw.of(QQ.TWO)),new eX(QQ.ZERO,yw.empty(),yw.of(QQ.ONE))],eX.encoder=new class extends jY{maxValue(){return eX.ALL_MOVES.length}encodeNumber(e){const t=eX.ALL_MOVES.findIndex(t=>t.equals(e));return zG(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}decodeNumber(e){return zG(e<eX.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),eX.ALL_MOVES[e]}};class tX{constructor(e){this.containing=e}static from(e,t,n){if(e+t>n)return RG.failure("invalid starting space");const r=new SQ;r.set(YY.ZERO,e),r.set(YY.ONE,t),r.set(KY.NONE,n),r.makeImmutable();const i=new tX(r);return RG.success(i)}isFull(){return this.count(YY.ZERO)+this.count(YY.ONE)>=this.count(KY.NONE)}count(e){return this.containing.get(e).get()}addPiece(e){let t=this.count(YY.ZERO),n=this.count(YY.ONE);const r=this.count(KY.NONE);return e===YY.ZERO?t++:n++,tX.from(t,n,r).get()}substractPiece(e){let t=this.count(YY.ZERO),n=this.count(YY.ONE);const r=this.count(KY.NONE);return e===YY.ZERO?t--:n--,tX.from(t,n,r).get()}getDominatingPlayer(){const e=this.count(YY.ZERO),t=this.count(YY.ONE);return e>t?YY.ZERO:t>e?YY.ONE:KY.NONE}equals(e){return this.containing.equals(e.containing)}}let nX=(()=>{class e extends mQ{constructor(e,t,n){super(e),this.board=t,this.remaining=n,this.remaining.makeImmutable()}static getInitialState(){return e.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}static fromRepresentation(t,n,r,i){const s=[];for(let e=0;e<4;e++){const t=tX.from(n[0][e],n[1][e],n[2][e]).get();s.push(t)}const o=new SQ;return o.set(YY.ZERO,r),o.set(YY.ONE,i),new e(t,s,o)}getPieceAt(e){return this.board[e.x]}updateAt(t,n){const r=[];for(let e=0;e<4;e++)r.push(t.x===e?n:this.board[e]);const i=this.getRemainingCopy();return new e(this.turn,r,i)}getRemainingCopy(){return this.remaining.getCopy()}getRemaining(e){return this.remaining.get(e).get()}equals(e){return this.turn===e.turn&&eK.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}return e.PIECES_PER_PLAYER=10,e})();class rX extends IQ{static get(){return rX.singleton.isAbsent()&&(rX.singleton=yw.of(new rX(nX))),this.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}applyLegalDrop(e,t){const n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);const i=new nX(t.turn+1,t.board,n),s=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(s);if(e.landing===QQ.THREE)return i.updateAt(e.landing,o);{const t=QQ.from(e.landing.x+1),n=i.getPieceAt(t);return i.updateAt(e.landing,n).updateAt(t,o)}}applyLegalTransfer(e,t){const n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),s=t.getPieceAt(e.landing).addPiece(n);let o=t.updateAt(r,i);return o=o.updateAt(e.landing,s),new nX(o.turn+1,o.board,o.remaining)}isLegal(e,t){return t.getPieceAt(e.landing).isFull()?RG.failure(XQ.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}isLegalDrop(e,t){return t.getRemaining(e.piece.get())<=0?RG.failure(XQ.NO_PIECE_REMAINING_TO_DROP()):RG.success(void 0)}isLegalSlideDown(e,t){const n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?RG.failure(XQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):RG.success(void 0)}getGameStatus(e){const t=e.gameState;for(let r=0;r<4;r++)if(!1===t.getPieceAt(QQ.from(r)).isFull())return TQ.ONGOING;const n=t.getPieceAt(QQ.THREE).getDominatingPlayer();return zG(n.isPlayer(),"winner can only be a player if the game is finished"),TQ.getVictory(n)}}rX.singleton=yw.empty();class iX extends dQ{getListMoves(e){const t=e.gameState;return eX.ALL_MOVES.filter(function(e){return rX.get().isLegal(e,t).isSuccess()})}getBoardValue(e){const t=rX.get().getGameStatus(e);if(t.isEndGame)return pQ.fromWinner(t.winner);const n=e.gameState.board[3].getDominatingPlayer();return n.isPlayer()?new pQ(n.getScoreModifier()):new pQ(0)}}class sX{constructor(){this.tutorial=[NQ.informational($localize`Initial board and goal of the game`,$localize`At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!`,nX.getInitialState()),NQ.anyMove($localize`Drop`,$localize`There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You play Light.<br/><br/>Drop a piece on one of those three squares.`,nX.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),eX.drop(QQ.ZERO,YY.ZERO),$localize`Congratulations!`),NQ.fromPredicate($localize`Transfer`,$localize`The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!`,nX.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),eX.transfer(QQ.TWO,QQ.ZERO).get(),(e,t)=>e.isDrop()?FG.failure($localize`This move is a drop, please do a transfer!`):FG.SUCCESS,$localize`Congratulations!`),NQ.fromPredicate($localize`Victory`,$localize`When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!`,nX.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),eX.drop(QQ.TWO,YY.ONE),(e,t)=>e.isDrop()?e.piece.equalsValue(YY.ONE)?FG.SUCCESS:FG.failure($localize`You actively made your opponent win!`):FG.failure($localize`Wrong choice, your opponent will win in the next turn no matter which piece is dropped!`),$localize`Congratulations!`)]}}function oX(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=t.$implicit,n=ba();ra("cx",(e+1)*n.PIECE_RADIUS)("cy",n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function aX(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.PlayerOrNone.ZERO)}),fa()}if(2&e){const e=ba().index,t=ba();Ta("id","dropArrow_zero_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ZERO)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ZERO))}}function lX(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba();return n.onArrowClick(t,n.PlayerOrNone.ONE)}),fa()}if(2&e){const e=ba().index,t=ba();Ta("id","dropArrow_one_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ONE)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ONE))}}function cX(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",8),Ea("click",function(){Gt(e);const t=ba().index;return ba().onSquareClick(t)}),fa(),ya()}if(2&e){const e=t.$implicit,n=ba(),r=n.index,i=n.$implicit,s=ba();Ts(1),ka("id","square_",r,"_piece_",e,"_out_of_",i.count(s.PlayerOrNone.NONE),""),ha("ngClass",s.getPieceClasses(r,e,i)),ra("cx",s.getCircleCenter(r,e,i).x)("cy",s.getCircleCenter(r,e,i).y)}}function uX(e,t){if(1&e){const e=va();Cn(),ma(0),la(1,aX,1,4,"polygon",6),la(2,lX,1,4,"polygon",6),pa(3,"rect",7),Ea("click",function(){const t=Gt(e).index;return ba().onSquareClick(t)}),fa(),la(4,cX,2,6,"ng-container",3),ya()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ZERO)),Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ONE)),Ts(1),Ta("id","square_",n,""),ha("ngClass",r.getSquareClasses(n)),ra("x",n*r.SPACE_SIZE)("y",(5-n)*r.SPACE_SIZE*.25)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngForOf",r.range(e.count(r.PlayerOrNone.NONE)))}}function hX(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=t.$implicit,n=ba();ra("cx",4*n.SPACE_SIZE-(e+1)*n.PIECE_RADIUS)("cy",2.25*n.SPACE_SIZE+3*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}let dX=(()=>{class e extends rQ{constructor(t){super(t),this.PlayerOrNone=KY,this.ARROW_COORD=e.getArrowCoord(),this.PIECES_PER_PLAYER=nX.PIECES_PER_PLAYER,this.selectedPiece=yw.empty(),this.leftPiece=yw.empty(),this.droppedPiece=yw.empty(),this.displayableArrow=[],this.rules=new rX(nX),this.availableMinimaxes=[new iX(this.rules,"ApagosDummyMinimax")],this.encoder=eX.encoder,this.tutorial=(new sX).tutorial,this.PIECE_RADIUS=200/(this.PIECES_PER_PLAYER+1),this.updateBoard()}static getArrowCoord(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}cancelMoveAttempt(){this.selectedPiece=yw.empty(),this.showPossibleDrops()}updateBoard(){const e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(YY.ZERO).get(),this.remainingOne=e.remaining.get(YY.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}hideLastMove(){this.movedSquare=[],this.droppedPiece=yw.empty(),this.leftPiece=yw.empty(),this.selectedPiece=yw.empty()}showLastMove(){const e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}showLastDrop(e){const t=e.piece.get();let n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));const r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=yw.of({square:n,piece:r})}getLowestPlayerPiece(e,t){const n=e.count(t);return t===YY.ZERO?n-1:e.count(KY.NONE)-n}showLastTransfer(e){const t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=yw.of({square:r,piece:i});const s=e.landing.x,o=this.getLowestPlayerPiece(this.board[s],n);this.droppedPiece=yw.of({square:s,piece:o})}showPossibleDrops(){this.displayableArrow=[];const e=this.rules.node.gameState;for(let t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(YY.ZERO).get()>0&&this.displayableArrow.push({x:t,player:YY.ZERO}),e.remaining.get(YY.ONE).get()>0&&this.displayableArrow.push({x:t,player:YY.ONE}))}getCircleCenter(e,t,n){const r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(KY.NONE))return new nQ(r,i);const s=n.count(KY.NONE),o=2*t*Math.PI/s-Math.PI/2,a=.3*this.SPACE_SIZE,l=a*Math.cos(o),c=a*Math.sin(o);return new nQ(r+l,i+c)}canDisplayArrow(e,t){return this.displayableArrow.some(n=>n.x===e&&n.player.equals(t))}getArrowClasses(e,t){return[this.getPlayerClass(t)]}getArrowTransform(e,t){let n=t===YY.ZERO?0:.5*this.SPACE_SIZE;return n+=e*this.SPACE_SIZE,"translate("+n+", "+(3-e)*this.SPACE_SIZE*.25+")"}getSquareClasses(e){const t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}onArrowClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#dropArrow_"+(t===YY.ZERO?"zero":"one")+"_"+e);if(r.isFailure())return n.cancelMove(r.getReason());const i=QQ.from(e);let s;if(n.selectedPiece.isPresent()){const e=n.selectedPiece.get().square;s=eX.transfer(QQ.from(e),i).get()}else s=eX.drop(i,t);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e,t,n){const r={square:e,piece:t},i=[];let s=n.count(YY.ZERO),o=n.count(YY.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===YY.ZERO?s++:o++}const a=n.count(KY.NONE)-(o+s),l=this.getPieceColor(t,s,a);return""!==l&&i.push(l),i}getPieceColor(e,t,n){return e<t?"player0":e>=t+n?"player1":""}onSquareClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#square_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.selectedPiece.isPresent()&&t.selectedPiece.get().square===e)return t.cancelMoveAttempt(),FG.SUCCESS;const r=t.rules.node.gameState.getCurrentPlayer(),i=t.board[e];return i.count(r)<=0?t.cancelMove(XQ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=yw.of({square:e,piece:t.getLowestPlayerPiece(i,r)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(XQ.NO_POSSIBLE_TRANSFER_REMAINS()):FG.SUCCESS)})()}showAndGetPossibleTranfers(){this.displayableArrow=[];let e=this.selectedPiece.get().square-1;const t=this.rules.node.gameState.getCurrentPlayer();for(;0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-apagos"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,oX,1,3,"circle",1),pa(2,"g",2),la(3,uX,5,9,"ng-container",3),fa(),la(4,hX,1,3,"circle",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.range(t.remainingZero)),Ts(1),ra("transform","translate(0, "+2*t.PIECE_RADIUS+")"),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.range(t.remainingOne)))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),pX=(()=>{class e extends rQ{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class fX extends yQ{constructor(e,t,n){super(e,t),this.captured=n}static getInitialState(){const e=eK.createTable(6,2,4);return new fX(e,0,[0,0])}getCapturedCopy(){return[this.captured[0],this.captured[1]]}}let gX=(()=>{class e{}return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=()=>$localize`You cannot distribute from the opponent's home.`,e.MUST_CHOOSE_NONEMPTY_HOUSE=()=>$localize`You should choose a non-empty house to distribute.`,e.SHOULD_DISTRIBUTE=()=>$localize`You should distribute but you do not.`,e})(),mX=(()=>{class e extends IQ{applyLegalMove(t,n,r){pw(e.VERBOSE,{called:"AwaleRules.applyLegalMove",move:t,state:n});const i=t.x,s=n.getCurrentPlayer().value,o=n.getCurrentPlayer().getOpponent().value;let a=n.getCopiedBoard();const l=e.distribute(i,s,a);if(l.y===s)return new fX(a,n.turn+1,n.captured);{let t=[0,0];const r=eK.copyBiArray(a);return t[s]=e.capture(l.x,o,s,a),t[s]>0&&e.isStarving(o,a)&&(a=r,t=[0,0]),e.isStarving(s,a)&&!1===e.canDistribute(o,a)&&(t[o]+=e.mansoon(o,a)),t[0]+=n.captured[0],t[1]+=n.captured[1],new fX(a,n.turn+1,t)}}static mansoon(e,t){let n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}static isLegal(t,n){const r=n.getCurrentPlayer().value,i=n.getCurrentPlayer().getOpponent().value,s=t.x;if(0===n.getPieceAtXY(s,r))return RG.failure(gX.MUST_CHOOSE_NONEMPTY_HOUSE());const o=e.isStarving(i,n.board),a=!1===e.doesDistribute(s,r,n.board);return o&&a?RG.failure(gX.SHOULD_DISTRIBUTE()):RG.success(void 0)}isLegal(t,n){return e.isLegal(t,n)}static doesDistribute(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}static canDistribute(t,n){for(let r=0;r<6;r++)if(e.doesDistribute(r++,t,n))return!0;return!1}static isStarving(e,t){let n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}static distribute(e,t,n){const r=e,i=t;let s=n[t][e];for(n[t][e]=0;s>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,s--);return new nQ(e,t)}static capture(e,t,n,r){zG(t!==n,"AwaleRules.capture called with wrong values of x and player");let i=r[t][e];if(i<2||i>3)return 0;let s=0,o=-1,a=-1;0===n&&(o=1,a=6);do{s+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==a&&(2===i||3===i));return s}static getGameStatus(e){const t=e.gameState;return t.captured[0]>24?TQ.ZERO_WON:t.captured[1]>24?TQ.ONE_WON:24===t.captured[0]&&24===t.captured[1]?TQ.DRAW:TQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class yX extends _Q{constructor(e){super(),this.x=e}static from(e){switch(e){case 0:return yX.ZERO;case 1:return yX.ONE;case 2:return yX.TWO;case 3:return yX.THREE;case 4:return yX.FOUR;default:return zG(5===e,"Invalid x for AwaleMove: "+e),yX.FIVE}}equals(e){return e===this||e.x===this.x}toString(){return"AwaleMove("+this.x+")"}}yX.ZERO=new yX(0),yX.ONE=new yX(1),yX.TWO=new yX(2),yX.THREE=new yX(3),yX.FOUR=new yX(4),yX.FIVE=new yX(5),yX.encoder=new class extends jY{maxValue(){return 5}encodeNumber(e){return e.x}decodeNumber(e){return yX.from(e)}};class vX extends dQ{getListMoves(e){const t=[],n=e.gameState,r=n.turn%2;let i,s=0;do{0!==n.getPieceAtXY(s,r)&&(i=yX.from(s),mX.isLegal(i,n).isSuccess()&&(i=yX.from(s),t.push(i))),s++}while(s<6);return this.orderMoves(e,t)}orderMoves(e,t){const n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return eK.sortByDescending(t,t=>{const i=e.gameState.getCopiedBoard(),s=i[n][t.x],o=mX.distribute(t.x,n,i);let a,l=0;return o.y===n?(a=0,s<=6&&(l=10)):a=mX.capture(o.x,r,n,i),100*a+l-s}),t}getBoardValue(e){const t=mX.getGameStatus(e);if(t.isEndGame)return pQ.fromWinner(t.winner);const n=e.gameState.getCapturedCopy();return new pQ(n[1]-n[0])}}class _X{constructor(){this.tutorial=[NQ.anyMove($localize`Sowing`,$localize`Awal is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.
         Let's see how seeds are sown.
         As you're playing first, the 6 houses on the top are yours.<br/><br>
         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house.`,fX.getInitialState(),yX.ZERO,$localize`Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.
        This is how seeds are sown:
        one by one from the house next to the one they come from, clockwise.`),NQ.anyMove($localize`Big sowing`,$localize`You are now the second player (on the bottom).
        When there are enough seeds to make a full turn, something else happens.<br/><br/>
        Sow the house that contains 12 seeds.`,new fX([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),yX.ONE,$localize`See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds).`),NQ.fromMove($localize`Simple capture`,$localize`After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.
         Then, the player looks at the preceding house:
         if it is still in the opponent's side and contains two or three seeds, they are also captured.
         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>
         You are the second player, try to capture some pieces!`,new fX([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[yX.ZERO],$localize`Well done! This was a simple capture, now let us see how to make multiple captures.`,$localize`Failed. Try again and sow from the leftmost house.`),NQ.fromMove($localize`Multiple captures`,$localize`By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.
        As these are consecutive houses, all seeds in them will be captured.<br/><br/>
        Capture them.`,new fX([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[yX.ZERO],$localize`Nice, you win 3 points from the first house, and 2 from the second!`,$localize`Failed. Try again.`),NQ.fromMove($localize`Interrupted capture`,$localize`By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>
        Do it.`,new fX([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[yX.ZERO],$localize`Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house.`,$localize`Failed. Try again.`),NQ.fromMove($localize`Capture on the other side only`,$localize`Try to capture the two leftmost houses of the opponent.`,new fX([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[yX.ONE],$localize`Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!`,$localize`You have only captured one house, try again!`),NQ.fromMove($localize`Do not starve`,$localize`You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>
        Try it.`,new fX([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[yX.ZERO],$localize`Sadly, you cannot capture here, otherwise the opponent could not play after you.
        When this happens, the move can be made, but no capture takes place!`,$localize`Failed. Try again.`),NQ.anyMove($localize`Feeding is mandatory`,$localize`You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>
        Go ahead!`,new fX([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),yX.THREE,$localize`Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.
        It is often a good way to have easy captures!`),NQ.anyMove($localize`End of the game`,$localize`A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>
         Sow the house on the top right.`,new fX([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),yX.FIVE,$localize`Also, as soon as on player cannot play, the other player captures all the seeds in its own side.
         Here, it was the first player's turn, and the second player has taken all the remaining seeds.`)]}}function CX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"text",5),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),Fa(3),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("cx",50+100*n)("cy",50+120*r),Ts(1),ra("x",50+100*n)("y",66+120*r),Ts(1),Ba(" ",e," ")}}function EX(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,CX,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let wX=(()=>{class e extends pX{constructor(e){super(e),this.last=yw.empty(),this.captured=[],this.moved=[],this.scores=yw.of([0,0]),this.rules=new mX(fX),this.availableMinimaxes=[new vX(this.rules,"AwaleMinimax")],this.encoder=yX.encoder,this.tutorial=(new _X).tutorial,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState;this.scores=yw.of(e.getCapturedCopy()),this.hidePreviousMove();const t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){const n=e.getCurrentOpponent().value;this.last=yw.of(new nQ(t.get().x,n)),this.showPreviousMove()}else this.last=yw.empty()}hidePreviousMove(){this.captured=[],this.moved=[]}showPreviousMove(){const e=this.rules.node.mother.get().gameState;for(let t=0;t<=1;t++)for(let n=0;n<=5;n++){const r=new nQ(n,t),i=this.board[t][n],s=e.getPieceAt(r);this.last.equalsValue(r)||(i<s?this.captured.push(r):i>s&&this.moved.push(r))}}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(t!==n.rules.node.gameState.getCurrentPlayer().value)return n.cancelMove(gX.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME());n.last=yw.empty();const i=yX.from(e);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}getSquareClasses(e,t){const n=new nQ(e,t);return this.captured.some(e=>e.equals(n))?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(e=>e.equals(n))?["moved"]:[]}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-awale-component"]],features:[Go],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,EX,2,1,"g",2),ga(3,"line",3),fa()),2&e&&(Ts(2),ha("ngForOf",t.board))},directives:[$d,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class SX extends CQ{constructor(e,t){if(super(e.x,e.y),e.equals(t))throw new Error(hQ.MOVE_CANNOT_BE_STATIC());this.end=t}static getEncoder(e,t,n){return new class extends jY{constructor(){super(...arguments),this.shiftAX=t,this.shiftDY=this.shiftAX*e,this.shiftDX=this.shiftDY*t}maxValue(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}decodeNumber(r){const i=r%t;r/=t;const s=new nQ((r-=r%1)%e,i);r/=e;const o=(r-=r%1)%t;r/=t;const a=new nQ((r-=r%1)%e,o);return n(a,s)}}}length(){return this.coord.getDistance(this.end)}getDirection(){return eQ.factory.fromMove(this.coord,this.end)}}let bX=(()=>{class e{}return e.LANDING_ON_OCCUPIED_CASE=()=>$localize`You cannot land on an occupied square.`,e.THRONE_IS_LEFT_FOR_GOOD=()=>$localize`Once you left the central throne, you cannot return to it.`,e.SOLDIERS_CANNOT_SIT_ON_THRONE=()=>$localize`Soldiers cannot sit on the throne.`,e.SOMETHING_IN_THE_WAY=()=>$localize`Something is in the way.`,e.MOVE_MUST_BE_ORTHOGONAL=()=>$localize`Tafl moves must be orthogonal.`,e})();class PX extends SX{constructor(e,t){if(super(e,t),e.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(t.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+t.toString()+".");const n=e.getDirectionToward(t);if(n.isFailure()||n.get().isDiagonal())throw new Error(bX.MOVE_MUST_BE_ORTHOGONAL())}equals(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"TaflMove("+this.coord+"->"+this.end+")"}}class OX extends PX{static of(e,t){return new OX(e,t)}static from(e,t){try{const n=new OX(e,t);return RG.success(n)}catch(n){return RG.failure(n.message)}}getMaximalDistance(){return 7}}OX.encoder=SX.getEncoder(7,7,OX.of);const TX={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:YY.ZERO};class IX{constructor(e,t){this.owner=e,this.king=t}isKing(){return this.king}getOwner(){return this.owner}}IX.UNOCCUPIED=new IX(KY.NONE,!1),IX.PLAYER_ONE_KING=new IX(YY.ONE,!0),IX.INVADERS=new IX(YY.ZERO,!1),IX.DEFENDERS=new IX(YY.ONE,!1);class kX{constructor(e){this.value=e}}kX.NONE=new kX("NONE"),kX.OPPONENT=new kX("OPPONENT"),kX.PLAYER=new kX("PLAYER");class AX extends yQ{isCentralThrone(e){return e.equals(this.getCentralThrone())}getCentralThrone(){const e=(this.board.length-1)/2;return new nQ(e,e)}getRelativeOwner(e,t){const n=this.getAbsoluteOwner(t);let r;return r=n===KY.NONE?kX.NONE:e===n?kX.PLAYER:kX.OPPONENT,r}getAbsoluteOwner(e){return this.getPieceAt(e).getOwner()}}class MX extends AX{static getInitialState(){const e=IX.UNOCCUPIED,t=IX.INVADERS,n=IX.DEFENDERS;return new MX([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,n,e,e,e],[t,t,n,IX.PLAYER_ONE_KING,n,t,t],[e,e,e,n,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}from(e,t){return new MX(e,t)}}let NX=(()=>{class e extends IQ{constructor(e,t,n){super(e),this.config=t,this.generateMove=n}isLegal(t,n){pw(e.VERBOSE,{tablutRules_isLegal:{move:t,state:n}});const r=n.getCurrentPlayer(),i=this.getMoveValidity(r,t,n);return i.isFailure()?RG.failure(i.getReason()):RG.success(void 0)}getMoveValidity(e,t,n){const r=n.getRelativeOwner(e,t.coord);if(r===kX.NONE)return FG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE());if(r===kX.OPPONENT)return FG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==kX.NONE)return FG.failure(bX.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return FG.failure(bX.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return FG.failure(bX.THRONE_IS_LEFT_FOR_GOOD())}const i=t.coord.getDirectionToward(t.end).get(),s=t.coord.getOrthogonalDistance(t.end);let o=t.coord.getNext(i);for(let a=1;a<s;a++){if(n.getPieceAt(o)!==IX.UNOCCUPIED)return FG.failure(bX.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return FG.SUCCESS}isThrone(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}isExternalThrone(e){const t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}tryCapture(e,t,n,r){const i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===kX.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):yw.empty()}captureKing(e,t,n,r){const i=t.getNext(n),{backCoord:s,back:o,backInRange:a,left:l,leftCoord:c,right:u,rightCoord:h}=this.getSurroundings(i,n,e,r);return!1===a?this.captureKingAgainstTheWall(l,u,i):o===kX.NONE&&this.isThrone(r,s)?this.captureKingAgainstThrone(s,i,l,u):o===kX.PLAYER?this.captureKingWithAtLeastASandwich(r,i,l,c,u,h):yw.empty()}getSurroundings(e,t,n,r){const i=e.getNext(t),s=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=s?r.getRelativeOwner(n,i):kX.NONE,a=e.getLeft(t),l=a.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,a):kX.NONE,c=e.getRight(t),u=c.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,c):kX.NONE;return{backCoord:i,back:o,backInRange:s,leftCoord:a,left:l,rightCoord:c,right:u}}captureKingAgainstTheWall(t,n,r){let i=t===kX.PLAYER?1:0;return i+=n===kX.PLAYER?1:0,2===i&&this.config.BORDER_CAN_SURROUND_KING?(pw(e.VERBOSE||!1,"king captured by 3 invaders against 1 border"),yw.of(r)):yw.empty()}captureKingAgainstThrone(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return yw.of(t)}else{const e=r===kX.PLAYER,i=n===kX.PLAYER||e;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&i)return yw.of(t)}return yw.empty()}capturePawn(t,n,r,i){const s=!1,o=n.getNext(r),a=o.getNext(r);let l=kX.NONE;return a.isInRange(this.config.WIDTH,this.config.WIDTH)&&(l=i.getRelativeOwner(t,a)),l===kX.NONE?!1===this.isThrone(i,a)?(pw(e.VERBOSE||s,"cannot capture a pawn without an ally; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),yw.empty()):(pw(e.VERBOSE||s,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),yw.of(o)):l===kX.PLAYER?(pw(e.VERBOSE||s,"pawn captured by 2 opponents; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),yw.of(o)):(pw(e.VERBOSE||s,"no captures; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),yw.empty())}captureKingWithAtLeastASandwich(t,n,r,i,s,o){if(!1===this.kingTouchCentralThrone(t,n)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return yw.of(n);const a=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,l=this.isThrone(t,i),c=r===kX.PLAYER||l&&a,u=this.isThrone(t,o);return c&&(s===kX.PLAYER||u&&a)?(pw(e.VERBOSE||!1,"king captured by 4 invaders"),yw.of(n)):yw.empty()}kingTouchCentralThrone(e,t){const n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}applyLegalMove(t,n){pw(e.VERBOSE,{TablutRules_applyLegalMove:{move:t,state:n}});const r=n.turn,i=n.getCopiedBoard(),s=n.getCurrentPlayer(),o=t.coord,a=t.end;i[a.y][a.x]=i[o.y][o.x],i[o.y][o.x]=IX.UNOCCUPIED;for(const e of tQ.ORTHOGONALS){const r=this.tryCapture(s,t.end,e,n);r.isPresent()&&(i[r.get().y][r.get().x]=IX.UNOCCUPIED)}return n.from(i,r+1)}getGameStatus(e){const t=this.getWinner(e.gameState);return t.isPresent()?TQ.getVictory(t.get()):TQ.ONGOING}getWinner(e){const t=!1,n=this.getKingCoord(e);if(n.isAbsent())return pw(t,"The king is dead, victory to invader"),yw.of(this.getInvader());const r=n.get();return this.isExternalThrone(r)?(pw(t,"The king escape, victory to defender"),yw.of(this.getDefender())):this.isPlayerImmobilized(YY.ZERO,e)?(pw(t,"Zero has no move, victory to one"),yw.of(YY.ONE)):this.isPlayerImmobilized(YY.ONE,e)?(pw(t,"One has no move, victory to zero"),yw.of(YY.ZERO)):(pw(t,"no victory"),yw.empty())}getKingCoord(t){pw(e.VERBOSE,{TablutRules_getKingCoord:{state:t,con:this.config}});for(let e=0;e<this.config.WIDTH;e++)for(let n=0;n<this.config.WIDTH;n++)if(t.getPieceAtXY(n,e).isKing())return yw.of(new nQ(n,e));return yw.empty()}getInvader(){return this.config.INVADER}getDefender(){return this.config.INVADER.getOpponent()}isPlayerImmobilized(e,t){return 0===this.getPlayerListMoves(e,t).length}getPlayerListMoves(t,n){const r=[],i=this.getPlayerListPawns(t,n);pw(e.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:t,state:n}});for(const e of i){const t=this.getPossibleDestinations(e,n);for(const n of t){const t=this.generateMove(e,n);r.push(t)}}return r}getPlayerListPawns(e,t){const n=[];for(let r=0;r<this.config.WIDTH;r++)for(let i=0;i<this.config.WIDTH;i++){const s=new nQ(i,r);t.getAbsoluteOwner(s)===e&&n.push(s)}return n}getPossibleDestinations(e,t){const n=[];let r;for(const i of tQ.ORTHOGONALS){r=e.getNext(i,1);let s=!1;for(;r.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(r)===KY.NONE?this.isExternalThrone(r)?t.getPieceAt(e).isKing()&&n.push(r):t.isCentralThrone(r)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&n.push(r):n.push(r):s=!0,r=r.getNext(i,1)}return n}}return e.VERBOSE=!1,e})();class xX extends NX{constructor(){super(MX,TX,OX.of)}static get(){return null==xX.singleton&&(xX.singleton=new xX),OQ.ruler=this.singleton,xX.singleton}}class RX extends pX{constructor(e,t,n){super(e),this.VERBOSE=t,this.generateMove=n,this.EMPTY=IX.UNOCCUPIED,this.captureds=[],this.chosen=new nQ(-1,-1),this.lastMove=yw.empty()}getViewBox(){const e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}updateBoard(){pw(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove()}showPreviousMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState.getCurrentOpponent();for(const n of tQ.ORTHOGONALS){const r=this.lastMove.get().end.getNext(n,1);if(r.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){const n=e.getRelativeOwner(t,r)===kX.OPPONENT,i=this.rules.node.gameState.getPieceAt(r)===IX.UNOCCUPIED;n&&i&&this.captureds.push(r)}}}onClick(e,t){var n=this;return hw(function*(){pw(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")");const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t)})()}chooseDestination(e,t){var n=this;return hw(function*(){pw(n.VERBOSE,"TaflComponent.chooseDestination");const r=n.chosen,i=new nQ(e,t),s=n.generateMove(r,i);return s.isSuccess()?(n.cancelMove(),yield n.chooseMove(s.get(),n.rules.node.gameState)):n.cancelMove(s.getReason())})()}choosePiece(e,t){return pw(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===IX.UNOCCUPIED?this.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new nQ(e,t),pw(this.VERBOSE,"selected piece = ("+e+", "+t+")"),FG.SUCCESS):this.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE())}pieceBelongToCurrentPlayer(e,t){const n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new nQ(e,t);return n.getRelativeOwner(r,i)===kX.PLAYER}cancelMoveAttempt(){this.chosen=new nQ(-1,-1)}isThrone(e,t){return this.rules.isThrone(this.rules.node.gameState,new nQ(e,t))}isCentralThrone(e,t){return!1===this.rules.node.gameState.isCentralThrone(new nQ(e,t))}getPieceClasses(e,t){const n=[],r=new nQ(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}getRectClasses(e,t){const n=[],r=new nQ(e,t);if(this.captureds.some(e=>e.equals(r)))n.push("captured");else if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;(r.equals(e)||r.equals(t))&&n.push("moved")}return n}getClickables(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new nQ(n,t));return e}isClickable(e,t){return this.pieceBelongToCurrentPlayer(e,t)}isInvader(e,t){return this.board[t][e]===IX.INVADERS}isKing(e,t){return this.board[t][e].isKing()}getKingPolyline(e,t){return 85+100*e+" "+(85+100*t)+" "+(30+100*e)+" "+(30+100*t)+" "+(50+100*e)+" "+(10+100*t)+" "+(70+100*e)+" "+(30+100*t)+" "+(15+100*e)+" "+(85+100*t)}}class DX extends dQ{getListMoves(e){pw(!1,{TaflMinimax_getListMoves:{node:e}});const t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}orderMoves(e,t){const n=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?eK.sortByDescending(t,e=>-e.end.getOrthogonalDistance(n)):eK.sortByDescending(t,e=>e.coord.equals(n)?this.ruler.isExternalThrone(e.end)?2:1:0),t}getBoardValue(e){const t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new pQ(n.get().getVictoryValue());const r=this.ruler.getPlayerListPawns(YY.ZERO,t).length,i=this.ruler.getPlayerListPawns(YY.ONE,t).length;let s=[1,2][this.ruler.config.INVADER.value];s*=YY.ZERO.getScoreModifier();let o=[2,1][this.ruler.config.INVADER.value];return o*=YY.ONE.getScoreModifier(),new pQ(r*s+i*o)}}class LX{constructor(e,t){this.directThreats=e,this.mover=t}equals(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}class FX extends LX{constructor(e,t){super(new gQ([e]),t),this.directThreat=e,this.mover=t}}class UX extends gQ{constructor(e){if(super(),this.map=[],this.values=[],void 0!==e)for(const t of e)this.add(t)}add(e){const t=this.toFields(e);let n=this.map;for(const i of t[0])void 0===n[i]&&(n[i]=[]),n=n[i];const r=t[1];return void 0===n[r]&&(n[r]=!0,this.values.push(e),!0)}contains(e){const t=this.toFields(e);let n=this.map;for(const r of t[0]){if(void 0===n[r])return!1;n=n[r]}return void 0!==n[t[1]]}[Symbol.iterator](){return this.values.values()}}class BX extends UX{toFields(e){return[[e.y],e.x]}}class VX extends DX{constructor(e,t){super(e,t),this.width=this.ruler.config.WIDTH,this.maxInfluence=16*(2*this.width-2),this.scoreByThreatenedPiece=16*this.maxInfluence+1,this.scoreBySafePiece=16*this.scoreByThreatenedPiece+1}getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState,r=IX.UNOCCUPIED;let i=0;const s=this.getPiecesMap(n),o=this.getThreatMap(n,s),a=this.filterThreatMap(o,n);for(const l of YY.PLAYERS)for(const e of s.get(l).get())if(a.get(e).isPresent())i+=l.getScoreModifier()*this.scoreByThreatenedPiece;else{i+=l.getScoreModifier()*this.scoreBySafePiece;let t=0;for(const i of tQ.ORTHOGONALS){let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&n.getPieceAt(s)===r;)t++,s=s.getNext(i,1)}i+=t*l.getScoreModifier()}return new pQ(i)}getPiecesMap(e){const t=IX.UNOCCUPIED,n=new SQ,r=[],i=[];for(let s=0;s<this.width;s++)for(let n=0;n<this.width;n++){const o=new nQ(n,s);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===YY.ZERO?r.push(o):i.push(o))}return n.set(YY.ZERO,new BX(r)),n.set(YY.ONE,new BX(i)),n}getThreatMap(e,t){const n=new SQ;for(const r of YY.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreats(i,e);this.isThreatReal(i,e,t)&&n.set(i,new gQ(t))}return n}getThreats(e,t){const n=t.getAbsoluteOwner(e);zG(n.isPlayer(),"TaflPieceAndInfluenceMinimax.getThreats should be called with an occupied coordinate");const r=n.getOpponent(),i=[];for(const s of tQ.ORTHOGONALS){const n=e.getPrevious(s,1);if(this.isAThreat(n,t,r)){const o=[];for(const n of tQ.ORTHOGONALS){if(n===s.getOpposite())continue;let i=e.getNext(s,1);for(;i.isInRange(this.width,this.width)&&t.getPieceAt(i)===IX.UNOCCUPIED;)i=i.getNext(n);i.isInRange(this.width,this.width)&&t.getAbsoluteOwner(i)===r&&!1===e.getNext(s,1).equals(i)&&o.push(i)}i.push(new FX(n,new BX(o)))}}return i}isAThreat(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==YY.ONE&&t.getPieceAt(e)!==IX.UNOCCUPIED))}isThreatReal(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;for(const r of n)if(r.mover.size()>0)return!0;return!1}filterThreatMap(e,t){const n=new SQ,r=e.listKeys(),i=r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentPlayer()),s=new BX(r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentOpponent()));for(const o of i){const t=e.get(o).get(),r=[];for(const e of t)if(!1===s.contains(e.directThreat)){const t=[];for(const n of e.mover)!1===s.contains(n)&&t.push(n);t.length>0&&r.push(new FX(e.directThreat,new BX(t)))}r.length>0&&n.set(o,new gQ(r))}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}class $X extends VX{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=IX.UNOCCUPIED;let s=0;const o=this.getPiecesMap(n),a=this.getThreatMap(n,o),l=this.filterThreatMap(a,n);for(const c of YY.PLAYERS){const e=new BX;for(const t of o.get(c).get())if(l.get(t).isPresent())s+=c.getScoreModifier()*$X.SCORE_BY_THREATENED_PIECE;else{s+=c.getScoreModifier()*$X.SCORE_BY_SAFE_PIECE;for(const s of tQ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=$X.CONTROL_VALUE[t.y][t.x];s+=c.getScoreModifier()*e}}return new pQ(s)}}$X.SCORE_BY_THREATENED_PIECE=530,$X.SCORE_BY_SAFE_PIECE=16*$X.SCORE_BY_THREATENED_PIECE+1,$X.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];class zX extends $X{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=IX.UNOCCUPIED;let s=0,o=0,a=0;const l=this.getPiecesMap(n),c=this.getThreatMap(n,l),u=this.filterThreatMap(c,n);for(const d of YY.PLAYERS){const e=new BX;for(const t of l.get(d).get())if(u.get(t).isPresent())o+=d.getScoreModifier();else{s+=d.getScoreModifier();for(const s of tQ.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=$X.CONTROL_VALUE[t.y][t.x];a+=d.getScoreModifier()*e}}const h=this.getStepForEscape(n);return new pQ(531*h*17*17+531*s*17+531*o+a)}getStepForEscape(e){const t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}_getStepForEscape(e,t,n,r){const i=this.getNextGen(e,n,r);return 0===i.length?yw.empty():i.some(e=>this.ruler.isExternalThrone(e))?yw.of(t):(t++,r.push(...i),this._getStepForEscape(e,t,i,r))}getNextGen(e,t,n){const r=[];for(const i of t)for(const t of tQ.ORTHOGONALS){let s=i.getNext(t,1);for(;s.isInRange(this.ruler.config.WIDTH,this.ruler.config.WIDTH)&&e.getPieceAt(s)===IX.UNOCCUPIED;)n.every(e=>!1===e.equals(s))&&r.push(s),s=s.getNext(t,1)}return r}}zX.SCORE_BY_THREATENED_PIECE=530,zX.SCORE_BY_SAFE_PIECE=16*$X.SCORE_BY_THREATENED_PIECE+1,zX.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];const HX=IX.UNOCCUPIED,GX=IX.INVADERS,qX=IX.DEFENDERS,WX=IX.PLAYER_ONE_KING;class jX{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne.`,MX.getInitialState()),NQ.anyMove($localize`Moving`,$localize`All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move.`,MX.getInitialState(),OX.of(new nQ(3,1),new nQ(1,1)),$localize`Congratulations!`),NQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new MX([[HX,HX,HX,GX,HX,HX,HX],[HX,HX,HX,GX,HX,HX,HX],[GX,HX,HX,qX,HX,HX,HX],[HX,HX,qX,WX,qX,GX,GX],[HX,HX,GX,HX,HX,HX,HX],[HX,HX,HX,qX,HX,GX,HX],[HX,HX,HX,GX,HX,HX,HX]],1),[OX.of(new nQ(3,5),new nQ(2,5))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),NQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new MX([[HX,HX,HX,GX,HX,HX,HX],[HX,HX,GX,HX,HX,HX,HX],[HX,HX,HX,qX,HX,HX,HX],[GX,qX,HX,HX,qX,GX,GX],[HX,qX,HX,HX,HX,HX,HX],[HX,GX,HX,WX,HX,GX,HX],[HX,HX,HX,GX,HX,HX,HX]],12),[OX.of(new nQ(2,1),new nQ(3,1)),OX.of(new nQ(3,0),new nQ(3,1))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),NQ.fromMove($localize`Capturing the king on his throne`,$localize`To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king.`,new MX([[HX,HX,HX,HX,HX,HX,HX],[HX,HX,HX,qX,HX,HX,HX],[HX,HX,HX,GX,HX,HX,HX],[HX,GX,HX,WX,GX,HX,HX],[HX,HX,HX,GX,HX,HX,HX],[HX,qX,HX,HX,HX,HX,HX],[HX,HX,HX,HX,HX,HX,HX]],72),[OX.of(new nQ(1,3),new nQ(2,3))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),NQ.fromMove($localize`Capturing the king next to his throne`,$localize`Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king.`,new MX([[HX,HX,GX,HX,HX,HX,HX],[HX,HX,HX,GX,HX,HX,HX],[HX,HX,HX,WX,GX,HX,HX],[HX,GX,qX,HX,qX,HX,HX],[HX,HX,HX,GX,HX,HX,HX],[HX,HX,HX,HX,HX,HX,HX],[HX,HX,HX,HX,HX,HX,HX]],72),[OX.of(new nQ(2,0),new nQ(2,2))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`),NQ.fromMove($localize`Capturing the king far from his throne`,$localize`When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king.`,new MX([[HX,HX,HX,HX,HX,HX,HX],[HX,HX,HX,HX,HX,HX,HX],[HX,GX,HX,GX,HX,HX,HX],[GX,HX,HX,HX,qX,HX,HX],[HX,HX,HX,qX,HX,HX,HX],[HX,HX,HX,HX,HX,HX,HX],[HX,WX,HX,GX,HX,HX,HX]],72),[OX.of(new nQ(3,6),new nQ(2,6))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function ZX(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",6),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function YX(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",7),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function KX(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,ZX,1,1,"polyline",4),la(2,YX,1,1,"ng-template",null,5,Lu),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function JX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(3,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(4,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(5,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function QX(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",13),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();Ts(1),ra("points",n.getKingPolyline(e,t))}}function XX(e,t){if(1&e){const e=va();Cn(),pa(0,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(1,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(3,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function e1(e,t){if(1&e&&(Cn(),la(0,QX,2,1,"g",9),la(1,XX,4,16,"ng-template",null,12,Lu)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ha("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function t1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",8),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,JX,6,20,"g",9),la(3,e1,3,2,"ng-template",null,10,Lu),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngClass",r.getPieceClasses(t,n)),ra("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function n1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,KX,4,2,"g",3),la(3,t1,5,6,"g",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function r1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,n1,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function i1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",14),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let s1=(()=>{class e extends RX{constructor(e){super(e,!1,OX.from),this.rules=xX.get(),this.availableMinimaxes=[new DX(this.rules,"DummyBot"),new VX(this.rules,"Piece > Influence"),new $X(this.rules,"Piece > Control"),new zX(this.rules,"Escape > Piece > Control")],this.encoder=OX.encoder,this.tutorial=(new jX).tutorial}ngOnInit(){this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-brandhub"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,r1,2,1,"g",1),la(2,i1,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[$d,Bd,Hd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),o1=(()=>{class e extends rQ{constructor(){super(...arguments),this.SPACE_SIZE=50}getTriangleCornerCoords(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}getTriangleCoordinate(e,t){return this.getTriangleCornerCoords(e,t).map(e=>e.x+","+e.y).reduce((e,t)=>e+","+t)}getDownwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new nQ(.5*this.SPACE_SIZE*e,i);return[o,new nQ(n,s),new nQ(r,i),o]}getUpwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new nQ(.5*this.SPACE_SIZE*e,s);return[o,new nQ(n,i),new nQ(r,s),o]}getPyramidCoordinate(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}getDownwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}getUpwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),a1=(()=>{class e{}return e.INVALID_DISTANCE=()=>$localize`Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is.`,e.NOT_ENOUGH_TILES_TO_EXCHANGE=()=>$localize`You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it.`,e.FIRST_CLICK_SHOULD_NOT_BE_NULL=()=>$localize`Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles.`,e.CANNOT_CAPTURE_FROM_EMPTY=()=>$localize`You cannot capture from an empty space.`,e.CANNOT_CAPTURE_OWN_PIECES=()=>$localize`You cannot capture your own pieces.`,e})();class l1{constructor(e,t){this.direction=e,this.str=t}static fromCoords(e,t){const n=e.getVectorToward(t),r=l1.STEPS.findIndex(e=>e.direction.equals(n));if(-1===r)throw new Error(a1.INVALID_DISTANCE());return l1.STEPS[r]}toInt(){return l1.STEPS.findIndex(e=>e.direction.equals(this.direction))}equals(e){return this===e}toString(){return this.str}}l1.LEFT=new l1(new JJ(-2,0),"LEFT"),l1.UP_LEFT=new l1(eQ.UP_LEFT,"UP_LEFT"),l1.UP_RIGHT=new l1(eQ.UP_RIGHT,"UP_RIGHT"),l1.RIGHT=new l1(new JJ(2,0),"RIGHT"),l1.DOWN_LEFT=new l1(eQ.DOWN_LEFT,"DOWN_LEFT"),l1.DOWN_RIGHT=new l1(eQ.DOWN_RIGHT,"DOWN_RIGHT"),l1.STEPS=[l1.LEFT,l1.UP_LEFT,l1.UP_RIGHT,l1.RIGHT,l1.DOWN_LEFT,l1.DOWN_RIGHT];class c1 extends _Q{constructor(e,t,n,r){super(),this.start=e,this.step=t,this.landingCoord=n,this.capture=r}static fromMovement(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");const n=new nQ(e.x+t.direction.x,e.y+t.direction.y);if(n.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new c1(yw.of(e),yw.of(t),yw.of(n),yw.empty())}static fromTilesExchange(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new c1(yw.empty(),yw.empty(),yw.empty(),yw.of(e))}static fromCoordToCoord(e,t){const n=l1.fromCoords(e,t);return c1.fromMovement(e,n)}isTileExchange(){return this.capture.isPresent()}toString(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}equals(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}c1.encoder=new class extends jY{maxValue(){return 1035}encodeNumber(e){if(e.isTileExchange()){const t=e.capture.get().y;return 10*e.capture.get().x+t}{const t=e.start.get().y,n=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*n+t}}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?c1.fromTilesExchange(new nQ(n,t)):c1.fromMovement(new nQ(n,t),l1.STEPS[e-1])}};class u1{static getNeighbors(e){let t;const n=new nQ(e.x-1,e.y),r=new nQ(e.x+1,e.y);return t=(e.x+e.y)%2==1?[n,r,new nQ(e.x,e.y-1)]:[n,r,new nQ(e.x,e.y+1)],t}static getFakeNeighbors(e){return new nQ(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}static getCommonNeighbor(e,t){const n=u1.getNeighbors(e),r=u1.getNeighbors(t);let i=0;for(;i<n.length;){const e=n[i];let t=0;for(;t<r.length;){if(e.equals(r[t]))return yw.of(e);t++}i++}return yw.empty()}}class h1 extends yQ{static getEmptyNeighbors(e,t,n){const r=[];for(const i of u1.getNeighbors(t))i.isInRange(e[0].length,e.length)&&e[i.y][i.x]===n&&r.push(i);return r}getEmptyNeighboors(e,t){return h1.getEmptyNeighbors(this.board,e,t)}}class d1 extends h1{constructor(e,t,n,r){super(e,t),this.tiles=n,this.captures=r}static getTilesUpperLeftCoord(e){const t=e.x-e.x%3;let n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new nQ(t,n)}static getPresentNeighboorEntrances(e){return[new nQ(e.x+1,e.y-1),new nQ(e.x+3,e.y+0),new nQ(e.x+3,e.y+1),new nQ(e.x+1,e.y+2),new nQ(e.x-1,e.y+1),new nQ(e.x-1,e.y+0)].filter(d1.isInRange)}static getInitialState(){const e=sQ.EMPTY,t=sQ.UNREACHABLE,n=sQ.ZERO,r=sQ.ONE;return new d1([[t,t,t,t,t,t,n,e,n,t,t,t,t,t,t],[t,t,t,e,e,n,e,e,e,n,e,e,t,t,t],[e,r,e,r,e,e,n,e,n,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[e,n,e,n,e,e,e,e,e,e,e,n,e,n,e],[n,e,e,e,n,e,e,e,e,e,n,e,e,e,n],[e,n,e,n,e,e,r,e,r,e,e,n,e,n,e],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t]],0,[0,0],[0,0])}applyLegalMovement(e){pw(d1.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});const t=e.start.get(),n=e.landingCoord.get(),r=this.getCopiedBoard();return r[n.y][n.x]=sQ.ofPlayer(this.getCurrentPlayer()),r[t.y][t.x]=sQ.EMPTY,new d1(r,this.turn,this.tiles,this.captures)}doMovementCaptures(e){pw(d1.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});const t=this.getCapturedNeighbors(e.landingCoord.get());let n=this;for(const r of t)n=n.capture(r);return n}getCapturedNeighbors(e){const t=this.getCurrentOpponent();return u1.getNeighbors(e).filter(e=>!e.isNotInRange(15,10)&&!!this.getPieceAt(e).is(t)&&this.isSurrounded(e))}isSurrounded(e){return 0===this.getEmptyNeighboors(e,sQ.EMPTY).length}capture(e){pw(d1.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});const t=this.getCopiedBoard(),n=[this.captures[0],this.captures[1]];return pw(d1.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=sQ.EMPTY,n[this.getCurrentPlayer().value]+=1,new d1(t,this.turn,this.tiles,n)}removeTilesIfNeeded(e,t){pw(d1.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});let n=this;const r=d1.getTilesUpperLeftCoord(e);if(this.isTileEmpty(r)&&this.isDeconnectable(r)){n=this.deconnectTile(r,t);const e=d1.getPresentNeighboorEntrances(r);for(const r of e){const e=n.getPieceAt(r);e===sQ.EMPTY?n=n.removeTilesIfNeeded(r,t):e.is(this.getCurrentOpponent())&&n.isSurrounded(r)&&(n=n.capture(r))}}return n}isTileEmpty(e){zG(this.getPieceAt(e)!==sQ.UNREACHABLE,"Should not call isTileEmpty on removed tile");for(let t=0;t<2;t++)for(let n=0;n<3;n++){const r=e.getNext(new JJ(n,t),1);if(this.getPieceAt(r)!==sQ.EMPTY)return!1}return!0}isDeconnectable(e){const t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;let n=0;for(let r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}areNeighboor(e,t){return e+1===t||0===e&&5===t}getPresentNeighboorTilesRelativeIndexes(e){const t=[];let n=yw.empty();for(let r=0;r<6;r++){const i=e.getNext(d1.NEIGHBOORS_TILES_DIRECTIONS[r],1);i.isInRange(15,10)&&this.getPieceAt(i)!==sQ.UNREACHABLE&&(n.isAbsent()&&(n=yw.of(r)),t.push(r-n.get()))}return t}deconnectTile(e,t){pw(d1.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});const n=this.getCopiedBoard(),r=e.x,i=e.y;for(let o=0;o<2;o++)for(let e=0;e<3;e++)n[i+o][r+e]=sQ.UNREACHABLE;const s=[this.tiles[0],this.tiles[1]];return t&&(s[this.getCurrentPlayer().value]+=1),new d1(n,this.turn,s,this.captures)}getLegalLandings(e){const t=[];for(const n of l1.STEPS){const r=e.getNext(n.direction,1);this.isOnBoard(r)&&this.getPieceAt(r)===sQ.EMPTY&&t.push(r)}return t}getPiecesByFreedom(){const e=[[0,0,0,0],[0,0,0,0]];for(let t=0;t<10;t++)for(let n=0;n<15;n++){const r=this.board[t][n];if(r.isPlayer()){const i=this.getEmptyNeighboors(new nQ(n,t),sQ.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}d1.VERBOSE=!1,d1.NEIGHBOORS_TILES_DIRECTIONS=[new JJ(0,-2),new JJ(3,-1),new JJ(3,1),new JJ(0,2),new JJ(-3,1),new JJ(-3,-1)],d1.isInRange=e=>e.isInRange(15,10);let p1=(()=>{class e extends IQ{applyLegalMove(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}applyLegalTileExchange(t,n){const r=n.getCopiedBoard(),i=t.capture.get();r[i.y][i.x]=sQ.EMPTY;const s=[n.captures[0],n.captures[1]];s[n.getCurrentPlayer().value]+=1;const o=[n.tiles[0],n.tiles[1]];o[n.getCurrentPlayer().value]-=2;const a=new d1(r,n.turn,o,s),l=a.removeTilesIfNeeded(i,!1),c=new d1(l.getCopiedBoard(),l.turn+1,l.tiles,l.captures);return pw(e.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:n,afterCapture:a,afterTileRemoval:l,resultingState:c}}),c}applyLegalMovement(t,n){const r=n.applyLegalMovement(t),i=r.removeTilesIfNeeded(t.start.get(),!0),s=i.doMovementCaptures(t),o=new d1(s.board,n.turn+1,s.tiles,s.captures);return pw(e.VERBOSE,{ab_state:n,afterMovement:r,afterTilesRemoved:i,afterCaptures:s,resultingState:o}),o}isLegal(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}isLegalTileExchange(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return RG.failure(a1.NOT_ENOUGH_TILES_TO_EXCHANGE());const n=t.getPieceAt(e.capture.get());return n===sQ.UNREACHABLE||n===sQ.EMPTY?RG.failure(a1.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?RG.failure(a1.CANNOT_CAPTURE_OWN_PIECES()):RG.success(void 0)}isLegalMovement(e,t){if(t.getPieceAt(e.start.get())===sQ.UNREACHABLE){const t="Cannot start with a coord outside the board "+e.start.get().toString()+".";return RG.failure(t)}if(t.getPieceAt(e.landingCoord.get())===sQ.UNREACHABLE){const t="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return RG.failure(t)}const n=t.getPieceAt(e.start.get());return n===sQ.EMPTY?RG.failure(hQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n.is(t.getCurrentOpponent())?RG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE()):RG.success(void 0)}static getGameStatus(e){const t=e.gameState;return t.captures[0]>=18?TQ.ZERO_WON:t.captures[1]>=18?TQ.ONE_WON:TQ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class f1 extends dQ{getListMoves(e){let t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}getListExchanges(e){const t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=sQ.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(let s=0;s<10;s++)for(let e=0;e<15;e++){const r=new nQ(e,s);if(n.getPieceAt(r)===i){const e=c1.fromTilesExchange(r);t.push(e)}}return t}getListMovement(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<10;i++)for(let e=0;e<15;e++){const s=new nQ(e,i);if(n.getPieceAt(s).is(r)){const e=n.getLegalLandings(s);for(const n of e){const e=c1.fromCoordToCoord(s,n);t.push(e)}}}return t}getBoardValue(e){const t=p1.getGameStatus(e);if(t.isEndGame)return pQ.fromWinner(t.winner);const n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new pQ(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}getPiecesScore(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}getPlayerPiecesScore(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}putCaptureFirst(e,t){return eK.sortByDescending(t,t=>this.moveCapturesList(e,t).length),t}moveCapturesList(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}let g1=(()=>{class e extends f1{getBoardValue(t){const n=p1.getGameStatus(t);if(n.isEndGame)return pQ.fromWinner(n.winner);const r=t.gameState,i=this.getPiecesMap(r),s=this.getThreatMap(r,i),o=this.filterThreatMap(s,r);let a=0;for(const l of YY.PLAYERS)for(const t of i.get(l).get())o.get(t).isPresent()?a+=l.getScoreModifier()*e.SCORE_BY_THREATENED_PIECE:a+=l.getScoreModifier()*e.SCORE_BY_SAFE_PIECE;return a+=r.tiles[1]-r.tiles[0],new pQ(a)}getPiecesMap(e){const t=new SQ,n=[],r=[];for(let i=0;i<10;i++)for(let t=0;t<15;t++){const s=new nQ(t,i),o=e.getPieceAt(s);o===sQ.ZERO?n.push(s):o===sQ.ONE&&r.push(s)}return t.set(YY.ZERO,new BX(n)),t.set(YY.ONE,new BX(r)),t}getThreatMap(e,t){const n=new SQ;for(const r of YY.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreat(i,e);t.isPresent()&&n.set(i,t.get())}return n}getThreat(e,t){const n=YY.of(t.getPieceAt(e).value).getOpponent();let r=yw.empty();const i=[],s=u1.getNeighbors(e).filter(e=>e.isInRange(15,10));for(const o of s){const e=t.getPieceAt(o);if(e.is(n))i.push(o);else if(e===sQ.EMPTY){if(r.isPresent())return yw.empty();r=yw.of(o)}}if(r.isPresent()){const e=[];for(const s of l1.STEPS){const o=r.get().getNext(s.direction,1);o.isInRange(15,10)&&t.getPieceAt(o).is(n)&&i.every(e=>!1===e.equals(o))&&e.push(o)}if(e.length>0)return yw.of(new LX(new BX(i),new BX(e)))}return yw.empty()}filterThreatMap(e,t){const n=new SQ,r=e.listKeys(),i=r.filter(e=>t.getPieceAt(e).is(t.getCurrentPlayer())),s=new BX(r.filter(e=>t.getPieceAt(e).is(t.getCurrentOpponent())));for(const o of i){const t=e.get(o).get();zG(1===t.directThreats.size(),"oldThreat must contain exactly one direct threat");const r=t.directThreats.getAnyElement().get();let i=yw.empty();if(!1===s.contains(r)){const e=[];for(const n of t.mover)!1===s.contains(n)&&e.push(n);e.length>0&&(i=yw.of(new LX(t.directThreats,new BX(e))))}i.isPresent()&&n.set(o,i.get())}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e})();const m1=sQ.EMPTY,y1=sQ.UNREACHABLE,v1=sQ.ZERO,_1=sQ.ONE;class C1{constructor(){this.tutorial=[NQ.informational($localize`Board and goal of the game`,$localize`Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.
         The triangles are the spaces on which pieces move during the game.
         The tiles can be removed from the board (you will see how later).
         The dark pieces belong to the first player and can only move on the dark spaces,
         while the light pieces belong to the second player and can only move on the light spaces.
         The goal of the game is to capture all of the opponent's pieces.`,d1.getInitialState()),NQ.anyMove($localize`Move`,$localize`To move a piece, you need to:
        <ol>
          <li>Click on one of your pieces.</li>
          <li>Click on one of the triangular space highlighted in yellow.</li>
        </ol>
        You can pass through the opponent's pieces.
        You're playing first, hence you're playing Dark.<br/><br/>
        Perform any move.`,d1.getInitialState(),c1.fromCoordToCoord(new nQ(3,5),new nQ(5,5)),$localize`Congratulations! Let's see captures now.`),NQ.fromMove($localize`Capture`,$localize`Every piece has three neighboring triangular spaces (2 on the sides).
        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!
        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>
        You're playing Light, make a capture.`,new d1([[y1,y1,y1,y1,y1,y1,v1,m1,v1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,v1,m1,m1,m1,m1,m1,v1,m1,m1,y1,y1,y1],[m1,_1,m1,_1,v1,_1,m1,m1,v1,m1,m1,_1,m1,_1,m1],[_1,m1,m1,m1,m1,m1,m1,m1,m1,m1,_1,m1,m1,m1,_1],[m1,_1,m1,_1,m1,m1,m1,m1,m1,m1,m1,_1,m1,_1,m1],[m1,v1,m1,v1,m1,m1,m1,m1,m1,m1,m1,v1,m1,v1,m1],[v1,m1,m1,m1,v1,m1,m1,m1,m1,m1,v1,m1,m1,m1,v1],[m1,v1,m1,v1,m1,m1,_1,m1,_1,m1,m1,v1,m1,v1,m1],[y1,y1,y1,m1,m1,_1,m1,m1,m1,_1,m1,m1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,_1,m1,_1,y1,y1,y1,y1,y1,y1]],3,[0,0],[0,0]),[c1.fromCoordToCoord(new nQ(5,2),new nQ(4,1)),c1.fromCoordToCoord(new nQ(3,4),new nQ(4,3))],$localize`Congratulations!`,$localize`Failed, you have not captured any piece.`),NQ.fromMove($localize`Gain a tile`,$localize`When a tile is empty, it can become removable from the board.
        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.
        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.
        For example, here, the topmost dark piece will not disconnect its tile when leaving it.
        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>
        Perform a move that lets you gain two tiles.`,new d1([[y1,y1,y1,y1,y1,y1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,_1,m1,m1,y1,y1,y1,y1,y1,y1],[m1,m1,m1,y1,y1,y1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[m1,m1,_1,m1,m1,m1,m1,v1,m1,y1,y1,y1,y1,y1,y1],[m1,m1,m1,_1,m1,m1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[m1,m1,m1,m1,m1,m1,m1,m1,m1,m1,m1,v1,y1,y1,y1],[m1,m1,v1,m1,m1,_1,m1,m1,m1,m1,v1,m1,m1,m1,v1],[m1,m1,m1,m1,m1,m1,_1,m1,_1,m1,m1,v1,m1,v1,m1],[y1,y1,y1,m1,m1,_1,m1,m1,m1,_1,m1,m1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,_1,m1,_1,y1,y1,y1,y1,y1,y1]],2,[0,0],[0,0]),[c1.fromCoordToCoord(new nQ(2,6),new nQ(4,6)),c1.fromCoordToCoord(new nQ(2,6),new nQ(3,5)),c1.fromCoordToCoord(new nQ(2,6),new nQ(3,7))],$localize`Congratulations!`,$localize`Failed, you have not gained the two tiles that you could, try again!`),NQ.fromMove($localize`Exchanging a tile`,$localize`When you have a tile, you can see it on the left of the board.
        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.
        This will cost you two tiles.
        If any tiles are removed during that turn, nobody will get them.<br/><br/>
        Gain some time and capture the last piece!`,new d1([[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,v1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,m1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,m1,_1,m1,_1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,_1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,_1,m1,_1,y1,y1,y1,y1,y1,y1]],1,[0,2],[0,0]),[c1.fromTilesExchange(new nQ(5,5))],$localize`Congratulations!`,$localize`It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!`),NQ.fromMove($localize`Special capture`,$localize`When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!
        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>
        A move that demonstrate both of these things can be done on this board by Light. Try it!`,new d1([[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,m1,m1,v1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,v1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,v1,_1,m1,_1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,_1,v1,m1,m1,m1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,m1,m1,_1,y1,y1,y1,y1,y1,y1,y1,y1,y1],[y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1,y1]],1,[0,0],[0,0]),[c1.fromCoordToCoord(new nQ(7,6),new nQ(6,5)),c1.fromCoordToCoord(new nQ(7,6),new nQ(8,5))],$localize`Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.
        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space.`,$localize`Failed!`)]}}function E1(e,t){if(1&e&&(Cn(),ga(0,"polygon",13)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPyramidClass(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function w1(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getEmptyClass(e,t)),ra("points",n.getTriangleCoordinate(e,t))}}function S1(e,t){if(1&e&&(Cn(),la(0,w1,1,2,"polygon",14)),2&e){const e=ba().index,t=ba().index;ha("ngIf",ba().isEmptyCase(e,t))}}function b1(e,t){if(1&e&&(Cn(),ga(0,"polygon",16)),2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function P1(e,t){if(1&e&&(Cn(),ga(0,"polygon",17)),2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function O1(e,t){if(1&e){const e=va();Cn(),pa(0,"g",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),la(1,E1,1,2,"polygon",9),la(2,S1,1,1,"ng-template",null,10,Lu),la(4,b1,1,3,"polygon",11),la(5,P1,1,3,"polygon",12),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(3),i=ba().index,s=ba();Ia("id","click_",n,"_",i,""),Ts(1),ha("ngIf",s.isPyramid(n,i))("ngIfElse",r),Ts(3),ha("ngIf",e!==s.NONE),Ts(1),ha("ngIf",e!==s.NONE)}}function T1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O1,6,6,"g",7),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function I1(e,t){if(1&e&&(Cn(),ga(0,"polygon",18)),2&e){const e=t.$implicit;ra("points",ba().getTriangleCoordinate(e.x,e.y))}}function k1(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastStart.get().x,e.lastStart.get().y))}}function A1(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.lastEnd.get().x,e.lastEnd.get().y))}}function M1(e,t){if(1&e&&(Cn(),ga(0,"polygon",20)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}function N1(e,t){if(1&e&&(Cn(),pa(0,"g",21),ga(1,"polygon",22),pa(2,"text",23),Fa(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,0))("stroke",e.lastTurnWasTilesExchange(0)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+0*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Ua(e.tiles[0])}}function x1(e,t){if(1&e&&(Cn(),pa(0,"g",24),ga(1,"polygon",25),pa(2,"text",26),Fa(3),fa(),fa()),2&e){const e=ba();Ts(1),ra("points",e.getTilesCountCoordinate(0,9))("stroke",e.lastTurnWasTilesExchange(1)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+9*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Ua(e.tiles[1])}}let R1=(()=>{class e extends o1{constructor(e){super(e),this.tiles=[0,0],this.NONE=sQ.UNREACHABLE,this.chosenCoord=yw.empty(),this.lastStart=yw.empty(),this.lastEnd=yw.empty(),this.highlights=[],this.scores=yw.of([0,0]),this.rules=new p1(d1),this.availableMinimaxes=[new f1(this.rules,"Normal"),new g1(this.rules,"Piece > Threat > Tiles")],this.encoder=c1.encoder,this.tutorial=(new C1).tutorial,this.SPACE_SIZE=70,this.updateBoard()}updateBoard(){this.chosenCoord=yw.empty(),this.state=this.rules.node.gameState,this.scores=yw.of(this.state.captures),this.tiles=this.state.tiles;const e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=yw.empty(),this.lastEnd=yw.empty()),this.board=this.rules.node.gameState.board}showHighlight(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}cancelMoveAttempt(){this.chosenCoord=yw.empty(),this.highlights=[]}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new nQ(e,t);return n.chosenCoord.isAbsent()?n.firstClick(i):n.secondClick(i)})()}firstClick(e){var t=this;return hw(function*(){const n=t.state.getPieceAt(e);if(n.is(t.state.getCurrentOpponent())){const n=c1.fromTilesExchange(e);return t.chooseMove(n,t.state,t.state.captures)}return n.is(t.state.getCurrentPlayer())?(t.chosenCoord=yw.of(e),t.showHighlight(),FG.SUCCESS):t.cancelMove(a1.FIRST_CLICK_SHOULD_NOT_BE_NULL())})()}secondClick(e){var t=this;return hw(function*(){if(e.equals(t.chosenCoord.get()))return t.cancelMoveAttempt(),FG.SUCCESS;if(t.highlights.some(t=>t.equals(e))){const n=c1.fromCoordToCoord(t.chosenCoord.get(),e);return t.chooseMove(n,t.state,t.state.captures)}return t.cancelMove(a1.INVALID_DISTANCE())})()}isPyramid(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}wasOpponent(e,t){const n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}getPyramidClass(e,t){const n=this.board[t][e];return n===sQ.ZERO?this.getPlayerClass(YY.ZERO):n===sQ.ONE?this.getPlayerClass(YY.ONE):"captured"}isEmptyCase(e,t){return this.board[t][e]===sQ.EMPTY||this.wasRemoved(e,t)}wasRemoved(e,t){const n=this.rules.node.mother;if(this.board[t][e]===sQ.UNREACHABLE&&n.isPresent()){const r=n.get().gameState.getPieceAtXY(e,t);return r===sQ.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}getEmptyClass(e,t){return this.board[t][e]===sQ.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}getTilesCountCoordinate(e,t){const n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}getLineCoordinate(e,t){const n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}mustShowTilesOf(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}lastTurnWasTilesExchange(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-coerceo"]],features:[Go],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,T1,2,1,"g",1),la(2,I1,1,1,"polygon",2),la(3,k1,1,1,"polygon",3),la(4,A1,1,1,"polygon",3),la(5,M1,1,1,"polygon",4),la(6,N1,4,6,"g",5),la(7,x1,4,6,"g",6),fa()),2&e&&(ra("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.highlights),Ts(1),ha("ngIf",t.lastStart.isPresent()),Ts(1),ha("ngIf",t.lastEnd.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()),Ts(1),ha("ngIf",t.mustShowTilesOf(0)),Ts(1),ha("ngIf",t.mustShowTilesOf(1)))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),D1=(()=>{class e{}return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=()=>$localize`Your piece should land on a neighboring square.`,e.CANNOT_DROP_AFTER_TURN_40=()=>$localize`You cannot drop a piece during the moving phase.`,e.CANNOT_MOVE_BEFORE_TURN_40=()=>$localize`You cannot move a piece before both players have dropped all of their pieces.`,e.MUST_JUMP_OVER_PIECES=()=>$localize`A jump must be made over a piece, not over an empty square.`,e.MUST_DROP_IN_CENTRAL_ZONE=()=>$localize`A drop must occur in the central zone of the board.`,e.INVALID_JUMP=()=>$localize`A jump must land two squares from its original position, and be done in a straight line in any direction.`,e.SAME_LOCATION_VISITED_IN_JUMP=()=>$localize`You are visiting the same location twice in a move, you are not allowed to do so.`,e})();class L1 extends yQ{static getInitialState(){const e=eK.createTable(L1.WIDTH,L1.HEIGHT,KY.NONE);return new L1(e,0)}isShelter(e){return 0===e.x||e.x===L1.WIDTH-1?L1.SHELTERS_INDICES.some(t=>e.y===t):(0===e.y||e.y===L1.HEIGHT-1)&&L1.SHELTERS_INDICES.some(t=>e.x===t)}isCentralZone(e){return e.x>=L1.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=L1.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=L1.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=L1.CENTRAL_ZONE_BOTTOM_RIGHT.y}isDropPhase(){return this.turn<40}getSidePieces(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}L1.WIDTH=17,L1.HEIGHT=17,L1.CENTRAL_ZONE_TOP_LEFT=new nQ(4,6),L1.CENTRAL_ZONE_BOTTOM_RIGHT=new nQ(12,10),L1.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],L1.ALL_SHELTERS=new gQ(L1.SHELTERS_INDICES.flatMap(e=>[new nQ(e,0),new nQ(e,L1.HEIGHT-1),new nQ(0,e),new nQ(L1.WIDTH-1,e)])).toList();class F1 extends CQ{constructor(e){super(e.x,e.y)}static of(e){return e.isInRange(L1.WIDTH,L1.HEIGHT)?RG.success(new F1(e)):RG.failure("Move out of board")}toString(){return`ConspirateursMoveDrop(${this.coord.toString()})`}equals(e){return!!e.isDrop()&&this.coord.equals(e.coord)}isDrop(){return!0}isSimple(){return!1}isJump(){return!1}}F1.encoder=class{static getEncoder(e,t,n){return new class extends jY{constructor(){super(...arguments),this.shiftX=t}maxValue(){return(e-1)*this.shiftX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftX+e.coord.y}decodeNumber(r){const i=r%t;r/=t;const s=new nQ((r-=r%1)%e,i);return n(s)}}}}.getEncoder(L1.WIDTH,L1.HEIGHT,e=>F1.of(e).get());class U1 extends SX{constructor(e,t){super(e,t)}static of(e,t){return e.isInRange(L1.WIDTH,L1.HEIGHT)&&t.isInRange(L1.WIDTH,L1.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?RG.success(new U1(e,t)):RG.failure(D1.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):RG.failure("Move out of board")}toString(){return`ConspirateursMoveSimple(${this.coord.toString()} -> ${this.end.toString()})`}equals(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}isDrop(){return!1}isSimple(){return!0}isJump(){return!1}}U1.encoder=SX.getEncoder(L1.WIDTH,L1.HEIGHT,(e,t)=>U1.of(e,t).get());class B1 extends _Q{constructor(e){super(),this.coords=e}static of(e){if(e.length<2)return RG.failure("ConspirateursMoveJump requires at least one jump, so two coords");for(const t of e)if(t.isNotInRange(L1.WIDTH,L1.HEIGHT))return RG.failure("Move out of board");for(let t=1;t<e.length;t++)if(e[t-1].getDirectionToward(e[t]).isFailure()||2!==e[t-1].getDistance(e[t]))return RG.failure(D1.INVALID_JUMP());return new BX(e).size()===e.length?RG.success(new B1(e)):RG.failure(D1.SAME_LOCATION_VISITED_IN_JUMP())}addJump(e){const t=eK.copyImmutableArray(this.coords);return t.push(e),B1.of(t)}getStartingCoord(){return this.coords[0]}getEndingCoord(){return this.coords[this.coords.length-1]}getLandingCoords(){return this.coords.slice(1)}getJumpedOverCoords(){const e=[];for(let t=1;t<this.coords.length;t++){const n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}toString(){return`ConspirateursMoveJump(${this.coords.map(e=>e.toString()).reduce((e,t)=>e+" -> "+t)})`}equals(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}isDrop(){return!1}isSimple(){return!1}isJump(){return!0}}B1.encoder=new class extends WY{constructor(){super(...arguments),this.coordEncoder=nQ.numberEncoder(L1.WIDTH,L1.HEIGHT)}encodeMove(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}decodeMove(e){zG(null!=dw.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");const t=dw.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return B1.of(t).get()}};const V1=WY.disjunction3(F1.encoder,U1.encoder,B1.encoder,e=>e.isDrop(),e=>e.isSimple());class $1 extends IQ{constructor(){super(L1)}static get(){return $1.singleton.isAbsent()&&($1.singleton=yw.of(new $1)),$1.singleton.get()}applyLegalMove(e,t,n){const r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=KY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{const n=e.getStartingCoord(),i=e.getEndingCoord();r[n.y][n.x]=KY.NONE,r[i.y][i.x]=t.getCurrentPlayer()}return new L1(r,t.turn+1)}isLegal(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}dropLegality(e,t){return t.turn>=40?RG.failure(D1.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord).isPlayer()?RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?RG.failure(D1.MUST_DROP_IN_CENTRAL_ZONE()):RG.success(void 0)}simpleMoveLegality(e,t){return t.turn<40?RG.failure(D1.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end).isPlayer()?RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE()):RG.success(void 0)}jumpLegality(e,t){if(t.turn<40)return RG.failure(D1.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE());for(const n of e.getJumpedOverCoords())if(t.getPieceAt(n)===KY.NONE)return RG.failure(D1.MUST_JUMP_OVER_PIECES());for(const n of e.getLandingCoords())if(t.getPieceAt(n).isPlayer())return RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE());return RG.success(void 0)}jumpTargetsFrom(e){const t=[new nQ(e.x+2,e.y),new nQ(e.x-2,e.y),new nQ(e.x,e.y+2),new nQ(e.x,e.y-2),new nQ(e.x+2,e.y+2),new nQ(e.x+2,e.y-2),new nQ(e.x-2,e.y+2),new nQ(e.x-2,e.y-2)],n=[];for(const r of t)B1.of([e,r]).isSuccess()&&n.push(r);return n}nextJumps(e,t){const n=e.getEndingCoord(),r=[];for(const i of this.jumpTargetsFrom(n)){const n=e.addJump(i);n.isSuccess()&&this.jumpLegality(n.get(),t).isSuccess()&&r.push(n.get())}return r}jumpHasPossibleNextTargets(e,t){return this.nextJumps(e,t).length>0}getGameStatus(e){const t=e.gameState,n=[0,0];for(const r of L1.ALL_SHELTERS){const e=t.getPieceAt(r);if(e.isPlayer()&&(n[e.value]+=1,20===n[e.value]))return TQ.getVictory(e)}return TQ.ONGOING}}$1.singleton=yw.empty();class z1 extends dQ{getListMoves(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}getListMovesDrop(e){const t=[],n=L1.CENTRAL_ZONE_TOP_LEFT,r=L1.CENTRAL_ZONE_BOTTOM_RIGHT;for(let i=n.y;i<=r.y;i++)for(let s=n.x;s<=r.x;s++)e.getPieceAtXY(s,i)===KY.NONE&&t.push(F1.of(new nQ(s,i)).get());return t}getListMovesAfterDrop(e){let t=[];const n=e.getCurrentPlayer();for(let r=0;r<L1.HEIGHT;r++)for(let i=0;i<L1.WIDTH;i++){const s=new nQ(i,r);e.getPieceAt(s)===n&&(t=t.concat(this.getListSimpleMoves(e,s)),t=t.concat(this.getListJumps(e,s)))}return t}getListSimpleMoves(e,t){const n=[],r=[new nQ(t.x+1,t.y),new nQ(t.x-1,t.y),new nQ(t.x,t.y+1),new nQ(t.x,t.y-1),new nQ(t.x+1,t.y+1),new nQ(t.x+1,t.y-1),new nQ(t.x-1,t.y+1),new nQ(t.x-1,t.y-1)];for(const i of r){const r=U1.of(t,i);r.isSuccess()&&$1.get().simpleMoveLegality(r.get(),e).isSuccess()&&n.push(r.get())}return n}getListJumps(e,t){const n=new gQ;for(const r of $1.get().jumpTargetsFrom(t)){const i=B1.of([t,r]).get();$1.get().jumpLegality(i,e).isSuccess()&&(n.add(i),n.union(this.getListJumpStartingFrom(e,i)))}return n.toList()}getListJumpStartingFrom(e,t){const n=$1.get().nextJumps(t,e),r=new gQ(n);for(const i of n)r.union(this.getListJumpStartingFrom(e,i));return r}getBoardValue(e){const t=e.gameState;let n=0;const r=new SQ;r.set(YY.ZERO,0),r.set(YY.ONE,0);for(let i=0;i<L1.HEIGHT;i++)for(let e=0;e<L1.WIDTH;e++){const s=new nQ(e,i),o=t.getPieceAt(s);if(o.isPlayer())if(t.isShelter(s)){if(n+=20*o.getScoreModifier(),r.replace(o,r.get(o).get()+1),20===r.get(o).get())return new pQ(o.getVictoryValue())}else{let e=100;for(const n of L1.ALL_SHELTERS)if(t.getPieceAt(n)===KY.NONE){const t=s.getOrthogonalDistance(n);e=Math.min(e,t)}n-=o.getScoreModifier()*e}}return new pQ(n)}}const H1=KY.NONE,G1=YY.ZERO,q1=YY.ONE;class W1{constructor(){this.tutorial=[NQ.informational($localize`Board and aim of the game`,$localize`Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially.`,L1.getInitialState()),NQ.anyMove($localize`Initial phase`,$localize`In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone.`,L1.getInitialState(),F1.of(new nQ(7,7)).get(),$localize`Congratulations!`),NQ.fromPredicate($localize`Simple move`,$localize`Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move.`,new L1([[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,G1,q1,q1,G1,G1,q1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,q1,G1,q1,G1,G1,G1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,q1,H1,H1,H1,H1,H1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,G1,q1,q1,q1,G1,G1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,q1,q1,q1,q1,q1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1]],40),U1.of(new nQ(4,6),new nQ(3,5)).get(),(e,t)=>e.isSimple()?FG.SUCCESS:FG.failure($localize`You have made a jump, not a simple move. Try again!`),$localize`Congratulations!`),NQ.fromPredicate($localize`Jumps`,$localize`The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful).`,new L1([[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,G1,q1,q1,G1,G1,q1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,q1,G1,q1,G1,G1,G1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,q1,H1,H1,H1,H1,H1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,G1,q1,q1,q1,G1,G1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,q1,q1,q1,q1,q1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1]],40),B1.of([new nQ(6,7),new nQ(6,5)]).get(),(e,t)=>e.isJump()?FG.SUCCESS:FG.failure($localize`You have not performed a jump. Try again!`),$localize`Congratulations!`),NQ.fromMove($localize`Chaining jumps in a single move`,$localize`Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it.`,new L1([[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,q1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,q1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,q1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,G1,H1,q1,G1,G1,q1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,H1,G1,q1,G1,G1,G1,G1,q1,H1,H1,H1,H1],[H1,H1,H1,H1,G1,q1,H1,H1,H1,H1,H1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,G1,q1,q1,q1,G1,G1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,q1,G1,q1,q1,q1,q1,q1,q1,G1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1],[H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1,H1]],40),[B1.of([new nQ(8,6),new nQ(6,4),new nQ(6,2),new nQ(6,0)]).get()],$localize`Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does.`,$localize`You have not performed a triple jump. Try again!`)]}}function j1(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",9),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba().$implicit,t=ba(2);ra("x",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.x+t.STROKE_WIDTH)("y",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.y+t.STROKE_WIDTH)("width",t.SPACE_SIZE-3*t.STROKE_WIDTH)("height",t.SPACE_SIZE-3*t.STROKE_WIDTH)}}function Z1(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function Y1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t.coord)}),fa(),la(2,j1,1,4,"rect",7),la(3,Z1,1,6,"circle",8),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isShelter),Ts(1),ha("ngIf",e.hasPiece)}}function K1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Y1,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function J1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngClass",n.viewInfo.boardInfo[e.y][e.x].shelterClasses),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function Q1(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=t.$implicit,n=ba();Ta("id","sidePiece_0_",e,""),ra("cx",-n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function X1(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Ta("id","sidePiece_1_",e,""),ra("cx",1715+n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function e0(e,t){if(1&e&&(Cn(),ga(0,"rect",13)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.CENTRAL_ZONE_START.x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.CENTRAL_ZONE_START.y+e.STROKE_WIDTH)("width",e.CENTRAL_ZONE_SIZE.x*e.SPACE_SIZE)("height",e.CENTRAL_ZONE_SIZE.y*e.SPACE_SIZE)}}let t0=(()=>{class e extends rQ{constructor(e){super(e),this.ALL_SHELTERS=L1.ALL_SHELTERS,this.CENTRAL_ZONE_START=L1.CENTRAL_ZONE_TOP_LEFT,this.CENTRAL_ZONE_SIZE=new JJ(L1.CENTRAL_ZONE_BOTTOM_RIGHT.x-L1.CENTRAL_ZONE_TOP_LEFT.x+1,L1.CENTRAL_ZONE_BOTTOM_RIGHT.y-L1.CENTRAL_ZONE_TOP_LEFT.y+1),this.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},this.selected=yw.empty(),this.jumpInConstruction=yw.empty(),this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH),this.rules=$1.get(),this.availableMinimaxes=[new z1(this.rules,"ConspirateursMinimax")],this.encoder=V1,this.tutorial=(new W1).tutorial}ngOnInit(){this.updateBoard()}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}updateViewInfo(){const e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(let t=0;t<L1.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(let n=0;n<L1.WIDTH;n++){const r=new nQ(n,t),i=e.getPieceAt(r),s={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i.isPlayer(),isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(s)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}updateOccupiedShelters(){for(const e of L1.ALL_SHELTERS){const t=this.viewInfo.boardInfo[e.y][e.x];t.isShelter=!0,t.hasPiece&&t.shelterClasses.push("highlighted")}}updateSelected(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){const e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;for(const r of e.coords)this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}else{const e=this.selected.get();this.viewInfo.boardInfo[e.y][e.x].pieceClasses.push("selected")}}updateVictory(){const e=this.getState(),t=$1.get().getGameStatus(this.rules.node);if(!0===t.isEndGame)for(const n of L1.ALL_SHELTERS)e.getPieceAt(n)===t.winner&&this.viewInfo.boardInfo[n.y][n.x].squareClasses.push("victory")}showLastMove(){const e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";for(const t of e.coords)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=t.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=t.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}cancelMoveAttempt(){this.jumpInConstruction=yw.empty(),this.selected=yw.empty(),this.updateBoard()}onClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());const r=t.getState();if(r.getPieceAt(e)===t.getCurrentPlayer())return t.selected=yw.of(e),t.jumpInConstruction=yw.empty(),t.updateViewInfo(),FG.SUCCESS;if(t.jumpInConstruction.isPresent())return t.constructJump(e);if(t.selected.isPresent())return t.selectNextCoord(e);if(r.isDropPhase()){const n=F1.of(e);return zG(n.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(n.get(),r)}return t.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE())})()}constructJump(e){var t=this;return hw(function*(){const n=t.jumpInConstruction.get(),r=t.getState();if(e.equals(n.getEndingCoord()))return t.chooseMove(n,r);{const i=n.addJump(e);if(i.isFailure())return t.cancelMove(i.getReason());const s=t.rules.jumpLegality(i.get(),r);return s.isFailure()?t.cancelMove(s.getReason()):t.updateJump(i.get())}})()}updateJump(e){var t=this;return hw(function*(){const n=t.getState();return t.rules.jumpHasPossibleNextTargets(e,n)?(t.jumpInConstruction=yw.of(e),t.updateViewInfo(),FG.SUCCESS):t.chooseMove(e,n)})()}selectNextCoord(e){var t=this;return hw(function*(){const n=t.selected.get(),r=U1.of(n,e);if(r.isSuccess())return t.chooseMove(r.get(),t.getState());{const r=B1.of([n,e]);return r.isFailure()?t.cancelMove(r.getReason()):t.updateJump(r.get())}})()}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-conspirateurs"]],features:[Go],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,K1,2,1,"g",1),la(2,J1,2,5,"g",1),la(3,Q1,1,4,"circle",2),la(4,X1,1,4,"circle",3),la(5,e0,1,4,"rect",4),ga(6,"polyline",5),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.ALL_SHELTERS),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[0])),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[1])),Ts(1),ha("ngIf",t.viewInfo.dropPhase),Ts(1),ra("points",t.viewInfo.lastMoveArrow))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class n0{constructor(e,t){this.owner=e,this.otherPieceType=t}static of(e,t){return e===YY.ZERO?t?n0.ZERO_SECOND:n0.ZERO_FIRST:e===YY.ONE?t?n0.ONE_SECOND:n0.ONE_FIRST:n0.EMPTY}toString(){return`DiamPiece(${this.owner}, ${this.otherPieceType})`}}n0.encoder=jY.tuple([YY.numberEncoder,jY.booleanEncoder],e=>[e.owner,e.otherPieceType],e=>n0.of(e[0],e[1])),n0.EMPTY=new n0(KY.NONE,!1),n0.ZERO_FIRST=new n0(YY.ZERO,!1),n0.ZERO_SECOND=new n0(YY.ZERO,!0),n0.ONE_FIRST=new n0(YY.ONE,!1),n0.ONE_SECOND=new n0(YY.ONE,!0),n0.PLAYER_PIECES=[n0.ZERO_FIRST,n0.ZERO_SECOND,n0.ONE_FIRST,n0.ONE_SECOND];class r0 extends _Q{constructor(e,t){if(super(),this.target=e,this.piece=t,t===n0.EMPTY)throw new Error("Cannot drop an empty piece")}isDrop(){return!0}getTarget(){return this.target}equals(e){return!(this.target!==e.target||this.piece!==e.piece)}toString(){return`DiamMoveDrop(${this.target}, ${this.piece})`}}r0.encoder=jY.tuple([jY.numberEncoder(7),n0.encoder],e=>[e.target,e.piece],e=>new r0(e[0],e[1]));class i0 extends _Q{constructor(e,t){super(),this.start=e,this.moveDirection=t}static fromRepresentation(e,t){return new i0(new nQ(e.x,3-e.y),t)}isDrop(){return!1}getTarget(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}equals(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}toString(){return`DiamMoveShift(${this.start}, ${this.moveDirection})`}}i0.encoder=jY.tuple([nQ.numberEncoder(8,4),jY.booleanEncoder],e=>[e.start,"clockwise"===e.moveDirection],e=>new i0(e[0],e[1]?"clockwise":"counterclockwise"));const s0=jY.disjunction(r0.encoder,i0.encoder,e=>e.isDrop());let o0=(()=>{class e{}return e.NO_MORE_PIECES_OF_THIS_TYPE=()=>$localize`You do not have any pieces of this type anymore.`,e.SPACE_IS_FULL=()=>$localize`You cannot play here: this space is already full.`,e.TARGET_STACK_TOO_HIGH=()=>$localize`You cannot add more pieces to the target stack, as it will contain more than 4 pieces.`,e.MUST_SHIFT_TO_NEIGHBOR=()=>$localize`To perform a shift, you must move the pieces to a neighboring space.`,e.MUST_SELECT_PIECE_FIRST=()=>$localize`You must first select either a piece from the side, or a stack of pieces to shift on the board.`,e})(),a0=(()=>{class e extends yQ{constructor(e,t,n){super(e,n),this.remainingPieces=t}static getInitialState(){const t=n0.EMPTY;return new e([[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t]],[4,4,4,4],0)}static fromRepresentation(t,n){const r=t.reverse(),i=[4,4,4,4];for(let s=0;s<e.HEIGHT;s++)for(let t=0;t<e.WIDTH;t++){const n=r[s][t];r[s][t]!==n0.EMPTY&&i[e.pieceIndex(n)]--}return zG(i.every(e=>e>=0),"Invalid DiamState representation uses too many pieces"),new e(r,i,n)}static pieceIndex(e){switch(e){case n0.ZERO_FIRST:return 0;case n0.ZERO_SECOND:return 1;case n0.ONE_FIRST:return 2;default:return dw.expectToBe(e,n0.ONE_SECOND),3}}getRemainingPiecesOf(t){return this.remainingPieces[e.pieceIndex(t)]}getStackHeight(t){let n=0;for(let r=0;r<e.HEIGHT&&this.getPieceAtXY(t,r)!==n0.EMPTY;r++)n++;return n}}return e.WIDTH=8,e.HEIGHT=4,e})();class l0 extends IQ{constructor(){super(a0)}static get(){return l0.singleton.isAbsent()&&(l0.singleton=yw.of(new l0)),l0.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}applyLegalDrop(e,t){const n=eK.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;const r=eK.copyImmutableArray(t.remainingPieces);return r[a0.pieceIndex(e.piece)]-=1,new a0(n,r,t.turn+1)}applyLegalShift(e,t){const n=eK.copyBiArray(t.board),r=e.getTarget();let i=t.getStackHeight(r),s=e.start.y;for(;s<a0.HEIGHT&&t.getPieceAtXY(e.start.x,s)!==n0.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,s),n[s][e.start.x]=n0.EMPTY,i++,s++;return new a0(n,t.remainingPieces,t.turn+1)}isLegal(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}isDropLegal(e,t){return e.piece.owner!==t.getCurrentPlayer()?RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?RG.failure(o0.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}dropHeightValidity(e,t){return t.getStackHeight(e.target)===a0.HEIGHT?RG.failure(o0.SPACE_IS_FULL()):RG.success(void 0)}isShiftLegal(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}shiftHeightValidity(e,t){const n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>a0.HEIGHT?RG.failure(o0.TARGET_STACK_TOO_HIGH()):RG.success(void 0)}getGameStatus(e){const t=this.findHighestAlignment(e.gameState);if(t.isPresent()){const n=e.gameState.getPieceAt(t.get());return zG(n.owner.isPlayer(),"highest alignment is owned by a player"),TQ.getVictory(n.owner)}return TQ.ONGOING}findHighestAlignment(e){for(let t=0;t<a0.WIDTH/2;t++)for(let n=a0.HEIGHT-1;n>0;n--){const r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+a0.WIDTH/2,n);if(r!==n0.EMPTY&&r===i)return yw.of(new nQ(t,n))}return yw.empty()}pieceCanMove(e,t){return!!this.isShiftLegal(new i0(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new i0(t,"counterclockwise"),e).isSuccess()}}l0.singleton=yw.empty();class c0 extends dQ{getListMoves(e){const t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}getListShifts(e){const t=[],n=this.getShiftSources(e);for(const r of n)for(const n of[new i0(r,"clockwise"),new i0(r,"counterclockwise")])l0.get().shiftHeightValidity(n,e).isSuccess()&&t.push(n);return t}getListDrops(e){const t=this.getRemainingPiecesForCurrentPlayer(e),n=[];for(let r=0;r<a0.WIDTH;r++)for(const i of t){const t=new r0(r,i);l0.get().dropHeightValidity(t,e).isSuccess()&&n.push(t)}return n}getRemainingPiecesForCurrentPlayer(e){const t=[];for(const n of n0.PLAYER_PIECES)this.currentPlayerCanDropPiece(e,n)&&t.push(n);return t}currentPlayerCanDropPiece(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}getShiftSources(e){const t=[],n=e.getCurrentPlayer();for(let r=0;r<a0.HEIGHT;r++)for(let i=0;i<a0.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new nQ(i,r));return t}getBoardValue(e){const t=l0.get().getGameStatus(e);return new pQ(t.isEndGame?t.toBoardValue():0)}}const u0=n0.EMPTY,h0=n0.ZERO_FIRST,d0=n0.ZERO_SECOND,p0=n0.ONE_FIRST,f0=n0.ONE_SECOND;class g0{constructor(){this.tutorial=[NQ.informational($localize`Initial board and player pieces`,$localize`Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right.`,a0.getInitialState()),NQ.fromMove($localize`Goal of the game`,$localize`At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!`,a0.fromRepresentation([[u0,u0,u0,u0,u0,u0,u0,u0],[u0,u0,u0,u0,u0,u0,u0,u0],[u0,u0,u0,u0,p0,u0,u0,u0],[h0,u0,u0,u0,h0,u0,u0,u0]],3),[new r0(0,n0.ONE_FIRST)],$localize`Congratulations, you won!`,$localize`Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board.`),NQ.fromMove($localize`Types of move`,$localize`You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board.`,a0.fromRepresentation([[u0,u0,u0,u0,u0,u0,u0,u0],[u0,u0,u0,u0,f0,u0,u0,u0],[u0,u0,u0,u0,h0,u0,u0,u0],[p0,u0,u0,u0,d0,u0,u0,u0]],4),[i0.fromRepresentation(new nQ(4,3),"counterclockwise"),i0.fromRepresentation(new nQ(4,3),"clockwise"),i0.fromRepresentation(new nQ(4,2),"counterclockwise"),i0.fromRepresentation(new nQ(4,2),"clockwise")],$localize`Congratulations!`,$localize`Failed, try to move one of your piece that is already on the board.`),NQ.fromMove($localize`Special case`,$localize`It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!`,a0.fromRepresentation([[u0,u0,u0,u0,h0,u0,u0,u0],[u0,u0,u0,u0,f0,u0,u0,h0],[u0,u0,u0,u0,h0,u0,u0,f0],[u0,p0,u0,u0,d0,u0,u0,p0]],8),[i0.fromRepresentation(new nQ(4,2),"counterclockwise")],$localize`Congratulations!`,$localize`Failed, try to shift a stack of pieces to the left.`)]}}function m0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"path",6),Ea("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),pa(2,"path",7),Ea("click",function(){const t=Gt(e).$implicit;return ba().onSpaceClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ta("id","click_",e,""),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.BOARD_PATHS[e]),Ts(1),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.DECORATION_PATHS[e])}}function y0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",9),Ea("click",function(){const t=Gt(e).$implicit,n=ba().$implicit;return ba().onPieceInGameClick(n,t.y)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",ba().$implicit,"_",e.y,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}function v0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,y0,3,8,"g",8),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.viewInfo.boardInfo[e].pieces)}}function _0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",12),Ea("click",function(){const t=Gt(e).$implicit;return ba().onRemainingPieceClick(t.actualPiece)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","piece_",e.actualPiece.owner.value,"_",e.actualPiece.otherPieceType?1:0,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}const C0=function(){return[0,1,2,3,4,5,6,7]},E0=function(){return[2,1,3,0,4,7,5,6]};class w0 extends rQ{constructor(e){super(e),this.BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],this.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],this.selected=yw.empty(),this.viewInfo={boardInfo:[],remainingPieces:[]},this.rules=l0.get(),this.availableMinimaxes=[new c0(this.rules,"DiamDummyMinimax")],this.encoder=s0,this.tutorial=(new g0).tutorial}ngOnInit(){this.updateBoard()}onSpaceClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#click_"+e);return n.isFailure()?t.cancelMove(n.getReason()):t.onSpaceClickAfterCheck(e)})()}onSpaceClickAfterCheck(e){var t=this;return hw(function*(){if(t.selected.isPresent()){const n=t.selected.get();let r;if("pieceFromReserve"===n.type)r=new r0(e,n.piece);else if((n.position.x+1)%a0.WIDTH===e)r=new i0(n.position,"clockwise");else{if((n.position.x+(a0.WIDTH-1))%a0.WIDTH!==e)return t.cancelMove(o0.MUST_SHIFT_TO_NEIGHBOR());r=new i0(n.position,"counterclockwise")}return t.chooseMove(r,t.getState())}return t.cancelMove(o0.MUST_SELECT_PIECE_FIRST())})()}onPieceInGameClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=yw.of({type:"pieceFromBoard",position:new nQ(e,t)}),n.updateViewInfo(),FG.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE())})()}onRemainingPieceClick(e){var t=this;return hw(function*(){const n=t.canUserPlay(t.getPieceId(e));return n.isFailure()?t.cancelMove(n.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=yw.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),FG.SUCCESS):t.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE())})()}getPieceId(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}getLastMovedFromDrop(e,t){const n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),s=this.getDrawPositionOnBoard(r,i),o=new nQ(r,i);return[{start:yw.empty(),end:o,startDrawPosition:n,endDrawPosition:s}]}getLastMovedFromShift(e,t){const n=e.start.x,r=e.getTarget();let i=t.getStackHeight(r);const s=[];for(let o=e.start.y;o<a0.HEIGHT&&t.getPieceAtXY(n,o)!==n0.EMPTY;o++,i++)s.push({start:yw.of(new nQ(n,o)),end:new nQ(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return s}updateViewInfo(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}updateBoardInfo(){for(let e=0;e<a0.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}showLastMove(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}showLastMoveOnSpaces(){const e=this.rules.node.move;zG(e.isPresent(),"showLastMoveOnSpaces called without a last move");const t=e.get();for(let n=0;n<a0.WIDTH;n++){const e=[];t.isDrop()?t.getTarget()===n&&e.push("moved"):(t.getTarget()===n||t.start.x===n)&&e.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=e}}showLastMoveOnPieces(){const e=this.rules.node.move;zG(e.isPresent(),"showLastMoveOnPieces called without a last move");const t=e.get(),n=this.getPreviousState();let r=[];r=t.isDrop()?this.getLastMovedFromDrop(t,n):this.getLastMovedFromShift(t,n);for(const i of r)this.viewInfo.boardInfo[i.end.x].pieces[i.end.y].foregroundClasses.push("last-move")}updateRemainingPiecesInfo(){const e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];const t=this.isPlayerTurn();for(const n of n0.PLAYER_PIECES){const r=this.getState().getRemainingPiecesOf(n);for(let i=0;i<r;i++){const s=[];this.isTopPieceOfReserveAndSelected(i,r,n)&&s.push("selected"),t&&i===r-1&&n.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+n.owner.value+(n.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionRemainingPiece(n,i),actualPiece:n})}}}isTopPieceOfReserveAndSelected(e,t,n){if(this.selected.isPresent()){const r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}getDrawPositionRemainingPiece(e,t){let n,r;return n=e.owner===YY.ZERO?-100:600,r=e.otherPieceType?100:450,new nQ(n,r).getNext(new JJ(0,-t*w0.PIECE_HEIGHT))}getPieces(e){const t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[];for(let i=0;i<a0.HEIGHT;i++){const s=this.getState().getPieceAtXY(e,i),o=new nQ(e,i);if(s!==n0.EMPTY){const a=[];this.pieceFromBoardIsSelected(e,i)&&a.push("selected"),this.isVictory(e,i,t)&&a.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&a.push("clickable-hover"),r.push({backgroundClasses:["player"+s.owner.value+(s.otherPieceType?"-alternate":"")],foregroundClasses:a,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:s})}}return r}pieceFromBoardIsSelected(e,t){if(this.selected.isPresent()){const n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}isVictory(e,t,n){if(n.isPresent()){const r=n.get();return r.x%4==e%4&&r.y===t}return!1}getDrawPositionOnBoard(e,t){return w0.CENTER[e].getNext(new JJ(0,-t*w0.PIECE_HEIGHT))}cancelMoveAttempt(){this.selected=yw.empty(),this.updateBoard()}}w0.CENTER=[new nQ(40,160),new nQ(100,50),new nQ(255,2),new nQ(400,50),new nQ(460,160),new nQ(400,270),new nQ(255,320),new nQ(100,270)],w0.PIECE_HEIGHT=36,w0.\u0275fac=function(e){return new(e||w0)(ua(VG))},w0.\u0275cmp=Xe({type:w0,selectors:[["app-diam"]],features:[Go],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"g",1),ga(3,"path",2),ga(4,"ellipse",3),fa(),fa(),la(5,m0,3,5,"g",4),la(6,v0,2,1,"g",4),la(7,_0,3,8,"g",5),fa()),2&e&&(Ts(5),ha("ngForOf",lu(3,C0)),Ts(1),ha("ngForOf",lu(4,E0)),Ts(1),ha("ngForOf",t.viewInfo.remainingPieces))},directives:[$d,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class S0{constructor(e,t){this.offset=e,this.constant=t}static fromTwoCoords(e,t){const n=e.x,r=t.x,i=e.y,s=t.y,o=n+i,a=r+s;return n===r&&i!==s&&o!==a?yw.of(S0.constantQ(n)):n!==r&&i===s&&o!==a?yw.of(S0.constantR(i)):n!==r&&i!==s&&o===a?yw.of(S0.constantS(o)):yw.empty()}static constantQ(e){return new S0(e,"q")}static constantR(e){return new S0(e,"r")}static constantS(e){return new S0(e,"s")}static areOnSameLine(e){if(e.length<2)return!0;const t=S0.fromTwoCoords(e[0],e[1]);if(t.isAbsent())return!1;const n=t.get();for(const r of e.slice(2))if(!1===n.contains(r))return!1;return!0}toString(){return`Line(${this.constant}, ${this.offset})`}equals(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}contains(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}getDirection(){switch(this.constant){case"q":return oQ.DOWN;case"r":return oQ.RIGHT;case"s":return oQ.DOWN_LEFT}}}class b0 extends yQ{constructor(e,t,n,r,i,s){super(t,e),this.board=t,this.width=n,this.height=r,this.excludedCases=i,this.empty=s,zG(this.excludedCases.length<this.height/2+1,"Invalid excluded cases specification for HexagonalGameState.")}static neighbors(e,t){return[new nQ(e.x+t,e.y-t),new nQ(e.x+t,e.y),new nQ(e.x-t,e.y+t),new nQ(e.x-t,e.y),new nQ(e.x,e.y+t),new nQ(e.x,e.y-t)]}setAt(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}equalsT(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(let n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;for(const n of this.allCoords())if(!1===t(this.getPieceAt(n),e.getPieceAt(n)))return!1;return!0}allCoords(){const e=[];return this.forEachCoord(t=>{e.push(t)}),e}allLines(){const e=[];for(let t=0;t<this.width;t++)e.push(S0.constantQ(t));for(let t=0;t<this.height;t++)e.push(S0.constantR(t));for(let t=this.excludedCases.length;t<this.height+this.excludedCases.length;t++)e.push(S0.constantS(t));return e}getEntranceOnLine(e){let t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new nQ(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new nQ(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new nQ(e.offset,0):new nQ(this.width-1,e.offset-this.width+1))}}findEntranceFrom(e,t){const n=e.getDirection();let r=t;for(let s=0;s<Math.max(this.width,this.height);s++){if(this.isOnBoard(r))return r;r=r.getNext(n)}const i=$G.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(i.getReason())}}class P0{constructor(e,t,n){this.owner=e,this.size=t,this.source=n}static append(e,t){return new P0(e.owner,e.size+t.size,e.source||t.source)}getValue(){return P0.encoder.encodeNumber(this)}getOwner(){return this.owner}belongsTo(e){return this.owner===e}containsSource(){return this.source}isEmpty(){return 0===this.size}getSize(){return this.size}toString(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}P0.sizeEncoder=jY.numberEncoder(49),P0.encoder=jY.tuple([jY.booleanEncoder,YY.numberEncoder,P0.sizeEncoder],e=>[e.source,e.owner,e.size],e=>new P0(e[1],e[2],e[0])),P0.MAX_SIZE=49,P0.EMPTY=new P0(KY.NONE,0,!1),P0.UNREACHABLE=new P0(KY.NONE,-1,!1),P0.PLAYER_ZERO=new P0(YY.ZERO,1,!1),P0.PLAYER_ONE=new P0(YY.ONE,1,!1),P0.SOURCE=new P0(KY.NONE,1,!0);let O0=(()=>{class e extends b0{constructor(t,n,r){super(n,t,e.WIDTH,e.HEIGHT,e.EXCLUDED_CASES,P0.EMPTY),this.alreadyPassed=r}static balancedBoard(){const e=P0.UNREACHABLE,t=P0.PLAYER_ZERO,n=P0.PLAYER_ONE,r=P0.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}static isOnBoard(t){return!t.isNotInRange(e.WIDTH,e.HEIGHT)&&e.balancedBoard()[t.y][t.x]!==P0.UNREACHABLE}static getInitialState(){return new e(e.balancedBoard(),0,!1)}getAllPieces(){const t=[];for(let n=0;n<e.HEIGHT;n++)for(let r=0;r<e.WIDTH;r++){const e=new nQ(r,n);this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()&&t.push(e)}return t}numberOfNeighbors(e){return b0.neighbors(e,1).filter(e=>this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()).length}setAtUnsafe(t,n){const r=eK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.turn,this.alreadyPassed)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==P0.UNREACHABLE}}return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e})();class T0 extends SX{constructor(e,t){super(e,t)}static of(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return T0.PASS;if(!O0.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!O0.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new T0(e,t);if(e.x===t.x)return new T0(e,t);if(e.x+e.y===t.x+t.y)return new T0(e,t);throw new Error("Invalid move")}toString(){return this===T0.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}length(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}T0.PASS=new T0(new nQ(-1,-1),new nQ(-2,-2)),T0.encoder=new class extends jY{maxValue(){return 42148}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return T0.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new T0(new nQ((e=e/16|0)%16,r),new nQ(n,t))}};let I0=(()=>{class e{}return e.NOT_PLAYER_PIECE=()=>$localize`You must select a piece or a stack of your color.`,e.EMPTY_STACK=()=>$localize`You must select a stack.`,e.TOO_MANY_NEIGHBORS=()=>$localize`This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors.`,e.CANT_REACH_TARGET=()=>$localize`This stack cannot move because it could never land on another piece.`,e.INVALID_MOVE_LENGTH=()=>$localize`A stack must always be moved by as many spaces as there are pieces in the stack.`,e.EMPTY_TARGET_STACK=()=>$localize`The stack must land on an occupied space.`,e})();class k0 extends IQ{static getGameStatus(e){const t=e.gameState,n=k0.getScores(t);return 0===k0.getMovablePieces(t).length?n[0]>n[1]?TQ.ZERO_WON:n[0]<n[1]?TQ.ONE_WON:TQ.DRAW:TQ.ONGOING}static getMovablePieces(e){return k0.getFreePieces(e).filter(t=>k0.pieceHasTarget(e,t))}static getFreePieces(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6)}static pieceHasTarget(e,t){const n=e.getPieceAt(t).getSize();return void 0!==b0.neighbors(t,n).find(t=>e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty())}static pieceTargets(e,t){const n=e.getPieceAt(t).getSize();return b0.neighbors(t,n).filter(t=>e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty())}static getScores(e){let t=0,n=0;return e.getAllPieces().map(r=>{const i=e.getPieceAt(r);i.belongsTo(YY.ZERO)?t+=i.getSize():i.belongsTo(YY.ONE)&&(n+=i.getSize())}),[t,n]}isMovablePiece(e,t){zG(e.isOnBoard(t),"piece is not on the board");const n=e.getPieceAt(t);return n.getSize()<1?FG.failure(I0.EMPTY_STACK()):n.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?FG.failure(I0.TOO_MANY_NEIGHBORS()):k0.pieceHasTarget(e,t)?FG.SUCCESS:FG.failure(I0.CANT_REACH_TARGET()):FG.failure(I0.NOT_PLAYER_PIECE())}canOnlyPass(e){return 0===k0.getMovablePieces(e).length}sourceCoords(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).containsSource())}markPiecesConnectedTo(e,t,n){b0.neighbors(t,1).forEach(t=>{e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,this.markPiecesConnectedTo(e,t,n))})}removeDisconnectedPieces(e){const t=eK.createTable(O0.WIDTH,O0.HEIGHT,!1);this.sourceCoords(e).forEach(n=>{t[n.y][n.x]=!0,this.markPiecesConnectedTo(e,n,t)});let n=e;return n.getAllPieces().forEach(e=>{t[e.y][e.x]||(n=n.setAt(e,P0.EMPTY))}),n}applyLegalMove(e,t,n){if(e===T0.PASS)return new O0(t.board,t.turn+1,!0);{const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end),i=t.setAt(e.coord,P0.EMPTY).setAt(e.end,P0.append(n,r));return this.removeDisconnectedPieces(new O0(i.board,t.turn+1,!1))}}isLegal(e,t){if(0===k0.getMovablePieces(t).length)return e!==T0.PASS||t.alreadyPassed?RG.failure(hQ.MUST_PASS()):RG.success(void 0);if(e===T0.PASS)return RG.failure(hQ.CANNOT_PASS());const n=this.isMovablePiece(t,e.coord);if(n.isFailure())return n.toFailedFallible();const r=t.getPieceAt(e.coord);return e.length()!==r.getSize()?RG.failure(I0.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?RG.failure(I0.EMPTY_TARGET_STACK()):RG.success(void 0)}getGameStatus(e){return k0.getGameStatus(e)}}class A0 extends dQ{getListMoves(e){const t=e.move,n=e.gameState,r=[];return k0.getMovablePieces(n).forEach(e=>k0.pieceTargets(n,e).forEach(t=>{const n=T0.of(e,t);r.push(n)})),0===r.length&&!1===t.equalsValue(T0.PASS)&&r.push(T0.PASS),r}getBoardValue(e){const t=e.gameState,n=k0.getScores(t);return 0===k0.getMovablePieces(t).length?new pQ(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new pQ(n[0]-n[1])}}class M0 extends A0{getListMoves(e){const t=e.gameState,n=super.getListMoves(e),r=t.getCurrentPlayer().getOpponent();return eK.sortByDescending(n,e=>{zG(e!==T0.PASS,"Cannot sort with DvonnMove.PASS");const n=t.getPieceAt(e.end);return n.belongsTo(r)?n.getSize():0}),n}getBoardValue(e){const t=k0.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState,r=k0.getScores(n),i=n.getAllPieces(),s=i.length,o=i.filter(e=>n.getPieceAt(e).belongsTo(YY.ZERO)).length,a=i.filter(e=>n.getPieceAt(e).belongsTo(YY.ONE)).length;return new pQ((a*r[1]-o*r[0])/s)}}const N0=P0.EMPTY,x0=P0.UNREACHABLE,R0=P0.SOURCE,D0=P0.PLAYER_ZERO,L0=P0.PLAYER_ONE,F0=new P0(YY.ZERO,2,!1),U0=new P0(YY.ONE,2,!1),B0=new P0(YY.ZERO,4,!1),V0=new P0(YY.ONE,4,!1);class $0{constructor(){this.tutorial=[NQ.anyMove($localize`Moving`,$localize`At Dvonn, each hexagonal space contains a stack of pieces.
        If no number is indicated on a stack, it means that it only contains one piece.
        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.
        The owner of a stack is the one that has a piece at the top of the stack.
        Only the owner of a stack can move it.
        A stack cannot be moved if it is surrounded by 6 other stacks.
        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.
        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.
        Therefore, there are six possible directions.
        The player with dark pieces starts.<br/><br/>
        You're playing Dark, click on a stack and move it by one space.`,O0.getInitialState(),T0.of(new nQ(2,0),new nQ(3,0)),$localize`Congratulations!`),NQ.fromPredicate($localize`Disconnection`,$localize`Pieces with a lightning strike are called "sources".
        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>
        You're playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!`,new O0([[x0,x0,L0,R0,N0,N0,N0,N0,N0,N0,N0],[x0,N0,D0,N0,N0,N0,N0,N0,N0,N0,N0],[N0,N0,V0,N0,N0,N0,N0,L0,R0,N0,N0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,N0,x0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,x0,x0]],0,!1),T0.of(new nQ(2,1),new nQ(2,0)),(e,t)=>e.end.equals(new nQ(3,0))?FG.failure($localize`You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it.`):(zG(e.end.equals(new nQ(2,0)),"player made an impossible move"),FG.SUCCESS),$localize`Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!
        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.
        Disconnected stacks will not be visible at the next turn.`),NQ.fromPredicate($localize`Moving on a source`,$localize`You are allowed to move your stacks on any other stack.
        This means that you can take control of a source by moving one of your stack on top of it.
        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>
        You're playing Dark and you can take control of a source, do it!`,new O0([[x0,x0,R0,L0,N0,N0,N0,N0,N0,N0,N0],[x0,D0,D0,N0,N0,N0,N0,N0,N0,N0,N0],[N0,L0,D0,L0,N0,N0,D0,U0,R0,N0,N0],[N0,N0,L0,N0,N0,N0,N0,N0,N0,N0,x0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,x0,x0]],0,!1),T0.of(new nQ(2,1),new nQ(2,0)),(e,t)=>e.end.equals(new nQ(2,0))?FG.SUCCESS:FG.failure($localize`You have not taken possession of a source, try again.`),$localize`Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!`),NQ.informational($localize`Passing`,$localize`It can happen that you have no possible move to make.
        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>
        This is a situation that occurs here for Dark.`,new O0([[x0,x0,R0,N0,N0,N0,N0,N0,N0,N0,N0],[x0,N0,F0,N0,N0,N0,N0,N0,N0,N0,N0],[N0,N0,U0,N0,N0,N0,N0,U0,R0,B0,N0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,N0,x0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,x0,x0]],0,!1)),NQ.fromMove($localize`End of the game`,$localize`When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>
        Make your last move.`,new O0([[x0,x0,R0,N0,N0,N0,N0,N0,N0,N0,N0],[x0,N0,D0,N0,N0,N0,N0,N0,N0,N0,N0],[N0,N0,N0,N0,N0,N0,N0,N0,R0,B0,N0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,N0,x0],[N0,N0,N0,N0,N0,N0,N0,N0,N0,x0,x0]],0,!1),[T0.of(new nQ(2,1),new nQ(2,0))],$localize`Congratulations, you won 6 - 0!`,$localize`Bad idea, by moving on the source you would have won a point.`)]}}function z0(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ha("ngClass",n.getPieceClasses(e)),ra("cx",n.getCenterAt(t).x)("cy",n.getCenterAt(t).y)("r",n.SPACE_SIZE)}}function H0(e,t){if(1&e&&(Cn(),ga(0,"polygon",11)),2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("transform",1===e.getSize()?"translate("+(n.getCenterAt(t).x-18)+" "+(n.getCenterAt(t).y-16)+") scale(0.10)":"translate("+(n.getCenterAt(t).x-3)+" "+(n.getCenterAt(t).y-12)+") scale(0.07)")}}function G0(e,t){if(1&e){const e=va();Cn(),pa(0,"text",12),Ea("click",function(){Gt(e);const t=ba(2).$implicit;return ba().onClick(t.x,t.y)}),Fa(1),fa()}if(2&e){const e=ba().$implicit,t=ba().$implicit,n=ba();ra("x",e.containsSource()?n.getCenterAt(t).x-7:n.getCenterAt(t).x)("y",n.getCenterAt(t).y),Ts(1),Ua(e.getSize())}}function q0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t.x,t.y)}),ga(1,"polyline",6),la(2,z0,1,4,"circle",7),la(3,H0,1,1,"polygon",8),la(4,G0,2,3,"text",9),fa()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ia("id","click_",n.x,"_",n.y,""),Ts(1),ra("points",r.getHexaCoordsAt(n)),Ts(1),ha("ngIf",e.getSize()>0),Ts(1),ha("ngIf",e.containsSource()),Ts(1),ha("ngIf",e.getSize()>1)}}const W0=function(e){return[e]};function j0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,q0,5,6,"g",4),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",cu(1,W0,n.state.getPieceAt(e)))}}function Z0(e,t){if(1&e&&(Cn(),pa(0,"text",16),Fa(1),fa()),2&e){const e=ba().$implicit,t=ba();ra("x",t.getCenterAt(e.coord).x)("y",t.getCenterAt(e.coord).y),Ts(1),Ua(e.caseContent.getSize())}}function Y0(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",13),ga(2,"circle",14),la(3,Z0,2,3,"text",15),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ra("points",n.getHexaCoordsAt(e.coord)),Ts(1),Ia("id","captured_",e.coord.x,"_",e.coord.y,""),ha("ngClass",n.getPieceClasses(e.caseContent)),ra("cx",n.getCenterAt(e.coord).x)("cy",n.getCenterAt(e.coord).y)("r",n.SPACE_SIZE),Ts(1),ha("ngIf",e.caseContent.getSize()>1)}}function K0(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",17),ga(2,"polyline",17),ya()),2&e){const e=ba();Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().coord)),Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().end))}}function J0(e,t){if(1&e&&(Cn(),ga(0,"polyline",18)),2&e){const e=ba();ra("points",e.getHexaCoordsAt(e.chosen.get()))}}let Q0=(()=>{class e extends iQ{constructor(e){super(e),this.lastMove=yw.empty(),this.chosen=yw.empty(),this.disconnecteds=[],this.rules=new k0(O0),this.availableMinimaxes=[new A0(this.rules,"DvonnMinimax"),new M0(this.rules,"DvonnMinimaxMaximizeStacks")],this.encoder=T0.encoder,this.tutorial=(new $0).tutorial,this.SPACE_SIZE=30,this.canPass=!1,this.scores=yw.of(k0.getScores(this.rules.node.gameState)),this.hexaLayout=new aQ(1.5*this.SPACE_SIZE,new nQ(-this.SPACE_SIZE,2*this.SPACE_SIZE),cQ.INSTANCE),this.state=this.rules.node.gameState,this.hexaBoard=this.rules.node.gameState.board}hideLastMove(){this.lastMove=yw.empty()}updateBoard(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=yw.of(k0.getScores(this.state))}calculateDisconnecteds(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState;for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[n].length;r++){const i=new nQ(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){const s=t.getPieceAt(i),o=e.getPieceAt(i);if(s.isEmpty()&&!o.isEmpty()){const e={coord:new nQ(r,n),caseContent:o};this.disconnecteds.push(e)}}}}cancelMoveAttempt(){this.chosen=yw.empty()}pass(){var e=this;return hw(function*(){return zG(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),yield e.chooseMove(T0.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosen.isAbsent()?n.choosePiece(e,t):n.chosen.equalsValue(new nQ(e,t))?(n.cancelMoveAttempt(),FG.SUCCESS):yield n.chooseDestination(e,t)})()}choosePiece(e,t){const n=new nQ(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=yw.of(n),FG.SUCCESS):this.cancelMove(r.getReason())}chooseDestination(e,t){var n=this;return hw(function*(){const r=n.chosen.get(),i=new nQ(e,t),s=T0.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];const t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-dvonn"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,j0,2,3,"g",1),la(2,Y0,4,8,"g",1),la(3,K0,3,2,"ng-container",2),la(4,J0,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.state.allCoords()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();var X0=(()=>(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(X0||(X0={})),X0))();class e2{constructor(e){this.value=e}static of(e){switch(e){case 0:return e2.SMALL_BLACK;case 1:return e2.SMALL_WHITE;case 2:return e2.MEDIUM_BLACK;case 3:return e2.MEDIUM_WHITE;case 4:return e2.BIG_BLACK;case 5:return e2.BIG_WHITE;case 6:return e2.EMPTY;default:throw new Error("Invalid value "+e+" for EncapsulePiece")}}static ofSizeAndPlayer(e,t){return t===YY.ZERO&&e===X0.BIG?e2.BIG_BLACK:t===YY.ZERO&&e===X0.MEDIUM?e2.MEDIUM_BLACK:t===YY.ZERO&&e===X0.SMALL?e2.SMALL_BLACK:t===YY.ONE&&e===X0.BIG?e2.BIG_WHITE:t===YY.ONE&&e===X0.MEDIUM?e2.MEDIUM_WHITE:t===YY.ONE&&e===X0.SMALL?e2.SMALL_WHITE:e2.EMPTY}getPlayer(){switch(this){case e2.SMALL_BLACK:case e2.MEDIUM_BLACK:case e2.BIG_BLACK:return YY.ZERO;case e2.SMALL_WHITE:case e2.MEDIUM_WHITE:case e2.BIG_WHITE:return YY.ONE;default:return KY.NONE}}getSize(){switch(this){case e2.BIG_BLACK:case e2.BIG_WHITE:return X0.BIG;case e2.MEDIUM_BLACK:case e2.MEDIUM_WHITE:return X0.MEDIUM;case e2.SMALL_BLACK:case e2.SMALL_WHITE:return X0.SMALL;default:return dw.expectToBe(this,e2.EMPTY),X0.NONE}}belongsTo(e){return this.getPlayer()===e}equals(e){return this===e}toString(){switch(this){case e2.BIG_BLACK:return"BIG_BLACK";case e2.BIG_WHITE:return"BIG_WHITE";case e2.MEDIUM_BLACK:return"MEDIUM_BLACK";case e2.MEDIUM_WHITE:return"MEDIUM_WHITE";case e2.SMALL_BLACK:return"SMALL_BLACK";case e2.SMALL_WHITE:return"SMALL_WHITE";default:return dw.expectToBe(this,e2.EMPTY),"EMPTY"}}}e2.SMALL_BLACK=new e2(0),e2.SMALL_WHITE=new e2(1),e2.MEDIUM_BLACK=new e2(2),e2.MEDIUM_WHITE=new e2(3),e2.BIG_BLACK=new e2(4),e2.BIG_WHITE=new e2(5),e2.EMPTY=new e2(6);class t2 extends yQ{constructor(e,t,n){super(e,t),this.remainingPieces=n}static getInitialState(){const e=new n2(KY.NONE,KY.NONE,KY.NONE).encode(),t=eK.createTable(3,3,e),n=eK.mapBiArray(t,e=>n2.decode(e));return new t2(n,0,[e2.BIG_BLACK,e2.BIG_BLACK,e2.BIG_WHITE,e2.BIG_WHITE,e2.MEDIUM_BLACK,e2.MEDIUM_BLACK,e2.MEDIUM_WHITE,e2.MEDIUM_WHITE,e2.SMALL_BLACK,e2.SMALL_BLACK,e2.SMALL_WHITE,e2.SMALL_WHITE])}getRemainingPieces(){return eK.copyImmutableArray(this.remainingPieces)}getRemainingPiecesOfPlayer(e){return this.getRemainingPieces().filter(t=>t.getPlayer()===e)}pieceBelongsToCurrentPlayer(e){return e.belongsTo(this.getCurrentPlayer())}isDroppable(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}isInRemainingPieces(e){return this.remainingPieces.some(t=>t===e)}getPlayerRemainingPieces(){return this.remainingPieces.filter(e=>this.pieceBelongsToCurrentPlayer(e))}}class n2{constructor(e,t,n){this.small=e,this.medium=t,this.big=n}static decode(e){zG(e%1==0,"EncapsuleCase must be encoded as integer: "+e),zG(e>=0,"To small representation for EncapsuleCase: "+e),zG(e<=26,"To big representation for EncapsuleCase: "+e);const t=YY.numberEncoder.decodeNumber(e%3);e-=t.value;const n=YY.numberEncoder.decodeNumber((e/=3)%3);e-=n.value;const r=YY.numberEncoder.decodeNumber(e/=3);return new n2(t,n,r)}isEmpty(){return this.small===KY.NONE&&this.medium===KY.NONE&&this.big===KY.NONE}toList(){const e=[];return this.small.isPlayer()&&e.push(e2.ofSizeAndPlayer(X0.SMALL,this.small)),this.medium.isPlayer()&&e.push(e2.ofSizeAndPlayer(X0.MEDIUM,this.medium)),this.big.isPlayer()&&e.push(e2.ofSizeAndPlayer(X0.BIG,this.big)),e}toOrderedPieceNames(){const e=e2.ofSizeAndPlayer(X0.SMALL,this.small),t=e2.ofSizeAndPlayer(X0.MEDIUM,this.medium),n=e2.ofSizeAndPlayer(X0.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}getBiggest(){return this.big===YY.ZERO?e2.BIG_BLACK:this.big===YY.ONE?e2.BIG_WHITE:this.medium===YY.ZERO?e2.MEDIUM_BLACK:this.medium===YY.ONE?e2.MEDIUM_WHITE:this.small===YY.ZERO?e2.SMALL_BLACK:this.small===YY.ONE?e2.SMALL_WHITE:e2.EMPTY}tryToSuperposePiece(e){const t=this.getBiggest().getSize();if(e===e2.EMPTY)throw new Error("Cannot move EMPTY on a space");return e.getSize()>t?yw.of(this.put(e)):yw.empty()}removeBiggest(){const e=this.getBiggest();if(e===e2.EMPTY)throw new Error("Cannot removed piece from empty space");let t;const n=e.getSize();switch(n){case X0.BIG:t=new n2(this.small,this.medium,KY.NONE);break;case X0.MEDIUM:t=new n2(this.small,KY.NONE,KY.NONE);break;default:dw.expectToBe(n,X0.SMALL),t=new n2(KY.NONE,KY.NONE,KY.NONE)}return{removedCase:t,removedPiece:e}}put(e){if(e===e2.EMPTY)throw new Error("Cannot put EMPTY on space");const t=e.getPlayer(),n=e.getSize();switch(n){case X0.BIG:return new n2(this.small,this.medium,t);case X0.MEDIUM:return zG(this.big===KY.NONE,"Cannot put a piece on top of a bigger one"),new n2(this.small,t,this.big);default:return dw.expectToBe(n,X0.SMALL),zG(this.big===KY.NONE,"Cannot put a piece on top of a bigger one"),zG(this.medium===KY.NONE,"Cannot put a piece on top of a bigger one"),new n2(t,this.medium,this.big)}}encode(){return this.small.value+3*this.medium.value+9*this.big.value}belongsTo(e){return this.getBiggest().getPlayer()===e}toString(){const e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}n2.EMPTY=new n2(KY.NONE,KY.NONE,KY.NONE);let r2=(()=>{class e{}return e.PIECE_OUT_OF_STOCK=()=>$localize`You do not have pieces of this type anymore.`,e.INVALID_PLACEMENT=()=>$localize`You must put your piece on an empty square or on a smaller piece.`,e.NOT_DROPPABLE=()=>$localize`You must pick your piece among the remaining ones.`,e.INVALID_PIECE_SELECTED=()=>$localize`You must pick one of your remaining pieces or one piece on the board that is the biggest of its square.`,e.SAME_DEST_AS_ORIGIN=()=>$localize`You must select a different landing square than the square where the move originates from.`,e.END_YOUR_MOVE=()=>$localize`You are performing a move, you must select a landing square.`,e})();class i2 extends IQ{static isVictory(e){const t=e.getCopiedBoard();for(const n of i2.LINES){const e=i2.isVictoriousLine([t[n[0].y][n[0].x],t[n[1].y][n[1].x],t[n[2].y][n[2].x]]);if(e.isPresent())return e}return yw.empty()}static isVictoriousLine(e){const t=e.map(e=>e.getBiggest()).map(e=>e.getPlayer());return t[0]===KY.NONE?yw.empty():t[0]===t[1]&&t[1]===t[2]?yw.of(t[0]):yw.empty()}static isLegal(e,t){let n;if(pw(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return RG.failure(r2.PIECE_OUT_OF_STOCK())}else{const r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE())}const r=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return r.isPresent()?RG.success(r.get()):RG.failure(r2.INVALID_PLACEMENT())}isLegal(e,t){return i2.isLegal(e,t)}applyLegalMove(e,t,n){const r=t.getCopiedBoard();let i=t.getRemainingPieces();const s=t.turn+1;let o;if(r[e.landingCoord.y][e.landingCoord.x]=n2.decode(n.encode()),e.isDropping()){o=e.piece.get();const t=i.indexOf(o);i=i.slice(0,t).concat(i.slice(t+1))}else{const t=e.startingCoord.get(),n=r[t.y][t.x].encode(),i=n2.decode(n).removeBiggest();r[t.y][t.x]=n2.decode(i.removedCase.encode()),o=i.removedPiece}return new t2(r,s,i)}static getGameStatus(e){const t=i2.isVictory(e.gameState);return t.isPresent()?TQ.getVictory(t.get()):TQ.ONGOING}getGameStatus(e){return i2.getGameStatus(e)}}i2.LINES=[[new nQ(0,0),new nQ(0,1),new nQ(0,2)],[new nQ(1,0),new nQ(1,1),new nQ(1,2)],[new nQ(2,0),new nQ(2,1),new nQ(2,2)],[new nQ(0,0),new nQ(1,0),new nQ(2,0)],[new nQ(0,1),new nQ(1,1),new nQ(2,1)],[new nQ(0,2),new nQ(1,2),new nQ(2,2)],[new nQ(0,0),new nQ(1,1),new nQ(2,2)],[new nQ(0,2),new nQ(1,1),new nQ(2,0)]];class s2 extends _Q{constructor(e,t,n){super(),this.startingCoord=e,this.landingCoord=t,this.piece=n}static fromMove(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new s2(yw.of(e),t,yw.empty())}static fromDrop(e,t){return new s2(yw.empty(),t,yw.of(e))}isDropping(){return this.startingCoord.isAbsent()}equals(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}toString(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}s2.encoder=new class extends jY{maxValue(){return 161}encodeNumber(e){const t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){const r=0;return 18*e.piece.get().value+6*t+2*n+r}{const r=1,i=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*i+6*t+2*n+r}}decodeNumber(e){const t=e%2;e-=t;const n=(e/=2)%3;e-=n;const r=(e/=3)%3;e-=r,e/=3;const i=new nQ(r,n);if(0===t){const t=e2.of(e);return s2.fromDrop(t,i)}{const t=e%3;e-=t;const n=new nQ((e/=3)%3,t);return s2.fromMove(n,i)}}};class o2 extends dQ{getBoardValue(e){const t=i2.getGameStatus(e);return new pQ(t.toBoardValue())}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),s=fQ.toComparableObjectSet(n.getPlayerRemainingPieces());for(let o=0;o<3;o++)for(let e=0;e<3;e++){const a=new nQ(e,o);for(const e of s){const r=s2.fromDrop(e,a);i2.isLegal(r,n).isSuccess()&&t.push(r)}if(r[o][e].belongsTo(i))for(let e=0;e<3;e++)for(let r=0;r<3;r++){const i=new nQ(r,e);if(!i.equals(a)){const e=s2.fromMove(a,i);i2.isLegal(e,n).isSuccess()&&t.push(e)}}}return t}}const a2=new n2(KY.NONE,KY.NONE,KY.NONE),l2=new n2(YY.ZERO,KY.NONE,KY.NONE),c2=new n2(KY.NONE,YY.ZERO,KY.NONE),u2=new n2(KY.NONE,KY.NONE,YY.ZERO),h2=new n2(YY.ONE,KY.NONE,KY.NONE),d2=new n2(KY.NONE,KY.NONE,YY.ONE),p2=new n2(YY.ONE,YY.ZERO,KY.NONE),f2=new n2(YY.ZERO,YY.ZERO,KY.NONE);class g2{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`The goal of Encapsule is to align three of your pieces.
        Here, we have a victory of the dark player.`,new t2([[l2,h2,d2],[a2,c2,a2],[a2,a2,u2]],0,[e2.SMALL_BLACK,e2.MEDIUM_BLACK,e2.BIG_BLACK,e2.SMALL_WHITE,e2.MEDIUM_WHITE,e2.MEDIUM_WHITE,e2.BIG_WHITE])),NQ.anyMove($localize`Putting a piece`,$localize`This is the initial board. You're playing Dark.<br/><br/>
        Pick one of your piece on the side of the board and put it on the board.`,t2.getInitialState(),s2.fromDrop(e2.SMALL_BLACK,new nQ(1,1)),$localize`Congratulations!`),NQ.fromMove($localize`Moving`,$localize`Another possible action is to move one of your pieces that is already on the board.<br/><br/>
        Click on your dark piece and then on any empty square of the board.`,new t2([[l2,d2,a2],[a2,a2,a2],[a2,a2,a2]],0,[]),[s2.fromMove(new nQ(0,0),new nQ(2,0)),s2.fromMove(new nQ(0,0),new nQ(0,1)),s2.fromMove(new nQ(0,0),new nQ(1,1)),s2.fromMove(new nQ(0,0),new nQ(2,1)),s2.fromMove(new nQ(0,0),new nQ(0,2)),s2.fromMove(new nQ(0,0),new nQ(1,2)),s2.fromMove(new nQ(0,0),new nQ(2,2))],$localize`Congratulations!`,$localize`Failed. Try again.`),NQ.fromPredicate($localize`Particularity`,$localize`At Encapsule, pieces encapsulate each other.
        It is therefore possible to have up to three pieces per square!
        However, only the biggest piece of each square counts:
        you cannot win with a piece that is "hidden" by a bigger piece.
        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.
        Finally, you cannot encapsulate a piece with a smaller piece.
        You're playing Dark and you can win now in various ways.<br/><br/>
        Try to win by making a move, and not by putting a new piece on the board.`,new t2([[p2,a2,h2],[f2,d2,d2],[a2,a2,a2]],0,[e2.MEDIUM_BLACK,e2.BIG_BLACK,e2.MEDIUM_WHITE,e2.MEDIUM_WHITE]),s2.fromMove(new nQ(0,1),new nQ(0,2)),(e,t)=>{if(e.landingCoord.equals(new nQ(0,2))){if(e.isDropping())return FG.failure($localize`You won, but the exercise is to win while moving a piece!`);if(e.startingCoord.equalsValue(new nQ(0,1)))return FG.SUCCESS}return FG.failure($localize`Failed. Try again.`)},$localize`Congratulations!`)]}}function m2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(0,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Ta("id","piece_0_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(0,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}function y2(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onBoardClick(t,n)}),fa()}if(2&e){const e=t.$implicit,n=ba().index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(e)),ra("r",i.getPieceRadius(e))("cx",i.SPACE_SIZE*n+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function v2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),la(2,y2,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getRectClasses(n,r)),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngForOf",i.getListPieces(e))}}function _2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,v2,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function C2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",9),Ea("click",function(){const t=Gt(e).$implicit;return ba().onBoardClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function E2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return ba().onPieceClick(1,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ts(1),Ta("id","piece_1_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(1,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}let w2=(()=>{class e extends pX{constructor(e){super(e),this.INTER_PIECE_SPACE=20,this.lastLandingCoord=yw.empty(),this.lastStartingCoord=yw.empty(),this.chosenCoord=yw.empty(),this.chosenPiece=yw.empty(),this.remainingPieceLeftX=[],this.rules=new i2(t2),this.availableMinimaxes=[new o2(this.rules,"EncapsuleMinimax")],this.encoder=s2.encoder,this.tutorial=(new g2).tutorial,this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard();const e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=yw.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=yw.empty(),this.lastStartingCoord=yw.empty())}getListPieces(e){return e.toList()}getRemainingPieces(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(YY.of(e))}onBoardClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new nQ(e,t),s=n.rules.node.gameState;if(n.chosenCoord.isAbsent()){if(n.chosenCoord=yw.of(i),n.chosenPiece.isPresent()){const e=s2.fromDrop(n.chosenPiece.get(),i);return n.chooseMove(e,n.rules.node.gameState)}return!1===s.getPieceAt(i).belongsTo(s.getCurrentPlayer())?n.cancelMove(r2.INVALID_PIECE_SELECTED()):FG.SUCCESS}if(n.chosenCoord.equalsValue(i))return n.cancelMove(r2.SAME_DEST_AS_ORIGIN());{const e=s2.fromMove(n.chosenCoord.get(),i);return n.chooseMove(e,n.rules.node.gameState)}})()}cancelMoveAttempt(){this.chosenCoord=yw.empty(),this.chosenPiece=yw.empty(),this.chosenPieceIndex=-1}onPieceClick(e,t,n){var r=this;return hw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t.toString());return i.isFailure()?r.cancelMove(i.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(r2.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=yw.of(t),r.chosenPieceIndex=n,FG.SUCCESS):r.cancelMove(r2.END_YOUR_MOVE())})()}getRectClasses(e,t){return this.isSelected(e,t)?"moved":""}isSelected(e,t){const n=new nQ(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}getPieceClasses(e){return[this.getPieceStrokeClass(e)]}getPieceStrokeClass(e){const t=e.getPlayer();return zG(t.isPlayer(),"EncapsuleComponent.getPieceStrokeClass should only be called with actual pieces!"),"player"+t.value+"-stroke"}getPieceRadius(e){switch(e.getSize()){case X0.BIG:return 40;case X0.MEDIUM:return 30;default:return dw.expectToBe(e.getSize(),X0.SMALL),20}}getHighlightedCases(){const e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}getSidePieceClasses(e,t){const n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}isSelectedPiece(e){return this.chosenPiece.equalsValue(e)}calculateLeftX(){this.remainingPieceLeftX=[];for(let e=0;e<=1;e++){this.remainingPieceLeftX.push([]);const t=this.getRemainingPieces(e);for(let n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{const r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}getPieceLeftX(e,t){return this.remainingPieceLeftX[e][t]}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-encapsule"]],features:[Go],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",null,1),la(3,m2,2,5,"g",2),fa(),pa(4,"g",null,3),la(6,_2,2,1,"g",2),la(7,C2,2,4,"g",2),fa(),pa(8,"g",null,4),la(10,E2,2,5,"g",2),fa(),fa()),2&e&&(Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", 0)"),Ts(2),ha("ngForOf",t.getRemainingPieces(0)),Ts(1),ra("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCases()),Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),Ts(2),ha("ngForOf",t.getRemainingPieces(1)))},directives:[$d,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class S2 extends CQ{constructor(e,t,n,r,i){if(super(e,t),this.movedPieces=n,this.stepSize=r,this.direction=i,this.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+this.coord.toString()+".");if(n<1)throw new Error("Must select minimum one piece (got "+n+").");if(r<1)throw new Error("Step size must be minimum one (got "+r+").");if(r>n)throw new Error("Cannot move a phalanx further than its size (got step size "+r+" for "+n+" pieces).")}toString(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}equals(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}S2.encoder=new class extends jY{maxValue(){return 122303}encodeNumber(e){const t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%8;e-=t;const n=(e/=8)%7;e-=n;const r=(e/=7)%13;e-=r;const i=(e/=13)%12;e-=i;const s=e/=12,o=eQ.factory.fromInt(t);return new S2(s,i,r+1,n+1,o.get())}};class b2 extends yQ{static getInitialState(){const e=KY.NONE,t=YY.ONE,n=YY.ZERO;return new b2([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[n,n,n,n,n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n,n,n,n,n]],0)}count(e,t){let n=0;for(let r=0;r<14;r++)this.board[t][r]===e&&n++;return n}doesOwnPiece(e){for(let t=0;t<12;t++)for(let n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}let P2=(()=>{class e{}return e.PHALANX_IS_LEAVING_BOARD=()=>$localize`The move distance of your phalanx puts it out of the board.`,e.SOMETHING_IN_PHALANX_WAY=()=>$localize`There is something in the way of your phalanx.`,e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=()=>$localize`Your phalanx must be bigger than the one you are capturing.`,e.CASE_NOT_ALIGNED_WITH_SELECTED=()=>$localize`This square is not aligned with the selected piece.`,e.SINGLE_PIECE_MUST_MOVE_BY_ONE=()=>$localize`A single piece can only move by one square.`,e.SINGLE_PIECE_CANNOT_CAPTURE=()=>$localize`A single piece cannot make a capture.`,e.CASE_NOT_ALIGNED_WITH_PHALANX=()=>$localize`This square is not aligned with the direction of the phalanx.`,e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=()=>$localize`A phalanx can't contain pieces outside of the board.`,e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=()=>$localize`A phalanx cannot contain an empty square.`,e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=()=>$localize`A phalanx cannot contain a piece of the opponent.`,e})();class O2 extends IQ{static isLegal(e,t){const n=this.getPhalanxValidity(t,e);if(n.isFailure())return RG.failure(n.getReason());const r=this.getLandingStatus(t,e);if(r.isFailure())return r;const i=eK.copyBiArray(r.get()),s=t.getCurrentOpponent(),o=O2.getCaptureValidity(t,i,e,s);return o.isFailure()?o:RG.success(o.get())}static getPhalanxValidity(e,t){let n=t.coord,r=0;const i=e.getCurrentOpponent();for(;r<t.movedPieces;){if(n.isNotInRange(14,12))return FG.failure(P2.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());const s=e.getPieceAt(n);if(s===KY.NONE)return FG.failure(P2.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(s===i)return FG.failure(P2.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());n=n.getNext(t.direction,1),r++}return FG.SUCCESS}static getLandingStatus(e,t){const n=e.getCopiedBoard(),r=e.getCurrentPlayer();let i=t.coord,s=t.coord.getNext(t.direction,t.movedPieces),o=0;for(;o+1<t.stepSize;){if(n[i.y][i.x]=KY.NONE,n[s.y][s.x]=r,s.isNotInRange(14,12))return RG.failure(P2.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(s).isPlayer())return RG.failure(P2.SOMETHING_IN_PHALANX_WAY());o++,s=s.getNext(t.direction,1),i=i.getNext(t.direction,1)}return s.isNotInRange(14,12)?RG.failure(P2.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(s)===r?RG.failure(hQ.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=KY.NONE,n[s.y][s.x]=r,RG.success(n))}static getCaptureValidity(e,t,n,r){let i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1),s=0;for(;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(s>0&&(t[i.y][i.x]=KY.NONE),s++,s>=n.movedPieces)return RG.failure(P2.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return RG.success(t)}isLegal(e,t){return O2.isLegal(e,t)}applyLegalMove(e,t,n){return new b2(n,t.turn+1)}getGameStatus(e){const t=e.gameState,n=t.count(YY.ZERO,0),r=t.count(YY.ONE,11);if(t.turn%2==0){if(n>r)return TQ.ZERO_WON}else if(r>n)return TQ.ONE_WON;return!1===t.doesOwnPiece(YY.ZERO)?TQ.ONE_WON:!1===t.doesOwnPiece(YY.ONE)?TQ.ZERO_WON:TQ.ONGOING}}class T2 extends dQ{static getListMoves(e){const t=e.gameState.getCurrentPlayer(),n=e.gameState.getCurrentOpponent(),r=KY.NONE;let i=[];const s=e.gameState;let o;for(let a=0;a<12;a++)for(let e=0;e<14;e++){const l=new nQ(e,a);if(s.getPieceAt(l)===t)for(const c of eQ.DIRECTIONS){let u=1,h=l.getNext(c,1);for(;h.isInRange(14,12)&&s.getPieceAt(h)===t;)u+=1,h=h.getNext(c,1);let d=1;for(;h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===r;)o=new S2(e,a,u,d,c),i=this.addMove(i,o,s),d++,h=h.getNext(c,1);h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===n&&(o=new S2(e,a,u,d,c),i=this.addMove(i,o,s))}}return i}static addMove(e,t,n){return O2.isLegal(t,n).isSuccess()&&e.push(t),e}getListMoves(e){const t=T2.getListMoves(e);return eK.sortByDescending(t,e=>e.stepSize),t}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new pQ(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}getPieceCountPlusRowDomination(e){let t=0;for(let n=0;n<12;n++){let r=0;const i=[0,0];for(let s=0;s<14;s++){const o=new nQ(s,n),a=e.getPieceAt(o);if(a.isPlayer()){const n=a.getScoreModifier();t+=2002*n,i[a.value]=n,r+=n;for(const r of[eQ.UP_LEFT,eQ.UP,eQ.UP_RIGHT]){let i=o.getNext(r,1);for(;i.isInRange(14,12)&&e.getPieceAt(i)===a;)t+=1*n,i=i.getNext(r,1)}}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce((e,t)=>e+t)}return t}}class I2 extends dQ{getListMoves(e){const t=T2.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}orderMovesByPhalanxSizeAndFilter(e,t){return eK.sortByDescending(e,e=>e.movedPieces),e.length>40?e.filter(e=>!!this.moveIsCapture(e,t)||e.movedPieces*Math.random()>1):e}moveIsCapture(e,t){const n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new pQ(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}getPieceCountThenSupportThenAdvancement(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=new nQ(r,n),s=e.getPieceAt(i);if(s.isPlayer()){let r,o;s===YY.ZERO?(r=12-n,o=[eQ.UP_LEFT,eQ.UP,eQ.UP_RIGHT]):(r=n+1,o=[eQ.DOWN_LEFT,eQ.DOWN,eQ.DOWN_RIGHT]);const a=s.getScoreModifier();t+=r*a,t+=149629*a;for(const n of o){let r=i.getNext(n,1);for(;r.isInRange(14,12)&&e.getPieceAt(r)===s;)t+=337*a,r=r.getNext(n,1)}}}return t}}class k2 extends T2{constructor(){super(...arguments),this.DOMINANCE_FACTOR=20,this.DEFENSE_FACTOR=5,this.TERRITORY_FACTOR=2,this.OFFENSE_FACTOR=10,this.CENTER_FACTOR=5,this.MOBILITY_FACTOR=.12}getDominance(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new nQ(r,n));i.isPlayer()&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}getDefense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new nQ(n,11))===YY.ZERO&&(t+=YY.ZERO.getScoreModifier()),e.getPieceAt(new nQ(n,0))===YY.ONE&&(t+=YY.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}getTerritory(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new nQ(r,n));if(i.isPlayer()){for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const a=new nQ(r+s,n+o);if(a.isInRange(14,12)){const n=e.getPieceAt(a);(n===i||n===KY.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}getOffense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new nQ(n,0))===YY.ZERO&&(t+=YY.ZERO.getScoreModifier()),e.getPieceAt(new nQ(n,11))===YY.ONE&&(t+=YY.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}getCenter(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new nQ(r,n));i.isPlayer()&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}getMobility(e){let t=0,n=0,r=0;for(let i=0;i<12;i++)for(let s=0;s<14;s++){const o=new nQ(s,i),a=e.getPieceAt(o);if(a.isPlayer())for(const i of eQ.DIRECTIONS){let s=1,l=o.getNext(i,1);for(;l.isInRange(14,12)&&e.getPieceAt(l)===a;)s+=1,l=l.getNext(i,1);let c=1;for(;l.isInRange(14,12)&&c<=s&&e.getPieceAt(l)===KY.NONE;)c++,l=l.getNext(i,1);t+=c*c*a.getScoreModifier(),a===YY.ZERO?n=Math.max(n,c):a===YY.ONE&&(r=Math.max(r,c))}}return(t+n*YY.ZERO.getScoreModifier()+r*YY.ONE.getScoreModifier())*this.MOBILITY_FACTOR}getBoardValue(e){const t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new pQ(n.toBoardValue());const r=this.getDominance(t),i=this.getDefense(t),s=this.getTerritory(t),o=this.getCenter(t),a=this.getOffense(t),l=this.getMobility(t);return new pQ(r+i+s+o+a+l)}}const A2=KY.NONE,M2=YY.ZERO,N2=YY.ONE;class x2{constructor(){this.tutorial=[NQ.informational($localize`Initial board`,$localize`This is the initial board of Epaminondas.
        The top line is the starting line of Light.
        The bottom line is the starting line of Dark.`,b2.getInitialState()),NQ.informational($localize`Goal of the game (1/2)`,$localize`After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line
        than the number of pieces the opponent has on the player's starting line, the player wins.
        Here, it's Dark's turn to play: Dark has therefore won.`,new b2([[A2,A2,A2,A2,A2,M2,A2,A2,N2,N2,N2,N2,N2,N2],[A2,A2,A2,A2,A2,M2,A2,A2,A2,A2,A2,A2,N2,N2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,N2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,M2,M2,M2,M2,A2,A2,A2]],0)),NQ.informational($localize`Goal of the game (2/2)`,$localize`Here, it is Light's turn.
        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line.`,new b2([[A2,A2,A2,A2,A2,M2,A2,A2,A2,A2,N2,N2,N2,N2],[A2,A2,A2,A2,A2,M2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,N2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,N2,N2,A2,A2,A2,M2,M2,A2,M2,M2,M2,M2]],1)),NQ.fromPredicate($localize`Moving a piece`,$localize`Here is the starting board. Dark plays first.
        Let's start with moving a single piece:
        <ol>
            <li>Click on a piece.</li>
            <li>Click on a empty neighboring square.</li>
        </ol>`,b2.getInitialState(),new S2(0,10,1,1,eQ.UP),(e,t)=>1===e.movedPieces?FG.SUCCESS:FG.failure($localize`Congratulations, you are in advance. But this is not the exercise here, try again.`),$localize`This is how you move a single piece.`),NQ.fromPredicate($localize`Moving a phalanx`,$localize`Let us now see how to move multiple pieces along a line, which is called a phalanx:
        <ol>
            <li>Click on the first piece of the phalanx.</li>
            <li>Click on the last piece of the phalanx.</li>
            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>
        </ol><br/>
        Move a phalanx!`,b2.getInitialState(),new S2(0,11,2,1,eQ.UP),(e,t)=>e.movedPieces>1?FG.SUCCESS:FG.failure($localize`Failed! You moved only one piece.`),$localize`Congratulations!
        The moved pieces can be horizontally, vertically, or diagonally aligned.
        The move should be made along this axis, forward or backwards.
        There can be no opponent nor holes in the phalanx.`),NQ.fromMove($localize`Capture`,$localize`In order to capture pieces of the opponent:
        <ol>
            <li>It must be aligned with the phalanx you are moving.</li>
            <li>It must be strictly shorter than your phalanx.</li>
            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>
        </ol><br/>
        Capture a phalanx.`,new b2([[A2,A2,A2,A2,A2,A2,A2,A2,N2,N2,N2,N2,N2,N2],[A2,A2,A2,A2,A2,A2,N2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,N2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,N2,A2,N2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,N2,N2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,N2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,M2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,M2,A2,A2,A2,A2,N2,A2,A2,A2,A2,A2,A2],[A2,A2,M2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,M2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2,A2],[A2,A2,A2,A2,A2,A2,A2,M2,M2,M2,M2,M2,M2,M2]],0),[new S2(2,10,4,2,eQ.UP)],$localize`Congratulations, you made it!
        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment.`,$localize`Failed, you have not captured the phalanx.`)]}}function R2(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",4),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(e,t)),ra("r",.5*(n.SPACE_SIZE-2*n.STROKE_WIDTH))("cx",n.SPACE_SIZE*e+n.STROKE_WIDTH+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.STROKE_WIDTH+n.SPACE_SIZE/2)}}function D2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,R2,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e+r.STROKE_WIDTH)("y",r.SPACE_SIZE*n+r.STROKE_WIDTH)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.NONE)}}function L2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,D2,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function F2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",5),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let U2=(()=>{class e extends pX{constructor(e){super(e),this.NONE=KY.NONE,this.firstPiece=yw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=yw.empty(),this.phalanxDirection=yw.empty(),this.phalanxMiddles=[],this.moveds=[],this.captureds=[],this.rules=new O2(b2),this.availableMinimaxes=[new T2(this.rules,"Normal"),new I2(this.rules,"Positional"),new k2(this.rules,"Attack")],this.encoder=S2.encoder,this.tutorial=(new x2).tutorial,this.updateBoard()}updateBoard(){this.firstPiece=yw.empty(),this.lastPiece=yw.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}showPreviousMove(){const e=this.rules.node.move.get();let t=e.coord;this.moveds=[t];for(let i=1;i<e.stepSize+e.movedPieces;i++)t=t.getNext(e.direction,1),this.moveds.push(t);const n=this.rules.node.mother.get(),r=n.gameState.getCurrentOpponent();for(;t.isInRange(14,12)&&n.gameState.getPieceAt(t)===r;)this.captureds.push(t),t=t.getNext(e.direction,1)}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t)})()}firstClick(e,t){var n=this;return hw(function*(){const r=n.rules.node.gameState.getCurrentOpponent(),i=n.rules.node.gameState.getCurrentPlayer();switch(n.board[t][e]){case i:return n.firstPiece=yw.of(new nQ(e,t)),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),FG.SUCCESS;case r:return n.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE());default:return dw.expectToBe(n.board[t][e],KY.NONE),n.cancelMove(hQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())}})()}hidePreviousMove(){this.captureds=[],this.moveds=[]}getValidExtensions(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}getFirstPieceExtensions(e){const t=[];for(const n of eQ.DIRECTIONS){let r=this.firstPiece.get().getNext(n,1);for(;r.isInRange(14,12)&&this.board[r.y][r.x]===e;)t.push(r),r=r.getNext(n,1)}return t}getPhalanxValidExtensions(e){let t=eQ.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get();const n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();const i=this.firstPiece.get().getNext(t,1),s=this.getExtensionsToward(i,t,e);return r.concat(s)}getExtensionsToward(e,t,n){const r=[];for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}getPhalanxValidLandings(){if(this.lastPiece.isPresent()){const e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1;let s=eQ.factory.fromMove(e,t).get();const o=t.getNext(s,1),a=this.getLandingsToward(o,s,i);s=s.getOpposite();const l=e.getNext(s,1);return this.getLandingsToward(l,s,i).concat(a)}return this.getNeighbooringEmptyCases()}getNeighbooringEmptyCases(){const e=[];for(const t of eQ.DIRECTIONS){const n=this.firstPiece.get().getNext(t,1);n.isInRange(14,12)&&this.board[n.y][n.x]===KY.NONE&&e.push(n)}return e}getLandingsToward(e,t,n){const r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),s=[];for(;e.isInRange(14,12)&&s.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&s.push(e),s;s.push(e),e=e.getNext(t,1)}return s}getPhalanxLength(e,t,n){let r=0;for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}cancelMoveAttempt(){this.firstPiece=yw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=yw.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}secondClick(e,t){var n=this;return hw(function*(){const r=new nQ(e,t),i=n.firstPiece.get();if(r.equals(i))return n.cancelMoveAttempt(),FG.SUCCESS;const s=n.rules.node.gameState.getCurrentOpponent(),o=n.rules.node.gameState.getCurrentPlayer();if(!r.isAlignedWith(i))return n.cancelMove(P2.CASE_NOT_ALIGNED_WITH_SELECTED());const a=r.getDistance(i),l=i.getDirectionToward(r).get();switch(n.board[t][e]){case KY.NONE:return 1===a?n.tryMove(new S2(i.x,i.y,1,1,l)):n.cancelMove(P2.SINGLE_PIECE_MUST_MOVE_BY_ONE());case s:return n.cancelMove(P2.SINGLE_PIECE_CANNOT_CAPTURE());default:dw.expectToBe(n.board[t][e],o);const c=new S2(i.x,i.y,a,1,l),u=O2.getPhalanxValidity(n.rules.node.gameState,c);return u.isFailure()?n.cancelMove(u.getReason()):(n.lastPiece=yw.of(r),n.validExtensions=n.getValidExtensions(o),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=i.getCoordsToward(r),n.phalanxDirection=yw.of(l),FG.SUCCESS)}})()}thirdClick(e,t){var n=this;return hw(function*(){const r=n.rules.node.gameState.getCurrentPlayer(),i=new nQ(e,t);if(n.firstPiece.equalsValue(i))return n.moveFirstPiece(r);if(n.lastPiece.equalsValue(i))return n.moveLastPiece(r);const s=n.firstPiece.get(),o=n.lastPiece.get();if(!i.isAlignedWith(s))return n.cancelMove(P2.CASE_NOT_ALIGNED_WITH_PHALANX());let a=eQ.factory.fromMove(s,o).get();const l=eQ.factory.fromMove(s,i).get();if(a===l.getOpposite()&&(n.firstPiece=yw.of(o),n.lastPiece=yw.of(s),a=l),a!==l)return n.cancelMove(P2.CASE_NOT_ALIGNED_WITH_PHALANX());if(n.board[t][e]===r){n.lastPiece=yw.of(i);const e=n.firstPiece.get().getDistance(i)+1,t=new S2(n.firstPiece.get().x,n.firstPiece.get().y,e,1,a),s=O2.getPhalanxValidity(n.rules.node.gameState,t);return s.isFailure()?n.cancelMove(s.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(r),n.phalanxValidLandings=n.getPhalanxValidLandings(),FG.SUCCESS)}{const e=n.firstPiece.get().getDistance(n.lastPiece.get())+1,t=n.lastPiece.get().getDistance(i),r=new S2(n.firstPiece.get().x,n.firstPiece.get().y,e,t,a);return n.tryMove(r)}})()}moveFirstPiece(e){var t=this;return hw(function*(){return t.firstPiece=yw.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?yield t.moveOnlyPiece(e):(t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e)),t.phalanxValidLandings=t.getPhalanxValidLandings(),FG.SUCCESS})()}moveLastPiece(e){var t=this;return hw(function*(){return t.lastPiece=yw.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),FG.SUCCESS)})()}moveOnlyPiece(e){var t=this;return hw(function*(){return t.lastPiece=yw.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=yw.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),FG.SUCCESS})()}tryMove(e){const t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}getPieceClasses(e,t){const n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}getPieceStrokeClasses(e,t){const n=new nQ(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(e=>e.equals(n))?["highlighted"]:[]}getRectClasses(e,t){const n=new nQ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:this.moveds.some(e=>e.equals(n))?["moved"]:[]}getHighlightedCoords(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}getCurrentPlayerPieces(){const e=[],t=this.rules.node.gameState.getCurrentPlayer();for(let n=0;n<this.board.length;n++)for(let r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new nQ(r,n));return e}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-epaminondas"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,L2,2,1,"g",1),la(2,F2,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCoords()))},directives:[$d,Bd,Hd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();function B2(e){return new class extends qY{encode(t){return t.isPresent()?e.encode(t.get()):null}decode(t){return null===t?yw.empty():yw.of(e.decode(t))}}}class V2{constructor(e){if(e.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===S0.areOnSameLine(e))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=eK.copyImmutableArray(e).sort((e,t)=>{if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});let t=yw.empty();for(const n of this.capturedSpaces){if(t.isPresent()&&1!==t.get().getDistance(n))throw new Error("Cannot create a GipfCapture with non-consecutive cases");t=yw.of(n)}}toString(){let e="";for(const t of this.capturedSpaces)""!==e&&(e+=","),e+=t.toString();return e}size(){return this.capturedSpaces.length}forEach(e){this.capturedSpaces.forEach(e)}contains(e){for(let t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}intersectsWith(e){return this.capturedSpaces.some(t=>e.contains(t))}getLine(){return S0.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}equals(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(let t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}V2.encoder=new class extends qY{encode(e){return e.capturedSpaces.map(e=>nQ.encoder.encode(e))}decode(e){return new V2(e.map(e=>nQ.encoder.decode(e)))}};class $2{constructor(e,t){this.coord=e,this.direction=t}toString(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}equals(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}$2.encoder=new class extends qY{constructor(){super(...arguments),this.optionalDirectionEncoder=B2(oQ.encoder)}encode(e){return{coord:nQ.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}decode(e){const t=e;return zG(null!=t.coord,"Invalid encoded GipfPlacement"),new $2(nQ.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}};class z2 extends _Q{constructor(e,t,n){super(),this.placement=e,this.initialCaptures=t,this.finalCaptures=n}toString(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}equals(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===eK.compareArray(this.initialCaptures,e.initialCaptures)||!1===eK.compareArray(this.finalCaptures,e.finalCaptures))}encode(){return z2.encoder.encode(this)}decode(e){return z2.encoder.decode(e)}}z2.encoder=new class extends WY{encodeMove(e){const t={placement:$2.encoder.encode(e.placement)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=V2.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=V2.encoder.encode(e)}),t}decodeMove(e){const t=e;return zG(null!=t.placement,"Invalid encoded GipfMove"),new z2($2.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",V2.encoder.decode),this.decodeArray(t,"finalCapture",V2.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class H2 extends b0{constructor(e,t,n,r){super(t,e,7,7,[3,2,1],sQ.EMPTY),this.sidePieces=n,this.capturedPieces=r}static getInitialState(){const e=sQ.EMPTY,t=sQ.UNREACHABLE,n=sQ.ZERO,r=sQ.ONE;return new H2([[t,t,t,r,e,e,n],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[n,e,e,e,e,e,r],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[r,e,e,n,t,t,t]],0,[12,12],[0,0])}equals(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&eK.compareTable(this.board,e.board)}getNumberOfPiecesToPlace(e){return this.sidePieces[e.value]}getNumberOfPiecesCaptured(e){return this.capturedPieces[e.value]}setAtUnsafe(e,t){const n=eK.copyBiArray(this.board);return n[e.y][e.x]=t,new H2(n,this.turn,this.sidePieces,this.capturedPieces)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==sQ.UNREACHABLE}}let G2=(()=>{class e{}return e.CAPTURE_MUST_BE_ALIGNED=()=>$localize`You can only capture when 4 or more of your pieces are aligned, and it is not the case.`,e.INVALID_CAPTURED_PIECES=()=>$localize`You must select a valid capture that contains 4 pieces or more.`,e.MISSING_CAPTURES=()=>$localize`There are still possible captures to be done.`,e.PLACEMENT_NOT_ON_BORDER=()=>$localize`Pieces must be inserted in spaces on the edge of the board.`,e.INVALID_PLACEMENT_DIRECTION=()=>$localize`You must select a valid placement direction.`,e.PLACEMENT_WITHOUT_DIRECTION=()=>$localize`You must select a placement with a direction alongside the insertion space.`,e.PLACEMENT_ON_COMPLETE_LINE=()=>$localize`You cannot place a piece on a complete line.`,e.AMBIGUOUS_CAPTURE_COORD=()=>$localize`This piece belongs to two captures. Please select another piece in the capture you'd like to make.`,e.CLICK_FURTHER_THAN_ONE_COORD=()=>$localize`You must click on an arrow to select your destination.`,e.NO_DIRECTIONS_AVAILABLE=()=>$localize`You cannot insert a piece here, as all lines are full. Select another space.`,e})();class q2 extends IQ{applyLegalMove(e,t,n){return new H2(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}static applyCaptures(e,t){let n=e;return t.forEach(e=>{n=q2.applyCapture(n,e)}),n}static applyCapture(e,t){const n=e.getCurrentPlayer();let r=e;const i=[e.sidePieces[0],e.sidePieces[1]],s=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(t=>{const o=e.getPieceAt(t);r=r.setAt(t,sQ.EMPTY),o.is(n)?i[n.value]+=1:s[n.value]+=1}),new H2(r.board,e.turn,i,s)}static getPlacements(e){const t=[];return uQ.INSTANCE.getAllBorders(e).forEach(n=>{e.getPieceAt(n)===sQ.EMPTY?t.push(new $2(n,yw.empty())):q2.getAllDirectionsForEntrance(e,n).forEach(r=>{!1===q2.isLineComplete(e,n,r)&&t.push(new $2(n,yw.of(r)))})}),t}static isLineComplete(e,t,n){return q2.nextGapInLine(e,t,n).isAbsent()}static nextGapInLine(e,t,n){for(let r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===sQ.EMPTY)return yw.of(r);return yw.empty()}static applyPlacement(e,t){const n=e.getCurrentPlayer();let r=e,i=sQ.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){const n=t.coord;if(e.getPieceAt(n)!==sQ.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(n,i)}else for(let o=t.coord;r.isOnBoard(o)&&i!==sQ.EMPTY;o=o.getNext(t.direction.get())){const t=e.getPieceAt(o);r=r.setAt(o,i),i=t}const s=[e.sidePieces[0],e.sidePieces[1]];return s[n.value]-=1,new H2(r.board,e.turn,s,e.capturedPieces)}getPiecesMoved(e,t,n){const r=q2.applyCaptures(e,t);if(n.direction.isAbsent())return[n.coord];{const e=n.direction.get(),t=[];t.push(n.coord);let i=n.coord.getNext(e);for(;r.isOnBoard(i)&&r.getPieceAt(i)!==sQ.EMPTY;)t.push(i),i=i.getNext(e);return zG(r.isOnBoard(i)&&r.getPieceAt(i)===sQ.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),t.push(i),t}}static getAllDirectionsForEntrance(e,t){if(uQ.INSTANCE.isTopLeftCorner(e,t))return[oQ.RIGHT,oQ.DOWN,oQ.UP_RIGHT];if(uQ.INSTANCE.isTopCorner(e,t))return[oQ.DOWN,oQ.DOWN_LEFT,oQ.RIGHT];if(uQ.INSTANCE.isTopRightCorner(e,t))return[oQ.DOWN_LEFT,oQ.DOWN,oQ.LEFT];if(uQ.INSTANCE.isBottomLeftCorner(e,t))return[oQ.UP_RIGHT,oQ.UP,oQ.RIGHT];if(uQ.INSTANCE.isBottomCorner(e,t))return[oQ.UP,oQ.LEFT,oQ.UP_RIGHT];if(uQ.INSTANCE.isBottomRightCorner(e,t))return[oQ.LEFT,oQ.UP,oQ.DOWN_LEFT];if(uQ.INSTANCE.isOnTopLeftBorder(e,t))return[oQ.RIGHT,oQ.DOWN];if(uQ.INSTANCE.isOnLeftBorder(e,t))return[oQ.UP_RIGHT,oQ.RIGHT];if(uQ.INSTANCE.isOnBottomLeftBorder(e,t))return[oQ.UP,oQ.UP_RIGHT];if(uQ.INSTANCE.isOnBottomRightBorder(e,t))return[oQ.LEFT,oQ.UP];if(uQ.INSTANCE.isOnRightBorder(e,t))return[oQ.LEFT,oQ.DOWN_LEFT];if(uQ.INSTANCE.isOnTopRightBorder(e,t))return[oQ.DOWN_LEFT,oQ.DOWN];throw new Error("not a border")}isLegal(e,t){const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=q2.applyCaptures(t,e.initialCaptures),i=this.noMoreCapturesValidity(r);if(i.isFailure())return i.toFailedFallible();const s=this.placementValidity(r,e.placement);if(s.isFailure())return s.toFailedFallible();const o=q2.applyPlacement(r,e.placement),a=this.capturesValidity(o,e.finalCaptures);if(a.isFailure())return a.toFailedFallible();const l=q2.applyCaptures(o,e.finalCaptures),c=this.noMoreCapturesValidity(l);return c.isFailure()?c.toFailedFallible():RG.success(l)}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=q2.applyCapture(n,r)}return FG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer(),r=q2.getLinePortionWithFourPiecesOfPlayer(e,n,t.getLine());if(r.isAbsent())return FG.failure(G2.CAPTURE_MUST_BE_ALIGNED());const i=r.get();return q2.getCapturable(e,i).equals(t)?FG.SUCCESS:FG.failure(G2.INVALID_CAPTURED_PIECES())}static getLinePortionsWithFourPiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=q2.getLinePortionWithFourPiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}static getLinePortionWithFourPiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o=i;for(let a=i;e.isOnBoard(a);a=a.getNext(s))if(e.getPieceAt(a).is(t)?(0===r&&(o=a),r+=1):r=0,4===r)return yw.of({0:o,1:a,2:s});return yw.empty()}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===q2.getLinePortionsWithFourPiecesOfPlayer(e,t).length?FG.SUCCESS:FG.failure(G2.MISSING_CAPTURES())}placementValidity(e,t){const n=this.placementCoordValidity(e,t.coord);if(n.isFailure())return n;if(e.getPieceAt(t.coord)!==sQ.EMPTY){if(t.direction.isAbsent())return FG.failure(G2.PLACEMENT_WITHOUT_DIRECTION());if(q2.isLineComplete(e,t.coord,t.direction.get()))return FG.failure(G2.PLACEMENT_ON_COMPLETE_LINE());for(const n of q2.getAllDirectionsForEntrance(e,t.coord))if(n===t.direction.get())return FG.SUCCESS;return FG.failure(G2.INVALID_PLACEMENT_DIRECTION())}return FG.SUCCESS}placementCoordValidity(e,t){return uQ.INSTANCE.isOnBorder(e,t)?FG.SUCCESS:FG.failure(G2.PLACEMENT_NOT_ON_BORDER())}static getCapturable(e,t){const n=[],r=t[0],i=t[1],s=t[2],o=s.getOpposite();let a=r.getNext(o);for(;e.isOnBoard(a)&&e.getPieceAt(a)!==sQ.EMPTY;)n.push(a),a=a.getNext(o);for(let l=r;!l.equals(i);l=l.getNext(s))n.push(l);for(let l=i;e.isOnBoard(l)&&e.getPieceAt(l)!==sQ.EMPTY;l=l.getNext(s))n.push(l);return new V2(n)}static getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return q2.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(t=>{n.push(q2.getCapturable(e,t))}),n}static getPlayerScore(e,t){const n=e.getNumberOfPiecesToPlace(t);if(0===n&&0===q2.getPossibleCaptures(e).length)return yw.empty();const r=e.getNumberOfPiecesCaptured(t);return yw.of(n+3*r)}static isGameOver(e){const t=q2.getPlayerScore(e,YY.ZERO),n=q2.getPlayerScore(e,YY.ONE);return t.isAbsent()||n.isAbsent()}getGameStatus(e){const t=e.gameState,n=q2.getPlayerScore(t,YY.ZERO),r=q2.getPlayerScore(t,YY.ONE);return n.isAbsent()?TQ.ONE_WON:r.isAbsent()?TQ.ZERO_WON:TQ.ONGOING}}class W2 extends dQ{static getPossibleCaptureCombinationsFromPossibleCaptures(e){const t=W2.computeIntersections(e);let n=[[]];return e.forEach((e,r)=>{if(0===t[r].length)n.forEach(e=>{e.push(r)});else{const e=[],i=t[r].some(e=>e>r);for(const s of n)!0===s.some(e=>t[r].some(t=>e===t))?e.push(eK.copyImmutableArray(s)):i?(e.push(eK.copyImmutableArray(s)),s.push(r),e.push(eK.copyImmutableArray(s))):(s.push(r),e.push(eK.copyImmutableArray(s)));n=e}}),n.map(t=>t.map(t=>e[t]))}static computeIntersections(e){const t=[];return e.forEach((n,r)=>{t.push([]),e.forEach((e,i)=>{r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}getBoardValue(e){const t=e.gameState,n=q2.getPlayerScore(t,YY.ZERO),r=q2.getPlayerScore(t,YY.ONE);return n.isAbsent()?new pQ(YY.ONE.getVictoryValue()):r.isAbsent()?new pQ(YY.ZERO.getVictoryValue()):new pQ(n.get()-r.get())}getListMoves(e){return this.getListMoveFromState(e.gameState)}getListMoveFromState(e){const t=[];return q2.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(n=>{const r=q2.applyCaptures(e,n);q2.getPlacements(r).forEach(e=>{const i=q2.applyPlacement(r,e);this.getPossibleCaptureCombinations(i).forEach(r=>{const i=new z2(e,n,r);t.push(i)})})}),t}getPossibleCaptureCombinations(e){const t=q2.getPossibleCaptures(e);return W2.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}class j2{constructor(e,t,n,r,i,s){this.source=e,this.destination=t,this.x1=n,this.y1=r,this.x2=i,this.y2=s}}const Z2=sQ.UNREACHABLE,Y2=sQ.EMPTY,K2=sQ.ZERO,J2=sQ.ONE;class Q2{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.
        This is the initial board.
        Each player has 12 pieces on the side and 3 pieces on the board.
        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.
        The first player plays with the dark pieces, the second player plays with the light pieces.`,H2.getInitialState()),NQ.anyMove($localize`Pushing`,$localize`Pieces can only enter the board through the edges. To insert a new piece:
        <ol>
            <li>Click on a space on the edge of the board.</li>
            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>
        </ol>
        You cannot push when a line is full.<br/><br/>
        You're playing Dark, insert a piece.`,H2.getInitialState(),new z2(new $2(new nQ(3,0),yw.of(oQ.DOWN)),[],[]),$localize`Congratulations!`),NQ.fromMove($localize`Capture (1/3)`,$localize`To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.
        There are multiple important aspects of a capture:
        <ol>
            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>
            <li>As soon as there is an empty space on the line, the capture stops.</li>
            <li>Your own pieces that are captured go back to your stock.
                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>
            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.
                This means that a turn happens in three phases:
                <ol type="A">
                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>
                    <li>Make your insertion.</li>
                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>
                </ol>
            </li>
        </ol><br/>
        You're playing Dark, you can make a capture, do it.`,new H2([[Z2,Z2,Z2,K2,J2,Y2,Y2],[Z2,Z2,Y2,Y2,Y2,Y2,Y2],[Z2,Y2,Y2,Y2,Y2,Y2,Y2],[K2,K2,K2,Y2,Y2,Y2,Y2],[J2,Y2,Y2,Y2,Y2,Y2,Z2],[Y2,Y2,Y2,J2,Y2,Z2,Z2],[Y2,Y2,Y2,J2,Z2,Z2,Z2]],42,[8,8],[0,0]),[new z2(new $2(new nQ(0,3),yw.of(oQ.RIGHT)),[],[new V2([new nQ(0,3),new nQ(1,3),new nQ(2,3),new nQ(3,3)])])],$localize`Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.
        Let's now see how captures can really be useful.`,$localize`Failed!`),NQ.fromMove($localize`Capture (2/3)`,$localize`Here, there are three different ways of capturing.
        <ol>
          <li>One way does not capture any of your opponent's pieces.</li>
          <li>Another way captures one of your opponent's pieces.</li>
          <li>The last way captures two of your opponent's pieces.</li>
        </ol>
        <br/><br/>
        Pick the last one.`,new H2([[Z2,Z2,Z2,Y2,Y2,Y2,Y2],[Z2,Z2,Y2,J2,Y2,Y2,Y2],[Z2,Y2,Y2,K2,Y2,Y2,Y2],[K2,K2,K2,J2,Y2,Y2,Y2],[Y2,Y2,Y2,K2,Y2,Y2,Z2],[Y2,Y2,Y2,K2,Y2,Z2,Z2],[Y2,Y2,Y2,J2,Z2,Z2,Z2]],42,[8,4],[2,3]),[new z2(new $2(new nQ(0,3),yw.of(oQ.RIGHT)),[],[new V2([new nQ(3,1),new nQ(3,2),new nQ(3,3),new nQ(3,4),new nQ(3,5),new nQ(3,6)])])],$localize`Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.
        The most you can get is 3 per capture.`,$localize`Failed, the best capture was taking 2 of your opponent's pieces`),NQ.fromMove($localize`Capture (3/3)`,$localize`Here, you must capture at the beginning of your turn.
        This is due to a move of your opponent at the previous turn
        (even though this is a fictitious board for pedagogical purpose).
        After your capture, by performing the right move you can even capture two more of your opponent's pieces!
        Keep it mind that the most useful in a capture is to take your opponent's pieces.`,new H2([[Z2,Z2,Z2,K2,Y2,Y2,K2],[Z2,Z2,Y2,K2,Y2,Y2,K2],[Z2,K2,K2,Y2,K2,J2,K2],[Y2,Y2,Y2,K2,Y2,Y2,K2],[Y2,Y2,Y2,K2,Y2,Y2,Z2],[K2,K2,K2,J2,J2,Z2,Z2],[Y2,Y2,Y2,K2,Z2,Z2,Z2]],42,[8,4],[2,3]),[new z2(new $2(new nQ(3,6),yw.of(oQ.UP)),[new V2([new nQ(6,0),new nQ(6,1),new nQ(6,2),new nQ(6,3)])],[new V2([new nQ(0,5),new nQ(1,5),new nQ(2,5),new nQ(3,5),new nQ(4,5)]),new V2([new nQ(1,2),new nQ(2,2),new nQ(3,2),new nQ(4,2),new nQ(5,2)])]),new z2(new $2(new nQ(4,6),yw.of(oQ.UP)),[new V2([new nQ(6,0),new nQ(6,1),new nQ(6,2),new nQ(6,3)])],[new V2([new nQ(0,5),new nQ(1,5),new nQ(2,5),new nQ(3,5),new nQ(4,5)]),new V2([new nQ(3,0),new nQ(3,1),new nQ(3,2),new nQ(3,3),new nQ(3,4)])]),new z2(new $2(new nQ(3,6),yw.of(oQ.UP)),[new V2([new nQ(6,0),new nQ(6,1),new nQ(6,2),new nQ(6,3)])],[new V2([new nQ(1,2),new nQ(2,2),new nQ(3,2),new nQ(4,2),new nQ(5,2)]),new V2([new nQ(0,5),new nQ(1,5),new nQ(2,5),new nQ(3,5),new nQ(4,5)])])],$localize`Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces.`,$localize`Failed, the best capture takes 2 of your opponent's pieces.`)]}}function X2(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba().$implicit,t=ba();ha("ngClass",t.getPieceClass(e)),ra("cx",t.getCenterAt(e).x)("cy",t.getCenterAt(e).y)("r",t.SPACE_SIZE)}}function e3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",8),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),ga(2,"polyline",9),la(3,X2,1,4,"circle",10),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),Ts(1),Ia("id","case_",e.x,"_",e.y,""),ha("ngClass",n.getSpaceClass(e)),ra("points",n.getHexaCoordsAt(e)),Ts(1),ha("ngIf",n.isPiece(e))}}function t3(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onClick(t)}),fa()}if(2&e){const e=t.$implicit;ra("points",ba(2).getHexaCoordsAt(e))}}function n3(e,t){if(1&e&&(Cn(),pa(0,"g",12),la(1,t3,1,1,"polyline",13),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e.capturedSpaces)}}function r3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"line",15),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.destination)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),ra("x1",e.x1)("y1",e.y1)("x2",e.x2)("y2",e.y2)}}function i3(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getSidePieceClass(n)),ra("cx",10+e*r.SPACE_SIZE*.5)("cy",10+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function s3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,i3,2,6,"g",5),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function o3(e,t){if(1&e&&(Cn(),ga(0,"line",17)),2&e){const e=ba();ra("x1",e.inserted.get().x1)("y1",e.inserted.get().y1)("x2",e.inserted.get().x2)("y2",e.inserted.get().y2)}}const a3=function(){return[0,1]};let l3=(()=>{class e extends iQ{constructor(t){super(t),this.inserted=yw.empty(),this.arrows=[],this.captured=[],this.moved=[],this.movePhase=e.PHASE_PLACEMENT_COORD,this.possibleCaptures=[],this.initialCaptures=[],this.placement=yw.empty(),this.placementEntrance=yw.empty(),this.finalCaptures=[],this.scores=yw.of([0,0]),this.rules=new q2(H2),this.availableMinimaxes=[new W2(this.rules,"GipfMinimax")],this.encoder=z2.encoder,this.tutorial=(new Q2).tutorial,this.SPACE_SIZE=40,this.constructedState=this.rules.node.gameState,this.hexaLayout=new aQ(1.5*this.SPACE_SIZE,new nQ(2*this.SPACE_SIZE,0),uQ.INSTANCE)}updateBoard(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}showLastMove(){this.inserted=yw.empty();const e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){const t=e.get().placement;this.inserted=yw.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}arrowTowards(e,t){const n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new j2(n,e,i.x,i.y,r.x,r.y)}markCapture(e){e.forEach(e=>{this.captured.push(e)})}getAllCoords(){return this.constructedState.allCoords()}getPlayerSidePieces(e){const t=this.constructedState.getNumberOfPiecesToPlace(YY.of(e)),n=[];for(let r=0;r<t;r+=1)n.push(r);return n}isPiece(e){return this.getPiece(e)!==sQ.EMPTY}getPiece(e){return this.constructedState.getPieceAt(e)}onClick(t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+t.x+"_"+t.y);if(r.isFailure())return n.cancelMove(r.getReason());switch(n.movePhase){case e.PHASE_INITIAL_CAPTURE:case e.PHASE_FINAL_CAPTURE:return n.selectCapture(t);case e.PHASE_PLACEMENT_COORD:return n.selectPlacementCoord(t);default:dw.expectToBe(n.movePhase,e.PHASE_PLACEMENT_DIRECTION);const r=n.placementEntrance.get();if(!1===r.isAlignedWith(t))return n.cancelMove(G2.INVALID_PLACEMENT_DIRECTION());if(1!==r.getDistance(t))return n.cancelMove(G2.CLICK_FURTHER_THAN_ONE_COORD());const i=oQ.factory.fromMove(r,t);return n.selectPlacementDirection(i.toOptional())}})()}selectCapture(t){var n=this;return hw(function*(){const r=[];if(n.possibleCaptures.forEach(e=>{e.contains(t)&&r.push(e)}),r.length>1)return n.cancelMove(G2.AMBIGUOUS_CAPTURE_COORD());if(0===r.length)return n.cancelMove(G2.MISSING_CAPTURES());const i=r[0];switch(n.constructedState=q2.applyCapture(n.constructedState,i),n.markCapture(i),n.possibleCaptures=q2.getPossibleCaptures(n.constructedState),n.movePhase){case e.PHASE_INITIAL_CAPTURE:return n.initialCaptures.push(i),0===n.possibleCaptures.length?n.moveToPlacementPhase():FG.SUCCESS;default:return dw.expectToBe(n.movePhase,e.PHASE_FINAL_CAPTURE),n.finalCaptures.push(i),0===n.possibleCaptures.length?n.tryMove(n.initialCaptures,n.placement.get(),n.finalCaptures):FG.SUCCESS}})()}moveToPlacementPhase(){return this.movePhase=e.PHASE_PLACEMENT_COORD,FG.SUCCESS}moveToInitialCaptureOrPlacementPhase(){return this.possibleCaptures=q2.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?e.PHASE_PLACEMENT_COORD:e.PHASE_INITIAL_CAPTURE,FG.SUCCESS}moveToFinalCapturePhaseOrTryMove(){var t=this;return hw(function*(){return t.possibleCaptures=q2.getPossibleCaptures(t.constructedState),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):(t.movePhase=e.PHASE_FINAL_CAPTURE,FG.SUCCESS)})()}computeArrows(e){this.arrows=[];for(const t of q2.getAllDirectionsForEntrance(this.constructedState,e))if(!1===q2.isLineComplete(this.constructedState,e,t)){const n=e.getNext(t),r=this.getCenterAt(e),i=this.getCenterAt(n);this.arrows.push(new j2(e,n,r.x,r.y,i.x,i.y))}}selectPlacementCoord(t){var n=this;return hw(function*(){const r=n.rules.placementCoordValidity(n.constructedState,t);return r.isFailure()?n.cancelMove(r.getReason()):(n.placementEntrance=yw.of(t),n.constructedState.getPieceAt(t)===sQ.EMPTY?n.selectPlacementDirection(yw.empty()):(n.movePhase=e.PHASE_PLACEMENT_DIRECTION,n.computeArrows(t),0===n.arrows.length&&n.cancelMove(G2.NO_DIRECTIONS_AVAILABLE()),FG.SUCCESS))})()}selectPlacementDirection(e){var t=this;return hw(function*(){t.placement=yw.of(new $2(t.placementEntrance.get(),e));const n=t.rules.placementValidity(t.constructedState,t.placement.get());return n.isFailure()?t.cancelMove(n.getReason()):(t.arrows=[],t.constructedState=q2.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove())})()}tryMove(e,t,n){var r=this;return hw(function*(){const i=new z2(t,e,n);return yield r.chooseMove(i,r.rules.node.gameState,r.scores.get())})()}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];const e=this.rules.node.move;if(e.isPresent()){const t=e.get(),n=this.rules.node.mother.get().gameState;t.initialCaptures.forEach(e=>this.markCapture(e)),t.finalCaptures.forEach(e=>this.markCapture(e)),this.moved=this.rules.getPiecesMoved(n,t.initialCaptures,t.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=yw.empty(),this.placement=yw.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}getSpaceClass(e){return this.captured.some(t=>t.equals(e))?"captured":this.moved.some(t=>t.equals(e))?"moved":""}getPieceClass(e){const t=this.getPiece(e);return this.getPlayerClass(YY.of(t.value))}getSidePieceClass(e){return this.getPlayerClass(YY.of(e))}}return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-gipf"]],features:[Go],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),pa(4,"marker",3),ga(5,"polygon",4),fa(),fa(),la(6,e3,4,7,"g",5),la(7,n3,2,1,"g",6),la(8,r3,2,4,"g",5),la(9,s3,2,1,"g",5),la(10,o3,1,4,"line",7),fa()),2&e&&(Ts(6),ha("ngForOf",t.getAllCoords()),Ts(1),ha("ngForOf",t.possibleCaptures),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",lu(5,a3)),Ts(1),ha("ngIf",t.inserted.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class c3 extends CQ{equals(e){return this===e||this.coord.equals(e.coord)}toString(){return this===c3.PASS?"GoMove.PASS":this===c3.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}c3.PASS=new c3(-1,0),c3.ACCEPT=new c3(-2,0),c3.PASS_NUMBER=-1,c3.ACCEPT_NUMBER=-2,c3.encoder=new class extends jY{maxValue(){return 360}encodeNumber(e){return 19*e.coord.y+e.coord.x}decodeNumber(e){if(e===c3.PASS_NUMBER)return c3.PASS;const t=e%19;return new c3(t,(e-t)/19)}};class u3{constructor(e,t){this.player=e,this.type=t}equals(e){return e===this}toString(){switch(this){case u3.BLACK:return"GoPiece.BLACK";case u3.WHITE:return"GoPiece.WHITE";case u3.EMPTY:return"GoPiece.EMPTY";case u3.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case u3.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case u3.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return zG(this===u3.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}static pieceBelongTo(e,t){return t===e.player&&"territory"!==e.type}static ofPlayer(e){return e===YY.ZERO?u3.BLACK:u3.WHITE}isOccupied(){return[u3.BLACK,u3.WHITE,u3.DEAD_BLACK,u3.DEAD_WHITE].includes(this)}isEmpty(){return[u3.BLACK_TERRITORY,u3.WHITE_TERRITORY,u3.EMPTY].includes(this)}isDead(){return[u3.DEAD_BLACK,u3.DEAD_WHITE].includes(this)}isTerritory(){return[u3.BLACK_TERRITORY,u3.WHITE_TERRITORY].includes(this)}getOwner(){return this.player}nonTerritory(){return zG(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),u3.EMPTY}}u3.BLACK=new u3(YY.ZERO,"alive"),u3.WHITE=new u3(YY.ONE,"alive"),u3.EMPTY=new u3(KY.NONE,"empty"),u3.DEAD_BLACK=new u3(YY.ZERO,"dead"),u3.DEAD_WHITE=new u3(YY.ONE,"dead"),u3.BLACK_TERRITORY=new u3(KY.NONE,"territory"),u3.WHITE_TERRITORY=new u3(KY.NONE,"territory");var h3=(()=>(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(h3||(h3={})),h3))();let d3=(()=>{class e extends yQ{constructor(e,t,n,r,i){super(e,n),this.captured=t,this.koCoord=r,this.phase=i}static getInitialState(){const t=e.getStartingBoard();return new e(t,[0,0],0,yw.empty(),h3.PLAYING)}getCapturedCopy(){return[this.captured[0],this.captured[1]]}static getStartingBoard(){return eK.createTable(e.WIDTH,e.HEIGHT,u3.EMPTY)}copy(){return new e(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}isDead(e){return this.getPieceAt(e).isDead()}isTerritory(e){return this.getPieceAt(e).isTerritory()}}return e.WIDTH=13,e.HEIGHT=13,e})(),p3=(()=>{class e{constructor(e){this.color=e}selfContains(e){return this.getCoords().some(t=>t.equals(e))}static insertAsEntryPoint(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}return e.VERBOSE=!1,e})();class f3 extends p3{constructor(e,t,n,r,i,s){super(e),this.emptyCoords=t,this.blackCoords=n,this.whiteCoords=r,this.deadBlackCoords=i,this.deadWhiteCoords=s}getCoords(){return this.color===u3.BLACK?this.blackCoords:this.color===u3.WHITE?this.whiteCoords:this.color===u3.DEAD_BLACK?this.deadBlackCoords:this.color===u3.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}contains(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(t=>t.equals(e))}addPawn(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case u3.BLACK:this.blackCoords=p3.insertAsEntryPoint(this.blackCoords,e);break;case u3.WHITE:this.whiteCoords=p3.insertAsEntryPoint(this.whiteCoords,e);break;case u3.DEAD_BLACK:this.deadBlackCoords=p3.insertAsEntryPoint(this.deadBlackCoords,e);break;case u3.DEAD_WHITE:this.deadWhiteCoords=p3.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:dw.expectToBeMultiple(t,[u3.EMPTY,u3.BLACK_TERRITORY,u3.WHITE_TERRITORY]),this.emptyCoords=p3.insertAsEntryPoint(this.emptyCoords,e)}}isMonoWrapped(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}getWrapper(){const e=new SQ;e.set(u3.EMPTY,this.emptyCoords.length),e.set(u3.BLACK,this.blackCoords.length+this.deadWhiteCoords.length),e.set(u3.WHITE,this.whiteCoords.length+this.deadBlackCoords.length),e.put(this.color.nonTerritory(),0);const t=e.filter((e,t)=>t>0);if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}getNeighboorsEntryPoint(){const e=[];return this.color!==u3.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==u3.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==u3.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==u3.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==u3.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}class g3 extends class{getGroupDatas(e,t){pw(p3.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");const n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}_getGroupDatas(e,t,n){pw(p3.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});const r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color)for(const i of this.getDirections()){const r=e.getNext(i);r.isInRange(t[0].length,t.length)&&(n.contains(r)||(n=this._getGroupDatas(r,t,n)))}return n}}{getNewInstance(e){return new f3(e,[],[],[],[],[])}getDirections(){return tQ.ORTHOGONALS}}let m3=(()=>{class e{}return e.ILLEGAL_KO=()=>$localize`This move is a ko, you must play somewhere else before you can play in this intersection again.`,e.CANNOT_PASS_AFTER_PASSED_PHASE=()=>$localize`We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn.`,e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=()=>$localize`You cannot accept before the counting phase.`,e.OCCUPIED_INTERSECTION=()=>$localize`This intersection is already occupied.`,e.CANNOT_COMMIT_SUICIDE=()=>$localize`You cannot commit suicide.`,e})(),y3=(()=>{class e extends IQ{static isLegal(t,n){const r=!1;if(pw(e.VERBOSE||r,{isLegal:{move:t,state:n}}),e.isPass(t)){const t=n.phase===h3.PLAYING,i=n.phase===h3.PASSED;return pw(e.VERBOSE||r,"GoRules.isLegal at "+n.phase+(t||i?" forbid":" allowed")+" passing on "+n.getCopiedBoard()),t||i?RG.success([]):RG.failure(m3.CANNOT_PASS_AFTER_PASSED_PHASE())}if(e.isAccept(t)){const e=n.phase===h3.ACCEPT;return n.phase===h3.COUNTING||e?RG.success([]):RG.failure(m3.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return e.isOccupied(t.coord,n.getCopiedBoard())?(pw(e.VERBOSE||r,"GoRules.isLegal: move is marking"),e.isLegalDeadMarking(t,n)?RG.success([]):RG.failure(m3.OCCUPIED_INTERSECTION())):(pw(e.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+t.toString()),e.isLegalNormalMove(t,n))}static getNewKo(e,t,n){if(1===n.length){const r=n[0],i=e.coord,s=t[i.y][i.x],o=(new g3).getGroupDatas(i,t),a=o.emptyCoords,l=u3.pieceBelongTo(s,YY.ZERO)?o.blackCoords:o.whiteCoords;if(1===a.length&&a[0].equals(r)&&1===l.length)return yw.of(r)}return yw.empty()}static markTerritoryAndCount(t){pw(e.VERBOSE,{markTerritoryAndCount:{state:t}});const n=t.getCopiedBoard(),r=e.getTerritoryLikeGroup(t),i=t.getCapturedCopy();for(const e of r){const t=e.getWrapper();if(t===u3.WHITE){i[1]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=u3.WHITE_TERRITORY}else{zG(t===u3.BLACK,"territory should be wrapped by black or white, not by "+t.toString()),i[0]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=u3.BLACK_TERRITORY}}return new d3(n,i,t.turn,t.koCoord,t.phase)}static removeAndSubstractTerritory(e){const t=e.getCopiedBoard(),n=e.getCapturedCopy();let r;for(let i=0;i<e.board.length;i++)for(let s=0;s<e.board[0].length;s++)r=t[i][s],r===u3.BLACK_TERRITORY?(t[i][s]=u3.EMPTY,n[0]=n[0]-1):r===u3.WHITE_TERRITORY&&(t[i][s]=u3.EMPTY,n[1]=n[1]-1);return new d3(t,n,e.turn,e.koCoord,e.phase)}static getEmptyZones(t){return e.getGroupsDatasWhere(t.getCopiedBoard(),e=>e.isEmpty())}static getGroupsDatasWhere(e,t){const n=[];let r,i,s;const o=new g3;for(let a=0;a<e.length;a++)for(let l=0;l<e[0].length;l++)r=new nQ(l,a),s=e[a][l],t(s)&&(n.some(e=>e.selfContains(r))||(i=o.getGroupDatas(r,e),n.push(i)));return n}static addDeadToScore(e){const t=e.getCapturedCopy();let n,r=t[1],i=t[0];for(let s=0;s<e.board.length;s++)for(let t=0;t<e.board[0].length;t++)n=e.getPieceAtXY(t,s),n===u3.DEAD_BLACK?r++:n===u3.DEAD_WHITE&&i++;return[i,r]}static switchAliveness(e,t){const n=t.getCopiedBoard();zG(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");const r=(new g3).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case u3.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;for(const e of r.deadBlackCoords)n[e.y][e.x]=u3.BLACK;break;case u3.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;for(const e of r.deadWhiteCoords)n[e.y][e.x]=u3.WHITE;break;case u3.WHITE:i[0]+=2*r.whiteCoords.length;for(const e of r.whiteCoords)n[e.y][e.x]=u3.DEAD_WHITE;break;default:dw.expectToBe(r.color,u3.BLACK),i[1]+=2*r.blackCoords.length;for(const e of r.blackCoords)n[e.y][e.x]=u3.DEAD_BLACK}return new d3(n,i,t.turn,t.koCoord,t.phase)}static getGameStatus(e){const t=e.gameState;return t.phase===h3.FINISHED?t.captured[0]>t.captured[1]?TQ.ZERO_WON:t.captured[1]>t.captured[0]?TQ.ONE_WON:TQ.DRAW:TQ.ONGOING}static isPass(e){return e.equals(c3.PASS)}static isAccept(e){return e.equals(c3.ACCEPT)}static isLegalDeadMarking(t,n){return e.isOccupied(t.coord,n.getCopiedBoard())&&(n.phase===h3.COUNTING||n.phase===h3.ACCEPT)}static isLegalNormalMove(t,n){const r=n.getCopiedBoard();if(e.isKo(t,n))return RG.failure(m3.ILLEGAL_KO());[h3.COUNTING,h3.ACCEPT].includes(n.phase)&&(n=e.resurrectStones(n));const i=e.getCaptureState(t,n);if(v3.isCapturing(i))return RG.success(i.capturedCoords);{r[t.coord.y][t.coord.x]=n.turn%2==0?u3.BLACK:u3.WHITE;const e=0===(new g3).getGroupDatas(t.coord,r).emptyCoords.length;return r[t.coord.y][t.coord.x]=u3.EMPTY,e?RG.failure(m3.CANNOT_COMMIT_SUICIDE()):RG.success([])}}static isOccupied(e,t){return t[e.y][e.x].isOccupied()}static isKo(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}static getCaptureState(t,n){pw(e.VERBOSE||!1,{getCaptureState:{move:t,state:n}});const r=new v3;let i;for(const s of tQ.ORTHOGONALS)i=e.getCapturedInDirection(t.coord,s,n),i.length>0&&r.capturedCoords.every(e=>!i[0].equals(e))&&(r.capturedCoords=r.capturedCoords.concat(i));return r}static getCapturedInDirection(t,n,r){const i=r.getCopiedBoard(),s=t.getNext(n);if(s.isInRange(r.board[0].length,r.board.length)&&i[s.y][s.x]===(r.turn%2==0?u3.WHITE:u3.BLACK)){pw(e.VERBOSE||!1,"a group could be captured");const t=(new g3).getGroupDatas(s,i);if(e.isCapturableGroup(t,r.koCoord))return pw(e.VERBOSE||!1,{neightbooringGroupCoord:t.getCoords(),message:"is capturable"}),t.getCoords()}return[]}static isCapturableGroup(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}static getTerritoryLikeGroup(t){return e.getEmptyZones(t).filter(e=>e.isMonoWrapped())}static applyPass(t){const n=t.getCopiedBoard(),r=t.getCapturedCopy(),i=t.turn;let s,o;return t.phase===h3.PASSED?(s=h3.COUNTING,o=new d3(n,r,i+1,yw.empty(),s),o=e.markTerritoryAndCount(o)):(zG(t.phase===h3.PLAYING,"Cannot pass in counting phase!"),s=h3.PASSED,o=new d3(n,r,i+1,yw.empty(),s)),o}static applyLegalAccept(e){const t=e.getCopiedBoard();let n;return n=e.phase===h3.COUNTING?h3.ACCEPT:h3.FINISHED,new d3(t,e.getCapturedCopy(),e.turn+1,yw.empty(),n)}static applyNormalLegalMove(t,n,r){let i;pw(e.VERBOSE,{applyNormalLegal:{currentState:t,legalMove:n,status}}),i=[h3.COUNTING,h3.ACCEPT].includes(t.phase)?e.resurrectStones(t):t.copy();const s=n.coord.x,o=n.coord.y,a=i.getCopiedBoard(),l=i.turn,c=u3.ofPlayer(i.getCurrentPlayer()),u=l+1;a[o][s]=c;for(const e of r)a[e.y][e.x]=u3.EMPTY;const h=e.getNewKo(n,a,r),d=i.getCapturedCopy();return d[c.player.value]+=r.length,new d3(a,d,u,h,h3.PLAYING)}static resurrectStones(t){for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[0].length;r++)t.getPieceAtXY(r,n).isDead()&&(t=e.switchAliveness(new nQ(r,n),t));return e.removeAndSubstractTerritory(t)}static applyDeadMarkingMove(t,n){pw(e.VERBOSE,{applyDeadMarkingMove:{legalMove:t,state:n}});const r=e.removeAndSubstractTerritory(n),i=e.switchAliveness(t.coord,r),s=new d3(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,yw.empty(),h3.COUNTING);return e.markTerritoryAndCount(s)}isLegal(t,n){return e.isLegal(t,n)}applyLegalMove(t,n,r){return pw(e.VERBOSE,{applyLegalMove:{legalMove:t,state:n,status:r}}),e.isPass(t)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isPass"),e.applyPass(n)):e.isAccept(t)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isAccept"),e.applyLegalAccept(n)):e.isLegalDeadMarking(t,n)?(pw(e.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),e.applyDeadMarkingMove(t,n)):(pw(e.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),e.applyNormalLegalMove(n,t,r))}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class v3{constructor(){this.capturedCoords=[]}static isCapturing(e){return e.capturedCoords.length>0}}class _3 extends dQ{getListMoves(e){pw(y3.VERBOSE||!1,"GoRules.getListMoves");const t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===h3.PLAYING||t.phase===h3.PASSED)return n.push(c3.PASS),n;{pw(y3.VERBOSE||!1,"GoRules.getListMoves in counting phase");const e=this.getCountingMovesList(t);return 0===e.length?[c3.ACCEPT]:e}}getPlayingMovesList(e){const t=[];let n;for(let r=0;r<e.board.length;r++)for(let i=0;i<e.board[0].length;i++)n=new c3(i,r),e.getPieceAt(n.coord)===u3.EMPTY&&y3.isLegal(n,e).isSuccess()&&t.push(n);return t}getCountingMovesList(e){const t=[],n=this.getCorrectBoard(e).getCopiedBoard(),r=y3.getGroupsDatasWhere(n,e=>e!==u3.EMPTY);for(const i of r){const r=i.getCoords()[0],s=n[r.y][r.x];if(e.getPieceAt(r)!==s){const e=new c3(r.x,r.y);return t.push(e),t}}return t}getCorrectBoard(e){const t=this.mapBoard(e.getCopiedBoard(),e=>e===u3.BLACK?u3.DEAD_BLACK:e===u3.WHITE?u3.DEAD_WHITE:e.isTerritory()?u3.EMPTY:e),n=new d3(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=y3.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}mapBoard(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}setAliveUniqueWrapper(e,t){let n,r=e.copy();for(const i of t){n=i.deadBlackCoords.concat(i.deadWhiteCoords);for(const e of n)r.isDead(e)&&(r=y3.switchAliveness(e,r))}return r}getBoardValue(e){const t=e.gameState,n=y3.getGameStatus(e);if(n.isEndGame)return new pQ(n.toBoardValue());pw(y3.VERBOSE||!1,"GoRules.getBoardValue");const r=y3.markTerritoryAndCount(t),i=r.getCapturedCopy(),s=this.getDeadStones(r);return new pQ(i[1]+2*s[0]-(i[0]+2*s[1]))}getDeadStones(e){const t=[0,0];for(let n=0;n<e.board.length;n++)for(let r=0;r<e.board[0].length;r++){const i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}const C3=u3.WHITE,E3=u3.BLACK,w3=u3.DEAD_WHITE,S3=u3.WHITE_TERRITORY,b3=u3.BLACK_TERRITORY,P3=u3.EMPTY;class O3{constructor(){this.tutorial=[NQ.informational($localize`Preliminary information`,$localize`The game of Go is played on a board called a Goban, and the stones are placed on the intersections.
        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.
        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).
        For this tutorial, we will use a smaller board for pedagogical purposes.`,d3.getInitialState()),NQ.informational($localize`Goal of the game`,$localize`The goal of the game is to have the most points at the end of the game.
        We call "territories" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.
        Here, Dark has 9 territories on the left, and Light has 8 on the right.
        The top part belongs to no one.
        Each player's score at the end of the game is the sum of that player's territories and captures.`,new d3([[P3,E3,P3,P3,C3,C3],[P3,E3,P3,P3,C3,P3],[P3,E3,E3,C3,C3,P3],[P3,P3,E3,C3,P3,P3],[P3,P3,E3,C3,P3,P3],[P3,P3,E3,C3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING)),NQ.fromMove($localize`Simple capture`,$localize`An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).
        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.
        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>
        The light piece only has one liberty left, play there.`,new d3([[P3,P3,P3,P3,P3],[P3,P3,E3,P3,P3],[P3,E3,C3,P3,P3],[P3,P3,E3,P3,P3],[P3,P3,P3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING),[new c3(3,2)],$localize`Congratulations, you have earned one point.`,$localize`Failed, try again by playing on one of the intersections directly next to the light stone.`),NQ.fromMove($localize`Capturing multiple stones`,$localize`Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>
        The light group here only has one liberty left, capture it.`,new d3([[P3,E3,P3,P3,P3],[E3,C3,P3,P3,P3],[E3,C3,C3,E3,P3],[P3,E3,E3,P3,P3],[P3,P3,P3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING),[new c3(2,1)],$localize`Congratulations, you have earned three points and formed a territory.`,$localize`Failed, you have not captured the group. Play on the last liberty of that group.`),NQ.informational($localize`Suicide`,$localize`In Go, suicide is forbidden.
        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.
        Here, the top left intersection is a suicide for Light.
        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player.`,new d3([[P3,E3,P3,P3,P3],[E3,P3,P3,P3,P3],[E3,P3,P3,P3,C3],[C3,E3,P3,C3,P3],[P3,C3,P3,C3,E3]],[0,0],0,yw.empty(),h3.PLAYING)),NQ.informational($localize`Life and death (death)`,$localize`From the capture rule follows the life and death notion:
        dead stones are stones that are definitely capturable (without losing anything else).
        Alive stones are stones that can never be captured.
        From the capture rule, Dark can play inside Light's territory and make a capture.
        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).
        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories.`,new d3([[P3,P3,P3,P3,P3],[E3,E3,E3,P3,P3],[C3,C3,E3,P3,P3],[P3,C3,E3,P3,P3],[C3,C3,E3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING)),NQ.informational($localize`Life and death (eyes)`,$localize`Here, Light cannot play on the top left, nor on the bottom left.
        Light will never be able to capture Dark.
        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive.`,new d3([[P3,E3,C3,P3,P3],[C3,E3,C3,P3,P3],[E3,E3,C3,P3,P3],[C3,E3,C3,P3,P3],[P3,E3,C3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING)),NQ.informational($localize`Seki`,$localize`If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.
        Similarly, if Light plays on the middle line, Dark will capture Light.
        In other words, there is no point in playing on the middle line.
        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral.`,new d3([[P3,C3,E3,P3,C3,E3,P3],[P3,C3,E3,E3,C3,E3,P3],[P3,C3,E3,E3,C3,E3,P3],[P3,C3,E3,E3,C3,E3,P3],[P3,C3,E3,C3,C3,E3,P3],[P3,C3,E3,C3,C3,E3,P3],[P3,C3,E3,P3,C3,E3,P3]],[0,0],0,yw.empty(),h3.PLAYING)),NQ.fromMove($localize`Ko`,$localize`A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>
        Capture the light stone.`,new d3([[P3,P3,P3,P3,P3,P3,P3],[P3,P3,P3,P3,P3,P3,P3],[P3,P3,P3,E3,C3,P3,P3],[P3,P3,E3,C3,P3,C3,P3],[P3,P3,P3,E3,C3,P3,P3],[P3,P3,P3,P3,P3,P3,P3],[P3,P3,P3,P3,P3,P3,P3]],[0,0],0,yw.empty(),h3.PLAYING),[new c3(4,3)],$localize`Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.
        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.
        This rule is called the Ko.
        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after.`,$localize`Failed!`),NQ.fromMove($localize`End of the game`,$localize`When a player feels that there is no advantage to putting a new stone, that player can pass a turn.
        The game phase stops when both players pass consecutively, and we move on to the counting phase.
        The dead groups are then marked by clicking on them.
        Every intersection in a player's territory earns that player a point.
        The winner is the one with most points.<br/><br/>
        A last stone is dead, mark it.`,new d3([[C3,E3,E3,E3,E3,E3,b3,b3,b3],[C3,C3,C3,C3,E3,E3,E3,b3,b3],[C3,S3,C3,C3,E3,w3,w3,E3,b3],[E3,C3,C3,C3,C3,E3,b3,b3,b3],[P3,C3,S3,C3,E3,E3,w3,E3,b3],[C3,S3,C3,C3,E3,E3,E3,E3,E3],[C3,C3,E3,E3,E3,C3,C3,E3,C3],[E3,E3,E3,C3,C3,C3,S3,C3,C3],[b3,b3,E3,E3,E3,C3,C3,S3,S3]],[0,0],0,yw.empty(),h3.COUNTING),[new c3(0,3)],$localize`Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.
        The intersections where the prisoners are count as Dark's territory
        Light has 8 territories and 1 prisoner.
        The end result is therefore 18 - 9 for Dark.`,$localize`Failed, try again.`)]}}function T3(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2).index,t=ba().index;ra("cx",25+50*e)("cy",25+50*t)("r",22)}}function I3(e,t){if(1&e){const e=va();Cn(),pa(0,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index;ra("x1",50*e)("y1",50*t)("x2",50+50*e)("y2",50+50*t)}}function k3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",7),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,T3,1,3,"circle",8),la(3,I3,1,4,"line",9),fa()}if(2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.getSpaceClass(e,t)),ra("cx",25+50*e)("cy",25+50*t)("r",22),Ts(1),ha("ngIf",n.isLastCase(e,t)),Ts(1),ha("ngIf",n.isDead(e,t))}}function A3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",15),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",25+50*t)("cy",25+50*r)("r",10)("class",n===i.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function M3(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",12),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(1,"line",13),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",13),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(3,A3,1,4,"circle",14)}if(2&e){const e=ba().index,t=ba().index,n=ba();Ia("id","click_",e,"_",t,""),ra("x",50*e)("y",50*t),Ts(1),ra("x1",50*e)("y1",25+50*t)("x2",50+50*e)("y2",25+50*t),Ts(1),ra("x1",25+50*e)("y1",50*t)("x2",25+50*e)("y2",50+50*t),Ts(1),ha("ngIf",n.isTerritory(e,t))}}function N3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,k3,4,6,"g",5),la(2,M3,4,13,"ng-template",null,6,Lu),fa()),2&e){const e=t.index,n=ca(3),r=ba().index,i=ba();Ts(1),ha("ngIf",i.caseIsFull(e,r))("ngIfElse",n)}}function x3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,N3,4,2,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function R3(e,t){if(1&e&&(Cn(),ga(0,"rect",16)),2&e){const e=ba();ra("x",12.5+50*e.ko.get().x)("y",12.5+50*e.ko.get().y)}}function D3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",17),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit;ra("cx",25+50*e.x)("cy",25+50*e.y)("r",7)}}let L3=(()=>{class e extends pX{constructor(e){super(e),this.ko=yw.empty(),this.last=yw.empty(),this.captures=[],this.GoPiece=u3,this.scores=yw.of([0,0]),this.rules=new y3(d3),this.availableMinimaxes=[new _3(this.rules,"GoMinimax")],this.encoder=c3.encoder,this.tutorial=(new O3).tutorial,this.canPass=!0,this.updateBoard()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.last=yw.empty();const i=new c3(e,t);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){pw(e.VERBOSE,"updateBoard");const t=this.rules.node.gameState,n=this.rules.node.move,r=t.phase;this.board=t.getCopiedBoard(),this.scores=yw.of(t.getCapturedCopy()),this.ko=t.koCoord,n.isPresent()?this.showCaptures():this.captures=[],this.last=n.map(e=>e.coord),this.canPass=r!==h3.FINISHED}showCaptures(){const e=this.rules.node.mother.get().gameState;this.captures=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[0].length;n++){const r=new nQ(n,t),i=!1===e.getPieceAt(r).isEmpty(),s=this.board[t][n]===u3.EMPTY,o=!1===this.ko.equalsValue(r);i&&s&&o&&this.captures.push(r)}}pass(){var e=this;return hw(function*(){const t=e.rules.node.gameState.phase;return t===h3.PLAYING||t===h3.PASSED?e.onClick(c3.PASS.coord.x,c3.PASS.coord.y):(zG(t===h3.COUNTING||t===h3.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(c3.ACCEPT.coord.x,c3.ACCEPT.coord.y))})()}getSpaceClass(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}caseIsFull(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==u3.EMPTY&&!this.isTerritory(e,t)}isLastCase(e,t){if(this.last.isPresent()){const n=this.last.get();return e===n.x&&t===n.y}return!1}isDead(e,t){return this.rules.node.gameState.isDead(new nQ(e,t))}isTerritory(e,t){return this.rules.node.gameState.isTerritory(new nQ(e,t))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-go"]],features:[Go],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,x3,2,1,"g",2),la(3,R3,1,2,"rect",3),la(4,D3,1,3,"circle",4),fa()),2&e&&(ra("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),Ts(1),ra("width",50*t.board.length)("height",50*t.board.length),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.ko.isPresent()),Ts(1),ha("ngForOf",t.captures))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class F3{constructor(e,t,n){this.value=e,this.name=t,this.rgb=n}static of(e){switch(e){case 0:return F3.ANY;case 1:return F3.ORANGE;case 2:return F3.BLUE;case 3:return F3.PURPLE;case 4:return F3.PINK;case 5:return F3.YELLOW;case 6:return F3.RED;case 7:return F3.GREEN;default:return dw.expectToBe(e,8,"Invalid value "+e+" for KamisadoColor"),F3.BROWN}}}F3.ANY=new F3(0,"any","#000"),F3.ORANGE=new F3(1,"orange","#d67421"),F3.BLUE=new F3(2,"blue","#006bac"),F3.PURPLE=new F3(3,"purple","#6f3787"),F3.PINK=new F3(4,"pink","#d2719e"),F3.YELLOW=new F3(5,"yellow","#e2c200"),F3.RED=new F3(6,"red","#d23339"),F3.GREEN=new F3(7,"green","#009157"),F3.BROWN=new F3(8,"brown","#562500");class U3{constructor(e,t){this.player=e,this.color=t}static of(e,t){return new U3(e,F3.of(t))}static createPlayerColors(e){return{ORANGE:new U3(e,F3.ORANGE),BLUE:new U3(e,F3.BLUE),PURPLE:new U3(e,F3.PURPLE),PINK:new U3(e,F3.PINK),YELLOW:new U3(e,F3.YELLOW),RED:new U3(e,F3.RED),GREEN:new U3(e,F3.GREEN),BROWN:new U3(e,F3.BROWN)}}equals(e){return e.player===this.player&&e.color===this.color}isEmpty(){return this.player.equals(KY.NONE)}belongsTo(e){return this.player===e}}U3.EMPTY=new U3(KY.NONE,F3.ANY),U3.ZERO=U3.createPlayerColors(YY.ZERO),U3.ONE=U3.createPlayerColors(YY.ONE);class B3{static getColorAt(e,t){return B3.COLORS[t][e]}static getInitialBoard(){const e=U3.EMPTY;return[[1,2,3,4,5,6,7,8].map(e=>U3.of(YY.ONE,e)),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(e=>U3.of(YY.ZERO,e))]}static isEmptyAt(e,t){return e[t.y][t.x].equals(U3.EMPTY)}static allPieceCoords(e){const t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++){const i=new nQ(r,n);B3.isEmptyAt(e,i)||t.push(i)}return t}}B3.INITIAL=B3.getInitialBoard(),B3.SIZE=8,B3.COLORS=eK.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],F3.of);class V3 extends SX{constructor(e,t){super(e,t)}static of(e,t){if(e.isNotInRange(B3.SIZE,B3.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(B3.SIZE,B3.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new V3(e,t)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return this===V3.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}V3.PASS=new V3(new nQ(-2,-2),new nQ(-3,-3)),V3.encoder=new class extends jY{maxValue(){return 34952}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return V3.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new V3(new nQ((e=e/16|0)%16,r),new nQ(n,t))}};class $3 extends yQ{constructor(e,t,n,r,i){super(eK.copyBiArray(i),e),this.colorToPlay=t,this.coordToPlay=n,this.alreadyPassed=r}static getInitialState(){return new $3(0,F3.ANY,yw.empty(),!1,B3.INITIAL)}}let z3=(()=>{class e{}return e.NOT_RIGHT_COLOR=()=>$localize`This piece is not of the color you have to play.`,e.DIRECTION_NOT_ALLOWED=()=>$localize`You can only move forward, orthogonally or diagonally.`,e.MOVE_BLOCKED=()=>$localize`This move is blocked by another piece.`,e.PLAY_WITH_SELECTED_PIECE=()=>$localize`You must play with the selected piece.`,e})();class H3 extends IQ{static getColorMatchingPiece(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new nQ(0,7),new nQ(1,7),new nQ(2,7),new nQ(3,7),new nQ(4,7),new nQ(5,7),new nQ(6,7),new nQ(7,7)]}static getMovablePieces(e){return H3.getColorMatchingPiece(e).filter(t=>{for(const n of this.playerDirections(e.getCurrentPlayer())){const r=t.getNext(n);if(e.isOnBoard(r)&&B3.isEmptyAt(e.board,r))return!0}return!1})}static playerDirections(e){return e===YY.ONE?[eQ.DOWN,eQ.DOWN_LEFT,eQ.DOWN_RIGHT]:[eQ.UP,eQ.UP_LEFT,eQ.UP_RIGHT]}static directionAllowedForPlayer(e,t){return t===YY.ZERO?e.y<0:e.y>0}static getListMovesFromState(e){const t=H3.getMovablePieces(e);return 0===t.length?(zG(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[V3.PASS]):H3.getListMovesFromNonBlockedState(e,t)}static getListMovesFromNonBlockedState(e,t){const n=[],r=e.getCurrentPlayer();for(const i of t)for(const t of H3.playerDirections(r))for(let r=1;r<B3.SIZE;r++){const s=i.getNext(t,r);if(!e.isOnBoard(s)||!B3.isEmptyAt(e.board,s))break;{const e=V3.of(i,s);n.push(e)}}return n}static mustPass(e){return 0===this.getMovablePieces(e).length}static getFurthestPiecePositions(e){let t=7,n=0;return B3.allPieceCoords(e.board).forEach(r=>{const i=e.getPieceAt(r);zG(i!==U3.EMPTY,"allPieceCoords failed to filter KamisadoPiece.EMPTY"),i.player===YY.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}static isLegal(e,t){const n=e.coord,r=e.end,i=t.colorToPlay;if(e===V3.PASS)return this.isLegalPass(t);if(H3.isVictory(t))return RG.failure("You should never see this message");const s=t.getPieceAt(n);if(!s.belongsTo(t.getCurrentPlayer()))return RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE());if(i!==F3.ANY&&s.color!==i)return RG.failure(z3.NOT_RIGHT_COLOR());if(!t.getPieceAt(r).isEmpty())return RG.failure(hQ.MUST_CLICK_ON_EMPTY_SPACE());const o=eQ.factory.fromMove(n,r);if(o.isFailure())return RG.failure(z3.DIRECTION_NOT_ALLOWED());const a=o.get();if(!H3.directionAllowedForPlayer(a,t.getCurrentPlayer()))return RG.failure(z3.DIRECTION_NOT_ALLOWED());let l=n;for(;!l.equals(r);)if(l=l.getNext(a),!t.getPieceAt(l).isEmpty())return RG.failure(z3.MOVE_BLOCKED());return RG.success(void 0)}static isLegalPass(e){return this.mustPass(e)&&!e.alreadyPassed?RG.success(void 0):RG.failure(hQ.CANNOT_PASS())}static isVictory(e){const[t,n]=this.getFurthestPiecePositions(e);return 0===t||7===n}nextCoordToPlay(e,t){return yw.ofNullable(B3.allPieceCoords(e.board).find(n=>{const r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}applyLegalMove(e,t,n){if(e===V3.PASS){const e=this.nextCoordToPlay(t,t.colorToPlay);return new $3(t.turn+1,t.colorToPlay,e,!0,t.board)}const r=e.coord,i=e.end,s=t.getCopiedBoard();s[i.y][i.x]=s[r.y][r.x],s[r.y][r.x]=U3.EMPTY;const o=B3.getColorAt(i.x,i.y),a=this.nextCoordToPlay(t,o);return new $3(t.turn+1,o,a,!1,s)}isLegal(e,t){return H3.isLegal(e,t)}getGameStatus(e){const t=e.gameState,n=t.getCurrentPlayer();if(H3.mustPass(t)&&t.alreadyPassed)return TQ.getDefeat(n);const[r,i]=H3.getFurthestPiecePositions(t);return 7===i?TQ.ONE_WON:0===r?TQ.ZERO_WON:TQ.ONGOING}}class G3 extends dQ{getListMoves(e){const t=H3.getListMovesFromState(e.gameState);return eK.sortByDescending(t,e=>e.length()),t}getBoardValue(e){const t=e.gameState,n=t.getCurrentPlayer();if(H3.mustPass(t)&&t.alreadyPassed)return new pQ(n.getDefeatValue());const[r,i]=H3.getFurthestPiecePositions(t);return new pQ(7===i?YY.ONE.getVictoryValue():0===r?YY.ZERO.getVictoryValue():i-(7-r))}}const q3=U3.EMPTY,W3=U3.ZERO.ORANGE,j3=U3.ONE.ORANGE,Z3=U3.ZERO.BLUE,Y3=U3.ONE.BLUE,K3=U3.ZERO.PURPLE,J3=U3.ONE.PURPLE,Q3=U3.ZERO.PINK,X3=U3.ONE.PINK,e4=U3.ZERO.YELLOW,t4=U3.ONE.YELLOW,n4=U3.ZERO.RED,r4=U3.ONE.RED,i4=U3.ZERO.GREEN,s4=U3.ONE.GREEN,o4=U3.ZERO.BROWN,a4=U3.ONE.BROWN;class l4{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`At Kamisado, there are two ways to win the game:
        either by moving one of your pieces on the opponent's starting line,
        or by forcing the opponent to make a move that blocks the entire game.
        Here, Dark wins because its brown piece is on Light's starting line, on the top left.`,new $3(5,F3.ORANGE,yw.empty(),!1,[[o4,Y3,J3,X3,t4,r4,s4,a4],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,j3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,i4,n4,e4,Q3,K3,Z3,W3]])).withPreviousMove(V3.of(new nQ(0,7),new nQ(0,0))),NQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
        At Kamisado, pieces can only move forward, vertically or diagonally.
        You're playing first, with dark pieces, you can make your first move.<br/><br/>
        Click on the piece of your choice and click on the landing square.`,$3.getInitialState(),V3.of(new nQ(7,7),new nQ(3,3)),$localize`Perfect! Note that each of your piece has a different color.`),NQ.fromMove($localize`Moving`,$localize`Let us now consider the move of Light, after the blue piece has been moved by Dark.
        All moves after the initial move must be made from the piece that corresponds to the color
        of the square upon which the last move ended.
        Here, the last move ended on the pink square, hence the pink piece must move.
        It is already selected, you do not have to click on it.<br/><br/>
        Move it on a blue square.`,new $3(1,F3.PINK,yw.of(new nQ(3,0)),!1,[[j3,Y3,J3,X3,t4,r4,s4,a4],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,Z3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[o4,i4,n4,e4,Q3,K3,q3,W3]]),[V3.of(new nQ(3,0),new nQ(3,6)),V3.of(new nQ(3,0),new nQ(4,1))],$localize`Congratulations!`,$localize`You have not moved your pink piece on a blue square!`).withPreviousMove(V3.of(new nQ(6,7),new nQ(6,5))),NQ.informational($localize`Stuck situation`,$localize`Dark moved to another pink square, hence you have to move your pink piece again.
        However, your pink piece is stuck! In this case, you must pass your turn.
        Dark will now have to play by moving its pink piece.`,new $3(1,F3.PINK,yw.of(new nQ(3,6)),!1,[[j3,Y3,J3,q3,t4,r4,s4,a4],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,q3,Z3],[q3,q3,q3,q3,q3,q3,q3,q3],[q3,q3,q3,X3,q3,q3,q3,q3],[o4,i4,n4,e4,Q3,K3,q3,W3]])).withPreviousMove(V3.of(new nQ(6,5),new nQ(7,4))),NQ.fromMove($localize`Victory by blocking`,$localize`At any time, if a player blocks the entire game, that player loses.
        In other words, if a player forces its opponent to move a piece that the opponent cannot move,
        and the player cannot move its own piece of the same color, then that player loses.
        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>
        Try to make this move.`,new $3(2,F3.RED,yw.of(new nQ(2,4)),!1,[[q3,Y3,J3,q3,q3,r4,q3,q3],[q3,q3,q3,t4,q3,q3,q3,q3],[q3,q3,q3,X3,q3,J3,q3,q3],[q3,q3,q3,e4,q3,q3,q3,q3],[q3,q3,n4,q3,q3,q3,q3,q3],[q3,q3,q3,q3,q3,q3,s4,q3],[j3,q3,q3,q3,q3,Q3,q3,a4],[o4,i4,q3,q3,q3,q3,Z3,W3]]),[V3.of(new nQ(2,4),new nQ(0,2))],$localize`Perfect!
         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.
         Your orange piece will be stuck and you will have to pass your turn.
         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.
         In this case, the last player to have moved a piece loses.
         Here, your opponent will have moved its green piece last, you therefore win!`,$localize`Failed!`).withPreviousMove(V3.of(new nQ(4,0),new nQ(3,1)))]}}function c4(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("cx",i.SPACE_SIZE/2+t*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("fill",i.pieceColor(n))("r",i.SPACE_SIZE/3)}}function u4(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=ba(),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.piecePlayerClass(t)),ra("x",i.SPACE_SIZE/2+n*i.SPACE_SIZE-i.SPACE_SIZE/8)("y",i.SPACE_SIZE/2+r*i.SPACE_SIZE-i.SPACE_SIZE/8)("rx",i.isPlayerZero(t)?i.SPACE_SIZE:0)("ry",i.isPlayerZero(t)?i.SPACE_SIZE:0)("width",i.SPACE_SIZE/4)("height",i.SPACE_SIZE/4)}}function h4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(2,"rect",5),la(3,c4,1,4,"circle",6),la(4,u4,1,7,"rect",7),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)("fill",i.backgroundColor(n,r)),Ts(1),ha("ngIf",e!==i.UNOCCUPIED),Ts(1),ha("ngIf",e!==i.UNOCCUPIED)}}function d4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,h4,5,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function p4(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"rect",10),ga(2,"rect",10),fa()),2&e){const e=ba();Ts(1),ra("x",e.lastMove.get().coord.x*e.SPACE_SIZE)("y",e.lastMove.get().coord.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE),Ts(1),ra("x",e.lastMove.get().end.x*e.SPACE_SIZE)("y",e.lastMove.get().end.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function f4(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba();ra("cx",e.SPACE_SIZE/2+e.chosen.get().x*e.SPACE_SIZE)("cy",e.SPACE_SIZE/2+e.chosen.get().y*e.SPACE_SIZE)}}let g4=(()=>{class e extends pX{constructor(e){super(e),this.UNOCCUPIED=U3.EMPTY,this.lastMove=yw.empty(),this.chosen=yw.empty(),this.chosenAutomatically=!1,this.rules=new H3($3),this.availableMinimaxes=[new G3(this.rules,"KamisadoMinimax")],this.encoder=V3.encoder,this.tutorial=(new l4).tutorial,this.canPass=!1,this.updateBoard()}backgroundColor(e,t){return B3.getColorAt(e,t).rgb}isPlayerZero(e){return e.player===YY.ZERO}pieceColor(e){return e.color.rgb}piecePlayerClass(e){return this.getPlayerClass(e.player)}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=H3.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=yw.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}pass(){var e=this;return hw(function*(){return zG(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(V3.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new nQ(e,t);if(n.canPass)return n.cancelMove(hQ.MUST_PASS());if(n.chosen.isAbsent())return n.choosePiece(e,t);if(!1===n.chosenAutomatically&&n.chosen.equalsValue(i))return n.cancelMoveAttempt(),FG.SUCCESS;{const r=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer();return r.belongsTo(s)?n.chosenAutomatically?n.cancelMove(z3.PLAY_WITH_SELECTED_PIECE()):(n.chosen=yw.of(i),FG.SUCCESS):yield n.chooseDestination(e,t)}})()}choosePiece(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=yw.of(new nQ(e,t)),FG.SUCCESS)}chooseDestination(e,t){var n=this;return hw(function*(){const r=n.chosen.get(),i=new nQ(e,t),s=V3.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}cancelMoveAttempt(){this.chosenAutomatically||(this.chosen=yw.empty())}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-kamisado"]],features:[Go],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,d4,2,1,"g",1),la(2,p4,3,8,"g",2),la(3,f4,1,2,"circle",3),fa()),2&e&&(ra("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),m4=(()=>{class e extends yQ{static getInitialState(){const t=KY.NONE,n=YY.ZERO,r=YY.ONE;return new e([[t,n,n,n,n,n,n,t],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[t,n,n,n,n,n,n,t]],0)}static isOnBoard(t){return t.isInRange(e.SIZE,e.SIZE)}}return e.SIZE=8,e})();class y4 extends SX{constructor(e,t,n){super(e,t),this.direction=n,this.direction=eQ.factory.fromMove(e,t).get()}static of(e,t){const n=eQ.factory.fromMove(e,t);return n.isFailure()?RG.failure(n.getReason()):e.isNotInRange(m4.SIZE,m4.SIZE)?RG.failure("start coord is not in range"):t.isNotInRange(m4.SIZE,m4.SIZE)?RG.failure("end coord is not in range"):RG.success(new y4(e,t,n.get()))}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}encode(){return y4.encoder.encode(this)}decode(e){return y4.encoder.decode(e)}}y4.encoder=SX.getEncoder(m4.SIZE,m4.SIZE,(e,t)=>y4.of(e,t).get());let v4=(()=>{class e{}return e.INVALID_MOVE_LENGTH=()=>$localize`Your move should have a length equal to the number of pieces that exist on the same line.`,e.CANNOT_JUMP_OVER_OPPONENT=()=>$localize`You cannot jump over the opponent's pieces.`,e.PIECE_CANNOT_MOVE=()=>$localize`This piece has no possible move, select another one.`,e.INVALID_DIRECTION=()=>$localize`A move must be orthogonal or diagonal`,e})();class _4 extends IQ{static getListMovesFromState(e){const t=[];if(_4.getVictory(e).isPresent())return t;for(let n=0;n<m4.SIZE;n++)for(let r=0;r<m4.SIZE;r++){const i=new nQ(r,n);if(e.getPieceAt(i).isPlayer())for(const n of _4.possibleTargets(e,i)){const e=y4.of(i,n).get();t.push(e)}}return t}static getNumberOfGroups(e){const t=eK.createTable(m4.SIZE,m4.SIZE,-1),n=[0,0];let r=0;for(let i=0;i<m4.SIZE;i++)for(let s=0;s<m4.SIZE;s++)if(-1===t[i][s]){const o=e.getPieceAt(new nQ(s,i));o.isPlayer()&&(r+=1,_4.markGroupStartingAt(e,t,new nQ(s,i),r),n[o.value]+=1)}return n}static markGroupStartingAt(e,t,n,r){const i=[n],s=e.getPieceAt(n);for(;i.length>0;){const n=dw.getNonNullable(i.pop());if(-1===t[n.y][n.x]){const o=e.getPieceAt(n);if(o===s){t[n.y][n.x]=r;for(const t of eQ.DIRECTIONS){const r=n.getNext(t);e.isOnBoard(r)&&i.push(r)}}else o===KY.NONE&&(t[n.y][n.x]=0)}}}applyLegalMove(e,t,n){const r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=KY.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new m4(r,t.turn+1)}static isLegal(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?RG.failure(v4.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(e=>t.getPieceAt(e)===t.getCurrentOpponent())?RG.failure(v4.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?RG.failure(hQ.CANNOT_SELF_CAPTURE()):RG.success(void 0)}isLegal(e,t){return _4.isLegal(e,t)}static numberOfPiecesOnLine(e,t,n){let r=0;for(const i of _4.getLineCoords(t,n))e.getPieceAt(i).isPlayer()&&(r+=1);return r}static getLineCoords(e,t){const n=_4.getEntranceAndForwardDirection(e,t);let r=n[0];const i=n[1],s=[];for(;m4.isOnBoard(r);)s.push(r),r=r.getNext(i);return s}static getEntranceAndForwardDirection(e,t){switch(t){case eQ.UP:case eQ.DOWN:return[new nQ(e.x,0),eQ.DOWN];case eQ.LEFT:case eQ.RIGHT:return[new nQ(0,e.y),eQ.RIGHT];case eQ.UP_RIGHT:case eQ.DOWN_LEFT:return[new nQ(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),eQ.UP_RIGHT];default:return dw.expectToBeMultiple(t,[eQ.UP_LEFT,eQ.DOWN_RIGHT]),[new nQ(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),eQ.DOWN_RIGHT]}}static getVictory(e){const[t,n]=_4.getNumberOfGroups(e);return 1===t&&1===n?yw.of(KY.NONE):1===t?yw.of(YY.ZERO):1===n?yw.of(YY.ONE):yw.empty()}static possibleTargets(e,t){const n=[];for(const r of eQ.DIRECTIONS){const i=_4.numberOfPiecesOnLine(e,t,r),s=t.getNext(r,i);if(e.isOnBoard(s)){const r=y4.of(t,s).get();_4.isLegal(r,e).isSuccess()&&n.push(s)}}return n}getGameStatus(e){const t=e.gameState,[n,r]=_4.getNumberOfGroups(t);return 1===n&&r>1?TQ.ZERO_WON:n>1&&1===r?TQ.ONE_WON:TQ.ONGOING}}class C4 extends dQ{getListMoves(e){return _4.getListMovesFromState(e.gameState)}getBoardValue(e){const t=e.gameState,[n,r]=_4.getNumberOfGroups(t);return new pQ(1===n&&r>1?YY.ZERO.getVictoryValue():n>1&&1===r?YY.ONE.getVictoryValue():100/n*YY.ZERO.getScoreModifier()+100/r*YY.ONE.getScoreModifier())}}const E4=KY.NONE,w4=YY.ZERO,S4=YY.ONE;class b4{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.
        Here, Dark wins the game:
        Dark's pieces are forming a single group, while Light's pieces form three groups.`,new m4([[E4,E4,E4,E4,E4,E4,E4,E4],[S4,E4,E4,E4,w4,E4,E4,S4],[E4,E4,w4,w4,S4,E4,E4,E4],[E4,E4,E4,w4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4]],0)),NQ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
         Moves can be made orthogonally or diagonally.
         The length of a move is equal to the number of pieces that are on the line of the move.
         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>
         You're playing Dark, make the first move!`,m4.getInitialState(),y4.of(new nQ(1,7),new nQ(1,5)).get(),$localize`Congratulations!`),NQ.fromMove($localize`Jumping`,$localize`During a move, it is possible to jump above your own pieces.
        But it is forbidden to jump over the opponent's pieces.<br/><br/>
        You're playing Dark, make a jump over one of your pieces on the following board.`,new m4([[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,S4,w4,w4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,E4,E4,w4]],0),[y4.of(new nQ(3,1),new nQ(6,1)).get()],$localize`Congratulations!`,$localize`Failed. You did not jump over one of your pieces.`),NQ.fromMove($localize`Moving`,$localize`Here is a different board. Pick the dark piece in the middle (line 4, column 4)
        and observe its possible moves.
        Horizontally, this piece can move only of one square because it is the only piece on this line.
        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.
        But it can only go up, as below it the landing square is occupied by one of your pieces.
        Diagonally, only one move is possible: on the diagonal that contains three pieces,
        only in the direction where it does not jump over one of the opponent's pieces.
        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>
        Make one of these moves.`,new m4([[E4,E4,E4,E4,E4,E4,S4,E4],[E4,E4,E4,E4,E4,w4,E4,E4],[E4,E4,E4,E4,S4,E4,E4,E4],[E4,E4,E4,w4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,S4,E4,S4],[E4,E4,E4,w4,E4,E4,S4,S4],[E4,E4,E4,w4,E4,E4,E4,E4]],0),[y4.of(new nQ(3,3),new nQ(3,0)).get(),y4.of(new nQ(3,3),new nQ(0,0)).get(),y4.of(new nQ(3,3),new nQ(2,3)).get(),y4.of(new nQ(3,3),new nQ(4,3)).get()],$localize`Congratulations!`,$localize`Failed. This was not one of the expected moves.`),NQ.fromMove($localize`Capturing`,$localize`If a move ends on an opponent's pieces, this one is captured and removed from the board.
        However, a move cannot end on one of the player's pieces.
        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!
        If a player has only one piece, that player wins the game.<br/><br/>
        On the following board, try to capture one piece with Dark.`,new m4([[E4,w4,E4,w4,w4,w4,w4,E4],[S4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,w4,E4,S4,E4,E4,E4],[S4,E4,E4,E4,E4,E4,E4,S4],[S4,E4,E4,E4,E4,E4,E4,S4],[S4,E4,E4,E4,E4,E4,E4,S4],[S4,E4,E4,E4,E4,E4,E4,S4],[E4,w4,w4,w4,w4,w4,w4,E4]],0),[y4.of(new nQ(2,2),new nQ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`),NQ.fromMove($localize`Tie`,$localize`In the special case where a move ends up connecting all pieces of both player, simultaneously,
        then the game ends up with a tie.<br/><br/>
        You're playing Dark, force the tie in one move.`,new m4([[E4,E4,E4,E4,E4,E4,E4,E4],[E4,E4,E4,E4,E4,E4,E4,E4],[w4,E4,E4,w4,S4,w4,E4,E4],[E4,E4,E4,w4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,E4,E4,S4],[E4,E4,E4,E4,E4,E4,E4,E4]],0),[y4.of(new nQ(0,2),new nQ(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`)]}}function P4(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE/2+e*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+t*n.SPACE_SIZE)}}function O4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),ga(2,"rect",3),la(3,P4,1,3,"circle",4),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ha("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function T4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O4,4,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function I4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}let k4=(()=>{class e extends pX{constructor(e){super(e),this.INDICATOR_SIZE=20,this.EMPTY=KY.NONE,this.targets=[],this.selected=yw.empty(),this.lastMove=yw.empty(),this.captured=yw.empty(),this.rules=new _4(m4),this.availableMinimaxes=[new C4(this.rules,"LinesOfActionMinimax")],this.encoder=y4.encoder,this.tutorial=(new b4).tutorial,this.updateBoard()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new nQ(e,t);if(n.selected.isPresent()){if(n.getState().getPieceAt(i)===n.getState().getCurrentPlayer())return n.select(i);{const r=y4.of(n.selected.get(),new nQ(e,t));return r.isSuccess()?n.chooseMove(r.get(),n.rules.node.gameState):n.cancelMove(v4.INVALID_DIRECTION())}}return n.select(i)})()}select(e){var t=this;return hw(function*(){return t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=yw.of(e),t.targets=_4.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(v4.PIECE_CANNOT_MOVE()):FG.SUCCESS)})()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}updateBoard(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end).isPlayer()?yw.of(e.end):yw.empty()}}cancelMoveAttempt(){this.selected=yw.empty(),this.targets=[]}getSquareClasses(e,t){const n=new nQ(e,t);if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(e)||n.equals(t))return["moved"]}return[]}getPieceClasses(e,t){const n=this.board[t][e],r=new nQ(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-linesofaction"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["r","40","class","base",3,"ngClass",4,"ngIf"],["r","40",1,"base",3,"ngClass"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,T4,2,1,"g",1),la(2,I4,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.targets))},directives:[$d,Bd,Hd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class A4 extends CQ{constructor(e,t,n,r={top:0,bottom:0,left:0,right:0}){super(e.x,e.y),this.direction=t,this.orientation=n,this.captures=r}toString(){return`LodestoneMove(${this.coord.toString()}, ${this.direction}, ${this.orientation}, { top: ${this.captures.top}, bottom: ${this.captures.bottom}, left: ${this.captures.left}, right: ${this.captures.right} })`}equals(e){return this===e||!(!1===this.coord.equals(e.coord)||this.orientation!==e.orientation||this.direction!==e.direction||this.captures.top!==e.captures.top||this.captures.bottom!==e.captures.bottom||this.captures.left!==e.captures.left||this.captures.right!==e.captures.right)}}A4.encoder=new class extends WY{encodeMove(e){return{coord:nQ.encoder.encode(e.coord),direction:e.direction,orientation:e.orientation,captures:e.captures}}decodeMove(e){const t=e;return zG(null!=t.coord,"Invalid encoded LodestoneMove"),zG(null!=t.direction,"Invalid encoded LodestoneMove"),zG(null!=t.orientation,"Invalid encoded LodestoneMove"),zG(null!=t.captures,"Invalid encoded LodestoneMove"),new A4(nQ.encoder.decode(t.coord),t.direction,t.orientation,t.captures)}};let M4=(()=>{class e{}return e.MUST_FLIP_LODESTONE=()=>$localize`You must flip your lodestone before putting it back on the board.`,e.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES=()=>$localize`As long as there are pressure plates, you must place all the pieces that you have captured on them.`,e.TARGET_IS_CRUMBLED=()=>$localize`You must place your lodestone on a non-crumbled square!`,e.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE=()=>$localize`You placed too many captures on the same pressure plate, which has not enough space left.`,e.MUST_PLACE_CAPTURES=()=>$localize`You must place your captures on the pressure plates, on the side of the board.`,e.NO_CAPTURES_TO_PLACE_YET=()=>$localize`You cannot place any capture now, you must first place your lodestone on the board!`,e})();class N4{constructor(e){this.unreachable=e}isLodestone(){return!1}isPlayerPiece(){return!1}isEmpty(){return!0}isUnreachable(){return this.unreachable}equals(e){return this===e}}N4.UNREACHABLE=new N4(!0),N4.EMPTY=new N4(!1);class x4{constructor(e){this.owner=e}static of(e){return e===YY.ZERO?x4.ZERO:x4.ONE}isLodestone(){return!1}isPlayerPiece(){return!0}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}x4.ZERO=new x4(YY.ZERO),x4.ONE=new x4(YY.ONE);class R4{constructor(e,t,n){this.owner=e,this.direction=t,this.orientation=n}static of(e,t){return R4.LODESTONES[e.value][t.direction][t.orientation]}isLodestone(){return!0}isPlayerPiece(){return!1}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}R4.LODESTONES={0:{push:{diagonal:new R4(YY.ZERO,"push","diagonal"),orthogonal:new R4(YY.ZERO,"push","orthogonal")},pull:{diagonal:new R4(YY.ZERO,"pull","diagonal"),orthogonal:new R4(YY.ZERO,"pull","orthogonal")}},1:{push:{diagonal:new R4(YY.ONE,"push","diagonal"),orthogonal:new R4(YY.ONE,"push","orthogonal")},pull:{diagonal:new R4(YY.ONE,"pull","diagonal"),orthogonal:new R4(YY.ONE,"pull","orthogonal")}}};class D4{constructor(e,t){this.width=e,this.pieces=t}remainingSpaces(){return 5===this.width?8-this.pieces.length:3-this.pieces.length}addCaptured(e,t){if(this.pieces.length+t>=this.width)return 5===this.width?D4.EMPTY_3.addCaptured(e,t+this.pieces.length-5):(zG(this.pieces.length+t===3,"should never put more pieces than the plate can support"),yw.empty());{const n=eK.copyImmutableArray(this.pieces);for(let r=0;r<t;r++)n.push(x4.of(e));return yw.of(new D4(this.width,n))}}getPieceAt(e){return e<this.pieces.length?this.pieces[e]:N4.EMPTY}}D4.POSITIONS=["top","bottom","left","right"],D4.EMPTY_5=new D4(5,[]),D4.EMPTY_3=new D4(3,[]);let L4=(()=>{class e extends yQ{constructor(e,t,n,r){super(e,t),this.lodestones=n,this.pressurePlates=r}static getInitialState(){const t=N4.EMPTY,n=x4.ZERO,r=x4.ONE;return new e([[t,t,n,r,n,r,t,t],[t,n,r,n,r,n,r,t],[n,r,n,r,n,r,n,r],[r,n,r,t,t,n,r,n],[n,r,n,t,t,r,n,r],[r,n,r,n,r,n,r,n],[t,r,n,r,n,r,n,t],[t,t,r,n,r,n,t,t]],0,new SQ,{top:yw.of(D4.EMPTY_5),bottom:yw.of(D4.EMPTY_5),left:yw.of(D4.EMPTY_5),right:yw.of(D4.EMPTY_5)})}withBoard(t){return new e(t,this.turn,this.lodestones,this.pressurePlates)}remainingSpaces(){const e=this.remainingSpacesDetails();return e.top+e.bottom+e.left+e.right}remainingSpacesDetails(){const e={top:0,bottom:0,left:0,right:0};for(const t of D4.POSITIONS){const n=this.pressurePlates[t];n.isPresent()&&(e[t]=n.get().remainingSpaces())}return e}numberOfPieces(){const t=[0,0];for(let n=0;n<e.SIZE;n++)for(let r=0;r<e.SIZE;r++){const e=this.getPieceAtXY(r,n);e.isPlayerPiece()&&(t[e.owner.value]+=1)}return t}getScores(){const e=this.numberOfPieces();return[24-e[1],24-e[0]]}nextLodestoneDirection(){const e=this.getCurrentPlayer(),t=this.lodestones.get(e);if(!t.isPresent())return yw.empty();{const e=this.getPieceAt(t.get());switch(zG(e.isLodestone(),"Piece must be lodestone (invariant from LodestoneState)"+t.get()),e.direction){case"push":return yw.of("pull");case"pull":return yw.of("push")}}}}return e.SIZE=8,e})();class F4 extends IQ{constructor(){super(L4)}static get(){return F4.singleton.isAbsent()&&(F4.singleton=yw.of(new F4)),F4.singleton.get()}applyLegalMove(e,t,n){const r=t.getCurrentPlayer(),i=r.getOpponent(),s=eK.copyBiArray(n.board),o=t.lodestones.getCopy();o.put(r,e.coord);const a={...t.pressurePlates};return this.updatePressurePlates(s,a,o,i,e.captures),new L4(s,t.turn+1,o,a)}updatePressurePlates(e,t,n,r,i){for(const s of D4.POSITIONS)t[s]=this.updatePressurePlate(e,s,t[s],n,r,i[s])}updatePressurePlate(e,t,n,r,i,s){if(n.isPresent()){const o=n.get().addCaptured(i,s),a=F4.THREATENED_COORD_RANGE.get(t).get();return o.isAbsent()?(this.removePressurePlate(e,a.startForBigPlate,a.direction,r),this.removePressurePlate(e,a.startForSmallPlate,a.direction,r)):o.get().width<n.get().width&&this.removePressurePlate(e,a.startForBigPlate,a.direction,r),o}return n}removePressurePlate(e,t,n,r){for(let i=t;i.isInRange(L4.SIZE,L4.SIZE);i=i.getNext(n)){for(const e of YY.PLAYERS)r.get(e).equalsValue(i)&&r.delete(e);e[i.y][i.x]=N4.UNREACHABLE}}isLegal(e,t){const n=this.isLegalWithoutCaptures(t,e.coord,e.direction);if(n.isFailure())return RG.failure(n.getReason());const r=this.applyMoveWithoutPlacingCaptures(t,e.coord,e);if(e.captures.top+e.captures.bottom+e.captures.left+e.captures.right!==Math.min(r.captures.length,t.remainingSpaces()))return RG.failure(M4.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES());for(const i of D4.POSITIONS){const n=t.pressurePlates[i];if(n.isPresent()&&n.get().remainingSpaces()<e.captures[i])return RG.failure(M4.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE())}return RG.success(r)}applyMoveWithoutPlacingCaptures(e,t,n){let r;const i=eK.copyBiArray(e.board),s=e.lodestones.get(e.getCurrentPlayer());if(s.isPresent()){const e=s.get();i[e.y][e.x]=N4.EMPTY}return r="pull"===n.direction?this.applyPull(e,i,t,n.orientation):this.applyPush(e,i,t,n.orientation),r.board[t.y][t.x]=R4.of(e.getCurrentPlayer(),n),r.moved.push(t),r}applyPull(e,t,n,r){const i=e.getCurrentPlayer(),s=i.getOpponent(),o=[],a=[],l="diagonal"===r?eQ.DIAGONALS:eQ.ORTHOGONALS;for(const c of l)for(let r=n.getNext(c);e.isOnBoard(r);r=r.getNext(c)){const n=t[r.y][r.x],l=r.getNext(c);if(e.isOnBoard(l)){const e=t[l.y][l.x];e.isPlayerPiece()&&e.owner===i&&(n.isEmpty()?(a.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=N4.EMPTY):n.isPlayerPiece()&&n.owner===s&&(o.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=N4.EMPTY))}}return{board:t,captures:o,moved:a}}applyPush(e,t,n,r){const i=e.getCurrentPlayer().getOpponent(),s=[],o=[],a="diagonal"===r?eQ.DIAGONALS:eQ.ORTHOGONALS;for(const l of a)for(let r=n.getNext(l,L4.SIZE);!1===r.equals(n);r=r.getPrevious(l))if(e.isOnBoard(r)){const n=t[r.y][r.x];if(n.isPlayerPiece()&&n.owner===i){const i=r.getNext(l);if(e.isOnBoard(i)){const e=t[i.y][i.x];e.isUnreachable()?(s.push(r),t[r.y][r.x]=N4.EMPTY):e.isEmpty()&&(o.push(i),t[i.y][i.x]=n,o.push(r),t[r.y][r.x]=N4.EMPTY)}else s.push(r),t[r.y][r.x]=N4.EMPTY}}return{board:t,captures:s,moved:o}}isLegalWithoutCaptures(e,t,n){const r=this.isTargetLegal(e,t);if(r.isFailure())return r;const i=e.nextLodestoneDirection();return!1===(i.isAbsent()||i.equalsValue(n))?FG.failure(M4.MUST_FLIP_LODESTONE()):FG.SUCCESS}isTargetLegal(e,t){const n=e.getPieceAt(t);if(n.isUnreachable())return FG.failure(M4.TARGET_IS_CRUMBLED());if(n.isPlayerPiece())return FG.failure(hQ.MUST_CLICK_ON_EMPTY_SQUARE());const r=e.getCurrentPlayer();return n.isLodestone()&&n.owner!==r?FG.failure(hQ.MUST_CLICK_ON_EMPTY_SQUARE()):FG.SUCCESS}getGameStatus(e){const t=e.gameState.numberOfPieces();return 0===t[0]&&0===t[1]?TQ.DRAW:0===t[0]?TQ.ONE_WON:0===t[1]?TQ.ZERO_WON:TQ.ONGOING}}F4.THREATENED_COORD_RANGE=SQ.from({top:{startForBigPlate:new nQ(0,0),startForSmallPlate:new nQ(0,1),direction:eQ.RIGHT},bottom:{startForBigPlate:new nQ(0,L4.SIZE-1),startForSmallPlate:new nQ(0,L4.SIZE-2),direction:eQ.RIGHT},left:{startForBigPlate:new nQ(0,0),startForSmallPlate:new nQ(1,0),direction:eQ.DOWN},right:{startForBigPlate:new nQ(L4.SIZE-1,0),startForSmallPlate:new nQ(L4.SIZE-2,0),direction:eQ.DOWN}}),F4.singleton=yw.empty();class U4 extends dQ{getListMoves(e){const t=e.gameState;return this.flatMapEmptyCoords(t,e=>{const n=[];for(const r of this.nextDirection(t)){const i=["diagonal","orthogonal"];for(const s of i){const i=F4.get().applyMoveWithoutPlacingCaptures(t,e,{direction:r,orientation:s}).captures.length;for(const o of this.captureCombinations(t,i))n.push(new A4(e,r,s,o))}}return n})}captureCombinations(e,t){if(0===t)return new gQ([{top:0,bottom:0,left:0,right:0}]);{const n=new gQ,r=e.remainingSpacesDetails(),i=this.captureCombinations(e,t-1);for(const e of i)e.top+1<=r.top&&n.add({...e,top:e.top+1}),e.bottom+1<=r.bottom&&n.add({...e,bottom:e.bottom+1}),e.left+1<=r.left&&n.add({...e,left:e.left+1}),e.right+1<=r.right&&n.add({...e,right:e.right+1});return 0===n.size()?i:n}}flatMapEmptyCoords(e,t){let n=[];for(let r=0;r<L4.SIZE;r++)for(let i=0;i<L4.SIZE;i++){const s=new nQ(i,r),o=e.getPieceAt(s);(o.isEmpty()&&!1===o.isUnreachable()||o.isLodestone()&&o.owner===e.getCurrentPlayer())&&(n=n.concat(t(s)))}return n}nextDirection(e){const t=e.nextLodestoneDirection();return t.isPresent()?[t.get()]:["push","pull"]}getBoardValue(e){const t=e.gameState.getScores();let n;return n=24===t[0]&&24!==t[1]?YY.ZERO.getVictoryValue():24!==t[0]&&24===t[1]?YY.ONE.getVictoryValue():t[0]*YY.ZERO.getScoreModifier()+t[1]*YY.ONE.getScoreModifier(),new pQ(n)}}const B4=N4.UNREACHABLE,V4=N4.EMPTY,$4=x4.ZERO,z4=x4.ONE,H4=R4.of(YY.ONE,{direction:"push",orientation:"orthogonal"}),G4={top:yw.of(D4.EMPTY_5),bottom:yw.of(D4.EMPTY_5),left:yw.of(D4.EMPTY_5),right:yw.of(D4.EMPTY_5)};class q4{constructor(){this.tutorial=[NQ.informational($localize`Board and aim of the game`,$localize`Lodestone is played on a 8x8 board, which contains so-called <i>pressure plates</i> along the board, that will contain captured pieces. The initial board is shown here. The aim of the game is to be the only player with pieces remaining on the board. To do so, you will have to either push your opponent's pieces off the board, or to crush them with your pieces. You will do it by using a lodestone.`,L4.getInitialState()),NQ.forClick($localize`Selecting a lodestone`,$localize`To perform a move, you have to place your lodestone on the board. Your lodestone has two sides: <ul><li>its <i>repelling</i> side with which it will repel the opponent's pieces (indicated by the outward triangles of your opponent's color on the lodestone), and</li><li>its <i>attracting</i> side with which it will attract your pieces (indicated by the inward triangles of your color on the lodestone).</li></ul>Your lodestone can be placed to move pieces orthogonally or diagonally. All available lodestone sides and orientation are shown below the board.<br/><br/>You're playing Dark. Select the lodestone that repels your opponent's pieces diagonally.`,L4.getInitialState(),["#lodestone_push_diagonal"],$localize`Congratulations!`,$localize`This is not the right lodestone, try again.`),NQ.informational($localize`The repelling lodestone`,$localize`Upon placing a lodestone on the board, it will move all pieces it acts upon (according to its direction and orientation) simultaneously. Let us first see how the repelling lodestone acts on the pieces. All the opponent's pieces aligned with the lodestone, as indicated by the triangles' orientations, will be pushed one square away from the lodestone. An opponent's piece will be blocked in case it encounters on its way either one of your piece, a lodestone, or another blocked piece. Finally, if an opponent's piece falls out of the board, it is captured.`,L4.getInitialState()),NQ.informational($localize`The attracting lodestone`,$localize`When the lodestone is on its attracting side it will pull your pieces one square towards it. In case one of your pieces encounters a lodestone on its way or another blocked piece, it is blocked. However, if it encounter an opponent's piece, it will capture it.`,L4.getInitialState()),NQ.informational($localize`Flipping the lodestone`,$localize`Note that, after every move, you must flip your lodestone: if it was on its repelling side, you must use it on its attracting side, and vice versa. Also, you are allowed to place your lodestone on the same location as it was on your previous turn.`,L4.getInitialState()),NQ.fromPredicate($localize`Capturing`,$localize`To summarize, it is possible to capture the opponent's pieces in two ways:<ul><li>with a repelling lodestone, by pushing your opponent's pieces out of the board, or</li><li>with an attracting lodestone, by moving your pieces on your opponent's pieces.</li></ul>Once a lodestone is placed and the pieces have been moved and/or captured, in case any of the opponent's pieces have been captured, you have to place them on the <i>pressure plates</i> that lie around the board. To do so, click on an empty space of the pressure plate of your choice for each capture. You can cancel this by clicking again on a piece you just put on a pressure plate.<br/><br/>You're playing Dark. Try to perform a move that captures at least one of your opponent's piece, and place your capture(s) on pressure plates.`,L4.getInitialState(),new A4(new nQ(0,6),"pull","orthogonal",{top:2,bottom:1,left:1,right:1}),(e,t)=>32===t.remainingSpaces()?FG.failure($localize`You have not captured any of the opponent's pieces, try again!`):FG.SUCCESS,"Congratulations!"),NQ.fromPredicate($localize`Crumbling a first pressure plate`,$localize`When a pressure plate is full, it will crumble and take a full row or column of the board with it! All pieces that are on the crumbled squares are considered lost, but will not have to be placed on pressure plates. You have here a board with a pressure plate that only requires one more piece to crumble.<br/><br/>You're playing Dark. Perform a move that captures at least one piece, and fill that pressure plate to make it crumble.`,new L4([[V4,V4,V4,V4,z4,V4,V4,V4],[V4,V4,$4,V4,V4,z4,V4,V4],[V4,V4,H4,V4,V4,V4,V4,$4],[V4,V4,V4,V4,z4,V4,V4,$4],[V4,V4,V4,V4,V4,$4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4]],0,new SQ([{key:YY.ONE,value:new nQ(2,2)}]),{...G4,top:D4.EMPTY_5.addCaptured(YY.ONE,4)}),new A4(new nQ(6,2),"push","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>5===t.pressurePlates.top.get().width?FG.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble!`):FG.SUCCESS,"Congratulations!"),NQ.fromPredicate($localize`Crumbling a second pressure plate`,$localize`Once a pressure plate has crumbled, a shorter pressure plate takes it place. It is the case here, where only 3 spots are available on the top pressure plate.<br/><br/>You're playing Dark. Perform a move that captures enough pieces to fill the top pressure plate, and make it crumble.`,new L4([[B4,B4,B4,B4,B4,B4,B4,B4],[V4,V4,V4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,$4],[V4,V4,V4,V4,V4,$4,V4,$4],[V4,H4,V4,V4,z4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,z4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4]],0,new SQ([{key:YY.ONE,value:new nQ(1,4)}]),{...G4,top:D4.EMPTY_3.addCaptured(YY.ONE,2)}),new A4(new nQ(3,5),"pull","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>t.pressurePlates.top.isPresent()?FG.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble a second time!`):FG.SUCCESS,"Congratulations!"),NQ.informational($localize`Minimal board`,$localize`After a pressure plate has crumbled for a second time, there is no more pressure plate available on that side. In case all pressure plates have crumbled, the board is reduced to a 4x4 board.`,new L4([[B4,B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4,B4],[B4,B4,$4,z4,V4,V4,B4,B4],[B4,B4,H4,z4,V4,V4,B4,B4],[B4,B4,V4,$4,$4,V4,B4,B4],[B4,B4,$4,V4,V4,V4,B4,B4],[B4,B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4,B4]],0,new SQ([{key:YY.ONE,value:new nQ(2,3)}]),{top:yw.empty(),bottom:yw.empty(),left:yw.empty(),right:yw.empty()})),NQ.fromMove($localize`Making the lodestone fall`,$localize`If, at any point during the game, your lodestone is situated on a square that crumbles with a pressure plate, you will be allowed to select any lodestone side on your next turn.<br/><br/>In this board, playing Dark, you can place your lodestone and make a pressure plate crumble so that your lodestone falls too, allowing to choose more freely its side on your next turn. Do it!`,new L4([[V4,V4,V4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,V4,z4,V4,V4],[V4,V4,V4,H4,V4,V4,$4,V4],[V4,V4,$4,$4,z4,V4,V4,$4],[V4,V4,V4,V4,V4,$4,V4,V4],[V4,V4,$4,V4,V4,V4,V4,V4],[V4,V4,z4,V4,V4,V4,V4,V4],[V4,V4,V4,V4,V4,V4,V4,V4]],0,new SQ([{key:YY.ONE,value:new nQ(3,2)}]),{...G4,top:D4.EMPTY_5.addCaptured(YY.ONE,4)}),[new A4(new nQ(4,0),"pull","diagonal",{top:1,bottom:0,left:0,right:0})],$localize`Congratulations! At your next turn, you will be allowed to place your lodestone on any side.`,$localize`Failed, try again.`),NQ.fromMove($localize`End of the game`,$localize`In order to win, you must take out all of your opponent's pieces.<br/><br/>Here, you can win in a single move, do it!`,new L4([[B4,B4,B4,B4,B4,B4,B4,B4],[B4,B4,B4,B4,B4,B4,B4,B4],[B4,z4,$4,z4,V4,V4,B4,B4],[B4,z4,H4,V4,z4,V4,B4,B4],[B4,V4,V4,$4,$4,V4,B4,B4],[B4,z4,$4,V4,z4,V4,B4,B4],[B4,V4,V4,V4,$4,V4,B4,B4],[B4,B4,B4,B4,B4,B4,B4,B4]],0,new SQ([{key:YY.ONE,value:new nQ(2,3)}]),{top:yw.empty(),bottom:D4.EMPTY_3.addCaptured(YY.ZERO,2),left:yw.of(D4.EMPTY_3),right:yw.empty()}),[new A4(new nQ(4,2),"pull","orthogonal",{top:0,bottom:0,left:3,right:0})],$localize`Congratulations, you won!`,$localize`This is not the winning move. Try again.`)]}}function W4(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function j4(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba().$implicit,t=ba(3).$implicit,n=ba(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_OUT)}}function Z4(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=ba().$implicit,t=ba(3).$implicit,n=ba(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_IN)}}function Y4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,j4,1,3,"polygon",14),la(2,Z4,1,3,"polygon",14),fa()),2&e){const e=ba(3).$implicit;Ts(1),ha("ngIf","push"===e.lodestone.direction),Ts(1),ha("ngIf","pull"===e.lodestone.direction)}}const K4=function(){return[0,1,2,3]};function J4(e,t){if(1&e&&(Cn(),pa(0,"g",11),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,Y4,3,2,"g",1),fa(),fa()),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();ra("transform",i.getSquareTransform(t,r)),Ts(1),ha("ngClass",n.lodestone.selectedClass),ra("r",i.PIECE_RADIUS),Ts(1),ha("ngClass",n.lodestone.pieceClasses),ra("r",i.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===n.lodestone.orientation?45:0,")"),Ts(1),ha("ngForOf",lu(7,K4))}}function Q4(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).selectCoord(t.coord)}),ga(1,"rect",7),la(2,W4,1,6,"circle",8),la(3,J4,5,8,"g",9),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","square_",t,"_",r,""),Ts(1),ha("ngClass",n.squareClasses),ra("x",i.SPACE_SIZE*t+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",n.hasPiece),Ts(1),ha("ngIf",n.lodestone)}}function X4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Q4,4,9,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",!1===e.crumbled)}}function e5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,X4,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function t5(e,t){if(1&e&&(Cn(),pa(0,"g",16),ga(1,"circle",17),fa()),2&e){const e=t.$implicit,n=t.index,r=ba();Ta("id","capture_",n,""),ra("transform",r.getCaptureTransform(n)),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS)}}function n5(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polygon",15),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),aa("transform","rotate(",90*e,")"),ha("ngClass",n.movingClass),ra("points","push"===n.direction?r.TRIANGLE_OUT:r.TRIANGLE_IN)}}function r5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){const t=Gt(e).$implicit;return ba().selectLodestone(t)}),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,n5,2,3,"g",1),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba();Ia("id","lodestone_",e.direction,"_",e.orientation,""),ra("transform",r.getAvailableLodestoneTransform(n)),Ts(1),ha("ngClass",e.selectedClass),ra("r",r.PIECE_RADIUS),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===e.orientation?45:0,")"),Ts(1),ha("ngForOf",lu(9,K4))}}function i5(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().$implicit,i=ba();Ia("id","platePiece_",r.position,"_",t,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*n.coord.x+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*n.coord.y+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function s5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",6),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index,i=ba().$implicit;return ba().onPressurePlateClick(n.temporary,i.position,r)}),ga(2,"rect",18),la(3,i5,1,6,"circle",8),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().$implicit,i=ba();ra("transform",i.getPressurePlateTransform(r.position)),Ts(1),Ia("id","plate_",r.position,"_",n,""),Ts(1),Ia("id","plateSquare_",r.position,"_",n,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*e.coord.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*e.coord.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.hasPiece)}}function o5(e,t){if(1&e&&(Cn(),pa(0,"g",16),la(1,s5,4,11,"g",1),fa()),2&e){const e=t.$implicit;Ta("id","pressurePlate_",e.position,""),Ts(1),ha("ngForOf",e.coords)}}function a5(e,t){if(1&e&&(Cn(),ga(0,"rect",19)),2&e){const e=ba();Ia("id","selection_",e.viewInfo.selected.get().x,"_",e.viewInfo.selected.get().y,""),ra("x",e.SPACE_SIZE*e.viewInfo.selected.get().x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.viewInfo.selected.get().y+e.STROKE_WIDTH)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}class l5 extends rQ{constructor(e){super(e),this.viewInfo={availableLodestones:[],capturesToPlace:[],boardInfo:[],currentPlayerClass:"",opponentClass:"",pressurePlates:[],selected:yw.empty(),pressurePlateShift:{top:new JJ(0,0),left:new JJ(0,0),right:new JJ(0,0),bottom:new JJ(0,0)}},this.stateAfterPlacingLodestone=yw.empty(),this.lastInfos=yw.empty(),this.capturesToPlace=0,this.selectedCoord=yw.empty(),this.selectedLodestone=yw.empty(),this.captures={top:0,bottom:0,left:0,right:0},this.rules=F4.get(),this.tutorial=(new q4).tutorial,this.availableMinimaxes=[new U4(this.rules,"LodestoneDummyMinimax")],this.encoder=A4.encoder,this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH);const t=.8*this.PIECE_RADIUS,n=.3*this.PIECE_RADIUS,r=.2*this.PIECE_RADIUS;this.TRIANGLE_OUT=`${t},0 ${n},${r} ${n},-${r}`,this.TRIANGLE_IN=`${n},0 ${t},${n} ${t},-${n}`,this.displayedState=this.rules.node.gameState,this.scores=yw.of([0,0])}ngOnInit(){this.updateBoard()}selectCoord(e){var t=this;return hw(function*(){const n=t.canUserPlay("#square_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.capturesToPlace>0)return t.cancelMove(M4.MUST_PLACE_CAPTURES());const r=F4.get().isTargetLegal(t.getState(),e);return r.isFailure()?t.cancelMove(r.getReason()):t.selectedLodestone.isPresent()?(t.selectedCoord=yw.of(e),t.putLodestone()):(t.selectedCoord=yw.of(e),t.updateViewInfo(),FG.SUCCESS)})()}selectLodestone(e){var t=this;return hw(function*(){const n=t.canUserPlay("#lodestone_"+e.direction+"_"+e.orientation);if(n.isFailure())return t.cancelMove(n.getReason());zG(0===t.capturesToPlace,"should not be able to click on a lodestone when captures need to be placed");const r=t.getCurrentPlayer();return t.selectedLodestone=yw.of(R4.of(r,e)),t.selectedCoord.isPresent()?t.putLodestone():(t.updateViewInfo(),FG.SUCCESS)})()}putLodestone(){var e=this;return hw(function*(){zG(e.selectedCoord.isPresent(),"coord should have been selected"),zG(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=e.getState();zG(F4.get().isLegalWithoutCaptures(r,t,n.direction).isSuccess(),"Lodestone component should only allow creation of legal moves");const i=F4.get().applyMoveWithoutPlacingCaptures(r,t,n);return e.lastInfos=yw.of(i),e.capturesToPlace=Math.min(i.captures.length,r.remainingSpaces()),0===e.capturesToPlace?e.applyMove():(e.displayedState=e.displayedState.withBoard(i.board),e.stateAfterPlacingLodestone=yw.of(e.displayedState),e.updateViewInfo(),FG.SUCCESS)})()}applyMove(){var e=this;return hw(function*(){zG(e.selectedCoord.isPresent(),"coord should have been selected"),zG(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=new A4(t,n.direction,n.orientation,e.captures);return e.chooseMove(r,e.getState())})()}onPressurePlateClick(e,t,n){return e?this.deselectPressurePlate(t,n):this.selectPressurePlate(t,n)}selectPressurePlate(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(0===n.capturesToPlace)return n.cancelMove(M4.NO_CAPTURES_TO_PLACE_YET());n.capturesToPlace--,n.captures[e]++;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=eK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return F4.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new L4(o,i.turn,l,a),0===n.capturesToPlace?n.applyMove():(n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),FG.SUCCESS)})()}deselectPressurePlate(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.capturesToPlace++,n.captures[e]--;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=eK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return F4.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new L4(o,i.turn,l,a),n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),FG.SUCCESS})()}updateBoard(){this.cancelMoveAttempt(),this.rules.node.move.isPresent()&&this.showLastMove(),this.scores=yw.of(this.getState().getScores())}cancelMoveAttempt(){this.displayedState=this.getState(),this.stateAfterPlacingLodestone=yw.empty(),this.lastInfos=yw.empty();const e=this.displayedState.lodestones.get(this.getCurrentPlayer());if(e.isPresent()){const t=eK.copyBiArray(this.displayedState.board);t[e.get().y][e.get().x]=N4.EMPTY,this.displayedState=this.displayedState.withBoard(t)}this.selectedCoord=yw.empty(),this.selectedLodestone=yw.empty(),this.capturesToPlace=0,this.captures={top:0,bottom:0,left:0,right:0},this.updateViewInfo()}updateViewInfo(){const e=this.getState().getCurrentPlayer();this.viewInfo.currentPlayerClass=this.getPlayerClass(e),this.viewInfo.opponentClass=this.getPlayerClass(e.getOpponent()),this.showBoard(),this.showAvailableLodestones(),this.showCapturesToPlace(),this.showPressurePlates(),this.computePressurePlateShift(),this.lastInfos.isPresent()&&this.showMovedAndCaptured(this.lastInfos.get())}showBoard(){this.viewInfo.boardInfo=[];for(let e=0;e<L4.SIZE;e++){this.viewInfo.boardInfo.push([]);for(let t=0;t<L4.SIZE;t++){const n=new nQ(t,e);this.viewInfo.boardInfo[e].push(this.getSquareInfo(n))}}this.viewInfo.selected=this.selectedCoord.isPresent()&&!1===this.displayedState.getPieceAt(this.selectedCoord.get()).isUnreachable()?this.selectedCoord:yw.empty()}getSquareInfo(e){const t=this.displayedState.getPieceAt(e),n={coord:e,squareClasses:[],crumbled:t.isUnreachable(),hasPiece:t.isPlayerPiece(),pieceClasses:[]};return t.isPlayerPiece()&&(n.pieceClasses=[this.getPlayerClass(t.owner)]),t.isLodestone()&&(n.lodestone={direction:t.direction,pieceClasses:[this.getPlayerClass(t.owner)],selectedClass:"",movingClass:"",orientation:t.orientation},n.lodestone.movingClass=this.getPlayerClass("push"===t.direction?t.owner.getOpponent():t.owner)),n}showAvailableLodestones(){if(this.capturesToPlace>0)this.viewInfo.availableLodestones=[];else{const e=this.getState().getCurrentPlayer(),t=this.getState().nextLodestoneDirection();if(t.isPresent()){const n=t.get();this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:n,orientation:"orthogonal"}),this.nextLodestone(e,{direction:n,orientation:"diagonal"})]}else this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:"push",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"push",orientation:"diagonal"}),this.nextLodestone(e,{direction:"pull",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"pull",orientation:"diagonal"})]}}showCapturesToPlace(){const e=this.getCurrentPlayer().getOpponent();this.viewInfo.capturesToPlace=[];for(let t=0;t<this.capturesToPlace;t++)this.viewInfo.capturesToPlace.push({pieceClasses:[this.getPlayerClass(e)]})}nextLodestone(e,t){const n=R4.of(e,t),r={direction:n.direction,orientation:n.orientation,pieceClasses:[this.getPlayerClass(n.owner)],movingClass:"",selectedClass:""};return r.movingClass=this.getPlayerClass("push"===n.direction?n.owner.getOpponent():n.owner),this.selectedLodestone.equalsValue(n)&&(r.selectedClass="selected"),r}showPressurePlates(){this.viewInfo.pressurePlates=[];for(const e of D4.POSITIONS){const t=[],n=this.displayedState.pressurePlates[e];if(n.isPresent()){const r=l5.PRESSURE_PLATES_POSITIONS.get(e).get(),i=n.get().width;let s=5===i?r.startForBigPlate:r.startForSmallPlate;for(let e=0;e<i;e++){s=s.getNext(r.direction);const i=n.get().getPieceAt(e);let o="";i.isPlayerPiece()&&(o=this.getPlayerClass(i.owner)),t.push({coord:s,hasPiece:i.isPlayerPiece(),pieceClasses:[o],squareClasses:[],temporary:!1})}}this.viewInfo.pressurePlates.push({position:e,coords:t})}}showLastMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.move.get();this.lastInfos=yw.of(F4.get().applyMoveWithoutPlacingCaptures(e,t.coord,t)),this.updateViewInfo();const n=this.getState();this.showPressurePlateDifferences(e,n,!1)}showPressurePlateDifferences(e,t,n){for(const r of D4.POSITIONS)this.showPressurePlateDifference(e.pressurePlates[r],t.pressurePlates[r],r,n)}showPressurePlateDifference(e,t,n,r){if(e.isPresent()&&t.isPresent()){const i=e.get(),s=t.get(),o=dw.getNonNullable(this.viewInfo.pressurePlates.find(e=>e.position===n));if(i.width===s.width)for(let e=0;e<s.width;e++){const t=i.getPieceAt(e),n=s.getPieceAt(e);!1===t.equals(n)&&(o.coords[e].squareClasses.push("moved"),o.coords[e].temporary=r,r&&o.coords[e].pieceClasses.push("transparent"))}else for(const e of o.coords)e.squareClasses.push("moved")}}showMovedAndCaptured(e){for(const t of e.moved)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved");for(const t of e.captures)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("captured")}computePressurePlateShift(){const e=this.displayedState,t=this.getPressurePlateShift(e.pressurePlates.left),n=this.getPressurePlateShift(e.pressurePlates.right),r=this.getPressurePlateShift(e.pressurePlates.top),i=this.getPressurePlateShift(e.pressurePlates.bottom);this.viewInfo.pressurePlateShift.top=new nQ(.5*(t-n),0),this.viewInfo.pressurePlateShift.bottom=new nQ(.5*(t-n),0),this.viewInfo.pressurePlateShift.left=new nQ(0,.5*(r-i)),this.viewInfo.pressurePlateShift.right=new nQ(0,.5*(r-i))}getPressurePlateShift(e){return e.isAbsent()?2:3===e.get().width?1:0}getSquareTransform(e,t){return`translate(${e*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2}, ${t*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getCaptureTransform(e){return`translate(${(e+(L4.SIZE/2-this.viewInfo.capturesToPlace.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${-2*this.SPACE_SIZE-30+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getAvailableLodestoneTransform(e){return`translate(${(e+(L4.SIZE/2-this.viewInfo.availableLodestones.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${30+9*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getPressurePlateTransform(e){return`translate(${this.viewInfo.pressurePlateShift[e].x*this.SPACE_SIZE}, ${this.viewInfo.pressurePlateShift[e].y*this.SPACE_SIZE})`}}l5.PRESSURE_PLATE_EXTRA_SHIFT=.2,l5.PRESSURE_PLATES_POSITIONS=SQ.from({top:{startForBigPlate:new nQ(.5,-1-l5.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new nQ(1.5,0-l5.PRESSURE_PLATE_EXTRA_SHIFT),direction:eQ.RIGHT},bottom:{startForBigPlate:new nQ(.5,8+l5.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new nQ(1.5,7+l5.PRESSURE_PLATE_EXTRA_SHIFT),direction:eQ.RIGHT},left:{startForBigPlate:new nQ(-1-l5.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new nQ(0-l5.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:eQ.DOWN},right:{startForBigPlate:new nQ(8+l5.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new nQ(7+l5.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:eQ.DOWN}}),l5.\u0275fac=function(e){return new(e||l5)(ua(VG))},l5.\u0275cmp=Xe({type:l5,selectors:[["app-lodestone"]],features:[Go],decls:6,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 -220 1016 1256","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],["class","base no-fill selected",3,"id",4,"ngIf"],[3,"id","click",4,"ngIf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"id","ngClass",4,"ngIf"],["class","lodestone",4,"ngIf"],[1,"base",3,"id","ngClass"],[1,"lodestone"],["cx","0","cy","0",1,"base","black-fill","outside",3,"ngClass"],["cx","0","cy","0",1,"base","no-stroke",3,"ngClass"],["class","base no-stroke",3,"ngClass",4,"ngIf"],[1,"base","no-stroke",3,"ngClass"],[3,"id"],["cx","0","cy","0",1,"base",3,"ngClass"],["rx","20","ry","20",1,"base",3,"id","ngClass"],[1,"base","no-fill","selected",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,e5,2,1,"g",1),la(2,t5,2,4,"g",2),la(3,r5,5,10,"g",3),la(4,o5,2,2,"g",2),la(5,a5,1,6,"rect",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.viewInfo.capturesToPlace),Ts(1),ha("ngForOf",t.viewInfo.availableLodestones),Ts(1),ha("ngForOf",t.viewInfo.pressurePlates),Ts(1),ha("ngIf",t.viewInfo.selected.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});const c5=Number.MAX_SAFE_INTEGER,u5=Number.MIN_SAFE_INTEGER;class h5 extends yQ{constructor(e,t){super(eK.copyBiArray(h5.initialBoard),e),this.turn=e,this.location=t}static getInitialState(){return new h5(0,new nQ(0,0))}}h5.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],h5.BOARD_1=[[0,+c5,-1,-1],[1,2,+c5,-1],[+u5,3,4,-1],[-1,+u5,+u5,-1]],h5.BOARD_2=[[0,+c5,-1,-1],[+c5,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],h5.BOARD_3=[[0,1,+u5,-1],[1,+u5,-1,-1],[+u5,-1,-1,-1],[-1,-1,-1,-1]],h5.BOARD_4=[[0,1,+u5,-1],[1,+u5,-1,-1],[+u5,-1,-1,-1],[-1,-1,-1,1]],h5.initialBoard=h5.BOARD_0;class d5 extends IQ{static getGameStatus(e){const t=e.gameState,n=t.getPieceAt(t.location);return n===YY.ZERO.getVictoryValue()?TQ.ZERO_WON:n===YY.ONE.getVictoryValue()?TQ.ONE_WON:t.location.equals(new nQ(3,3))?0===n?TQ.DRAW:n>0?TQ.ONE_WON:TQ.ZERO_WON:TQ.ONGOING}applyLegalMove(e,t,n){const r=new nQ(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new h5(t.turn+1,r)}isLegal(e,t){const n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?RG.failure("incorrect move"):RG.success(void 0)}getGameStatus(e){return d5.getGameStatus(e)}}class p5 extends _Q{constructor(e){super(),this.right=e}equals(e){return this===e||this.right===e.right}toString(){return this.right?"Move RIGHT":"Move DOWN"}}p5.RIGHT=new p5(!0),p5.DOWN=new p5(!1),p5.encoder=new class extends jY{maxValue(){return 1}decodeNumber(e){return 0===e?p5.RIGHT:p5.DOWN}encodeNumber(e){return e.right?0:1}};class f5 extends dQ{getBoardValue(e){const t=d5.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());const n=e.gameState;return new pQ(n.getPieceAt(n.location))}getListMoves(e){const t=[],n=e.gameState;return n.location.x<3&&t.push(p5.RIGHT),n.location.y<3&&t.push(p5.DOWN),t}}function g5(e,t){1&e&&(ma(0),Fa(1,"("),ya())}function m5(e,t){1&e&&(ma(0),Fa(1,")"),ya())}function y5(e,t){if(1&e&&(pa(0,"td"),la(1,g5,2,0,"ng-container",3),Fa(2),la(3,m5,2,0,"ng-container",3),fa()),2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r),Ts(1),Ba(" ",e," "),Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r)}}function v5(e,t){if(1&e&&(pa(0,"tr"),la(1,y5,4,3,"td",0),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let _5=(()=>{class e extends pX{constructor(e){super(e),this.coord=new nQ(-1,-1),this.rules=new d5(h5),this.availableMinimaxes=[new f5(this.rules,"MinimaxTestingMinimax")],this.encoder=p5.encoder}chooseRight(){var e=this;return hw(function*(){const t=e.canUserPlay("#click_right");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(p5.RIGHT,e.rules.node.gameState)})()}chooseDown(){var e=this;return hw(function*(){const t=e.canUserPlay("#click_down");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(p5.DOWN,e.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-minimax-testing"]],features:[Go],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(pa(0,"table"),la(1,v5,2,1,"tr",0),pa(2,"div",1),Ea("click",function(){return t.chooseRight()}),Fa(3," goRight "),fa(),pa(4,"div",2),Ea("click",function(){return t.chooseDown()}),Fa(5," goDown "),fa(),pa(6,"div"),Fa(7),fa(),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(6),Ba(" ",t.coord," "))},directives:[$d,Hd],encapsulation:2}),e})();class C5 extends yQ{static getInitialState(){const e=eK.createTable(7,6,KY.NONE);return new C5(e,0)}}class E5 extends _Q{constructor(e){super(),this.x=e}static of(e){switch(e){case 0:return E5.ZERO;case 1:return E5.ONE;case 2:return E5.TWO;case 3:return E5.THREE;case 4:return E5.FOUR;case 5:return E5.FIVE;case 6:return E5.SIX;default:throw new Error("Invalid P4Move")}}equals(e){return this===e}toString(){return"P4Move("+this.x+")"}}E5.ZERO=new E5(0),E5.ONE=new E5(1),E5.TWO=new E5(2),E5.THREE=new E5(3),E5.FOUR=new E5(4),E5.FIVE=new E5(5),E5.SIX=new E5(6),E5.encoder=new class extends jY{maxValue(){return 6}encodeNumber(e){return e.x}decodeNumber(e){return E5.of(e)}};let w5=(()=>{class e{}return e.COLUMN_IS_FULL=()=>$localize`Please put your piece in an incomplete column.`,e})(),S5=(()=>{class e extends IQ{static getVictoriousCoords(t){const n=[];for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new nQ(r,i));(s===YY.ZERO.getVictoryValue()||s===YY.ONE.getVictoryValue())&&n.push(new nQ(r,i))}return n}static getBoardValueFromScratch(t){pw(e.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:t}});let n=0;for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new nQ(r,i));if(OQ.getScoreStatus(s)!==wQ.DEFAULT)return pw(e.VERBOSE,{preVictoryOrVictory:{state:t,tmpScore:s,coord:{x:r,y:i}}}),new pQ(s);n+=s}return new pQ(n)}static getLowestUnoccupiedCase(e,t){let n=0;for(;n<6&&e[n][t]===KY.NONE;)n++;return n-1}static getNumberOfFreeSpacesAndAllies(e,t,n,r,i){let s=0,o=0,a=!0,l=new nQ(t.x+n.x,t.y+n.y);for(;l.isInRange(7,6)&&3!==s;){const t=e[l.y][l.x];if(t===r)return[s,o];t===i&&a?o++:a=!1,t!==r&&t!==i&&s++,l=l.getNext(n)}return[s,o]}static getOpponent(e,t){const n=e[t.y][t.x];return zG(n.isPlayer(),"getOpponent should not be called with PlayerOrNone.NONE"),n===YY.ONE?YY.ZERO:YY.ONE}static getSquareScore(t,n){pw(e.VERBOSE,"getSquareScore(board, "+n.x+", "+n.y+") called"),pw(e.VERBOSE,t);let r=0;const i=e.getOpponent(t,n),s=i.getOpponent(),o=new SQ,a=new SQ;for(const l of eQ.DIRECTIONS){const r=e.getNumberOfFreeSpacesAndAllies(t,n,l,i,s);o.set(l,r[0]),a.set(l,r[1])}for(const l of[eQ.UP,eQ.UP_RIGHT,eQ.RIGHT,eQ.DOWN_RIGHT]){const i=a.get(l).get()+a.get(l.getOpposite()).get();if(i>2)return pw(e.VERBOSE,{text:"there is some kind of victory here ("+n.x+", "+n.y+")\nline allies : "+i+"\n",board:t}),s.getVictoryValue();const c=o.get(l).get()+o.get(l.getOpposite()).get();3===c?r+=2:c>3&&(r+=c-2)}return r*s.getScoreModifier()}static getListMoves(t){pw(e.VERBOSE,{context:"P4Rules.getListMoves",node:t});const n=t.gameState,r=[];for(let e=0;e<7;e++)if(n.getPieceAtXY(e,0)===KY.NONE){const t=E5.of(e);r.push(t)}return r}static getBoardValue(t){return pw(e.VERBOSE,{text:"P4Rules.getBoardValue called",board:t.getCopiedBoard()}),e.getBoardValueFromScratch(t)}applyLegalMove(t,n,r){const i=t.x,s=n.getCopiedBoard(),o=e.getLowestUnoccupiedCase(s,i),a=n.turn;return s[o][i]=n.getCurrentPlayer(),new C5(s,a+1)}isLegal(t,n){return pw(e.VERBOSE,{context:"P4Rules.isLegal",move:t.toString(),state:n}),n.getPieceAtXY(t.x,0).isPlayer()?RG.failure(w5.COLUMN_IS_FULL()):RG.success(void 0)}getGameStatus(t){const n=t.gameState;for(let r=0;r<7;r++)for(let t=5;t>=0&&n.board[t][r].isPlayer();t--){const i=e.getSquareScore(n.board,new nQ(r,t));if(OQ.getScoreStatus(i)===wQ.VICTORY)return TQ.getVictory(n.getCurrentOpponent())}return 42===n.turn?TQ.DRAW:TQ.ONGOING}}return e.VERBOSE=!1,e})();class b5 extends dQ{getListMoves(e){return S5.getListMoves(e)}getBoardValue(e){const t=e.gameState;return pw(S5.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),S5.getBoardValue(t)}}const P5=YY.ZERO,O5=YY.ONE,T5=KY.NONE;class I5{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.
        The first player plays Dark, the second plays Light.
        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally).`,C5.getInitialState()),NQ.anyMove($localize`Dropping a piece`,$localize`Click on any space in any column.`,C5.getInitialState(),E5.THREE,$localize`As you can see, the piece falls at the bottom of the column.`),NQ.fromMove($localize`Victory`,$localize`You're playing Dark.
        Place your piece so that you create a horizontal alignment of 4 of your pieces.`,new C5([[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,O5,T5,T5,T5],[T5,T5,T5,O5,T5,T5,T5],[T5,T5,P5,P5,P5,O5,T5]],0),[E5.of(1)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`),NQ.fromMove($localize`Other victory`,$localize`You can also align 4 pieces diagonally or vertically.`,new C5([[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,T5,T5,T5,T5],[T5,T5,T5,P5,O5,T5,T5],[T5,T5,P5,P5,O5,T5,T5],[T5,P5,O5,P5,P5,T5,T5]],0),[E5.of(3),E5.of(4)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`)]}}function k5(e,t){if(1&e&&(Cn(),ga(0,"circle",6)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getSquareFillClass(e,t)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function A5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",4),Ea("click",function(){const t=Gt(e).index;return ba(2).onClick(t)}),fa(),la(2,k5,1,4,"circle",5),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ta("id","click_",n,""),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!=i.EMPTY_CASE)}}function M5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,A5,3,6,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function N5(e,t){if(1&e&&(Cn(),ga(0,"rect",7)),2&e){const e=ba();ra("x",e.SPACE_SIZE*e.last.get().x)("y",e.SPACE_SIZE*e.last.get().y)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function x5(e,t){if(1&e&&(Cn(),ga(0,"rect",8)),2&e){const e=t.$implicit,n=ba();Ia("id","victory_coord_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let R5=(()=>{class e extends pX{constructor(e){super(e),this.EMPTY_CASE=KY.NONE,this.victoryCoords=[],this.rules=new S5(C5),this.availableMinimaxes=[new b5(this.rules,"P4Minimax")],this.encoder=E5.encoder,this.tutorial=(new I5).tutorial,this.updateBoard()}onClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#click_"+e);if(n.isFailure())return t.cancelMove(n.getReason());const r=E5.of(e);return yield t.chooseMove(r,t.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=S5.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}showLastMove(){const e=this.rules.node.move,t=S5.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=yw.of(new nQ(e.get().x,t))}hideLastMove(){this.last=yw.empty()}getSquareFillClass(e,t){return[this.getPlayerClass(this.board[t][e])]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-p4"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[1,"base",3,"id","click"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,M5,2,1,"g",1),la(2,N5,1,4,"rect",2),la(3,x5,1,6,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.last.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class D5 extends CQ{constructor(e,t,n,r=!1){if(super(e,t),this.blockTurned=n,this.turnedClockwise=r,this.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+this.coord.toString())}static withRotation(e,t,n,r){if(n<0||3<n)throw new Error("This block do not exist: "+n);return new D5(e,t,yw.of(n),r)}static rotationless(e,t){return new D5(e,t,yw.empty())}toString(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}D5.encoder=new class extends WY{encodeMove(e){const t={coord:nQ.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}decodeMove(e){const t=e,n=nQ.encoder.decode(t.coord),r=yw.ofNullable(t.blockTurned);if(r.isPresent()){const e=t.turnedClockwise;return D5.withRotation(n.x,n.y,r.get(),e)}return D5.rotationless(n.x,n.y)}};let L5=(()=>{class e{}return e.CANNOT_ROTATE_NEUTRAL_BLOCK=()=>$localize`If the quadrant to turn is neutral, please just use move without rotation.`,e.MUST_CHOOSE_BLOCK_TO_ROTATE=()=>$localize`No quadrant is neutral, you must pick a quadrant to rotate.`,e})();class F5 extends yQ{constructor(e,t){super(e,t),this.neutralBlocks=this.getBlocksNeutralities()}static getInitialState(){const e=eK.createTable(6,6,KY.NONE);return new F5(e,0)}getBlocksNeutralities(){const e=[];for(let t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}getBlockNeutrality(e){const t=F5.getBlockCenter(e),n=this.getPieceAt(t.getNext(eQ.UP,1)),r=this.getPieceAt(t.getNext(eQ.UP_LEFT,1));return this.getPieceAt(t.getNext(eQ.RIGHT,1))===n&&this.getPieceAt(t.getNext(eQ.DOWN,1))===n&&this.getPieceAt(t.getNext(eQ.LEFT,1))===n&&this.getPieceAt(t.getNext(eQ.UP_RIGHT,1))===r&&this.getPieceAt(t.getNext(eQ.DOWN_RIGHT,1))===r&&this.getPieceAt(t.getNext(eQ.DOWN_LEFT,1))===r}static getBlockCenter(e){return new nQ(1+(e%2==0?0:3),1+(e<2?0:3))}applyLegalDrop(e){const t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new F5(t,this.turn)}applyLegalMove(e){const t=this.applyLegalDrop(e),n=t.getCopiedBoard();if(e.blockTurned.isPresent()){const r=F5.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise)for(const e of F5.ROTATION_MAP){const i=e[0].getNext(r),s=e[1].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}else for(const e of F5.ROTATION_MAP){const i=e[1].getNext(r),s=e[0].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}}return new F5(n,this.turn+1)}blockIsNeutral(e){return this.neutralBlocks.includes(e)}}F5.ROTATION_MAP=[[new nQ(-1,-1),new nQ(1,-1)],[new nQ(0,-1),new nQ(1,0)],[new nQ(1,-1),new nQ(1,1)],[new nQ(1,0),new nQ(0,1)],[new nQ(1,1),new nQ(-1,1)],[new nQ(0,1),new nQ(-1,0)],[new nQ(-1,1),new nQ(-1,-1)],[new nQ(-1,0),new nQ(0,-1)]];class U5 extends IQ{static get(){return U5.singleton.isAbsent()&&(U5.singleton=yw.of(new U5(F5))),U5.singleton.get()}applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){if(t.getPieceAt(e.coord).isPlayer())return RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return RG.failure(L5.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){const t=e.blockTurned.get();if(n.neutralBlocks.includes(t))return RG.failure(L5.CANNOT_ROTATE_NEUTRAL_BLOCK())}return RG.success(void 0)}getVictoryCoords(e){let t=[];for(const n of U5.VICTORY_SOURCE){const r=e.getPieceAt(n[0]),i=[n[0]];if(r.isPlayer()){let s=n[0].getNext(n[1]),o=!0;for(let t=0;t<3&&o;t++)e.getPieceAt(s)!==r?o=!1:(i.push(s),s=s.getNext(n[1]));if(o&&(e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i)),n[2])){const s=n[0].getPrevious(n[1],1);e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i))}}}return t}getGameStatus(e){const t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1];for(let i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?TQ.DRAW:TQ.ZERO_WON:!0===r[1]?TQ.ONE_WON:36===t.turn?TQ.DRAW:TQ.ONGOING}}U5.singleton=yw.empty(),U5.VICTORY_SOURCE=[[new nQ(1,0),new JJ(1,1),!1],[new nQ(0,1),new JJ(1,1),!1],[new nQ(4,0),new JJ(-1,1),!1],[new nQ(5,1),new JJ(-1,1),!1],[new nQ(1,1),new JJ(1,1),!0],[new nQ(4,1),new JJ(-1,1),!0],[new nQ(0,1),new JJ(0,1),!0],[new nQ(1,1),new JJ(0,1),!0],[new nQ(2,1),new JJ(0,1),!0],[new nQ(3,1),new JJ(0,1),!0],[new nQ(4,1),new JJ(0,1),!0],[new nQ(5,1),new JJ(0,1),!0],[new nQ(1,0),new JJ(1,0),!0],[new nQ(1,1),new JJ(1,0),!0],[new nQ(1,2),new JJ(1,0),!0],[new nQ(1,3),new JJ(1,0),!0],[new nQ(1,4),new JJ(1,0),!0],[new nQ(1,5),new JJ(1,0),!0]];class B5 extends dQ{getListMoves(e){const t=[],n=e.gameState.neutralBlocks;if(0===e.gameState.turn)return B5.FIRST_TURN_MOVES;const r=this.getLegalDrops(e.gameState);for(const i of r){const r=D5.rotationless(i.x,i.y),s=e.gameState.applyLegalDrop(r),o=this.getLegalRotations(s,n);for(const e of o)t.push(D5.withRotation(i.x,i.y,e[0],e[1]));0===s.neutralBlocks.length==0&&t.push(r)}return t}getLegalDrops(e){const t=[];for(let n=0;n<6;n++)for(let r=0;r<6;r++){const i=new nQ(r,n);e.getPieceAt(i)===KY.NONE&&t.push(i)}return t}getLegalRotations(e,t){const n=0===e.neutralBlocks.length,r=[];for(let i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}getBoardValue(e){return new pQ(U5.get().getGameStatus(e).toBoardValue())}}B5.FIRST_TURN_MOVES=[D5.rotationless(0,0),D5.rotationless(1,0),D5.rotationless(2,0),D5.rotationless(0,1),D5.rotationless(1,1),D5.rotationless(0,2)];const V5=KY.NONE,$5=YY.ONE,z5=YY.ZERO;class H5{constructor(){this.tutorial=[NQ.informational($localize`Initial board`,$localize`The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate.`,F5.getInitialState()),NQ.informational($localize`Goal of the game`,$localize`The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins.`,new F5([[z5,V5,V5,z5,$5,V5],[z5,$5,V5,V5,V5,V5],[z5,V5,$5,V5,V5,V5],[z5,V5,V5,V5,V5,$5],[z5,V5,V5,V5,$5,V5],[V5,V5,V5,V5,V5,V5]],10)).withPreviousMove(D5.withRotation(0,0,0,!1)),NQ.fromPredicate($localize`Simple move`,$localize`At their turn, players put a piece on the board and possibly rotate one quadrant.
        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.
        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>
        Do it.`,new F5([[V5,V5,V5,V5,V5,V5],[V5,z5,V5,V5,$5,V5],[V5,V5,V5,V5,V5,V5],[V5,V5,V5,V5,V5,V5],[V5,$5,V5,V5,z5,V5],[V5,V5,V5,V5,V5,V5]],10),D5.rotationless(2,2),(e,t)=>e.blockTurned.isPresent()?FG.failure($localize`You have made a move with a rotation. This tutorial step is about moves without rotations!`):FG.SUCCESS,$localize`Congratulations!`),NQ.fromPredicate($localize`Move with rotation`,$localize`After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>
        Click on one of them and see the rotation!`,new F5([[V5,V5,V5,V5,V5,V5],[V5,z5,V5,V5,$5,V5],[V5,V5,V5,V5,V5,V5],[V5,V5,V5,V5,V5,V5],[V5,$5,V5,V5,z5,V5],[V5,V5,V5,V5,V5,V5]],10),D5.withRotation(0,0,0,!0),(e,t)=>e.blockTurned.isPresent()?FG.SUCCESS:FG.failure($localize`You made a move without rotation, try again!`),$localize`Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation.`)]}}function G5(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",9),Ea("click",function(){const t=Gt(e).$implicit,n=ba().$implicit,r=ba().index,i=ba().index;return ba().onClick(3*r+t,3*i+n)}),fa(),ya()}if(2&e){const e=t.$implicit,n=ba().$implicit,r=ba(),i=r.index,s=r.$implicit,o=ba(),a=o.index,l=o.$implicit,c=ba();Ts(1),Ia("id","click_",3*i+e,"_",3*a+n,""),ha("ngClass",c.getSquareClasses(3*i+e,3*a+n)),ra("cx",s+2*c.STROKE_WIDTH+(e+.5)*c.SPACE_SIZE)("cy",l+2*c.STROKE_WIDTH+(n+.5)*c.SPACE_SIZE)("r",(c.SPACE_SIZE-c.STROKE_WIDTH)/2)}}const q5=function(){return[0,1,2]};function W5(e,t){1&e&&(Cn(),ma(0),la(1,G5,2,6,"ng-container",3),ya()),2&e&&(Ts(1),ha("ngForOf",lu(1,q5)))}function j5(e,t){if(1&e&&(Cn(),ma(0),ga(1,"rect",8),la(2,W5,2,2,"ng-container",3),ya()),2&e){const e=t.$implicit,n=t.index,r=ba(),i=r.index,s=r.$implicit,o=ba();Ts(1),ha("ngClass",o.getBlockClasses(n,i)),ra("x",o.STROKE_WIDTH+e)("y",o.STROKE_WIDTH+s)("rx",3*o.STROKE_WIDTH)("ry",3*o.STROKE_WIDTH)("width",o.BLOCK_WIDTH)("height",o.BLOCK_WIDTH),Ts(1),ha("ngForOf",lu(8,q5))}}const Z5=function(e){return[0,e]};function Y5(e,t){if(1&e&&(Cn(),ma(0),la(1,j5,3,9,"ng-container",3),ya()),2&e){const e=ba();Ts(1),ha("ngForOf",cu(1,Z5,e.BLOCK_SEPARATION))}}function K5(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba();Ia("id","currentDrop_",e.currentDrop.get().x,"_",e.currentDrop.get().y,""),ha("ngClass",e.getPlayerClass(e.rules.node.gameState.getCurrentPlayer())),ra("cx",e.getCenter(e.currentDrop.get().x))("cy",e.getCenter(e.currentDrop.get().y))("r",(e.SPACE_SIZE-e.STROKE_WIDTH)/2)}}function J5(e,t){if(1&e){const e=va();Cn(),pa(0,"path",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().rotate(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","rotate_",e[1],"_",e[2]?"clockwise":"counterclockwise",""),ra("d",e[0])("stroke-width",2*n.STROKE_WIDTH)}}function Q5(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=ba();Ia("id","victoryCoord_",e.x,"_",e.y,""),ha("ngClass",n.getSquareClasses(e.x,e.y)),ra("cx",n.getCenter(e.x))("cy",n.getCenter(e.y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)("stroke-width",n.STROKE_WIDTH)}}function X5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",13),Ea("click",function(){return Gt(e),ba().skipRotation()}),ga(1,"circle",14),ga(2,"line",15),fa()}if(2&e){const e=ba();Ts(1),ra("cx",e.BLOCK_SEPARATION)("cy",e.BLOCK_SEPARATION)("r",.75*e.SPACE_SIZE)("stroke-width",2*e.STROKE_WIDTH),Ts(1),ra("x1",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("y1",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("x2",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("y2",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("stroke-width",2*e.STROKE_WIDTH)}}let e6=(()=>{class e extends pX{constructor(e){super(e),this.arrows=[],this.victoryCoords=[],this.rules=new U5(F5),this.availableMinimaxes=[new B5(this.rules,"PentagoMinimax")],this.encoder=D5.encoder,this.tutorial=(new H5).tutorial,this.BLOCK_WIDTH=3*this.SPACE_SIZE+2*this.STROKE_WIDTH,this.BLOCK_SEPARATION=this.BLOCK_WIDTH+2*this.STROKE_WIDTH,this.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*this.SPACE_SIZE,this.ARROWS=this.generateArrowsCoord(),this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}showLastMove(){const e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{const t=e.get();this.movedBlock=t.blockTurned;const n=new nQ(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new nQ(0,0))&&this.coordBelongToBlock(t)){let e;e=t.turnedClockwise?dw.getNonNullable(F5.ROTATION_MAP.find(e=>e[0].equals(n)))[1]:dw.getNonNullable(F5.ROTATION_MAP.find(e=>e[1].equals(n)))[0];const r=t.blockTurned.get();e=e.getNext(new JJ(r%2==0?1:4,r<2?1:4),1),this.lastDrop=yw.of(e)}else this.lastDrop=yw.of(t.coord)}}coordBelongToBlock(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}hidePreviousMove(){this.lastDrop=yw.empty(),this.movedBlock=yw.empty(),this.victoryCoords=[]}generateArrowsCoord(){const e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}cancelMoveAttempt(){this.arrows=[],this.currentDrop=yw.empty(),this.canSkipRotation=!1}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.board[t][e].isPlayer())return n.cancelMove(hQ.MUST_LAND_ON_EMPTY_SPACE());const i=D5.rotationless(e,t),s=n.rules.node.gameState,o=s.applyLegalDrop(i);if(4===o.neutralBlocks.length)return n.chooseMove(i,s);const a=n.rules.getGameStatus(n.rules.node);return n.canSkipRotation=o.neutralBlocks.length>0&&!1===a.isEndGame,n.currentDrop=yw.of(new nQ(e,t)),n.displayArrows(o.neutralBlocks),FG.SUCCESS})()}getCenter(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}displayArrows(e){this.arrows=[];for(let t=0;t<4;t++)if(!1===e.includes(t)){const e=this.ARROWS.filter(e=>e[1]===t);this.arrows=this.arrows.concat(e)}}getBlockClasses(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}getSquareClasses(e,t){const n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new nQ(e,t))&&n.push("last-move"),n}rotate(e){var t=this;return hw(function*(){const n=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"));if(n.isFailure())return t.cancelMove(n.getReason());const r=t.currentDrop.get(),i=D5.withRotation(r.x,r.y,e[1],e[2]);return t.chooseMove(i,t.rules.node.gameState)})()}skipRotation(){var e=this;return hw(function*(){const t=e.canUserPlay("#skipRotation");if(t.isFailure())return e.cancelMove(t.getReason());const n=e.currentDrop.get(),r=D5.rotationless(n.x,n.y);return e.chooseMove(r,e.rules.node.gameState)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-pentago"]],features:[Go],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),fa(),la(4,Y5,2,3,"ng-container",3),la(5,K5,1,6,"circle",4),la(6,J5,1,4,"path",5),la(7,Q5,1,7,"circle",6),la(8,X5,3,9,"g",7),fa()),2&e&&(Ts(4),ha("ngForOf",cu(5,Z5,t.BLOCK_SEPARATION)),Ts(1),ha("ngIf",t.currentDrop.isPresent()),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngIf",t.canSkipRotation))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class t6 extends nQ{constructor(e,t,n){if(super(e,t),this.z=n,e<0||e>3)throw new Error(`PylosCoord: Invalid X: ${e}.`);if(t<0||t>3)throw new Error(`PylosCoord: Invalid Y: ${t}.`);if(n<0||n>3)throw new Error(`PylosCoord: Invalid Z: ${n}.`);const r=4-n;if(this.isNotInRange(r,r))throw new Error(this.toString()+" is not in range.")}static encodeOptional(e){let t;return t=e.isPresent()?t6.encode(e.get())+1:0,t}static encode(e){return 16*e.x+4*e.y+e.z}static decodeToOptional(e){return 0===e?yw.empty():yw.of(t6.decode(e-1))}static decode(e){const t=e%4;e-=t;const n=(e/=4)%4;return e-=n,new t6(e/=4,n,t)}toString(){return"PylosCoord"+this.toShortString()}toShortString(){return"("+this.x+", "+this.y+", "+this.z+")"}equals(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}isUpperThan(e){return this.z>e.z}getLowerPieces(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");const e=this.z-1;return[new t6(this.x,this.y,e),new t6(this.x+1,this.y,e),new t6(this.x,this.y+1,e),new t6(this.x+1,this.y+1,e)]}getHigherPieces(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");const e=this.z+1,t=new nQ(this.x-1,this.y-1),n=new nQ(this.x,this.y-1),r=new nQ(this.x-1,this.y),i=new nQ(this.x,this.y),s=4-e;return[t,n,r,i].filter(e=>e.isInRange(s,s)).map(t=>new t6(t.x,t.y,e))}getNextValid(e){const t=new nQ(this.x,this.y).getNext(e),n=4-this.z;return t.isNotInRange(n,n)?yw.empty():yw.of(new t6(t.x,t.y,this.z))}}class n6 extends _Q{constructor(e,t,n,r){super(),this.startingCoord=e,this.landingCoord=t,this.firstCapture=n,this.secondCapture=r}static fromClimb(e,t,n){const r=yw.of(e),i=n6.checkCaptures(n),s=new n6(r,t,i.firstCapture,i.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return s}static checkCaptures(e){let t=yw.empty(),n=yw.empty();if(e.length>0&&(t=yw.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=yw.of(e[1]),e[1].isUpperThan(e[0])&&(t=yw.of(e[1]),n=yw.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}static fromDrop(e,t){const n=yw.empty(),r=n6.checkCaptures(t);return new n6(n,e,r.firstCapture,r.secondCapture)}static changeCapture(e,t){const n=n6.checkCaptures(t);return new n6(e.startingCoord,e.landingCoord,n.firstCapture,n.secondCapture)}isClimb(){return this.startingCoord.isPresent()}toString(){const e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}equals(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}n6.encoder=new class extends jY{maxValue(){return 17575999}encodeNumber(e){const t=t6.encode(e.landingCoord),n=t6.encodeOptional(e.startingCoord),r=t6.encodeOptional(e.firstCapture);return 270400*t6.encodeOptional(e.secondCapture)+4160*r+64*n+t}decodeNumber(e){const t=t6.decode(e%64);e-=e%64;const n=t6.decodeToOptional((e/=64)%65);e-=e%65;const r=t6.decodeToOptional((e/=65)%65);e-=e%65;const i=t6.decodeToOptional(e/=65);return new n6(n,t,r,i)}};class r6 extends mQ{constructor(e,t){super(t),this.boards=e}static getInitialState(){const e=eK.createTable(4,4,KY.NONE),t=eK.createTable(3,3,KY.NONE),n=eK.createTable(2,2,KY.NONE);return new r6([e,t,n,[[KY.NONE]]],0)}getPieceAt(e){return this.boards[e.z][e.y][e.x]}applyLegalMove(e){const t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:KY.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:KY.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:KY.NONE}),this.setBoardAts(t,this.turn+1)}setBoardAts(e,t){const n=[eK.copyBiArray(this.boards[0]),eK.copyBiArray(this.boards[1]),eK.copyBiArray(this.boards[2]),eK.copyBiArray(this.boards[3])];for(const r of e){const e=r.coord;n[e.z][e.y][e.x]=r.value}return new r6(n,t)}isLandable(e){if(this.getPieceAt(e).isPlayer())return!1;if(0===e.z)return!0;const t=e.getLowerPieces();for(const n of t)if(this.getPieceAt(n)===KY.NONE)return!1;return!0}isSupporting(e){if(3===e.z)return!1;const t=e.getHigherPieces();for(const n of t)if(this.getPieceAt(n).isPlayer())return!0;return!1}getPiecesRepartition(){const e={};e[KY.NONE.value]=0,e[YY.ZERO.value]=0,e[YY.ONE.value]=0;for(let t=0;t<3;t++)for(let n=0;n<4-t;n++)for(let r=0;r<4-t;r++){const i=new t6(r,n,t),s=this.getPieceAt(i);e[s.value]=1+e[s.value]}return e}}let i6=(()=>{class e{}return e.MUST_MOVE_UPWARD=()=>$localize`You must move your pieces upward.`,e.SHOULD_HAVE_SUPPORTING_PIECES=()=>$localize`Your piece must land on the board or on 4 other pieces.`,e.CANNOT_LAND=()=>$localize`You cannot land on this space.`,e.CANNOT_CAPTURE=()=>$localize`You cannot capture.`,e.INVALID_FIRST_CAPTURE=()=>$localize`Your first capture is invalid.`,e.INVALID_SECOND_CAPTURE=()=>$localize`Your second capture is invalid.`,e})();class s6 extends IQ{static getStateInfo(e){const t=[],n=[];for(let r=0;r<3;r++)for(let i=0;i<4-r;i++)for(let s=0;s<4-r;s++){const o=new t6(s,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}static getClimbingMoves(e){const t=[];for(const n of e.freeToMove)for(const r of e.landable)if(r.isUpperThan(n)&&!1===r.getLowerPieces().some(e=>n.equals(e))){const e=n6.fromClimb(n,r,[]);t.push(e)}return t}static getDropMoves(e){const t=[];for(const n of e.landable){const e=n6.fromDrop(n,[]);t.push(e)}return t}static canCapture(e,t){const n=e.getCurrentPlayer();for(const r of[tQ.UP,tQ.DOWN]){const i=t.getNextValid(r);if(i.isPresent()&&e.getPieceAt(i.get())===n)for(const t of[tQ.LEFT,tQ.RIGHT]){const s=i.get().getNextValid(t);if(s.isPresent()&&e.getPieceAt(s.get())===n){const t=r.getOpposite(),i=s.get().getNextValid(t).get();if(e.getPieceAt(i)===n)return!0}}}return!1}static getPossibleCaptures(e,t,n){const r=[],i=(e=e.filter(e=>!1===t.equalsValue(e))).concat(n);for(let s=0;s<i.length;s++){const e=i[s];r.push([e]);for(let t=s+1;t<i.length;t++)r.push([i[t],e])}return r}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}static isValidCapture(e,t,n){const r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(n=>e.getPieceAt(n).isPlayer()&&!1===n.equals(t.firstCapture.get())).length>0)}static getGameStatus(e){const t=e.gameState.getPiecesRepartition();return 15===t[YY.ZERO.value]?TQ.ONE_WON:15===t[YY.ONE.value]?TQ.ZERO_WON:TQ.ONGOING}applyLegalMove(e,t,n){return s6.applyLegalMove(e,t,n)}isLegal(e,t){if(t.getPieceAt(e.landingCoord).isPlayer())return RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE());const n=t.getCurrentOpponent();if(e.startingCoord.isPresent()){const r=e.startingCoord.get(),i=t.getPieceAt(r);if(i===n)return RG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(i===KY.NONE)return RG.failure(hQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(r.getHigherPieces().filter(n=>t.getPieceAt(n).isPlayer()||n.equals(e.landingCoord)).length>0)return RG.failure(i6.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return RG.failure(i6.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===s6.canCapture(t,e.landingCoord))return RG.failure(i6.CANNOT_CAPTURE());if(!s6.isValidCapture(t,e,e.firstCapture.get()))return RG.failure(i6.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!s6.isValidCapture(t,e,e.secondCapture.get()))return RG.failure(i6.INVALID_SECOND_CAPTURE())}return RG.success(void 0)}getGameStatus(e){return s6.getGameStatus(e)}}class o6 extends dQ{static getListMoves(e){const t=e.gameState,n=[],r=s6.getStateInfo(t),i=s6.getClimbingMoves(r),s=s6.getDropMoves(r),o=i.concat(s);for(const a of o){let e=[[]];s6.canCapture(t,a.landingCoord)&&(e=s6.getPossibleCaptures(r.freeToMove,a.startingCoord,a.landingCoord));for(const t of e){const e=n6.changeCapture(a,t);n.push(e)}}return n}getListMoves(e){return o6.getListMoves(e)}getBoardValue(e){const t=s6.getGameStatus(e);if(t.isEndGame)return new pQ(t.toBoardValue());{const t=e.gameState.getPiecesRepartition();return new pQ(t[YY.ZERO.value]-t[YY.ONE.value])}}}class a6 extends o6{static countStoneUsed(e){let t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}static sumMoveEmplacementByValue(e){let t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}getListMoves(e){const t=o6.getListMoves(e);return this.orderMoves(t)}orderMoves(e){return e.sort((e,t)=>{const n=12*a6.countStoneUsed(e),r=12*a6.countStoneUsed(t);return n+a6.sumMoveEmplacementByValue(e)-(r+a6.sumMoveEmplacementByValue(t))})}}const l6=KY.NONE,c6=YY.ZERO,u6=YY.ONE;class h6{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`At Pylos, the goal is to be the last to play.
        To do this, you have to save up your pieces.
        As soon as a player puts its last piece, that player loses the game immediately.
        Here is what the initial board looks like, it is a board of 4 x 4 squares.
        This board will become a pyramid, little by little.
        It will be filled by the pieces of your stock. Each player has 15 pieces.`,r6.getInitialState()),NQ.anyMove($localize`Dropping a piece`,$localize`When it is your turn, you can always drop one of your piece on an empty square.
        The gray squares are where you can drop your pieces.<br/><br/>
        Click on one of the squares to drop a piece there.`,r6.getInitialState(),n6.fromDrop(new t6(1,1,0),[]),$localize`There you go, as simple as that.`),NQ.fromMove($localize`Climbing`,$localize`When 4 pieces form a square, it is possible to put a fifth piece on top.
        However, when that happens, you can save a piece by climbing instead of dropping a piece.
        To climb:
        <ol>
            <li>Click on one of your free pieces, which should be lower than the landing square.</li>
            <li>Click on an empty landing square, higher than your selected piece.</li>
        </ol><br/>
        Go ahead, climb!`,new r6([[[c6,u6,l6,l6],[u6,c6,l6,l6],[l6,l6,l6,l6],[l6,l6,l6,c6]],[[l6,l6,l6],[l6,l6,l6],[l6,l6,l6]],[[l6,l6],[l6,l6]],[[l6]]],0),[n6.fromClimb(new t6(3,3,0),new t6(0,0,1),[])],$localize`Congratulations!<br/>
        Some important notes:
        <ol>
            <li>You cannot move a piece that is directly below another one.</li>
            <li>Of course, you cannot move the opponent's pieces.</li>
            <li>You can only climb when the landing square is higher than the starting square.</li>
        </ol>`,$localize`Failed!`),NQ.fromMove($localize`Square (1/2)`,$localize`When the piece you just moved or dropped is the fourth one of a square of your color,
        you can choose anywhere on the board one or two of your pieces.
        These pieces will be removed from the board, allowing you to save up one or two pieces.
        A chosen piece must not be directly below another piece.
        A chosen piece can be the piece you just placed.
        You're playing Dark.<br/><br/>
        Form a square, then click twice on one of the four pieces to remove only that one.`,new r6([[[c6,c6,l6,l6],[l6,c6,l6,l6],[l6,l6,l6,l6],[l6,l6,l6,l6]],[[l6,l6,l6],[l6,l6,l6],[l6,l6,l6]],[[l6,l6],[l6,l6]],[[l6]]],0),[n6.fromDrop(new t6(0,1,0),[new t6(0,0,0)]),n6.fromDrop(new t6(0,1,0),[new t6(0,1,0)]),n6.fromDrop(new t6(0,1,0),[new t6(1,0,0)]),n6.fromDrop(new t6(0,1,0),[new t6(1,1,0)])],$localize`Congratulations, you have saved up one piece.`,$localize`Failed!`),NQ.fromPredicate($localize`Square (2/2)`,$localize`You're playing Dark.<br/><br/>
        Do like in the previous step, but this time click on two different pieces.`,new r6([[[c6,c6,l6,l6],[l6,c6,l6,l6],[l6,l6,l6,l6],[l6,l6,l6,l6]],[[l6,l6,l6],[l6,l6,l6],[l6,l6,l6]],[[l6,l6],[l6,l6]],[[l6]]],0),n6.fromDrop(new t6(0,1,0),[new t6(0,0,0),new t6(1,0,0)]),(e,t)=>e.secondCapture.isPresent()?FG.SUCCESS:e.firstCapture.isPresent()?FG.failure($localize`Failed, you only captured one piece.`):FG.failure($localize`Failed, you did not capture any piece.`),$localize`Congratulations, you have saved up two pieces.`)]}}function d6(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",4),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getPlayerPieceClass(n)),ra("cx",.5*r.SPACE_SIZE+(800-r.SPACE_SIZE)/14*e)("cy",860+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function p6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,d6,2,6,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function f6(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onPieceClick(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();ka("id","piece_",e,"_",t,"_",n,""),ha("ngClass",r.getPieceClasses(e,t,n)),ra("r",r.getPieceRadius(n)-r.STROKE_WIDTH)("cx",r.getPieceCx(e,t,n))("cy",r.getPieceCy(e,t,n))}}function g6(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",8),Ea("click",function(){Gt(e);const t=ba(2).$implicit,n=ba().$implicit,r=ba().$implicit;return ba().onDrop(t,n,r)}),fa()}if(2&e){const e=ba(2).$implicit,t=ba().$implicit,n=ba().$implicit,r=ba();ka("id","drop_",e,"_",t,"_",n,""),ha("ngClass",r.getSquareClasses(e,t,n)),ra("width",2*r.getPieceRadius(n))("height",2*r.getPieceRadius(n))("x",r.getPieceCx(e,t,n)-r.getPieceRadius(n))("y",r.getPieceCy(e,t,n)-r.getPieceRadius(n))}}function m6(e,t){if(1&e&&(Cn(),ma(0),la(1,f6,1,7,"circle",6),la(2,g6,1,8,"ng-template",null,7,Lu),ya()),2&e){const e=ca(3),t=ba().$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ha("ngIf",i.isOccupied(t,n,r))("ngIfElse",e)}}function y6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,m6,4,2,"ng-container",5),fa()),2&e){const e=t.$implicit,n=ba().$implicit,r=ba().$implicit,i=ba();Ts(1),ha("ngIf",i.isDrawable(e,n,r))}}function v6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,y6,2,1,"g",1),fa()),2&e){const e=ba().$implicit,t=ba();Ts(1),ha("ngForOf",t.getLevelRange(e))}}function _6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,v6,2,1,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",n.getLevelRange(e))}}function C6(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=ba();ka("id","highCapture_",e.highCapture.get().x,"_",e.highCapture.get().y,"_",e.highCapture.get().z,""),ra("width",2*e.getPieceRadius(e.highCapture.get().z))("height",2*e.getPieceRadius(e.highCapture.get().z))("x",e.getPieceCx(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))("y",e.getPieceCy(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))}}const E6=function(){return[0,1]},w6=function(){return[0,1,2]};let S6=(()=>{class e extends rQ{constructor(e){super(e),this.lastLandingCoord=yw.empty(),this.lastStartingCoord=yw.empty(),this.lastFirstCapture=yw.empty(),this.lastSecondCapture=yw.empty(),this.highCapture=yw.empty(),this.chosenStartingCoord=yw.empty(),this.chosenLandingCoord=yw.empty(),this.chosenFirstCapture=yw.empty(),this.lastMove=yw.empty(),this.remainingPieces={0:15,1:15},this.rules=new s6(r6),this.availableMinimaxes=[new o6(this.rules,"PylosMinimax"),new a6(this.rules,"PylosOrderedMinimax")],this.encoder=n6.encoder,this.tutorial=(new h6).tutorial,this.SPACE_SIZE=this.getPieceRadius(0),this.updateBoard()}getLevelRange(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return dw.expectToBe(e,2),[0,1]}}isDrawable(e,t,n){const r=new t6(e,t,n);return this.state.getPieceAt(r)!==KY.NONE||this.state.isLandable(r)}onPieceClick(e,t,n){var r=this;return hw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new t6(e,t,n);return r.state.getPieceAt(s)===r.state.getCurrentOpponent()?r.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=yw.of(s),FG.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=yw.of(s),FG.SUCCESS):r.chosenFirstCapture.equalsValue(s)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),s])})()}concludeMoveWithCapture(e){var t=this;return hw(function*(){let n;return n=t.chosenStartingCoord.isAbsent()?n6.fromDrop(t.chosenLandingCoord.get(),e):n6.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(n,t.state)})()}tryMove(e,t){var n=this;return hw(function*(){return n.cancelMove(),n.chooseMove(e,t)})()}cancelMoveAttempt(){this.chosenStartingCoord=yw.empty(),this.chosenLandingCoord=yw.empty(),this.chosenFirstCapture=yw.empty()}onDrop(e,t,n){var r=this;return hw(function*(){const i=r.canUserPlay("#drop_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new t6(e,t,n);return s6.canCapture(r.state,s)?(r.chosenLandingCoord=yw.of(s),FG.SUCCESS):r.isCapturelessMoveFinished(s)?(r.chosenLandingCoord=yw.of(s),r.concludeMoveWithCapture([])):r.cancelMove(i6.MUST_MOVE_UPWARD())})()}isCapturelessMoveFinished(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}getSquareClasses(e,t,n){const r=new t6(e,t,n);if(this.lastMove.isPresent()){const e=this.lastMove.get();if(e.firstCapture.equalsValue(r)||e.secondCapture.equalsValue(r))return["captured"];if(r.equals(e.landingCoord)||e.startingCoord.equalsValue(r))return["moved"]}return[]}getPieceRadius(e){return 90+5*e}getPieceCx(e,t,n){return 100+100*n+200*e}getPieceCy(e,t,n){return 100+100*n+200*t}isOccupied(e,t,n){const r=new t6(e,t,n),i=this.rules.node.gameState.getPieceAt(r).isPlayer(),s=this.chosenLandingCoord.equalsValue(r);return i||s}getPieceClasses(e,t,n){const r=new t6(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}getPieceFillClass(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}getPlayerPieceClass(e){return this.getPlayerClass(YY.of(e))}getPlayerSidePieces(e){const t=this.remainingPieces[e],n=[];for(let r=0;r<t;r++)n.push(r);return n}updateBoard(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;const e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=yw.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=yw.empty(),this.lastStartingCoord=yw.empty(),this.lastFirstCapture=yw.empty(),this.lastSecondCapture=yw.empty(),this.chosenFirstCapture=yw.empty(),this.chosenStartingCoord=yw.empty(),this.chosenLandingCoord=yw.empty())}showLastMove(){const e=this.lastMove.get();this.lastLandingCoord=yw.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}isDrawableCoord(e){return this.isDrawable(e.x,e.y,e.z)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-pylos"]],features:[Go],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,p6,2,1,"g",1),ga(2,"rect",2),la(3,_6,2,1,"g",1),la(4,C6,1,7,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",lu(3,E6)),Ts(2),ha("ngForOf",lu(4,w6)),Ts(1),ha("ngIf",t.highCapture.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class b6{constructor(e){this.value=e}static fromInt(e){if(0<=e&&e<=15)return b6.pieces[e];if(16===e)return b6.EMPTY;throw new Error("Invalid piece ("+e+")")}equals(e){return this===e}toString(){return"QuartoPiece("+this.value+")"}isRectangle(){return this.value%4<2}}b6.AAAA=new b6(0),b6.AAAB=new b6(1),b6.AABA=new b6(2),b6.AABB=new b6(3),b6.ABAA=new b6(4),b6.ABAB=new b6(5),b6.ABBA=new b6(6),b6.ABBB=new b6(7),b6.BAAA=new b6(8),b6.BAAB=new b6(9),b6.BABA=new b6(10),b6.BABB=new b6(11),b6.BBAA=new b6(12),b6.BBAB=new b6(13),b6.BBBA=new b6(14),b6.BBBB=new b6(15),b6.EMPTY=new b6(16),b6.pieces=[b6.AAAA,b6.AAAB,b6.AABA,b6.AABB,b6.ABAA,b6.ABAB,b6.ABBA,b6.ABBB,b6.BAAA,b6.BAAB,b6.BABA,b6.BABB,b6.BBAA,b6.BBAB,b6.BBBA,b6.BBBB];class P6 extends CQ{constructor(e,t,n){super(e,t),this.piece=n}toString(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}equals(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}P6.encoder=new class extends jY{maxValue(){return 496}encodeNumber(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}decodeNumber(e){const t=e%32;e-=t;const n=(e/=32)%4;return e-=n,new P6(e/=4,n,b6.fromInt(t))}};class O6 extends yQ{constructor(e,t,n){super(e,t),this.pieceInHand=n}static getInitialState(){const e=eK.createTable(4,4,b6.EMPTY);return new O6(e,0,b6.AAAA)}static isGivable(e,t,n){return e!==n&&!1===O6.isAlreadyOnBoard(e,t)}static isAlreadyOnBoard(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}getRemainingPieces(){const e=b6.pieces,t=[];for(const n of e)O6.isGivable(n,this.board,this.pieceInHand)&&t.push(n);return t}}let T6=(()=>{class e{}return e.MUST_GIVE_A_PIECE=()=>$localize`You must give a piece.`,e.PIECE_ALREADY_ON_BOARD=()=>$localize`That piece is already on the board.`,e.CANNOT_GIVE_PIECE_IN_HAND=()=>$localize`You cannot give the piece that was in your hands.`,e})();class I6{constructor(e){this.subCriterion=[yw.empty(),yw.empty(),yw.empty(),yw.empty()],this.subCriterion[0]=yw.of(8==(8&e.value)),this.subCriterion[1]=yw.of(4==(4&e.value)),this.subCriterion[2]=yw.of(2==(2&e.value)),this.subCriterion[3]=yw.of(1==(1&e.value))}mergeWith(e){let t=4;for(let n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=yw.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}mergeWithQuartoPiece(e){const t=new I6(e);return this.mergeWith(t)}areAllAbsent(){for(let e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}match(e){for(let t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}matchPiece(e){return this.match(new I6(e))}toString(){return"Criterion{"+this.subCriterion.map(e=>e.isPresent()?e.get()?"1":"0":"x").join(" ")+"}"}}class k6{constructor(e,t){this.initialCoord=e,this.direction=t}allCoords(){const e=[];for(let t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}class A6 extends IQ{static isOccupied(e){return e!==b6.EMPTY}static isLegal(e,t){const n=e.coord.x,r=e.coord.y,i=e.piece,s=t.getCopiedBoard(),o=t.pieceInHand;return A6.isOccupied(s[r][n])?FG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE()):i===b6.EMPTY?15===t.turn?FG.SUCCESS:FG.failure(T6.MUST_GIVE_A_PIECE()):O6.isAlreadyOnBoard(i,s)?FG.failure(T6.PIECE_ALREADY_ON_BOARD()):o===i?FG.failure(T6.CANNOT_GIVE_PIECE_IN_HAND()):FG.SUCCESS}isLegal(e,t){return A6.isLegal(e,t).toFallible(void 0)}applyLegalMove(e,t){const n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new O6(n,t.turn+1,e.piece)}static updateBoardStatus(e,t,n){return n.score===wQ.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:wQ.VICTORY,sensitiveSquares:new BX}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}static isThereAVictoriousLine(e,t){let n=e.initialCoord,r=t.getPieceAt(n);const i=new I6(r);for(let s=0;s<3&&!1!==A6.isOccupied(r)&&!i.areAllAbsent();s++)n=n.getNext(e.direction,1),r=t.getPieceAt(n),i.mergeWithQuartoPiece(r);return!(!A6.isOccupied(r)||i.areAllAbsent())}static searchForVictoryOrPreVictoryInLine(e,t,n){const r=A6.getLineInfos(e,t,n);if(r.boardStatus.isPresent())return r.boardStatus.get();const i=r.commonCriterion,s=r.sensitiveCoord;if(i.isPresent()&&!1===i.get().areAllAbsent()){if(s.isAbsent())return{score:wQ.VICTORY,sensitiveSquares:new BX};{i.get().matchPiece(t.pieceInHand)&&(n.score=wQ.PRE_VICTORY);const e=s.get();n.sensitiveSquares.add(e)}}return n}static getLineInfos(e,t,n){let r=yw.empty(),i=yw.empty(),s=e.initialCoord;for(let o=0;o<4;o++){const o=t.getPieceAt(s);if(o===b6.EMPTY){if(!r.isAbsent())return{sensitiveCoord:yw.of(s),commonCriterion:i,boardStatus:yw.of(n)};r=yw.of(s)}else i.isAbsent()?(i=yw.of(new I6(o)),pw(A6.VERBOSE,"set commonCrit to "+i.toString())):(i.get().mergeWithQuartoPiece(o),pw(A6.VERBOSE,"update commonCrit: "+i.toString()));s=s.getNext(e.direction,1)}return{commonCriterion:i,sensitiveCoord:r,boardStatus:yw.empty()}}static scoreToGameStatus(e,t){const n=YY.of(t%2);return e===wQ.VICTORY?TQ.getDefeat(n):16===t?TQ.DRAW:TQ.ONGOING}getGameStatus(e){const t=e.gameState;let n={score:wQ.DEFAULT,sensitiveSquares:new BX};for(const r of A6.lines)if(n=A6.updateBoardStatus(r,t,n),n.score===wQ.VICTORY)return A6.scoreToGameStatus(n.score,t.turn);return A6.scoreToGameStatus(n.score,t.turn)}getVictoriousCoords(e){for(const t of A6.lines)if(A6.isThereAVictoriousLine(t,e))return t.allCoords();return[]}}A6.VERBOSE=!1,A6.lines=[new k6(new nQ(0,0),eQ.DOWN),new k6(new nQ(1,0),eQ.DOWN),new k6(new nQ(2,0),eQ.DOWN),new k6(new nQ(3,0),eQ.DOWN),new k6(new nQ(0,0),eQ.RIGHT),new k6(new nQ(0,1),eQ.RIGHT),new k6(new nQ(0,2),eQ.RIGHT),new k6(new nQ(0,3),eQ.RIGHT),new k6(new nQ(0,0),eQ.DOWN_RIGHT),new k6(new nQ(0,3),eQ.UP_RIGHT)];class M6 extends dQ{static scoreToBoardValue(e,t){if(e===wQ.DEFAULT)return new pQ(0);{const n=YY.of(t%2);return new pQ(e===wQ.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),s=n.pieceInHand;let o;for(let a=0;a<4;a++)for(let e=0;e<4;e++)if(r[a][e]===b6.EMPTY){if(o=n.getCopiedBoard(),o[a][e]=s,15===n.turn){const n=new P6(e,a,b6.EMPTY);return t.push(n),t}for(const n of i){const r=new P6(e,a,n);t.push(r)}}return t}getBoardValue(e){const t=e.gameState;let n={score:wQ.DEFAULT,sensitiveSquares:new BX};for(const r of A6.lines)if(n=A6.updateBoardStatus(r,t,n),n.score===wQ.VICTORY)break;return M6.scoreToBoardValue(n.score,t.turn)}}const N6=b6.AABA,x6=b6.AABB,R6=b6.ABAA,D6=b6.ABAB,L6=b6.ABBA,F6=b6.BAAA,U6=b6.BAAB,B6=b6.BABB,V6=b6.BBAA,$6=b6.BBAB,z6=b6.BBBA,H6=b6.BBBB,G6=b6.EMPTY;class q6{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`Quarto is an alignment game.
        The goal is to align four pieces that have at least one common aspect:
        <ul>
          <li>their color (light or dark),</li>
          <li>their size (big or small),</li>
          <li>their pattern (empty or dotted),</li>
          <li>their shape (round or square).</li>
        </ul>
        Here, we have a board with a victory by an alignment of dark pieces.`,new O6([[z6,V6,R6,N6],[G6,G6,G6,G6],[G6,G6,G6,G6],[G6,G6,G6,G6]],7,b6.ABAB)),NQ.anyMove($localize`Placement`,$localize`Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,
        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.
        If you prefer, the order of these two steps can be reversed.
        Keep in mind that the second click confirms the move.<br/><br/>
        Make a move.`,new O6([[z6,x6,L6,G6],[G6,G6,G6,G6],[G6,F6,G6,G6],[G6,G6,G6,G6]],7,b6.ABAA),new P6(2,2,b6.BAAB),$localize`Perfect!`),NQ.fromMove($localize`Situation`,$localize`We have here a tricky situation.<br/><br/>
        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move.`,new O6([[H6,z6,$6,G6],[R6,B6,V6,G6],[D6,F6,U6,G6],[G6,G6,G6,G6]],7,b6.AABA),[new P6(3,3,b6.AABB)],$localize`Well done!`,$localize`Failed!`)]}}function W6(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(t.value)),ra("x",i.SPACE_SIZE*n+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("y",i.SPACE_SIZE*r+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("width",2*i.getPieceSize(t.value))("height",2*i.getPieceSize(t.value))}}function j6(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2),t=e.$implicit,n=e.index,r=ba().index,i=ba();ha("ngClass",i.getPieceClasses(t.value)),ra("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(t.value))}}function Z6(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function Y6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,W6,1,5,"rect",9),la(2,j6,1,4,"ng-template",null,10,Lu),la(4,Z6,1,3,"circle",3),fa()),2&e){const e=ca(3),t=ba().$implicit,n=ba(2);Ts(1),ha("ngIf",t.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",n.pieceHasDot(t.value))}}function K6(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().chooseCoord(t,n)}),fa(),la(2,Y6,5,3,"g",3),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","chooseCoord_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function J6(e,t){if(1&e&&(Cn(),pa(0,"g",null,7),la(2,K6,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(2),ha("ngForOf",e)}}function Q6(e,t){if(1&e&&(Cn(),ga(0,"rect",15)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("y",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function X6(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",e.getPieceSize(e.pieceInHand.value))}}function e8(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2);ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",10)}}function t8(e,t){if(1&e&&(Cn(),pa(0,"g",null,12),ga(2,"rect",13),la(3,Q6,1,5,"rect",14),la(4,X6,1,4,"ng-template",null,10,Lu),la(6,e8,1,3,"circle",3),fa()),2&e){const e=ca(5),t=ba();ra("transform","translate("+t.chosen.get().x*t.SPACE_SIZE+" "+t.chosen.get().y*t.SPACE_SIZE+")"),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function n8(e,t){if(1&e&&(Cn(),pa(0,"g",null,16),ga(2,"rect",17),fa()),2&e){const e=t.$implicit,n=ba();Ts(2),ra("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)("transform","translate("+e.x*n.SPACE_SIZE+" "+e.y*n.SPACE_SIZE+")")}}function r8(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",0)("y",.75*e.SPACE_SIZE)("transform","translate("+-e.getPieceSize(e.pieceInHand.value)+", "+-e.getPieceSize(e.pieceInHand.value)+")")("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function i8(e,t){if(1&e&&(Cn(),ga(0,"circle",19)),2&e){const e=ba(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cy",.75*e.SPACE_SIZE)("r",e.getPieceSize(e.pieceInHand.value))}}function s8(e,t){1&e&&(Cn(),ga(0,"circle",20)),2&e&&ra("cy",.75*ba(2).SPACE_SIZE)("r",10)}function o8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,r8,1,6,"rect",9),la(2,i8,1,3,"ng-template",null,10,Lu),la(4,s8,1,2,"circle",18),fa()),2&e){const e=ca(3),t=ba();Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function a8(e,t){if(1&e&&(Cn(),ga(0,"rect",27)),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("x",n.SPACE_SIZE*e)("y",n.SPACE_SIZE*t)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function l8(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(4*t+e)),ra("x",n.SPACE_SIZE*e+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("y",n.SPACE_SIZE*t+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("width",2*n.getPieceSize(4*t+e))("height",2*n.getPieceSize(4*t+e))}}function c8(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2).index,t=ba().index,n=ba();ha("ngClass",n.getPieceClasses(4*t+e)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.getPieceSize(4*t+e))}}function u8(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=ba(2).index,t=ba().index,n=ba();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function h8(e,t){if(1&e){const e=va();Cn(),pa(0,"g",25),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().choosePiece(4*n+t)}),la(1,a8,1,4,"rect",26),la(2,l8,1,5,"rect",9),la(3,c8,1,4,"ng-template",null,10,Lu),la(5,u8,1,3,"circle",3),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ta("id","choosePiece_",4*n+t,""),Ts(1),ha("ngIf",r.pieceToGive.value===4*n+t),Ts(1),ha("ngIf",(4*n+t)%4<2)("ngIfElse",e),Ts(3),ha("ngIf",r.pieceHasDot(4*n+t))}}function d8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,h8,6,5,"g",24),fa()),2&e){const e=t.index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isRemaining(4*n+e))}}function p8(e,t){if(1&e&&(Cn(),pa(0,"g",null,21),ga(2,"rect",22,23),la(4,d8,2,1,"g",2),fa()),2&e){const e=t.$implicit,n=ba();ra("transform","translate(0 "+6.5*n.SPACE_SIZE+")"),Ts(2),ra("x",-.125*n.SPACE_SIZE)("y",-.125*n.SPACE_SIZE)("width",4.25*n.SPACE_SIZE)("height",4.25*n.SPACE_SIZE),Ts(2),ha("ngForOf",e)}}let f8=(()=>{class e extends pX{constructor(e){super(e),this.EMPTY=b6.EMPTY,this.chosen=yw.empty(),this.lastMove=yw.empty(),this.pieceInHand=b6.EMPTY,this.pieceToGive=b6.EMPTY,this.victoriousCoords=[],this.rules=new A6(O6),this.availableMinimaxes=[new M6(this.rules,"QuartoMinimax")],this.encoder=P6.encoder,this.tutorial=(new q6).tutorial,this.pieceInHand=this.rules.node.gameState.pieceInHand,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=yw.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(e=>e.coord)}chooseCoord(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#chooseCoord_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.hideLastMove(),n.board[t][e]===b6.EMPTY){if(n.showPieceInHandOnBoard(e,t),15===n.rules.node.gameState.turn){const r=new P6(e,t,b6.EMPTY);return n.chooseMove(r,n.rules.node.gameState)}if(n.pieceToGive===b6.EMPTY)return FG.SUCCESS;{const r=new P6(e,t,n.pieceToGive);return n.chooseMove(r,n.rules.node.gameState)}}return n.cancelMove(hQ.MUST_CLICK_ON_EMPTY_SPACE())})()}choosePiece(e){var t=this;return hw(function*(){const n=t.canUserPlay("#choosePiece_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.hideLastMove(),t.pieceToGive=b6.fromInt(e),t.chosen.isAbsent())return FG.SUCCESS;{const e=t.chosen.get(),n=new P6(e.x,e.y,t.pieceToGive);return t.chooseMove(n,t.rules.node.gameState)}})()}hideLastMove(){this.lastMove=yw.empty()}cancelMoveAttempt(){this.hideLastMove(),this.pieceToGive=b6.EMPTY}showPieceInHandOnBoard(e,t){this.chosen=yw.of(new nQ(e,t))}isRemaining(e){return O6.isGivable(b6.fromInt(e),this.board,this.pieceInHand)}getSquareClasses(e,t){const n=new nQ(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}getPieceClasses(e){const t=[];return t.push(e%2==0?"player0":"player1"),t}getPieceSize(e){return e<8?40:25}pieceHasDot(e){return e!==b6.EMPTY.value&&e%8<4}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-quarto"]],features:[Go],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",1),la(2,J6,3,1,"g",2),la(3,t8,7,6,"g",3),la(4,n8,3,3,"g",2),pa(5,"g",null,4),ga(7,"rect",5,6),la(9,o8,5,3,"g",3),fa(),la(10,p8,5,6,"g",2),fa(),fa()),2&e&&(ra("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosen.isPresent()),Ts(1),ha("ngForOf",t.victoriousCoords),Ts(1),ra("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),Ts(2),ra("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),Ts(2),ha("ngIf",t.chosen.isAbsent()),Ts(1),ha("ngForOf",t.board))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),g8=(()=>{class e{}return e.NO_INSIDE_CLICK=()=>$localize`You must pick a space from the edge of the board.`,e})();class m8 extends CQ{constructor(e,t,n){super(e,t),this.direction=n;const r=m8.isValidCoord(this.coord);if(r.isFailure())throw new Error(r.getReason());if(0===e&&n===tQ.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&n===tQ.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===t&&n===tQ.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===t&&n===tQ.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.")}static isValidCoord(e){return e.isNotInRange(5,5)?FG.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?FG.failure(g8.NO_INSIDE_CLICK()):FG.SUCCESS}toString(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}m8.encoder=new class extends jY{maxValue(){return 128}encodeNumber(e){const t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}decodeNumber(e){const t=tQ.factory.fromInt(e%4).get();e-=e%4;const n=(e/=4)%5;return e-=e%5,new m8(e/=5,n,t)}};class y8 extends yQ{static getInitialState(){const e=eK.createTable(5,5,KY.NONE);return new y8(e,0)}applyLegalMove(e){const t=this.getCopiedBoard(),n=this.turn+1;let r=e.coord,i=e.coord.getNext(e.direction);for(;i.isInRange(5,5);)t[r.y][r.x]=t[i.y][i.x],r=r.getNext(e.direction),i=i.getNext(e.direction);return t[r.y][r.x]=this.getCurrentPlayer(),new y8(t,n)}}class v8 extends IQ{static getVerticalCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new nQ(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new nQ(4,r));return n}static getHorizontalCenterCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new nQ(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new nQ(r,4));return n}static getPossibleDirections(e){const t=[];return 0!==e.x&&t.push(tQ.LEFT),0!==e.y&&t.push(tQ.UP),4!==e.x&&t.push(tQ.RIGHT),4!==e.y&&t.push(tQ.DOWN),t}static getLinesSums(e){const t={};t[YY.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[YY.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(let n=0;n<5;n++)for(let r=0;r<5;r++){const i=e.getPieceAtXY(r,n);if(i.isPlayer()){const e=i.value;t[e].columns[r]=t[e].columns[r]+1,t[e].rows[n]=t[e].rows[n]+1,r===n&&(t[e].diagonals[0]=t[e].diagonals[0]+1),r+n===4&&(t[e].diagonals[1]=t[e].diagonals[1]+1)}}return t}static getVictoriousCoords(e){const t=v8.getLinesSums(e),n=[];for(let r=0;r<2;r++){for(let e=0;e<5;e++){if(5===t[r].columns[e])for(let t=0;t<5;t++)n.push(new nQ(e,t));if(5===t[r].rows[e])for(let t=0;t<5;t++)n.push(new nQ(t,e))}if(5===t[r].diagonals[0])for(let e=0;e<5;e++)n.push(new nQ(e,e));if(5===t[r].diagonals[1])for(let e=0;e<5;e++)n.push(new nQ(e,4-e))}return n}static getFullestLine(e){const t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max(...t)}applyLegalMove(e,t,n){return v8.applyLegalMove(e,t,n)}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?RG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):RG.success(void 0)}getGameStatus(e){const t=e.gameState,n=v8.getLinesSums(t),r=v8.getFullestLine(n[YY.ZERO.value]),i=v8.getFullestLine(n[YY.ONE.value]),s=t.getCurrentPlayer();return 5===r&&(s===YY.ZERO||i<5)?TQ.ZERO_WON:5===i?TQ.ONE_WON:TQ.ONGOING}}class _8 extends dQ{getListMoves(e){const t=[],n=v8.getVerticalCoords(e),r=v8.getHorizontalCenterCoords(e).concat(n);for(const i of r){const e=v8.getPossibleDirections(i);for(const n of e){const e=new m8(i.x,i.y,n);t.push(e)}}return t}getBoardValue(e){const t=e.gameState,n=v8.getLinesSums(t),r=v8.getFullestLine(n[YY.ZERO.value]),i=v8.getFullestLine(n[YY.ONE.value]),s=t.getCurrentPlayer();return new pQ(5===r&&(s===YY.ZERO||i<5)?YY.ZERO.getVictoryValue():5===i?YY.ONE.getVictoryValue():i-r)}}class C8{static getArrowTransform(e,t,n){let r,i,s;switch(n){case tQ.UP:r=0,i=-1,s=-90;break;case tQ.DOWN:r=0,i=1,s=90;break;case tQ.LEFT:r=-1,i=0,s=180;break;default:dw.expectToBe(n,tQ.RIGHT),r=1,i=0,s=0}return[`translate(${t.x*e+e/2+r*e/4} ${t.y*e+e/2+i*e/4})`,"scale(2.5)",`rotate(${s})`].join(" ")}}const E8=KY.NONE,w8=YY.ZERO,S8=YY.ONE;class b8{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game.`,$localize`At Quixo, the goal is to align 5 of your pieces.
        The first player plays with dark pieces, the second with light pieces.
        The board is made of 25 spaces spread over a 5x5 square.
        Every piece has a neutral side, a light side, and a dark side.`,y8.getInitialState()),NQ.fromMove($localize`What a move looks like (without animation)`,$localize`When it is your turn:
        <ol>
            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.
                You can only choose a piece from the edge of the board.</li>
            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>
        </ol>
        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.
        Once on the other side, all pieces will move by one space in the opposing direction.
        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>
        For example, take the bottom right neutral piece, and move it to the left (you're playing Light).`,new y8([[E8,E8,E8,E8,E8],[E8,E8,E8,E8,E8],[E8,E8,E8,E8,E8],[E8,E8,E8,E8,E8],[w8,w8,w8,w8,E8]],1),[new m8(4,4,tQ.LEFT)],$localize`See how the four dark pieces have been moved one space to the right.
        The neutral piece has been move 4 pieces to the left and has become light.`,$localize`Failed!`),NQ.fromMove($localize`Victory`,$localize`You already know everything you need in order to play, but there is one last particularity.
        If you create a line of 5 of your pieces, you win.
        If you create a line of 5 of your opponent's pieces, you lose.
        If you create both, you lose too!<br/><br/>
        You can win with this board, try it.
        You're playing Light.`,new y8([[E8,S8,E8,S8,S8],[E8,w8,w8,E8,w8],[S8,S8,S8,w8,S8],[w8,E8,w8,S8,S8],[S8,w8,E8,S8,w8]],31),[new m8(3,0,tQ.DOWN)],$localize`Congratulations, you won!`,$localize`Failed!`)]}}function P8(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onBoardClick(t,n)}),fa(),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getPieceClasses(e,n)),ra("cx",50+100*e)("cy",50+100*n)}}function O8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,P8,2,5,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function T8(e,t){if(1&e){const e=va();Cn(),pa(0,"use",6),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ta("id","chooseDirection_",e,""),ra("transform",n.getArrowTransform(n.chosenCoord.get(),e))}}function I8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,T8,1,2,"use",5),fa()),2&e){const e=ba();Ts(1),ha("ngForOf",e.getPossiblesDirections())}}let k8=(()=>{class e extends pX{constructor(e){super(e),this.lastMoveCoord=yw.empty(),this.chosenCoord=yw.empty(),this.victoriousCoords=[],this.rules=new v8(y8),this.availableMinimaxes=[new _8(this.rules,"QuixoMinimax")],this.encoder=m8.encoder,this.tutorial=(new b8).tutorial,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(e=>e.coord),this.victoriousCoords=v8.getVictoriousCoords(this.state)}cancelMoveAttempt(){this.chosenCoord=yw.empty()}getPieceClasses(e,t){const n=new nQ(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(e=>e.equals(n))&&r.push("victory-stroke"),r}onBoardClick(e,t){const n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=new nQ(e,t),i=m8.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=yw.of(r),FG.SUCCESS)}getPossiblesDirections(){const e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}chooseDirection(e){var t=this;return hw(function*(){const n=t.canUserPlay("#chooseDirection_"+e);return n.isFailure()?t.cancelMove(n.getReason()):(t.chosenDirection=tQ.factory.fromString(e).get(),yield t.tryMove())})()}tryMove(){var e=this;return hw(function*(){const t=e.chosenCoord.get(),n=new m8(t.x,t.y,e.chosenDirection);return e.cancelMove(),e.chooseMove(n,e.rules.node.gameState)})()}getArrowTransform(e,t){return C8.getArrowTransform(this.SPACE_SIZE,e,tQ.factory.fromString(t).get())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-quixo"]],features:[Go],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),fa(),la(3,O8,2,1,"g",2),la(4,I8,2,1,"g",3),fa()),2&e&&(Ts(3),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),A8=(()=>{class e extends yQ{static getInitialState(){const t=eK.createTable(e.BOARD_WIDTH,e.BOARD_HEIGHT,KY.NONE);return t[3][3]=YY.ZERO,t[4][4]=YY.ZERO,t[3][4]=YY.ONE,t[4][3]=YY.ONE,new e(t,0)}static getNeighbooringPawnLike(e,t,n,r){let i;const s=[];for(let o=-1;o<2;o++)for(let a=-1;a<2;a++)i=new nQ(n+a,r+o),i.isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&s.push(i);return s}countScore(){const t=[0,0];for(let n=0;n<e.BOARD_HEIGHT;n++)for(let r=0;r<e.BOARD_WIDTH;r++){const e=this.board[n][r];e.isPlayer()&&(t[e.value]+=1)}return t}}return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e})();class M8 extends CQ{equals(e){return e===this||e.coord.equals(this.coord)}toString(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}M8.encoder=new class extends jY{maxValue(){return(A8.BOARD_HEIGHT-1)*A8.BOARD_WIDTH+(A8.BOARD_WIDTH-1)}encodeNumber(e){return e.coord.y*A8.BOARD_WIDTH+e.coord.x}decodeNumber(e){const t=e%A8.BOARD_WIDTH;return new M8(t,(e-t)/A8.BOARD_WIDTH)}},M8.PASS=new M8(-1,-1),M8.PASS_NUMBER=M8.encoder.encodeNumber(M8.PASS);let N8=(()=>{class e{}return e.NO_ELEMENT_SWITCHED=()=>$localize`Your move should switch at least one piece.`,e})();class x8{constructor(e,t){this.move=e,this.switched=t}}let R8=(()=>{class e extends IQ{static getGameStatus(t){const n=t.gameState;if(!1===e.isGameEnded(n))return TQ.ONGOING;const r=n.countScore(),i=r[1]-r[0];return i<0?TQ.ZERO_WON:i>0?TQ.ONE_WON:TQ.DRAW}applyLegalMove(e,t,n){const r=t.turn,i=t.getCurrentPlayer(),s=t.getCopiedBoard();if(e.equals(M8.PASS))return new A8(s,r+1);for(const o of n)s[o.y][o.x]=i;return s[e.coord.y][e.coord.x]=i,new A8(s,r+1)}static getAllSwitcheds(t,n,r){const i=[],s=n.getOpponent();for(const o of eQ.DIRECTIONS){const a=t.coord.getNext(o);if(a.isInRange(A8.BOARD_WIDTH,A8.BOARD_HEIGHT)&&r[a.y][a.x]===s){const t=e.getSandwicheds(n,o,a,r);for(const e of t)i.push(e)}}return i}static getSandwicheds(e,t,n,r){const i=[n];let s=n.getNext(t);for(;s.isInRange(A8.BOARD_WIDTH,A8.BOARD_HEIGHT);){const n=r[s.y][s.x];if(n===e)return i;if(n===KY.NONE)return[];i.push(s),s=s.getNext(t)}return[]}static isGameEnded(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}getGameStatus(t){return e.getGameStatus(t)}static playerCanOnlyPass(e){const t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(M8.PASS)}static nextPlayerCantOnlyPass(e){const t=e.getCopiedBoard(),n=new A8(t,e.turn+1);return this.playerCanOnlyPass(n)}static getListMoves(t){const n=[];let r;const i=t.getCurrentPlayer(),s=t.getCurrentOpponent();for(let o=0;o<8;o++)for(let a=0;a<8;a++)if(t.getPieceAtXY(a,o)===KY.NONE&&(r=t.getCopiedBoard(),A8.getNeighbooringPawnLike(r,s,a,o).length>0)){const s=new M8(a,o),l=e.getAllSwitcheds(s,i,r);if(l.length>0){for(const e of l)zG(i!==t.getPieceAt(e),e+"was already switched!"),r[e.y][e.x]=i;r[o][a]=i,n.push(new x8(s,l.length))}}return 0===n.length&&n.push(new x8(M8.PASS,0)),n}isLegal(t,n){if(t.equals(M8.PASS))return e.playerCanOnlyPass(n)?RG.success([]):RG.failure(hQ.MUST_PASS());if(n.getPieceAt(t.coord).isPlayer())return pw(e.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),RG.failure(hQ.MUST_CLICK_ON_EMPTY_SPACE());const r=n.getCopiedBoard(),i=e.getAllSwitcheds(t,n.getCurrentPlayer(),r);return pw(e.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?RG.failure(N8.NO_ELEMENT_SWITCHED()):RG.success(i)}}return e.VERBOSE=!1,e})();class D8 extends dQ{getBoardValue(e){const t=R8.getGameStatus(e);if(t.isEndGame)return pQ.fromWinner(t.winner);const n=e.gameState.getCopiedBoard();let r=0,i=0;for(let s=0;s<A8.BOARD_HEIGHT;s++)for(let e=0;e<A8.BOARD_WIDTH;e++){const t=(0===e||e===A8.BOARD_WIDTH-1?4:1)*(0===s||s===A8.BOARD_HEIGHT-1?4:1);n[s][e]===YY.ZERO&&(r+=t),n[s][e]===YY.ONE&&(i+=t)}return r*=YY.ZERO.getScoreModifier(),i*=YY.ONE.getScoreModifier(),new pQ(i+r)}getListMoves(e){const t=R8.getListMoves(e.gameState);return eK.sortByDescending(t,e=>D8.bestCoords.some(t=>e.move.coord.equals(t))?100:e.switched),t.map(e=>e.move)}}D8.bestCoords=[new nQ(0,0),new nQ(0,A8.BOARD_HEIGHT-1),new nQ(A8.BOARD_WIDTH-1,0),new nQ(A8.BOARD_WIDTH-1,A8.BOARD_HEIGHT-1)];const L8=KY.NONE,F8=YY.ZERO,U8=YY.ONE;class B8{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.
        When one piece is flipped, its owner changes.
        The player owning the most pieces at the end of the game wins.
        Here, Dark has 28 points and Light has 36, hence Light wins.`,new A8([[F8,F8,F8,F8,F8,F8,F8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,F8,F8,F8,F8,F8,F8,F8]],60)),NQ.anyMove($localize`Capture (1/2)`,$localize`At the beginning of the game, pieces are placed as shown here.
        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>
        Do any move by clicking to put your piece
        Dark plays first.`,A8.getInitialState(),new M8(2,4),$localize`Congratulations!`),NQ.fromMove($localize`Capture (2/2)`,$localize`A move can also capture a bigger line, and more than one lines at a time
        You're playing light here.<br/><br/>
        Play on the bottom left to see an example.`,new A8([[L8,L8,L8,L8,L8,L8,L8,L8],[L8,L8,L8,L8,L8,L8,L8,L8],[L8,L8,L8,L8,L8,L8,L8,L8],[L8,L8,L8,L8,U8,L8,L8,L8],[L8,L8,L8,F8,L8,L8,L8,L8],[L8,L8,F8,L8,L8,L8,L8,L8],[F8,F8,L8,L8,L8,L8,L8,L8],[L8,F8,U8,F8,U8,F8,L8,L8]],1),[new M8(0,7)],$localize`Congratulations!`,$localize`Lower and more to the left, please.`),NQ.informational($localize`Passing a turn`,$localize`If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass
        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way.`,new A8([[U8,F8,F8,F8,F8,F8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[F8,U8,U8,U8,U8,U8,U8,F8],[U8,U8,U8,U8,U8,U8,L8,L8],[F8,F8,F8,F8,F8,F8,L8,L8]],60))]}}function V8(e,t){if(1&e&&(Cn(),ga(0,"circle",4)),2&e){const e=ba().index,t=ba().index,n=ba();ha("ngClass",n.getPieceClass(e,t)),ra("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)}}function $8(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,V8,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function z8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,$8,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let H8=(()=>{class e extends pX{constructor(e){super(e),this.EMPTY=KY.NONE,this.lastMove=new nQ(-2,-2),this.captureds=[],this.scores=yw.of([2,2]),this.rules=new R8(A8),this.availableMinimaxes=[new D8(this.rules,"ReversiMinimax")],this.encoder=M8.encoder,this.tutorial=(new B8).tutorial,this.canPass=!1,this.updateBoard()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new M8(e,t);return yield n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new nQ(-2,-2),this.scores=yw.of(e.countScore()),this.canPass=R8.playerCanOnlyPass(e)}showPreviousMove(){this.lastMove=this.rules.node.move.get().coord;const e=this.rules.node.gameState.getCurrentPlayer(),t=this.rules.node.gameState.getCurrentOpponent();for(const n of eQ.DIRECTIONS){let r=this.lastMove.getNext(n,1);for(;r.isInRange(A8.BOARD_WIDTH,A8.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(r)===t&&this.rules.node.mother.get().gameState.getPieceAt(r)===e;)this.captureds.push(r),r=r.getNext(n,1)}}getRectClasses(e,t){const n=new nQ(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:n.equals(this.lastMove)?["moved"]:[]}getPieceClass(e,t){return this.getPlayerClass(this.board[t][e])}pass(){var e=this;return hw(function*(){return zG(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(M8.PASS.coord.x,M8.PASS.coord.y)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-reversi"]],features:[Go],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,z8,2,1,"g",1),fa()),2&e&&(ra("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board))},directives:[$d,Bd,Hd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),G8=(()=>{class e extends h1{static getInitialState(){const t=sQ.UNREACHABLE,n=sQ.ZERO,r=sQ.ONE,i=sQ.EMPTY;return new e([[t,t,n,r,i,i,i,n,r,t,t],[t,i,i,i,i,i,i,i,i,i,t],[r,i,i,i,i,i,i,i,i,i,n],[n,i,i,i,i,i,i,i,i,i,r],[t,i,i,i,i,i,i,i,i,i,t],[t,t,r,n,i,i,i,r,n,t,t]],0)}}return e.HEIGHT=6,e.WIDTH=11,e})(),q8=(()=>{class e{}return e.CAN_ONLY_REBOUND_ON_BLACK=()=>$localize`You can only rebound on dark spaces.`,e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=()=>$localize`You can only rebound on empty spaces.`,e.MUST_CHOOSE_PYRAMID_FIRST=()=>$localize`You must pick one of your pyramids first.`,e.MUST_CHOOSE_OWN_PYRAMID=()=>$localize`You must pick one of your pyramids.`,e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=()=>$localize`Those two spaces are not neighbors.`,e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=()=>$localize`Those two spaces have no intermediary neighbor.`,e})();class W8 extends SX{constructor(e,t){super(e,t)}static checkDistanceAndLocation(e,t){const n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return FG.failure(hQ.MOVE_CANNOT_BE_STATIC());if(1===n){const n=u1.getFakeNeighbors(e);if(t.equals(n))return FG.failure(q8.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return FG.failure($localize`You can move one or two spaces, not ${n}.`);if((e.x+e.y)%2==0)return FG.failure(q8.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return FG.failure(q8.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return FG.SUCCESS}static from(e,t){if(!e.isInRange(G8.WIDTH,G8.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(G8.WIDTH,G8.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");const n=W8.checkDistanceAndLocation(e,t);return n.isFailure()?n.toFailedFallible():RG.success(new W8(e,t))}isSimpleStep(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"SaharaMove("+this.coord+"->"+this.end+")"}}W8.encoder=new class extends jY{maxValue(){return 396*G8.WIDTH+66*G8.HEIGHT+6*G8.WIDTH+G8.HEIGHT}encodeNumber(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}decodeNumber(e){const t=e%6;e-=t;const n=(e/=6)%11;e-=n;const r=(e/=11)%6;return e-=r,W8.from(new nQ(e/=6,r),new nQ(n,t)).get()}};let j8=(()=>{class e extends IQ{static getStartingCoords(e,t){const n=[];for(let r=0;r<G8.HEIGHT;r++)for(let i=0;i<G8.WIDTH;i++)e[r][i].is(t)&&n.push(new nQ(i,r));return n}static getBoardValuesFor(t,n){const r=e.getStartingCoords(t,n),i=[];for(const e of r){const n=h1.getEmptyNeighbors(t,e,sQ.EMPTY).length;if(0===n)return[0];i.push(n)}return i.sort((e,t)=>e-t)}applyLegalMove(t,n,r){pw(e.VERBOSE,"Legal move "+t.toString()+" applied");const i=n.getCopiedBoard();return i[t.end.y][t.end.x]=i[t.coord.y][t.coord.x],i[t.coord.y][t.coord.x]=sQ.EMPTY,new G8(i,n.turn+1)}isLegal(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return RG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==sQ.EMPTY)return RG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE());const n=u1.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===sQ.EMPTY?RG.success(void 0):RG.failure(q8.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):RG.success(void 0)}getGameStatus(t){const n=t.gameState.getCopiedBoard(),r=e.getBoardValuesFor(n,YY.ZERO),i=e.getBoardValuesFor(n,YY.ONE);return e.getGameStatusFromFreedoms(r,i)}static getGameStatusFromFreedoms(e,t){return 0===e[0]?TQ.ONE_WON:0===t[0]?TQ.ZERO_WON:TQ.ONGOING}}return e.VERBOSE=!1,e})();class Z8 extends dQ{getListMoves(e){const t=[],n=e.gameState.getCopiedBoard(),r=e.gameState.getCurrentPlayer(),i=j8.getStartingCoords(n,r);for(const s of i){const e=h1.getEmptyNeighbors(n,s,sQ.EMPTY);for(const r of e){const e=W8.from(s,r).get();if(n[r.y][r.x]=n[s.y][s.x],n[s.y][s.x]=sQ.EMPTY,t.push(e),(r.y+r.x)%2==0){const e=h1.getEmptyNeighbors(n,r,sQ.EMPTY);for(const i of e)if(!i.equals(s)){const e=W8.from(s,i).get();n[i.y][i.x]=n[r.y][r.x],n[r.y][r.x]=sQ.EMPTY,t.push(e),n[r.y][r.x]=n[i.y][i.x],n[i.y][i.x]=sQ.EMPTY}}n[s.y][s.x]=n[r.y][r.x],n[r.y][r.x]=sQ.EMPTY}}return t}getBoardValue(e){const t=e.gameState.getCopiedBoard(),n=j8.getBoardValuesFor(t,YY.ZERO),r=j8.getBoardValuesFor(t,YY.ONE),i=j8.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return pQ.fromWinner(i.winner);let s=0;for(;s<6&&n[s]===r[s];)s++;return new pQ(r[s%6]-n[s%6])}}const Y8=sQ.UNREACHABLE,K8=sQ.ZERO,J8=sQ.ONE,Q8=sQ.EMPTY;class X8{constructor(){this.tutorial=[NQ.informational($localize`Initial board`,$localize`Shr is played on a board where each space is a triangle.
        Each player has six pyramids.`,G8.getInitialState()),NQ.informational($localize`Goal of the game`,$localize`At Shr, the goal of the game is to immobilize one of the opponent's pyramids.
        To do so, you have to occupy all neighboring space of that pyramid.
        Here, Light has lost because its leftmost pyramid is immobilized.`,new G8([[Y8,Y8,Q8,Q8,J8,Q8,Q8,K8,J8,Y8,Y8],[Y8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Y8],[J8,K8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,K8],[K8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,J8],[Y8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Q8,Y8],[Y8,Y8,J8,K8,Q8,Q8,Q8,J8,K8,Y8,Y8]],3)),NQ.fromPredicate($localize`Simple step`,$localize`To immobilize your opponent, you have to move your pyramids.
        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).
        You're the first player, playing with the dark pyramids.
        <ol>
            <li>Click on one of your pyramids.</li>
            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>
        </ol><br/>
        Do any simple step.`,G8.getInitialState(),W8.from(new nQ(2,0),new nQ(2,1)).get(),(e,t)=>e.isSimpleStep()?FG.SUCCESS:FG.failure($localize`You have made a double step, which is good but it is the next exercise!`),$localize`Congratulations!`),NQ.fromPredicate($localize`Double step`,$localize`When a pyramid shares its vertices with dark spaces, it can move one or two steps.
        To do so:
        <ol>
            <li>Click on the pyramid to move.</li>
            <li>Click on one of the 6 destinations that you can reach in two steps:
                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.
        </ol>`,G8.getInitialState(),W8.from(new nQ(7,0),new nQ(5,0)).get(),(e,t)=>e.isSimpleStep()?FG.failure($localize`Failed! You have made a single step.`):FG.SUCCESS,$localize`Congratulations!`)]}}function e7(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",6),fa()),2&e){const e=ba().index,t=ba().index,n=ba();Ts(1),ha("ngClass",n.getPlayerClassFor(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function t7(e,t){if(1&e&&(Cn(),ga(0,"polyline",9)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function n7(e,t){if(1&e&&(Cn(),ga(0,"polyline",10)),2&e){const e=ba(2).index,t=ba().index;ra("points",ba().getTriangleCoordinate(e,t))}}function r7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,t7,1,1,"polyline",7),la(2,n7,1,1,"polyline",8),fa()),2&e){const e=ba().index,t=ba().index;Ts(1),ha("ngIf",(e+t)%2==1),Ts(1),ha("ngIf",(e+t)%2==0)}}function i7(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),la(1,e7,2,2,"g",2),la(2,r7,3,2,"g",2),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",t.index,"_",ba().index,""),Ts(1),ha("ngIf",e.isPlayer()),Ts(1),ha("ngIf",2===e.value)}}function s7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,i7,3,4,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function o7(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",11),ga(2,"polyline",11),ya()),2&e){const e=ba();Ts(1),ra("points",e.getTriangleCoordinate(e.lastCoord.get().x,e.lastCoord.get().y)),Ts(1),ra("points",e.getTriangleCoordinate(e.lastMoved.get().x,e.lastMoved.get().y))}}function a7(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=ba();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}let l7=(()=>{class e extends o1{constructor(e){super(e),this.lastCoord=yw.empty(),this.lastMoved=yw.empty(),this.chosenCoord=yw.empty(),this.rules=new j8(G8),this.availableMinimaxes=[new Z8(this.rules,"SaharaMinimax")],this.encoder=W8.encoder,this.tutorial=(new X8).tutorial,this.updateBoard()}cancelMoveAttempt(){this.chosenCoord=yw.empty()}onClick(e,t){var n=this;return hw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t)})()}choosePiece(e,t){return this.board[t][e]===sQ.EMPTY?this.cancelMove(q8.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=yw.of(new nQ(e,t)),FG.SUCCESS):this.cancelMove(q8.MUST_CHOOSE_OWN_PYRAMID())}chooseLandingCoord(e,t){var n=this;return hw(function*(){const r=new nQ(e,t),i=n.rules.node.gameState.getCurrentPlayer(),s=sQ.ofPlayer(i);if(n.board[t][e]===s)return n.chosenCoord=yw.of(new nQ(e,t)),FG.SUCCESS;const o=W8.from(n.chosenCoord.get(),r);return o.isFailure()?n.cancelMove(o.getReason()):yield n.chooseMove(o.get(),n.rules.node.gameState)})()}updateBoard(){this.chosenCoord=yw.empty();const e=this.rules.node.move;this.lastCoord=e.map(e=>e.coord),this.lastMoved=e.map(e=>e.end),this.board=this.rules.node.gameState.board}getPlayerClassFor(e,t){return this.getPlayerClass(YY.of(this.board[t][e].value))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-sahara"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,s7,2,1,"g",1),la(2,o7,3,2,"ng-container",2),la(3,a7,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMoved.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class c7 extends CQ{constructor(e,t,n,r){super(e,t),this.x=e,this.y=t,this.moveDirection=n,this.landingOrientation=r,this.checkValidity()}checkValidity(){const e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}isRotation(){return this.moveDirection.isAbsent()}equals(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}toString(){const e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}isInsertion(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}c7.encoder=new class extends jY{maxValue(){return 2408}encodeNumber(e){const t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}decodeNumber(e){const t=e%7;e-=t;const n=(e/=7)%7;e-=n;const r=(e/=7)%5,i=4===r?yw.empty():tQ.factory.fromInt(r).toOptional();e-=r;const s=tQ.factory.fromInt(e/=5).get();return new c7(n-1,t-1,i,s)}};class u7{constructor(e){this.value=e}static decode(e){switch(e){case 0:return u7.EMPTY;case 1:return u7.WHITE_UP;case 2:return u7.WHITE_RIGHT;case 3:return u7.WHITE_DOWN;case 4:return u7.WHITE_LEFT;case 5:return u7.BLACK_UP;case 6:return u7.BLACK_RIGHT;case 7:return u7.BLACK_DOWN;case 8:return u7.BLACK_LEFT;case 9:return u7.MOUNTAIN}}belongTo(e){return e===YY.ZERO?1<=this.value&&this.value<=4:5<=this.value&&this.value<=8}isEmptyOrMountain(){return 0===this.value||9===this.value}isPiece(){return!this.isEmptyOrMountain()}getOwner(){return 1<=this.value&&this.value<=4?YY.ZERO:5<=this.value&&this.value<=8?YY.ONE:KY.NONE}getOptionalDirection(){switch(this.value){case 0:return yw.empty();case 1:case 5:return yw.of(tQ.UP);case 2:case 6:return yw.of(tQ.RIGHT);case 3:case 7:return yw.of(tQ.DOWN);case 4:case 8:return yw.of(tQ.LEFT);default:return dw.expectToBe(this.value,9),yw.empty()}}static of(e,t){return t===YY.ZERO?e===tQ.UP?u7.WHITE_UP:e===tQ.RIGHT?u7.WHITE_RIGHT:e===tQ.DOWN?u7.WHITE_DOWN:u7.WHITE_LEFT:e===tQ.UP?u7.BLACK_UP:e===tQ.RIGHT?u7.BLACK_RIGHT:e===tQ.DOWN?u7.BLACK_DOWN:u7.BLACK_LEFT}getDirection(){return this.getOptionalDirection().get()}toString(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return dw.expectToBe(this.value,9),"MOUNTAIN"}}}u7.EMPTY=new u7(0),u7.WHITE_UP=new u7(1),u7.WHITE_RIGHT=new u7(2),u7.WHITE_DOWN=new u7(3),u7.WHITE_LEFT=new u7(4),u7.BLACK_UP=new u7(5),u7.BLACK_RIGHT=new u7(6),u7.BLACK_DOWN=new u7(7),u7.BLACK_LEFT=new u7(8),u7.MOUNTAIN=new u7(9);class h7 extends yQ{static getInitialState(){const e=eK.createTable(5,5,u7.EMPTY);return e[2][1]=u7.MOUNTAIN,e[2][2]=u7.MOUNTAIN,e[2][3]=u7.MOUNTAIN,new h7(e,0)}countPlayerPawn(){let e=0;for(let t=0;t<5;t++)for(let n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}let d7=(()=>{class e{}return e.CANNOT_INSERT_WHEN_SELECTED=()=>$localize`You cannot insert a piece when you have already selected a piece.`,e.NO_REMAINING_PIECE_TO_INSERT=()=>$localize`You cannot insert a piece, all your pieces are already on the board.`,e.NOT_ENOUGH_FORCE_TO_PUSH=()=>$localize`You do not have enough strength to push.`,e.ILLEGAL_ROTATION=()=>$localize`You cannot push and turn at the same time.`,e.ILLEGAL_PUSH=()=>$localize`Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board.`,e})();class p7{constructor(e,t){this.resultingBoard=e,this.moved=t}}let f7=(()=>{class e extends IQ{isLegal(t,n){if(pw(e.VERBOSE,{SiamRules_isLegal:{move:t,state:n}}),!t.isInsertion()&&!n.getPieceAt(t.coord).belongTo(n.getCurrentPlayer()))return RG.failure(hQ.MUST_CHOOSE_PLAYER_PIECE());if(t.isRotation())return pw(e.VERBOSE,"Move is rotation"),this.isLegalRotation(t,n);{let r;if(t.isInsertion()){pw(e.VERBOSE,"Move is insertion");const i=this.isLegalInsertion(t.coord,n);if(i.legal.isFailure())return RG.failure(i.legal.getReason());r=i.insertedPiece}else pw(e.VERBOSE,"Move is forward"),r=n.getPieceAt(t.coord);return e.isLegalForwarding(t,n,r)}}isLegalInsertion(t,n){const r=n.countPlayerPawn(),i=n.getCurrentPlayer(),s=r<5?FG.SUCCESS:FG.failure(d7.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:e.getInsertedPiece(t,i),legal:s}}static getInsertedPiece(e,t){return u7.of(-1===e.x?tQ.RIGHT:-1===e.y?tQ.DOWN:5===e.x?tQ.LEFT:tQ.UP,t)}static isLegalForwarding(t,n,r){pw(e.VERBOSE,{isLegalForwarding:{move:t.toString(),state:n,firstPiece:r}});const i=[];let s=u7.of(t.landingOrientation,n.getCurrentPlayer());const o=t.moveDirection.get();let a=t.coord.getNext(o);if(a.isInRange(5,5)&&n.getPieceAt(a)!==u7.EMPTY&&!1===e.isStraight(r,t))return pw(e.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),RG.failure(d7.ILLEGAL_PUSH());let l=yw.of(o);const c=o.getOpposite();let u=0;const h=n.getCopiedBoard();t.coord.isInRange(5,5)&&(h[t.coord.y][t.coord.x]=u7.EMPTY,i.push(t.coord));let d=a.isInRange(5,5)&&s!==u7.EMPTY;for(;d;){l.equalsValue(o)?u++:l.equalsValue(c)&&u--,pw(e.VERBOSE,{totalForce:u,movingPiece:s,landingCoord:a});const t=h[a.y][a.x];t===u7.MOUNTAIN&&(u-=.9),h[a.y][a.x]=s,i.push(a),s=t,a=a.getNext(o),l=s.getOptionalDirection(),d=a.isInRange(5,5)&&s!==u7.EMPTY&&u>0}return a.isNotInRange(5,5)&&(pw(e.VERBOSE,"This movement would push "+s+" outside the board"),l.equalsValue(o)?u++:l.equalsValue(c)&&u--),u<=0?(pw(e.VERBOSE,"This move is an illegal push: "+h),RG.failure(d7.NOT_ENOUGH_FORCE_TO_PUSH())):(pw(e.VERBOSE,"This move is a legal push: "+h),RG.success(new p7(h,i)))}static isStraight(e,t){const n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}isLegalRotation(t,n){pw(e.VERBOSE,{isLegalRotation:{rotation:t,state:n}});const r=t.coord,i=n.getPieceAt(r),s=n.getCurrentPlayer();if(i.getDirection()===t.landingOrientation)return RG.failure(d7.ILLEGAL_ROTATION());const o=n.getCopiedBoard();return o[r.y][r.x]=u7.of(t.landingOrientation,s),RG.success(new p7(o,[r]))}applyLegalMove(e,t,n){const r=eK.copyBiArray(n.resultingBoard);return new h7(r,t.turn+1)}static getBoardValueInfo(t,n){const r=e.getMountainsRowsAndColumns(n),i=r.rows,s=r.columns,o=e.getWinner(n,t,r.nbMountain);if(o.isPlayer())return o===YY.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER};{const t=e.getPushers(n,s,i);let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const a=n.getCurrentPlayer();for(const e of t)e.coord.isInRange(5,5)?n.getPieceAt(e.coord).belongTo(YY.ZERO)?r=Math.min(r,e.distance):o=Math.min(o,e.distance):a===YY.ZERO?r=Math.min(r,e.distance):o=Math.min(o,e.distance);return{shortestZero:r,shortestOne:o,boardValue:e.getScoreFromShortestDistances(r,o,a)}}}static getScoreFromShortestDistances(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);const r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}static getMountainsRowsAndColumns(e){const t=[],n=[];let r=0;for(let i=0;i<5;i++)for(let s=0;s<5;s++)e.getPieceAtXY(s,i)===u7.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(s)||n.push(s),r++);return{rows:t,columns:n,nbMountain:r}}static getWinner(t,n,r){return 2===r?e.getPusher(t,n.get()):KY.NONE}static getPusher(t,n){const r=n.coord;let i;i=r.isInRange(5,5)?t.getPieceAt(r.getNext(n.landingOrientation)):e.getInsertedPiece(r,t.getCurrentOpponent());const s=i.getDirection(),o=e.getPusherCoord(t,s,r),a=t.getPieceAt(o).getOwner();return pw(e.VERBOSE,r.toString()+" belong to "+t.getCurrentOpponent().value+", "+o.toString()+" belong to "+a.value+", "+a.value+" win"),a}static getPusherCoord(e,t,n){let r=n.getNext(t),i=n;for(;r.isInRange(5,5);){n=r,r=r.getNext(t);const s=e.getPieceAt(n);s!==u7.MOUNTAIN&&s.getDirection()===t&&(i=n)}return i}static getPushers(t,n,r){pw(e.VERBOSE,{getPushers:{state:t,mountainsColumn:n,mountainsRow:r}});let i=[];const s=[];for(const e of n){let t=tQ.DOWN,n=new nQ(e,4);s.push({direction:t,fallingCoord:n}),t=tQ.UP,n=new nQ(e,0),s.push({direction:t,fallingCoord:n})}for(const e of r){let t=tQ.LEFT,n=new nQ(0,e);s.push({direction:t,fallingCoord:n}),t=tQ.RIGHT,n=new nQ(4,e),s.push({direction:t,fallingCoord:n})}for(const o of s)i=e.addPotentialDirectionPusher(t,o.fallingCoord,o.direction,i);return i}static addPotentialDirectionPusher(t,n,r,i){const s=e.getLineClosestPusher(t,n,r);if(s.isAbsent())return i;const o=s.get(),a=o.distance;return pw(e.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:a}),i}static getLineClosestPusher(t,n,r){pw(e.VERBOSE,{getDirectionClosestPusher:{state:t,fallingCoord:n,direction:r.toString()}});const i=r.getOpposite();let s=1,o=t.getPieceAt(n),a=n,l=yw.empty(),c=!1,u=!1,h=0;for(;a.isInRange(5,5)&&!1===c;){const e=t.getPieceAt(a);if(e.isEmptyOrMountain())e===u7.MOUNTAIN?(h+=.9,u=!0):s++;else{const t=e.getDirection();t===r?u&&(h-=1,h<=0&&(c=!0,a=a.getNext(r))):t===i?(h+=1,u||s++):u?(l=yw.of(a),o!==u7.EMPTY&&s++):s++}o=e,a=a.getPrevious(r)}if(!1===c&&l.isPresent())for(s++,h-=1;!1===a.equals(l.get());)a=a.getNext(r),s--;return a.isNotInRange(5,5)&&(h-=1,5===t.countPlayerPawn())||h>0?yw.empty():yw.of({distance:s,coord:a})}static getPushingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[];for(let s=0;s<5;s++)r.push(new c7(-1,s,yw.of(tQ.RIGHT),tQ.RIGHT)),i.push(u7.of(tQ.RIGHT,n)),r.push(new c7(5,s,yw.of(tQ.LEFT),tQ.LEFT)),i.push(u7.of(tQ.LEFT,n)),r.push(new c7(s,-1,yw.of(tQ.DOWN),tQ.DOWN)),i.push(u7.of(tQ.DOWN,n)),r.push(new c7(s,5,yw.of(tQ.UP),tQ.UP)),i.push(u7.of(tQ.UP,n));for(let s=0;s<r.length;s++)this.isLegalForwarding(r[s],e.gameState,i[s]).isSuccess()&&t.push(r[s]);return t}static getDerapingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer();let r,i,s;for(let o=1;o<=3;o++)r=new c7(-1,o,yw.of(tQ.RIGHT),tQ.UP),i=u7.of(tQ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new c7(-1,o,yw.of(tQ.RIGHT),tQ.DOWN),i=u7.of(tQ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new c7(5,o,yw.of(tQ.LEFT),tQ.UP),i=u7.of(tQ.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new c7(5,o,yw.of(tQ.LEFT),tQ.DOWN),i=u7.of(tQ.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));for(let o=1;o<=3;o++)r=new c7(o,-1,yw.of(tQ.DOWN),tQ.LEFT),i=u7.of(tQ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new c7(o,-1,yw.of(tQ.DOWN),tQ.RIGHT),i=u7.of(tQ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new c7(o,5,yw.of(tQ.UP),tQ.LEFT),i=u7.of(tQ.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new c7(o,5,yw.of(tQ.UP),tQ.RIGHT),i=u7.of(tQ.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));return t}static getCoordDirection(e,t,n){const r=new nQ(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}getGameStatus(t){const n=e.getMountainsRowsAndColumns(t.gameState),r=e.getWinner(t.gameState,t.move,n.nbMountain);return r.isPlayer()?TQ.getVictory(r):TQ.ONGOING}}return e.VERBOSE=!1,e})();class g7 extends dQ{getBoardValue(e){return new pQ(f7.getBoardValueInfo(e.move,e.gameState).boardValue)}getListMoves(e){let t=[];const n=e.gameState.getCurrentPlayer();let r;for(let i=0;i<5;i++)for(let s=0;s<5;s++)if(r=e.gameState.getPieceAtXY(s,i),r.belongTo(n)){const o=r.getDirection();for(const a of tQ.ORTHOGONALS){if(a!==o){const r=e.gameState.getCopiedBoard(),o=new c7(s,i,yw.empty(),a);r[i][s]=u7.of(a,n),t.push(o)}let l;l=new nQ(s+a.x,i+a.y).isInRange(5,5)?tQ.ORTHOGONALS:[a];for(const n of l){const o=new c7(s,i,yw.of(a),n);f7.isLegalForwarding(o,e.gameState,r).isSuccess()&&t.push(o)}}}return e.gameState.countPlayerPawn()<5&&(t=t.concat(f7.getPushingInsertions(e)),t=t.concat(f7.getDerapingInsertions(e))),pw(f7.VERBOSE,{getListMovesResult:t}),t}}const m7=u7.EMPTY,y7=u7.MOUNTAIN,v7=u7.WHITE_UP,_7=u7.WHITE_LEFT,C7=u7.WHITE_RIGHT,E7=u7.WHITE_DOWN,w7=u7.BLACK_UP,S7=u7.BLACK_LEFT,b7=u7.BLACK_RIGHT,P7=u7.BLACK_DOWN;class O7{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`The goal at Siam is to be the first to push a mountain out of the board.
        The initial board contains three mountains, and no pieces are initially on the board.
        During its turn, a player can do one of the following three actions:
        <ol>
            <li>Put a new piece on the board.</li>
            <li>Change the orientation of one of its piece, and optionally move it.</li>
            <li>Take one of its pieces out of the board.</li>
        </ol>`,h7.getInitialState()),NQ.anyMove($localize`Inserting a piece`,$localize`Each player has 5 pieces in total.
        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:
        <ol>
            <li>Click on one of the big arrows alongside the board.</li>
            <li>Click on one of the small arrows that appeared on the landing square of your piece.
                This is the direction in which your piece will be oriented.</li>
        </ol><br/>
        Insert a piece on the board.`,h7.getInitialState(),new c7(2,-1,yw.of(tQ.DOWN),tQ.DOWN),$localize`Congratulations!`),NQ.fromMove($localize`Moving a piece`,$localize`We will distinguish here "moving" and "pushing".
        A move is made from a piece's square to an empty neighboring square, horizontally or vertically.
        During that move, you can also move the piece out of the board.
        To move a piece:
        <ol>
            <li>Click on it.</li>
            <li>Click on one of the 4 arrows to pick the direction in which it will move.
                You can also click on the middle dot to change the piece's orientation without moving it.</li>
            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>
        </ol><br/>
        Try to move the piece that is on the board one square upwards and to orient it downwards.`,new h7([[m7,m7,m7,m7,m7],[m7,m7,m7,m7,m7],[m7,y7,y7,y7,m7],[m7,m7,m7,m7,m7],[m7,m7,v7,m7,m7]],0),[new c7(2,4,yw.of(tQ.UP),tQ.DOWN)],$localize`Congratulations, you made a side-slip!`,$localize`Failed!`),NQ.fromMove($localize`Moving a piece out of the board`,$localize`To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>
        Get that piece out of the board!`,new h7([[m7,m7,m7,m7,m7],[m7,m7,m7,m7,m7],[m7,y7,y7,y7,m7],[m7,m7,m7,m7,m7],[m7,m7,v7,m7,m7]],0),[new c7(2,4,yw.of(tQ.DOWN),tQ.DOWN)],$localize`Congratulations, even if in this context it was not a useful move.`,$localize`Failed, the piece is still on the board.`),NQ.fromMove($localize`Pushing`,$localize`When the landing square of your move is occupied, we use the term "push".
        In order to push, multiple conditions must hold:
        <ol>
            <li>Your piece must already be oriented in the direction of the push.</li>
            <li>The number of the pieces (opponent's or not) that are facing yours (called the resistants)
                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>
            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>
        </ol>
        Your piece on the top right cannot push because there is one mountain too much.
        Your piece on the bottom right can push.<br/><br/>
        Do it.`,new h7([[C7,y7,y7,S7,_7],[m7,m7,m7,m7,m7],[m7,m7,m7,y7,m7],[m7,m7,m7,m7,m7],[m7,m7,b7,S7,_7]],0),[new c7(4,4,yw.of(tQ.LEFT),tQ.LEFT)],$localize`Congratulations!`,$localize`Failed!`),NQ.fromMove($localize`Victory`,$localize`The game ends when a mountain is pushed out of the board.
        If you pushed it and nobody is in front of you, you're the winner.
        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.
        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>
        You have two ways of ending the game here: you can either win, or lose. Choose correctly!`,new h7([[m7,m7,m7,m7,m7],[m7,m7,m7,m7,m7],[y7,w7,_7,m7,E7],[m7,m7,m7,m7,P7],[m7,m7,m7,m7,y7]],0),[new c7(2,2,yw.of(tQ.LEFT),tQ.LEFT)],$localize`Congratulations, you won!`,$localize`Failed, you lost.`)]}}function T7(e,t){if(1&e){const e=va();Cn(),pa(0,"use",7),Ea("click",function(){const t=Gt(e).$implicit;return ba(3).insertAt(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit,n=ba(3);Ia("id","insertAt_",e.x,"_",e.y,""),ra("transform",n.getInsertionArrowTransform(e.x+1,e.y+1,e.dir))}}const I7=function(e,t){return{dir:"DOWN",x:e,y:t}},k7=function(e){return{dir:"UP",x:e,y:5}},A7=function(e,t){return{dir:"RIGHT",x:e,y:t}},M7=function(e){return{dir:"LEFT",x:5,y:e}},N7=function(e,t,n,r){return[e,t,n,r]};function x7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,T7,1,3,"use",6),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",hu(11,N7,uu(1,I7,e,-1),cu(4,k7,e),uu(6,A7,-1,e),cu(9,M7,e)))}}const R7=function(){return[0,1,2,3,4]};function D7(e,t){1&e&&(Cn(),ma(0),la(1,x7,2,16,"g",5),ya()),2&e&&(Ts(1),ha("ngForOf",lu(1,R7)))}function L7(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return ba(5).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(3).index,r=ba().index,i=ba();Ta("id","chooseDirection_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}const F7=function(){return["RIGHT","DOWN","LEFT","UP"]};function U7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",11),Ea("click",function(){return Gt(e),ba(4).chooseDirection("")}),fa(),la(2,L7,1,2,"use",12),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("cx",(e+1)*n.SPACE_SIZE+n.SPACE_SIZE/2)("cy",(t+1)*n.SPACE_SIZE+n.SPACE_SIZE/2),Ts(1),ha("ngForOf",lu(3,F7))}}function B7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"use",10),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().clickPiece(t,n)}),fa(),la(2,U7,3,4,"g",4),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ts(1),Ia("id","clickPiece_",t,"_",r,""),ha("ngClass",i.getPieceClasses(n)),ra("transform",i.getPieceTransform(t,r)),Ts(1),ha("ngIf",i.choosingDirection(t,r))}}function V7(e,t){if(1&e&&(Cn(),ga(0,"use",14)),2&e){const e=ba().index,t=ba().index,n=ba();ra("transform","translate("+(e+1)*n.SPACE_SIZE+" "+(t+1)*n.SPACE_SIZE+")")}}function $7(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return ba(4).chooseOrientation(t)}),fa()}if(2&e){const e=t.$implicit,n=ba(2).index,r=ba().index,i=ba();Ta("id","chooseOrientation_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}function z7(e,t){1&e&&(Cn(),pa(0,"g"),la(1,$7,1,2,"use",12),fa()),2&e&&(Ts(1),ha("ngForOf",lu(1,F7)))}function H7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().insertAt(t,n)}),fa(),la(2,B7,3,5,"g",4),la(3,V7,1,1,"use",9),la(4,z7,2,2,"g",4),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ba().index,i=ba();Ts(1),Ia("id","insertAt_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*(n+1))("y",i.SPACE_SIZE*(r+1))("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isPiece()),Ts(1),ha("ngIf",i.isMountain(e)),Ts(1),ha("ngIf",i.choosingOrientation(n,r))}}function G7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,H7,5,10,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let q7=(()=>{class e extends pX{constructor(e){super(e),this.lastMove=yw.empty(),this.chosenCoord=yw.empty(),this.landingCoord=yw.empty(),this.chosenDirection=yw.empty(),this.chosenOrientation=yw.empty(),this.movedPieces=[],this.rules=new f7(h7),this.availableMinimaxes=[new g7(this.rules,"SiamMinimax")],this.encoder=c7.encoder,this.tutorial=(new O7).tutorial,this.updateBoard()}updateBoard(){if(pw(e.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}cancelMoveAttempt(){this.chosenCoord=yw.empty(),this.chosenDirection=yw.empty(),this.landingCoord=yw.empty(),this.chosenOrientation=yw.empty()}clickPiece(e,t){const n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(hQ.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=yw.of(new nQ(e,t)),FG.SUCCESS)}chooseDirection(t){var n=this;return hw(function*(){pw(e.VERBOSE,"SiamComponent.chooseDirection("+t+")");const r=n.canUserPlay("#chooseDirection_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(""===t)n.chosenDirection=yw.empty(),n.landingCoord=n.chosenCoord;else{const r=tQ.factory.fromString(t).get();if(n.chosenDirection=yw.of(r),n.landingCoord=yw.of(n.chosenCoord.get().getNext(r)),n.landingCoord.get().isNotInRange(5,5))return pw(e.VERBOSE,"orientation and direction should be the same: "+r),n.chosenOrientation=yw.of(r),yield n.tryMove()}return FG.SUCCESS})()}chooseOrientation(t){var n=this;return hw(function*(){pw(e.VERBOSE,"SiamComponent.chooseOrientation("+t+")");const r=n.canUserPlay("#chooseOrientation_"+t);return r.isFailure()?n.cancelMove(r.getReason()):(n.chosenOrientation=yw.of(tQ.factory.fromString(t).get()),yield n.tryMove())})()}insertAt(t,n){var r=this;return hw(function*(){pw(e.VERBOSE,"SiamComponent.insertAt("+t+", "+n+")");const i=r.canUserPlay("#insertAt_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());if(r.chosenCoord.isPresent())return r.cancelMove(d7.CANNOT_INSERT_WHEN_SELECTED());{r.chosenCoord=yw.of(new nQ(t,n));const e=f7.getCoordDirection(t,n,r.rules.node.gameState);return r.chosenDirection=yw.of(e),r.landingCoord=yw.of(r.chosenCoord.get().getNext(e)),FG.SUCCESS}})()}tryMove(){var e=this;return hw(function*(){const t=e.chosenCoord.get(),n=new c7(t.x,t.y,e.chosenDirection,e.chosenOrientation.get());return e.cancelMove(),yield e.chooseMove(n,e.rules.node.gameState)})()}isMountain(e){return e===u7.MOUNTAIN}choosingOrientation(t,n){const r=new nQ(t,n);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(pw(e.VERBOSE,"choosing orientation now"),!0)}choosingDirection(t,n){const r=new nQ(t,n);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(pw(e.VERBOSE,"choosing direction now"),!0)}getInsertionArrowTransform(e,t,n){const r=`rotate(${90*(tQ.factory.fromString(n).get().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}getPieceTransform(e,t){const n=`rotate(${90*(this.board[t][e].getDirection().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}getArrowTransform(e,t,n){return C8.getArrowTransform(this.SPACE_SIZE,new nQ(e,t),tQ.factory.fromString(n).get())}getPieceClasses(e){return[this.getPlayerClass(e.getOwner())]}getSquareClasses(e,t){const n=new nQ(e,t);return this.movedPieces.some(e=>e.equals(n))?["moved"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-siam"]],features:[Go],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],[0,"xlink","href","#triangle","class","arrow selected-fill no-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),ga(3,"polygon",2),ga(4,"polygon",3),fa(),la(5,D7,2,2,"ng-container",4),la(6,G7,2,1,"g",5),fa()),2&e&&(Ts(5),ha("ngIf",t.isPlayerTurn()),Ts(1),ha("ngForOf",t.board))},directives:[Hd,$d,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),W7=(()=>{class e{}return e.NO_MOVEMENT_BEFORE_TURN_40=()=>$localize`You cannot move yet. Pick a space where you will put a new piece.`,e.MUST_CUT=()=>$localize`Several groups are of the same size, you must pick the one to keep.`,e.CANNOT_CHOOSE_TO_KEEP=()=>$localize`You cannot choose which part to keep when one is smaller than the other.`,e.CAN_NO_LONGER_DROP=()=>$localize`You cannot put new pieces anymore. Pick a piece to move.`,e.MUST_CAPTURE_BIGGEST_GROUPS=()=>$localize`You must choose one of the biggest groups to keep it.`,e.CANNOT_KEEP_EMPTY_COORD=()=>$localize`You cannot pick an empty space. Pick one of the biggest groups.`,e.MUST_DROP_NEXT_TO_OTHER_PIECE=()=>$localize`You must put this piece next to another piece.`,e})();class j7 extends mQ{constructor(e,t,n){super(t),this.pieces=e;const r=this.getCalculatedScale();this.pieces=r.pieces,this.width=r.width,this.height=r.height,this.offset=n??r.offset,this.pieces.makeImmutable()}static getInitialState(){return j7.fromRepresentation([[YY.ZERO.value],[YY.ONE.value]],0)}static fromRepresentation(e,t,n){const r=new bQ;for(let i=0;i<e.length;i++)for(let t=0;t<e[0].length;t++)e[i][t]!==KY.NONE.value&&r.set(new nQ(t,i),YY.of(e[i][t]));return new j7(r,t,n)}static deplacePiece(e,t){const n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}static getGroups(e,t){let n=new bQ,r=0;for(const o of oQ.factory.all){const i=t.getNext(o,1);n=j7.putCoordInGroup(e,i,n,""+r),r++}const i=n.reverse(),s=new gQ;for(let o=0;o<i.size();o++)s.add(i.getByIndex(o).value);return s}static putCoordInGroup(e,t,n,r){if(e.get(t).isPresent()&&n.get(t).isAbsent()){n.set(t,r);for(const i of oQ.factory.all){const s=t.getNext(i,1);n=j7.putCoordInGroup(e,s,n,r)}}return n}getCalculatedScale(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const o of this.pieces.listKeys())e=Math.min(o.x,e),t=Math.max(o.x,t),n=Math.min(o.y,n),r=Math.max(o.y,r);let i=new bQ;const s=new JJ(-e,-n);if(0!==e||0!==n)for(const o of this.pieces.listKeys()){const e=this.pieces.delete(o),t=o.getNext(s);i.set(t,e)}else i=this.pieces;return{width:t+1-e,height:r+1-n,pieces:i,offset:s}}toRepresentation(){const e=eK.createTable(this.width,this.height,KY.NONE.value);for(const t of this.pieces.listKeys()){const n=this.getPieceAt(t).value;e[t.y][t.x]=n}return e}isIllegalLandingZone(e,t){return this.pieces.containsKey(e)?FG.failure(hQ.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?FG.SUCCESS:FG.failure(W7.MUST_DROP_NEXT_TO_OTHER_PIECE())}isCoordConnected(e,t){for(const n of oQ.factory.all){const r=e.getNext(n,1);if(this.pieces.containsKey(r)&&!1===t.equalsValue(r))return!0}return!1}isOnBoard(e){return this.pieces.containsKey(e)}getPieceAt(e){return this.isOnBoard(e)?this.pieces.get(e).get():KY.NONE}applyLegalDrop(e){const t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new j7(t,this.turn+1)}applyLegalDeplacement(e,t){const n=j7.deplacePiece(this,e);let r=new bQ;if(t.size()>0){r=new bQ;for(const e of t)r.set(e,n.get(e).get())}else r=n.getCopy();return new j7(r,this.turn+1)}countPieces(){const e=this.pieces.reverse(),t=e.get(YY.ZERO).getOrElse(new BX),n=e.get(YY.ONE).getOrElse(new BX);return[t.size(),n.size()]}switchPiece(e){const t=this.pieces.getCopy(),n=this.getPieceAt(e);if(n.isPlayer())return t.replace(e,n.getOpponent()),new j7(t,this.turn,this.offset);$G.logErrorAndFail("SixState","Cannot switch piece if there is no piece!",{coord:e.toString()})}equals(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}class Z7 extends _Q{constructor(e,t,n){if(super(),this.start=e,this.landing=t,this.keep=n,e.equalsValue(t))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(n))throw new Error("Cannot keep starting coord, since it will always be empty after move!")}static fromDrop(e){return new Z7(yw.empty(),e,yw.empty())}static fromMovement(e,t){return new Z7(yw.of(e),t,yw.empty())}static fromCut(e,t,n){return new Z7(yw.of(e),t,yw.of(n))}isDrop(){return this.start.isAbsent()}isCut(){return this.keep.isPresent()}toString(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}equals(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}Z7.encoder=new class extends WY{encodeMove(e){return{start:e.start.isPresent()?nQ.encoder.encode(e.start.get()):null,landing:nQ.encoder.encode(e.landing),keep:e.keep.isPresent()?nQ.encoder.encode(e.keep.get()):null}}decodeMove(e){const t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");const n=nQ.encoder.decode(t.landing);if(null==t.start)return Z7.fromDrop(n);const r=nQ.encoder.decode(t.start);if(null==t.keep)return Z7.fromMovement(r,n);{const e=nQ.encoder.decode(t.keep);return Z7.fromCut(r,n,e)}}};class Y7 extends IQ{constructor(){super(...arguments),this.VERBOSE=!1}applyLegalMove(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}isLegal(e,t){pw(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});const n=t.isIllegalLandingZone(e.landing,e.start);return n.isFailure()?n.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):Y7.isLegalPhaseTwoMove(e,t)}static getLegalLandings(e){const t=new BX;for(const n of e.pieces.listKeys())for(const r of oQ.factory.all){const i=n.getNext(r,1);e.getPieceAt(i)===KY.NONE&&t.add(i)}return t.toList()}isLegalDrop(e,t){return!1===e.isDrop()?RG.failure(W7.NO_MOVEMENT_BEFORE_TURN_40()):RG.success(t.pieces.getKeySet())}static isLegalPhaseTwoMove(e,t){if(e.isDrop())return RG.failure(W7.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case KY.NONE:return RG.failure(hQ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return RG.failure(hQ.CANNOT_CHOOSE_OPPONENT_PIECE())}const n=j7.deplacePiece(t,e),r=j7.getGroups(n,e.start.get());if(Y7.isSplit(r)){const t=this.getBiggerGroups(r);return 1===t.size()?e.keep.isPresent()?RG.failure(W7.CANNOT_CHOOSE_TO_KEEP()):RG.success(t.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,t,n)}return RG.success(new BX)}static isSplit(e){return e.size()>1}static getBiggerGroups(e){let t=0,n=new gQ;for(const r of e){const e=r.size();e>t?(t=e,n=new gQ([r])):e===t&&n.add(r)}return n}static moveKeepBiggerGroup(e,t,n){if(e.isAbsent())return RG.failure(W7.MUST_CUT());if(n.get(e.get()).isAbsent())return RG.failure(W7.CANNOT_KEEP_EMPTY_COORD());const r=e.get();for(const i of t)if(i.contains(r))return RG.success(i);return RG.failure(W7.MUST_CAPTURE_BIGGEST_GROUPS())}getGameStatus(e){const t=e.gameState,n=t.getCurrentOpponent();let r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return TQ.getVictory(n);if(t.turn>39){const e=t.countPieces(),n=e[0],r=e[1];return n<6&&r<6?n<r?TQ.ONE_WON:r<n?TQ.ZERO_WON:TQ.DRAW:n<6?TQ.getDefeat(YY.ZERO):r<6?TQ.getDefeat(YY.ONE):TQ.ONGOING}return TQ.ONGOING}startSearchingVictorySources(){pw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}getShapeVictory(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();const n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(pw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(oQ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return[];const t=(e+i.length)%6;i.push(s),s=s.getNext(oQ.factory.all[t],1)}return i}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=oQ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return[];a=!0,i=i.getOpposite(),s=s.getNext(i,o.length)}s=s.getNext(i,1)}return o}searchVictoryOnlyForTriangleCorner(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=oQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.length%2==0&&(i=oQ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return s}searchVictoryOnlyForTriangleEdge(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=oQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.push(o),s.length%2==0&&(i=oQ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return s}}class K7 extends dQ{calculateBoardValue(e,t){this.startSearchingVictorySources();let n={status:wQ.DEFAULT,victory:yw.empty(),preVictory:yw.empty(),sum:0};for(;this.hasNextVictorySource();){const r=this.getNextVictorySource();let i;if(i=n.status===wQ.PRE_VICTORY?this.searchVictoryOnly(r,e,t):this.getBoardInfo(r,e,t,n),i.status===wQ.VICTORY)return i;n={status:i.status,victory:yw.empty(),preVictory:i.preVictory,sum:n.sum+i.sum}}return n}}class J7 extends pQ{constructor(e,t){super(e),this.value=e,this.preVictory=t}}class Q7 extends K7{constructor(){super(...arguments),this.VERBOSE=!1}static get(){if(null==Q7.INSTANCE){const e=new Y7(j7);Q7.INSTANCE=new Q7(e,"SixMinimax")}return Q7.INSTANCE}getListMoves(e){const t=Q7.get(),n=e.getOwnValue(t);if(n.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(n):this.createForcedDeplacement(e,n);const r=Y7.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(r):this.getListDeplacement(e.gameState,r)}createForcedDrop(e){pw(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});const t=[],n=Z7.fromDrop(e.preVictory.get());return t.push(n),t}createForcedDeplacement(e,t){pw(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});const n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}getDeplacementFrom(e,t,n){const r=[];for(const i of t)for(const t of n){const n=Z7.fromMovement(i,t);if(e.isCoordConnected(t,yw.of(i))){const s=j7.deplacePiece(e,n),o=j7.getGroups(s,n.start.get());if(Y7.isSplit(o))for(const e of o){const n=e.getAnyElement().get(),s=Z7.fromCut(i,t,n);r.push(s)}else r.push(n)}}return r}getSafelyMovablePieceOrFirstOne(e){const t=e.gameState,n=t.pieces.reverse(),r=t.getCurrentPlayer(),i=n.get(r).get(),s=i.getAnyElement().get(),o=[];for(const a of i)!1===this.isPieceBlockingAVictory(t,a)&&o.push(a);return new BX(0===o.length?[s]:o)}isPieceBlockingAVictory(e,t){const n=e.switchPiece(t),r=Z7.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===wQ.VICTORY)return!0;return!1}getListDrop(e){const t=[];for(const n of e){const e=Z7.fromDrop(n);t.push(e)}return t}getListDeplacement(e,t){const n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}getBoardValue(e){const t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue();let s={status:wQ.DEFAULT,victory:yw.empty(),preVictory:yw.empty(),sum:0};t.isPresent()&&(s=this.calculateBoardValue(t.get(),n));let o=yw.empty();if(s.status===wQ.DEFAULT&&s.preVictory.isPresent()&&(o=yw.of(s.preVictory.get())),s.status===wQ.VICTORY)return new J7(i,yw.empty());if(n.turn>39){const e=n.countPieces(),t=e[0],r=e[1];return t<6&&r<6?new J7(t<r?YY.ONE.getVictoryValue():r<t?YY.ZERO.getVictoryValue():0,yw.empty()):t<6?new J7(YY.ZERO.getDefeatValue(),yw.empty()):r<6?new J7(YY.ONE.getDefeatValue(),yw.empty()):new J7(t-r,o)}return new J7(s.status===wQ.PRE_VICTORY?r.getPreVictory():s.sum*r.getScoreModifier(),o)}startSearchingVictorySources(){pw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(pw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(oQ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return{status:wQ.PRE_VICTORY,victory:yw.empty(),preVictory:yw.empty(),sum:0};const t=(e+i.length)%6;i.push(s),s=s.getNext(oQ.factory.all[t],1)}return{status:wQ.VICTORY,victory:yw.of(i),preVictory:yw.empty(),sum:0}}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=oQ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return{status:wQ.PRE_VICTORY,victory:yw.empty(),preVictory:yw.empty(),sum:0};a=!0,i=i.getOpposite(),s=s.getNext(i,o.length-1)}s=s.getNext(i,1)}return{status:wQ.VICTORY,victory:yw.of(o),preVictory:yw.empty(),sum:0}}searchVictoryOnlyForTriangleCorner(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=oQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:wQ.PRE_VICTORY,victory:yw.empty(),preVictory:yw.empty(),sum:0};s.length%2==0&&(i=oQ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return{status:wQ.VICTORY,victory:yw.of(s),preVictory:yw.empty(),sum:0}}searchVictoryOnlyForTriangleEdge(e,t,n){pw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=oQ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:wQ.PRE_VICTORY,victory:yw.empty(),preVictory:yw.empty(),sum:0};s.push(o),s.length%2==0&&(i=oQ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return{status:wQ.VICTORY,victory:yw.of(s),preVictory:yw.empty(),sum:0}}getBoardInfo(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});const i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}getBoardInfoForCircle(e,t,n,r){pw(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer(),s=[t];let o=t.getNext(oQ.factory.all[e],1),a=0,l=yw.empty();for(;s.length<6;){const t=n.getPieceAt(o);if(t===i)return r;const c=(e+s.length)%6;s.push(o);const u=oQ.factory.all[c];t===KY.NONE?(a+=.16,l=yw.of(o)):a++,o=o.getNext(u,1)}return this.getBoardInfoResult(a,l,s,r)}getBoardInfoResult(e,t,n,r){let i=r.preVictory;if(4.16===e){if(pw(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:wQ.PRE_VICTORY,victory:yw.empty(),preVictory:yw.empty(),sum:0};i=t}else if(5===e)return{status:wQ.VICTORY,victory:yw.of(n),preVictory:yw.empty(),sum:0};return{status:r.status,victory:yw.empty(),preVictory:i,sum:r.sum+e}}getBoardInfoForLine(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});const i=oQ.factory.all[e];let s=t.getPrevious(i,5),o=[],a=[],l=yw.empty();for(let f=0;f<6;f++){const e=this.updateEncounterAndReturnLastEmpty(n,s,a);e.isPresent()&&(l=e),o.push(s),s=s.getNext(i,1)}let c=r.status,u=r.preVictory,h=0,d=0;for(;h<6;){const e=a.reduce((e,t)=>e+t);if(6===e)return{status:wQ.VICTORY,victory:yw.of(o),preVictory:yw.empty(),sum:0};5.16===e&&c===wQ.DEFAULT&&(u.isPresent()?(zG(!1===u.equals(l),"Impossible to have point aligned with differents line to a same point"),c=wQ.PRE_VICTORY):u=l),d=Math.max(d,e),o=o.slice(1,6),o.push(s),a=a.slice(1,6);const t=this.updateEncounterAndReturnLastEmpty(n,s,a);t.isPresent()&&(l=t),h++,s=s.getNext(i,1)}const p={status:c,victory:yw.of(o),preVictory:u,sum:d};return this.getBoardInfoResult(d,l,o,p)}updateEncounterAndReturnLastEmpty(e,t,n){const r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),yw.empty();case KY.NONE:return n.push(.16),yw.of(t);default:return n.push(1),yw.empty()}}getBoardInfoForTriangleCorner(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=oQ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=yw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===KY.NONE?(l+=.16,c=yw.of(a)):l++,o.length%2==0&&(s=oQ.factory.all[(e+o.length)%6]),o.push(a),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}getBoardInfoForTriangleEdge(e,t,n,r){pw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=oQ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=yw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===KY.NONE?(l+=.16,c=yw.of(a)):l++,o.push(a),o.length%2==0&&(s=oQ.factory.all[(e+o.length)%6]),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}}const X7=KY.NONE.value,e9=YY.ZERO.value,t9=YY.ONE.value;let n9=(()=>{class e{}return e.MOVEMENT_NOT_DISCONNECTING=()=>$localize`This move does not disconnect your opponent's pieces. Try again with another piece.`,e.MOVEMENT_SELF_DISCONNECTING=()=>$localize`You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!`,e})();class r9{constructor(){this.tutorial=[NQ.informational($localize`Six`,$localize`Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.
        Each player has 21 pieces, with one for each player already on the board.
        The goal of the game is to form one of the three winning shapes with your pieces.`,j7.getInitialState()),NQ.fromMove($localize`Victory (line)`,$localize`On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>
        Find the victory. You're playing Dark.`,j7.fromRepresentation([[e9,t9,t9,t9,t9,e9],[X7,e9,t9,X7,e9,X7],[t9,t9,e9,X7,X7,X7],[X7,X7,e9,X7,X7,X7],[X7,e9,X7,X7,X7,X7],[e9,X7,X7,X7,X7,X7]],0),[Z7.fromDrop(new nQ(3,2))],$localize`Congratulations!`,$localize`Failed!`),NQ.fromMove($localize`Victory (circle)`,$localize`On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,j7.fromRepresentation([[X7,X7,X7,t9,X7,X7],[X7,X7,t9,t9,e9,e9],[X7,t9,X7,e9,t9,X7],[t9,e9,e9,e9,e9,t9]],0),[Z7.fromDrop(new nQ(5,2))],$localize`Congratulations! Note that if a piece is inside the circle, it does not change anything.`,$localize`Failed!`),NQ.fromMove($localize`Victory (triangle)`,$localize`On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,j7.fromRepresentation([[X7,X7,X7,t9,X7,X7],[X7,e9,t9,e9,e9,e9],[X7,e9,X7,e9,e9,X7],[t9,t9,t9,X7,t9,X7]],0),[Z7.fromDrop(new nQ(3,3))],$localize`Congratulations!`,$localize`Failed!`),NQ.fromPredicate($localize`Second phase`,$localize`After 40 turns, your pieces have all been placed and we move on to the second phase of the game.
        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.
        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>
        You're playing Dark. Make a move that disconnects one of your opponent's pieces.`,j7.fromRepresentation([[X7,X7,X7,X7,X7,X7,X7,t9,X7],[X7,X7,X7,X7,X7,X7,e9,X7,X7],[X7,X7,X7,X7,e9,e9,e9,X7,X7],[X7,X7,X7,X7,t9,t9,X7,t9,e9],[X7,e9,t9,t9,e9,e9,t9,X7,X7],[e9,e9,e9,e9,t9,t9,t9,e9,X7],[t9,t9,e9,X7,t9,t9,e9,X7,X7],[X7,e9,X7,e9,e9,X7,X7,X7,X7],[t9,t9,t9,t9,X7,X7,X7,X7,X7],[X7,e9,X7,t9,X7,X7,X7,X7,X7]],40),Z7.fromMovement(new nQ(6,1),new nQ(5,1)),(e,t)=>{const n=t.countPieces();return 19===n[0]?18===n[1]?FG.SUCCESS:FG.failure(n9.MOVEMENT_NOT_DISCONNECTING()):FG.failure(n9.MOVEMENT_SELF_DISCONNECTING())},$localize`Congratulations, your opponent now has one piece less and you're closer to victory!`),NQ.fromPredicate($localize`Victory by disconnection`,$localize`During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.
        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.
        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>
        Here, you're playing Dark and you can win. Do it!`,j7.fromRepresentation([[X7,X7,X7,X7,X7,t9],[X7,X7,X7,X7,e9,t9],[X7,X7,X7,t9,e9,e9],[X7,X7,e9,X7,t9,e9],[t9,t9,X7,X7,X7,e9],[e9,t9,X7,X7,X7,X7],[e9,X7,X7,X7,X7,X7]],40),Z7.fromMovement(new nQ(2,3),new nQ(3,3)),(e,t)=>e.start.equalsValue(new nQ(2,3))?FG.SUCCESS:FG.failure(n9.MOVEMENT_NOT_DISCONNECTING()),$localize`Congratulations, you won!`),NQ.fromPredicate($localize`Special disconnection`,$localize`During a disconnection, two or more groups could have the same size,
        in which case you will have to click on the group you wish to keep.<br/><br/>
        You're playing Dark, play such a move!`,j7.fromRepresentation([[X7,X7,X7,X7,X7,t9],[X7,X7,X7,X7,e9,t9],[X7,X7,X7,t9,e9,e9],[e9,X7,e9,X7,X7,t9],[t9,t9,X7,X7,X7,X7],[e9,e9,X7,X7,X7,X7],[e9,X7,X7,X7,X7,X7]],40),Z7.fromCut(new nQ(2,3),new nQ(2,5),new nQ(2,5)),(e,t)=>e.keep.isAbsent()?FG.failure($localize`This move has not cut the board in two equal halves.`):t.getPieceAt(e.landing.getNext(t.offset))===KY.NONE?FG.failure($localize`Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again.`):FG.SUCCESS,$localize`Congratulations, you won!`)]}}function i9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){const t=Gt(e).$implicit;return ba().onPieceClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","piece_",e.x,"_",e.y,""),ha("ngClass",n.getPieceClass(e)),ra("points",n.getHexaCoordsAt(e))}}function s9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",11),Ea("click",function(){const t=Gt(e).$implicit;return ba().onNeighborClick(t)}),fa()}if(2&e){const e=t.$implicit,n=ba();Ia("id","neighbor_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function o9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.chosenLanding.get())}),fa()}if(2&e){const e=ba();Ia("id","chosenLanding_",e.chosenLanding.get().x,"_",e.chosenLanding.get().y,""),ha("ngClass",e.getPlayerClass(e.state.getCurrentPlayer())),ra("points",e.getHexaCoordsAt(e.chosenLanding.get()))}}function a9(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=t.$implicit,n=ba();Ia("id","disconnected_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function l9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",13),Ea("click",function(){Gt(e);const t=ba();return t.onNeighborClick(t.leftCoord.get())}),fa()}if(2&e){const e=ba();Ia("id","leftCoord_",e.leftCoord.get().x,"_",e.leftCoord.get().y,""),ra("points",e.getHexaCoordsAt(e.leftCoord.get()))}}function c9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.lastDrop.get())}),fa()}if(2&e){const e=ba();Ia("id","lastDrop_",e.lastDrop.get().x,"_",e.lastDrop.get().y,""),ra("points",e.getHexaCoordsAt(e.lastDrop.get()))}}function u9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",15),Ea("click",function(){Gt(e);const t=ba();return t.onPieceClick(t.selectedPiece.get())}),fa()}if(2&e){const e=ba();Ia("id","selectedPiece_",e.selectedPiece.get().x,"_",e.selectedPiece.get().y,""),ha("ngClass",e.getSelectedPieceClass()),ra("points",e.getHexaCoordsAt(e.selectedPiece.get()))}}function h9(e,t){if(1&e&&(Cn(),ga(0,"polyline",16)),2&e){const e=t.$implicit,n=ba();Ia("id","victoryCoord_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function d9(e,t){if(1&e){const e=va();Cn(),pa(0,"g",19),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).onPieceClick(t)}),ga(1,"polyline",20),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(1),Ia("id","cuttable_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function p9(e,t){if(1&e&&(Cn(),pa(0,"g",17),la(1,d9,2,3,"g",18),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let f9=(()=>{class e extends iQ{constructor(e){super(e),this.disconnecteds=[],this.cuttableGroups=[],this.leftCoord=yw.empty(),this.lastDrop=yw.empty(),this.selectedPiece=yw.empty(),this.chosenLanding=yw.empty(),this.nextClickShouldSelectGroup=!1,this.rules=new Y7(j7),this.availableMinimaxes=[new Q7(this.rules,"SixMinimax")],this.encoder=Z7.encoder,this.tutorial=(new r9).tutorial,this.SPACE_SIZE=30,this.hexaLayout=new aQ(1.5*this.SPACE_SIZE,new nQ(2*this.SPACE_SIZE,0),uQ.INSTANCE),this.updateBoard()}cancelMoveAttempt(){this.selectedPiece=yw.empty(),this.chosenLanding=yw.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=yw.empty(),this.lastDrop=yw.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}getViewBox(){const e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}mapAbstractCoordToCornerCoords(){const e=this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(e=>this.hexaLayout.getHexaCoordsAt(e));let t=[];for(const n of e)t=t.concat(n);return t}getLimits(e){let t=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;for(const s of e)s.x<r&&(r=s.x),s.y<i&&(i=s.y),t=Math.max(t,s.x),n=Math.max(n,s.y);return{minX:r,minY:i,maxX:t,maxY:n}}showLastMove(){const e=this.rules.node.move.get();this.lastDrop=yw.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?yw.of(e.start.get().getNext(this.state.offset,1)):yw.empty();const t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}getDisconnected(){const e=this.rules.node.mother.get().gameState.pieces.listKeys(),t=this.rules.node.gameState.pieces.listKeys(),n=[];for(const i of e)!1===this.rules.node.move.get().start.equalsValue(i)&&!1===t.some(e=>e.equals(i.getNext(this.state.offset,1)))&&n.push(i.getNext(this.state.offset,1));const r=this.lastDrop.get();return!1===this.pieces.some(e=>e.equals(r))&&!1===t.some(e=>e.equals(r))&&n.push(r),n}getEmptyNeighbors(){let e=Y7.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){const t=this.chosenLanding.get();e=e.filter(e=>!1===e.equals(t))}return e}getPieceClass(e){const t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}onPieceClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#piece_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.state.turn<40)return t.cancelMove(W7.NO_MOVEMENT_BEFORE_TURN_40());if(t.chosenLanding.isAbsent())return t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(hQ.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=yw.of(e),FG.SUCCESS);{const n=Z7.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e);return t.chooseMove(n,t.state)}})()}onNeighborClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#neighbor_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.nextClickShouldSelectGroup)return t.cancelMove(W7.MUST_CUT());if(t.state.turn<40)return t.chooseMove(Z7.fromDrop(e),t.state);if(t.selectedPiece.isAbsent())return t.cancelMove(W7.CAN_NO_LONGER_DROP());{const n=Z7.fromMovement(t.selectedPiece.get(),e),r=Y7.isLegalPhaseTwoMove(n,t.state);return t.neededCutting(r)?(t.chosenLanding=yw.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,FG.SUCCESS):t.chooseMove(n,t.state)}})()}neededCutting(e){return e.isFailure()&&e.getReason()===W7.MUST_CUT()}moveVirtuallyPiece(){const e=this.selectedPiece.get();this.pieces=this.pieces.filter(t=>!1===t.equals(e)),this.neighbors=this.getEmptyNeighbors()}showCuttable(){const e=Z7.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=j7.deplacePiece(this.state,e),n=j7.getGroups(t,e.start.get()),r=Y7.getBiggerGroups(n);this.cuttableGroups=[];for(const i of r)this.cuttableGroups.push(i.toList())}getSelectedPieceClass(){return this.chosenLanding.isPresent()?"moved":"selected"}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-six"]],features:[Go],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,i9,1,4,"polyline",1),la(2,s9,1,3,"polyline",2),la(3,o9,1,4,"polyline",3),la(4,a9,1,3,"polyline",4),la(5,l9,1,3,"polyline",5),la(6,c9,1,3,"polyline",6),la(7,u9,1,4,"polyline",7),la(8,h9,1,3,"polyline",8),la(9,p9,2,1,"g",9),fa()),2&e&&(ra("viewBox",t.viewBox),Ts(1),ha("ngForOf",t.pieces),Ts(1),ha("ngForOf",t.neighbors),Ts(1),ha("ngIf",t.chosenLanding.isPresent()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.leftCoord.isPresent()),Ts(1),ha("ngIf",t.lastDrop.isPresent()),Ts(1),ha("ngIf",t.selectedPiece.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngForOf",t.cuttableGroups))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class g9 extends PX{static of(e,t){return new g9(e,t)}static from(e,t){try{const n=new g9(e,t);return RG.success(n)}catch(n){return RG.failure(n.message)}}getMaximalDistance(){return 9}}g9.encoder=SX.getEncoder(9,9,g9.of);const m9={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:YY.ZERO};class y9 extends AX{static getInitialState(){const e=IX.UNOCCUPIED,t=IX.INVADERS,n=IX.DEFENDERS;return new y9([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,n,e,e,e,e],[t,e,e,e,n,e,e,e,t],[t,t,n,n,IX.PLAYER_ONE_KING,n,n,t,t],[t,e,e,e,n,e,e,e,t],[e,e,e,e,n,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}from(e,t){return new y9(e,t)}}class v9 extends NX{constructor(){super(y9,m9,g9.of)}static get(){return null==v9.singleton&&(v9.singleton=new v9),OQ.ruler=this.singleton,v9.singleton}}const _9=IX.UNOCCUPIED,C9=IX.INVADERS,E9=IX.DEFENDERS,w9=IX.PLAYER_ONE_KING;class S9{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`Tablut is a strategy game that was played by the Vikings.
        The goal of the game is different for each player.
        The attacker plays first. Its pieces (dark) are close to the edges.
        Its goal is to capture the king, which is in the center of the board.
        The defender plays second. Its pieces (light) are in the middle.
        Its goal is to move the king on one of the 4 thrones in the corners.
        Note that the square in which the king starts, in the center of the board, is also a throne.`,y9.getInitialState()),NQ.anyMove($localize`Moving`,$localize`All pieces move the same way.
        Similarly to a rook in chess, a piece can move:
        <ol>
            <li>By as many squares as you want.</li>
            <li>Without going over another piece or stopping on another piece.</li>
            <li>Horizontally or vertically.</li>
            <li>Only the king can land on a throne.</li>
        </ol>
        To move a piece, click on it and then on its landing square.<br/><br/>
        You're playing Dark, do the first move.`,y9.getInitialState(),g9.of(new nQ(4,1),new nQ(1,1)),$localize`Congratulations!`),NQ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new y9([[_9,_9,_9,C9,C9,C9,_9,_9,_9],[_9,_9,_9,_9,C9,_9,_9,_9,_9],[_9,_9,_9,_9,E9,_9,_9,_9,_9],[_9,_9,_9,C9,E9,_9,_9,_9,C9],[C9,C9,E9,E9,w9,E9,E9,C9,C9],[_9,_9,_9,_9,E9,_9,_9,_9,C9],[_9,_9,_9,_9,E9,_9,_9,_9,_9],[_9,_9,_9,_9,C9,_9,_9,_9,_9],[_9,_9,_9,C9,C9,C9,_9,_9,_9]],1),[g9.of(new nQ(2,4),new nQ(2,3)),g9.of(new nQ(4,2),new nQ(3,2))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),NQ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new y9([[_9,_9,_9,C9,C9,C9,_9,_9,_9],[_9,_9,_9,_9,C9,_9,_9,_9,_9],[_9,_9,_9,_9,E9,_9,_9,_9,_9],[_9,_9,E9,_9,w9,_9,E9,_9,C9],[C9,C9,_9,E9,_9,E9,E9,C9,C9],[_9,_9,_9,_9,E9,_9,_9,_9,C9],[_9,_9,_9,_9,E9,_9,_9,_9,_9],[_9,_9,_9,_9,C9,_9,_9,_9,_9],[_9,_9,_9,C9,C9,C9,_9,_9,_9]],12),[g9.of(new nQ(1,4),new nQ(2,4))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),NQ.fromMove($localize`Capturing the king (1/2)`,$localize`To capture the king, two soldiers are not enough.
        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.
        This also works if the king is on the throne.<br/><br/>
        Capture the king.`,new y9([[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,C9,_9,_9,_9,_9,_9,_9,_9],[C9,w9,_9,C9,_9,_9,_9,_9,_9],[_9,C9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9]],72),[g9.of(new nQ(3,4),new nQ(2,4))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),NQ.fromMove($localize`Capturing the king (2/2)`,$localize`Another way to capture the king is to immobilize it against an edge of the board.
        Note that the king cannot be captured next to a throne.<br/><br/>
        Capture the king.`,new y9([[_9,_9,C9,w9,C9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,C9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9],[_9,_9,_9,_9,_9,_9,_9,_9,_9]],72),[g9.of(new nQ(3,3),new nQ(3,1))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function b9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",6),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function P9(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",7),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();ra("transform","translate("+e*n.SPACE_SIZE+" "+t*n.SPACE_SIZE+")")}}function O9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,b9,1,1,"polyline",4),la(2,P9,1,1,"ng-template",null,5,Lu),fa()),2&e){const e=ca(3),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function T9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(3,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(4,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(5,"line",11),Ea("click",function(){Gt(e);const t=ba(2).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(2).index,t=ba().index,n=ba();Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.05*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.2*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.95*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.65*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.4*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.75*n.SPACE_SIZE)}}function I9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",13),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();Ts(1),ra("points",n.getKingPolyline(e,t))}}function k9(e,t){if(1&e){const e=va();Cn(),pa(0,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(1,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(2,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa(),pa(3,"line",11),Ea("click",function(){Gt(e);const t=ba(3).index,n=ba().index;return ba().onClick(t,n)}),fa()}if(2&e){const e=ba(3).index,t=ba().index,n=ba();ra("x1",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.04*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.5*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.96*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.04*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.5*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.96*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.5*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE),Ts(1),ra("x1",n.SPACE_SIZE*e+.85*n.SPACE_SIZE)("y1",n.SPACE_SIZE*t+.15*n.SPACE_SIZE)("x2",n.SPACE_SIZE*e+.15*n.SPACE_SIZE)("y2",n.SPACE_SIZE*t+.85*n.SPACE_SIZE)}}function A9(e,t){if(1&e&&(Cn(),la(0,I9,2,1,"g",9),la(1,k9,4,16,"ng-template",null,12,Lu)),2&e){const e=ca(2),t=ba(2).index,n=ba().index;ha("ngIf",ba().isKing(t,n))("ngIfElse",e)}}function M9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",8),Ea("click",function(){Gt(e);const t=ba().index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,T9,6,20,"g",9),la(3,A9,3,2,"ng-template",null,10,Lu),fa()}if(2&e){const e=ca(4),t=ba().index,n=ba().index,r=ba();Ts(1),ha("ngClass",r.getPieceClasses(t,n)),ra("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("cx",r.SPACE_SIZE*t+.5*r.SPACE_SIZE)("cy",r.SPACE_SIZE*n+.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function N9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=ba().index;return ba().onClick(t,n)}),fa(),la(2,O9,4,2,"g",3),la(3,M9,5,6,"g",3),fa()}if(2&e){const e=t.index,n=ba().index,r=ba();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function x9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,N9,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function R9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",14),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let D9=(()=>{class e extends RX{constructor(e){super(e,!1,g9.from),this.rules=v9.get(),this.availableMinimaxes=[new DX(this.rules,"DummyBot"),new VX(this.rules,"Piece > Influence"),new $X(this.rules,"Piece > Control"),new zX(this.rules,"Escape > Piece > Control")],this.encoder=g9.encoder,this.tutorial=(new S9).tutorial,this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["app-tablut"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",3,"click",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base",3,"click"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base",3,"click"],[1,"base",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["defender",""],[1,"base",3,"click"],["soldierDefender",""],[1,"base","no-fill",3,"click"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,x9,2,1,"g",1),la(2,R9,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[$d,Bd,Hd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class L9{}L9.PLACEMENT_AFTER_INITIAL_PHASE=()=>$localize`You cannot put a new ring after the tenth turn.`,L9.NO_MARKERS_IN_INITIAL_PHASE=()=>$localize`You cannot put a marker in a ring before placing all of your rings.`,L9.MISSING_CAPTURES=G2.MISSING_CAPTURES,L9.MOVE_DIRECTION_INVALID=()=>$localize`The direction of your move is invalid: a move is made along a straight line.`,L9.CAN_ONLY_CAPTURE_YOUR_MARKERS=()=>$localize`You can only capture your own markers.`,L9.SHOULD_SELECT_PLAYER_RING=()=>$localize`You must pick one of your own rings to move.`,L9.SHOULD_END_MOVE_ON_EMPTY_SPACE=()=>$localize`Your ring must land on an empty space.`,L9.MOVE_SHOULD_NOT_PASS_ABOVE_RING=()=>$localize`A ring can only jump over markers or empty spaces, not over another ring.`,L9.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=()=>$localize`Your ring must land on the first empty space after a group of markers.`,L9.AMBIGUOUS_CAPTURE_COORD=G2.AMBIGUOUS_CAPTURE_COORD,L9.CAPTURE_SHOULD_TAKE_RING=()=>$localize`When you capture markers, you must take one of your ring as well by clicking on it.`;class F9{constructor(e,t){this.player=e,this.isRing=t}static of(e,t){return e===KY.NONE?F9.EMPTY:t?F9.RINGS[e.value]:F9.MARKERS[e.value]}equals(e){return this===e}flip(){return zG(!1===this.isRing,"cannot flip a ring (it should never happen)"),zG(this.player.isPlayer(),"cannot flip a non-player piece"),F9.of(this.player.getOpponent(),this.isRing)}toString(){switch(this){case F9.UNREACHABLE:return"NONE";case F9.EMPTY:return"EMPTY";case F9.MARKER_ZERO:return"MARKER_ZERO";case F9.MARKER_ONE:return"MARKER_ONE";case F9.RING_ZERO:return"RING_ZERO";default:return dw.expectToBe(this,F9.RING_ONE),"RING_ONE"}}}F9.encoder=jY.tuple([YY.numberEncoder,jY.booleanEncoder],e=>[e.player,e.isRing],e=>F9.of(e[0],e[1])),F9.UNREACHABLE=new F9(KY.NONE,!1),F9.EMPTY=new F9(KY.NONE,!1),F9.MARKER_ZERO=new F9(YY.ZERO,!1),F9.MARKER_ONE=new F9(YY.ONE,!1),F9.MARKERS=[F9.MARKER_ZERO,F9.MARKER_ONE],F9.RING_ZERO=new F9(YY.ZERO,!0),F9.RING_ONE=new F9(YY.ONE,!0),F9.RINGS=[F9.RING_ZERO,F9.RING_ONE];let U9=(()=>{class e extends b0{constructor(t,n,r){super(r,t,e.SIZE,e.SIZE,[6,4,3,2,1],F9.EMPTY),this.sideRings=n}static getInitialState(){const t=F9.EMPTY,n=F9.UNREACHABLE;return new e([[n,n,n,n,n,n,t,t,t,t,n],[n,n,n,n,t,t,t,t,t,t,t],[n,n,n,t,t,t,t,t,t,t,t],[n,n,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,n,n],[t,t,t,t,t,t,t,t,n,n,n],[t,t,t,t,t,t,t,n,n,n,n],[n,t,t,t,t,n,n,n,n,n,n]],[5,5],0)}isInitialPlacementPhase(){return this.turn<10}countScores(){return this.turn<10?[0,0]:this.sideRings}equals(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&eK.compareTable(this.board,e.board)}getRingCoords(e){const t=[];return this.forEachCoord((n,r)=>{r.isRing&&r.player===e&&t.push(n)}),t}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==F9.UNREACHABLE}setAtUnsafe(t,n){const r=eK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.sideRings,this.turn)}}return e.SIZE=11,e})();class B9 extends V2{constructor(e,t){if(super(e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");this.ringTaken=yw.ofNullable(t)}static of(e,t,n){const r=[],i=oQ.factory.fromMove(e,t).get();for(let s=e;!1===s.equals(t);s=s.getNext(i))r.push(s);return r.push(t),new B9(r,n)}setRingTaken(e){return new B9(this.capturedSpaces,e)}equals(e){return!(!1===super.equals(e)||!1===this.ringTaken.equals(e.ringTaken))}}B9.encoder=new class extends qY{encode(e){return{captured:e.capturedSpaces.map(e=>nQ.encoder.encode(e)),ringTaken:nQ.encoder.encode(e.ringTaken.get())}}decode(e){const t=e;return zG(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new B9(t.captured.map(e=>nQ.encoder.decode(e)),nQ.encoder.decode(t.ringTaken))}};class V9 extends _Q{constructor(e,t,n,r){super(),this.initialCaptures=e,this.start=t,this.end=n,this.finalCaptures=r}isInitialPlacement(){return this.end.isAbsent()}equals(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===eK.compareArray(this.initialCaptures,e.initialCaptures)||!1===eK.compareArray(this.finalCaptures,e.finalCaptures))}toString(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}}V9.coordOptionalEncoder=B2(nQ.encoder),V9.encoder=new class extends WY{encodeMove(e){const t={moveStart:nQ.encoder.encode(e.start),moveEnd:V9.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=B9.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=B9.encoder.encode(e)}),t}decodeMove(e){const t=e;return zG(null!=t.moveStart,"Invalid encoded YinshMove"),new V9(this.decodeArray(t,"initialCapture",B9.encoder.decode),nQ.encoder.decode(t.moveStart),V9.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",B9.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class $9 extends dQ{getBoardValue(e){const t=this.ruler.getGameStatus(e);return t.isEndGame?pQ.fromWinner(t.winner):new pQ(e.gameState.sideRings[0]*YY.ZERO.getScoreModifier()+e.gameState.sideRings[1]*YY.ONE.getScoreModifier())}getListMoves(e){const t=[],n=e.gameState;if(n.isInitialPlacementPhase())for(const[r,i]of n.getCoordsAndContents())i===F9.EMPTY&&t.push(new V9([],r,yw.empty(),[]));else{const e=this.ruler;this.getPossibleCaptureCombinations(n).forEach(r=>{const i=e.applyCaptures(n,r);this.getRingMoves(i).forEach(n=>{const s=e.applyRingMoveAndFlip(i,n.start,n.end);this.getPossibleCaptureCombinations(s).forEach(e=>{const i=new V9(r,n.start,yw.of(n.end),e);t.push(i)})})})}return t}getPossibleCaptureCombinations(e){const t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return W2.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(e=>class{static getCombinations(e,t){return zG(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(e=>this.getPermutations(e)).reduce((e,t)=>e.concat(t))}static getPermutations(e){const t=e.length,n=[e.slice()],r=new Array(t).fill(0);let i=1;for(;i<t;)if(r[i]<i){const t=i%2&&r[i],s=e[i];e[i]=e[t],e[t]=s,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}static getSubsetsOfSize(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];{const i=[];for(;r<=e.length-n;){const s=e[r];for(const e of t(n-1,r+1))e.push(s),i.push(e);++r}return i}}(t,0)}}.getCombinations(n,e.length).map(t=>e.map((e,n)=>new B9(e.capturedSpaces,t[n])))).reduce((e,t)=>e.concat(t),[])}getRingMoves(e){const t=this.ruler,n=[];for(const r of this.getRingCoords(e))for(const i of t.getRingTargets(e,r))n.push({start:r,end:i});return n}getRingCoords(e){const t=e.getCurrentPlayer().value,n=[];return e.forEachCoord((e,r)=>{r===F9.RINGS[t]&&n.push(e)}),n}}class z9 extends IQ{applyLegalMove(e,t,n){return new U9(n.board,n.sideRings,n.turn+1)}applyCaptures(e,t){let n=e;return t.forEach(e=>{n=this.applyCapture(n,e)}),n}applyCapture(e,t){const n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new U9(n,e.sideRings,e.turn),t.ringTaken.get())}takeRing(e,t){const n=e.getCurrentPlayer().value,r=e.setAt(t,F9.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new U9(r,i,e.turn)}applyCaptureWithoutTakingRing(e,t){return t.forEach(t=>{e=e.setAt(t,F9.EMPTY)}),e.board}ringSelectionValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)===F9.RINGS[n]?FG.SUCCESS:FG.failure(L9.CAPTURE_SHOULD_TAKE_RING())}applyRingMoveAndFlip(e,t,n){const r=e.getCurrentPlayer().value;let i=e.setAt(t,F9.MARKERS[r]);i=i.setAt(n,F9.RINGS[r]);const s=oQ.factory.fromMove(t,n).get();for(let o=t.getNext(s);!1===o.equals(n);o=o.getNext(s)){const e=i.getPieceAt(o);e!==F9.EMPTY&&(i=i.setAt(o,e.flip()))}return i}isLegal(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return RG.failure(L9.NO_MARKERS_IN_INITIAL_PHASE());const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();const s=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(s,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();const a=this.applyCaptures(s,e.finalCaptures),l=this.noMoreCapturesValidity(a);return l.isFailure()?l.toFailedFallible():RG.success(a)}initialPlacementValidity(e,t){if(!0!==e.isInitialPlacementPhase())return RG.failure(L9.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==F9.EMPTY)return RG.failure(hQ.MUST_CLICK_ON_EMPTY_SPACE());const n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;const i=e.setAt(t,F9.of(n,!0)).board,s=new U9(i,r,e.turn);return RG.success(s)}moveStartValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==F9.RINGS[n]?FG.failure(L9.SHOULD_SELECT_PLAYER_RING()):FG.SUCCESS}moveValidity(e,t,n){const r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==F9.EMPTY)return FG.failure(L9.SHOULD_END_MOVE_ON_EMPTY_SPACE());const i=oQ.factory.fromMove(t,n);if(i.isFailure())return FG.failure(L9.MOVE_DIRECTION_INVALID());const s=i.get();let o=!1;for(let a=t.getNext(s);!1===a.equals(n);a=a.getNext(s)){const t=e.getPieceAt(a);if(t===F9.EMPTY){if(o)return FG.failure(L9.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(t.isRing)return FG.failure(L9.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return FG.SUCCESS}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=this.applyCapture(n,r)}return FG.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer().value;for(const r of t.capturedSpaces)if(e.getPieceAt(r)!==F9.MARKERS[n])return FG.failure(L9.CAN_ONLY_CAPTURE_YOUR_MARKERS());return e.getPieceAt(t.ringTaken.get())!==F9.RINGS[n]?FG.failure(L9.CAPTURE_SHOULD_TAKE_RING()):FG.SUCCESS}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?FG.SUCCESS:FG.failure(L9.MISSING_CAPTURES())}getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=this.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o,a=i;for(o=i;e.isOnBoard(o);o=o.getNext(s)){const n=e.getPieceAt(o);if(n.player===t&&!1===n.isRing)0===r&&(a=o),r+=1;else{if(r>=5)break;r=0}}return r>=5?yw.of({start:a,end:o,dir:s}):yw.empty()}getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(e=>{for(let t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(B9.of(t,t.getNext(e.dir,4)))}),n}getRingTargets(e,t){const n=[];for(const r of oQ.factory.all){let i=!1;for(let s=t.getNext(r);e.isOnBoard(s);s=s.getNext(r)){const t=e.getPieceAt(s);if(t===F9.EMPTY){if(n.push(s),i)break}else{if(t.isRing)break;i=!0}}}return n}getGameStatus(e){return e.gameState.isInitialPlacementPhase()?TQ.ONGOING:e.gameState.sideRings[0]>=3?TQ.ZERO_WON:e.gameState.sideRings[1]>=3?TQ.ONE_WON:TQ.ONGOING}}const H9=F9.EMPTY,G9=F9.UNREACHABLE,q9=F9.MARKER_ZERO,W9=F9.RING_ZERO,j9=F9.MARKER_ONE,Z9=F9.RING_ONE;let Y9=(()=>{class e{}return e.MUST_ALIGN_FIVE=()=>$localize`Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time.`,e.MUST_CAPTURE_TWO=()=>$localize`Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again.`,e})();class K9{constructor(){this.tutorial=[NQ.informational($localize`Goal of the game`,$localize`The goal at Yinsh is to capture three rings in total.
        The rings taken are shown on the top left for the dark player,
        and on the bottom right for the light player. Here, Dark won the game.
        Note that on the board you have two types of pieces for each player:
        rings (empty circles) and markers (full circles).`,new U9([[G9,G9,G9,G9,G9,G9,H9,H9,H9,H9,G9],[G9,G9,G9,G9,H9,H9,H9,H9,H9,H9,H9],[G9,G9,G9,q9,Z9,H9,H9,H9,H9,H9,H9],[G9,G9,H9,q9,H9,Z9,H9,j9,H9,H9,H9],[G9,H9,W9,j9,H9,H9,Z9,q9,H9,H9,H9],[G9,H9,H9,q9,j9,H9,H9,H9,H9,H9,G9],[H9,H9,H9,q9,H9,H9,H9,Z9,H9,H9,G9],[H9,H9,H9,j9,q9,W9,H9,H9,H9,G9,G9],[H9,H9,H9,H9,H9,H9,H9,H9,G9,G9,G9],[H9,H9,H9,H9,H9,H9,H9,G9,G9,G9,G9],[G9,H9,H9,H9,H9,G9,G9,G9,G9,G9,G9]],[3,1],20)),NQ.anyMove($localize`Initial board and placement phase`,$localize`The initial board is empty.
        At the beginning of the game, each player puts one of its ring on the board at their turn.
        This phase stops when all rings have been placed on the board.
        Put one of your ring on the board by clicking the space where you want to place it.`,new U9(U9.getInitialState().board,[5,5],0),new V9([],new nQ(5,5),yw.empty(),[]),$localize`Congratulations!`),NQ.anyMove($localize`Putting a marker`,$localize`Once the initial phase is done and all rings are on the board, you need to place markers on the board.
        To do so, put a marker in a ring by clicking on that ring.
        Then, the ring must be moved in a straight line, in any direction.
        A ring cannot pass through other rings during its move.
        If it goes over a group of markers, your move must stop at the first empty space after that group.
        All markers in the group are then flipped and their color change.<br/><br/>
        You're playing Dark, do a move.`,new U9([[G9,G9,G9,G9,G9,G9,H9,H9,H9,H9,G9],[G9,G9,G9,G9,H9,H9,H9,H9,H9,H9,H9],[G9,G9,G9,Z9,H9,H9,H9,H9,H9,H9,H9],[G9,G9,Z9,H9,H9,Z9,H9,H9,H9,H9,H9],[G9,H9,W9,j9,H9,H9,Z9,H9,H9,H9,H9],[G9,H9,H9,j9,H9,H9,H9,H9,H9,H9,G9],[H9,H9,H9,H9,W9,H9,H9,Z9,H9,H9,G9],[H9,H9,H9,H9,H9,W9,H9,H9,H9,G9,G9],[H9,H9,H9,W9,H9,H9,H9,G9,G9,G9,G9],[H9,H9,H9,H9,H9,H9,H9,G9,G9,G9,G9],[G9,H9,H9,H9,H9,G9,G9,G9,G9,G9,G9]],[0,0],20),new V9([],new nQ(2,4),yw.of(new nQ(4,4)),[]),$localize`Congratulations!`),NQ.fromPredicate($localize`Getting a ring by aligning 5 markers`,$localize`Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.
        To do so, you need to align 5 markers of your color.
        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.
        You will then have one more point.
        You must capture when you can.<br/><br/>
        You're playing Dark, perform a capture!`,new U9([[G9,G9,G9,G9,G9,G9,H9,H9,H9,H9,G9],[G9,G9,G9,G9,H9,H9,H9,H9,H9,H9,H9],[G9,G9,G9,Z9,H9,H9,H9,H9,H9,H9,H9],[G9,G9,Z9,H9,H9,Z9,H9,H9,H9,H9,H9],[G9,H9,q9,q9,W9,j9,j9,H9,H9,H9,H9],[G9,H9,H9,Z9,H9,H9,H9,H9,H9,H9,G9],[H9,H9,H9,H9,W9,H9,H9,Z9,H9,H9,G9],[H9,H9,H9,H9,H9,W9,H9,H9,H9,G9,G9],[H9,H9,H9,W9,H9,H9,H9,W9,G9,G9,G9],[H9,H9,H9,H9,H9,H9,H9,G9,G9,G9,G9],[G9,H9,H9,H9,H9,G9,G9,G9,G9,G9,G9]],[0,0],20),new V9([],new nQ(4,4),yw.of(new nQ(7,4)),[B9.of(new nQ(2,4),new nQ(6,4),new nQ(7,4))]),(e,t)=>1===t.sideRings[YY.ZERO.value]?FG.SUCCESS:FG.failure(Y9.MUST_ALIGN_FIVE()),$localize`Congratulations!`),NQ.fromPredicate($localize`Compound captures`,$localize`During a turn, you could have to choose between multiple captures,
        or you could even capture multiple times!
        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>
        Here, you can capture two rings, do it!`,new U9([[G9,G9,G9,G9,G9,G9,H9,H9,H9,H9,G9],[G9,G9,G9,G9,W9,H9,H9,Z9,Z9,W9,H9],[G9,G9,G9,W9,H9,H9,j9,Z9,H9,W9,H9],[G9,G9,H9,W9,H9,H9,H9,H9,H9,Z9,H9],[G9,H9,H9,H9,H9,q9,H9,H9,Z9,H9,H9],[G9,H9,H9,H9,q9,q9,H9,j9,H9,H9,G9],[H9,H9,H9,q9,H9,q9,H9,H9,H9,H9,G9],[H9,H9,q9,H9,H9,q9,H9,H9,H9,G9,G9],[H9,q9,H9,H9,H9,q9,H9,H9,G9,G9,G9],[H9,H9,H9,H9,H9,q9,H9,G9,G9,G9,G9],[G9,H9,H9,H9,H9,G9,G9,G9,G9,G9,G9]],[0,0],10),new V9([B9.of(new nQ(5,4),new nQ(1,8),new nQ(3,2)),B9.of(new nQ(5,9),new nQ(5,5),new nQ(3,3))],new nQ(4,1),yw.of(new nQ(4,2)),[]),(e,t)=>2===t.sideRings[YY.ZERO.value]?FG.SUCCESS:FG.failure(Y9.MUST_CAPTURE_TWO()),$localize`Congratulations!`)]}}function J9(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringOuterSize)}}function Q9(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","ring_",t,"_",r,""),ha("ngClass",n.ringClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.ringMidSize)}}function X9(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=ba(2).$implicit,t=ba(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringInnerSize)}}function eee(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=ba(2),t=e.index,n=e.$implicit,r=ba().index,i=ba();Ia("id","marker_",t,"_",r,""),ha("ngClass",n.markerClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.markerSize)}}function tee(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba(2).onClick(t.coord)}),ga(1,"polyline",4),pa(2,"g",5),la(3,J9,1,3,"circle",6),la(4,Q9,1,6,"circle",7),la(5,X9,1,3,"circle",6),la(6,eee,1,6,"circle",8),fa(),fa()}if(2&e){const e=ba(),t=e.index,n=e.$implicit,r=ba().index;Ia("id","click_",t,"_",r,""),Ts(1),Ia("id","space_",t,"_",r,""),ha("ngClass",n.spaceClasses),ra("points",n.coordinates),Ts(1),Ia("id","pieceGroup_",t,"_",r,""),ha("ngClass",n.removedClass),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isMarker)}}function nee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,tee,7,13,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",null!=e)}}function ree(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,nee,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function iee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",12),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),Ia("id","selected_",e.x,"_",e.y,""),ra("points",n.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function see(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=ba().$implicit;return ba().onClick(t)}),fa()}if(2&e){const e=ba().$implicit,t=ba();Ia("id","selectable_",e.x,"_",e.y,""),ra("points",t.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function oee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,see,1,3,"polyline",13),fa()),2&e){const e=ba();Ts(1),ha("ngIf",e.isPlayerTurn())}}function aee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",15),Ea("click",function(){const t=Gt(e).$implicit;return ba().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=ba();Ts(1),ra("x",n.viewInfo.spaceInfo[e.y][e.x].center.x-n.viewInfo.indicatorSize/2)("y",n.viewInfo.spaceInfo[e.y][e.x].center.y-n.viewInfo.indicatorSize/2)("width",n.viewInfo.indicatorSize)("height",n.viewInfo.indicatorSize)}}function lee(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),ga(2,"circle",9),ga(3,"circle",17),fa()),2&e){const e=t.index,n=ba().$implicit,r=ba();Ts(1),Ia("id","player_",n,"_sideRing_",e+1,""),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringOuterSize),Ts(1),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringInnerSize),Ts(1),ha("ngClass",r.viewInfo.sideRingClass[n]),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringMidSize)}}const cee=function(){return[]};function uee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,lee,4,12,"g",1),fa()),2&e){const e=t.$implicit,n=ba();Ts(1),ha("ngForOf",lu(1,cee).constructor(n.viewInfo.sideRings[e]))}}const hee=function(){return[0,1]};class dee extends iQ{constructor(e){super(e),this.movePhase="MOVE_START",this.moveStart=yw.empty(),this.moveEnd=yw.empty(),this.currentlyMoved=[],this.currentCapture=yw.empty(),this.initialCaptures=[],this.finalCaptures=[],this.possibleCaptures=[],this.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:dee.MARKER_SIZE,ringOuterSize:dee.RING_OUTER_SIZE,ringMidSize:dee.RING_MID_SIZE,ringInnerSize:dee.RING_INNER_SIZE,indicatorSize:dee.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},this.scores=yw.of([0,0]),this.rules=new z9(U9),this.availableMinimaxes=[new $9(this.rules,"YinshMinimax")],this.encoder=V9.encoder,this.tutorial=(new K9).tutorial,this.hexaLayout=new aQ(1.5*dee.RING_OUTER_SIZE,new nQ(2*dee.RING_OUTER_SIZE,0),uQ.INSTANCE),this.constructedState=this.rules.node.gameState,this.constructedState.allCoords().forEach(e=>{null==this.viewInfo.spaceInfo[e.y]&&(this.viewInfo.spaceInfo[e.y]=[]),this.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:this.getHexaCoordsAt(e),center:this.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}})}updateBoard(){this.cancelMoveAttempt(),this.scores=yw.of(this.rules.node.gameState.countScores())}updateViewInfo(){this.constructedState.allCoords().forEach(e=>{this.viewInfo.spaceInfo[e.y][e.x].spaceClasses=this.getSpaceClasses(e);const t=this.constructedState.getPieceAt(e);this.viewInfo.spaceInfo[e.y][e.x].removedClass="",this.setRingInfo(e,t),this.setMarkerInfo(e,t)});for(const e of YY.PLAYERS)this.viewInfo.sideRings[e.value]=this.constructedState.sideRings[e.value];switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];for(const e of this.possibleCaptures)for(const t of e.capturedSpaces)this.viewInfo.selectableCoords.push(t);break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}showCurrentMoveCaptures(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());for(const e of this.initialCaptures)this.markCurrentCapture(e);for(const e of this.finalCaptures)this.markCurrentCapture(e)}getSpaceClasses(e){return this.currentlyMoved.some(t=>t.equals(e))?["moved"]:[]}setRingInfo(e,t){if(t.isRing){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}setMarkerInfo(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==F9.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=yw.empty(),this.moveStart=yw.empty(),this.moveEnd=yw.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}showLastMove(){const e=this.rules.node.move;if(e.isPresent()){const t=e.get();if(t.isInitialPlacement())this.viewInfo.spaceInfo[t.start.y][t.start.x].spaceClasses=["moved"];else{for(const n of this.coordsBetween(t.start,t.end.get()))this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["moved"];const e=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();t.initialCaptures.forEach(t=>this.showLastMoveCapture(t,e)),t.finalCaptures.forEach(t=>this.showLastMoveCapture(t,e))}}}coordsBetween(e,t){const n=[],r=oQ.factory.fromMove(e,t).get();for(let i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==F9.EMPTY&&n.push(i),n.push(t);return n}showLastMoveCapture(e,t){for(const n of e.capturedSpaces)this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["captured"],t&&this.markRemovedMarker(n,this.rules.node.gameState.getCurrentPlayer().getOpponent());this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}moveToInitialCaptureOrMovePhase(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),FG.SUCCESS}onClick(e){var t=this;return hw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());switch(t.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_FIRST":return t.selectCaptureFirstCoord(e);case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_LAST":return t.selectCaptureLastCoord(e);case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":return t.selectRing(e);case"MOVE_START":return t.selectMoveStart(e);case"MOVE_END":return t.selectMoveEnd(e)}})()}selectCaptureFirstCoord(e){var t=this;return hw(function*(){const n=[];if(t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1)t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(n);else{if(0===n.length)return t.cancelMove(L9.MISSING_CAPTURES());t.selectCapture(n[0])}return FG.SUCCESS})()}moveToCaptureSelectLast(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;for(const t of e)for(const e of t.capturedSpaces)this.viewInfo.selectableCoords.push(e);switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}selectCaptureLastCoord(e){var t=this;return hw(function*(){const n=[];return t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1?t.cancelMove(L9.AMBIGUOUS_CAPTURE_COORD()):0===n.length?t.cancelMove(L9.MISSING_CAPTURES()):t.selectCapture(n[0])})()}selectCapture(e){switch(this.currentCapture=yw.of(e),this.constructedState=new U9(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),FG.SUCCESS}markCurrentCapture(e){for(const t of e.capturedSpaces)this.viewInfo.selectedCoords.push(t),this.markRemovedMarker(t,this.rules.node.gameState.getCurrentPlayer());e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}markRemovedMarker(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setMarkerInfo(e,F9.MARKERS[t.value])}markRemovedRing(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="transparent",this.setRingInfo(e,F9.RINGS[t.value])}selectRing(e){var t=this;return hw(function*(){const n=t.rules.ringSelectionValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.constructedState=t.rules.takeRing(t.constructedState,e);const r=t.currentCapture.get().setRingTaken(e);switch(t.currentCapture=yw.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase){case"INITIAL_CAPTURE_SELECT_RING":return t.initialCaptures.push(r),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),FG.SUCCESS);default:return dw.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(r),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),FG.SUCCESS)}})()}moveToMovePhase(){return this.movePhase="MOVE_START",this.updateViewInfo(),FG.SUCCESS}tryMove(){var e=this;return hw(function*(){const t=new V9(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures);return yield e.chooseMove(t,e.rules.node.gameState,e.scores.get())})()}selectMoveStart(e){var t=this;return hw(function*(){if(t.constructedState.isInitialPlacementPhase()){const n=t.rules.initialPlacementValidity(t.constructedState,e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveStart=yw.of(e),t.tryMove())}{const n=t.rules.moveStartValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.moveStart=yw.of(e),t.movePhase="MOVE_END",t.updateViewInfo()}return FG.SUCCESS})()}selectMoveEnd(e){var t=this;return hw(function*(){const n=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveEnd=yw.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove())})()}moveToFinalCapturePhaseOrTryMove(){var e=this;return hw(function*(){return e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),FG.SUCCESS)})()}}function pee(e,t){if(1&e&&(pa(0,"option",5),Fa(1),fa()),2&e){const e=t.$implicit;ha("value",e.urlName),Ts(1),Ua(e.name)}}dee.RING_OUTER_SIZE=40,dee.RING_MID_SIZE=34,dee.RING_INNER_SIZE=28,dee.MARKER_SIZE=dee.RING_INNER_SIZE,dee.INDICATOR_SIZE=10,dee.\u0275fac=function(e){return new(e||dee)(ua(VG))},dee.\u0275cmp=Xe({type:dee,selectors:[["app-yinsh"]],features:[Go],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,ree,2,1,"g",1),la(2,iee,2,3,"g",1),la(3,oee,2,1,"g",1),la(4,aee,2,4,"g",1),la(5,uee,2,2,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.spaceInfo),Ts(1),ha("ngForOf",t.viewInfo.selectedCoords),Ts(1),ha("ngForOf",t.viewInfo.selectableCoords),Ts(1),ha("ngForOf",t.viewInfo.targets),Ts(1),ha("ngForOf",lu(5,hee)))},directives:[$d,Hd,Bd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--background-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--background-fill)}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-big-vcenter[_ngcontent-%COMP%]{dy:17}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-small[_ngcontent-%COMP%]{font:20 sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let fee=(()=>{class e{}return e.ABALONE=()=>$localize`Use simple mechanics to push 6 of the opponent's pieces out of the board!`,e.APAGOS=()=>$localize`Very simple game, but, will you be able to win everytime?`,e.AWALE=()=>$localize`The international version of the famous African strategy game!`,e.BRANDHUB=()=>$localize`The Irish version of the Tafl game family!`,e.COERCEO=()=>$localize`Get rid of all of your opponent's pieces on a board that shrinks little by little!`,e.CONSPIRATEURS=()=>$localize`Hide all of your pieces before your opponent does, or risk to be discovered!`,e.DIAM=()=>$localize`Drop your pieces and move them around to align two pieces of the same color across the board to win!`,e.DVONN=()=>$localize`Stack your pieces and control as many stacks as you can to win!`,e.ENCAPSULE=()=>$localize`An enhanced tic-tac-toe where piece can encapsule other and prevent them to win.`,e.EPAMINONDAS=()=>$localize`An antiquity-war inspired game. Be the first to pierce your opponent's lines!`,e.GIPF=()=>$localize`A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!`,e.GO=()=>$localize`The oldest strategy game still practiced widely. A territory control game.`,e.KAMISADO=()=>$localize`Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!`,e.LINES_OF_ACTION=()=>$localize`Regroup your pieces to win. But your possible moves will often change!`,e.LODESTONE=()=>$localize`Push and crush your opponent's pieces using magnetic forces!`,e.P4=()=>$localize`The classical 4 in a row game!`,e.PENTAGO=()=>$localize`Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!`,e.PYLOS=()=>$localize`Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!`,e.QUARTO=()=>$localize`Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!`,e.QUIXO=()=>$localize`Align 5 of your pieces on a board where pieces slide!`,e.REVERSI=()=>$localize`Sandwich your opponent's pieces to dominate the board!`,e.SAHARA=()=>$localize`Immobilize one of your opponent's pyramids before your opponent does!`,e.SIAM=()=>$localize`Be the first to push a mountain out of the board!`,e.SIX=()=>$localize`Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!`,e.TABLUT=()=>$localize`The Viking board game! Invaders must capture the king, defender must make him escape!`,e.YINSH=()=>$localize`Align your pieces to score points, but beware, pieces can flip!`,e})(),gee=(()=>{class e{constructor(e,t,n,r,i,s=!0){this.name=e,this.urlName=t,this.component=n,this.creationDate=r,this.description=i,this.display=s}}return e.ALL_GAMES=()=>[new e("MinimaxTesting","MinimaxTesting",_5,new Date("1970-01-01"),"",!1),new e($localize`Four in a Row`,"P4",R5,new Date("2018-08-28"),fee.P4()),new e($localize`Awal`,"Awale",wX,new Date("2018-11-29"),fee.AWALE()),new e($localize`Quarto`,"Quarto",f8,new Date("2018-12-09"),fee.QUARTO()),new e($localize`Tablut`,"Tablut",D9,new Date("2018-12-27"),fee.TABLUT()),new e($localize`Reversi`,"Reversi",H8,new Date("2019-01-16"),fee.REVERSI()),new e($localize`Go`,"Go",L3,new Date("2019-12-21"),fee.GO()),new e($localize`Encapsule`,"Encapsule",w2,new Date("2019-12-30"),fee.ENCAPSULE()),new e($localize`Siam`,"Siam",q7,new Date("2020-01-11"),fee.SIAM()),new e($localize`Sahara`,"Sahara",l7,new Date("2020-02-29"),fee.SAHARA()),new e($localize`Pylos`,"Pylos",S6,new Date("2020-10-02"),fee.PYLOS()),new e($localize`Kamisado`,"Kamisado",g4,new Date("2020-10-03"),fee.KAMISADO()),new e($localize`Quixo`,"Quixo",k8,new Date("2020-10-15"),fee.QUIXO()),new e($localize`Dvonn`,"Dvonn",Q0,new Date("2020-10-21"),fee.DVONN()),new e($localize`Epaminondas`,"Epaminondas",U2,new Date("2021-01-16"),fee.EPAMINONDAS()),new e($localize`Gipf`,"Gipf",l3,new Date("2021-02-22"),fee.GIPF()),new e($localize`Coerceo`,"Coerceo",R1,new Date("2021-03-21"),fee.COERCEO()),new e($localize`Six`,"Six",f9,new Date("2021-04-08"),fee.SIX()),new e($localize`Lines of Action`,"LinesOfAction",k4,new Date("2021-04-28"),fee.LINES_OF_ACTION()),new e($localize`Pentago`,"Pentago",e6,new Date("2021-05-23"),fee.PENTAGO()),new e($localize`Abalone`,"Abalone",JQ,new Date("2021-07-13"),fee.ABALONE()),new e($localize`Yinsh`,"Yinsh",dee,new Date("2021-07-31"),fee.YINSH()),new e($localize`Apagos`,"Apagos",dX,new Date("2021-11-04"),fee.APAGOS()),new e($localize`Diam`,"Diam",w0,new Date("2021-11-30"),fee.DIAM()),new e($localize`Brandhub`,"Brandhub",s1,new Date("2021-12-07"),fee.BRANDHUB()),new e($localize`Conspirateurs`,"Conspirateurs",t0,new Date("2021-12-30"),fee.CONSPIRATEURS()),new e($localize`Lodestone`,"Lodestone",l5,new Date("2022-03-18"),fee.LODESTONE())].sort((e,t)=>e.name.localeCompare(t.name)),e})(),mee=(()=>{class e{constructor(){this.games=gee.ALL_GAMES().filter(e=>!0===e.display),this.pickGame=new Cu}onChange(e){this.pickGame.emit(e.target.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){let e;return e=$localize`Pick a game`,[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],e,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"select",1),Ea("change",function(e){return t.onChange(e)}),pa(2,"option",2),ql(3,3),fa(),la(4,pee,2,2,"option",4),fa(),fa()),2&e&&(Ts(4),ha("ngForOf",t.games))},directives:[hg,gg,$d],encapsulation:2}),e})();function yee(e,t){if(1&e){const e=va();pa(0,"div",26),pa(1,"div",27),Ea("click",function(){return Gt(e),ba().closeInfo()}),fa(),pa(2,"div",28),pa(3,"header",29),pa(4,"p",30),Fa(5),fa(),pa(6,"button",31),Ea("click",function(){return Gt(e),ba().closeInfo()}),fa(),fa(),pa(7,"section",32),pa(8,"div",6),pa(9,"div",33),pa(10,"p",34),ga(11,"img",35),fa(),fa(),pa(12,"div",7),pa(13,"div",13),Fa(14),fa(),fa(),fa(),pa(15,"div",6),pa(16,"div",33),pa(17,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createGame(t.gameInfoDetails.get().urlName)}),ga(18,"fa-icon",37),Fa(19,"\xa0"),pa(20,"span"),ql(21,38),fa(),fa(),fa(),pa(22,"div",33),pa(23,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createLocalGame(t.gameInfoDetails.get().urlName)}),ga(24,"fa-icon",37),Fa(25,"\xa0"),pa(26,"span"),ql(27,39),fa(),fa(),fa(),pa(28,"div",33),pa(29,"a",36),Ea("click",function(){Gt(e);const t=ba();return t.createTutorial(t.gameInfoDetails.get().urlName)}),ga(30,"fa-icon",37),Fa(31,"\xa0"),pa(32,"span"),ql(33,40),fa(),fa(),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba();Ts(5),Ua(e.gameInfoDetails.get().name),Ts(6),Ia("src","assets/images/",e.theme,"/",e.gameInfoDetails.get().urlName,".png",_i),Ts(3),Ba(" ",e.gameInfoDetails.get().description," "),Ts(4),ha("icon",e.iconOnlineGame),Ts(6),ha("icon",e.iconLocalGame),Ts(6),ha("icon",e.iconTutorial)}}function vee(e,t){if(1&e){const e=va();pa(0,"div",8),pa(1,"div",9),pa(2,"p",10),Fa(3),fa(),fa(),pa(4,"div",42),pa(5,"figure",34),pa(6,"img",43),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),fa(),pa(7,"figcaption",44),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).openInfo(t)}),pa(8,"div",45),Fa(9,"?"),fa(),fa(),pa(10,"figcaption",46),pa(11,"a",47),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createGame(t.urlName)}),ga(12,"fa-icon",37),fa(),pa(13,"a",48),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createLocalGame(t.urlName)}),ga(14,"fa-icon",37),fa(),pa(15,"a",49),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).createTutorial(t.urlName)}),ga(16,"fa-icon",37),fa(),fa(),fa(),fa(),pa(17,"div",50),Fa(18),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(2);Ts(3),Ua(e.name),Ts(3),Ta("id","image_",e.urlName,""),Ia("src","assets/images/",n.theme,"/",e.urlName,".png",_i),Ts(5),Ta("id","playOnline_",e.urlName,""),Ts(1),ha("icon",n.iconOnlineGame),Ts(1),Ta("id","playLocally_",e.urlName,""),Ts(1),ha("icon",n.iconLocalGame),Ts(1),Ta("id","startTutorial_",e.urlName,""),Ts(1),ha("icon",n.iconTutorial),Ts(2),Ba(" ",e.description," ")}}function _ee(e,t){if(1&e&&(pa(0,"div",7),la(1,vee,19,11,"div",41),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let Cee=(()=>{class e{constructor(e,t){this.router=e,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=hK,this.iconLocalGame=cK,this.iconTutorial=aK,this.gameInfoDetails=yw.empty(),this.theme=t.getTheme();const n=gee.ALL_GAMES().filter(e=>!0===e.display);let r=0;for(let i=0;i<n.length;i++)i<this.numberOfColumns&&this.games.push([]),this.games[r].push(n[i]),r=(r+1)%this.numberOfColumns}createGame(e){var t=this;return hw(function*(){return t.router.navigate(["/play",e])})()}createLocalGame(e){var t=this;return hw(function*(){return t.router.navigate(["/local",e])})()}createTutorial(e){return this.router.navigate(["/tutorial",e])}openInfo(e){this.gameInfoDetails=yw.of(e)}closeInfo(){this.gameInfoDetails=yw.empty()}}return e.\u0275fac=function(t){return new(t||e)(ua(e_),ua(oK))},e.\u0275cmp=Xe({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`EveryBoard`,t=$localize`EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.${"\ufffd#6\ufffd\ufffd/#6\ufffd"}:LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn.`,n=$localize`Play online`,r=$localize`Create an online game`,i=$localize`See the game list`,s=$localize`Play offline`,o=$localize`Play`,a=$localize`Learn`,l=$localize`Play online`,c=$localize`Play offline`,u=$localize`Learn the rules`,h=$localize`Play online`,d=$localize`Play offline`,p=$localize`Learn the rules`,[[1,"hero"],[1,"hero-body"],[1,"title"],e,[1,"subtitle"],t,[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],n,[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],r,["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],i,s,[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],o,["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],a,["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],l,c,u,["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",h,1,"button",3,"id","click"],["data-tooltip",d,1,"button",3,"id","click"],["data-tooltip",p,1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(pa(0,"section",0),pa(1,"div",1),pa(2,"p",2),ql(3,3),fa(),pa(4,"p",4),Hl(5,5),ga(6,"br"),Gl(),fa(),fa(),pa(7,"div",6),pa(8,"div",7),pa(9,"div",8),pa(10,"header",9),pa(11,"p",10),ql(12,11),fa(),fa(),pa(13,"div",12),pa(14,"div",13),pa(15,"button",14),ql(16,15),fa(),pa(17,"button",16),ql(18,17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",7),pa(20,"div",8),pa(21,"header",9),pa(22,"p",10),ql(23,18),fa(),fa(),pa(24,"div",12),pa(25,"div",19),pa(26,"button",20),ql(27,21),fa(),pa(28,"button",22),ql(29,23),fa(),fa(),fa(),fa(),fa(),fa(),la(30,yee,34,7,"div",24),pa(31,"div",6),la(32,_ee,2,1,"div",25),fa(),fa()),2&e&&(Ts(30),ha("ngIf",t.gameInfoDetails.isPresent()),Ts(2),ha("ngForOf",t.games))},directives:[n_,Hd,$d,FJ],encapsulation:2}),e})(),Eee=(()=>{class e{constructor(e){this.element=e}ngAfterViewInit(){this.element.nativeElement.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(cc))},e.\u0275dir=st({type:e,selectors:[["","autofocus",""]]}),e})(),wee=(()=>{class e{constructor(e){this.shown=!1,this.input=e.nativeElement.parentNode.previousSibling,e.nativeElement.addEventListener("click",e=>{this.toggle()})}toggle(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(cc))},e.\u0275dir=st({type:e,selectors:[["","toggleVisibility",""]]}),e})();function See(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),ql(2,31),fa(),pa(3,"div",32),Fa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ua(e.errorMessage)}}const bee=function(){return["/register"]},Pee=function(){return["/reset-password"]};let Oee=(()=>{class e{constructor(e,t){this.router=e,this.connectedUserService=t,this.faEye=uK,this.loginForm=new qf({email:new Gf,password:new Gf})}ngOnInit(){var e=this;this.connectedUserService.getUserObs().subscribe(function(){var t=hw(function*(t){t!==VY.NOT_CONNECTED&&(yield e.redirect())});return function(e){return t.apply(this,arguments)}}())}loginWithEmail(e){var t=this;return hw(function*(){const n=yield t.connectedUserService.doEmailLogin(e.email,e.password);n.isFailure()&&(t.errorMessage=n.getReason())})()}loginWithGoogle(){var e=this;return hw(function*(){const t=yield e.connectedUserService.doGoogleLogin();t.isFailure()&&(e.errorMessage=t.getReason())})()}redirect(){var e=this;return hw(function*(){return e.router.navigate(["/lobby"])})()}canLogin(){return!(""===(this.loginForm.value.email??"")||""===(this.loginForm.value.password??""))}}return e.\u0275fac=function(t){return new(t||e)(ua(e_),ua($Y))},e.\u0275cmp=Xe({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h;return e=$localize`Log in`,t=$localize`Email`,n=$localize`Email`,r=$localize`Password`,i=$localize`Password`,s=$localize`Log in`,o=$localize`Log in with Google`,a=$localize`No account?`,l=$localize`Register`,c=$localize`Forgot your password?`,u=$localize`Reset your password`,h=$localize`Connection error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",n,"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],r,[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",i,"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],s,["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],o,["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],a,[3,"routerLink"],l,c,u,["role","alert",1,"message","is-danger"],[1,"message-header"],h,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),ql(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),ql(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),fa(),fa(),fa(),fa(),pa(12,"div",4),pa(13,"div",5),pa(14,"label",12),ql(15,13),fa(),fa(),pa(16,"div",8),pa(17,"div",9),pa(18,"div",14),ga(19,"input",15),pa(20,"span",16),ga(21,"fa-icon",17),fa(),fa(),fa(),fa(),fa(),pa(22,"div",4),ga(23,"div",5),pa(24,"div",8),pa(25,"div",9),pa(26,"div",10),pa(27,"button",18),Ea("click",function(){return t.loginWithEmail(t.loginForm.value)}),ql(28,19),fa(),fa(),fa(),fa(),fa(),pa(29,"div",4),ga(30,"div",5),pa(31,"div",8),pa(32,"div",9),pa(33,"div",10),pa(34,"button",20),Ea("click",function(){return t.loginWithGoogle()}),ql(35,21),fa(),fa(),fa(),fa(),fa(),la(36,See,5,1,"div",22),pa(37,"p",23),ma(38),ql(39,24),ya(),Fa(40,"\xa0 "),pa(41,"a",25),ql(42,26),fa(),fa(),pa(43,"p",23),ma(44),ql(45,27),ya(),Fa(46,"\xa0 "),pa(47,"a",25),ql(48,28),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.loginForm),Ts(18),ha("icon",t.faEye),Ts(6),ha("disabled",!t.canLogin()),Ts(9),ha("ngIf",t.errorMessage),Ts(5),ha("routerLink",lu(6,bee)),Ts(6),ha("routerLink",lu(7,Pee)))},directives:[Xf,Ef,sg,Hp,Cf,ag,Eee,yg,FJ,wee,Hd,r_],encapsulation:2}),e})(),Tee=(()=>{class e{constructor(e){this.partDAO=e,this.unsubscribe=yw.empty(),this.activePartsBS=new am([]),this.activePartsObs=this.activePartsBS.asObservable()}getActivePartsObs(){return this.activePartsObs}startObserving(){zG(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");const e=new YG(e=>{const t=this.activePartsBS.value.concat(...e);this.activePartsBS.next(t)},e=>{const t=this.activePartsBS.value;for(const n of e)t.forEach(e=>{e.id===n.id&&(e.data=n.data)});this.activePartsBS.next(t)},e=>{const t=[];for(const n of this.activePartsBS.value)e.some(e=>e.id===n.id)||t.push(n);this.activePartsBS.next(t)});this.unsubscribe=yw.of(this.partDAO.observeActiveParts(e))}stopObserving(){zG(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=yw.empty()}}return e.\u0275fac=function(t){return new(t||e)(Or(qG))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),Iee=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}navigateToOnlineGameCreation(){var e=this;return hw(function*(){yield e.router.navigate(["/play",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(e_))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Create an online game`,[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.navigateToOnlineGameCreation()}),ql(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[mee],encapsulation:2}),e})(),kee=(()=>{class e{transform(e){return Cd(1e3*e.seconds,"HH:mm:ss","en-US")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"firebaseDate",type:e,pure:!0}),e})();const Aee=["chatDiv"];function Mee(e,t){1&e&&(ma(0),ql(1,5),ya())}function Nee(e,t){1&e&&ql(0,6),2&e&&(Wl(ba().unreadMessagesText),jl(0))}function xee(e,t){if(1&e){const e=va();pa(0,"button",11),Ea("click",function(){return Gt(e),ba(2).scrollToBottom()}),Fa(1),fa()}if(2&e){const e=ba(2);Ts(1),Ba("",e.unreadMessagesText," \u2193")}}function Ree(e,t){if(1&e&&(pa(0,"p"),Fa(1),gu(2,"firebaseDate"),pa(3,"b",12),Fa(4),fa(),pa(5,"span",13),Fa(6),fa(),fa()),2&e){const e=t.$implicit;Ts(1),Ba(" [",mu(2,3,e.postedTime),"] "),Ts(3),Ba("",e.sender.name," : "),Ts(2),Ua(e.content)}}function Dee(e,t){if(1&e){const e=va();pa(0,"div"),la(1,xee,2,1,"button",7),pa(2,"div",8,9),Ea("scroll",function(){return Gt(e),ba().updateCurrentScrollPosition()}),la(4,Ree,7,5,"p",10),fa(),fa()}if(2&e){const e=ba();Ts(1),ha("ngIf",e.showUnreadMessagesButton),Ts(3),ha("ngForOf",e.chat)}}const Lee=function(){return{standalone:!0}};function Fee(e,t){if(1&e){const e=va();pa(0,"form",14),Ea("onSubmit",function(){return Gt(e),ba().sendMessage()}),pa(1,"div",15),pa(2,"div",16),pa(3,"input",17,18),Ea("ngModelChange",function(t){return Gt(e),ba().userMessage=t}),fa(),pa(5,"p",19),Fa(6),fa(),fa(),pa(7,"div",20),pa(8,"button",21),Ea("click",function(){return Gt(e),ba().sendMessage()}),ga(9,"fa-icon",22),fa(),fa(),fa(),pa(10,"div",23),pa(11,"p"),pa(12,"strong"),ql(13,24),fa(),fa(),fa(),fa()}if(2&e){const e=ca(4),t=ba();Ts(3),ha("ngModel",t.userMessage)("ngModelOptions",lu(4,Lee)),Ts(3),Ba("",e.value.length,"/128"),Ts(3),ha("icon",t.faReply)}}let Uee=(()=>{class e{constructor(t,n){this.chatService=t,this.connectedUserService=n,this.userMessage="",this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=dK,this.isNearBottom=!0,this.notYetScrolled=!0,pw(e.VERBOSE,"ChatComponent constructor")}ngOnInit(){pw(e.VERBOSE,`ChatComponent.ngOnInit for chat ${this.chatId}`),zG(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.loadChatContent()}ngAfterViewChecked(){this.scrollToBottomIfNeeded()}loadChatContent(){const e=e=>{this.updateMessages(e.flatMap(e=>null==e.data.postedTime?[]:[e.data]))},t=new YG(e,e,()=>{});this.chatService.startObserving(this.chatId,t)}updateMessages(e){this.chat=this.chat.concat(e);const t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}updateUnreadMessagesText(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize`no new message`,this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize`1 new message`:$localize`${e} new messages`}scrollToBottomIfNeeded(){this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}updateCurrentScrollPosition(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}scrollToBottom(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}scrollTo(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}sendMessage(){var e=this;return hw(function*(){const t=e.userMessage;e.userMessage="";const n=e.connectedUserService.user.get().toMinimalUser();yield e.chatService.sendMessage(n,t,e.turn)})()}ngOnDestroy(){this.chatService.stopObserving()}switchChatVisibility(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(ZG),ua($Y))},e.\u0275cmp=Xe({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&xu(Aee,5),2&e){let e;Nu(e=Ru())&&(t.chatDiv=e.first)}},inputs:{chatId:"chatId",turn:"turn"},decls:7,vars:4,consts:function(){let e,t,n,r;return e=$localize`Hide chat`,t=$localize`Show chat (${"\ufffd0\ufffd"}:INTERPOLATION:)`,n=$localize`Type your message here`,r=$localize`Be polite`,[["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],e,t,["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],[1,"chat-sender"],[1,"chat-message"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",n,"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],[1,"clickable-icon",3,"icon"],[1,"content","is-small"],r]},template:function(e,t){if(1&e&&(pa(0,"div"),pa(1,"button",0),Ea("click",function(){return t.switchChatVisibility()}),la(2,Mee,2,0,"ng-container",1),la(3,Nee,1,1,"ng-template",null,2,Lu),fa(),la(5,Dee,5,2,"div",3),la(6,Fee,14,5,"form",4),fa()),2&e){const e=ca(4);Ts(2),ha("ngIf",t.visible)("ngIfElse",e),Ts(3),ha("ngIf",t.visible),Ts(1),ha("ngIf",t.visible)}},directives:[Hd,$d,Xf,Ef,Yf,Hp,_g,Cf,Qf,FJ],pipes:[kee],encapsulation:2}),e})();function Bee(e,t){if(1&e&&(ma(0),Fa(1),ya()),2&e){const e=ba().$implicit;Ts(1),Ua(e.data.playerOne)}}function Vee(e,t){1&e&&(ma(0),ql(1,26),ya())}function $ee(e,t){if(1&e){const e=va();pa(0,"tr",22),Ea("click",function(){const t=Gt(e).$implicit;return ba(2).joinGame(t.id,t.data.typeGame)}),pa(1,"td",23),Fa(2),fa(),pa(3,"td",23),Fa(4),fa(),pa(5,"td",23),la(6,Bee,2,1,"ng-container",24),la(7,Vee,2,0,"ng-template",null,25,Lu),fa(),pa(9,"td",23),Fa(10),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(8);Ta("id","part_",n,""),Ts(2),Ua(e.data.typeGame),Ts(2),Ua(e.data.playerZero),Ts(2),ha("ngIf",e.data.playerOne)("ngIfElse",r),Ts(4),Ua(e.data.turn)}}function zee(e,t){if(1&e&&(pa(0,"div",13),pa(1,"div",14),pa(2,"table",15),pa(3,"thead"),pa(4,"tr"),pa(5,"th",16),ql(6,17),fa(),pa(7,"th",16),ql(8,18),fa(),pa(9,"th",16),ql(10,19),fa(),pa(11,"th",16),ql(12,20),fa(),fa(),fa(),pa(13,"tbody"),la(14,$ee,11,6,"tr",21),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(14),ha("ngForOf",e.activeParts)}}function Hee(e,t){1&e&&(pa(0,"div",27),ga(1,"app-online-game-selection",28),fa())}function Gee(e,t){if(1&e&&(pa(0,"li",39),Fa(1),gu(2,"firebaseDate"),fa()),2&e){const e=ba().$implicit;Oa("id",e.data.username),Ts(1),Va("",e.data.username,": ",mu(2,3,e.data.last_changed),"")}}function qee(e,t){if(1&e&&(ma(0),la(1,Gee,3,5,"li",38),ya()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",e.data.last_changed)}}function Wee(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),pa(2,"div",31),ga(3,"app-chat",32),fa(),fa(),pa(4,"div",33),pa(5,"div",34),pa(6,"p"),ql(7,35),fa(),pa(8,"ul",36),la(9,qee,2,1,"ng-container",37),fa(),fa(),fa(),fa()),2&e){const e=ba();Ts(3),ha("turn",-1),Ts(6),ha("ngForOf",e.activeUsers)}}let jee=(()=>{class e{constructor(e,t,n){this.router=e,this.userService=t,this.activePartsService=n,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}ngOnInit(){pw(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(e=>{this.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(e=>{this.activeParts=e})}ngOnDestroy(){pw(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}joinGame(e,t){var n=this;return hw(function*(){yield n.router.navigate(["/play",t,e])})()}selectTab(e){this.currentTab=e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(e_),ua(QG),ua(Tee))},e.\u0275cmp=Xe({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Games`,t=$localize`Create`,n=$localize`Chat`,r=$localize`Game`,i=$localize`First player`,s=$localize`Second player`,o=$localize`Turn`,a=$localize`Waiting for opponent`,l=$localize`Connected users:`,[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],e,["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],t,["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],n,["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],r,i,s,o,[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],a,["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-9"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3"],["id","onlineUsers",1,"box"],l,["id","activeUsersList"],[4,"ngFor","ngForOf"],[3,"id",4,"ngIf"],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"ul"),pa(2,"li",1),pa(3,"a",2),Ea("click",function(){return t.selectTab("games")}),ql(4,3),fa(),fa(),pa(5,"li",4),pa(6,"a",5),Ea("click",function(){return t.selectTab("create")}),ql(7,6),fa(),fa(),pa(8,"li",7),pa(9,"a",8),Ea("click",function(){return t.selectTab("chat")}),ql(10,9),fa(),fa(),fa(),fa(),la(11,zee,15,1,"div",10),la(12,Hee,2,0,"div",11),la(13,Wee,10,2,"div",12)),2&e&&(Ts(11),ha("ngIf","games"===t.currentTab),Ts(1),ha("ngIf","create"===t.currentTab),Ts(1),ha("ngIf","chat"===t.currentTab))},directives:[Bd,Hd,$d,Iee,Uee],pipes:[kee],encapsulation:2}),e})(),Zee=(()=>{class e{constructor(e){this.route=e,this.message=e.snapshot.paramMap.get("message")??$localize`This page does not exist.`}}return e.\u0275fac=function(t){return new(t||e)(ua(Ny))},e.\u0275cmp=Xe({type:e,selectors:[["app-not-found"]],decls:5,vars:1,consts:function(){let e;return e=$localize`Not found`,[[1,"message","is-danger"],[1,"message-header"],e,[1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),ql(2,2),fa(),pa(3,"div",3),Fa(4),fa(),fa()),2&e&&(Ts(4),Ua(t.message))},encapsulation:2}),e})();function Yee(e,t){}let Kee=(()=>{class e{constructor(t){this.viewContainerRef=t,pw(e.VERBOSE,"GameIncluderComponent constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(jc))},e.\u0275cmp=Xe({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&la(0,Yee,0,0,"ng-template")},encapsulation:2}),e})(),Jee=(()=>{class e{static NO_MATCHING_GAME(e){return $localize`This game (${e}) does not exist.`}}return e.NOT_YOUR_TURN=()=>$localize`It is not your turn!`,e.NO_CLONING_FEATURE=()=>$localize`You cannot clone a game. This feature might be implemented later.`,e})(),Qee=(()=>{class e{constructor(t,n,r,i,s){this.componentFactoryResolver=t,this.actRoute=n,this.connectedUserService=r,this.router=i,this.messageDisplayer=s,this.players=[yw.empty(),yw.empty()],this.endGame=!1,pw(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}getMatchingComponent(t){return pw(e.VERBOSE,"GameWrapper.getMatchingComponent"),yw.ofNullable(gee.ALL_GAMES().find(e=>e.urlName===t)).map(e=>e.component)}afterGameIncluderViewInit(){var t=this;return hw(function*(){pw(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit");const n=yield t.createGameComponent();return n&&t.gameComponent.rules.setInitialBoard(),n})()}createGameComponent(){var t=this;return hw(function*(){pw(e.VERBOSE,"GameWrapper.createGameComponent");const n=dw.getNonNullable(t.actRoute.snapshot.paramMap.get("compo")),r=t.getMatchingComponent(n);if(r.isAbsent())return yield t.router.navigate(["/notFound",Jee.NO_MATCHING_GAME(n)],{skipLocationChange:!0}),!1;zG(null!=t.gameIncluder,"GameIncluder should be present");const i=t.componentFactoryResolver.resolveComponentFactory(r.get()),s=t.gameIncluder.viewContainerRef.createComponent(i);return t.gameComponent=s.instance,t.gameComponent.chooseMove=(e,n,r)=>t.receiveValidMove(e,n,r),t.gameComponent.canUserPlay=e=>t.onUserClick(e),t.gameComponent.isPlayerTurn=()=>t.isPlayerTurn(),t.gameComponent.cancelMoveOnWrapper=e=>{t.onCancelMove(e)},t.gameComponent.observerRole=t.observerRole,t.canPass=t.gameComponent.canPass,!0})()}receiveValidMove(t,n,r){var i=this;return hw(function*(){if(pw(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),!i.isPlayerTurn())return FG.failure(Jee.NOT_YOUR_TURN());if(i.endGame)return FG.failure($localize`The game has ended.`);const s=i.gameComponent.rules.isLegal(t,n);return s.isFailure()?(i.gameComponent.cancelMove(s.getReason()),FG.ofFallible(s)):(i.gameComponent.cancelMoveAttempt(),yield i.onLegalUserMove(t,r),pw(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),FG.SUCCESS)})()}onUserClick(e){if(this.observerRole===KY.NONE.value){const e=Jee.NO_CLONING_FEATURE();return FG.failure(e)}return this.isPlayerTurn()?FG.SUCCESS:FG.failure(Jee.NOT_YOUR_TURN())}onCancelMove(e){}isPlayerTurn(){if(this.observerRole===KY.NONE.value||null==this.gameComponent)return!1;const t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return pw(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}getBoardHighlight(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(sc),ua(Ny),ua($Y),ua(e_),ua(VG))},e.\u0275cmp=Xe({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&xu(Kee,5),2&e){let e;Nu(e=Ru())&&(t.gameIncluder=e.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class Xee{constructor(e,t,n){this.added=e,this.modified=t,this.removed=n}static from(e,t){const n=new Xee({},{},{});if(null==e)return n.added={...t},n;if(null==t)return n.removed={...e},n;const r=Object.keys(e),i=Object.keys(t),s=r.filter(e=>!1===i.includes(e)),o=r.filter(e=>i.includes(e)),a=i.filter(e=>!1===r.includes(e));return n.addNewKeys(a,t),n.addCommonKeys(o,t,e),n.addRemovedKeys(s,e),n}static differs(e,t){return Xee.from(e,t).countChanges()>0}addNewKeys(e,t){for(const n of e)null!=t[n]&&(this.added[n]=t[n])}addCommonKeys(e,t,n){for(const r of e)this.addCommonKey(r,n[r],t[r])}addCommonKey(e,t,n){if(null==n)null!=t&&(this.removed[e]=t);else if(null==t)this.added[e]=n;else if(["string","boolean","number"].includes(typeof t))t!==n&&(this.modified[e]=n);else if(Array.isArray(t)){if(!Array.isArray(n))throw new Error("Thing should not change type");t.length===n.length?this.addCommonKeyList(e,t,n):this.modified[e]=n}else{zG("object"==typeof t,`ObjectDifference: expected JSON, but got a ${typeof t} in ${e}`),zG("object"==typeof n,`ObjectDifference: expected JSON, but got a ${typeof n} in ${e}`);const r=Xee.from(t,n);r.countChanges()>0&&(this.modified[e]=r)}}addCommonKeyList(e,t,n){let r=!0;for(let i=0;r&&i<t.length;i++)typeof t[i]==typeof n[i]&&"object"==typeof t[i]?Xee.differs(t[i],n[i])&&(r=!1,this.modified[e]=n):t[i]!==n[i]&&(r=!1,this.modified[e]=n)}addRemovedKeys(e,t){for(const n of e)this.removed[n]=t[n]}countChanges(){const e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}isPresent(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}function ete(e){return 1e3*e.seconds+e.nanoseconds/1e6}function tte(e,t){return ete(t)-ete(e)}function nte(e){return x((t,n)=>{Y(e).subscribe(new R(n,()=>n.complete(),f)),!n.closed&&t.subscribe(n)})}let rte=(()=>{class e{transform(e){const t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize`${r} hours`):1===r&&i.push($localize`1 hour`),n>1?i.push($localize`${n} minutes`):1===n&&i.push($localize`1 minute`),t>1?i.push($localize`${t} seconds`):1===t&&i.push($localize`1 second`),0===i.length)return $localize`0 seconds`;if(1===i.length)return i[0];{const e=i.slice(0,-1).join(", "),t=i.slice(-1)[0];return $localize`${e} and ${t}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"humanDuration",type:e,pure:!0}),e})();function ite(e,t){if(1&e&&(ma(0),Fa(1),ya()),2&e){const e=ba(3);Ts(1),Ua(e.viewInfo.chosenOpponent)}}function ste(e,t){1&e&&ql(0,44)}function ote(e,t){if(1&e&&(pa(0,"div",45),pa(1,"div",8),pa(2,"label",46),ma(3),ql(4,47),ya(),pa(5,"output"),Fa(6),gu(7,"humanDuration"),fa(),fa(),pa(8,"div",37),ga(9,"input",48),fa(),fa(),pa(10,"div",8),pa(11,"label",49),Hl(12,50),ga(13,"output"),gu(14,"humanDuration"),Gl(),fa(),pa(15,"div",37),ga(16,"input",51),fa(),fa(),fa()),2&e){const e=ba(3);Ts(6),Ua(mu(7,2,e.viewInfo.maximalMoveDuration||0)),Ts(8),Wl(mu(14,4,e.viewInfo.totalPartDuration||0)),jl(12)}}function ate(e,t){1&e&&(pa(0,"div"),Hl(1,52),ga(2,"br"),Gl(),fa())}function lte(e,t){1&e&&(pa(0,"button",64),ql(1,65),fa())}function cte(e,t){if(1&e){const e=va();pa(0,"tr",60),Ea("click",function(){const t=Gt(e).$implicit;return ba(4).selectOpponent(t)}),pa(1,"td",61),Fa(2),fa(),pa(3,"td",62),la(4,lte,2,0,"button",63),fa(),fa()}if(2&e){const e=t.$implicit,n=ba(4);Ta("id","presenceOf_",e,""),ha("ngClass",n.viewInfo.candidateClasses[e]),Ts(1),ha("id",n.viewInfo.chosenOpponent===e?"selected_"+e:"candidate_"+e),Ts(1),Ua(e),Ts(2),ha("ngIf",n.viewInfo.chosenOpponent!==e)}}function ute(e,t){if(1&e&&(ma(0),ql(1,53),ya(),pa(2,"div",54),pa(3,"table",55),pa(4,"thead"),pa(5,"tr"),pa(6,"th",56),ql(7,57),fa(),pa(8,"th",56),ql(9,58),fa(),fa(),fa(),pa(10,"tbody"),la(11,cte,5,5,"tr",59),fa(),fa(),fa()),2&e){const e=ba(3);Ts(11),ha("ngForOf",e.viewInfo.candidates)}}function hte(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),ba(3).changeConfig()}),ql(1,67),fa()}}function dte(e,t){if(1&e){const e=va();pa(0,"div"),pa(1,"h1",4),ql(2,5),fa(),pa(3,"form",6),pa(4,"fieldset",7),pa(5,"div",8),pa(6,"label",9),ql(7,10),fa(),pa(8,"div",11),pa(9,"button",12),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("RANDOM")}),ql(10,13),fa(),pa(11,"button",14),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("CREATOR")}),ql(12,15),fa(),pa(13,"button",16),Ea("click",function(){return Gt(e),ba(2).selectFirstPlayer("CHOSEN_PLAYER")}),la(14,ite,2,1,"ng-container",17),la(15,ste,1,0,"ng-template",null,18,Lu),fa(),fa(),fa(),pa(17,"div",8),pa(18,"label",9),ql(19,19),fa(),pa(20,"div",11),pa(21,"div",20),Ea("click",function(){return Gt(e),ba(2).selectPartType("STANDARD")}),pa(22,"div",21),pa(23,"span"),ql(24,22),fa(),fa(),pa(25,"div",23),pa(26,"div",24),pa(27,"div",25),pa(28,"p"),ma(29),ql(30,26),ya(),pa(31,"strong"),Fa(32),gu(33,"humanDuration"),fa(),ga(34,"br"),ma(35),Hl(36,27),ga(37,"strong"),gu(38,"humanDuration"),Gl(),ya(),fa(),fa(),fa(),fa(),fa(),pa(39,"div",28),Ea("click",function(){return Gt(e),ba(2).selectPartType("BLITZ")}),pa(40,"div",21),pa(41,"span"),ql(42,29),fa(),fa(),pa(43,"div",23),pa(44,"div",24),pa(45,"div",25),pa(46,"p"),ma(47),ql(48,30),ya(),pa(49,"strong"),Fa(50),gu(51,"humanDuration"),fa(),ga(52,"br"),ma(53),Hl(54,31),ga(55,"strong"),gu(56,"humanDuration"),Gl(),ya(),fa(),fa(),fa(),fa(),fa(),pa(57,"button",32),Ea("click",function(){return Gt(e),ba(2).selectPartType("CUSTOM")}),ql(58,33),fa(),fa(),fa(),la(59,ote,17,6,"div",34),pa(60,"div",8),pa(61,"label",35),ql(62,36),fa(),pa(63,"div",37),la(64,ate,3,0,"div",17),la(65,ute,12,1,"ng-template",null,38,Lu),fa(),fa(),fa(),pa(67,"div",8),pa(68,"div",11),pa(69,"button",39),Ea("click",function(){return Gt(e),ba(2).proposeConfig()}),ql(70,40),fa(),la(71,hte,2,0,"button",41),pa(72,"button",42),Ea("click",function(){return Gt(e),ba(2).cancelGameCreation()}),ql(73,43),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ca(16),t=ca(66),n=ba(2);Ts(3),ha("formGroup",n.configFormGroup),Ts(1),ha("disabled",!n.viewInfo.canEditConfig),Ts(5),ha("ngClass",n.viewInfo.firstPlayerClasses.RANDOM),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CREATOR),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),Ts(1),ha("ngIf",n.viewInfo.chosenOpponent)("ngIfElse",e),Ts(7),ha("ngClass",n.viewInfo.partTypeClasses.STANDARD),Ts(11),Ua(mu(33,19,n.partType.NORMAL_MOVE_DURATION)),Ts(6),Wl(mu(38,21,n.partType.NORMAL_PART_DURATION)),jl(36),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.BLITZ),Ts(11),Ua(mu(51,23,n.partType.BLITZ_MOVE_DURATION)),Ts(6),Wl(mu(56,25,n.partType.BLITZ_PART_DURATION)),jl(54),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.CUSTOM),Ts(2),ha("ngIf",n.viewInfo.showCustomTime),Ts(5),ha("ngIf",0===n.viewInfo.candidates.length)("ngIfElse",t),Ts(5),ha("disabled",!n.viewInfo.canProposeConfig),Ts(2),ha("ngIf",n.viewInfo.canReviewConfig)}}function pte(e,t){if(1&e&&(pa(0,"div",74),pa(1,"p"),Hl(2,75),ga(3,"br"),Gl(),fa(),fa()),2&e){const e=ba(3);Ts(3),Wl(e.viewInfo.creator),jl(2)}}function fte(e,t){if(1&e&&(pa(0,"span"),ql(1,81),fa()),2&e){const e=ba(4);Ts(1),Wl(e.viewInfo.creator),jl(1)}}function gte(e,t){1&e&&(pa(0,"span"),ql(1,82),fa())}function mte(e,t){1&e&&(pa(0,"span"),ql(1,83),fa())}function yte(e,t){if(1&e){const e=va();pa(0,"div",74),pa(1,"p"),ql(2,76),fa(),pa(3,"ul"),pa(4,"li"),la(5,fte,2,1,"span",2),la(6,gte,2,0,"span",2),la(7,mte,2,0,"span",2),fa(),pa(8,"li"),Hl(9,77),ga(10,"strong"),gu(11,"humanDuration"),Gl(),fa(),pa(12,"li"),Hl(13,78),ga(14,"strong"),gu(15,"humanDuration"),Gl(),fa(),fa(),pa(16,"button",79),Ea("click",function(){return Gt(e),ba(3).acceptConfig()}),ql(17,80),fa(),fa()}if(2&e){const e=ba(3);Ts(2),Wl(e.viewInfo.creator)(e.viewInfo.partTypeName),jl(2),Ts(3),ha("ngIf","CREATOR"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","CHOSEN_PLAYER"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","RANDOM"===e.viewInfo.firstPlayer),Ts(4),Wl(mu(11,7,e.viewInfo.maximalMoveDuration||0)),jl(9),Ts(4),Wl(mu(15,9,e.viewInfo.totalPartDuration||0)),jl(13)}}function vte(e,t){if(1&e&&(pa(0,"div"),pa(1,"div",68),pa(2,"div",69),pa(3,"p"),ql(4,70),fa(),fa(),pa(5,"div",71),la(6,pte,4,1,"div",72),la(7,yte,18,11,"ng-template",null,73,Lu),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function _te(e,t){if(1&e&&(ma(0),ql(1,86),ya()),2&e){const e=ba(3);Ts(1),Wl(e.viewInfo.creator),jl(1)}}function Cte(e,t){if(1&e&&ql(0,87),2&e){const e=ba(3);Wl(e.viewInfo.creator)(e.viewInfo.chosenOpponent),jl(0)}}function Ete(e,t){if(1&e&&(pa(0,"div",68),pa(1,"div",69),pa(2,"p"),ql(3,84),fa(),fa(),pa(4,"div",71),pa(5,"p"),la(6,_te,2,1,"ng-container",17),la(7,Cte,1,2,"ng-template",null,85,Lu),fa(),fa(),fa()),2&e){const e=ca(8),t=ba(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function wte(e,t){if(1&e&&(pa(0,"div",1),la(1,dte,74,27,"div",2),la(2,vte,9,2,"div",2),la(3,Ete,9,2,"div",3),fa()),2&e){const e=ba();Ts(1),ha("ngIf",e.viewInfo.userIsCreator),Ts(1),ha("ngIf",e.viewInfo.userIsChosenOpponent),Ts(1),ha("ngIf",e.viewInfo.userIsObserver)}}class Ste{constructor(e,t,n,r,i,s,o,a){this.router=e,this.connectedUserService=t,this.gameService=n,this.joinerService=r,this.chatService=i,this.userService=s,this.formBuilder=o,this.messageDisplayer=a,this.partType=HY,this.gameStartNotification=new Cu,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.ngUnsubscribe=new A,this.allUserInterval=yw.empty(),this.ownTokenInterval=yw.empty(),this.selfSubscription=()=>{},this.allDocDeleted=!1,pw(Ste.VERBOSE,"PartCreationComponent constructed")}ngOnInit(){var e=this;return hw(function*(){pw(Ste.VERBOSE,"PartCreationComponent.ngOnInit for "+e.connectedUserService.user.get().username.get()),e.checkInputs(),e.createForms();const t=e.connectedUserService.user.get().toMinimalUser(),n=yield e.joinerService.joinGame(e.partId,t);if(n.isFailure()){const t=n.getReason();e.messageDisplayer.criticalMessage(t)}else yield e.updateUserDocWithObservedPart(),yield e.startSendingPresenceTokens(),e.gameExists=!0,e.subscribeToJoinerDoc(),e.subscribeToFormElements(),pw(Ste.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds")})()}checkInputs(){const e=this.connectedUserService.user;zG(e.isPresent()&&e.get()!==VY.NOT_CONNECTED,"PartCreationComponent should not be created with an empty userName"),zG(""!==this.partId,"PartCreationComponent should not be created with an empty partId")}createForms(){this.configFormGroup=this.formBuilder.group({firstPlayer:[zY.RANDOM.value,Yp.required],maximalMoveDuration:[HY.NORMAL_MOVE_DURATION,Yp.required],partType:["STANDARD",Yp.required],totalPartDuration:[HY.NORMAL_PART_DURATION,Yp.required],chosenOpponent:["",Yp.required]})}updateUserDocWithObservedPart(){return pw(Ste.VERBOSE,"updateUserDocWithObservedPart of '"+this.partId+"'"),this.connectedUserService.updateObservedPart(this.partId)}subscribeToJoinerDoc(){var e=this;this.joinerService.subscribeToChanges(this.partId,function(){var t=hw(function*(t){yield e.onCurrentJoinerUpdate(t)});return function(e){return t.apply(this,arguments)}}())}getForm(e){return dw.getNonNullable(this.configFormGroup.get(e))}subscribeToFormElements(){this.getForm("chosenOpponent").valueChanges.pipe(nte(this.ngUnsubscribe)).subscribe(e=>{void 0!==this.viewInfo.chosenOpponent&&(this.viewInfo.candidateClasses[this.viewInfo.chosenOpponent]=[]),this.viewInfo.candidateClasses[e]=["is-selected"],this.viewInfo.chosenOpponent=e;const t=dw.getNonNullable(this.currentJoiner).partStatus;this.viewInfo.canProposeConfig=t!==GY.CONFIG_PROPOSED.value&&""!==e}),this.getForm("partType").valueChanges.pipe(nte(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.partTypeClasses[this.viewInfo.partType]=[],this.viewInfo.partTypeClasses[e]=["is-primary","is-selected"],this.viewInfo.partType=e,this.viewInfo.showCustomTime="CUSTOM"===e}),this.getForm("maximalMoveDuration").valueChanges.pipe(nte(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.maximalMoveDuration=e}),this.getForm("totalPartDuration").valueChanges.pipe(nte(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.totalPartDuration=e}),this.getForm("firstPlayer").valueChanges.pipe(nte(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.firstPlayerClasses[this.viewInfo.firstPlayer]=[],this.viewInfo.firstPlayerClasses[e]=["is-primary","is-selected"],this.viewInfo.firstPlayer=e})}updateViewInfo(){const e=dw.getNonNullable(this.currentJoiner),t=this.connectedUserService.user.get();switch(this.viewInfo.canReviewConfig=e.partStatus===GY.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=e.partStatus!==GY.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=t.id===e.creator.id,this.viewInfo.userIsChosenOpponent=t.id===e.chosenOpponent?.id,this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=e.partStatus!==GY.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=e.creator.name,this.viewInfo.candidates=e.candidates.map(e=>e.name),t.id===e.creator.id?this.setDataForCreator(e):(this.viewInfo.maximalMoveDuration=e.maximalMoveDuration,this.viewInfo.totalPartDuration=e.totalPartDuration,this.viewInfo.partType=e.partType,this.viewInfo.chosenOpponent=e.chosenOpponent?.name,this.viewInfo.firstPlayer=e.firstPlayer),e.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize`custom`;break;case"BLITZ":this.viewInfo.partTypeName=$localize`blitz`;break;case"STANDARD":this.viewInfo.partTypeName=$localize`standard`}}setDataForCreator(e){this.viewInfo.maximalMoveDuration=this.viewInfo.maximalMoveDuration??e.maximalMoveDuration,this.viewInfo.totalPartDuration=this.viewInfo.totalPartDuration??e.totalPartDuration;let t=this.viewInfo.chosenOpponent;null==t||""===t?t=e.chosenOpponent?.name??"":!1===e.candidates.some(e=>e.name===t)&&(t=""),this.getForm("chosenOpponent").setValue(t)}selectFirstPlayer(e){this.getForm("firstPlayer").setValue(e)}selectPartType(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue(HY.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue(HY.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue(HY.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue(HY.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}selectOpponent(e){var t=this;return hw(function*(){pw(Ste.VERBOSE,"PartCreationComponent.setChosenOpponent("+e+")");const n=t.getUserFromName(e);return t.joinerService.setChosenOpponent(n)})()}getUserFromName(e){const t=dw.getNonNullable(this.currentJoiner).candidates.find(t=>t.name===e);return dw.getNonNullable(t)}changeConfig(){var e=this;return hw(function*(){return e.joinerService.reviewConfig()})()}proposeConfig(){var e=this;return hw(function*(){const t=e.getForm("chosenOpponent").value,n=e.getForm("partType").value,r=e.getForm("maximalMoveDuration").value,i=e.getForm("firstPlayer").value,s=e.getForm("totalPartDuration").value,o=e.getUserFromName(t);return e.joinerService.proposeConfig(o,HY.of(n),r,zY.of(i),s)})()}cancelGameCreation(){var e=this;return hw(function*(){e.allDocDeleted=!0,yield e.connectedUserService.removeObservedPart(),pw(Ste.VERBOSE,"PartCreationComponent.cancelGameCreation"),yield e.chatService.deleteChat(e.partId),pw(Ste.VERBOSE,"PartCreationComponent.cancelGameCreation: chat deleted"),yield e.joinerService.deleteJoiner(),pw(Ste.VERBOSE,"PartCreationComponent.cancelGameCreation: chat and joiner deleted"),yield e.gameService.deletePart(e.partId),pw(Ste.VERBOSE,"PartCreationComponent.cancelGameCreation: chat, joiner, and part deleted")})()}onCurrentJoinerUpdate(e){var t=this;return hw(function*(){if(pw(Ste.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(t.currentJoiner),then:JSON.stringify(e)}}),e.isAbsent())return pw(Ste.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),t.onGameCancelled();if(t.chosenOpponentJustLeft(e.get())){const e=dw.getNonNullable(t.currentJoiner),n=dw.getNonNullable(e.chosenOpponent).name;t.messageDisplayer.infoMessage($localize`${n} left the game, please pick another opponent.`)}t.currentJoiner=e.get(),t.allUserInterval.isAbsent()&&(yield t.observeNeededPlayers()),t.updateViewInfo(),t.isGameStarted()&&(pw(Ste.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),t.onGameStarted())})()}chosenOpponentJustLeft(e){return null!=this.currentJoiner&&(null!=this.currentJoiner.chosenOpponent&&null==e.chosenOpponent)}onGameCancelled(){var e=this;return hw(function*(){pw(Ste.VERBOSE,"PartCreationComponent.onGameCancelled"),e.messageDisplayer.infoMessage($localize`The game has been canceled!`),yield e.router.navigate(["/lobby"])})()}isGameStarted(){return dw.getNonNullable(this.currentJoiner).partStatus===GY.PART_STARTED.value}onGameStarted(){const e=dw.getNonNullable(this.currentJoiner);pw(Ste.VERBOSE,{partCreationComponent_onGameStarted:{joiner:e}}),this.gameStartNotification.emit(e),this.gameStarted=!0,pw(Ste.VERBOSE,"PartCreationComponent.onGameStarted finished")}observeNeededPlayers(){var e=this;return hw(function*(){const t=dw.getNonNullable(e.currentJoiner),n=e.connectedUserService.user.get().id;pw(Ste.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:t}}),e.allUserInterval=yw.of(window.setInterval(hw(function*(){const t=dw.getNonNullable(e.currentJoiner),r=e.lastToken;n===t.creator.id?yield e.checkCandidatesTokensFreshness(r):yield e.checkCreatorTokenFreshness(r)}),Ste.TOKEN_INTERVAL))})()}checkCreatorTokenFreshness(e){var t=this;return hw(function*(){const n=dw.getNonNullable(t.currentJoiner);(yield t.didUserTimeout(n.creator.id,e))&&(yield t.destroyDocIfPartDidNotStart())})()}destroyDocIfPartDidNotStart(){var e=this;return hw(function*(){zG(!1==(dw.getNonNullable(e.currentJoiner).partStatus===GY.PART_STARTED.value),"Should not try to cancelGameCreation when part started!"),zG(!1===e.allDocDeleted,"Should not delete doc twice"),yield e.cancelGameCreation()})()}checkCandidatesTokensFreshness(e){var t=this;return hw(function*(){const n=dw.getNonNullable(t.currentJoiner);for(const r of n.candidates)(yield t.didUserTimeout(r.id,e))&&(yield t.removeCandidateFromLobby(r.id))})()}didUserTimeout(e,t){var n=this;return hw(function*(){const r=yield n.userService.getUserLastChanged(e);return r.isAbsent()?($G.logError("PartCreationComponent","found no user while observing "+e+" !"),!0):tte(r.get(),t)>Ste.TOKEN_TIMEOUT})()}startSendingPresenceTokens(){var e=this;return hw(function*(){yield e.connectedUserService.sendPresenceToken(),zG(e.ownTokenInterval.isAbsent(),"should not start sending presence tokens twice"),e.ownTokenInterval=yw.of(window.setInterval(()=>{e.connectedUserService.sendPresenceToken()},Ste.TOKEN_INTERVAL));const t=e.connectedUserService.user.get().id;e.selfSubscription=e.userService.observeUser(t,t=>{zG(t.isPresent(),"connected user should exist");const n=t.get();null!=n.last_changed&&(e.lastToken=n.last_changed)})})()}stopSendingPresenceTokensAndObservingUsersIfNeeded(){this.ownTokenInterval.isPresent()&&(window.clearInterval(this.ownTokenInterval.get()),this.ownTokenInterval=yw.empty()),this.allUserInterval.isPresent()&&window.clearInterval(this.allUserInterval.get()),this.selfSubscription()}removeCandidateFromLobby(e){var t=this;return hw(function*(){const n=dw.getNonNullable(t.currentJoiner);zG(-1!==n.candidates.findIndex(t=>t.id===e),"PartCreationComponent: attempting to remove a user not in the lobby");const r=n.candidates.filter(t=>t.id!==e);return n.chosenOpponent?.id===e?t.joinerService.reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(r):t.joinerService.updateCandidates(r)})()}acceptConfig(){var e=this;return hw(function*(){return pw(Ste.VERBOSE,"PartCreationComponent.acceptConfig"),e.gameService.acceptConfig(e.partId,dw.getNonNullable(e.currentJoiner))})()}ngOnDestroy(){var e=this;return hw(function*(){pw(Ste.VERBOSE,"PartCreationComponent.ngOnDestroy"),e.ngUnsubscribe.next(),e.ngUnsubscribe.complete(),e.stopSendingPresenceTokensAndObservingUsersIfNeeded(),e.gameExists&&e.joinerService.unsubscribe();const t=e.connectedUserService.user.get();if(!0!==e.gameStarted){if(null===e.currentJoiner)return void pw(Ste.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here");t.id===e.currentJoiner.creator.id?(pw(Ste.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),yield e.cancelGameCreation()):!1===e.allDocDeleted&&(pw(Ste.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),yield e.connectedUserService.removeObservedPart(),yield e.joinerService.cancelJoining(t.toMinimalUser()))}})()}}function bte(e,t){if(1&e){const e=va();pa(0,"button",3),Ea("click",function(){return Gt(e),ba().addTime()}),ql(1,4),fa()}if(2&e){const e=ba();Ts(1),Wl(e.timeToAdd),jl(1)}}Ste.VERBOSE=!1,Ste.TOKEN_INTERVAL=5e3,Ste.TOKEN_TIMEOUT=2*Ste.TOKEN_INTERVAL,Ste.\u0275fac=function(e){return new(e||Ste)(ua(e_),ua($Y),ua(rK),ua(nK),ua(ZG),ua(QG),ua(Sg),ua(VG))},Ste.\u0275cmp=Xe({type:Ste,selectors:[["app-part-creation"]],inputs:{partId:"partId"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,S,b,P,O,T,I,k,A,M,N,x,R,D;return e=$localize`Game creation`,t=$localize`First player`,n=$localize`Random`,r=$localize`You`,i=$localize`Game type`,s=$localize`Standard`,o=$localize`Maximal turn duration: `,a=$localize`Maximal game duration: ${"\ufffd#37\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#37\ufffd"}:CLOSE_TAG_STRONG:`,l=$localize`Blitz`,c=$localize`Maximal turn duration: `,u=$localize`Maximal game duration: ${"\ufffd#55\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#55\ufffd"}:CLOSE_TAG_STRONG:`,h=$localize`Custom`,d=$localize`Opponents`,p=$localize`Propose configuration`,f=$localize`Cancel game`,g=$localize`The opponent`,m=$localize`Maximal turn duration: `,y=$localize`Maximal game duration: ${"\ufffd#13\ufffd"}:START_TAG_OUTPUT:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#13\ufffd"}:CLOSE_TAG_OUTPUT:`,v=$localize`Potential opponents that join the game will appear here.${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:LINE_BREAK:Wait for an opponent to join, so that you can pick one.`,_=$localize`Click on the opponent against which you would like to play.`,C=$localize`Name`,E=$localize`Actions`,w=$localize`Pick`,S=$localize`Change configuration`,b=$localize`Configuration proposal`,P=$localize`You have been selected as the opponent.${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:LINE_BREAK: ${"\ufffd0\ufffd"}:INTERPOLATION: is modifying the configuration.`,O=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: proposes to play a ${"\ufffd1\ufffd"}:INTERPOLATION_1: game`,T=$localize`a turn lasts at most ${"\ufffd#10\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#10\ufffd"}:CLOSE_TAG_STRONG:`,I=$localize`the game lasts at most ${"\ufffd#14\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#14\ufffd"}:CLOSE_TAG_STRONG:`,k=$localize`Accept and start`,A=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: plays first`,M=$localize`you play first`,N=$localize`the first player is selected randomly`,x=$localize`One moment...`,R=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: is configuring the game.`,D=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has proposed a configuration to ${"\ufffd1\ufffd"}:INTERPOLATION_1:.`,[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],e,[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],t,[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],n,["id","firstPlayerCreator",1,"button",3,"ngClass","click"],r,["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],i,["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],s,["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],o,a,["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],l,c,u,["id","partTypeCustom",1,"button",3,"ngClass","click"],h,["id","customTime",4,"ngIf"],[1,"label"],d,[1,"control"],["chooseOpponent",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],p,["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],f,g,["id","customTime"],["for","maximalMoveDuration",1,"label"],m,["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],y,["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],v,_,["id","chooseOpponent",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],C,E,[3,"id","ngClass","click",4,"ngFor","ngForOf"],[3,"id","ngClass","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],w,["id","reviewConfig",1,"button",3,"click"],S,[1,"message","is-primary"],[1,"message-header"],b,[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],P,O,T,I,["id","acceptConfig",1,"button","is-primary",3,"click"],k,A,M,N,x,["proposalSent",""],R,D]},template:function(e,t){1&e&&la(0,wte,4,3,"div",0),2&e&&ha("ngIf",t.viewInfo)},directives:[Hd,Xf,Ef,sg,Bd,Hp,ng,Cf,ag,$d],pipes:[rte],encapsulation:2});let Pte=(()=>{class e{constructor(){this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new Cu,this.addTimeToOpponent=new Cu,this.cssClasses=e.SAFE_TIME}ngOnInit(){pw(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}setDuration(t){if(pw(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}changeDuration(e){let t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}displayDuration(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}start(){if(pw(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}resume(){if(pw(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();const t=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(()=>{this.onEndReached()},t),this.countSeconds()}onEndReached(){pw(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}countSeconds(){this.timeoutHandleSec=window.setTimeout(()=>{this.updateShownTime()},1e3)}isIdle(){return!1===this.started||this.isPaused}pause(){if(pw(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}stop(){if(pw(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}isStarted(){return this.started}getTimeClass(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}updateShownTime(){const e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}clearTimeouts(){pw(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(window.clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(window.clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}addTime(){this.addTimeToOpponent.emit()}ngOnDestroy(){this.clearTimeouts()}}return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){let e;return e=$localize`Add ${"\ufffd0\ufffd"}:INTERPOLATION:`,[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],e]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),Fa(2),gu(3,"number"),fa(),la(4,bte,2,1,"button",2),fa()),2&e&&(ha("ngClass",t.getTimeClass()),Ts(2),Va("",t.displayedMinute,":",function(e,t,n,r){const i=e+20,s=zt(),o=xt(s,i);return vu(s,yu(s,i)?fu(s,Xt(),t,o.transform,n,r,o):o.transform(n,r))}(3,4,t.displayedSec,"2.0-0"),""),Ts(2),ha("ngIf",t.canAddTime))},directives:[Bd,Hd],pipes:[Wd],encapsulation:2}),e})();const Ote=["partCreation"],Tte=["chatComponent"],Ite=["chronoZeroGlobal"],kte=["chronoOneGlobal"],Ate=["chronoZeroTurn"],Mte=["chronoOneTurn"];function Nte(e,t){if(1&e){const e=va();pa(0,"app-part-creation",5,6),Ea("gameStartNotification",function(t){return Gt(e),ba().startGame(t)}),fa()}2&e&&ha("partId",ba().currentPartId)}function xte(e,t){1&e&&(ma(0),ql(1,40),ya())}function Rte(e,t){if(1&e&&(ma(0),ql(1,41),ya()),2&e){const e=ba(4);Ts(1),Wl(e.currentPlayer),jl(1)}}function Dte(e,t){if(1&e&&(pa(0,"p",37),la(1,xte,2,0,"ng-container",38),la(2,Rte,2,1,"ng-template",null,39,Lu),fa()),2&e){const e=ca(3),t=ba(3);Ts(1),ha("ngIf",t.currentPlayer===t.getPlayerName())("ngIfElse",e)}}function Lte(e,t){if(1&e&&(pa(0,"div",33),pa(1,"p",34),ql(2,35),fa(),la(3,Dte,4,2,"p",36),fa()),2&e){const e=ba(2);Ts(2),Wl(e.currentPart.getTurn()+1),jl(2),Ts(1),ha("ngIf",!1===e.endGame)}}function Fte(e,t){if(1&e&&(pa(0,"p",42),Fa(1),fa()),2&e){const e=ba(2);ha("ngClass",e.getPlayerNameClass(0)),Ts(1),Ua(e.players[0].get())}}function Ute(e,t){if(1&e&&(pa(0,"p",43),ql(1,44),fa()),2&e){const e=ba(2);Ts(1),Wl(e.gameComponent.scores.get()[0]),jl(1)}}function Bte(e,t){if(1&e&&(pa(0,"p",45),Fa(1),fa()),2&e){const e=ba(2);ha("ngClass",e.getPlayerNameClass(1)),Ts(1),Ua(e.players[1].get())}}function Vte(e,t){if(1&e&&(pa(0,"p",46),ql(1,47),fa()),2&e){const e=ba(2);Ts(1),Wl(e.gameComponent.scores.get()[1]),jl(1)}}function $te(e,t){if(1&e){const e=va();pa(0,"button",56),Ea("click",function(){return Gt(e),ba(3).resign()}),ql(1,57),fa()}}function zte(e,t){if(1&e){const e=va();pa(0,"button",58),Ea("click",function(){return Gt(e),ba(3).proposeDraw()}),ql(1,59),fa()}}function Hte(e,t){if(1&e){const e=va();pa(0,"button",60),Ea("click",function(){return Gt(e),ba(3).acceptDraw()}),ql(1,61),fa()}}function Gte(e,t){if(1&e){const e=va();pa(0,"button",62),Ea("click",function(){return Gt(e),ba(3).refuseDraw()}),ql(1,63),fa()}}function qte(e,t){if(1&e){const e=va();pa(0,"button",64),Ea("click",function(){return Gt(e),ba(3).gameComponent.pass()}),ql(1,65),fa()}}function Wte(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),ba(3).acceptTakeBack()}),ql(1,67),fa()}}function jte(e,t){if(1&e){const e=va();pa(0,"button",68),Ea("click",function(){return Gt(e),ba(3).refuseTakeBack()}),ql(1,69),fa()}}function Zte(e,t){if(1&e){const e=va();pa(0,"button",70),Ea("click",function(){return Gt(e),ba(3).askTakeBack()}),ql(1,71),fa()}}function Yte(e,t){if(1&e&&(ma(0),la(1,$te,2,0,"button",48),la(2,zte,2,0,"button",49),la(3,Hte,2,0,"button",50),la(4,Gte,2,0,"button",51),la(5,qte,2,0,"button",52),la(6,Wte,2,0,"button",53),la(7,jte,2,0,"button",54),la(8,Zte,2,0,"button",55),ya()),2&e){const e=ba(2);Ts(1),ha("ngIf",e.canResign()),Ts(1),ha("ngIf",e.canProposeDraw()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isPlaying()&&e.gameComponent.canPass&&e.currentPlayer===e.getPlayerName()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&!1===e.isOpponentWaitingForTakeBackResponse()&&e.canAskTakeBack())}}function Kte(e,t){1&e&&(pa(0,"div"),pa(1,"p",73),ql(2,74),fa(),fa())}function Jte(e,t){1&e&&(pa(0,"p",78),ql(1,79),fa())}function Qte(e,t){1&e&&(pa(0,"p",80),ql(1,81),fa())}function Xte(e,t){1&e&&(pa(0,"p",82),ql(1,83),fa())}function ene(e,t){if(1&e&&(pa(0,"div"),la(1,Jte,2,0,"p",75),la(2,Qte,2,0,"p",76),la(3,Xte,2,0,"p",77),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function tne(e,t){1&e&&(pa(0,"p",86),ql(1,87),fa())}function nne(e,t){1&e&&(pa(0,"p",88),ql(1,89),fa())}function rne(e,t){if(1&e&&(pa(0,"p",88),ql(1,90),fa()),2&e){const e=ba(4);Ts(1),Wl(e.currentPart.getWinner().get()),jl(1)}}function ine(e,t){if(1&e&&(pa(0,"div"),la(1,tne,2,0,"p",84),la(2,nne,2,0,"p",85),la(3,rne,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function sne(e,t){if(1&e&&(pa(0,"p",86),ql(1,91),fa()),2&e){const e=ba(4);Ts(1),Wl(e.currentPart.getLoser().get()),jl(1)}}function one(e,t){1&e&&(pa(0,"p",88),ql(1,92),fa())}function ane(e,t){if(1&e&&(pa(0,"p",88),ql(1,93),fa()),2&e){const e=ba(4);Ts(1),Wl(e.currentPart.getLoser().get()),jl(1)}}function lne(e,t){if(1&e&&(pa(0,"div"),la(1,sne,2,1,"p",84),la(2,one,2,0,"p",85),la(3,ane,2,1,"p",85),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function cne(e,t){1&e&&(pa(0,"p",95),ql(1,96),fa())}function une(e,t){if(1&e&&(pa(0,"p",95),ql(1,97),fa()),2&e){const e=ba(4);Ts(1),Wl(e.currentPart.getLoser().get()),jl(1)}}function hne(e,t){if(1&e&&(pa(0,"div"),la(1,cne,2,0,"p",94),la(2,une,2,1,"p",94),fa()),2&e){const e=ba(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying()||e.currentPart.getWinner().get()===e.getPlayerName())}}function dne(e,t){if(1&e&&(pa(0,"div",72),ga(1,"hr"),la(2,Kte,3,0,"div",26),la(3,ene,4,3,"div",26),la(4,ine,4,3,"div",26),la(5,lne,4,3,"div",26),la(6,hne,3,2,"div",26),fa()),2&e){const e=ba(2);Ts(2),ha("ngIf",e.currentPart.isHardDraw()),Ts(1),ha("ngIf",e.currentPart.isAgreedDraw()),Ts(1),ha("ngIf",e.currentPart.isWin()),Ts(1),ha("ngIf",e.currentPart.isTimeout()),Ts(1),ha("ngIf",e.currentPart.isResign())}}function pne(e,t){1&e&&(pa(0,"button",98),ql(1,99),fa())}function fne(e,t){if(1&e){const e=va();pa(0,"button",100),Ea("click",function(){return Gt(e),ba(2).proposeRematch()}),ql(1,101),fa()}}function gne(e,t){if(1&e){const e=va();pa(0,"button",102),Ea("click",function(){return Gt(e),ba(2).acceptRematch()}),ql(1,103),fa()}}function mne(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"div",8),pa(2,"div",9),la(3,Lte,4,2,"div",10),pa(4,"div",11),la(5,Fte,2,2,"p",12),la(6,Ute,2,1,"p",13),pa(7,"app-count-down",14,15),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),pa(9,"app-count-down",16,17),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),pa(11,"p",18),ql(12,19),fa(),pa(13,"div",11),la(14,Bte,2,2,"p",20),la(15,Vte,2,1,"p",21),pa(16,"app-count-down",22,23),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addGlobalTime()}),fa(),pa(18,"app-count-down",24,25),Ea("outOfTimeAction",function(){return Gt(e),ba().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),ba().addTurnTime()}),fa(),fa(),ga(20,"hr"),la(21,Yte,9,8,"ng-container",26),la(22,dne,7,5,"div",27),la(23,pne,2,0,"button",28),la(24,fne,2,0,"button",29),la(25,gne,2,0,"button",30),fa(),fa(),pa(26,"div",31),pa(27,"div",32),ga(28,"app-game-includer"),fa(),fa(),fa()}if(2&e){const e=ba();Ts(3),ha("ngIf",e.currentPart),Ts(2),ha("ngIf",e.players[0].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(5),ha("ngIf",e.players[1].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(3),ha("ngIf",e.isPlaying()),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&!1===e.rematchProposed),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&e.rematchProposed&&e.opponentProposedRematch),Ts(1),ha("ngClass",e.getBoardHighlight())}}let yne=(()=>{class e{}return e.NO_MATCHING_PART=()=>$localize`The game you tried to join does not exist.`,e})();class vne{constructor(e){this.value=e}}vne.PRE_START_DOC=new vne("PRE_START_DOC"),vne.STARTING_DOC=new vne("STARTING_DOC"),vne.DUPLICATE=new vne("DUPLICATE"),vne.MOVE_WITHOUT_TIME=new vne("MOVE_WITHOUT_TIME"),vne.MOVE=new vne("MOVE"),vne.REQUEST=new vne("REQUEST"),vne.END_GAME=new vne("END_GAME"),vne.END_GAME_WITHOUT_TIME=new vne("END_GAME_WITHOUT_TIME"),vne.ACCEPT_TAKE_BACK_WITHOUT_TIME=new vne("ACCEPT_TAKE_BACK_WITHOUT_TIME");let _ne=(()=>{class e extends Qee{constructor(t,n,r,i,s,o,a){super(t,n,s,r,i),this.userService=o,this.gameService=a,this.gameStarted=!1,this.opponent=null,this.rematchProposed=!1,this.opponentProposedRematch=!1,this.hasUserPlayed=[!1,!1],this.msToSubstract=[0,0],this.opponentSubscription=yw.empty(),this.OFFLINE_FONT_COLOR={color:"lightgrey"},this.globalTimeMessage=$localize`5 minutes`,this.turnTimeMessage=$localize`30 seconds`,pw(e.VERBOSE,"OnlineGameWrapperComponent constructed")}extractPartIdFromURL(){return dw.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}extractGameNameFromURL(){return dw.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}isPlaying(){return this.observerRole===YY.ZERO.value||this.observerRole===YY.ONE.value}getPlayer(){return YY.of(this.observerRole)}getPlayerName(){return dw.getNonNullable(this.authUser.username.get())}isPlayer(e){return this.observerRole===e.value}isOpponent(e){return this.observerRole!==e.value}redirectIfPartOrGameIsInvalid(){var e=this;return hw(function*(){const t=e.extractGameNameFromURL();if(gee.ALL_GAMES().some(e=>e.urlName===t)){if((yield e.gameService.getPartValidity(e.currentPartId,t)).isFailure()){e.routerEventsSub.unsubscribe();const t=yne.NO_MATCHING_PART();yield e.router.navigate(["/notFound",t],{skipLocationChange:!0})}}else{e.routerEventsSub.unsubscribe();const n=Jee.NO_MATCHING_GAME(t);yield e.router.navigate(["/notFound",n],{skipLocationChange:!0})}})()}setCurrentPartIdOrRedirect(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartOrGameIsInvalid()}ngOnInit(){var t=this;return hw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),t.routerEventsSub=t.router.events.subscribe(function(){var e=hw(function*(e){e instanceof Om&&(yield t.setCurrentPartIdOrRedirect())});return function(t){return e.apply(this,arguments)}}()),t.userSub=t.connectedUserService.getUserObs().subscribe(e=>{t.authUser=e}),yield t.setCurrentPartIdOrRedirect()})()}startGame(t){var n=this;return hw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.startGame"),zG(!1===n.gameStarted,"Should not start already started game"),n.joiner=t,n.gameStarted=!0,window.setTimeout(hw(function*(){zG(yield n.afterGameIncluderViewInit(),"Game should be created successfully, otherwise part-creation would have redirected"),n.startPart()}),1)})()}startPart(){var t=this;pw(e.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,function(){var e=hw(function*(e){zG(e.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),yield t.onCurrentPartUpdate(e.get())});return function(t){return e.apply(this,arguments)}}())}onCurrentPartUpdate(t){var n=this;return hw(function*(){const r=new GG(n.currentPartId,t);pw(e.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:n.currentPart,then:t.data,before_part_turn:r.data.turn,before_state_turn:n.gameComponent.rules.node.gameState.turn,nbPlayedMoves:r.data.listMoves.length}});const i=n.getUpdateType(r),s=t.turn;pw(e.VERBOSE,i===vne.REQUEST?"UpdateType: Request("+dw.getNonNullable(r.data.request).code+") ("+s+")":"UpdateType: "+i.value+"("+s+")");const o=n.currentPart;switch(n.currentPart=r,i){case vne.REQUEST:return yield n.onRequest(dw.getNonNullable(r.data.request),o);case vne.ACCEPT_TAKE_BACK_WITHOUT_TIME:return void(n.currentPart=o);case vne.DUPLICATE:return;case vne.END_GAME_WITHOUT_TIME:return void(n.currentPart=o);case vne.END_GAME:return n.applyEndGame();case vne.MOVE_WITHOUT_TIME:return void(n.currentPart=o);case vne.MOVE:return n.msToSubstract=n.getLastUpdateTime(o,r,i),n.doNewMoves(r);case vne.PRE_START_DOC:const e=null==n.currentPart||null!=n.currentPart.data.beginning;return void zG(null==o||null==o.data.beginning||e,"old part had no beginning time or new part has, we did not expect this!");default:return zG(i===vne.STARTING_DOC,"Unexpected update type "+i),n.setChronos(),n.setPlayersDatas(r),n.startCountDownFor(YY.ZERO)}})()}getUpdateType(t){const n=Xee.from(null!=this.currentPart?this.currentPart.data:null,t.data);pw(e.VERBOSE,{diff:n});const r=n.countChanges();if(0===r)return vne.DUPLICATE;if(t.data.request){const e=null!=n.removed.lastUpdateTime;return"TakeBackAccepted"===t.data.request.code&&e?vne.ACCEPT_TAKE_BACK_WITHOUT_TIME:vne.REQUEST}if(this.isMove(n,r))return 1===t.data.turn?null==t.data.lastUpdateTime?vne.MOVE_WITHOUT_TIME:vne.MOVE:null==n.modified.lastUpdateTime?vne.MOVE_WITHOUT_TIME:vne.MOVE;if(null==t.data.beginning)return vne.PRE_START_DOC;if(t.data.result!==HG.UNACHIEVED.value){const e=null==n.modified.lastUpdateTime;return null!=n.modified.turn&&e?vne.END_GAME_WITHOUT_TIME:vne.END_GAME}return zG(null!=t.data.beginning&&0===t.data.listMoves.length,"Unexpected update: "+JSON.stringify(n)),vne.STARTING_DOC}isMove(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){const n=3;return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+n}return!1}getLastUpdateTime(e,t,n){const r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);zG(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),zG(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");const s=YY.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(dw.getNonNullable(r),dw.getNonNullable(i),n,s)}getMoreRecentTime(e){return e.data.lastUpdateTime??e.data.beginning}getTimeUsedForLastTurn(e,t,n,r){const i=tte(e,t),s=[0,0];return s[r.value]=i,s}setChronos(){pw(e.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}didUserPlay(e){return this.hasUserPlayed[e.value]}doNewMoves(e){this.switchPlayer();const t=eK.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;for(;n.node.gameState.turn<t.length;){const e=n.node.gameState.turn,r=this.gameComponent.encoder.decode(t[e]),i=n.isLegal(r,n.node.gameState),s="We received an incorrect db move: "+r.toString()+" in "+t+" at turn "+e+'because "'+i.getReasonOr("")+'"';zG(i.isSuccess(),s),n.choose(r)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}switchPlayer(){pw(e.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");const t=YY.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();const n=t.getOpponent();this.didUserPlay(n)&&this.pauseCountDownsFor(n),this.didUserPlay(t)?(pw(e.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(t)):this.startCountDownFor(t)}resetChronoFor(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}applyEndGame(){const t=this.currentPart,n=YY.fromTurn(t.data.turn);this.endGame=!0,[HG.VICTORY,HG.HARD_DRAW].some(e=>e.value===t.data.result)?this.doNewMoves(this.currentPart):(zG(!0===[HG.RESIGN,HG.TIMEOUT,HG.HARD_DRAW,HG.AGREED_DRAW_BY_ZERO,HG.AGREED_DRAW_BY_ONE].some(e=>e.value===t.data.result),"Unknown type of end game ("+t.data.result+")"),pw(e.VERBOSE,"endGame est true et winner est "+t.getWinner())),this.stopCountdownsFor(n)}notifyDraw(e,t){this.endGame=!0;const n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}notifyTimeoutVictory(e,t,n,r){var i=this;return hw(function*(){i.endGame=!0;const s=i.currentPart.setWinnerAndLoser(e,r);i.currentPart=s,yield i.gameService.notifyTimeout(i.currentPartId,t,n,e,r)})()}notifyVictory(t,n){pw(e.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");const r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===TQ.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(zG(r===TQ.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;const i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,t,[0,0],n,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}canAskTakeBack(){return zG(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===KY.NONE}isOpponentWaitingForTakeBackResponse(){const e=this.getTakeBackRequester();return!!e.isPlayer()&&this.isOpponent(e)}getTakeBackRequester(){if(null==this.currentPart)return KY.NONE;const e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?JY.getPlayer(e):KY.NONE}canProposeDraw(){return zG(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&JY.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===KY.NONE}isOpponentWaitingForDrawResponse(){const e=this.getDrawRequester();return e!==KY.NONE&&this.isOpponent(e)}getDrawRequester(){if(null==this.currentPart)return KY.NONE;const e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?JY.getPlayer(e):KY.NONE}onRequest(t,n){var r=this;return hw(function*(){switch(pw(e.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:t,oldPart:n}),t.code){case"TakeBackAsked":case"TakeBackRefused":break;case"TakeBackAccepted":r.takeBackTo(r.currentPart.data.turn);break;case"RematchProposed":r.rematchProposed=!0;const n=JY.getPlayer(t).getOpponent();r.isPlayer(n)&&(pw(e.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0);break;case"RematchAccepted":yield r.router.navigate(["/nextGameLoading"]),yield r.router.navigate(["/play",JY.getTypeGame(t),JY.getPartId(t)]);break;case"DrawProposed":case"DrawRefused":break;case"AddTurnTime":const i=3e4,s=YY.of(t.data.player);r.addTurnTimeTo(s,i);break;case"AddGlobalTime":const o=3e5,a=YY.of(t.data.player);r.addGlobalTimeTo(a,o);break;default:dw.expectToBe(t.code,"DrawAccepted","Unknown RequestType : "+t.code+" for "+JSON.stringify(t)),yield r.acceptDraw()}})()}takeBackTo(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();const t=YY.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}setPlayersDatas(t){pw(e.VERBOSE,{OnlineGameWrapper_setPlayersDatas:t}),this.players=[yw.of(t.data.playerZero),yw.ofNullable(t.data.playerOne)],zG(null!=t.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[t.data.turn%2].get();let n=yw.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=YY.ZERO.value,n=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=YY.ONE.value,n=this.players[0]):this.observerRole=KY.NONE.value,n.isPresent()){const e=e=>{this.opponent=e[0].data},t=new YG(e,e,e=>{throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))});this.opponentSubscription=yw.of(this.userService.observeUserByUsername(n.get(),t))}}onLegalUserMove(t,n){var r=this;return hw(function*(){if(pw(e.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),!r.isOpponentWaitingForTakeBackResponse())return r.updateDBBoard(t,r.msToSubstract,n);r.gameComponent.message("You must answer to take back request")})()}updateDBBoard(t,n,r){var i=this;return hw(function*(){const s=i.gameComponent.encoder.encodeMove(t);pw(e.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+t.toString()+", "+r+")"),i.gameComponent.rules.choose(t);const o=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node);if(o.isEndGame)return o===TQ.DRAW?i.notifyDraw(s,r):i.notifyVictory(s,r);{const e=i.getPlayer();return i.gameService.updateDBBoard(i.currentPartId,e,s,n,r)}})()}resign(){var e=this;return hw(function*(){const t=e.getLastIndex(),n=e.getPlayer(),r=e.players[e.observerRole%2].get(),i=e.players[(e.observerRole+1)%2].get();yield e.gameService.resign(e.currentPartId,t,n,i,r)})()}getLastIndex(){return this.currentPart.data.lastUpdate.index}reachedOutOfTime(t){var n=this;return hw(function*(){pw(e.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+t+")");const r=n.getLastIndex(),i=n.getPlayer();n.stopCountdownsFor(YY.of(t));const s=dw.getNonNullable(n.opponent);if(t===n.observerRole){const e=dw.getNonNullable(s.username);yield n.notifyTimeoutVictory(e,i,r,n.getPlayerName())}else if(zG(!1===n.endGame,"time might be better handled in the future"),n.opponentIsOffline()){const e=dw.getNonNullable(s.username);yield n.notifyTimeoutVictory(n.getPlayerName(),i,t,e),n.endGame=!0}})()}acceptRematch(){var e=this;return hw(function*(){zG(e.isPlaying(),"Non playing should not call acceptRematch");const t=new GG(e.currentPartId,e.currentPart.data);return yield e.gameService.acceptRematch(t,e.getLastIndex(),e.getPlayer()),!0})()}proposeRematch(){var e=this;return hw(function*(){return zG(e.isPlaying(),"Non playing should not call proposeRematch"),yield e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer()),!0})()}proposeDraw(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptDraw(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}refuseDraw(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}askTakeBack(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptTakeBack(){var e=this;return hw(function*(){const t=e.getPlayer();yield e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,t,e.msToSubstract),e.msToSubstract=[0,0]})()}refuseTakeBack(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}startCountDownFor(t){pw(e.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[t.value]=!0,t===YY.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}resumeCountDownFor(t,n=!0){let r;pw(e.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===YY.ZERO?(this.chronoZeroGlobal.changeDuration(dw.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),r=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(dw.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),r=this.chronoOneTurn),n?(r.setDuration(1e3*this.joiner.maximalMoveDuration),r.start()):r.resume()}pauseCountDownsFor(t,n=!0){let r;pw(e.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+t.value+") (turn "+this.currentPart.data.turn+")"),t===YY.ZERO?(this.chronoZeroGlobal.pause(),r=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),r=this.chronoOneTurn),n?r.stop():r.pause()}stopCountdownsFor(t){pw(e.VERBOSE,"cdc::stopCountDownsFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===YY.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}getPlayerNameClass(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}opponentIsOffline(){return!1}canResign(){return zG(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}addGlobalTime(){const e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}addTurnTime(){const e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}addTurnTimeTo(e,t){const n=YY.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===YY.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}addGlobalTimeTo(e,t){e===YY.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}ngOnDestroy(){this.routerEventsSub.unsubscribe(),this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(sc),ua(Ny),ua(e_),ua(VG),ua($Y),ua(QG),ua(rK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){if(1&e&&(xu(Ote,5),xu(Tte,5),xu(Ite,5),xu(kte,5),xu(Ate,5),xu(Mte,5)),2&e){let e;Nu(e=Ru())&&(t.partCreation=e.first),Nu(e=Ru())&&(t.chatComponent=e.first),Nu(e=Ru())&&(t.chronoZeroGlobal=e.first),Nu(e=Ru())&&(t.chronoOneGlobal=e.first),Nu(e=Ru())&&(t.chronoZeroTurn=e.first),Nu(e=Ru())&&(t.chronoOneTurn=e.first)}},features:[Go],decls:5,vars:4,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,S,b,P,O,T,I;return e=$localize`vs.`,t=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,n=$localize`It is your turn.`,r=$localize`It is ${"\ufffd0\ufffd"}:INTERPOLATION:'s turn.`,i=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Resign`,a=$localize`Propose a draw`,l=$localize`Accept draw`,c=$localize`Reject draw`,u=$localize`Pass a turn`,h=$localize`Accept take back`,d=$localize`Reject take back`,p=$localize`Ask to take back one move`,f=$localize`Draw`,g=$localize`You agreed to draw.`,m=$localize`Your draw proposal has been accepted.`,y=$localize`Players agreed to draw.`,v=$localize`You won.`,_=$localize`You lost.`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won.`,E=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit. You won.`,w=$localize`You reached your time limit.`,S=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit.`,b=$localize`You resigned.`,P=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has resigned.`,O=$localize`Go back to the game list`,T=$localize`Propose to play again`,I=$localize`Accept to play again`,[["id","partCreation",3,"partId","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],e,["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],t,["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],n,r,["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],i,["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],s,["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],o,["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],a,["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],l,["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],c,["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],u,["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],h,["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],d,["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],p,["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],f,["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],g,["id","yourOpponentAgreedToDrawIndicator",1,"title"],m,["id","playersAgreedToDraw",1,"title"],y,["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],v,[1,"title"],_,C,E,w,S,["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],b,P,["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],O,["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],T,["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],I]},template:function(e,t){1&e&&(la(0,Nte,2,1,"app-part-creation",0),la(1,mne,29,27,"div",1),pa(2,"div",2),pa(3,"div",3),ga(4,"app-chat",4),fa(),fa()),2&e&&(ha("ngIf",!1===t.gameStarted),Ts(1),ha("ngIf",t.gameStarted),Ts(3),ha("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[Hd,Uee,Ste,Pte,Bd,Kee,n_],encapsulation:2}),e})();function Cne(e,t){if(1&e&&(pa(0,"option",25),Fa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Ua(e.name)}}function Ene(e,t){if(1&e&&(pa(0,"option",25),ql(1,29),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),Wl(e),jl(1)}}const wne=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function Sne(e,t){if(1&e){const e=va();pa(0,"select",26),Ea("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[0]=t})("change",function(){return Gt(e),ba(2).updatePlayer(0)}),pa(1,"option",27),ql(2,28),fa(),la(3,Ene,2,2,"option",16),fa()}2&e&&(ha("ngModel",ba(2).aiDepths[0]),Ts(3),ha("ngForOf",lu(2,wne)))}function bne(e,t){if(1&e&&(pa(0,"p",30),ql(1,31),fa()),2&e){const e=ba(2);Ts(1),Wl(e.gameComponent.scores.get()[0]),jl(1)}}function Pne(e,t){if(1&e&&(pa(0,"option",25),Fa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Ua(e.name)}}function One(e,t){if(1&e&&(pa(0,"option",25),ql(1,34),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),Wl(e),jl(1)}}function Tne(e,t){if(1&e){const e=va();pa(0,"select",32),Ea("ngModelChange",function(t){return Gt(e),ba(2).aiDepths[1]=t})("change",function(){return Gt(e),ba(2).updatePlayer(1)}),pa(1,"option",27),ql(2,33),fa(),la(3,One,2,2,"option",16),fa()}2&e&&(ha("ngModel",ba(2).aiDepths[1]),Ts(3),ha("ngForOf",lu(2,wne)))}function Ine(e,t){if(1&e&&(pa(0,"p",35),ql(1,36),fa()),2&e){const e=ba(2);Ts(1),Wl(e.gameComponent.scores.get()[1]),jl(1)}}function kne(e,t){if(1&e&&(pa(0,"h4"),ql(1,40),fa()),2&e){const e=ba(3);Ts(1),Wl(e.winner.get()),jl(1)}}function Ane(e,t){1&e&&(pa(0,"h4",41),ql(1,42),fa())}function Mne(e,t){if(1&e&&(pa(0,"div",37),la(1,kne,2,1,"h4",38),la(2,Ane,2,0,"h4",39),fa()),2&e){const e=ba(2);Ts(1),ha("ngIf",e.winner.isPresent()),Ts(1),ha("ngIf",e.winner.isAbsent())}}function Nne(e,t){if(1&e){const e=va();pa(0,"div",6),pa(1,"div",7),pa(2,"p",8),ql(3,9),fa(),fa(),pa(4,"div",10),pa(5,"div",11),pa(6,"div",12),pa(7,"select",13),Ea("change",function(){return Gt(e),ba().updatePlayer(0)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[0]=t}),pa(8,"option",14),ql(9,15),fa(),la(10,Cne,2,2,"option",16),fa(),fa(),pa(11,"div",12),la(12,Sne,4,3,"select",17),fa(),la(13,bne,2,1,"p",18),fa(),pa(14,"div",19),pa(15,"div",12),pa(16,"select",20),Ea("change",function(){return Gt(e),ba().updatePlayer(1)})("ngModelChange",function(t){return Gt(e),ba().playerSelection[1]=t}),pa(17,"option",14),ql(18,21),fa(),la(19,Pne,2,2,"option",16),fa(),fa(),pa(20,"div",12),la(21,Tne,4,3,"select",22),fa(),la(22,Ine,2,1,"p",23),fa(),fa(),la(23,Mne,3,2,"div",24),fa()}if(2&e){const e=ba();Ts(3),Wl(e.gameComponent.rules.node.gameState.turn+1),jl(3),Ts(4),ha("ngModel",e.playerSelection[0]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[0].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(3),ha("ngModel",e.playerSelection[1]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[1].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(1),ha("ngIf",e.endGame)}}function xne(e,t){if(1&e&&(ma(0),Fa(1),ga(2,"br"),ya()),2&e){const e=t.$implicit,n=ba(3);Ts(1),Ba(" ",e.name+": "+e.getBoardValue(n.gameComponent.rules.node)," ")}}function Rne(e,t){if(1&e&&(ma(0),la(1,xne,3,1,"ng-container",48),Fa(2),ga(3,"br"),Fa(4),ga(5,"br"),ya()),2&e){const e=ba(2);Ts(1),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(1),Ba(" Created ",e.getCreatedNodes()," nodes."),Ts(2),Ba(" Minimax time: ",e.getMinimaxTime(),"ms.")}}function Dne(e,t){if(1&e){const e=va();pa(0,"button",49),Ea("click",function(){return Gt(e),ba(2).gameComponent.pass()}),ql(1,50),fa()}}function Lne(e,t){if(1&e){const e=va();pa(0,"button",51),Ea("click",function(){return Gt(e),ba(2).takeBack()}),ql(1,52),fa()}}function Fne(e,t){if(1&e){const e=va();pa(0,"div",43),la(1,Rne,6,3,"ng-container",38),la(2,Dne,2,0,"button",44),la(3,Lne,2,0,"button",45),pa(4,"button",46),Ea("click",function(){return Gt(e),ba().restartGame()}),ql(5,47),fa(),fa()}if(2&e){const e=ba();Ts(1),ha("ngIf",e.gameComponent.rules.node.move),Ts(1),ha("ngIf",!1===e.endGame&&e.gameComponent.canPass),Ts(1),ha("ngIf",e.canTakeBack())}}let Une=(()=>{class e extends Qee{constructor(t,n,r,i,s,o){super(t,n,r,i,s),this.cdr=o,this.aiDepths=["0","0"],this.playerSelection=["human","human"],this.winner=yw.empty(),this.botTimeOut=1e3,this.players=[yw.of(this.playerSelection[0]),yw.of(this.playerSelection[1])],pw(e.VERBOSE,"LocalGameWrapper.constructor")}getCreatedNodes(){return PQ.createdNodes}getMinimaxTime(){return PQ.minimaxTime}ngAfterViewInit(){var e=this;setTimeout(hw(function*(){(yield e.afterGameIncluderViewInit())&&(e.restartGame(),e.cdr.detectChanges())}),1)}updatePlayer(e){this.players[e]=yw.of(this.playerSelection[e]),this.proposeAIToPlay()}onLegalUserMove(t){var n=this;return hw(function*(){pw(e.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),n.gameComponent.rules.choose(t),n.updateBoard(),n.proposeAIToPlay()})()}updateBoard(){this.gameComponent.updateBoard();const e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner.isPlayer()&&(this.winner=yw.of($localize`Player ${e.winner.value+1}`)))}proposeAIToPlay(){var e=this;const t=this.getPlayingAI();t.isPresent()&&window.setTimeout(hw(function*(){yield e.doAIMove(t.get())}),this.botTimeOut)}getPlayingAI(){if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return yw.empty();const e=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[e]?yw.empty():yw.ofNullable(this.gameComponent.availableMinimaxes.find(t=>this.players[e].equalsValue(t.name)))}doAIMove(e){var t=this;return hw(function*(){const n=t.gameComponent.rules;zG(n.getGameStatus(n.node)===TQ.ONGOING,"IA should not try to play when game is over!");const r=Number.parseInt(t.aiDepths[n.node.gameState.turn%2%2]),i=n.node.findBestMove(r,e,!0);return n.choose(i)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),FG.SUCCESS):(t.messageDisplayer.criticalMessage($localize`The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!`),$G.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:i.toString()}))})()}canTakeBack(){return this.gameComponent.rules.node.gameState.turn>0}takeBack(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}isAITurn(){return this.getPlayingAI().isPresent()}restartGame(){const e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new OQ(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=yw.empty(),this.proposeAIToPlay()}getPlayerName(){return"human"}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(sc),ua(Ny),ua($Y),ua(e_),ua(VG),ua(Dc))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-wrapper"]],features:[Go],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Turn n${"\ufffd0\ufffd"}:INTERPOLATION:`,t=$localize`Human`,n=$localize`Human`,r=$localize`Pick the level`,i=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Pick the level`,a=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,l=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,c=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won`,u=$localize`Draw`,h=$localize`Start a new game`,d=$localize`Pass a turn`,p=$localize`Take back move`,[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],e,["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],t,[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],n,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],r,i,["id","scoreOne",1,"block"],s,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],o,a,["id","scoreZero",1,"block"],l,["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],c,["id","draw"],u,[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],h,[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],d,["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],p]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),la(2,Nne,24,10,"div",2),la(3,Fne,6,3,"div",3),fa(),pa(4,"div",4),pa(5,"div",5),ga(6,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(2),ha("ngIf",t.gameComponent),Ts(1),ha("ngIf",t.gameComponent),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[Hd,Bd,Kee,ug,Cf,Qf,hg,gg,$d],encapsulation:2,changeDetection:0}),e})(),Bne=(()=>{class e{}return e.STEP_FINISHED=()=>$localize`Step finished!`,e.INFORMATIONAL_STEP=()=>$localize`This step is not expecting any move from your part.`,e})();function Vne(e,t){if(1&e&&(pa(0,"div",20),pa(1,"div",21),ql(2,22),fa(),pa(3,"div",23),Fa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ua(e.currentReason.get())}}function $ne(e,t){if(1&e){const e=va();pa(0,"button",24),Ea("click",function(){return Gt(e),ba().retry()}),ql(1,25),fa()}}function zne(e,t){1&e&&(ma(0),ql(1,30),ya())}function Hne(e,t){1&e&&(ma(0),ql(1,31),ya())}function Gne(e,t){if(1&e&&la(0,Hne,2,0,"ng-container",27),2&e){ba();const e=ca(5),t=ba();ha("ngIf",t.stepFinished&&t.stepFinished[t.stepIndex])("ngIfElse",e)}}function qne(e,t){1&e&&(ma(0),ql(1,32),ya())}function Wne(e,t){if(1&e){const e=va();pa(0,"button",26),Ea("click",function(){return Gt(e),ba().next()}),la(1,zne,2,0,"ng-container",27),la(2,Gne,1,2,"ng-template",null,28,Lu),la(4,qne,2,0,"ng-template",null,29,Lu),fa()}if(2&e){const e=ca(3),t=ba();Ts(1),ha("ngIf",t.steps[t.stepIndex]&&t.steps[t.stepIndex].isInformation())("ngIfElse",e)}}function jne(e,t){if(1&e){const e=va();pa(0,"button",33),Ea("click",function(){return Gt(e),ba().start()}),ql(1,34),fa()}}function Zne(e,t){if(1&e){const e=va();pa(0,"button",35),Ea("click",function(){return Gt(e),ba().playLocally()}),ql(1,36),fa()}}function Yne(e,t){if(1&e){const e=va();pa(0,"button",37),Ea("click",function(){return Gt(e),ba().createGame()}),ql(1,38),fa()}}function Kne(e,t){if(1&e){const e=va();pa(0,"button",39),Ea("click",function(){return Gt(e),ba().showSolution()}),ql(1,40),fa()}}function Jne(e,t){if(1&e&&(ma(0),pa(1,"option",42),Fa(2),fa(),ya()),2&e){const e=ba(),t=e.index,n=e.$implicit;Ts(1),Ta("id","step_",t,""),ha("value",t),Ts(1),Ua(n.title)}}function Qne(e,t){1&e&&(ma(0),Fa(1,"v "),ya())}function Xne(e,t){1&e&&Fa(0,"x ")}function ere(e,t){if(1&e&&(pa(0,"option",43),la(1,Qne,2,0,"ng-container",27),la(2,Xne,1,0,"ng-template",null,44,Lu),pa(4,"span",45),Fa(5),fa(),fa()),2&e){const e=ca(3),t=ba(),n=t.index,r=t.$implicit,i=ba();ha("value",n),Ts(1),ha("ngIf",i.stepFinished[n])("ngIfElse",e),Ts(3),Ta("id","step_",n,""),Ts(1),Ua(r.title)}}function tre(e,t){if(1&e&&(ma(0),la(1,Jne,3,3,"ng-container",27),la(2,ere,6,5,"ng-template",null,41,Lu),ya()),2&e){const e=t.index,n=ca(3),r=ba();Ts(1),ha("ngIf",e===r.stepIndex)("ngIfElse",n)}}let nre=(()=>{class e extends Qee{constructor(t,n,r,i,s,o){super(t,n,o,r,i),this.cdr=s,this.connectedUserService=o,this.COMPLETED_TUTORIAL_MESSAGE=$localize`Congratulations, you completed the tutorial.`,this.steps=[],this.successfulSteps=0,this.stepIndex=-1,this.currentMessage="",this.currentReason=yw.empty(),this.moveAttemptMade=!1,this.stepFinished=[],this.tutorialOver=!1,pw(e.VERBOSE,"TutorialGameWrapperComponent.constructor")}getNumberOfSteps(){return this.steps.length}getCurrentStepTitle(){return this.steps.length>0?this.steps[this.stepIndex].title:""}ngAfterViewInit(){var t=this;return hw(function*(){pw(e.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),(yield t.afterGameIncluderViewInit())&&t.start()})()}start(){this.startTutorial(this.gameComponent.tutorial)}startTutorial(t){pw(e.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:t}}),this.steps=t,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}getCompletionArray(){return this.steps.map(()=>!1)}changeStep(e){this.showStep(Number.parseInt(e.target.value,10))}showStep(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.showStep("+t+")"),this.moveAttemptMade=!1,this.stepFinished[t]=!1,this.updateSuccessCount(),this.stepIndex=t;const n=this.steps[this.stepIndex];this.currentMessage=n.instruction,this.currentReason=yw.empty(),this.gameComponent.rules.node=new OQ(n.state,yw.empty(),n.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}onLegalUserMove(t){var n=this;return hw(function*(){pw(e.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:t}});const r=n.steps[n.stepIndex];if(zG(n.gameComponent.rules.choose(t),"It should be impossible to call onLegalUserMove with an illegal move"),pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),n.gameComponent.updateBoard(),n.moveAttemptMade=!0,r.isPredicate()){const e=n.gameComponent.rules.node.gameState,i=dw.getNonNullable(r.predicate)(t,e);i.isSuccess()?n.showStepSuccess(r.getSuccessMessage()):n.currentReason=yw.of(i.getReason())}else if(r.isAnyMove())pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(r.getSuccessMessage());else{zG(r.isMove(),"cannot reach here with a click step");const i=r;i.acceptedMoves.some(e=>e.equals(t))?(pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(i.getSuccessMessage())):(pw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),n.currentReason=yw.of(i.getFailureMessage()))}n.cdr.detectChanges()})()}retry(){pw(e.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}onUserClick(t){if(pw(e.VERBOSE,"tutorialGameWrapper.onUserClick("+t+")"),this.currentReason=yw.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return FG.failure(Bne.STEP_FINISHED());const n=this.steps[this.stepIndex];return n.isClick()?(this.gameComponent.updateBoard(),this.moveAttemptMade=!0,dw.getNonNullable(n.acceptedClicks).some(e=>e===t)?this.showStepSuccess(n.getSuccessMessage()):this.currentMessage=n.getFailureMessage(),FG.SUCCESS):n.isMove()||n.isPredicate()||n.isAnyMove()?(window.setTimeout(()=>{this.cdr.detectChanges()},10),FG.SUCCESS):FG.failure(Bne.INFORMATIONAL_STEP())}onCancelMove(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+t+")"),void 0!==t&&(this.currentReason=yw.of(t)),this.cdr.detectChanges()}showStepSuccess(t){pw(e.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=t,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}updateSuccessCount(){let e=0;for(const t of this.stepFinished)t&&e++;this.successfulSteps=e}next(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{let e=(this.stepIndex+1)%this.steps.length;for(;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}showSolution(){var t=this;return hw(function*(){pw(e.VERBOSE,"tutorialGameWrapper.showSolution()");const n=t.steps[t.stepIndex];zG(n.hasSolution(),"step must have solution");const r=n,i=r.getSolution();i instanceof _Q?(t.showStep(t.stepIndex),t.gameComponent.rules.choose(i),t.gameComponent.updateBoard()):(t.showStep(t.stepIndex),window.document.querySelector(i).dispatchEvent(new Event("click"))),t.currentMessage=r.getSuccessMessage(),t.moveAttemptMade=!0,t.cdr.detectChanges()})()}playLocally(){var e=this;return hw(function*(){const t=dw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/local",t])})()}createGame(){var e=this;return hw(function*(){const t=dw.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/play",t])})()}getPlayerName(){return""}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(sc),ua(Ny),ua(e_),ua(VG),ua(Dc),ua($Y))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[Go],decls:22,vars:15,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Failure`,t=$localize`Try again`,n=$localize`Ok`,r=$localize`Continue`,i=$localize`Skip`,s=$localize`Try again`,o=$localize`Play locally`,a=$localize`Create an online game`,l=$localize`See solution`,[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],e,["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],t,["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],n,r,i,["id","restartButton",1,"button",3,"click"],s,["id","playLocallyButton",1,"button",3,"click"],o,["id","playOnlineButton",1,"button",3,"click"],a,["id","showSolutionButton",1,"button",3,"click"],l,["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),ga(3,"progress",3),pa(4,"div",4),pa(5,"p",5),Fa(6),fa(),ga(7,"p",6),fa(),la(8,Vne,5,1,"div",7),pa(9,"div",8),la(10,$ne,2,0,"button",9),la(11,Wne,6,2,"button",10),la(12,jne,2,0,"button",11),la(13,Zne,2,0,"button",12),la(14,Yne,2,0,"button",13),la(15,Kne,2,0,"button",14),pa(16,"div",15),pa(17,"select",16),Ea("change",function(e){return t.changeStep(e)}),la(18,tre,4,2,"ng-container",17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",18),pa(20,"div",19),ga(21,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(3),ra("value",t.successfulSteps)("max",t.getNumberOfSteps()),Ts(3),$a("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),Ts(1),ha("innerHTML",t.currentMessage,vi),Ts(1),ha("ngIf",t.currentReason.isPresent()),Ts(2),ha("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),Ts(1),ha("ngIf",!1===t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),Ts(3),ha("ngForOf",t.steps),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[Hd,$d,Bd,Kee,hg,gg],encapsulation:2,changeDetection:0}),e})();function rre(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),ql(2,37),fa(),pa(3,"div",38),Fa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ua(e.errorMessage)}}const ire=function(){return["/login"]};let sre=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.faEye=uK,this.registrationForm=new qf({email:new Gf,username:new Gf,password:new Gf})}registerWithEmail(){var e=this;return hw(function*(){const t=e.registrationForm.value.username,n=e.registrationForm.value.email,r=e.registrationForm.value.password;if(null==t||null==n||null==r)e.errorMessage=$localize`There are missing fields in the registration form, please check that you filled in all fields.`;else{const i=yield e.authService.doRegister(t,n,r);if(i.isSuccess()){const t=yield e.authService.sendEmailVerification();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()}else e.errorMessage=i.getReason()}})()}registerWithGoogle(){var e=this;return hw(function*(){const t=yield e.authService.doGoogleLogin();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()})()}getPasswordHelpClass(){const e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}canRegister(){const e=this.registrationForm.value.password??"";return!(""===(this.registrationForm.value.email??"")||""===(this.registrationForm.value.username??"")||""===e||e.length<6)}}return e.\u0275fac=function(t){return new(t||e)(ua($Y),ua(e_))},e.\u0275cmp=Xe({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Registering`,t=$localize`Email`,n=$localize`Email`,r=$localize`A confirmation email will be sent to validate your account.`,i=$localize`Username`,s=$localize`Username`,o=$localize`Password`,a=$localize`Password`,l=$localize`The password should be at least 6 characters long`,c=$localize`Register`,u=$localize`Register with Google`,h=$localize`Have an account?`,d=$localize`Log in`,p=$localize`Registration error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",n,"type","email","autofocus","","required","",1,"input"],[1,"help"],r,["for","username",1,"label"],i,["id","username","formControlName","username","name","username","placeholder",s,"type","text","required","",1,"input"],["for","password",1,"label"],o,[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",a,"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],l,["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],c,[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],u,[1,"help","level-right"],h,[3,"routerLink"],d,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],p,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),ql(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),ql(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),pa(12,"p",12),ql(13,13),fa(),fa(),fa(),fa(),fa(),pa(14,"div",4),pa(15,"div",5),pa(16,"label",14),ql(17,15),fa(),fa(),pa(18,"div",8),pa(19,"div",9),pa(20,"div",10),ga(21,"input",16),fa(),fa(),fa(),fa(),pa(22,"div",4),pa(23,"div",5),pa(24,"label",17),ql(25,18),fa(),fa(),pa(26,"div",8),pa(27,"div",9),pa(28,"div",19),ga(29,"input",20),pa(30,"span",21),ga(31,"fa-icon",22),fa(),pa(32,"p",23),ql(33,24),fa(),fa(),fa(),fa(),fa(),pa(34,"div",4),ga(35,"div",5),pa(36,"div",8),pa(37,"div",9),pa(38,"div",10),pa(39,"button",25),Ea("click",function(){return t.registerWithEmail()}),ql(40,26),fa(),fa(),fa(),fa(),fa(),pa(41,"div",4),ga(42,"div",5),pa(43,"div",27),la(44,rre,5,1,"div",28),fa(),fa(),pa(45,"div",4),ga(46,"div",5),pa(47,"div",8),pa(48,"button",29),Ea("click",function(){return t.registerWithGoogle()}),ql(49,30),fa(),fa(),fa(),pa(50,"p",31),ma(51),ql(52,32),ya(),Fa(53,"\xa0 "),pa(54,"a",33),ql(55,34),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.registrationForm),Ts(28),ha("icon",t.faEye),Ts(1),ha("ngClass",t.getPasswordHelpClass()),Ts(7),ha("disabled",!t.canRegister()),Ts(5),ha("ngIf",t.errorMessage),Ts(10),ha("routerLink",lu(6,ire)))},directives:[Xf,Ef,sg,Hp,Cf,ag,Eee,yg,FJ,wee,Bd,Hd,r_],encapsulation:2}),e})(),ore=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}playLocally(){var e=this;return hw(function*(){yield e.router.navigate(["local/"+e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(e_))},e.\u0275cmp=Xe({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Play offline`,[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.playLocally()}),ql(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[mee],encapsulation:2}),e})(),are=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}launchTutorial(){var e=this;return hw(function*(){yield e.router.navigate(["/tutorial/",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(e_))},e.\u0275cmp=Xe({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Learn the rules`,[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.launchTutorial()}),ql(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[mee],encapsulation:2}),e})(),lre=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Xe({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){let e;return e=$localize`The replay game is loading, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),ql(1,0),fa())},encapsulation:2}),e})();const cre={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1};let ure=(()=>{class e{constructor(e){this.authService=e}canActivate(){var e=this;return hw(function*(){return new Promise(t=>{e.userSub=e.authService.getUserObs().subscribe(function(){var n=hw(function*(n){yield e.evaluateUserPermission(n).then(t)});return function(e){return n.apply(this,arguments)}}())})})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or($Y))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),hre=(()=>{class e extends ure{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return hw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account")})()}}return e.\u0275fac=function(t){return new(t||e)(Or($Y),Or(e_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function dre(e,t){1&e&&(pa(0,"p",20),ql(1,21),fa())}function pre(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"p",8),ql(2,9),fa(),pa(3,"div",10),pa(4,"p",11),ql(5,12),fa(),pa(6,"button",13),Ea("click",function(){return Gt(e),ba().finalizeEmailVerification()}),ql(7,14),fa(),fa(),pa(8,"div",15),pa(9,"p",11),ql(10,16),fa(),pa(11,"button",17),Ea("click",function(){return Gt(e),ba().sendEmailVerification()}),ql(12,18),fa(),fa(),la(13,dre,2,0,"p",19),fa()}if(2&e){const e=ba();Ts(2),Wl(e.emailAddress),jl(2),Ts(11),ha("ngIf",e.success)}}function fre(e,t){if(1&e){const e=va();pa(0,"div",24),pa(1,"div",8),ql(2,25),fa(),pa(3,"form",26),pa(4,"div",27),pa(5,"div",28),ga(6,"input",29),fa(),pa(7,"div",28),pa(8,"button",30),Ea("click",function(){Gt(e);const t=ba(2);return t.pickUsername(t.usernameForm.value)}),ql(9,31),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ba(2);Ts(3),ha("formGroup",e.usernameForm)}}const gre=function(){return["/lobby"]};function mre(e,t){1&e&&(pa(0,"div",32),Hl(1,33),ga(2,"a",34),Gl(),fa()),2&e&&(Ts(2),ha("routerLink",lu(1,gre)))}function yre(e,t){if(1&e&&(ma(0),la(1,fre,10,1,"div",22),la(2,mre,3,2,"div",23),ya()),2&e){const e=ba();Ts(1),ha("ngIf",!e.success),Ts(1),ha("ngIf",e.success)}}function vre(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),Fa(2),fa(),fa()),2&e){const e=ba();Ts(2),Ua(e.errorMessage)}}let _re=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new qf({username:new Gf})}ngOnInit(){var e=this;return hw(function*(){e.userSub=e.authService.getUserObs().subscribe(function(){var t=hw(function*(t){e.emailAddress=t.email.get(),t.username.isAbsent()?e.verificationType="enter-username":(e.verificationType="send-email",!0===e.triedToFinalize&&!1===t.verified&&(e.errorMessage=$localize`You have not verified your email! Click on the link in the verification email.`),!0===t.verified&&(yield e.router.navigate(["/lobby"])))});return function(e){return t.apply(this,arguments)}}())})()}pickUsername(e){var t=this;return hw(function*(){const n=yield t.authService.setUsername(e.username);n.isSuccess()?t.success=!0:t.errorMessage=n.getReason()})()}sendEmailVerification(){var e=this;return hw(function*(){const t=yield e.authService.sendEmailVerification();t.isSuccess()?e.success=!0:e.errorMessage=t.getReason()})()}finalizeEmailVerification(){var e=this;return hw(function*(){e.triedToFinalize=!0,yield e.authService.reloadUser(),window.open(window.location.href,"_self")})()}ngOnDestroy(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua($Y),ua(e_))},e.\u0275cmp=Xe({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Account verification`,t=$localize`In order to finalize your account, you must click on the link that you should have received on your email address (${"\ufffd0\ufffd"}:INTERPOLATION:). The email could be in your spam folder.`,n=$localize`Once you have verified your email, click on the following button:`,r=$localize`Finalize email verification`,i=$localize`If you have not received the verification email, click on the following button:`,s=$localize`Send verification email again`,o=$localize`The email has been sent`,a=$localize`In order to finalize your account, you must choose a username.`,l=$localize`Username`,c=$localize`Pick username`,u=$localize`Your account has now been finalized, you can go back to the ${"\ufffd#2\ufffd"}:START_LINK:list of games${"\ufffd/#2\ufffd"}:CLOSE_LINK:.`,[[1,"box"],[1,"message","is-info"],[1,"message-header"],e,["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],t,[1,"block","level-left"],[1,"level-item"],n,["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],r,[1,"level-left"],i,["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],s,["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],o,["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],a,[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",l,"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],c,["id","success",1,"message-body"],u,[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),ql(3,3),fa(),la(4,pre,14,2,"div",4),la(5,yre,3,2,"ng-container",5),fa(),la(6,vre,3,1,"div",6),fa()),2&e&&(Ts(4),ha("ngIf","send-email"===t.verificationType),Ts(1),ha("ngIf","enter-username"===t.verificationType),Ts(1),ha("ngIf",t.errorMessage))},directives:[Hd,Xf,Ef,sg,Hp,yg,Cf,ag,r_],encapsulation:2}),e})(),Cre=(()=>{class e extends ure{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return hw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or($Y),Or(e_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ere=(()=>{class e extends ure{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return hw(function*(){return!1===e.isConnected()||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or($Y),Or(e_))},e.\u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function wre(e,t){1&e&&(pa(0,"p",12),ql(1,13),fa())}function Sre(e,t){if(1&e&&(pa(0,"div",14),pa(1,"div",15),ql(2,16),fa(),pa(3,"div",17),Fa(4),fa(),fa()),2&e){const e=ba();Ts(4),Ua(e.errorMessage.get())}}const bre=function(){return{standalone:!0}};let Pre=(()=>{class e{constructor(e){this.authService=e,this.success=!1,this.errorMessage=yw.empty(),this.email=""}resetPassword(){var e=this;return hw(function*(){zG(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=yw.empty(),e.success=!1;const t=yield e.authService.sendPasswordResetEmail(e.email);t.isSuccess()?e.success=!0:e.errorMessage=yw.of(t.getReason())})()}}return e.\u0275fac=function(t){return new(t||e)(ua($Y))},e.\u0275cmp=Xe({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){let e,t,n,r,i,s;return e=$localize`Password reset`,t=$localize`Email`,n=$localize`An email will be sent with instruction to reset your password.`,r=$localize`Reset password`,i=$localize`The email has been sent, please follow the instructions from that email.`,s=$localize`Error`,[[1,"box"],[1,"title"],e,[1,"field"],[1,"control"],["id","email","name","email","placeholder",t,"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],n,["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],r,["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],i,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],s,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),ql(2,2),fa(),pa(3,"div",3),pa(4,"div",4),pa(5,"input",5),Ea("ngModelChange",function(e){return t.email=e}),fa(),pa(6,"p",6),ql(7,7),fa(),la(8,wre,2,0,"p",8),fa(),fa(),pa(9,"button",9),Ea("click",function(){return t.resetPassword()}),ql(10,10),fa(),la(11,Sre,5,1,"div",11),fa()),2&e&&(Ts(5),ha("ngModel",t.email)("ngModelOptions",lu(5,bre)),Ts(3),ha("ngIf",t.success),Ts(1),ha("disabled",""===t.email),Ts(2),ha("ngIf",t.errorMessage.isPresent()))},directives:[Hp,Eee,yg,Cf,Qf,Hd],encapsulation:2}),e})();function Ore(e,t){if(1&e&&(pa(0,"option",13),Fa(1),fa()),2&e){const e=t.$implicit,n=ba();ha("value",e.value)("selected",e.value===n.currentTheme),Ts(1),Ba(" ",e.name," ")}}function Tre(e,t){if(1&e&&(pa(0,"option",13),Fa(1),fa()),2&e){const e=t.$implicit,n=ba();ha("value",e.value)("selected",e.value===n.currentLanguage),Ts(1),Ba(" ",e.name," ")}}let Ire=(()=>{class e{constructor(e,t){this.userSettingsService=e,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize`Light`},{value:"dark",name:$localize`Dark`}],this.currentTheme=t.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}changeLanguage(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}changeTheme(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}reload(){window.open(window.location.href,"_self")}}return e.\u0275fac=function(t){return new(t||e)(ua(sK),ua(oK))},e.\u0275cmp=Xe({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){let e,t,n;return e=$localize`User settings`,t=$localize`Theme`,n=$localize`Language`,[[1,"box"],[1,"title"],e,[1,"field"],["for","theme",1,"label"],t,[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],n,["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),ql(2,2),fa(),pa(3,"div",3),pa(4,"label",4),ql(5,5),fa(),pa(6,"div",6),pa(7,"div",7),pa(8,"select",8),Ea("change",function(e){return t.changeTheme(e)}),la(9,Ore,2,3,"option",9),fa(),fa(),fa(),fa(),pa(10,"div",3),pa(11,"label",10),ql(12,11),fa(),pa(13,"div",6),pa(14,"div",7),pa(15,"select",12),Ea("change",function(e){return t.changeLanguage(e)}),la(16,Tre,2,3,"option",9),fa(),fa(),fa(),fa(),fa()),2&e&&(Ts(9),ha("ngForOf",t.availableThemes),Ts(7),ha("ngForOf",t.availableLanguages))},directives:[$d,hg,gg],encapsulation:2}),e})(),kre=(()=>{class e{}return e.ALREADY_INGAME=()=>$localize`You are already in a game. Finish it or cancel it first.`,e})(),Are=(()=>{class e{constructor(e,t,n,r,i,s){this.route=e,this.router=t,this.connectedUserService=n,this.messageDisplayer=r,this.partDAO=i,this.gameService=s}ngOnInit(){var e=this;return hw(function*(){yield e.createGameAndRedirectOrShowError(e.extractGameFromURL())})()}extractGameFromURL(){return dw.getNonNullable(this.route.snapshot.paramMap.get("compo"))}createGameAndRedirectOrShowError(e){var t=this;return hw(function*(){const n=t.connectedUserService.user.get();zG(n.isConnected(),"User must be connected and have a username to reach this page");const r=n.toMinimalUser();if(!1===t.gameExists(e))return yield t.router.navigate(["/notFound",Jee.NO_MATCHING_GAME(e)],{skipLocationChange:!0}),!1;if(yield t.canCreateOnlineGame(r.name)){const n=yield t.gameService.createPartJoinerAndChat(r,e);return yield t.router.navigate(["/play",e,n]),!0}return t.messageDisplayer.infoMessage(kre.ALREADY_INGAME()),yield t.router.navigate(["/lobby"]),!1})()}gameExists(e){return yw.ofNullable(gee.ALL_GAMES().find(t=>t.urlName===e)).isPresent()}canCreateOnlineGame(e){var t=this;return hw(function*(){return!1===(yield t.partDAO.userHasActivePart(e))})()}}return e.\u0275fac=function(t){return new(t||e)(ua(Ny),ua(e_),ua($Y),ua(VG),ua(qG),ua(rK))},e.\u0275cmp=Xe({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){let e;return e=$localize`Creating online game, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),ql(1,0),fa())},encapsulation:2}),e})();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[Ya.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),qa[t]=e,n&&(qa[t][Ya.ExtraData]=n)}(e,void 0,void 0)}(cw());const Mre=[{path:"login",component:Oee},{path:"lobby",component:jee,canActivate:[hre]},{path:"settings",component:Ire},{path:"register",component:sre,canActivate:[Ere]},{path:"reset-password",component:Pre,canActivate:[Ere]},{path:"notFound/:message",component:Zee},{path:"nextGameLoading",component:lre,canActivate:[hre]},{path:"verify-account",component:_re,canActivate:[Cre]},{path:"play",component:Iee,canActivate:[hre]},{path:"play/:compo",component:Are,canActivate:[hre]},{path:"play/:compo/:id",component:_ne,canActivate:[hre]},{path:"local",component:ore},{path:"local/:compo",component:Une},{path:"tutorial",component:are},{path:"tutorial/:compo",component:nre},{path:"",component:Cee},{path:"**",component:Zee}];class Nre{static app(){return function(e,...t){return{ngModule:kT,providers:[{provide:PT,useFactory:IT(e),multi:!0,deps:[ih,zo,mT,...t]}]}}(()=>(cre.useEmulators&&(cre.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),AT(cre.firebaseConfig)))}static firestore(){return function(e,...t){return{ngModule:yG,providers:[{provide:pG,useFactory:fG(e),multi:!0,deps:[ih,zo,mT,bT,[new Nr,NM],[new Nr,cI],...t]}]}}(()=>{const e=PG(),t=e.toJSON().settings.host;return cre.useEmulators&&"localhost:8080"!==t&&CG(e,"localhost",8080),e})}static database(){return function(e,...t){return{ngModule:NY,providers:[{provide:IY,useFactory:kY(e),multi:!0,deps:[ih,zo,mT,bT,[new Nr,NM],[new Nr,cI],...t]}]}}(()=>{const e=RY();return cre.useEmulators&&!1===e._instanceStarted&&xY(e,"localhost",9e3),e})}static auth(){return function(e,...t){return{ngModule:FM,providers:[{provide:xM,useFactory:RM(e),multi:!0,deps:[ih,zo,mT,bT,[new Nr,cI],...t]}]}}(()=>{const e=VM();return cre.useEmulators&&null==e.config.emulator&&UM(e,"http://localhost:9099",{disableWarnings:!0}),e})}}let xre=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e,bootstrap:[KJ]}),e.\u0275inj=be({providers:[$Y,rK,nK,QG,ZG,qG,oK,{provide:Wu,useValue:iK.getLocale()}],imports:[[Nre.app(),Nre.firestore(),Nre.auth(),Nre.database(),kp,om,g_.forRoot(Mre,{useHash:!1}),wg,Eg,aw,UJ]]}),e})();"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self;"undefined"!=typeof global&&global;class Rre{constructor(e){this.digits=e}static zero(){return new Rre([0])}static one(){return new Rre([1])}clone(){return new Rre(this.digits.slice())}add(e){const t=this.clone();return t.addToSelf(e),t}addToSelf(e){const t=Math.max(this.digits.length,e.digits.length);let n=0;for(let r=0;r<t;r++){let t=n;r<this.digits.length&&(t+=this.digits[r]),r<e.digits.length&&(t+=e.digits[r]),t>=10?(this.digits[r]=t-10,n=1):(this.digits[r]=t,n=0)}n>0&&(this.digits[t]=1)}toString(){let e="";for(let t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}class Dre{constructor(e){this.powerOfTwos=[e]}getValue(){return this.powerOfTwos[0]}multiplyBy(e){const t=Rre.zero();return this.multiplyByAndAddTo(e,t),t}multiplyByAndAddTo(e,t){for(let n=0;0!==e;e>>>=1,n++)if(1&e){const e=this.getMultipliedByPowerOfTwo(n);t.addToSelf(e)}}getMultipliedByPowerOfTwo(e){for(let t=this.powerOfTwos.length;t<=e;t++){const e=this.powerOfTwos[t-1];this.powerOfTwos[t]=e.add(e)}return this.powerOfTwos[e]}}class Lre{constructor(e){this.base=e,this.exponents=[new Dre(Rre.one())]}toThePowerOf(e){for(let t=this.exponents.length;t<=e;t++){const e=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new Dre(e)}return this.exponents[e]}}function Fre(e){const t=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){const t=e.charCodeAt(n+1);t>=56320&&t<=57343&&(n++,r=(r-55296<<10)+t-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e);let n=Ure(t,0),r=Ure(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function Ure(e,t){let n,r=2654435769,i=2654435769;const s=e.length;for(n=0;n+12<=s;n+=12){r=$re(r,qre(e,n,Vre.Little)),i=$re(i,qre(e,n+4,Vre.Little));const s=Bre(r,i,t=$re(t,qre(e,n+8,Vre.Little)));r=s[0],i=s[1],t=s[2]}return r=$re(r,qre(e,n,Vre.Little)),i=$re(i,qre(e,n+4,Vre.Little)),t=$re(t,s),Bre(r,i,t=$re(t,qre(e,n+8,Vre.Little)<<8))[2]}function Bre(e,t,n){return e=Hre(e,t),e=Hre(e,n),e^=n>>>13,t=Hre(t,n),t=Hre(t,e),t^=e<<8,n=Hre(n,e),n=Hre(n,t),n^=t>>>13,e=Hre(e,t),e=Hre(e,n),e^=n>>>12,t=Hre(t,n),t=Hre(t,e),t^=e<<16,n=Hre(n,e),n=Hre(n,t),n^=t>>>5,e=Hre(e,t),e=Hre(e,n),e^=n>>>3,t=Hre(t,n),t=Hre(t,e),t^=e<<10,n=Hre(n,e),n=Hre(n,t),[e,t,n^=t>>>15]}var Vre=(()=>((Vre=Vre||{})[Vre.Little=0]="Little",Vre[Vre.Big=1]="Big",Vre))();function $re(e,t){return zre(e,t)[1]}function zre(e,t){const n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function Hre(e,t){const n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function Gre(e,t){return t>=e.length?0:e[t]}function qre(e,t,n){let r=0;if(n===Vre.Big)for(let i=0;i<4;i++)r+=Gre(e,t+i)<<24-8*i;else for(let i=0;i<4;i++)r+=Gre(e,t+i)<<8*i;return r}const Wre=new Lre(256);function jre(e,t,n,r,i=[]){const s={},o={},a=function(e,t){const{text:n,block:r}=Zre(e,t);if(void 0===r)return{text:n};{const[e,...t]=r.split("\u241f"),[i,s]=e.split("@@",2);let[o,a]=i.split("|",2);return void 0===a&&(a=o,o=void 0),""===a&&(a=void 0),{text:n,meaning:o,description:a,customId:s,legacyIds:t}}}(e[0],e.raw[0]),l=[a.text],c=[];let u=a.text;for(let p=1;p<e.length;p++){const{text:n,block:r=Yre(p)}=Zre(e[p],e.raw[p]);u+=`{$${r}}${n}`,void 0!==t&&(s[r]=t[p-1],o[r]=i[p-1]),c.push(r),l.push(n)}const h=a.customId||function(e,t=""){let n=Fre(e);if(t){const e=Fre(t);n=function(e,t){const n=e[0],r=t[0],i=zre(e[1],t[1]),s=i[0],o=i[1];return[$re($re(n,r),s),o]}(function(e,t){const n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),e)}return function(e,t){const n=Wre.toThePowerOf(0).multiplyBy(t);return Wre.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(u,a.meaning||""),d=a.legacyIds?a.legacyIds.filter(e=>e!==h):[];return{id:h,legacyIds:d,substitutions:s,substitutionLocations:o,text:u,customId:a.customId,meaning:a.meaning||"",description:a.description||"",messageParts:l,messagePartLocations:r,placeholderNames:c,location:n}}function Zre(e,t){if(":"!==t.charAt(0))return{text:e};{const n=function(e,t){for(let n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}}function Yre(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});class Kre extends Error{constructor(e){super(`No translation found for ${Qre(e)}.`),this.parsedMessage=e,this.type="MissingTranslationError"}}function Jre(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function Qre(e){const t=e.meaning&&` - "${e.meaning}"`,n=e.legacyIds&&e.legacyIds.length>0?` [${e.legacyIds.map(e=>`"${e}"`).join(", ")}]`:"";return`"${e.id}"${n} ("${e.text}"${t})`}function Xre(e,t){try{return function(e,t,n){const r=jre(t,n);let i=e[r.id];if(void 0!==r.legacyIds)for(let s=0;s<r.legacyIds.length&&void 0===i;s++)i=e[r.legacyIds[s]];if(void 0===i)throw new Kre(r);return[i.messageParts,i.placeholderNames.map(e=>{if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error(`There is a placeholder name mismatch with the translation provided for the message ${Qre(r)}.\nThe translation contains a placeholder with name ${e}, which does not exist in the message.`)})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function eie(){cre.production&&function(){if(mh)throw new Error("Cannot enable prod mode after platform setup.");gh=!1}(),Tp().bootstrapModule(xre).catch(e=>console.error(e))}const tie=iK.getLocale();"en"!==tie?fetch(cre.root+"assets/"+tie+".json").then(e=>e.ok?e.json():{locale:"en",translations:{}}).then(e=>{(function(e){$localize.translate||($localize.translate=Xre),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(t=>{$localize.TRANSLATIONS[t]=function(e){const t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[];for(let s=1;s<t.length-1;s+=2)r.push(t[s]),n.push(`${t[s+1]}`);const i=n.map(e=>":"===e.charAt(0)?"\\"+e:e);return{text:e,messageParts:Jre(n,i),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,eie()}).catch(function(e){console.log(e)}):eie()}},function(e){e(e.s=4009)}]);