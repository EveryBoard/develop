!function(){var e,t,n,r,i,a,o,s,u,c,l,h,f,d,v,p,g,y,m,k,_,C,w,b,E,S,P,O,T,I,A,x,R,M,N,D,L,F,U,B,V,z,H,G,$,W,q,j,Z,Y,K,Q,X,J,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,he,fe,de,ve,pe,ge,ye,me,ke,_e,Ce,we,be,Ee,Se,Pe,Oe,Te,Ie,Ae,xe,Re,Me,Ne,De,Le,Fe,Ue,Be,Ve,ze,He,Ge,$e,We,qe,je,Ze,Ye,Ke,Qe,Xe,Je,et,tt,nt,rt,it,at,ot,st,ut,ct,lt,ht,ft,dt,vt,pt,gt,yt,mt,kt,_t,Ct,wt,bt,Et,St,Pt,Ot,Tt,It,At,xt,Rt,Mt,Nt,Dt,Lt,Ft,Ut,Bt,Vt,zt,Ht,Gt,$t,Wt,qt,jt,Zt,Yt,Kt,Qt,Xt,Jt,en,tn,nn,rn,an,on,sn,un,cn,ln,hn,fn,dn,vn,pn,gn,yn,mn,kn,_n,Cn,wn,bn,En,Sn,Pn,On,Tn,In,An,xn,Rn,Mn,Nn,Dn,Ln,Fn,Un,Bn,Vn,zn,Hn,Gn,$n,Wn,qn,jn,Zn,Yn,Kn,Qn,Xn,Jn,er,tr,nr,rr,ir,ar,or,sr,ur,cr,lr,hr,fr,dr,vr,pr,gr,yr,mr,kr,_r,Cr,wr,br,Er,Sr,Pr,Or,Tr,Ir,Ar,xr,Rr,Mr,Nr,Dr,Lr,Fr,Ur,Br,Vr,zr,Hr,Gr,$r,Wr,qr,jr,Zr,Yr,Kr,Qr,Xr,Jr,ei,ti,ni,ri,ii,ai,oi,si,ui,ci,li,hi,fi,di,vi,pi,gi,yi,mi,ki,_i,Ci,wi,bi,Ei,Si,Pi,Oi,Ti,Ii,Ai,xi,Ri,Mi,Ni,Di,Li,Fi,Ui,Bi,Vi,zi,Hi,Gi,$i,Wi,qi,ji,Zi,Yi,Ki,Qi,Xi,Ji,ea,ta,na,ra,ia,aa,oa,sa,ua,ca,la,ha,fa,da,va,pa,ga,ya,ma,ka,_a,Ca,wa,ba,Ea,Sa,Pa,Oa,Ta,Ia,Aa,xa,Ra,Ma,Na,Da,La,Fa,Ua,Ba,Va,za,Ha,Ga,$a,Wa,qa,ja,Za,Ya,Ka,Qa,Xa,Ja,eo,to,no,ro,io,ao,oo,so,uo,co,lo,ho,fo,vo,po,go,yo,mo,ko,_o,Co,wo,bo,Eo,So,Po,Oo,To,Io,Ao,xo,Ro,Mo,No,Do,Lo,Fo,Uo,Bo,Vo,zo,Ho,Go,$o,Wo,qo,jo,Zo,Yo,Ko,Qo,Xo,Jo,es,ts,ns,rs,is,as,os,ss,us,cs,ls,hs,fs,ds,vs,ps,gs,ys,ms,ks,_s,Cs,ws,bs,Es,Ss,Ps,Os,Ts,Is,As,xs,Rs,Ms,Ns,Ds,Ls,Fs,Us,Bs,Vs,zs,Hs,Gs,$s,Ws,qs,js,Zs,Ys,Ks,Qs,Xs,Js,eu,tu,nu,ru,iu,au,ou,su,uu,cu,lu,hu,fu,du,vu,pu,gu,yu,mu,ku,_u,Cu,wu,bu,Eu,Su,Pu,Ou,Tu,Iu,Au,xu,Ru,Mu,Nu,Du,Lu,Fu,Uu,Bu,Vu,zu,Hu,Gu,$u,Wu,qu,ju,Zu,Yu,Ku,Qu,Xu,Ju,ec,tc,nc,rc,ic,ac,oc,sc,uc,cc,lc,hc,fc,dc,vc,pc,gc,yc,mc,kc,_c,Cc,wc,bc,Ec,Sc,Pc,Oc,Tc,Ic,Ac,xc,Rc,Mc,Nc,Dc,Lc,Fc,Uc,Bc,Vc,zc,Hc,Gc,$c,Wc,qc,jc,Zc,Yc,Kc,Qc,Xc,Jc,el,tl,nl,rl,il,al,ol,sl,ul,cl,ll,hl,fl,dl,vl,pl,gl,yl,ml,kl,_l,Cl,wl,bl,El,Sl,Pl,Ol,Tl,Il,Al,xl,Rl,Ml,Nl,Dl,Ll,Fl,Ul,Bl,Vl,zl,Hl,Gl,$l,Wl,ql,jl,Zl,Yl,Kl,Ql,Xl,Jl,eh,th,nh,rh,ih,ah,oh,sh,uh,ch,lh,hh,fh,dh,vh,ph,gh,yh,mh,kh,_h,Ch,wh,bh,Eh,Sh,Ph,Oh,Th,Ih,Ah,xh,Rh,Mh,Nh,Dh,Lh,Fh,Uh,Bh,Vh,zh,Hh,Gh,$h,Wh,qh,jh,Zh,Yh,Kh,Qh,Xh,Jh,ef,tf,nf,rf,af,of,sf,uf,cf,lf,hf,ff,df,vf,pf,gf,yf,mf,kf,_f,Cf,wf,bf,Ef,Sf,Pf,Of,Tf,If,Af,xf,Rf,Mf,Nf,Df,Lf,Ff,Uf,Bf,Vf,zf,Hf,Gf,$f,Wf,qf,jf,Zf,Yf,Kf,Qf,Xf,Jf,ed,td,nd,rd,id,ad,od,sd,ud,cd,ld,hd,fd,dd,vd,pd,gd,yd,md,kd,_d,Cd,wd,bd,Ed,Sd,Pd,Od,Td,Id,Ad,xd,Rd,Md,Nd,Dd,Ld,Fd,Ud,Bd,Vd,zd,Hd,Gd,$d,Wd,qd,jd,Zd,Yd,Kd,Qd,Xd,Jd,ev,tv,nv,rv,iv,av,ov,sv,uv,cv,lv,hv,fv,dv,vv,pv,gv,yv,mv,kv,_v,Cv,wv,bv,Ev,Sv,Pv,Ov,Tv,Iv,Av,xv,Rv,Mv,Nv,Dv,Lv,Fv,Uv,Bv,Vv,zv,Hv,Gv,$v,Wv,qv,jv,Zv,Yv,Kv,Qv,Xv,Jv,ep,tp,np,rp,ip,ap,op,sp,up,cp,lp,hp,fp,dp,vp,pp,gp,yp,mp,kp,_p,Cp,wp,bp,Ep,Sp,Pp,Op,Tp,Ip,Ap,xp,Rp,Mp,Np,Dp,Lp,Fp,Up,Bp,Vp,zp,Hp,Gp,$p,Wp,qp,jp,Zp,Yp,Kp,Qp,Xp,Jp,eg,tg,ng,rg,ig,ag,og,sg,ug,cg,lg,hg,fg,dg,vg,pg,gg,yg,mg,kg,_g;function Cg(e){return Tg(e)||zg(e)||Gg(e)||Og()}function wg(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function bg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Eg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bg(Object(n),!0).forEach(function(t){Sg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Sg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pg(e,t){return Tg(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||Gg(e,t)||Og()}function Og(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Tg(e){if(Array.isArray(e))return e}function Ig(e){var t="function"==typeof Map?new Map:void 0;return(Ig=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Ag(e,arguments,Bg(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ng(r,e)})(e)}function Ag(e,t,n){return(Ag=Ug()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Ng(i,n.prototype),i}).apply(null,arguments)}function xg(){return(xg="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Rg(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function Rg(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bg(e)););return e}function Mg(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ng(e,t)}function Ng(e,t){return(Ng=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dg(e){var t=Ug();return function(){var n,r=Bg(e);if(t){var i=Bg(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Lg(this,n)}}function Lg(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fg(e)}function Fg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ug(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Bg(e){return(Bg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vg(e){return function(e){if(Array.isArray(e))return $g(e)}(e)||zg(e)||Gg(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zg(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Hg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Gg(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Gg(e,t){if(e){if("string"==typeof e)return $g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$g(e,t):void 0}}function $g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wg(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jg(e,t,n){return t&&qg(e.prototype,t),n&&qg(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},2616:function(e,t,n){var r,i,a;!function(o){if("object"==typeof e.exports){var s=o(0,t);void 0!==s&&(e.exports=s)}else i=[n,t],void 0!==(a="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=a)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},811:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++){var i;n=null!==(i=arguments[r])&&void 0!==i?i:{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){var e;return null!==(e=h)&&void 0!==e?e:document}var u={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},c=n({},u),l={},h=null,f=function(){function e(t){var n=this;r(this,e),this.element=s().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),a=["notification",this.extraClasses];if(this.type&&a.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),u=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";a.push("animate__animated ".concat(o," ").concat(u)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=a.join(" "),this.dismissible){var c=s().createElement("button");c.className="delete",c.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",c)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var l=new d(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){l.pause()}),this.element.addEventListener("mouseout",function(){l.resume()}))}return a(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete l.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete l.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),d=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return a(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){c=n({},u)},e.setDefaults=function(e){c=n(n({},u),e)},e.setDoc=function(e){for(var t in l)l[t].remove();l={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},c),e),r=new f(t),i=function(e,t,n,r,i,a){if(l.position)return l.position;var o=s().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0}(t,n,r,i,a)),e.appendChild(o),l.position=o,o}(t.appendTo||s().body,t.position||c.position,t.offsetTop||c.offsetTop,t.offsetBottom||c.offsetBottom,t.offsetLeft||c.offsetLeft,t.offsetRight||c.offsetRight);if(t.single)for(var a=i.lastElementChild;a;)i.removeChild(a),a=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},4378:function(bg,Og,Tg){"use strict";var Rg,Ng;function Ug(e){return"function"==typeof e}function zg(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Gg=zg(function(e){return function(t){e(this),this.message=t?"".concat(t.length," errors occurred during unsubscription:\n").concat(t.map(function(e,t){return"".concat(t+1,") ").concat(e.toString())}).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=t}});function $g(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var qg=function(){function e(t){Wg(this,e),this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}return jg(e,[{key:"unsubscribe",value:function(){var e;if(!this.closed){this.closed=!0;var t=this._parentage;if(t)if(this._parentage=null,Array.isArray(t)){var n,r=Hg(t);try{for(r.s();!(n=r.n()).done;){var i;n.value.remove(this)}}catch(h){r.e(h)}finally{r.f()}}else t.remove(this);var a=this.initialTeardown;if(Ug(a))try{a()}catch(i){e=i instanceof Gg?i.errors:[i]}var o=this._teardowns;if(o){this._teardowns=null;var s,u=Hg(o);try{for(u.s();!(s=u.n()).done;){var c=s.value;try{Kg(c)}catch(f){var l;e=null!==(l=e)&&void 0!==l?l:[],f instanceof Gg?e=[].concat(Vg(e),Vg(f.errors)):e.push(f)}}}catch(h){u.e(h)}finally{u.f()}}if(e)throw new Gg(e)}}},{key:"add",value:function(t){var n;if(t&&t!==this)if(this.closed)Kg(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}}},{key:"_hasParent",value:function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)}},{key:"_addParent",value:function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}},{key:"_removeParent",value:function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&$g(t,e)}},{key:"remove",value:function(t){var n=this._teardowns;n&&$g(n,t),t instanceof e&&t._removeParent(this)}}]),e}();qg.EMPTY=function(){var e=new qg;return e.closed=!0,e}();var Zg=qg.EMPTY;function Yg(e){return e instanceof qg||e&&"closed"in e&&Ug(e.remove)&&Ug(e.add)&&Ug(e.unsubscribe)}function Kg(e){Ug(e)?e():e.unsubscribe()}var Qg=null,Xg=null,Jg=void 0,ey=!1,ty=!1,ny={setTimeout:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=ny.delegate;return((null==e?void 0:e.setTimeout)||setTimeout).apply(void 0,arguments)}),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=ny.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)}),delegate:void 0};function ry(e){ny.setTimeout(function(){if(!Qg)throw e;Qg(e)})}function iy(){}var ay=oy("C",void 0,void 0);function oy(e,t,n){return{kind:e,value:t,error:n}}var sy=null;function uy(e){if(ey){var t=!sy;if(t&&(sy={errorThrown:!1,error:null}),e(),t){var n=sy,r=n.errorThrown,i=n.error;if(sy=null,r)throw i}}else e()}var cy=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).isStopped=!1,e?(r.destination=e,Yg(e)&&e.add(Fg(r))):r.destination=vy,r}return jg(n,[{key:"next",value:function(e){this.isStopped?dy(oy("N",e,void 0),this):this._next(e)}},{key:"error",value:function(e){this.isStopped?dy(oy("E",void 0,e),this):(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped?dy(ay,this):(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,xg(Bg(n.prototype),"unsubscribe",this).call(this),this.destination=null)}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){try{this.destination.error(e)}finally{this.unsubscribe()}}},{key:"_complete",value:function(){try{this.destination.complete()}finally{this.unsubscribe()}}}],[{key:"create",value:function(e,t,n){return new ly(e,t,n)}}]),n}(qg),ly=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a,o,s;if(Wg(this,n),o=t.call(this),Ug(e))s=e;else if(e){var u,c;s=(u=e).next,r=u.error,i=u.complete,Fg(o)&&ty?(c=Object.create(e)).unsubscribe=function(){return o.unsubscribe()}:c=e,s=null==s?void 0:s.bind(c),r=null==r?void 0:r.bind(c),i=null==i?void 0:i.bind(c)}return o.destination={next:s?hy(s):iy,error:hy(null!==(a=r)&&void 0!==a?a:fy),complete:i?hy(i):iy},Lg(o)}return jg(n)}(cy);function hy(e,t){return function(){try{e.apply(void 0,arguments)}catch(t){ey?function(e){ey&&sy&&(sy.errorThrown=!0,sy.error=e)}(t):ry(t)}}}function fy(e){throw e}function dy(e,t){var n=Xg;n&&ny.setTimeout(function(){return n(e,t)})}var vy={closed:!0,next:iy,error:fy,complete:iy},py="function"==typeof Symbol&&Symbol.observable||"@@observable";function gy(e){return e}var yy=function(){var e=function(){function e(t){Wg(this,e),t&&(this._subscribe=t)}return jg(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this,i=function(e){return e&&e instanceof cy||function(e){return e&&Ug(e.next)&&Ug(e.error)&&Ug(e.complete)}(e)&&Yg(e)}(e)?e:new ly(e,t,n);return uy(function(){var e=r.operator,t=r.source;i.add(e?e.call(i,t):t?r._subscribe(i):r._trySubscribe(i))}),i}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){e.error(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=my(t))(function(t,r){var i=new ly({next:function(t){try{e(t)}catch(n){r(n),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})}},{key:"_subscribe",value:function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}},{key:py,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return 0===e.length?gy:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=my(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})}}]),e}();return e.create=function(t){return new e(t)},e}();function my(e){var t;return null!==(t=null!=e?e:Jg)&&void 0!==t?t:Promise}var ky=zg(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),_y=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this)).closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return jg(n,[{key:"lift",value:function(e){var t=new Cy(this,this);return t.operator=e,t}},{key:"_throwIfClosed",value:function(){if(this.closed)throw new ky}},{key:"next",value:function(e){var t=this;uy(function(){if(t._throwIfClosed(),!t.isStopped){var n,r=Hg(t.observers.slice());try{for(r.s();!(n=r.n()).done;){n.value.next(e)}}catch(i){r.e(i)}finally{r.f()}}})}},{key:"error",value:function(e){var t=this;uy(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})}},{key:"complete",value:function(){var e=this;uy(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})}},{key:"unsubscribe",value:function(){this.isStopped=this.closed=!0,this.observers=null}},{key:"observed",get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}},{key:"_trySubscribe",value:function(e){return this._throwIfClosed(),xg(Bg(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}},{key:"_innerSubscribe",value:function(e){var t=this.hasError,n=this.isStopped,r=this.observers;return t||n?Zg:(r.push(e),new qg(function(){return $g(r,e)}))}},{key:"_checkFinalizedStatuses",value:function(e){var t=this.hasError,n=this.thrownError,r=this.isStopped;t?e.error(n):r&&e.complete()}},{key:"asObservable",value:function(){var e=new yy;return e.source=this,e}}]),n}(yy);return e.create=function(e,t){return new Cy(e,t)},e}(),Cy=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).destination=e,i.source=r,i}return jg(n,[{key:"next",value:function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}},{key:"error",value:function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}},{key:"complete",value:function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}},{key:"_subscribe",value:function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Zg}}]),n}(_y);function wy(e){return Ug(null==e?void 0:e.lift)}function by(e){return function(t){if(wy(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Ey=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s,u,c,l;return Wg(this,n),(l=t.call(this,e)).onFinalize=o,l._next=r?function(t){try{r(t)}catch(n){e.error(n)}}:xg((s=Fg(l),Bg(n.prototype)),"_next",s),l._error=a?function(t){try{a(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:xg((u=Fg(l),Bg(n.prototype)),"_error",u),l._complete=i?function(){try{i()}catch(t){e.error(t)}finally{this.unsubscribe()}}:xg((c=Fg(l),Bg(n.prototype)),"_complete",c),l}return jg(n,[{key:"unsubscribe",value:function(){var e,t=this.closed;xg(Bg(n.prototype),"unsubscribe",this).call(this),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}]),n}(cy);function Sy(e,t){return by(function(n,r){var i=0;n.subscribe(new Ey(r,function(n){r.next(e.call(t,n,i++))}))})}function Py(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Oy(e){return this instanceof Oy?(this.v=e,this):new Oy(e)}function Ty(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){a.push([e,t,n,r])>1||s(e,t)})})}function s(e,t){try{!function(e){e.value instanceof Oy?Promise.resolve(e.value.v).then(u,c):l(a[0][2],e)}(i[e](t))}catch(n){l(a[0][3],n)}}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function Iy(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}var Ay=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function xy(e){return Ug(null==e?void 0:e.then)}function Ry(e){return Ug(e[py])}function My(e){return Symbol.asyncIterator&&Ug(null==e?void 0:e[Symbol.asyncIterator])}function Ny(e){return new TypeError("You provided ".concat(null!==e&&"object"==typeof e?"an invalid object":"'".concat(e,"'")," where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable."))}var Dy="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ly(e){return Ug(null==e?void 0:e[Dy])}function Fy(e){return Ty(this,arguments,regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.getReader(),t.prev=1;case 2:return t.next=4,Oy(n.read());case 4:if(r=t.sent,i=r.value,!r.done){t.next=11;break}return t.next=10,Oy(void 0);case 10:return t.abrupt("return",t.sent);case 11:return t.next=13,Oy(i);case 13:return t.next=15,t.sent;case 15:t.next=2;break;case 17:return t.prev=17,n.releaseLock(),t.finish(17);case 20:case"end":return t.stop()}},t,null,[[1,,17,20]])}))}function Uy(e){return Ug(null==e?void 0:e.getReader)}function By(e){if(e instanceof yy)return e;if(null!=e){if(Ry(e))return function(e){return new yy(function(t){var n=e[py]();if(Ug(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ay(e))return function(e){return new yy(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(xy(e))return function(e){return new yy(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,ry)})}(e);if(My(e))return Vy(e);if(Ly(e))return function(e){return new yy(function(t){var n,r=Hg(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.next(i),t.closed)return}}catch(a){r.e(a)}finally{r.f()}t.complete()})}(e);if(Uy(e))return function(e){return Vy(Fy(e))}(e)}throw Ny(e)}function Vy(e){return new yy(function(t){(function(e,t){var n,r,i,a;return function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function o(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){e.done?t(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,o)}s((r=r.apply(e,[])).next())})}(this,0,void 0,regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:o.prev=0,n=Iy(e);case 2:return o.next=4,n.next();case 4:if((r=o.sent).done){o.next=9;break}if(t.next(r.value),!t.closed){o.next=7;break}return o.abrupt("return");case 7:o.next=2;break;case 9:o.next=14;break;case 11:o.prev=11,o.t0=o.catch(0),i={error:o.t0};case 14:if(o.prev=14,o.prev=15,o.t1=r&&!r.done&&(a=n.return),!o.t1){o.next=20;break}return o.next=20,a.call(n);case 20:if(o.prev=20,!i){o.next=23;break}throw i.error;case 23:return o.finish(20);case 24:return o.finish(14);case 25:t.complete();case 26:case"end":return o.stop()}},o,null,[[0,11,14,25],[15,,20,24]])}))})(e,t).catch(function(e){return t.error(e)})})}function zy(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!i)return a}function Hy(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Ug(t)?Hy(function(n,r){return Sy(function(e,i){return t(n,e,r,i)})(By(e(n,r)))},n):("number"==typeof t&&(n=t),by(function(t,r){return function(e,t,n,r,i,a,o,s){var u=[],c=0,l=0,h=!1,f=function(){h&&!u.length&&!c&&t.complete()},d=function e(i){c++;var a=!1;By(n(i,l++)).subscribe(new Ey(t,function(e){t.next(e)},function(){a=!0},void 0,function(){if(a)try{for(c--;u.length&&c<r;){var n=u.shift();e(n)}f()}catch(n){t.error(n)}}))};return e.subscribe(new Ey(t,function(e){return c<r?d(e):u.push(e)},function(){h=!0,f()})),function(){}}(t,r,e,n)}))}function Gy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return Hy(gy,e)}var $y=new yy(function(e){return e.complete()});function Wy(e){return e[e.length-1]}function qy(e){return Ug(Wy(e))?e.pop():void 0}function jy(e){return function(e){return e&&Ug(e.schedule)}(Wy(e))?e.pop():void 0}function Zy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return by(function(n,r){n.subscribe(new Ey(r,function(n){return zy(r,e,function(){return r.next(n)},t)},function(){return zy(r,e,function(){return r.complete()},t)},function(n){return zy(r,e,function(){return r.error(n)},t)}))})}function Yy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return by(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Ky(e,t){if(!e)throw new Error("Iterable cannot be null");return new yy(function(n){zy(n,t,function(){var r=e[Symbol.asyncIterator]();zy(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function Qy(e,t){return t?function(e,t){if(null!=e){if(Ry(e))return function(e,t){return By(e).pipe(Yy(t),Zy(t))}(e,t);if(Ay(e))return function(e,t){return new yy(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(xy(e))return function(e,t){return By(e).pipe(Yy(t),Zy(t))}(e,t);if(My(e))return Ky(e,t);if(Ly(e))return function(e,t){return new yy(function(n){var r;return zy(n,t,function(){r=e[Dy](),zy(n,t,function(){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(a){return void n.error(a)}t?n.complete():n.next(e)},0,!0)}),function(){return Ug(null==r?void 0:r.return)&&r.return()}})}(e,t);if(Uy(e))return function(e,t){return Ky(Fy(e),t)}(e,t)}throw Ny(e)}(e,t):By(e)}function Xy(e){return e<=0?function(){return $y}:by(function(t,n){var r=0;t.subscribe(new Ey(n,function(t){++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function Jy(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return!0===t?(e(),null):!1===t?null:t.apply(void 0,r).pipe(Xy(1)).subscribe(function(){return e()})}function em(e){for(var t in e)if(e[t]===em)return t;throw Error("Could not find renamed property on target object.")}function tm(e,t){for(var n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function nm(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(nm).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return"".concat(e.overriddenName);if(e.name)return"".concat(e.name);var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function rm(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}var im=em({__forward_ref__:em});function am(e){return e.__forward_ref__=am,e.toString=function(){return nm(this())},e}function om(e){return sm(e)?e():e}function sm(e){return"function"==typeof e&&e.hasOwnProperty(im)&&e.__forward_ref__===am}var um=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,function(e,t){return"".concat(e?"NG0".concat(e,": "):"").concat(t)}(e,r))).code=e,i}return jg(n)}(Ig(Error));function cm(e){return"string"==typeof e?e:null==e?"":String(e)}function lm(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():cm(e)}function hm(e,t){var n=t?" in ".concat(t):"";throw new um("201","No provider for ".concat(lm(e)," found").concat(n))}function fm(e,t,n,r){throw new Error("ASSERTION ERROR: ".concat(e)+(null==r?"":" [Expected=> ".concat(n," ").concat(r," ").concat(t," <=Actual]")))}function dm(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function vm(e){return{providers:e.providers||[],imports:e.imports||[]}}function pm(e){return gm(e,km)||gm(e,Cm)}function gm(e,t){return e.hasOwnProperty(t)?e[t]:null}function ym(e){return e&&(e.hasOwnProperty(_m)||e.hasOwnProperty(wm))?e[_m]:null}var mm,km=em({"\u0275prov":em}),_m=em({"\u0275inj":em}),Cm=em({ngInjectableDef:em}),wm=em({ngInjectorDef:em}),bm=((bm=bm||{})[bm.Default=0]="Default",bm[bm.Host=1]="Host",bm[bm.Self=2]="Self",bm[bm.SkipSelf=4]="SkipSelf",bm[bm.Optional=8]="Optional",bm);function Em(e){var t=mm;return mm=e,t}function Sm(e,t,n){var r=pm(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&bm.Optional?null:void 0!==t?t:void hm(nm(e),"Injector")}function Pm(e){return{toString:e}.toString()}var Om=((Om=Om||{})[Om.OnPush=0]="OnPush",Om[Om.Default=1]="Default",Om),Tm=((Tm=Tm||{})[Tm.Emulated=0]="Emulated",Tm[Tm.None=2]="None",Tm[Tm.ShadowDom=3]="ShadowDom",Tm),Im="undefined"!=typeof globalThis&&globalThis,Am="undefined"!=typeof window&&window,xm="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Rm=Im||"undefined"!=typeof global&&global||Am||xm,Mm={},Nm=[],Dm=em({"\u0275cmp":em}),Lm=em({"\u0275dir":em}),Fm=em({"\u0275pipe":em}),Um=em({"\u0275mod":em}),Bm=em({"\u0275loc":em}),Vm=em({"\u0275fac":em}),zm=em({__NG_ELEMENT_ID__:em}),Hm=0;function Gm(e){return Pm(function(){var t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Om.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Nm,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Tm.Emulated,id:"c",styles:e.styles||Nm,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,a=e.pipes;return n.id+=Hm++,n.inputs=Zm(e.inputs,t),n.outputs=Zm(e.outputs),i&&i.forEach(function(e){return e(n)}),n.directiveDefs=r?function(){return("function"==typeof r?r():r).map($m)}:null,n.pipeDefs=a?function(){return("function"==typeof a?a():a).map(Wm)}:null,n})}function $m(e){return Qm(e)||function(e){return e[Lm]||null}(e)}function Wm(e){return function(e){return e[Fm]||null}(e)}var qm={};function jm(e){return Pm(function(){var t={type:e.type,bootstrap:e.bootstrap||Nm,declarations:e.declarations||Nm,imports:e.imports||Nm,exports:e.exports||Nm,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(qm[e.id]=e.type),t})}function Zm(e,t){if(null==e)return Mm;var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],a=i;Array.isArray(i)&&(a=i[1],i=i[0]),n[i]=r,t&&(t[i]=a)}return n}var Ym=Gm;function Km(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function Qm(e){return e[Dm]||null}function Xm(e,t){var n=e[Um]||null;if(!n&&!0===t)throw new Error("Type ".concat(nm(e)," does not have '\u0275mod' property."));return n}function Jm(e){return Array.isArray(e)&&"object"==typeof e[1]}function ek(e){return Array.isArray(e)&&!0===e[1]}function tk(e){return 0!=(8&e.flags)}function nk(e){return 2==(2&e.flags)}function rk(e){return 1==(1&e.flags)}function ik(e){return null!==e.template}function ak(e){return 0!=(512&e[2])}function ok(e,t){return e.hasOwnProperty(Vm)?e[Vm]:null}var sk=function(){function e(t,n,r){Wg(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return jg(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}();function uk(){return ck}function ck(e){return e.type.prototype.ngOnChanges&&(e.setInput=hk),lk}function lk(){var e=dk(this),t=null==e?void 0:e.current;if(t){var n=e.previous;if(n===Mm)e.previous=t;else for(var r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function hk(e,t,n,r){var i=dk(e)||function(e,t){return e[fk]=t}(e,{previous:Mm,current:null}),a=i.current||(i.current={}),o=i.previous,s=this.declaredInputs[n],u=o[s];a[s]=new sk(u&&u.currentValue,t,o===Mm),e[r]=t}uk.ngInherit=!0;var fk="__ngSimpleChanges__";function dk(e){return e[fk]||null}var vk,pk="http://www.w3.org/2000/svg";function gk(){return void 0!==vk?vk:"undefined"!=typeof document?document:void 0}function yk(e){return!!e.listen}var mk={createRenderer:function(e,t){return gk()}};function kk(e){for(;Array.isArray(e);)e=e[0];return e}function _k(e,t){return kk(t[e])}function Ck(e,t){return kk(t[e.index])}function wk(e,t){return e.data[t]}function bk(e,t){return e[t]}function Ek(e,t){var n=t[e];return Jm(n)?n:n[0]}function Sk(e){return 4==(4&e[2])}function Pk(e){return 128==(128&e[2])}function Ok(e,t){return null==t?null:e[t]}function Tk(e){e[18]=0}function Ik(e,t){e[5]+=t;for(var n=e,r=e[3];null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}var Ak={lFrame:n_(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function xk(){return Ak.bindingsEnabled}function Rk(){return Ak.lFrame.lView}function Mk(){return Ak.lFrame.tView}function Nk(e){return Ak.lFrame.contextLView=e,e[8]}function Dk(){for(var e=Lk();null!==e&&64===e.type;)e=e.parent;return e}function Lk(){return Ak.lFrame.currentTNode}function Fk(){var e=Ak.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Uk(e,t){var n=Ak.lFrame;n.currentTNode=e,n.isParent=t}function Bk(){return Ak.lFrame.isParent}function Vk(){Ak.lFrame.isParent=!1}function zk(){return Ak.isInCheckNoChangesMode}function Hk(e){Ak.isInCheckNoChangesMode=e}function Gk(){var e=Ak.lFrame,t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function $k(){return Ak.lFrame.bindingIndex}function Wk(){return Ak.lFrame.bindingIndex++}function qk(e){var t=Ak.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function jk(e){Ak.lFrame.inI18n=e}function Zk(e,t){var n=Ak.lFrame;n.bindingIndex=n.bindingRootIndex=e,Yk(t)}function Yk(e){Ak.lFrame.currentDirectiveIndex=e}function Kk(){return Ak.lFrame.currentQueryIndex}function Qk(e){Ak.lFrame.currentQueryIndex=e}function Xk(e){var t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Jk(e,t,n){if(n&bm.SkipSelf){for(var r=t,i=e;!(null!==(r=r.parent)||n&bm.Host||(r=Xk(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}var a=Ak.lFrame=t_();return a.currentTNode=t,a.lView=e,!0}function e_(e){var t=t_(),n=e[1];Ak.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function t_(){var e=Ak.lFrame,t=null===e?null:e.child;return null===t?n_(e):t}function n_(e){var t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function r_(){var e=Ak.lFrame;return Ak.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var i_=r_;function a_(){var e=r_();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function o_(){return Ak.lFrame.selectedIndex}function s_(e){Ak.lFrame.selectedIndex=e}function u_(){var e=Ak.lFrame;return wk(e.tView,e.selectedIndex)}function c_(){Ak.lFrame.currentNamespace=pk}function l_(e,t){for(var n=t.directiveStart,r=t.directiveEnd;n<r;n++){var i=e.data[n].type.prototype,a=i.ngAfterContentInit,o=i.ngAfterContentChecked,s=i.ngAfterViewInit,u=i.ngAfterViewChecked,c=i.ngOnDestroy;a&&(e.contentHooks||(e.contentHooks=[])).push(-n,a),o&&((e.contentHooks||(e.contentHooks=[])).push(n,o),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,o)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),u&&((e.viewHooks||(e.viewHooks=[])).push(n,u),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,u)),null!=c&&(e.destroyHooks||(e.destroyHooks=[])).push(n,c)}}function h_(e,t,n){v_(e,t,3,n)}function f_(e,t,n,r){(3&e[2])===n&&v_(e,t,n,r)}function d_(e,t){var n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function v_(e,t,n,r){for(var i=null!=r?r:-1,a=t.length-1,o=0,s=void 0!==r?65535&e[18]:0;s<a;s++)if("number"==typeof t[s+1]){if(o=t[s],null!=r&&o>=r)break}else t[s]<0&&(e[18]+=65536),(o<i||-1==i)&&(p_(e,n,t,s),e[18]=(4294901760&e[18])+s+2),s++}function p_(e,t,n,r){var i=n[r]<0,a=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{a.call(o)}finally{}}}else try{a.call(o)}finally{}}var g_=jg(function e(t,n,r){Wg(this,e),this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r});function y_(e,t,n){for(var r=yk(e),i=0;i<n.length;){var a=n[i];if("number"==typeof a){if(0!==a)break;i++;var o=n[i++],s=n[i++],u=n[i++];r?e.setAttribute(t,s,u,o):t.setAttributeNS(o,s,u)}else{var c=a,l=n[++i];k_(c)?r&&e.setProperty(t,c,l):r?e.setAttribute(t,c,l):t.setAttribute(c,l),i++}}return i}function m_(e){return 3===e||4===e||6===e}function k_(e){return 64===e.charCodeAt(0)}function __(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else for(var n=-1,r=0;r<t.length;r++){var i=t[r];"number"==typeof i?n=i:0===n||C_(e,n,i,null,-1===n||2===n?t[++r]:null)}return e}function C_(e,t,n,r,i){var a=0,o=e.length;if(-1===t)o=-1;else for(;a<e.length;){var s=e[a++];if("number"==typeof s){if(s===t){o=-1;break}if(s>t){o=a-1;break}}}for(;a<e.length;){var u=e[a];if("number"==typeof u)break;if(u===n){if(null===r)return void(null!==i&&(e[a+1]=i));if(r===e[a+1])return void(e[a+2]=i)}a++,null!==r&&a++,null!==i&&a++}-1!==o&&(e.splice(o,0,t),a=o+1),e.splice(a++,0,n),null!==r&&e.splice(a++,0,r),null!==i&&e.splice(a++,0,i)}function w_(e){return-1!==e}function b_(e){return 32767&e}function E_(e,t){for(var n=function(e){return e>>16}(e),r=t;n>0;)r=r[15],n--;return r}var S_=!0;function P_(e){var t=S_;return S_=e,t}var O_=0;function T_(e,t){var n=A_(e,t);if(-1!==n)return n;var r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,I_(r.data,e),I_(t,null),I_(r.blueprint,null));var i=x_(e,t),a=e.injectorIndex;if(w_(i))for(var o=b_(i),s=E_(i,t),u=s[1].data,c=0;c<8;c++)t[a+c]=s[o+c]|u[o+c];return t[a+8]=i,a}function I_(e,t){e.push(0,0,0,0,0,0,0,0,t)}function A_(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function x_(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;for(var n=0,r=null,i=t;null!==i;){var a=i[1],o=a.type;if(null===(r=2===o?a.declTNode:1===o?i[6]:null))return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function R_(e,t,n){!function(e,t,n){var r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(zm)&&(r=n[zm]),null==r&&(r=n[zm]=O_++);var i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function M_(e,t,n){if(n&bm.Optional)return e;hm(t,"NodeInjector")}function N_(e,t,n,r){if(n&bm.Optional&&void 0===r&&(r=null),0==(n&(bm.Self|bm.Host))){var i=e[9],a=Em(void 0);try{return i?i.get(t,r,n&bm.Optional):Sm(t,r,n&bm.Optional)}finally{Em(a)}}return M_(r,t,n)}function D_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bm.Default,i=arguments.length>4?arguments[4]:void 0;if(null!==e){var a=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;var t=e.hasOwnProperty(zm)?e[zm]:void 0;return"number"==typeof t?t>=0?255&t:F_:t}(n);if("function"==typeof a){if(!Jk(t,e,r))return r&bm.Host?M_(i,n,r):N_(t,n,r,i);try{var o=a(r);if(null!=o||r&bm.Optional)return o;hm(n)}finally{i_()}}else if("number"==typeof a){var s=null,u=A_(e,t),c=-1,l=r&bm.Host?t[16][6]:null;for((-1===u||r&bm.SkipSelf)&&(-1!==(c=-1===u?x_(e,t):t[u+8])&&H_(r,!1)?(s=t[1],u=b_(c),t=E_(c,t)):u=-1);-1!==u;){var h=t[1];if(z_(a,u,h.data)){var f=U_(u,t,n,s,r,l);if(f!==L_)return f}-1!==(c=t[u+8])&&H_(r,t[1].data[u+8]===l)&&z_(a,u,t)?(s=h,u=b_(c),t=E_(c,t)):u=-1}}}return N_(t,n,r,i)}var L_={};function F_(){return new G_(Dk(),Rk())}function U_(e,t,n,r,i,a){var o=t[1],s=o.data[e+8],u=B_(s,o,n,null==r?nk(s)&&S_:r!=o&&0!=(3&s.type),i&bm.Host&&a===s);return null!==u?V_(t,o,u,s):L_}function B_(e,t,n,r,i){for(var a=e.providerIndexes,o=t.data,s=1048575&a,u=e.directiveStart,c=a>>20,l=i?s+c:e.directiveEnd,h=r?s:s+c;h<l;h++){var f=o[h];if(h<u&&n===f||h>=u&&f.type===n)return h}if(i){var d=o[u];if(d&&ik(d)&&d.type===n)return u}return null}function V_(e,t,n,r){var i=e[n],a=t.data;if(function(e){return e instanceof g_}(i)){var o=i;o.resolving&&function(e,t){throw new um("200","Circular dependency in DI detected for ".concat(e))}(lm(a[n]));var s=P_(o.canSeeViewProviders);o.resolving=!0;var u=o.injectImpl?Em(o.injectImpl):null;Jk(e,r,bm.Default);try{i=e[n]=o.factory(void 0,a,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){var r=t.type.prototype,i=r.ngOnChanges,a=r.ngOnInit,o=r.ngDoCheck;if(i){var s=ck(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s)}a&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,a),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,o))}(n,a[n],t)}finally{null!==u&&Em(u),P_(s),o.resolving=!1,i_()}}return i}function z_(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function H_(e,t){return!(e&bm.Self||e&bm.Host&&t)}var G_=function(){function e(t,n){Wg(this,e),this._tNode=t,this._lView=n}return jg(e,[{key:"get",value:function(e,t,n){return D_(this._tNode,this._lView,e,n,t)}}]),e}();function $_(e){return Pm(function(){for(var t=e.prototype.constructor,n=t[Vm]||W_(t),r=Object.prototype,i=Object.getPrototypeOf(e.prototype).constructor;i&&i!==r;){var a=i[Vm]||W_(i);if(a&&a!==n)return a;i=Object.getPrototypeOf(i)}return function(e){return new e}})}function W_(e){return sm(e)?function(){var t=W_(om(e));return t&&t()}:ok(e)}function q_(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;var n=e.attrs;if(n)for(var r=n.length,i=0;i<r;){var a=n[i];if(m_(a))break;if(0===a)i+=2;else if("number"==typeof a)for(i++;i<r&&"string"==typeof n[i];)i++;else{if(a===t)return n[i+1];i+=2}}return null}(Dk(),e)}var j_="__parameters__";function Z_(e,t,n){return Pm(function(){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof i)return r.apply(this,t),this;var a=Ag(i,t);return o.annotation=a,o;function o(e,t,n){for(var r=e.hasOwnProperty(j_)?e[j_]:Object.defineProperty(e,j_,{value:[]})[j_];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(a),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}var Y_=function(){function e(t,n){Wg(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=dm({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return jg(e,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),e}(),K_=new Y_("AnalyzeForEntryComponents"),Q_=Function;function X_(e,t){void 0===t&&(t=e);for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),X_(r,t)):t!==e&&t.push(r)}return t}function J_(e,t){e.forEach(function(e){return Array.isArray(e)?J_(e,t):t(e)})}function eC(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function tC(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function nC(e,t){for(var n=[],r=0;r<e;r++)n.push(t);return n}function rC(e,t,n){var r=aC(e,t);return r>=0?e[1|r]=n:function(e,t,n,r){var i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r=~r,t,n),r}function iC(e,t){var n=aC(e,t);if(n>=0)return e[1|n]}function aC(e,t){return function(e,t,n){for(var r=0,i=e.length>>1;i!==r;){var a=r+(i-r>>1),o=e[a<<1];if(t===o)return a<<1;o>t?i=a:r=a+1}return~(i<<1)}(e,t)}var oC,sC={},uC="__NG_DI_FLAG__",cC="ngTempTokenPath",lC=/\n/gm,hC="__source",fC=em({provide:String,useValue:em});function dC(e){var t=oC;return oC=e,t}function vC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bm.Default;if(void 0===oC)throw new Error("inject() must be called from an injection context");return null===oC?Sm(e,void 0,t):oC.get(e,t&bm.Optional?null:void 0,t)}function pC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bm.Default;return(mm||vC)(om(e),t)}function gC(e){for(var t=[],n=0;n<e.length;n++){var r=om(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");for(var i=void 0,a=bm.Default,o=0;o<r.length;o++){var s=r[o],u=mC(s);"number"==typeof u?-1===u?i=s.token:a|=u:i=s}t.push(pC(i,a))}else t.push(pC(r))}return t}function yC(e,t){return e[uC]=t,e.prototype[uC]=t,e}function mC(e){return e[uC]}function kC(e,t,n,r){var i=e[cC];throw t[hC]&&i.unshift(t[hC]),e.message=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var i=nm(t);if(Array.isArray(t))i=t.map(nm).join(" -> ");else if("object"==typeof t){var a=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];a.push(o+":"+("string"==typeof s?JSON.stringify(s):nm(s)))}i="{".concat(a.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(i,"]: ").concat(e.replace(lC,"\n  "))}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[cC]=null,e}var _C,CC,wC=yC(Z_("Inject",function(e){return{token:e}}),-1),bC=yC(Z_("Optional"),8),EC=yC(Z_("SkipSelf"),4);function SC(e){var t;return(null===(t=function(){if(void 0===_C&&(_C=null,Rm.trustedTypes))try{_C=Rm.trustedTypes.createPolicy("angular",{createHTML:function(e){return e},createScript:function(e){return e},createScriptURL:function(e){return e}})}catch(e){}return _C}())||void 0===t?void 0:t.createHTML(e))||e}function PC(e){var t;return(null===(t=function(){if(void 0===CC&&(CC=null,Rm.trustedTypes))try{CC=Rm.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:function(e){return e},createScript:function(e){return e},createScriptURL:function(e){return e}})}catch(e){}return CC}())||void 0===t?void 0:t.createHTML(e))||e}var OC=function(){function e(t){Wg(this,e),this.changingThisBreaksApplicationSecurity=t}return jg(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity," (see https://g.co/ng/security#xss)")}}]),e}(),TC=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getTypeName",value:function(){return"HTML"}}]),n}(OC),IC=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getTypeName",value:function(){return"Style"}}]),n}(OC),AC=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getTypeName",value:function(){return"Script"}}]),n}(OC),xC=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getTypeName",value:function(){return"URL"}}]),n}(OC),RC=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),n}(OC);function MC(e){return e instanceof OC?e.changingThisBreaksApplicationSecurity:e}function NC(e,t){var n=DC(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error("Required a safe ".concat(t,", got a ").concat(n," (see https://g.co/ng/security#xss)"))}return n===t}function DC(e){return e instanceof OC&&e.getTypeName()||null}function LC(e){var t=new UC(e);return function(){try{return!!(new window.DOMParser).parseFromString(SC(""),"text/html")}catch(e){return!1}}()?new FC(t):t}var FC=function(){function e(t){Wg(this,e),this.inertDocumentHelper=t}return jg(e,[{key:"getInertBodyElement",value:function(e){e="<body><remove></remove>"+e;try{var t=(new window.DOMParser).parseFromString(SC(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch(n){return null}}}]),e}(),UC=function(){function e(t){if(Wg(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);var r=this.inertDocument.createElement("body");n.appendChild(r)}}return jg(e,[{key:"getInertBodyElement",value:function(e){var t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=SC(e),t;var n=this.inertDocument.createElement("body");return n.innerHTML=SC(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;("xmlns:ns1"===r||0===r.indexOf("ns1:"))&&e.removeAttribute(r)}for(var i=e.firstChild;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}]),e}(),BC=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,VC=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function zC(e){return(e=String(e)).match(BC)||e.match(VC)?e:"unsafe:"+e}function HC(e){return(e=String(e)).split(",").map(function(e){return zC(e.trim())}).join(", ")}function GC(e){var t,n={},r=Hg(e.split(","));try{for(r.s();!(t=r.n()).done;){n[t.value]=!0}}catch(i){r.e(i)}finally{r.f()}return n}function $C(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var WC,qC=GC("area,br,col,hr,img,wbr"),jC=GC("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ZC=GC("rp,rt"),YC=$C(qC,$C(jC,GC("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),$C(ZC,GC("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),$C(ZC,jC)),KC=GC("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),QC=GC("srcset"),XC=$C(KC,QC,GC("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),GC("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),JC=GC("script,style,template"),ew=function(){function e(){Wg(this,e),this.sanitizedSomething=!1,this.buf=[]}return jg(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!YC.hasOwnProperty(t))return this.sanitizedSomething=!0,!JC.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n=e.attributes,r=0;r<n.length;r++){var i=n.item(r),a=i.name,o=a.toLowerCase();if(XC.hasOwnProperty(o)){var s=i.value;KC[o]&&(s=zC(s)),QC[o]&&(s=HC(s)),this.buf.push(" ",a,'="',rw(s),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();YC.hasOwnProperty(t)&&!qC.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(rw(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: ".concat(e.outerHTML));return t}}]),e}(),tw=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,nw=/([^\#-~ |!])/g;function rw(e){return e.replace(/&/g,"&amp;").replace(tw,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(nw,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function iw(e,t){var n=null;try{WC=WC||LC(e);var r=t?String(t):"";n=WC.getInertBodyElement(r);var i=5,a=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=a,a=n.innerHTML,n=WC.getInertBodyElement(r)}while(r!==a);return SC((new ew).sanitizeChildren(aw(n)||n))}finally{if(n)for(var o=aw(n)||n;o.firstChild;)o.removeChild(o.firstChild)}}function aw(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var ow=((ow=ow||{})[ow.NONE=0]="NONE",ow[ow.HTML=1]="HTML",ow[ow.STYLE=2]="STYLE",ow[ow.SCRIPT=3]="SCRIPT",ow[ow.URL=4]="URL",ow[ow.RESOURCE_URL=5]="RESOURCE_URL",ow);function sw(e){var t=cw();return t?PC(t.sanitize(ow.HTML,e)||""):NC(e,"HTML")?PC(MC(e)):iw(gk(),cm(e))}function uw(e){var t=cw();return t?t.sanitize(ow.URL,e)||"":NC(e,"URL")?MC(e):zC(cm(e))}function cw(){var e=Rk();return e&&e[12]}var lw="__ngContext__";function hw(e,t){e[lw]=t}function fw(e){var t=function(e){return e[lw]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function dw(e){return e.ngOriginalError}function vw(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var pw=function(){function e(){Wg(this,e),this._console=console}return jg(e,[{key:"handleError",value:function(e){var t,n=this._findOriginalError(e),r=this._findContext(e),i=(t=e)&&t.ngErrorLogger||vw;i(this._console,"ERROR",e),n&&i(this._console,"ORIGINAL ERROR",n),r&&i(this._console,"ERROR CONTEXT",r)}},{key:"_findContext",value:function(e){return e?e.ngDebugContext||this._findContext(dw(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=e&&dw(e);t&&dw(t);)t=dw(t);return t||null}}]),e}(),gw=/^>|^->|<!--|-->|--!>|<!-$/g,yw=/(<|>)/,mw=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Rm);function kw(e){return e instanceof Function?e():e}var _w,Cw=((Cw=Cw||{})[Cw.Important=1]="Important",Cw[Cw.DashCase=2]="DashCase",Cw);function ww(e,t){return _w(e,t)}function bw(e){var t=e[3];return ek(t)?t[3]:t}function Ew(e){return Pw(e[13])}function Sw(e){return Pw(e[4])}function Pw(e){for(;null!==e&&!ek(e);)e=e[4];return e}function Ow(e,t,n,r,i){if(null!=r){var a,o=!1;ek(r)?a=r:Jm(r)&&(o=!0,r=r[0]);var s=kk(r);0===e&&null!==n?null==i?Bw(t,n,s):Uw(t,n,s,i||null,!0):1===e&&null!==n?Uw(t,n,s,i||null,!0):2===e?Qw(t,s,o):3===e&&t.destroyNode(s),null!=a&&function(e,t,n,r,i){var a=n[7];a!==kk(n)&&Ow(t,e,r,a,i);for(var o=10;o<n.length;o++){var s=n[o];Jw(s[1],s,e,t,r,a)}}(t,e,a,n,i)}}function Tw(e,t){return yk(e)?e.createText(t):e.createTextNode(t)}function Iw(e,t,n){yk(e)?e.setValue(t,n):t.textContent=n}function Aw(e,t){return e.createComment(function(e){return e.replace(gw,function(e){return e.replace(yw,"\u200b$1\u200b")})}(t))}function xw(e,t,n){return yk(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Rw(e,t){var n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Ik(i,-1)),n.splice(r,1)}function Mw(e,t){if(!(e.length<=10)){var n=10+t,r=e[n];if(r){var i=r[17];null!==i&&i!==e&&Rw(i,r),t>0&&(e[n-1][4]=r[4]);var a=tC(e,10+t);!function(e,t){Jw(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);var o=a[19];null!==o&&o.detachView(a[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}}function Nw(e,t){if(!(256&t[2])){var n=t[11];yk(n)&&n.destroyNode&&Jw(e,t,n,3,null,null),function(e){var t=e[13];if(!t)return Dw(e[1],e);for(;t;){var n=null;if(Jm(t))n=t[13];else{var r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)Jm(t)&&Dw(t[1],t),t=t[3];null===t&&(t=e),Jm(t)&&Dw(t[1],t),n=t&&t[4]}t=n}}(t)}}function Dw(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){var n;if(null!=e&&null!=(n=e.destroyHooks))for(var r=0;r<n.length;r+=2){var i=t[n[r]];if(!(i instanceof g_)){var a=n[r+1];if(Array.isArray(a))for(var o=0;o<a.length;o+=2){var s=i[a[o]],u=a[o+1];try{u.call(s)}finally{}}else try{a.call(i)}finally{}}}}(e,t),function(e,t){var n=e.cleanup,r=t[7],i=-1;if(null!==n)for(var a=0;a<n.length-1;a+=2)if("string"==typeof n[a]){var o=n[a+1],s="function"==typeof o?o(t):kk(t[o]),u=r[i=n[a+2]],c=n[a+3];"boolean"==typeof c?s.removeEventListener(n[a],u,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),a+=2}else{var l=r[i=n[a+1]];n[a].call(l)}if(null!==r){for(var h=i+1;h<r.length;h++)r[h]();t[7]=null}}(e,t),1===t[1].type&&yk(t[11])&&t[11].destroy();var n=t[17];if(null!==n&&ek(t[3])){n!==t[3]&&Rw(n,t);var r=t[19];null!==r&&r.detachView(e)}}}function Lw(e,t,n){return Fw(e,t.parent,n)}function Fw(e,t,n){for(var r=t;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){var i=e.data[r.directiveStart].encapsulation;if(i===Tm.None||i===Tm.Emulated)return null}return Ck(r,n)}function Uw(e,t,n,r,i){yk(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Bw(e,t,n){yk(e)?e.appendChild(t,n):t.appendChild(n)}function Vw(e,t,n,r,i){null!==r?Uw(e,t,n,r,i):Bw(e,t,n)}function zw(e,t){return yk(e)?e.parentNode(t):t.parentNode}function Hw(e,t,n){return Ww(e,t,n)}function Gw(e,t,n){return 40&e.type?Ck(e,n):null}var $w,Ww=Gw;function qw(e,t){Ww=e,$w=t}function jw(e,t,n,r){var i=Lw(e,r,t),a=t[11],o=Hw(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(var s=0;s<n.length;s++)Vw(a,i,n[s],o,!1);else Vw(a,i,n,o,!1);void 0!==$w&&$w(a,r,t,n,i)}function Zw(e,t){if(null!==t){var n=t.type;if(3&n)return Ck(t,e);if(4&n)return Kw(-1,e[t.index]);if(8&n){var r=t.child;if(null!==r)return Zw(e,r);var i=e[t.index];return ek(i)?Kw(-1,i):kk(i)}if(32&n)return ww(t,e)()||kk(e[t.index]);var a=Yw(e,t);return null!==a?Array.isArray(a)?a[0]:Zw(bw(e[16]),a):Zw(e,t.next)}return null}function Yw(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Kw(e,t){var n=10+e+1;if(n<t.length){var r=t[n],i=r[1].firstChild;if(null!==i)return Zw(r,i)}return t[7]}function Qw(e,t,n){var r=zw(e,t);r&&function(e,t,n,r){yk(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function Xw(e,t,n,r,i,a,o){for(;null!=n;){var s=r[n.index],u=n.type;if(o&&0===t&&(s&&hw(kk(s),r),n.flags|=4),64!=(64&n.flags))if(8&u)Xw(e,t,n.child,r,i,a,!1),Ow(t,e,i,s,a);else if(32&u){for(var c=ww(n,r),l=void 0;l=c();)Ow(t,e,i,l,a);Ow(t,e,i,s,a)}else 16&u?eb(e,t,r,n,i,a):Ow(t,e,i,s,a);n=o?n.projectionNext:n.next}}function Jw(e,t,n,r,i,a){Xw(n,r,e.firstChild,t,i,a,!1)}function eb(e,t,n,r,i,a){var o=n[16],s=o[6].projection[r.projection];if(Array.isArray(s))for(var u=0;u<s.length;u++)Ow(t,e,i,s[u],a);else Xw(e,t,s,o[3],i,a,!0)}function tb(e,t,n){yk(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function nb(e,t,n){yk(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function rb(e,t,n){for(var r=e.length;;){var i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){var a=t.length;if(i+a===r||e.charCodeAt(i+a)<=32)return i}n=i+1}}var ib="ng-template";function ab(e,t,n){for(var r=0;r<e.length;){var i=e[r++];if(n&&"class"===i){if(-1!==rb((i=e[r]).toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ob(e){return 4===e.type&&e.value!==ib}function sb(e,t,n){return t===(4!==e.type||n?e.value:ib)}function ub(e,t,n){for(var r=4,i=e.attrs||[],a=function(e){for(var t=0;t<e.length;t++)if(m_(e[t]))return t;return e.length}(i),o=!1,s=0;s<t.length;s++){var u=t[s];if("number"!=typeof u){if(!o)if(4&r){if(r=2|1&r,""!==u&&!sb(e,u,n)||""===u&&1===t.length){if(cb(r))return!1;o=!0}}else{var c=8&r?u:t[++s];if(8&r&&null!==e.attrs){if(!ab(e.attrs,c,n)){if(cb(r))return!1;o=!0}continue}var l=lb(8&r?"class":u,i,ob(e),n);if(-1===l){if(cb(r))return!1;o=!0;continue}if(""!==c){var h;h=l>a?"":i[l+1].toLowerCase();var f=8&r?h:null;if(f&&-1!==rb(f,c,0)||2&r&&c!==h){if(cb(r))return!1;o=!0}}}}else{if(!o&&!cb(r)&&!cb(u))return!1;if(o&&cb(u))continue;o=!1,r=u|1&r}}return cb(r)||o}function cb(e){return 0==(1&e)}function lb(e,t,n,r){if(null===t)return-1;var i=0;if(r||!n){for(var a=!1;i<t.length;){var o=t[i];if(o===e)return i;if(3===o||6===o)a=!0;else{if(1===o||2===o){for(var s=t[++i];"string"==typeof s;)s=t[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=a?1:2}return-1}return function(e,t){var n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){var r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function hb(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<t.length;r++)if(ub(e,t[r],n))return!0;return!1}function fb(e,t){return e?":not("+t.trim()+")":t}function db(e){for(var t=e[0],n=1,r=2,i="",a=!1;n<e.length;){var o=e[n];if("string"==typeof o)if(2&r){var s=e[++n];i+="["+o+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!cb(o)&&(t+=fb(a,i),i=""),r=o,a=a||!cb(r);n++}return""!==i&&(t+=fb(a,i)),t}var vb={};function pb(e){gb(Mk(),Rk(),o_()+e,zk())}function gb(e,t,n,r){if(!r)if(3==(3&t[2])){var i=e.preOrderCheckHooks;null!==i&&h_(t,i,n)}else{var a=e.preOrderHooks;null!==a&&f_(t,a,0,n)}s_(n)}function yb(e,t){return e<<17|t<<2}function mb(e){return e>>17&32767}function kb(e){return 2|e}function _b(e){return(131068&e)>>2}function Cb(e,t){return-131069&e|t<<2}function wb(e){return 1|e}function bb(e,t){var n=e.contentQueries;if(null!==n)for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1];if(-1!==a){var o=e.data[a];Qk(i),o.contentQueries(2,t[a],a)}}}function Eb(e,t,n,r,i,a,o,s,u,c){var l=t.blueprint.slice();return l[0]=i,l[2]=140|r,Tk(l),l[3]=l[15]=e,l[8]=n,l[10]=o||e&&e[10],l[11]=s||e&&e[11],l[12]=u||e&&e[12]||null,l[9]=c||e&&e[9]||null,l[6]=a,l[16]=2==t.type?e[16]:l,l}function Sb(e,t,n,r,i){var a=e.data[t];if(null===a)a=Pb(e,t,n,r,i),Ak.lFrame.inI18n&&(a.flags|=64);else if(64&a.type){a.type=n,a.value=r,a.attrs=i;var o=Fk();a.injectorIndex=null===o?-1:o.injectorIndex}return Uk(a,!0),a}function Pb(e,t,n,r,i){var a=Lk(),o=Bk(),s=e.data[t]=function(e,t,n,r,i,a){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?a:a&&a.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=s),null!==a&&(o?null==a.child&&null!==s.parent&&(a.child=s):null===a.next&&(a.next=s)),s}function Ob(e,t,n,r){if(0===n)return-1;for(var i=t.length,a=0;a<n;a++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Tb(e,t,n){e_(t);try{var r=e.viewQuery;null!==r&&oE(1,r,n);var i=e.template;null!==i&&xb(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&bb(e,t),e.staticViewQueries&&oE(2,e.viewQuery,n);var a=e.components;null!==a&&function(e,t){for(var n=0;n<t.length;n++)tE(e,t[n])}(t,a)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,a_()}}function Ib(e,t,n,r){var i=t[2];if(256!=(256&i)){e_(t);var a=zk();try{Tk(t),function(e){Ak.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&xb(e,t,n,2,r);var o=3==(3&i);if(!a)if(o){var s=e.preOrderCheckHooks;null!==s&&h_(t,s,null)}else{var u=e.preOrderHooks;null!==u&&f_(t,u,0,null),d_(t,0)}if(function(e){for(var t=Ew(e);null!==t;t=Sw(t))if(t[2])for(var n=t[9],r=0;r<n.length;r++){var i=n[r],a=i[3];0==(1024&i[2])&&Ik(a,1),i[2]|=1024}}(t),function(e){for(var t=Ew(e);null!==t;t=Sw(t))for(var n=10;n<t.length;n++){var r=t[n],i=r[1];Pk(r)&&Ib(i,r,i.template,r[8])}}(t),null!==e.contentQueries&&bb(e,t),!a)if(o){var c=e.contentCheckHooks;null!==c&&h_(t,c)}else{var l=e.contentHooks;null!==l&&f_(t,l,1),d_(t,1)}!function(e,t){var n=e.hostBindingOpCodes;if(null!==n)try{for(var r=0;r<n.length;r++){var i=n[r];if(i<0)s_(~i);else{var a=i,o=n[++r],s=n[++r];Zk(o,a),s(2,t[a])}}}finally{s_(-1)}}(e,t);var h=e.components;null!==h&&function(e,t){for(var n=0;n<t.length;n++)Jb(e,t[n])}(t,h);var f=e.viewQuery;if(null!==f&&oE(2,f,r),!a)if(o){var d=e.viewCheckHooks;null!==d&&h_(t,d)}else{var v=e.viewHooks;null!==v&&f_(t,v,2),d_(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),a||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Ik(t[3],-1))}finally{a_()}}}function Ab(e,t,n,r){var i=t[10],a=!zk(),o=Sk(t);try{a&&!o&&i.begin&&i.begin(),o&&Tb(e,t,r),Ib(e,t,n,r)}finally{a&&!o&&i.end&&i.end()}}function xb(e,t,n,r,i){var a=o_(),o=2&r;try{s_(-1),o&&t.length>20&&gb(e,t,20,zk()),n(r,i)}finally{s_(a)}}function Rb(e,t,n){if(tk(t))for(var r=t.directiveEnd,i=t.directiveStart;i<r;i++){var a=e.data[i];a.contentQueries&&a.contentQueries(1,n[i],i)}}function Mb(e,t,n){!xk()||(function(e,t,n,r){var i=n.directiveStart,a=n.directiveEnd;e.firstCreatePass||T_(n,t),hw(r,t);for(var o=n.initialInputs,s=i;s<a;s++){var u=e.data[s],c=ik(u);c&&jb(t,n,u);var l=V_(t,e,s,n);hw(l,t),null!==o&&Kb(0,s-i,l,u,0,o),c&&(Ek(n.index,t)[8]=l)}}(e,t,n,Ck(n,t)),128==(128&n.flags)&&function(e,t,n){var r=n.directiveStart,i=n.directiveEnd,a=n.index,o=Ak.lFrame.currentDirectiveIndex;try{s_(a);for(var s=r;s<i;s++){var u=e.data[s],c=t[s];Yk(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&Hb(u,c)}}finally{s_(-1),Yk(o)}}(e,t,n))}function Nb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ck,r=t.localNames;if(null!==r)for(var i=t.index+1,a=0;a<r.length;a+=2){var o=r[a+1],s=-1===o?n(t,e):e[o];e[i++]=s}}function Db(e){var t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Lb(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Lb(e,t,n,r,i,a,o,s,u,c){var l=20+r,h=l+i,f=function(e,t){for(var n=[],r=0;r<t;r++)n.push(r<e?null:vb);return n}(l,h),d="function"==typeof c?c():c;return f[1]={type:e,blueprint:f,template:n,queries:null,viewQuery:s,declTNode:t,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:u,consts:d,incompleteFirstPass:!1}}function Fb(e,t,n,r){var i=uE(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&cE(e).push(r,i.length-1))}function Ub(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Bb(e,t,n,r,i,a,o,s){var u,c=Ck(t,n),l=t.inputs;!s&&null!=l&&(u=l[r])?(hE(e,n,u,r,i),nk(t)&&function(e,t){var n=Ek(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,yk(a)?a.setProperty(c,r,i):k_(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function Vb(e,t,n,r){var i=!1;if(xk()){var a=function(e,t,n){var r=e.directiveRegistry,i=null;if(r)for(var a=0;a<r.length;a++){var o=r[a];hb(n,o.selectors,!1)&&(i||(i=[]),R_(T_(n,t),e,o.type),ik(o)?(Gb(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==a){i=!0,Wb(n,e.data.length,a.length);for(var s=0;s<a.length;s++){var u=a[s];u.providersResolver&&u.providersResolver(u)}for(var c=!1,l=!1,h=Ob(e,t,a.length,null),f=0;f<a.length;f++){var d=a[f];n.mergedAttrs=__(n.mergedAttrs,d.hostAttrs),qb(e,n,t,h,d),$b(h,d,o),null!==d.contentQueries&&(n.flags|=8),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(n.flags|=128);var v=d.type.prototype;!c&&(v.ngOnChanges||v.ngOnInit||v.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),c=!0),!l&&(v.ngOnChanges||v.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),l=!0),h++}!function(e,t){for(var n=t.directiveEnd,r=e.data,i=t.attrs,a=[],o=null,s=null,u=t.directiveStart;u<n;u++){var c=r[u],l=c.inputs,h=null===i||ob(t)?null:Qb(l,i);a.push(h),o=Ub(l,u,o),s=Ub(c.outputs,u,s)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=a,t.inputs=o,t.outputs=s}(e,n)}o&&function(e,t,n){if(t)for(var r=e.localNames=[],i=0;i<t.length;i+=2){var a=n[t[i+1]];if(null==a)throw new um("301","Export of name '".concat(t[i+1],"' not found!"));r.push(t[i],a)}}(n,r,o)}return n.mergedAttrs=__(n.mergedAttrs,n.attrs),i}function zb(e,t,n,r,i,a){var o=a.hostBindings;if(o){var s=e.hostBindingOpCodes;null===s&&(s=e.hostBindingOpCodes=[]);var u=~t.index;(function(e){for(var t=e.length;t>0;){var n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(s)!=u&&s.push(u),s.push(r,i,o)}}function Hb(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Gb(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function $b(e,t,n){if(n){if(t.exportAs)for(var r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;ik(t)&&(n[""]=e)}}function Wb(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function qb(e,t,n,r,i){e.data[r]=i;var a=i.factory||(i.factory=ok(i.type)),o=new g_(a,ik(i),null);e.blueprint[r]=o,n[r]=o,zb(e,t,0,r,Ob(e,n,i.hostVars,vb),i)}function jb(e,t,n){var r=Ck(t,e),i=Db(n),a=e[10],o=nE(e,Eb(e,i,null,n.onPush?64:16,r,t,a,a.createRenderer(r,n),null,null));e[t.index]=o}function Zb(e,t,n,r,i,a){var o=Ck(e,t);Yb(t[11],o,a,e.value,n,r,i)}function Yb(e,t,n,r,i,a,o){if(null==a)yk(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{var s=null==o?cm(a):o(a,r||"",i);yk(e)?e.setAttribute(t,i,s,n):n?t.setAttributeNS(n,i,s):t.setAttribute(i,s)}}function Kb(e,t,n,r,i,a){var o=a[t];if(null!==o)for(var s=r.setInput,u=0;u<o.length;){var c=o[u++],l=o[u++],h=o[u++];null!==s?r.setInput(n,h,c,l):n[l]=h}}function Qb(e,t){for(var n=null,r=0;r<t.length;){var i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function Xb(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function Jb(e,t){var n=Ek(t,e);if(Pk(n)){var r=n[1];80&n[2]?Ib(r,n,r.template,n[8]):n[5]>0&&eE(n)}}function eE(e){for(var t=Ew(e);null!==t;t=Sw(t))for(var n=10;n<t.length;n++){var r=t[n];if(1024&r[2]){var i=r[1];Ib(i,r,i.template,r[8])}else r[5]>0&&eE(r)}var a=e[1].components;if(null!==a)for(var o=0;o<a.length;o++){var s=Ek(a[o],e);Pk(s)&&s[5]>0&&eE(s)}}function tE(e,t){var n=Ek(t,e),r=n[1];(function(e,t){for(var n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Tb(r,n,n[8])}function nE(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function rE(e){for(;e;){e[2]|=64;var t=bw(e);if(ak(e)&&!t)return e;e=t}return null}function iE(e,t,n){var r=t[10];r.begin&&r.begin();try{Ib(e,t,e.template,n)}catch(i){throw lE(t,i),i}finally{r.end&&r.end()}}function aE(e){!function(e){for(var t=0;t<e.components.length;t++){var n=e.components[t],r=fw(n),i=r[1];Ab(i,r,i.template,n)}}(e[8])}function oE(e,t,n){Qk(0),t(e,n)}var sE=Promise.resolve(null);function uE(e){return e[7]||(e[7]=[])}function cE(e){return e.cleanup||(e.cleanup=[])}function lE(e,t){var n=e[9],r=n?n.get(pw,null):null;r&&r.handleError(t)}function hE(e,t,n,r,i){for(var a=0;a<n.length;){var o=n[a++],s=n[a++],u=t[o],c=e.data[o];null!==c.setInput?c.setInput(u,i,r,s):u[s]=i}}function fE(e,t,n){var r=_k(t,e);Iw(e[11],r,n)}function dE(e,t,n){var r=n?e.styles:null,i=n?e.classes:null,a=0;if(null!==t)for(var o=0;o<t.length;o++){var s=t[o];"number"==typeof s?a=s:1==a?i=rm(i,s):2==a&&(r=rm(r,s+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}var vE,pE=new Y_("INJECTOR",-1),gE=function(){function e(){Wg(this,e)}return jg(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sC;if(t===sC){var n=new Error("NullInjectorError: No provider for ".concat(nm(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}(),yE=new Y_("Set Injector scope."),mE={},kE={};function _E(){return void 0===vE&&(vE=new gE),vE}function CE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return new wE(e,n,t||_E(),r)}var wE=function(){function e(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Wg(this,e),this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;var o=[];n&&J_(n,function(e){return i.processProvider(e,t,n)}),J_([t],function(e){return i.processInjectorType(e,[],o)}),this.records.set(pE,SE(void 0,this));var s=this.records.get(yE);this.scope=null!=s?s.value:null,this.source=a||("object"==typeof t?null:nm(t))}return jg(e,[{key:"destroyed",get:function(){return this._destroyed}},{key:"destroy",value:function(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(function(e){return e.ngOnDestroy()})}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sC,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bm.Default;this.assertNotDestroyed();var r,i=dC(this),a=Em(void 0);try{if(!(n&bm.SkipSelf)){var o=this.records.get(e);if(void 0===o){var s=("function"==typeof(r=e)||"object"==typeof r&&r instanceof Y_)&&pm(e);o=s&&this.injectableDefInScope(s)?SE(bE(e),mE):null,this.records.set(e,o)}if(null!=o)return this.hydrate(e,o)}return(n&bm.Self?_E():this.parent).get(e,t=n&bm.Optional&&t===sC?null:t)}catch(u){if("NullInjectorError"===u.name){if((u[cC]=u[cC]||[]).unshift(nm(e)),i)throw u;return kC(u,e,"R3InjectorError",this.source)}throw u}finally{Em(a),dC(i)}}},{key:"_resolveInjectorDefTypes",value:function(){var e=this;this.injectorDefTypes.forEach(function(t){return e.get(t)})}},{key:"toString",value:function(){var e=[];return this.records.forEach(function(t,n){return e.push(nm(n))}),"R3Injector[".concat(e.join(", "),"]")}},{key:"assertNotDestroyed",value:function(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}},{key:"processInjectorType",value:function(e,t,n){var r=this;if(!(e=om(e)))return!1;var i=ym(e),a=null==i&&e.ngModule||void 0,o=void 0===a?e:a,s=-1!==n.indexOf(o);if(void 0!==a&&(i=ym(a)),null==i)return!1;if(null!=i.imports&&!s){var u;n.push(o);try{J_(i.imports,function(e){r.processInjectorType(e,t,n)&&(void 0===u&&(u=[]),u.push(e))})}finally{}if(void 0!==u)for(var c=function(e){var t=u[e],n=t.ngModule,i=t.providers;J_(i,function(e){return r.processProvider(e,n,i||Nm)})},l=0;l<u.length;l++)c(l)}this.injectorDefTypes.add(o);var h=ok(o)||function(){return new o};this.records.set(o,SE(h,mE));var f=i.providers;if(null!=f&&!s){var d=e;J_(f,function(e){return r.processProvider(e,d,f)})}return void 0!==a&&void 0!==e.providers}},{key:"processProvider",value:function(e,t,n){var r,i=OE(e=om(e))?e:om(e&&e.provide),a=PE(r=e)?SE(void 0,r.useValue):SE(EE(r),mE);if(OE(e)||!0!==e.multi)this.records.get(i);else{var o=this.records.get(i);o||((o=SE(void 0,mE,!0)).factory=function(){return gC(o.multi)},this.records.set(i,o)),i=e,o.multi.push(e)}this.records.set(i,a)}},{key:"hydrate",value:function(e,t){return t.value===mE&&(t.value=kE,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}},{key:"injectableDefInScope",value:function(e){if(!e.providedIn)return!1;var t=om(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}]),e}();function bE(e){var t=pm(e),n=null!==t?t.factory:ok(e);if(null!==n)return n;if(e instanceof Y_)throw new Error("Token ".concat(nm(e)," is missing a \u0275prov definition."));if(e instanceof Function)return function(e){var t=e.length;if(t>0){var n=nC(t,"?");throw new Error("Can't resolve all parameters for ".concat(nm(e),": (").concat(n.join(", "),")."))}var r=function(e){var t=e&&(e[km]||e[Cm]);if(t){var n=function(e){if(e.hasOwnProperty("name"))return e.name;var t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn('DEPRECATED: DI is instantiating a token "'.concat(n,'" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "').concat(n,'" class.')),t}return null}(e);return null!==r?function(){return r.factory(e)}:function(){return new e}}(e);throw new Error("unreachable")}function EE(e,t,n){var r;if(OE(e)){var i=om(e);return ok(i)||bE(i)}if(PE(e))r=function(){return om(e.useValue)};else if(function(e){return!(!e||!e.useFactory)}(e))r=function(){return e.useFactory.apply(e,Vg(gC(e.deps||[])))};else if(function(e){return!(!e||!e.useExisting)}(e))r=function(){return pC(om(e.useExisting))};else{var a=om(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return ok(a)||bE(a);r=function(){return Ag(a,Vg(gC(e.deps)))}}return r}function SE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{factory:e,value:t,multi:n?[]:void 0}}function PE(e){return null!==e&&"object"==typeof e&&fC in e}function OE(e){return"function"==typeof e}var TE=function(e,t,n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,i=CE(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)},IE=function(){var e=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?TE(e,t,""):TE(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=sC,e.NULL=new gE,e.\u0275prov=dm({token:e,providedIn:"any",factory:function(){return pC(pE)}}),e.__NG_ELEMENT_ID__=-1,e}();function AE(e,t){l_(fw(e)[1],Dk())}function xE(e){for(var t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0,r=[e];t;){var i=void 0;if(ik(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);var a=e;a.inputs=RE(e.inputs),a.declaredInputs=RE(e.declaredInputs),a.outputs=RE(e.outputs);var o=i.hostBindings;o&&DE(e,o);var s=i.viewQuery,u=i.contentQueries;if(s&&ME(e,s),u&&NE(e,u),tm(e.inputs,i.inputs),tm(e.declaredInputs,i.declaredInputs),tm(e.outputs,i.outputs),ik(i)&&i.data.animation){var c=e.data;c.animation=(c.animation||[]).concat(i.data.animation)}}var l=i.features;if(l)for(var h=0;h<l.length;h++){var f=l[h];f&&f.ngInherit&&f(e),f===xE&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){for(var t=0,n=null,r=e.length-1;r>=0;r--){var i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=__(i.hostAttrs,n=__(n,i.hostAttrs))}}(r)}function RE(e){return e===Mm?{}:e===Nm?[]:e}function ME(e,t){var n=e.viewQuery;e.viewQuery=n?function(e,r){t(e,r),n(e,r)}:t}function NE(e,t){var n=e.contentQueries;e.contentQueries=n?function(e,r,i){t(e,r,i),n(e,r,i)}:t}function DE(e,t){var n=e.hostBindings;e.hostBindings=n?function(e,r){t(e,r),n(e,r)}:t}var LE=null;function FE(){if(!LE){var e=Rm.Symbol;if(e&&e.iterator)LE=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(LE=r)}}return LE}var UE=function(){function e(t){Wg(this,e),this.wrapped=t}return jg(e,null,[{key:"wrap",value:function(t){return new e(t)}},{key:"unwrap",value:function(t){return e.isWrapped(t)?t.wrapped:t}},{key:"isWrapped",value:function(t){return t instanceof e}}]),e}();function BE(e){return!!VE(e)&&(Array.isArray(e)||!(e instanceof Map)&&FE()in e)}function VE(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function zE(e,t,n){return e[t]=n}function HE(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function GE(e,t,n,r){var i=HE(e,t,n);return HE(e,t+1,r)||i}function $E(e,t,n,r){var i=Rk();return HE(i,Wk(),t)&&(Mk(),Zb(u_(),i,e,t,n,r)),$E}function WE(e,t,n,r){return HE(e,Wk(),n)?t+cm(n)+r:vb}function qE(e,t,n,r,i,a){var o=GE(e,$k(),n,i);return qk(2),o?t+cm(n)+r+cm(i)+a:vb}function jE(e,t,n,r,i,a,o,s){var u=function(e,t,n,r,i){var a=GE(e,t,n,r);return HE(e,t+2,i)||a}(e,$k(),n,i,o);return qk(3),u?t+cm(n)+r+cm(i)+a+cm(o)+s:vb}function ZE(e,t,n,r,i,a){var o=Rk(),s=WE(o,t,n,r);return s!==vb&&Zb(u_(),o,e,s,i,a),ZE}function YE(e,t,n,r,i,a,o,s){var u=Rk(),c=Mk(),l=e+20,h=c.firstCreatePass?function(e,t,n,r,i,a,o,s,u){var c=t.consts,l=Sb(t,e,4,o||null,Ok(c,s));Vb(t,n,l,Ok(c,u)),l_(t,l);var h=l.tViews=Lb(2,l,r,i,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,l),h.queries=t.queries.embeddedTView(l)),l}(l,c,u,t,n,r,i,a,o):c.data[l];Uk(h,!1);var f=u[11].createComment("");jw(c,u,f,h),hw(f,u),nE(u,u[l]=Xb(f,u,f,h)),rk(h)&&Mb(c,u,h),null!=o&&Nb(u,h,s)}function KE(e){return bk(Ak.lFrame.contextLView,20+e)}function QE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bm.Default,n=Rk();return null===n?pC(e,t):D_(Dk(),n,om(e),t)}function XE(e,t,n){var r=Rk();return HE(r,Wk(),t)&&Bb(Mk(),u_(),r,e,t,r[11],n,!1),XE}function JE(e,t,n,r,i){var a=i?"class":"style";hE(e,n,t.inputs[a],a,r)}function eS(e,t,n,r){var i=Rk(),a=Mk(),o=20+e,s=i[11],u=i[o]=xw(s,t,Ak.lFrame.currentNamespace),c=a.firstCreatePass?function(e,t,n,r,i,a,o){var s=t.consts,u=Sb(t,e,2,i,Ok(s,a));return Vb(t,n,u,Ok(s,o)),null!==u.attrs&&dE(u,u.attrs,!1),null!==u.mergedAttrs&&dE(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}(o,a,i,0,t,n,r):a.data[o];Uk(c,!0);var l=c.mergedAttrs;null!==l&&y_(s,u,l);var h=c.classes;null!==h&&nb(s,u,h);var f=c.styles;null!==f&&tb(s,u,f),64!=(64&c.flags)&&jw(a,i,u,c),0===Ak.lFrame.elementDepthCount&&hw(u,i),Ak.lFrame.elementDepthCount++,rk(c)&&(Mb(a,i,c),Rb(a,c,i)),null!==r&&Nb(i,c)}function tS(){var e=Dk();Bk()?Vk():Uk(e=e.parent,!1);var t=e;Ak.lFrame.elementDepthCount--;var n=Mk();n.firstCreatePass&&(l_(n,e),tk(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&JE(n,t,Rk(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&JE(n,t,Rk(),t.stylesWithoutHost,!1)}function nS(e,t,n,r){eS(e,t,n,r),tS()}function rS(e,t,n){var r=Rk(),i=Mk(),a=e+20,o=i.firstCreatePass?function(e,t,n,r,i){var a=t.consts,o=Ok(a,r),s=Sb(t,e,8,"ng-container",o);return null!==o&&dE(s,o,!0),Vb(t,n,s,Ok(a,i)),null!==t.queries&&t.queries.elementStart(t,s),s}(a,i,r,t,n):i.data[a];Uk(o,!0);var s=r[a]=r[11].createComment("");jw(i,r,s,o),hw(s,r),rk(o)&&(Mb(i,r,o),Rb(i,o,r)),null!=n&&Nb(r,o)}function iS(){var e=Dk(),t=Mk();Bk()?Vk():Uk(e=e.parent,!1),t.firstCreatePass&&(l_(t,e),tk(e)&&t.queries.elementEnd(e))}function aS(){return Rk()}function oS(e){return!!e&&"function"==typeof e.then}var sS=function(e){return!!e&&"function"==typeof e.subscribe};function uS(e,t,n,r){var i=Rk(),a=Mk(),o=Dk();return function(e,t,n,r,i,a,o,s){var u=rk(r),c=e.firstCreatePass&&cE(e),l=t[8],h=uE(t),f=!0;if(3&r.type||s){var d=Ck(r,t),v=s?s(d):d,p=h.length,g=s?function(e){return s(kk(e[r.index]))}:r.index;if(yk(n)){var y=null;if(!s&&u&&(y=function(e,t,n,r){var i=e.cleanup;if(null!=i)for(var a=0;a<i.length-1;a+=2){var o=i[a];if(o===n&&i[a+1]===r){var s=t[7],u=i[a+2];return s.length>u?s[u]:null}"string"==typeof o&&(a+=2)}return null}(e,t,i,r.index)),null!==y)(y.__ngLastListenerFn__||y).__ngNextListenerFn__=a,y.__ngLastListenerFn__=a,f=!1;else{a=lS(r,t,l,a,!1);var m=n.listen(v,i,a);h.push(a,m),c&&c.push(i,g,p,p+1)}}else a=lS(r,t,l,a,!0),v.addEventListener(i,a,o),h.push(a),c&&c.push(i,g,p,o)}else a=lS(r,t,l,a,!1);var k,_=r.outputs;if(f&&null!==_&&(k=_[i])){var C=k.length;if(C)for(var w=0;w<C;w+=2){var b=t[k[w]][k[w+1]].subscribe(a),E=h.length;h.push(a,b),c&&c.push(i,r.index,E,-(E+1))}}}(a,i,i[11],o,e,t,!!n,r),uS}function cS(e,t,n,r){try{return!1!==n(r)}catch(i){return lE(e,i),!1}}function lS(e,t,n,r,i){return function n(a){if(a===Function)return r;var o=2&e.flags?Ek(e.index,t):t;0==(32&t[2])&&rE(o);for(var s=cS(t,0,r,a),u=n.__ngNextListenerFn__;u;)s=cS(t,0,u,a)&&s,u=u.__ngNextListenerFn__;return i&&!1===s&&(a.preventDefault(),a.returnValue=!1),s}}function hS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(e){return(Ak.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Ak.lFrame.contextLView))[8]}(e)}function fS(e,t,n){return dS(e,"",t,"",n),fS}function dS(e,t,n,r,i){var a=Rk(),o=WE(a,t,n,r);return o!==vb&&Bb(Mk(),u_(),a,e,o,a[11],i,!1),dS}function vS(e,t,n,r,i,a,o){var s=Rk(),u=qE(s,t,n,r,i,a);return u!==vb&&Bb(Mk(),u_(),s,e,u,s[11],o,!1),vS}function pS(e,t,n,r,i,a,o,s,u){var c=Rk(),l=jE(c,t,n,r,i,a,o,s);return l!==vb&&Bb(Mk(),u_(),c,e,l,c[11],u,!1),pS}function gS(e,t,n,r,i){for(var a=e[n+1],o=null===t,s=r?mb(a):_b(a),u=!1;0!==s&&(!1===u||o);){var c=e[s+1];yS(e[s],t)&&(u=!0,e[s+1]=r?wb(c):kb(c)),s=r?mb(c):_b(c)}u&&(e[n+1]=r?kb(a):wb(a))}function yS(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&aC(e,t)>=0}var mS={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function kS(e){return e.substring(mS.key,mS.keyEnd)}function _S(e){return e.substring(mS.value,mS.valueEnd)}function CS(e,t){var n=mS.textEnd,r=mS.key=wS(e,t,n);return n===r?-1:(r=mS.keyEnd=function(e,t,n){for(var r;t<n&&(45===(r=e.charCodeAt(t))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)t++;return t}(e,r,n),r=bS(e,r,n),r=mS.value=wS(e,r,n),r=mS.valueEnd=function(e,t,n){for(var r=-1,i=-1,a=-1,o=t,s=o;o<n;){var u=e.charCodeAt(o++);if(59===u)return s;34===u||39===u?s=o=ES(e,u,o,n):t===o-4&&85===a&&82===i&&76===r&&40===u?s=o=ES(e,41,o,n):u>32&&(s=o),a=i,i=r,r=-33&u}return s}(e,r,n),bS(e,r,n))}function wS(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function bS(e,t,n,r){return(t=wS(e,t,n))<n&&t++,t}function ES(e,t,n,r){for(var i=-1,a=n;a<r;){var o=e.charCodeAt(a++);if(o==t&&92!==i)return a;i=92==o&&92===i?0:o}throw new Error}function SS(e,t){return function(e,t,n,r){var i=Rk(),a=Mk(),o=qk(2);a.firstUpdatePass&&IS(a,e,o,true),t!==vb&&HE(i,o,t)&&MS(a,a.data[o_()],i,i[11],e,i[o+1]=function(e,t){return null==e||"object"==typeof e&&(e=nm(MC(e))),e}(t),true,o)}(e,t),SS}function PS(e){!function(e,t,n,r){var i=Mk(),a=qk(2);i.firstUpdatePass&&IS(i,null,a,r);var o=Rk();if(n!==vb&&HE(o,a,n)){var s=i.data[o_()];if(LS(s,r)&&!TS(i,a)){var u=s.stylesWithoutHost;null!==u&&(n=rm(u,n||"")),JE(i,s,o,n,r)}else!function(e,t,n,r,i,a,o,s){i===vb&&(i=Nm);for(var u=0,c=0,l=0<i.length?i[0]:null,h=0<a.length?a[0]:null;null!==l||null!==h;){var f=u<i.length?i[u+1]:void 0,d=c<a.length?a[c+1]:void 0,v=void 0,p=null;l===h?(u+=2,c+=2,f!==d&&(p=h,v=d)):null===h||null!==l&&l<h?(u+=2,p=l):(c+=2,p=h,v=d),null!==p&&MS(e,t,n,r,p,v,false,s),l=u<i.length?i[u]:null,h=c<a.length?a[c]:null}}(i,s,o,o[11],o[a+1],o[a+1]=function(e,t,n){if(null==n||""===n)return Nm;var r=[],i=MC(n);if(Array.isArray(i))for(var a=0;a<i.length;a++)e(r,i[a],!0);else if("object"==typeof i)for(var o in i)i.hasOwnProperty(o)&&e(r,o,i[o]);else"string"==typeof i&&t(r,i);return r}(e,t,n),0,a)}}(RS,OS,e,!1)}function OS(e,t){for(var n=function(e){return function(e){mS.key=0,mS.keyEnd=0,mS.value=0,mS.valueEnd=0,mS.textEnd=e.length}(e),CS(e,wS(e,0,mS.textEnd))}(t);n>=0;n=CS(t,n))RS(e,kS(t),_S(t))}function TS(e,t){return t>=e.expandoStartIndex}function IS(e,t,n,r){var i=e.data;if(null===i[n+1]){var a=i[o_()],o=TS(e,n);LS(a,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){var i=function(e){var t=Ak.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e),a=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=xS(n=AS(null,e,t,n,r),t.attrs,r),a=null);else{var o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=AS(i,e,t,n,r),null===a){var s=function(e,t,n){var r=n?t.classBindings:t.styleBindings;if(0!==_b(r))return e[mb(r)]}(e,t,r);void 0!==s&&Array.isArray(s)&&function(e,t,n,r){e[mb(n?t.classBindings:t.styleBindings)]=r}(e,t,r,s=xS(s=AS(null,e,t,s[1],r),t.attrs,r))}else a=function(e,t,n){for(var r,i=t.directiveEnd,a=1+t.directiveStylingLast;a<i;a++)r=xS(r,e[a].hostAttrs,n);return xS(r,t.attrs,n)}(e,t,r)}return void 0!==a&&(r?t.residualClasses=a:t.residualStyles=a),n}(i,a,t,r),function(e,t,n,r,i,a){var o=a?t.classBindings:t.styleBindings,s=mb(o),u=_b(o);e[r]=n;var c,l=!1;if(Array.isArray(n)){var h=n;(null===(c=h[1])||aC(h,c)>0)&&(l=!0)}else c=n;if(i)if(0!==u){var f=mb(e[s+1]);e[r+1]=yb(f,s),0!==f&&(e[f+1]=Cb(e[f+1],r)),e[s+1]=function(e,t){return 131071&e|t<<17}(e[s+1],r)}else e[r+1]=yb(s,0),0!==s&&(e[s+1]=Cb(e[s+1],r)),s=r;else e[r+1]=yb(u,0),0===s?s=r:e[u+1]=Cb(e[u+1],r),u=r;l&&(e[r+1]=kb(e[r+1])),gS(e,c,r,!0),gS(e,c,r,!1),function(e,t,n,r,i){var a=i?e.residualClasses:e.residualStyles;null!=a&&"string"==typeof t&&aC(a,t)>=0&&(n[r+1]=wb(n[r+1]))}(t,c,e,r,a),o=yb(s,u),a?t.classBindings=o:t.styleBindings=o}(i,a,t,n,o,r)}}function AS(e,t,n,r,i){var a=null,o=n.directiveEnd,s=n.directiveStylingLast;for(-1===s?s=n.directiveStart:s++;s<o&&(r=xS(r,(a=t[s]).hostAttrs,i),a!==e);)s++;return null!==e&&(n.directiveStylingLast=s),r}function xS(e,t,n){var r=n?1:2,i=-1;if(null!==t)for(var a=0;a<t.length;a++){var o=t[a];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),rC(e,o,!!n||t[++a]))}return void 0===e?null:e}function RS(e,t,n){rC(e,t,MC(n))}function MS(e,t,n,r,i,a,o,s){if(3&t.type){var u=e.data,c=u[s+1];DS(function(e){return 1==(1&e)}(c)?NS(u,t,n,i,_b(c),o):void 0)||(DS(a)||function(e){return 2==(2&e)}(c)&&(a=NS(u,null,n,i,s,o)),function(e,t,n,r,i){var a=yk(e);if(t)i?a?e.addClass(n,r):n.classList.add(r):a?e.removeClass(n,r):n.classList.remove(r);else{var o=-1===r.indexOf("-")?void 0:Cw.DashCase;if(null==i)a?e.removeStyle(n,r,o):n.style.removeProperty(r);else{var s="string"==typeof i&&i.endsWith("!important");s&&(i=i.slice(0,-10),o|=Cw.Important),a?e.setStyle(n,r,i,o):n.style.setProperty(r,i,s?"important":"")}}}(r,o,_k(o_(),n),i,a))}}function NS(e,t,n,r,i,a){for(var o,s=null===t;i>0;){var u=e[i],c=Array.isArray(u),l=c?u[1]:u,h=null===l,f=n[i+1];f===vb&&(f=h?Nm:void 0);var d=h?iC(f,r):l===r?f:void 0;if(c&&!DS(d)&&(d=iC(u,r)),DS(d)&&(o=d,s))return o;var v=e[i+1];i=s?mb(v):_b(v)}if(null!==t){var p=a?t.residualClasses:t.residualStyles;null!=p&&(o=iC(p,r))}return o}function DS(e){return void 0!==e}function LS(e,t){return 0!=(e.flags&(t?16:32))}function FS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Rk(),r=Mk(),i=e+20,a=r.firstCreatePass?Sb(r,i,1,t,null):r.data[i],o=n[i]=Tw(n[11],t);jw(r,n,o,a),Uk(a,!1)}function US(e){return BS("",e,""),US}function BS(e,t,n){var r=Rk(),i=WE(r,e,t,n);return i!==vb&&fE(r,o_(),i),BS}function VS(e,t,n,r,i){var a=Rk(),o=qE(a,e,t,n,r,i);return o!==vb&&fE(a,o_(),o),VS}function zS(e,t,n,r,i,a,o){var s=Rk(),u=jE(s,e,t,n,r,i,a,o);return u!==vb&&fE(s,o_(),u),zS}function HS(e,t,n){var r=Rk();return HE(r,Wk(),t)&&Bb(Mk(),u_(),r,e,t,r[11],n,!0),HS}var GS=void 0,$S=["en",[["a","p"],["AM","PM"],GS],[["AM","PM"],GS,GS],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],GS,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],GS,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",GS,"{1} 'at' {0}",GS],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],WS={};function qS(e){var t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e),n=ZS(t);if(n)return n;var r=t.split("-")[0];if(n=ZS(r))return n;if("en"===r)return $S;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}function jS(e){return qS(e)[YS.PluralCase]}function ZS(e){return e in WS||(WS[e]=Rm.ng&&Rm.ng.common&&Rm.ng.common.locales&&Rm.ng.common.locales[e]),WS[e]}var YS=((YS=YS||{})[YS.LocaleId=0]="LocaleId",YS[YS.DayPeriodsFormat=1]="DayPeriodsFormat",YS[YS.DayPeriodsStandalone=2]="DayPeriodsStandalone",YS[YS.DaysFormat=3]="DaysFormat",YS[YS.DaysStandalone=4]="DaysStandalone",YS[YS.MonthsFormat=5]="MonthsFormat",YS[YS.MonthsStandalone=6]="MonthsStandalone",YS[YS.Eras=7]="Eras",YS[YS.FirstDayOfWeek=8]="FirstDayOfWeek",YS[YS.WeekendRange=9]="WeekendRange",YS[YS.DateFormat=10]="DateFormat",YS[YS.TimeFormat=11]="TimeFormat",YS[YS.DateTimeFormat=12]="DateTimeFormat",YS[YS.NumberSymbols=13]="NumberSymbols",YS[YS.NumberFormats=14]="NumberFormats",YS[YS.CurrencyCode=15]="CurrencyCode",YS[YS.CurrencySymbol=16]="CurrencySymbol",YS[YS.CurrencyName=17]="CurrencyName",YS[YS.Currencies=18]="Currencies",YS[YS.Directionality=19]="Directionality",YS[YS.PluralCase=20]="PluralCase",YS[YS.ExtraData=21]="ExtraData",YS),KS=["zero","one","two","few","many"],QS="en-US",XS={marker:"element"},JS={marker:"ICU"},eP=((eP=eP||{})[eP.SHIFT=2]="SHIFT",eP[eP.APPEND_EAGERLY=1]="APPEND_EAGERLY",eP[eP.COMMENT=2]="COMMENT",eP),tP=QS;function nP(e){(function(e,t){null==e&&fm("Expected localeId to be defined",e,null,"!=")})(e),"string"==typeof e&&(tP=e.toLowerCase().replace(/_/g,"-"))}function rP(e,t,n){var r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?Gw(e,0,n):kk(n[i])}function iP(e,t,n,r,i){var a=t.insertBeforeIndex;if(Array.isArray(a)){var o=r,s=null;if(3&t.type||(s=o,o=i),null!==o&&0==(2&t.flags))for(var u=1;u<a.length;u++)Uw(e,o,n[a[u]],s,!1)}}function aP(e,t){if(e.push(t),e.length>1)for(var n=e.length-2;n>=0;n--){var r=e[n];oP(r)||sP(r,t)&&null===uP(r)&&cP(r,t.index)}}function oP(e){return!(64&e.type)}function sP(e,t){return oP(t)||e.index>t.index}function uP(e){var t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function cP(e,t){var n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(qw(rP,iP),e.insertBeforeIndex=t)}function lP(e,t){var n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function hP(e,t,n){var r=Pb(e,n,64,null,null);return aP(t,r),r}function fP(e,t){var n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function dP(e){return e>>>17}function vP(e){return(131070&e)>>>1}var pP=0,gP=0;function yP(e,t,n,r){for(var i,a=n[11],o=null,s=0;s<t.length;s++){var u=t[s];if("string"==typeof u){var c=t[++s];null===n[c]&&(n[c]=Tw(a,u))}else if("number"==typeof u)switch(1&u){case 0:var l=dP(u),h=void 0,f=void 0;if(null===o&&(o=l,i=zw(a,r)),l===o?(h=r,f=i):(h=null,f=kk(n[l])),null!==f){var d=vP(u);Uw(a,f,n[d],h,!1);var v=lP(e,d);if(null!==v&&"object"==typeof v){var p=fP(v,n);null!==p&&yP(e,v.create[p],n,n[v.anchorIdx])}}break;case 1:var g=t[++s],y=t[++s];Yb(a,_k(u>>>1,n),null,null,g,y,null);break;default:throw new Error('Unable to determine the type of mutate operation for "'.concat(u,'"'))}else switch(u){case JS:var m=t[++s],k=t[++s];null===n[k]&&hw(n[k]=Aw(a,m),n);break;case XS:var _=t[++s],C=t[++s];null===n[C]&&hw(n[C]=xw(a,_,null),n)}}}function mP(e,t,n,r,i){for(var a=0;a<n.length;a++){var o=n[a],s=n[++a];if(o&i)for(var u="",c=a+1;c<=a+s;c++){var l=n[c];if("string"==typeof l)u+=l;else if("number"==typeof l)if(l<0)u+=cm(t[r-l]);else{var h=l>>>2;switch(3&l){case 1:var f=n[++c],d=n[++c],v=e.data[h];"string"==typeof v?Yb(t[11],t[h],null,v,f,u,d):Bb(e,v,t,f,u,t[11],d,!1);break;case 0:var p=t[h];null!==p&&Iw(t[11],p,u);break;case 2:_P(e,lP(e,h),t,u);break;case 3:kP(e,lP(e,h),r,t)}}}else{var g=n[a+1];if(g>0&&3==(3&g)){var y=lP(e,g>>>2);t[y.currentCaseLViewIndex]<0&&kP(e,y,r,t)}}a+=s}}function kP(e,t,n,r){var i=r[t.currentCaseLViewIndex];if(null!==i){var a=pP;i<0&&(i=r[t.currentCaseLViewIndex]=~i,a=-1),mP(e,r,t.update[i],n,a)}}function _P(e,t,n,r){var i=function(e,t){var n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:var r=function(e,t){var n=jS(t)(parseInt(e,10)),r=KS[n];return void 0!==r?r:"other"}(t,tP);-1===(n=e.cases.indexOf(r))&&"other"!==r&&(n=e.cases.indexOf("other"));break;case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(fP(t,n)!==i&&(CP(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){var a=n[t.anchorIdx];a&&yP(e,t.create[i],n,a)}}function CP(e,t,n){var r=fP(t,n);if(null!==r)for(var i=t.remove[r],a=0;a<i.length;a++){var o=i[a];if(o>0){var s=_k(o,n);null!==s&&Qw(n[11],s)}else CP(e,lP(e,~o),n)}}function wP(){var e,t,n=[],r=-1;function i(e,n){r=0;var i=fP(e,n);t=null!==i?e.remove[i]:Nm}function a(){if(r<t.length){var o=t[r++];return o>0?e[o]:(n.push(r,t),i(e[1].data[~o],e),a())}return 0===n.length?null:(t=n.pop(),r=n.pop(),a())}return function(t,r){for(e=r;n.length;)n.pop();return i(t.value,r),a}}var bP=/\ufffd(\d+):?\d*\ufffd/gi,EP=/\ufffd(\d+)\ufffd/,SP=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,PP=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,OP=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,TP=/\uE500/g;function IP(e,t,n,r,i,a,o){var s=Ob(e,r,1,null),u=s<<eP.SHIFT,c=Fk();t===c&&(c=null),null===c&&(u|=eP.APPEND_EAGERLY),o&&(u|=eP.COMMENT,function(e){void 0===_w&&(_w=e())}(wP)),i.push(u,null===a?"":a);var l=Pb(e,s,o?32:1,null===a?"":a,null);aP(n,l);var h=l.index;return Uk(l,!1),null!==c&&t!==c&&function(e,t){var n=e.insertBeforeIndex;null===n?(qw(rP,iP),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){true!=e&&fm("Expecting array here",e,true,"==")}(Array.isArray(n)),n.push(t))}(c,h),l}function AP(e,t,n,r,i,a,o){var s=o.match(bP),u=IP(e,t,n,a,r,s?null:o,!1);s&&xP(i,o,u.index,null,0,null)}function xP(e,t,n,r,i,a){var o=e.length,s=o+1;e.push(null,null);for(var u=o+2,c=t.split(bP),l=0,h=0;h<c.length;h++){var f=c[h];if(1&h){var d=i+parseInt(f,10);e.push(-1-d),l|=RP(d)}else""!==f&&e.push(f)}return e.push(n<<2|(r?1:0)),r&&e.push(r,a),e[o]=l,e[s]=e.length-u,l}function RP(e){return 1<<Math.min(e,31)}function MP(e){for(var t,n,r="",i=0,a=!1;null!==(t=PP.exec(e));)a?t[0]==="\ufffd/*".concat(n,"\ufffd")&&(i=t.index,a=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],a=!0);return r+=e.substr(i)}function NP(e,t,n,r,i,a){var o=0,s={type:i.type,currentCaseLViewIndex:Ob(e,t,1,null),anchorIdx:a,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(RP(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,a),function(e,t,n){var r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,a,s);for(var u=i.values,c=0;c<u.length;c++){for(var l=u[c],h=[],f=0;f<l.length;f++){var d=l[f];if("string"!=typeof d){var v=h.push(d)-1;l[f]="\x3c!--\ufffd".concat(v,"\ufffd--\x3e")}}o=FP(e,s,t,n,r,i.cases[c],l.join(""),h)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,a)}function DP(e){for(var t=[],n=[],r=1,i=0,a=LP(e=e.replace(SP,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""})),o=0;o<a.length;){var s=a[o++].trim();1===r&&(s=s.replace(/\s*(?:=)?(\w+)\s*/,"$1")),s.length&&t.push(s);var u=LP(a[o++]);t.length>n.length&&n.push(u)}return{type:r,mainBinding:i,cases:t,values:n}}function LP(e){if(!e)return[];var t,n=0,r=[],i=[],a=/[{}]/g;for(a.lastIndex=0;t=a.exec(e);){var o=t.index;if("}"==t[0]){if(r.pop(),0==r.length){var s=e.substring(n,o);SP.test(s)?i.push(DP(s)):i.push(s),n=o+1}}else{if(0==r.length){var u=e.substring(n,o);i.push(u),n=o+1}r.push("{")}}var c=e.substring(n);return i.push(c),i}function FP(e,t,n,r,i,a,o,s){var u=[],c=[],l=[];t.cases.push(a),t.create.push(u),t.remove.push(c),t.update.push(l);var h=LC(gk()).getInertBodyElement(o),f=aw(h)||h;return f?UP(e,t,n,r,u,c,l,f,i,s,0):0}function UP(e,t,n,r,i,a,o,s,u,c,l){for(var h=0,f=s.firstChild;f;){var d=Ob(e,n,1,null);switch(f.nodeType){case Node.ELEMENT_NODE:var v=f,p=v.tagName.toLowerCase();if(YC.hasOwnProperty(p)){zP(i,XS,p,u,d),e.data[d]=p;for(var g=v.attributes,y=0;y<g.length;y++){var m=g.item(y),k=m.name.toLowerCase();m.value.match(bP)?XC.hasOwnProperty(k)&&xP(o,m.value,d,m.name,0,KC[k]?zC:QC[k]?HC:null):HP(i,d,m)}h=UP(e,t,n,r,i,a,o,f,d,c,l+1)|h,BP(a,d,l)}break;case Node.TEXT_NODE:var _=f.textContent||"",C=_.match(bP);zP(i,null,C?"":_,u,d),BP(a,d,l),C&&(h=xP(o,_,d,null,0,null)|h);break;case Node.COMMENT_NODE:var w=EP.exec(f.textContent||"");if(w){var b=c[parseInt(w[1],10)];zP(i,JS,"",u,d),NP(e,n,r,u,b,d),VP(a,d,l)}}f=f.nextSibling}return h}function BP(e,t,n){0===n&&e.push(t)}function VP(e,t,n){0===n&&(e.push(~t),e.push(t))}function zP(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function HP(e,t,n){e.push(t<<1|1,n.name,n.value)}function GP(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=Mk(),i=Rk(),a=20+e,o=Ok(r.consts,t),s=Fk();r.firstCreatePass&&function(e,t,n,r,i,a){for(var o=Fk(),s=[],u=[],c=[[]],l=function(e){return e.replace(TP," ")}(i=function(e,t){if(function(e){return-1===e}(t))return MP(e);var n=e.indexOf(":".concat(t,"\ufffd"))+2+t.toString().length,r=e.search(new RegExp("\ufffd\\/\\*\\d+:".concat(t,"\ufffd")));return MP(e.substring(n,r))}(i,a)).split(OP),h=0;h<l.length;h++){var f=l[h];if(0==(1&h))for(var d=LP(f),v=0;v<d.length;v++){var p=d[v];if(0==(1&v)){var g=p;""!==g&&AP(e,o,c[0],s,u,n,g)}else{var y=p;if("object"!=typeof y)throw new Error('Unable to parse ICU expression in "'.concat(i,'" message.'));NP(e,n,u,t,y,IP(e,o,c[0],n,s,"",!0).index)}}else{var m=47===f.charCodeAt(0),k=(f.charCodeAt(m?1:0),20+Number.parseInt(f.substring(m?2:1)));if(m)c.shift(),Uk(Fk(),!1);else{var _=hP(e,c[0],k);c.unshift([]),Uk(_,!0)}}}e.data[r]={create:s,update:u}}(r,null===s?0:s.index,i,a,o,n);var u=r.data[a],c=Fw(r,s===i[6]?null:s,i);(function(e,t,n,r){for(var i=e[11],a=0;a<t.length;a++){var o=t[a++],s=t[a],u=(o&eP.COMMENT)===eP.COMMENT,c=(o&eP.APPEND_EAGERLY)===eP.APPEND_EAGERLY,l=o>>>eP.SHIFT,h=e[l];null===h&&(h=e[l]=u?i.createComment(s):Tw(i,s)),c&&null!==n&&Uw(i,n,h,r,!1)}})(i,u.create,c,s&&8&s.type?i[s.index]:null),jk(!0)}function $P(){jk(!1)}function WP(e,t,n){GP(e,t,n),$P()}function qP(e){return function(e){e&&(pP|=1<<Math.min(gP,31)),gP++}(HE(Rk(),Wk(),e)),qP}function jP(e){!function(e,t,n){if(gP>0){var r=e.data[n];mP(e,t,Array.isArray(r)?r:r.update,$k()-gP-1,pP)}pP=0,gP=0}(Mk(),Rk(),e+20)}function ZP(e,t,n,r,i){if(e=om(e),Array.isArray(e))for(var a=0;a<e.length;a++)ZP(e[a],t,n,r,i);else{var o=Mk(),s=Rk(),u=OE(e)?e:om(e.provide),c=EE(e),l=Dk(),h=1048575&l.providerIndexes,f=l.directiveStart,d=l.providerIndexes>>20;if(OE(e)||!e.multi){var v=new g_(c,i,QE),p=QP(u,t,i?h:h+d,f);-1===p?(R_(T_(l,s),o,u),YP(o,e,t.length),t.push(u),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(v),s.push(v)):(n[p]=v,s[p]=v)}else{var g=QP(u,t,h+d,f),y=QP(u,t,h,h+d),m=g>=0&&n[g],k=y>=0&&n[y];if(i&&!k||!i&&!m){R_(T_(l,s),o,u);var _=function(e,t,n,r,i){var a=new g_(e,n,QE);return a.multi=[],a.index=t,a.componentProviders=0,KP(a,i,r&&!n),a}(i?JP:XP,n.length,i,r,c);!i&&k&&(n[y].providerFactory=_),YP(o,e,t.length,0),t.push(u),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(_),s.push(_)}else YP(o,e,g>-1?g:y,KP(n[i?y:g],c,!i&&r));!i&&r&&k&&n[y].componentProviders++}}}function YP(e,t,n,r){var i=OE(t);if(i||function(e){return!!e.useClass}(t)){var a=(t.useClass||t).prototype.ngOnDestroy;if(a){var o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){var s=o.indexOf(n);-1===s?o.push(n,[r,a]):o[s+1].push(r,a)}else o.push(n,a)}}}function KP(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function QP(e,t,n,r){for(var i=n;i<r;i++)if(t[i]===e)return i;return-1}function XP(e,t,n,r){return eO(this.multi,[])}function JP(e,t,n,r){var i,a=this.multi;if(this.providerFactory){var o=this.providerFactory.componentProviders,s=V_(n,n[1],this.providerFactory.index,r);eO(a,i=s.slice(0,o));for(var u=o;u<s.length;u++)i.push(s[u])}else eO(a,i=[]);return i}function eO(e,t){for(var n=0;n<e.length;n++)t.push((0,e[n])());return t}function tO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(n){n.providersResolver=function(n,r){return function(e,t,n){var r=Mk();if(r.firstCreatePass){var i=ik(e);ZP(n,r.data,r.blueprint,i,!0),ZP(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}}var nO=jg(function e(){Wg(this,e)}),rO=function(){function e(){Wg(this,e)}return jg(e,[{key:"resolveComponentFactory",value:function(e){throw function(e){var t=Error("No component factory found for ".concat(nm(e),". Did you add it to @NgModule.entryComponents?"));return t.ngComponent=e,t}(e)}}]),e}(),iO=function(){var e=jg(function e(){Wg(this,e)});return e.NULL=new rO,e}();function aO(){}function oO(e,t){return new uO(Ck(e,t))}var sO=function(){return oO(Dk(),Rk())},uO=function(){var e=jg(function e(t){Wg(this,e),this.nativeElement=t});return e.__NG_ELEMENT_ID__=sO,e}();function cO(e){return e instanceof uO?e.nativeElement:e}var lO=jg(function e(){Wg(this,e)}),hO=function(){var e=jg(function e(){Wg(this,e)});return e.__NG_ELEMENT_ID__=function(){return fO()},e}(),fO=function(){var e=Rk(),t=Ek(Dk().index,e);return function(e){return e[11]}(Jm(t)?t:e)},dO=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275prov=dm({token:e,providedIn:"root",factory:function(){return null}}),e}(),vO=jg(function e(t){Wg(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}),pO=new vO("12.2.16"),gO=function(){function e(){Wg(this,e)}return jg(e,[{key:"supports",value:function(e){return BE(e)}},{key:"create",value:function(e){return new mO(e)}}]),e}(),yO=function(e,t){return t},mO=function(){function e(t){Wg(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||yO}return jg(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,i=null;t||n;){var a=!n||t&&t.currentIndex<wO(n,r,i)?t:n,o=wO(a,r,i),s=a.currentIndex;if(a===n)r--,n=n._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{i||(i=[]);var u=o-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<i.length?i[l]:i[l]=0,f=h+l;c<=f&&f<u&&(i[l]=h+1)}i[a.previousIndex]=c-u}}o!==s&&e(a,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!BE(e))throw new Error("Error trying to diff '".concat(nm(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,i,a=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],i=this._trackByFn(s,r),null!==a&&Object.is(a.trackById,i)?(o&&(a=this._verifyReinsertion(a,r,i,s)),Object.is(a.item,r)||this._addIdentityChange(a,r)):(a=this._mismatch(a,r,i,s),o=!0),a=a._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,i=e[FE()]();!(r=i.next()).done;)t(r.value)}(e,function(e){i=t._trackByFn(n,e),null!==a&&Object.is(a.trackById,i)?(o&&(a=t._verifyReinsertion(a,e,i,n)),Object.is(a.item,e)||t._addIdentityChange(a,e)):(a=t._mismatch(a,e,i,n),o=!0),a=a._next,n++}),this.length=n;return this._truncate(a),this.collection=e,this.isDirty}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}},{key:"_reset",value:function(){if(this.isDirty){var e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new kO(t,n),i,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new CO),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new CO),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}]),e}(),kO=jg(function e(t,n){Wg(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}),_O=function(){function e(){Wg(this,e),this._head=null,this._tail=null}return jg(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),CO=function(){function e(){Wg(this,e),this.map=new Map}return jg(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new _O,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"isEmpty",get:function(){return 0===this.map.size}},{key:"clear",value:function(){this.map.clear()}}]),e}();function wO(e,t,n){var r=e.previousIndex;if(null===r)return r;var i=0;return n&&r<n.length&&(i=n[r]),r+t+i}var bO=function(){function e(){Wg(this,e)}return jg(e,[{key:"supports",value:function(e){return e instanceof Map||VE(e)}},{key:"create",value:function(){return new EO}}]),e}(),EO=function(){function e(){Wg(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return jg(e,[{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}},{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||VE(e)))throw new Error("Error trying to diff '".concat(nm(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var i=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,i)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}var a=new SO(e);return this._records.set(e,a),a.currentValue=t,this._addToAdditions(a),a}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(function(n){return t(e[n],n)})}}]),e}(),SO=jg(function e(t){Wg(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null});function PO(){return new OO([new gO])}var OO=function(){var e=function(){function e(t){Wg(this,e),this.factories=t}return jg(e,[{key:"find",value:function(e){var t=this.factories.find(function(t){return t.supports(e)});if(null!=t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat(function(e){return e.name||typeof e}(e),"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){return e.create(t,n||PO())},deps:[[e,new EC,new bC]]}}}]),e}();return e.\u0275prov=dm({token:e,providedIn:"root",factory:PO}),e}();function TO(){return new IO([new bO])}var IO=function(){var e=function(){function e(t){Wg(this,e),this.factories=t}return jg(e,[{key:"find",value:function(e){var t=this.factories.find(function(t){return t.supports(e)});if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){return e.create(t,n||TO())},deps:[[e,new EC,new bC]]}}}]),e}();return e.\u0275prov=dm({token:e,providedIn:"root",factory:TO}),e}();function AO(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];null!==n;){var a=t[n.index];if(null!==a&&r.push(kk(a)),ek(a))for(var o=10;o<a.length;o++){var s=a[o],u=s[1].firstChild;null!==u&&AO(s[1],s,u,r)}var c=n.type;if(8&c)AO(e,t,n.child,r);else if(32&c)for(var l=ww(n,t),h=void 0;h=l();)r.push(h);else if(16&c){var f=Yw(t,n);if(Array.isArray(f))r.push.apply(r,Vg(f));else{var d=bw(t[16]);AO(d[1],d,f,r,!0)}}n=i?n.projectionNext:n.next}return r}var xO=function(){function e(t,n){Wg(this,e),this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}return jg(e,[{key:"rootNodes",get:function(){var e=this._lView,t=e[1];return AO(t,e,t.firstChild,[])}},{key:"context",get:function(){return this._lView[8]},set:function(e){this._lView[8]=e}},{key:"destroyed",get:function(){return 256==(256&this._lView[2])}},{key:"destroy",value:function(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){var e=this._lView[3];if(ek(e)){var t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Mw(e,n),tC(t,n))}this._attachedToViewContainer=!1}Nw(this._lView[1],this._lView)}},{key:"onDestroy",value:function(e){Fb(this._lView[1],this._lView,null,e)}},{key:"markForCheck",value:function(){rE(this._cdRefInjectingView||this._lView)}},{key:"detach",value:function(){this._lView[2]&=-129}},{key:"reattach",value:function(){this._lView[2]|=128}},{key:"detectChanges",value:function(){iE(this._lView[1],this._lView,this.context)}},{key:"checkNoChanges",value:function(){!function(e,t,n){Hk(!0);try{iE(e,t,n)}finally{Hk(!1)}}(this._lView[1],this._lView,this.context)}},{key:"attachToViewContainerRef",value:function(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}},{key:"detachFromAppRef",value:function(){var e;this._appRef=null,Jw(this._lView[1],e=this._lView,e[11],2,null,null)}},{key:"attachToAppRef",value:function(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}]),e}(),RO=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e))._view=e,r}return jg(n,[{key:"detectChanges",value:function(){aE(this._view)}},{key:"checkNoChanges",value:function(){!function(e){Hk(!0);try{aE(e)}finally{Hk(!1)}}(this._view)}},{key:"context",get:function(){return null}}]),n}(xO),MO=function(e){return function(e,t,n){if(nk(e)&&!n){var r=Ek(e.index,t);return new xO(r,r)}return 47&e.type?new xO(t[16],t):null}(Dk(),Rk(),16==(16&e))},NO=function(){var e=jg(function e(){Wg(this,e)});return e.__NG_ELEMENT_ID__=MO,e}(),DO=[new bO],LO=new OO([new gO]),FO=new IO(DO),UO=function(){return zO(Dk(),Rk())},BO=function(){var e=jg(function e(){Wg(this,e)});return e.__NG_ELEMENT_ID__=UO,e}(),VO=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this))._declarationLView=e,a._declarationTContainer=r,a.elementRef=i,a}return jg(n,[{key:"createEmbeddedView",value:function(e){var t=this._declarationTContainer.tViews,n=Eb(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];var r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Tb(t,n,e),new xO(n)}}]),n}(BO);function zO(e,t){return 4&e.type?new VO(t,e,oO(e,t)):null}var HO=jg(function e(){Wg(this,e)}),GO=jg(function e(){Wg(this,e)}),$O=function(){return YO(Dk(),Rk())},WO=function(){var e=jg(function e(){Wg(this,e)});return e.__NG_ELEMENT_ID__=$O,e}(),qO=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this))._lContainer=e,a._hostTNode=r,a._hostLView=i,a}return jg(n,[{key:"element",get:function(){return oO(this._hostTNode,this._hostLView)}},{key:"injector",get:function(){return new G_(this._hostTNode,this._hostLView)}},{key:"parentInjector",get:function(){var e=x_(this._hostTNode,this._hostLView);if(w_(e)){var t=E_(e,this._hostLView),n=b_(e);return new G_(t[1].data[n+8],t)}return new G_(null,this._hostLView)}},{key:"clear",value:function(){for(;this.length>0;)this.remove(this.length-1)}},{key:"get",value:function(e){var t=jO(this._lContainer);return null!==t&&t[e]||null}},{key:"length",get:function(){return this._lContainer.length-10}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,i){var a=n||this.parentInjector;if(!i&&null==e.ngModule&&a){var o=a.get(HO,null);o&&(i=o)}var s=e.create(a,r,void 0,i);return this.insert(s.hostView,t),s}},{key:"insert",value:function(e,t){var r=e._lView,i=r[1];if(ek(r[3])){var a=this.indexOf(e);if(-1!==a)this.detach(a);else{var o=r[3],s=new n(o,o[6],o[3]);s.detach(s.indexOf(e))}}var u=this._adjustIndex(t),c=this._lContainer;!function(e,t,n,r){var i=10+r,a=n.length;r>0&&(n[i-1][4]=t),r<a-10?(t[4]=n[i],eC(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;var o=t[17];null!==o&&n!==o&&function(e,t){var n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);var s=t[19];null!==s&&s.insertView(e),t[2]|=128}(i,r,c,u);var l=Kw(u,c),h=r[11],f=zw(h,c[7]);return null!==f&&function(e,t,n,r,i,a){r[0]=i,r[6]=t,Jw(e,r,n,1,i,a)}(i,c[6],h,r,f,l),e.attachToViewContainerRef(),eC(ZO(c),u,e),e}},{key:"move",value:function(e,t){return this.insert(e,t)}},{key:"indexOf",value:function(e){var t=jO(this._lContainer);return null!==t?t.indexOf(e):-1}},{key:"remove",value:function(e){var t=this._adjustIndex(e,-1),n=Mw(this._lContainer,t);n&&(tC(ZO(this._lContainer),t),Nw(n[1],n))}},{key:"detach",value:function(e){var t=this._adjustIndex(e,-1),n=Mw(this._lContainer,t);return n&&null!=tC(ZO(this._lContainer),t)?new xO(n):null}},{key:"_adjustIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null!=e?e:this.length+t}}]),n}(WO);function jO(e){return e[8]}function ZO(e){return e[8]||(e[8]=[])}function YO(e,t){var n,r=t[e.index];if(ek(r))n=r;else{var i;if(8&e.type)i=kk(r);else{var a=t[11];i=a.createComment("");var o=Ck(e,t);Uw(a,zw(a,o),i,function(e,t){return yk(e)?e.nextSibling(t):t.nextSibling}(a,o),!1)}t[e.index]=n=Xb(r,t,i,e),nE(t,n)}return new qO(n,e,t)}var KO={},QO=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).ngModule=e,r}return jg(n,[{key:"resolveComponentFactory",value:function(e){var t=Qm(e);return new eT(t,this.ngModule)}}]),n}(iO);function XO(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}var JO=new Y_("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return mw}}),eT=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).componentDef=e,i.ngModule=r,i.componentType=e.type,i.selector=e.selectors.map(db).join(","),i.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],i.isBoundToModule=!!r,i}return jg(n,[{key:"inputs",get:function(){return XO(this.componentDef.inputs)}},{key:"outputs",get:function(){return XO(this.componentDef.outputs)}},{key:"create",value:function(e,t,n,r){var i,a,o=(r=r||this.ngModule)?function(e,t){return{get:function(n,r,i){var a=e.get(n,KO,i);return a!==KO||r===KO?a:t.get(n,r,i)}}}(e,r.injector):e,s=o.get(lO,mk),u=o.get(dO,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",h=n?function(e,t,n){if(yk(e))return e.selectRootElement(t,n===Tm.ShadowDom);var r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(c,n,this.componentDef.encapsulation):xw(s.createRenderer(null,this.componentDef),l,function(e){var t=e.toLowerCase();return"svg"===t?pk:"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),f=this.componentDef.onPush?576:528,d={components:[],scheduler:mw,clean:sE,playerHandler:null,flags:0},v=Lb(0,null,null,1,0,null,null,null,null,null),p=Eb(null,v,d,f,null,null,s,c,u,o);e_(p);try{var g=function(e,t,n,r,i,a){var o=n[1];n[20]=e;var s=Sb(o,20,2,"#host",null),u=s.mergedAttrs=t.hostAttrs;null!==u&&(dE(s,u,!0),null!==e&&(y_(i,e,u),null!==s.classes&&nb(i,e,s.classes),null!==s.styles&&tb(i,e,s.styles)));var c=r.createRenderer(e,t),l=Eb(n,Db(t),null,t.onPush?64:16,n[20],s,r,c,null,null);return o.firstCreatePass&&(R_(T_(s,n),o,t.type),Gb(o,s),Wb(s,n.length,1)),nE(n,l),n[20]=l}(h,this.componentDef,p,s,c);if(h)if(n)y_(c,h,["ng-version",pO.full]);else{var y=function(e){for(var t=[],n=[],r=1,i=2;r<e.length;){var a=e[r];if("string"==typeof a)2===i?""!==a&&t.push(a,e[++r]):8===i&&n.push(a);else{if(!cb(i))break;i=a}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]),m=y.attrs,k=y.classes;m&&y_(c,h,m),k&&k.length>0&&nb(c,h,k.join(" "))}if(a=wk(v,20),void 0!==t)for(var _=a.projection=[],C=0;C<this.ngContentSelectors.length;C++){var w=t[C];_.push(null!=w?Array.from(w):null)}i=function(e,t,n,r,i){var a=n[1],o=function(e,t,n){var r=Dk();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),qb(e,r,t,Ob(e,t,1,null),n));var i=V_(t,e,r.directiveStart,r);hw(i,t);var a=Ck(r,t);return a&&hw(a,t),i}(a,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(function(e){return e(o,t)}),t.contentQueries){var s=Dk();t.contentQueries(1,o,s.directiveStart)}var u=Dk();return!a.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(s_(u.index),zb(n[1],u,0,u.directiveStart,u.directiveEnd,t),Hb(t,o)),o}(g,this.componentDef,p,d,[AE]),Tb(v,p,null)}finally{a_()}return new tT(this.componentType,i,oO(a,p),p,a)}}]),n}(nO),tT=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this)).location=i,s._rootLView=a,s._tNode=o,s.instance=r,s.hostView=s.changeDetectorRef=new RO(a),s.componentType=e,s}return jg(n,[{key:"injector",get:function(){return new G_(this._tNode,this._rootLView)}},{key:"destroy",value:function(){this.hostView.destroy()}},{key:"onDestroy",value:function(e){this.hostView.onDestroy(e)}}]),n}(function(){return jg(function e(){Wg(this,e)})}()),nT=new Map,rT=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;Wg(this,n),(i=t.call(this))._parent=r,i._bootstrapComponents=[],i.injector=Fg(i),i.destroyCbs=[],i.componentFactoryResolver=new QO(Fg(i));var a=Xm(e),o=e[Bm]||null;return o&&nP(o),i._bootstrapComponents=kw(a.bootstrap),i._r3Injector=CE(e,r,[{provide:HO,useValue:Fg(i)},{provide:iO,useValue:i.componentFactoryResolver}],nm(e)),i._r3Injector._resolveInjectorDefTypes(),i.instance=i.get(e),i}return jg(n,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IE.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bm.Default;return e===IE||e===HO||e===pE?this:this._r3Injector.get(e,t,n)}},{key:"destroy",value:function(){var e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(function(e){return e()}),this.destroyCbs=null}},{key:"onDestroy",value:function(e){this.destroyCbs.push(e)}}]),n}(HO),iT=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).moduleType=e,null!==Xm(e)&&function(e){var t=new Set;!function e(n){var r=Xm(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error("Duplicate module registered for ".concat(e," - ").concat(nm(t)," vs ").concat(nm(t.name)))}(i,nT.get(i),n),nT.set(i,n));var a,o=Hg(kw(r.imports));try{for(o.s();!(a=o.n()).done;){var s=a.value;t.has(s)||(t.add(s),e(s))}}catch(u){o.e(u)}finally{o.f()}}(e)}(e),r}return jg(n,[{key:"create",value:function(e){return new rT(this.moduleType,e)}}]),n}(GO);function aT(e,t,n){var r=Gk()+e,i=Rk();return i[r]===vb?zE(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function oT(e,t,n,r){return cT(Rk(),Gk(),e,t,n,r)}function sT(e,t,n,r,i){return lT(Rk(),Gk(),e,t,n,r,i)}function uT(e,t){var n=e[t];return n===vb?void 0:n}function cT(e,t,n,r,i,a){var o=t+n;return HE(e,o,i)?zE(e,o+1,a?r.call(a,i):r(i)):uT(e,o+1)}function lT(e,t,n,r,i,a,o){var s=t+n;return GE(e,s,i,a)?zE(e,s+2,o?r.call(o,i,a):r(i,a)):uT(e,s+2)}function hT(e,t){var n,r=Mk(),i=e+20;r.firstCreatePass?(n=function(e,t){if(t)for(var n=t.length-1;n>=0;n--){var r=t[n];if(e===r.name)return r}throw new um("302","The pipe '".concat(e,"' could not be found!"))}(t,r.pipeRegistry),r.data[i]=n,n.onDestroy&&(r.destroyHooks||(r.destroyHooks=[])).push(i,n.onDestroy)):n=r.data[i];var a=n.factory||(n.factory=ok(n.type)),o=Em(QE);try{var s=P_(!1),u=a();return P_(s),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(r,Rk(),i,u),u}finally{Em(o)}}function fT(e,t,n){var r=e+20,i=Rk(),a=bk(i,r);return vT(i,dT(i,r)?cT(i,Gk(),t,a.transform,n,a):a.transform(n))}function dT(e,t){return e[1].data[t].pure}function vT(e,t){return UE.isWrapped(t)&&(t=UE.unwrap(t),e[$k()]=vb),t}function pT(e){return function(t){setTimeout(e,void 0,t)}}var gT=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Wg(this,n),(e=t.call(this)).__isAsync=r,e}return jg(n,[{key:"emit",value:function(e){xg(Bg(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var i,a,o,s=e,u=t||function(){return null},c=r;if(e&&"object"==typeof e){var l=e;s=null===(i=l.next)||void 0===i?void 0:i.bind(l),u=null===(a=l.error)||void 0===a?void 0:a.bind(l),c=null===(o=l.complete)||void 0===o?void 0:o.bind(l)}this.__isAsync&&(u=pT(u),s&&(s=pT(s)),c&&(c=pT(c)));var h=xg(Bg(n.prototype),"subscribe",this).call(this,{next:s,error:u,complete:c});return e instanceof qg&&e.add(h),h}}]),n}(_y);function yT(){return this._results[FE()]()}var mT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Wg(this,e),this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;var n=FE(),r=e.prototype;r[n]||(r[n]=yT)}return jg(e,[{key:"changes",get:function(){return this._changes||(this._changes=new gT)}},{key:"get",value:function(e){return this._results[e]}},{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e,t){var n=this;n.dirty=!1;var r=X_(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var i=e[r],a=t[r];if(n&&(i=n(i),a=n(a)),a!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}},{key:"notifyOnChanges",value:function(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}();Symbol;var kT=function(){function e(t){Wg(this,e),this.queryList=t,this.matches=null}return jg(e,[{key:"clone",value:function(){return new e(this.queryList)}},{key:"setDirty",value:function(){this.queryList.setDirty()}}]),e}(),_T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Wg(this,e),this.queries=t}return jg(e,[{key:"createEmbeddedView",value:function(t){var n=t.queries;if(null!==n){for(var r=null!==t.contentQueries?t.contentQueries[0]:n.length,i=[],a=0;a<r;a++){var o=n.getByIndex(a);i.push(this.queries[o.indexInDeclarationView].clone())}return new e(i)}return null}},{key:"insertView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"detachView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"dirtyQueriesWithMatches",value:function(e){for(var t=0;t<this.queries.length;t++)null!==xT(e,t).matches&&this.queries[t].setDirty()}}]),e}(),CT=jg(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Wg(this,e),this.predicate=t,this.flags=n,this.read=r}),wT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Wg(this,e),this.queries=t}return jg(e,[{key:"elementStart",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}},{key:"elementEnd",value:function(e){for(var t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}},{key:"embeddedTView",value:function(t){for(var n=null,r=0;r<this.length;r++){var i=null!==n?n.length:0,a=this.getByIndex(r).embeddedTView(t,i);a&&(a.indexInDeclarationView=r,null!==n?n.push(a):n=[a])}return null!==n?new e(n):null}},{key:"template",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}},{key:"getByIndex",value:function(e){return this.queries[e]}},{key:"length",get:function(){return this.queries.length}},{key:"track",value:function(e){this.queries.push(e)}}]),e}(),bT=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Wg(this,e),this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}return jg(e,[{key:"elementStart",value:function(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}},{key:"elementEnd",value:function(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}},{key:"template",value:function(e,t){this.elementStart(e,t)}},{key:"embeddedTView",value:function(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new e(this.metadata)):null}},{key:"isApplyingToNode",value:function(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){for(var t=this._declarationNodeIndex,n=e.parent;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}},{key:"matchTNode",value:function(e,t){var n=this.metadata.predicate;if(Array.isArray(n))for(var r=0;r<n.length;r++){var i=n[r];this.matchTNodeWithReadOption(e,t,ET(t,i)),this.matchTNodeWithReadOption(e,t,B_(t,e,i,!1,!1))}else n===BO?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,B_(t,e,n,!1,!1))}},{key:"matchTNodeWithReadOption",value:function(e,t,n){if(null!==n){var r=this.metadata.read;if(null!==r)if(r===uO||r===WO||r===BO&&4&t.type)this.addMatch(t.index,-2);else{var i=B_(t,e,r,!1,!1);null!==i&&this.addMatch(t.index,i)}else this.addMatch(t.index,n)}}},{key:"addMatch",value:function(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}]),e}();function ET(e,t){var n=e.localNames;if(null!==n)for(var r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function ST(e,t,n,r){return-1===n?function(e,t){return 11&e.type?oO(e,t):4&e.type?zO(e,t):null}(t,e):-2===n?function(e,t,n){return n===uO?oO(t,e):n===BO?zO(t,e):n===WO?YO(t,e):void 0}(e,t,r):V_(e,e[1],n,t)}function PT(e,t,n,r){var i=t[19].queries[r];if(null===i.matches){for(var a=e.data,o=n.matches,s=[],u=0;u<o.length;u+=2){var c=o[u];s.push(c<0?null:ST(t,a[c],o[u+1],n.metadata.read))}i.matches=s}return i.matches}function OT(e,t,n,r){var i=e.queries.getByIndex(n),a=i.matches;if(null!==a)for(var o=PT(e,t,i,n),s=0;s<a.length;s+=2){var u=a[s];if(u>0)r.push(o[s/2]);else{for(var c=a[s+1],l=t[-u],h=10;h<l.length;h++){var f=l[h];f[17]===f[3]&&OT(f[1],f,c,r)}if(null!==l[9])for(var d=l[9],v=0;v<d.length;v++){var p=d[v];OT(p[1],p,c,r)}}}return r}function TT(e){var t=Rk(),n=Mk(),r=Kk();Qk(r+1);var i=xT(n,r);if(e.dirty&&Sk(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{var a=i.crossesNgTemplate?OT(n,t,r,[]):PT(n,t,i,r);e.reset(a,cO),e.notifyOnChanges()}return!0}return!1}function IT(e,t,n){var r=Mk();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new wT),e.queries.track(new bT(t,-1))}(r,new CT(e,t,n)),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){var r=new mT(4==(4&n));Fb(e,t,r,r.destroy),null===t[19]&&(t[19]=new _T),t[19].queries.push(new kT(r))}(r,Rk(),t)}function AT(){return e=Rk(),t=Kk(),e[19].queries[t].queryList;var e,t}function xT(e,t){return e.queries.getByIndex(t)}function RT(e,t){return zO(e,t)}var MT=new Y_("Application Initializer"),NT=function(){var e=function(){function e(t){var n=this;Wg(this,e),this.appInits=t,this.resolve=aO,this.reject=aO,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(e,t){n.resolve=e,n.reject=t})}return jg(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=function(n){var r=e.appInits[n]();if(oS(r))t.push(r);else if(sS(r)){var i=new Promise(function(e,t){r.subscribe({complete:e,error:t})});t.push(i)}},i=0;i<this.appInits.length;i++)r(i);Promise.all(t).then(function(){n()}).catch(function(t){e.reject(t)}),0===t.length&&n(),this.initialized=!0}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(MT,8))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),DT=new Y_("AppId"),LT={provide:DT,useFactory:function(){return"".concat(FT()).concat(FT()).concat(FT())},deps:[]};function FT(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var UT=new Y_("Platform Initializer"),BT=new Y_("Platform ID"),VT=new Y_("appBootstrapListener"),zT=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),HT=new Y_("LocaleId"),GT=new Y_("DefaultCurrencyCode"),$T=jg(function e(t,n){Wg(this,e),this.ngModuleFactory=t,this.componentFactories=n}),WT=function(e){return new iT(e)},qT=WT,jT=function(e){return Promise.resolve(WT(e))},ZT=function(e){var t=WT(e),n=kw(Xm(e).declarations).reduce(function(e,t){var n=Qm(t);return n&&e.push(new eT(n)),e},[]);return new $T(t,n)},YT=ZT,KT=function(e){return Promise.resolve(ZT(e))},QT=function(){var e=function(){function e(){Wg(this,e),this.compileModuleSync=qT,this.compileModuleAsync=jT,this.compileModuleAndAllComponentsSync=YT,this.compileModuleAndAllComponentsAsync=KT}return jg(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),XT=Promise.resolve(0);function JT(e){"undefined"==typeof Zone?XT.then(function(){e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var eI=function(){function e(t){var n=t.enableLongStackTrace,r=void 0!==n&&n,i=t.shouldCoalesceEventChangeDetection,a=void 0!==i&&i,o=t.shouldCoalesceRunChangeDetection,s=void 0!==o&&o;if(Wg(this,e),this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new gT(!1),this.onMicrotaskEmpty=new gT(!1),this.onStable=new gT(!1),this.onError=new gT(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();var u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!s&&a,u.shouldCoalesceRunChangeDetection=s,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function(){var e=Rm.requestAnimationFrame,t=Rm.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){var n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);var r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){var t=function(){!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Rm,function(){e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",function(){e.lastRequestAnimationFrameId=-1,rI(e),e.isCheckStableRunning=!0,nI(e),e.isCheckStableRunning=!1},void 0,function(){},function(){})),e.fakeTopEventTask.invoke()}),rI(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(n,r,i,a,o,s){try{return iI(e),n.invokeTask(i,a,o,s)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===a.type||e.shouldCoalesceRunChangeDetection)&&t(),aI(e)}},onInvoke:function(n,r,i,a,o,s,u){try{return iI(e),n.invoke(i,a,o,s,u)}finally{e.shouldCoalesceRunChangeDetection&&t(),aI(e)}},onHasTask:function(t,n,r,i){t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,rI(e),nI(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:function(t,n,r,i){return t.handleError(r,i),e.runOutsideAngular(function(){return e.onError.emit(i)}),!1}})}(u)}return jg(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+r,e,tI,aO,aO);try{return i.runTask(a,t,n)}finally{i.cancelTask(a)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}(),tI={};function nI(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(function(){return e.onStable.emit(null)})}finally{e.isStable=!0}}}function rI(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function iI(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function aI(e){e._nesting--,nI(e)}var oI,sI=function(){function e(){Wg(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new gT,this.onMicrotaskEmpty=new gT,this.onStable=new gT,this.onError=new gT}return jg(e,[{key:"run",value:function(e,t,n){return e.apply(t,n)}},{key:"runGuarded",value:function(e,t,n){return e.apply(t,n)}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e,t,n,r){return e.apply(t,n)}}]),e}(),uI=function(){var e=function(){function e(t){var n=this;Wg(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return jg(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){e._ngZone.onStable.subscribe({next:function(){eI.assertNotInAngularZone(),JT(function(){e._isZoneStable=!0,e._runCallbacksIfReady()})}})})}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())JT(function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1});else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)}),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}}):[]}},{key:"addCallback",value:function(e,t,n){var r=this,i=-1;t&&t>0&&(i=setTimeout(function(){r._callbacks=r._callbacks.filter(function(e){return e.timeoutId!==i}),e(r._didWork,r.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(eI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),cI=function(){var e=function(){function e(){Wg(this,e),this._applications=new Map,lI.addToWindow(this)}return jg(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return lI.findTestabilityInTree(this,e,t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),lI=new(function(){function e(){Wg(this,e)}return jg(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),hI=!0,fI=!1,dI=new Y_("AllowMultipleToken"),vI=jg(function e(t,n){Wg(this,e),this.name=t,this.token=n});function pI(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: ".concat(t),i=new Y_(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=gI();if(!a||a.injector.get(dI,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{var o=n.concat(t).concat({provide:i,useValue:!0},{provide:yE,useValue:"platform"});!function(e){if(oI&&!oI.destroyed&&!oI.injector.get(dI,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");oI=e.get(yI);var t=e.get(UT,null);t&&t.forEach(function(e){return e()})}(IE.create({providers:o,name:r}))}return function(e){var t=gI();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function gI(){return oI&&!oI.destroyed?oI:null}var yI=function(){var e=function(){function e(t){Wg(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return jg(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n=this,r=function(e,t){return"noop"===e?new sI:("zone.js"===e?void 0:e)||new eI({enableLongStackTrace:(fI=!0,hI),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)})}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),i=[{provide:eI,useValue:r}];return r.run(function(){var a=IE.create({providers:i,parent:n.injector,name:e.moduleType.name}),o=e.create(a),s=o.injector.get(pw,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return r.runOutsideAngular(function(){var e=r.onError.subscribe({next:function(e){s.handleError(e)}});o.onDestroy(function(){_I(n._modules,o),e.unsubscribe()})}),function(e,r,i){try{var a=((s=o.injector.get(NT)).runInitializers(),s.donePromise.then(function(){return nP(o.injector.get(HT,QS)||QS),n._moduleDoBootstrap(o),o}));return oS(a)?a.catch(function(t){throw r.runOutsideAngular(function(){return e.handleError(t)}),t}):a}catch(t){throw r.runOutsideAngular(function(){return e.handleError(t)}),t}var s}(s,r)})}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=mI({},n);return function(e,t,n){var r=new iT(n);return Promise.resolve(r)}(0,0,e).then(function(e){return t.bootstrapModuleFactory(e,r)})}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(kI);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(function(e){return t.bootstrap(e)});else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(nm(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"injector",get:function(){return this._injector}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(e){return e.destroy()}),this._destroyListeners.forEach(function(e){return e()}),this._destroyed=!0}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(IE))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function mI(e,t){return Array.isArray(t)?t.reduce(mI,e):Object.assign(Object.assign({},e),t)}var kI=function(){var e=function(){function e(t,n,r,i,a){var o=this;Wg(this,e),this._zone=t,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:function(){o._zone.run(function(){o.tick()})}});var s=new yy(function(e){o._stable=o._zone.isStable&&!o._zone.hasPendingMacrotasks&&!o._zone.hasPendingMicrotasks,o._zone.runOutsideAngular(function(){e.next(o._stable),e.complete()})}),u=new yy(function(e){var t;o._zone.runOutsideAngular(function(){t=o._zone.onStable.subscribe(function(){eI.assertNotInAngularZone(),JT(function(){!o._stable&&!o._zone.hasPendingMacrotasks&&!o._zone.hasPendingMicrotasks&&(o._stable=!0,e.next(!0))})})});var n=o._zone.onUnstable.subscribe(function(){eI.assertInAngularZone(),o._stable&&(o._stable=!1,o._zone.runOutsideAngular(function(){e.next(!1)}))});return function(){t.unsubscribe(),n.unsubscribe()}});this.isStable=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jy(t),i=function(e,t){return"number"==typeof Wy(e)?e.pop():1/0}(t),a=t;return a.length?1===a.length?By(a[0]):Gy(i)(Qy(a,r)):$y}(s,u.pipe(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.connector,n=void 0===t?function(){return new _y}:t,r=e.resetOnError,i=void 0===r||r,a=e.resetOnComplete,o=void 0===a||a,s=e.resetOnRefCountZero,u=void 0===s||s;return function(e){var t=null,r=null,a=null,s=0,c=!1,l=!1,h=function(){null==r||r.unsubscribe(),r=null},f=function(){h(),t=a=null,c=l=!1},d=function(){var e=t;f(),null==e||e.unsubscribe()};return by(function(e,v){var p;s++,!l&&!c&&h();var g=a=null!==(p=a)&&void 0!==p?p:n();v.add(function(){0===--s&&!l&&!c&&(r=Jy(d,u))}),g.subscribe(v),t||(t=new ly({next:function(e){return g.next(e)},error:function(e){l=!0,h(),r=Jy(f,i,e),g.error(e)},complete:function(){c=!0,h(),r=Jy(f,o),g.complete()}}),Qy(e).subscribe(t))})(e)}}()))}return jg(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof nO?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var i=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(HO),a=n.create(IE.NULL,[],t||n.selector,i),o=a.location.nativeElement,s=a.injector.get(uI,null),u=s&&a.injector.get(cI);return s&&u&&u.registerApplication(o,s),a.onDestroy(function(){r.detachView(a.hostView),_I(r.components,a),u&&u.unregisterApplication(o)}),this._loadComponent(a),a}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;var t,n=Hg(this._views);try{for(n.s();!(t=n.n()).done;){var r;t.value.detectChanges()}}catch(i){n.e(i)}finally{n.f()}}catch(r){this._zone.runOutsideAngular(function(){return e._exceptionHandler.handleError(r)})}finally{this._runningTick=!1}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;_I(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(VT,[]).concat(this._bootstrapListeners).forEach(function(t){return t(e)})}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach(function(e){return e.destroy()}),this._onMicrotaskEmptySubscription.unsubscribe()}},{key:"viewCount",get:function(){return this._views.length}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(eI),pC(IE),pC(pw),pC(iO),pC(NT))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function _I(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var CI=jg(function e(){Wg(this,e)}),wI=jg(function e(){Wg(this,e)}),bI={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},EI=function(){var e=function(){function e(t,n){Wg(this,e),this._compiler=t,this._config=n||bI}return jg(e,[{key:"load",value:function(e){return this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,n=Pg(e.split("#"),2),r=n[0],i=n[1];return void 0===i&&(i="default"),Tg(8255)(r).then(function(e){return e[i]}).then(function(e){return SI(e,r,i)}).then(function(e){return t._compiler.compileModuleAsync(e)})}},{key:"loadFactory",value:function(e){var t=Pg(e.split("#"),2),n=t[0],r=t[1],i="NgFactory";return void 0===r&&(r="default",i=""),Tg(8255)(this._config.factoryPathPrefix+n+this._config.factoryPathSuffix).then(function(e){return e[r+i]}).then(function(e){return SI(e,n,r)})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(QT),pC(wI,8))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function SI(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var PI=pI(null,"core",[{provide:BT,useValue:"unknown"},{provide:yI,deps:[IE]},{provide:cI,deps:[]},{provide:zT,deps:[]}]),OI=[{provide:kI,useClass:kI,deps:[eI,IE,pw,iO,NT]},{provide:JO,deps:[eI],useFactory:function(e){var t=[];return e.onStable.subscribe(function(){for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:NT,useClass:NT,deps:[[new bC,MT]]},{provide:QT,useClass:QT,deps:[]},LT,{provide:OO,useFactory:function(){return LO},deps:[]},{provide:IO,useFactory:function(){return FO},deps:[]},{provide:HT,useFactory:function(e){return nP(e=e||"undefined"!=typeof $localize&&$localize.locale||QS),e},deps:[[new wC(HT),new bC,new EC]]},{provide:GT,useValue:"USD"}],TI=function(){var e=jg(function e(t){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)(pC(kI))},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:OI}),e}(),II=null;function AI(){return II}var xI=new Y_("DocumentToken"),RI=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"historyGo",value:function(e){throw new Error("Not implemented")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({factory:MI,token:e,providedIn:"platform"}),e}();function MI(){return pC(DI)}var NI=new Y_("Location Initialized"),DI=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this))._doc=e,r._init(),r}return jg(n,[{key:"_init",value:function(){this.location=window.location,this._history=window.history}},{key:"getBaseHrefFromDOM",value:function(){return AI().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){var t=AI().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),function(){return t.removeEventListener("popstate",e)}}},{key:"onHashChange",value:function(e){var t=AI().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),function(){return t.removeEventListener("hashchange",e)}}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}},{key:"pushState",value:function(e,t,n){LI()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){LI()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"historyGo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._history.go(e)}},{key:"getState",value:function(){return this._history.state}}]),n}(RI);return e.\u0275fac=function(t){return new(t||e)(pC(xI))},e.\u0275prov=dm({factory:FI,token:e,providedIn:"platform"}),e}();function LI(){return!!window.history.pushState}function FI(){return new DI(pC(xI))}function UI(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function BI(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function VI(e){return e&&"?"!==e[0]?"?"+e:e}var zI=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"historyGo",value:function(e){throw new Error("Not implemented")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({factory:HI,token:e,providedIn:"root"}),e}();function HI(e){var t=pC(xI).location;return new $I(pC(RI),t&&t.origin||"")}var GI=new Y_("appBaseHref"),$I=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;if(Wg(this,n),(i=t.call(this))._platformLocation=e,i._removeListenerFns=[],null==r&&(r=i._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return i._baseHref=r,Lg(i)}return jg(n,[{key:"ngOnDestroy",value:function(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}},{key:"onPopState",value:function(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return UI(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+VI(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+VI(r));this._platformLocation.pushState(e,t,i)}},{key:"replaceState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+VI(r));this._platformLocation.replaceState(e,t,i)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformLocation).historyGo)||void 0===t||t.call(e,n)}}]),n}(zI);return e.\u0275fac=function(t){return new(t||e)(pC(RI),pC(GI,8))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),WI=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this))._platformLocation=e,i._baseHref="",i._removeListenerFns=[],null!=r&&(i._baseHref=r),i}return jg(n,[{key:"ngOnDestroy",value:function(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}},{key:"onPopState",value:function(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=UI(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+VI(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}},{key:"replaceState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+VI(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformLocation).historyGo)||void 0===t||t.call(e,n)}}]),n}(zI);return e.\u0275fac=function(t){return new(t||e)(pC(RI),pC(GI,8))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),qI=function(){var e=function(){function e(t,n){var r=this;Wg(this,e),this._subject=new gT,this._urlChangeListeners=[],this._platformStrategy=t;var i=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=BI(ZI(i)),this._platformStrategy.onPopState(function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})})}return jg(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(e+VI(t))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,ZI(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+VI(t)),n)}},{key:"replaceState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+VI(t)),n)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"historyGo",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null===(t=(e=this._platformStrategy).historyGo)||void 0===t||t.call(e,n)}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach(function(n){return n(e,t)})}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(zI),pC(RI))},e.normalizeQueryParams=VI,e.joinWithSlash=UI,e.stripTrailingSlash=BI,e.\u0275prov=dm({factory:jI,token:e,providedIn:"root"}),e}();function jI(){return new qI(pC(zI),pC(RI))}function ZI(e){return e.replace(/\/index.html$/,"")}var YI=((YI=YI||{})[YI.Decimal=0]="Decimal",YI[YI.Percent=1]="Percent",YI[YI.Currency=2]="Currency",YI[YI.Scientific=3]="Scientific",YI),KI=((KI=KI||{})[KI.Zero=0]="Zero",KI[KI.One=1]="One",KI[KI.Two=2]="Two",KI[KI.Few=3]="Few",KI[KI.Many=4]="Many",KI[KI.Other=5]="Other",KI),QI=((QI=QI||{})[QI.Format=0]="Format",QI[QI.Standalone=1]="Standalone",QI),XI=((XI=XI||{})[XI.Narrow=0]="Narrow",XI[XI.Abbreviated=1]="Abbreviated",XI[XI.Wide=2]="Wide",XI[XI.Short=3]="Short",XI),JI=((JI=JI||{})[JI.Short=0]="Short",JI[JI.Medium=1]="Medium",JI[JI.Long=2]="Long",JI[JI.Full=3]="Full",JI),eA=((eA=eA||{})[eA.Decimal=0]="Decimal",eA[eA.Group=1]="Group",eA[eA.List=2]="List",eA[eA.PercentSign=3]="PercentSign",eA[eA.PlusSign=4]="PlusSign",eA[eA.MinusSign=5]="MinusSign",eA[eA.Exponential=6]="Exponential",eA[eA.SuperscriptingExponent=7]="SuperscriptingExponent",eA[eA.PerMille=8]="PerMille",eA[eA.Infinity=9]="Infinity",eA[eA.NaN=10]="NaN",eA[eA.TimeSeparator=11]="TimeSeparator",eA[eA.CurrencyDecimal=12]="CurrencyDecimal",eA[eA.CurrencyGroup=13]="CurrencyGroup",eA);function tA(e,t){return sA(qS(e)[YS.DateFormat],t)}function nA(e,t){return sA(qS(e)[YS.TimeFormat],t)}function rA(e,t){return sA(qS(e)[YS.DateTimeFormat],t)}function iA(e,t){var n=qS(e),r=n[YS.NumberSymbols][t];if(void 0===r){if(t===eA.CurrencyDecimal)return n[YS.NumberSymbols][eA.Decimal];if(t===eA.CurrencyGroup)return n[YS.NumberSymbols][eA.Group]}return r}var aA=jS;function oA(e){if(!e[YS.ExtraData])throw new Error('Missing extra locale data for the locale "'.concat(e[YS.LocaleId],'". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.'))}function sA(e,t){for(var n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function uA(e){var t=Pg(e.split(":"),2);return{hours:+t[0],minutes:+t[1]}}var cA=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,lA={},hA=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,fA=((fA=fA||{})[fA.Short=0]="Short",fA[fA.ShortGMT=1]="ShortGMT",fA[fA.Long=2]="Long",fA[fA.Extended=3]="Extended",fA),dA=((dA=dA||{})[dA.FullYear=0]="FullYear",dA[dA.Month=1]="Month",dA[dA.Date=2]="Date",dA[dA.Hours=3]="Hours",dA[dA.Minutes=4]="Minutes",dA[dA.Seconds=5]="Seconds",dA[dA.FractionalSeconds=6]="FractionalSeconds",dA[dA.Day=7]="Day",dA),vA=((vA=vA||{})[vA.DayPeriods=0]="DayPeriods",vA[vA.Days=1]="Days",vA[vA.Months=2]="Months",vA[vA.Eras=3]="Eras",vA);function pA(e,t,n,r){var i=function(e){if(TA(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){var t=Pg(e.split("-").map(function(e){return+e}),3),n=t[0],r=t[1],i=void 0===r?1:r,a=t[2];return gA(n,i-1,void 0===a?1:a)}var o,s=parseFloat(e);if(!isNaN(e-s))return new Date(s);if(o=e.match(cA))return function(e){var t=new Date(0),n=0,r=0,i=e[8]?t.setUTCFullYear:t.setFullYear,a=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));var o=Number(e[4]||0)-n,s=Number(e[5]||0)-r,u=Number(e[6]||0),c=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return a.call(t,o,s,u,c),t}(o)}var u=new Date(e);if(!TA(u))throw new Error('Unable to convert "'.concat(e,'" into a date'));return u}(e);t=yA(n,t)||t;for(var a,o=[];t;){if(!(a=hA.exec(t))){o.push(t);break}var s=(o=o.concat(a.slice(1))).pop();if(!s)break;t=s}var u=i.getTimezoneOffset();r&&(u=OA(r,u),i=function(e,t,n){var r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(OA(t,r)-r))}(i,r));var c="";return o.forEach(function(e){var t=function(e){if(PA[e])return PA[e];var t;switch(e){case"G":case"GG":case"GGG":t=CA(vA.Eras,XI.Abbreviated);break;case"GGGG":t=CA(vA.Eras,XI.Wide);break;case"GGGGG":t=CA(vA.Eras,XI.Narrow);break;case"y":t=_A(dA.FullYear,1,0,!1,!0);break;case"yy":t=_A(dA.FullYear,2,0,!0,!0);break;case"yyy":t=_A(dA.FullYear,3,0,!1,!0);break;case"yyyy":t=_A(dA.FullYear,4,0,!1,!0);break;case"Y":t=SA(1);break;case"YY":t=SA(2,!0);break;case"YYY":t=SA(3);break;case"YYYY":t=SA(4);break;case"M":case"L":t=_A(dA.Month,1,1);break;case"MM":case"LL":t=_A(dA.Month,2,1);break;case"MMM":t=CA(vA.Months,XI.Abbreviated);break;case"MMMM":t=CA(vA.Months,XI.Wide);break;case"MMMMM":t=CA(vA.Months,XI.Narrow);break;case"LLL":t=CA(vA.Months,XI.Abbreviated,QI.Standalone);break;case"LLLL":t=CA(vA.Months,XI.Wide,QI.Standalone);break;case"LLLLL":t=CA(vA.Months,XI.Narrow,QI.Standalone);break;case"w":t=EA(1);break;case"ww":t=EA(2);break;case"W":t=EA(1,!0);break;case"d":t=_A(dA.Date,1);break;case"dd":t=_A(dA.Date,2);break;case"c":case"cc":t=_A(dA.Day,1);break;case"ccc":t=CA(vA.Days,XI.Abbreviated,QI.Standalone);break;case"cccc":t=CA(vA.Days,XI.Wide,QI.Standalone);break;case"ccccc":t=CA(vA.Days,XI.Narrow,QI.Standalone);break;case"cccccc":t=CA(vA.Days,XI.Short,QI.Standalone);break;case"E":case"EE":case"EEE":t=CA(vA.Days,XI.Abbreviated);break;case"EEEE":t=CA(vA.Days,XI.Wide);break;case"EEEEE":t=CA(vA.Days,XI.Narrow);break;case"EEEEEE":t=CA(vA.Days,XI.Short);break;case"a":case"aa":case"aaa":t=CA(vA.DayPeriods,XI.Abbreviated);break;case"aaaa":t=CA(vA.DayPeriods,XI.Wide);break;case"aaaaa":t=CA(vA.DayPeriods,XI.Narrow);break;case"b":case"bb":case"bbb":t=CA(vA.DayPeriods,XI.Abbreviated,QI.Standalone,!0);break;case"bbbb":t=CA(vA.DayPeriods,XI.Wide,QI.Standalone,!0);break;case"bbbbb":t=CA(vA.DayPeriods,XI.Narrow,QI.Standalone,!0);break;case"B":case"BB":case"BBB":t=CA(vA.DayPeriods,XI.Abbreviated,QI.Format,!0);break;case"BBBB":t=CA(vA.DayPeriods,XI.Wide,QI.Format,!0);break;case"BBBBB":t=CA(vA.DayPeriods,XI.Narrow,QI.Format,!0);break;case"h":t=_A(dA.Hours,1,-12);break;case"hh":t=_A(dA.Hours,2,-12);break;case"H":t=_A(dA.Hours,1);break;case"HH":t=_A(dA.Hours,2);break;case"m":t=_A(dA.Minutes,1);break;case"mm":t=_A(dA.Minutes,2);break;case"s":t=_A(dA.Seconds,1);break;case"ss":t=_A(dA.Seconds,2);break;case"S":t=_A(dA.FractionalSeconds,1);break;case"SS":t=_A(dA.FractionalSeconds,2);break;case"SSS":t=_A(dA.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=wA(fA.Short);break;case"ZZZZZ":t=wA(fA.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=wA(fA.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=wA(fA.Long);break;default:return null}return PA[e]=t,t}(e);c+=t?t(i,n,u):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function gA(e,t,n){var r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function yA(e,t){var n=function(e){return qS(e)[YS.LocaleId]}(e);if(lA[n]=lA[n]||{},lA[n][t])return lA[n][t];var r="";switch(t){case"shortDate":r=tA(e,JI.Short);break;case"mediumDate":r=tA(e,JI.Medium);break;case"longDate":r=tA(e,JI.Long);break;case"fullDate":r=tA(e,JI.Full);break;case"shortTime":r=nA(e,JI.Short);break;case"mediumTime":r=nA(e,JI.Medium);break;case"longTime":r=nA(e,JI.Long);break;case"fullTime":r=nA(e,JI.Full);break;case"short":var i=yA(e,"shortTime"),a=yA(e,"shortDate");r=mA(rA(e,JI.Short),[i,a]);break;case"medium":var o=yA(e,"mediumTime"),s=yA(e,"mediumDate");r=mA(rA(e,JI.Medium),[o,s]);break;case"long":var u=yA(e,"longTime"),c=yA(e,"longDate");r=mA(rA(e,JI.Long),[u,c]);break;case"full":var l=yA(e,"fullTime"),h=yA(e,"fullDate");r=mA(rA(e,JI.Full),[l,h])}return r&&(lA[n][t]=r),r}function mA(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function kA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,a=n));for(var o=String(e);o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),a+o}function _A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return function(a,o){var s=function(e,t){switch(e){case dA.FullYear:return t.getFullYear();case dA.Month:return t.getMonth();case dA.Date:return t.getDate();case dA.Hours:return t.getHours();case dA.Minutes:return t.getMinutes();case dA.Seconds:return t.getSeconds();case dA.FractionalSeconds:return t.getMilliseconds();case dA.Day:return t.getDay();default:throw new Error('Unknown DateType value "'.concat(e,'".'))}}(e,a);if((n>0||s>-n)&&(s+=n),e===dA.Hours)0===s&&-12===n&&(s=12);else if(e===dA.FractionalSeconds)return function(e,t){return kA(e,3).substr(0,t)}(s,t);var u=iA(o,eA.MinusSign);return kA(s,t,u,r,i)}}function CA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:QI.Format,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(i,a){return function(e,t,n,r,i,a){switch(n){case vA.Months:return function(e,t,n){var r=qS(e),i=sA([r[YS.MonthsFormat],r[YS.MonthsStandalone]],t);return sA(i,n)}(t,i,r)[e.getMonth()];case vA.Days:return function(e,t,n){var r=qS(e),i=sA([r[YS.DaysFormat],r[YS.DaysStandalone]],t);return sA(i,n)}(t,i,r)[e.getDay()];case vA.DayPeriods:var o=e.getHours(),s=e.getMinutes();if(a){var u=function(e){var t=qS(e);return oA(t),(t[YS.ExtraData][2]||[]).map(function(e){return"string"==typeof e?uA(e):[uA(e[0]),uA(e[1])]})}(t),c=function(e,t,n){var r=qS(e);oA(r);var i=sA([r[YS.ExtraData][0],r[YS.ExtraData][1]],t)||[];return sA(i,n)||[]}(t,i,r),l=u.findIndex(function(e){if(Array.isArray(e)){var t=Pg(e,2),n=t[0],r=t[1],i=o>=n.hours&&s>=n.minutes,a=o<r.hours||o===r.hours&&s<r.minutes;if(n.hours<r.hours){if(i&&a)return!0}else if(i||a)return!0}else if(e.hours===o&&e.minutes===s)return!0;return!1});if(-1!==l)return c[l]}return function(e,t,n){var r=qS(e),i=sA([r[YS.DayPeriodsFormat],r[YS.DayPeriodsStandalone]],t);return sA(i,n)}(t,i,r)[o<12?0:1];case vA.Eras:return function(e,t){return sA(qS(e)[YS.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error("unexpected translation type ".concat(n))}}(i,a,e,t,n,r)}}function wA(e){return function(t,n,r){var i=-1*r,a=iA(n,eA.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case fA.Short:return(i>=0?"+":"")+kA(o,2,a)+kA(Math.abs(i%60),2,a);case fA.ShortGMT:return"GMT"+(i>=0?"+":"")+kA(o,1,a);case fA.Long:return"GMT"+(i>=0?"+":"")+kA(o,2,a)+":"+kA(Math.abs(i%60),2,a);case fA.Extended:return 0===r?"Z":(i>=0?"+":"")+kA(o,2,a)+":"+kA(Math.abs(i%60),2,a);default:throw new Error('Unknown zone width "'.concat(e,'"'))}}}function bA(e){return gA(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function EA(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,r){var i;if(t){var a=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,o=n.getDate();i=1+Math.floor((o+a)/7)}else{var s=bA(n),u=function(e){var t=gA(e,0,1).getDay();return gA(e,0,1+(t<=4?4:11)-t)}(s.getFullYear()),c=s.getTime()-u.getTime();i=1+Math.round(c/6048e5)}return kA(i,e,iA(r,eA.MinusSign))}}function SA(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,r){return kA(bA(n).getFullYear(),e,iA(r,eA.MinusSign),t)}}var PA={};function OA(e,t){e=e.replace(/:/g,"");var n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function TA(e){return e instanceof Date&&!isNaN(e.valueOf())}var IA=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function AA(e){var t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}var xA=jg(function e(){Wg(this,e)}),RA=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).locale=e,r}return jg(n,[{key:"getPluralCategory",value:function(e,t){switch(aA(t||this.locale)(e)){case KI.Zero:return"zero";case KI.One:return"one";case KI.Two:return"two";case KI.Few:return"few";case KI.Many:return"many";default:return"other"}}}]),n}(xA);return e.\u0275fac=function(t){return new(t||e)(pC(HT))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function MA(e,t){t=encodeURIComponent(t);var n,r=Hg(e.split(";"));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.indexOf("="),o=Pg(-1==a?[i,""]:[i.slice(0,a),i.slice(a+1)],2),s=o[0],u=o[1];if(s.trim()===t)return decodeURIComponent(u)}}catch(c){r.e(c)}finally{r.f()}return null}var NA=function(){var e=function(){function e(t,n,r,i){Wg(this,e),this._iterableDiffers=t,this._keyValueDiffers=n,this._ngEl=r,this._renderer=i,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}return jg(e,[{key:"klass",set:function(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}},{key:"ngClass",set:function(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(BE(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}},{key:"ngDoCheck",value:function(){if(this._iterableDiffer){var e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){var t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}},{key:"_applyKeyValueChanges",value:function(e){var t=this;e.forEachAddedItem(function(e){return t._toggleClass(e.key,e.currentValue)}),e.forEachChangedItem(function(e){return t._toggleClass(e.key,e.currentValue)}),e.forEachRemovedItem(function(e){e.previousValue&&t._toggleClass(e.key,!1)})}},{key:"_applyIterableChanges",value:function(e){var t=this;e.forEachAddedItem(function(e){if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got ".concat(nm(e.item)));t._toggleClass(e.item,!0)}),e.forEachRemovedItem(function(e){return t._toggleClass(e.item,!1)})}},{key:"_applyClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach(function(e){return t._toggleClass(e,!0)}):Object.keys(e).forEach(function(n){return t._toggleClass(n,!!e[n])}))}},{key:"_removeClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach(function(e){return t._toggleClass(e,!1)}):Object.keys(e).forEach(function(e){return t._toggleClass(e,!1)}))}},{key:"_toggleClass",value:function(e,t){var n=this;(e=e.trim())&&e.split(/\s+/g).forEach(function(e){t?n._renderer.addClass(n._ngEl.nativeElement,e):n._renderer.removeClass(n._ngEl.nativeElement,e)})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(OO),QE(IO),QE(uO),QE(hO))},e.\u0275dir=Ym({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e}(),DA=function(){function e(t,n,r,i){Wg(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=i}return jg(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),LA=function(){var e=function(){function e(t,n,r){Wg(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}return jg(e,[{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",get:function(){return this._trackByFn},set:function(e){this._trackByFn=e}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}},{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(n){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat(function(e){return e.name||typeof e}(e),"'. NgFor only supports binding to Iterables such as Arrays."))}}if(this._differ){var t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation(function(e,r,i){if(null==e.previousIndex){var a=t._viewContainer.createEmbeddedView(t._template,new DA(null,t._ngForOf,-1,-1),null===i?void 0:i),o=new FA(e,a);n.push(o)}else if(null==i)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,i);var u=new FA(e,s);n.push(u)}});for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var i=0,a=this._viewContainer.length;i<a;i++){var o=this._viewContainer.get(i);o.context.index=i,o.context.count=a,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange(function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item})}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(WO),QE(BO),QE(OO))},e.\u0275dir=Ym({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e}(),FA=jg(function e(t,n){Wg(this,e),this.record=t,this.view=n}),UA=function(){var e=function(){function e(t,n){Wg(this,e),this._viewContainer=t,this._context=new BA,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return jg(e,[{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){VA("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){VA("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}},{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(WO),QE(BO))},e.\u0275dir=Ym({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e}(),BA=jg(function e(){Wg(this,e),this.$implicit=null,this.ngIf=null});function VA(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(nm(t),"'."))}var zA=function(){var e=function(){function e(t){Wg(this,e),this._locale=t}return jg(e,[{key:"transform",value:function(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s="",u=!1;if(isFinite(e)){var c=function(e){var t,n,r,i,a,o=Math.abs(e)+"",s=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(a=o.length))t=[0],n=1;else{for(a--;"0"===o.charAt(a);)a--;for(n-=r,t=[],i=0;r<=a;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),s=n-1,n=1),{digits:t,exponent:s,integerLen:n}}(e);o&&(c=function(e){if(0===e.digits[0])return e;var t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(c));var l=t.minInt,h=t.minFrac,f=t.maxFrac;if(a){var d=a.match(IA);if(null===d)throw new Error("".concat(a," is not a valid digit info"));var v=d[1],p=d[3],g=d[5];null!=v&&(l=AA(v)),null!=p&&(h=AA(p)),null!=g?f=AA(g):null!=p&&h>f&&(f=h)}!function(e,t,n){if(t>n)throw new Error("The minimum number of digits after fraction (".concat(t,") is higher than the maximum (").concat(n,")."));var r=e.digits,i=r.length-e.integerLen,a=Math.min(Math.max(t,i),n),o=a+e.integerLen,s=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(var u=o;u<r.length;u++)r[u]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=a+1),r[0]=0;for(var c=1;c<o;c++)r[c]=0}if(s>=5)if(o-1<0){for(var l=0;l>o;l--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,a);i++)r.push(0);var h=0!==a,f=t+e.integerLen,d=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,h&&(0===r[n]&&n>=f?r.pop():h=!1),t>=10?1:0},0);d&&(r.unshift(d),e.integerLen++)}(c,h,f);var y=c.digits,m=c.integerLen,k=c.exponent,_=[];for(u=y.every(function(e){return!e});m<l;m++)y.unshift(0);for(;m<0;m++)y.unshift(0);m>0?_=y.splice(m,y.length):(_=y,y=[0]);var C=[];for(y.length>=t.lgSize&&C.unshift(y.splice(-t.lgSize,y.length).join(""));y.length>t.gSize;)C.unshift(y.splice(-t.gSize,y.length).join(""));y.length&&C.unshift(y.join("")),s=C.join(iA(n,r)),_.length&&(s+=iA(n,i)+_.join("")),k&&(s+=iA(n,eA.Exponential)+"+"+k)}else s=iA(n,eA.Infinity);return s=e<0&&!u?t.negPre+s+t.negSuf:t.posPre+s+t.posSuf}(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],a=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],s=o[0],u=o[1]||"";n.posPre=s.substr(0,s.indexOf("#"));for(var c=0;c<u.length;c++){var l=u.charAt(c);"0"===l?n.minFrac=n.maxFrac=c+1:"#"===l?n.maxFrac=c+1:n.posSuf+=l}var h=s.split(",");if(n.gSize=h[1]?h[1].length:0,n.lgSize=h[2]||h[1]?(h[2]||h[1]).length:0,a){var f=i.length-n.posPre.length-n.posSuf.length,d=a.indexOf("#");n.negPre=a.substr(0,d).replace(/'/g,""),n.negSuf=a.substr(d+f).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return qS(e)[YS.NumberFormats][t]}(t,YI.Decimal),iA(t,eA.MinusSign)),t,eA.Group,eA.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error("".concat(e," is not a number"));return e}(t),r,n)}catch(i){throw function(e,t){return Error("InvalidPipeArgument: '".concat(t,"' for pipe '").concat(nm(e),"'"))}(e,i.message)}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(HT,16))},e.\u0275pipe=Km({name:"number",type:e,pure:!0}),e}(),HA=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[{provide:xA,useClass:RA}]}),e}(),GA=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275prov=dm({token:e,providedIn:"root",factory:function(){return new $A(pC(xI),window)}}),e}(),$A=function(){function e(t,n){Wg(this,e),this.document=t,this.window=n,this.offset=function(){return[0,0]}}return jg(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportsScrolling()){var t=function(e,t){var n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow))for(var r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT),i=r.currentNode;i;){var a=i.shadowRoot;if(a){var o=a.getElementById(t)||a.querySelector('[name="'.concat(t,'"]'));if(o)return o}i=r.nextNode()}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}},{key:"attemptFocus",value:function(e){return e.focus(),this.document.activeElement===e}},{key:"supportScrollRestoration",value:function(){try{if(!this.supportsScrolling())return!1;var e=WA(this.window.history)||WA(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(t){return!1}}},{key:"supportsScrolling",value:function(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}]),e}();function WA(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}var qA,jA=jg(function e(){Wg(this,e)}),ZA=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"remove",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getBaseHref",value:function(e){var t=(YA=YA||document.querySelector("base"))?YA.getAttribute("href"):null;return null==t?null:function(e){(qA=qA||document.createElement("a")).setAttribute("href",e);var t=qA.pathname;return"/"===t.charAt(0)?t:"/".concat(t)}(t)}},{key:"resetBaseElement",value:function(){YA=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"getCookie",value:function(e){return MA(document.cookie,e)}}],[{key:"makeCurrent",value:function(){var e;e=new n,II||(II=e)}}]),n}(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).supportsDOMEvents=!0,e}return jg(n)}(function(){return jg(function e(){Wg(this,e)})}())),YA=null,KA=new Y_("TRANSITION_ID"),QA=[{provide:MT,useFactory:function(e,t,n){return function(){n.get(NT).donePromise.then(function(){for(var n=AI(),r=t.querySelectorAll('style[ng-transition="'.concat(e,'"]')),i=0;i<r.length;i++)n.remove(r[i])})}},deps:[KA,xI,IE],multi:!0}],XA=function(){function e(){Wg(this,e)}return jg(e,[{key:"addToWindow",value:function(e){Rm.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Rm.getAllAngularTestabilities=function(){return e.getAllTestabilities()},Rm.getAllAngularRootElements=function(){return e.getAllRootElements()},Rm.frameworkStabilizers||(Rm.frameworkStabilizers=[]),Rm.frameworkStabilizers.push(function(e){var t=Rm.getAllAngularTestabilities(),n=t.length,r=!1,i=function(t){r=r||t,0==--n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}},{key:"findTestabilityInTree",value:function(e,t,n){var r;return null==t?null:null!==(r=e.getTestability(t))&&void 0!==r?r:n?AI().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}],[{key:"init",value:function(){var t;t=new e,lI=t}}]),e}(),JA=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"build",value:function(){return new XMLHttpRequest}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),ex=new Y_("EventManagerPlugins"),tx=function(){var e=function(){function e(t,n){var r=this;Wg(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach(function(e){return e.manager=r}),this._plugins=t.slice().reverse()}return jg(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var i=n[r];if(i.supports(e))return this._eventNameToPlugin.set(e,i),i}throw new Error("No event manager plugin found for event ".concat(e))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(ex),pC(eI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),nx=function(){function e(t){Wg(this,e),this._doc=t}return jg(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=AI().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),rx=function(){var e=function(){function e(){Wg(this,e),this._stylesSet=new Set}return jg(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach(function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))}),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),ix=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Map,r._hostNodes.set(e.head,[]),r}return jg(n,[{key:"_addStylesToHost",value:function(e,t,n){var r=this;e.forEach(function(e){var i=r._doc.createElement("style");i.textContent=e,n.push(t.appendChild(i))})}},{key:"addHost",value:function(e){var t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}},{key:"removeHost",value:function(e){var t=this._hostNodes.get(e);t&&t.forEach(ax),this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach(function(n,r){t._addStylesToHost(e,r,n)})}},{key:"ngOnDestroy",value:function(){this._hostNodes.forEach(function(e){return e.forEach(ax)})}}]),n}(rx);return e.\u0275fac=function(t){return new(t||e)(pC(xI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function ax(e){AI().remove(e)}var ox={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},sx=/%COMP%/g;function ux(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?ux(e,i,n):(i=i.replace(sx,e),n.push(i))}return n}function cx(e){return function(t){if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var lx=function(){var e=function(){function e(t,n,r){Wg(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new hx(t)}return jg(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Tm.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new fx(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case 1:case Tm.ShadowDom:return new dx(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=ux(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(tx),pC(ix),pC(DT))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),hx=function(){function e(t){Wg(this,e),this.eventManager=t,this.data=Object.create(null)}return jg(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(ox[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var i=ox[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=ox[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&(Cw.DashCase|Cw.Important)?e.style.setProperty(t,n,r&Cw.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&Cw.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,cx(n)):this.eventManager.addEventListener(e,t,cx(n))}}]),e}(),fx=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;Wg(this,n),(o=t.call(this,e)).component=i;var s=ux(a+"-"+i.id,i.styles,[]);return r.addStyles(s),o.contentAttr="_ngcontent-%COMP%".replace(sx,a+"-"+i.id),o.hostAttr="_nghost-%COMP%".replace(sx,a+"-"+i.id),o}return jg(n,[{key:"applyToHost",value:function(e){xg(Bg(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=xg(Bg(n.prototype),"createElement",this).call(this,e,t);return xg(Bg(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(hx),dx=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;Wg(this,n),(o=t.call(this,e)).sharedStylesHost=r,o.hostEl=i,o.shadowRoot=i.attachShadow({mode:"open"}),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=ux(a.id,a.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],o.shadowRoot.appendChild(c)}return o}return jg(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return xg(Bg(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return xg(Bg(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return xg(Bg(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(xg(Bg(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(hx),vx=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,e)}return jg(n,[{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this;return e.addEventListener(t,n,!1),function(){return r.removeEventListener(e,t,n)}}},{key:"removeEventListener",value:function(e,t,n){return e.removeEventListener(t,n)}}]),n}(nx);return e.\u0275fac=function(t){return new(t||e)(pC(xI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),px=["alt","control","meta","shift"],gx={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},yx={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},mx={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},kx=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,e)}return jg(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var i=n.parseEventName(t),a=n.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return AI().onAndCancel(e,i.domEventName,a)})}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var i=n._normalizeKey(t.pop()),a="";if(px.forEach(function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),a+=e+".")}),a+=i,0!=t.length||0===i.length)return null;var o={};return o.domEventName=r,o.fullKey=a,o}},{key:"getEventFullKey",value:function(e){var t="",n=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&yx.hasOwnProperty(t)&&(t=yx[t]))}return gx[t]||t}(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),px.forEach(function(r){r!=n&&mx[r](e)&&(t+=r+".")}),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(i){n.getEventFullKey(i)===e&&r.runGuarded(function(){return t(i)})}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(nx);return e.\u0275fac=function(t){return new(t||e)(pC(xI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),_x=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({factory:function(){return pC(Cx)},token:e,providedIn:"root"}),e}(),Cx=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this))._doc=e,r}return jg(n,[{key:"sanitize",value:function(e,t){if(null==t)return null;switch(e){case ow.NONE:return t;case ow.HTML:return NC(t,"HTML")?MC(t):iw(this._doc,String(t)).toString();case ow.STYLE:return NC(t,"Style")?MC(t):t;case ow.SCRIPT:if(NC(t,"Script"))return MC(t);throw new Error("unsafe value used in a script context");case ow.URL:return DC(t),NC(t,"URL")?MC(t):zC(String(t));case ow.RESOURCE_URL:if(NC(t,"ResourceURL"))return MC(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(e," (see https://g.co/ng/security#xss)"))}}},{key:"bypassSecurityTrustHtml",value:function(e){return function(e){return new TC(e)}(e)}},{key:"bypassSecurityTrustStyle",value:function(e){return function(e){return new IC(e)}(e)}},{key:"bypassSecurityTrustScript",value:function(e){return function(e){return new AC(e)}(e)}},{key:"bypassSecurityTrustUrl",value:function(e){return function(e){return new xC(e)}(e)}},{key:"bypassSecurityTrustResourceUrl",value:function(e){return function(e){return new RC(e)}(e)}}]),n}(_x);return e.\u0275fac=function(t){return new(t||e)(pC(xI))},e.\u0275prov=dm({factory:function(){return function(e){return new Cx(e.get(xI))}(pC(pE))},token:e,providedIn:"root"}),e}(),wx=pI(PI,"browser",[{provide:BT,useValue:"browser"},{provide:UT,useValue:function(){ZA.makeCurrent(),XA.init()},multi:!0},{provide:xI,useFactory:function(){return e=document,vk=e,document;var e},deps:[]}]),bx=[[],{provide:yE,useValue:"root"},{provide:pw,useFactory:function(){return new pw},deps:[]},{provide:ex,useClass:vx,multi:!0,deps:[xI,eI,BT]},{provide:ex,useClass:kx,multi:!0,deps:[xI]},[],{provide:lx,useClass:lx,deps:[tx,ix,DT]},{provide:lO,useExisting:lx},{provide:rx,useExisting:ix},{provide:ix,useClass:ix,deps:[xI]},{provide:uI,useClass:uI,deps:[eI]},{provide:tx,useClass:tx,deps:[ex,eI]},{provide:jA,useClass:JA,deps:[]},[]],Ex=function(){var e=function(){function e(t){if(Wg(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return jg(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:DT,useValue:t.appId},{provide:KA,useExisting:DT},QA]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(e,12))},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:bx,imports:[HA,TI]}),e}();"undefined"!=typeof window&&window;var Sx=Array.isArray,Px=Object.getPrototypeOf,Ox=Object.prototype,Tx=Object.keys;function Ix(e){if(1===e.length){var t=e[0];if(Sx(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&Px(e)===Ox}(t)){var n=Tx(t);return{args:n.map(function(e){return t[e]}),keys:n}}}return{args:e,keys:null}}var Ax=Array.isArray;function xx(e){return Sy(function(t){return function(e,t){return Ax(t)?e.apply(void 0,Vg(t)):e(t)}(e,t)})}function Rx(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})}var Mx=function(){var e=function(){function e(t,n){Wg(this,e),this._renderer=t,this._elementRef=n,this.onChange=function(e){},this.onTouched=function(){}}return jg(e,[{key:"setProperty",value:function(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"registerOnChange",value:function(e){this.onChange=e}},{key:"setDisabledState",value:function(e){this.setProperty("disabled",e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(hO),QE(uO))},e.\u0275dir=Ym({type:e}),e}(),Nx=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n)}(Mx);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275dir=Ym({type:t,features:[xE]}),t}(),Dx=new Y_("NgValueAccessor"),Lx={provide:Dx,useExisting:am(function(){return Ux}),multi:!0},Fx=new Y_("CompositionEventMode"),Ux=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r))._compositionMode=i,a._composing=!1,null==a._compositionMode&&(a._compositionMode=!function(){var e=AI()?AI().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}()),a}return jg(n,[{key:"writeValue",value:function(e){this.setProperty("value",null!=e?e:"")}},{key:"_handleInput",value:function(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}},{key:"_compositionStart",value:function(){this._composing=!0}},{key:"_compositionEnd",value:function(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}]),n}(Mx);return e.\u0275fac=function(t){return new(t||e)(QE(hO),QE(uO),QE(Fx,8))},e.\u0275dir=Ym({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&uS("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[tO([Lx]),xE]}),e}();function Bx(e){return null==e||0===e.length}function Vx(e){return null!=e&&"number"==typeof e.length}var zx=new Y_("NgValidators"),Hx=new Y_("NgAsyncValidators"),Gx=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,$x=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"min",value:function(e){return t=e,function(e){if(Bx(e.value)||Bx(t))return null;var n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null};var t}},{key:"max",value:function(e){return t=e,function(e){if(Bx(e.value)||Bx(t))return null;var n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null};var t}},{key:"required",value:function(e){return Wx(e)}},{key:"requiredTrue",value:function(e){return!0===e.value?null:{required:!0}}},{key:"email",value:function(e){return Bx((t=e).value)||Gx.test(t.value)?null:{email:!0};var t}},{key:"minLength",value:function(e){return t=e,function(e){return Bx(e.value)||!Vx(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null};var t}},{key:"maxLength",value:function(e){return qx(e)}},{key:"pattern",value:function(e){return function(e){return e?("string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),function(e){if(Bx(e.value))return null;var r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}):jx;var t,n}(e)}},{key:"nullValidator",value:function(e){return null}},{key:"compose",value:function(e){return Jx(e)}},{key:"composeAsync",value:function(e){return tR(e)}}]),e}();function Wx(e){return Bx(e.value)?{required:!0}:null}function qx(e){return function(t){return Vx(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}}function jx(e){return null}function Zx(e){return null!=e}function Yx(e){var t=oS(e)?Qy(e):e;return sS(t),t}function Kx(e){var t={};return e.forEach(function(e){t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function Qx(e,t){return t.map(function(t){return t(e)})}function Xx(e){return e.map(function(e){return function(e){return!e.validate}(e)?e:function(t){return e.validate(t)}})}function Jx(e){if(!e)return null;var t=e.filter(Zx);return 0==t.length?null:function(e){return Kx(Qx(e,t))}}function eR(e){return null!=e?Jx(Xx(e)):null}function tR(e){if(!e)return null;var t=e.filter(Zx);return 0==t.length?null:function(e){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=qy(t),i=Ix(t),a=i.args,o=i.keys,s=new yy(function(e){var t=a.length;if(t)for(var n=new Array(t),r=t,i=t,s=function(t){var s=!1;By(a[t]).subscribe(new Ey(e,function(e){s||(s=!0,i--),n[t]=e},function(){return r--},void 0,function(){(!r||!s)&&(i||e.next(o?Rx(o,n):n),e.complete())}))},u=0;u<t;u++)s(u);else e.complete()});return r?s.pipe(xx(r)):s}(Qx(e,t).map(Yx)).pipe(Sy(Kx))}}function nR(e){return null!=e?tR(Xx(e)):null}function rR(e,t){return null===e?[t]:Array.isArray(e)?[].concat(Vg(e),[t]):[e,t]}function iR(e){return e._rawValidators}function aR(e){return e._rawAsyncValidators}function oR(e){return e?Array.isArray(e)?e:[e]:[]}function sR(e,t){return Array.isArray(e)?e.includes(t):e===t}function uR(e,t){var n=oR(t);return oR(e).forEach(function(e){sR(n,e)||n.push(e)}),n}function cR(e,t){return oR(t).filter(function(t){return!sR(e,t)})}var lR=function(){var e=function(){function e(){Wg(this,e),this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}return jg(e,[{key:"value",get:function(){return this.control?this.control.value:null}},{key:"valid",get:function(){return this.control?this.control.valid:null}},{key:"invalid",get:function(){return this.control?this.control.invalid:null}},{key:"pending",get:function(){return this.control?this.control.pending:null}},{key:"disabled",get:function(){return this.control?this.control.disabled:null}},{key:"enabled",get:function(){return this.control?this.control.enabled:null}},{key:"errors",get:function(){return this.control?this.control.errors:null}},{key:"pristine",get:function(){return this.control?this.control.pristine:null}},{key:"dirty",get:function(){return this.control?this.control.dirty:null}},{key:"touched",get:function(){return this.control?this.control.touched:null}},{key:"status",get:function(){return this.control?this.control.status:null}},{key:"untouched",get:function(){return this.control?this.control.untouched:null}},{key:"statusChanges",get:function(){return this.control?this.control.statusChanges:null}},{key:"valueChanges",get:function(){return this.control?this.control.valueChanges:null}},{key:"path",get:function(){return null}},{key:"_setValidators",value:function(e){this._rawValidators=e||[],this._composedValidatorFn=eR(this._rawValidators)}},{key:"_setAsyncValidators",value:function(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=nR(this._rawAsyncValidators)}},{key:"validator",get:function(){return this._composedValidatorFn||null}},{key:"asyncValidator",get:function(){return this._composedAsyncValidatorFn||null}},{key:"_registerOnDestroy",value:function(e){this._onDestroyCallbacks.push(e)}},{key:"_invokeOnDestroyCallbacks",value:function(){this._onDestroyCallbacks.forEach(function(e){return e()}),this._onDestroyCallbacks=[]}},{key:"reset",value:function(e){this.control&&this.control.reset(e)}},{key:"hasError",value:function(e,t){return!!this.control&&this.control.hasError(e,t)}},{key:"getError",value:function(e,t){return this.control?this.control.getError(e,t):null}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ym({type:e}),e}(),hR=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"formDirective",get:function(){return null}},{key:"path",get:function(){return null}}]),n}(lR);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275dir=Ym({type:t,features:[xE]}),t}(),fR=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments))._parent=null,e.name=null,e.valueAccessor=null,e}return jg(n)}(lR),dR=function(){function e(t){Wg(this,e),this._cd=t}return jg(e,[{key:"is",value:function(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}]),e}(),vR=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,e)}return jg(n)}(dR);return e.\u0275fac=function(t){return new(t||e)(QE(fR,2))},e.\u0275dir=Ym({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&SS("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[xE]}),e}(),pR=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,e)}return jg(n)}(dR);return e.\u0275fac=function(t){return new(t||e)(QE(hR,10))},e.\u0275dir=Ym({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&SS("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[xE]}),e}();function gR(e,t){return[].concat(Vg(t.path),[e])}function yR(e,t){_R(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(function(n){e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&wR(e,t)})}(e,t),function(e,t){var n=function(e,n){t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(function(){e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(function(){e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&wR(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){var n=function(e){t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(function(){e._unregisterOnDisabledChange(n)})}}(e,t)}function mR(e,t){var n=function(){};t.valueAccessor&&(t.valueAccessor.registerOnChange(n),t.valueAccessor.registerOnTouched(n)),CR(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(function(){}))}function kR(e,t){e.forEach(function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function _R(e,t){var n=iR(e);null!==t.validator?e.setValidators(rR(n,t.validator)):"function"==typeof n&&e.setValidators([n]);var r=aR(e);null!==t.asyncValidator?e.setAsyncValidators(rR(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);var i=function(){return e.updateValueAndValidity()};kR(t._rawValidators,i),kR(t._rawAsyncValidators,i)}function CR(e,t){var n=!1;if(null!==e){if(null!==t.validator){var r=iR(e);if(Array.isArray(r)&&r.length>0){var i=r.filter(function(e){return e!==t.validator});i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){var a=aR(e);if(Array.isArray(a)&&a.length>0){var o=a.filter(function(e){return e!==t.asyncValidator});o.length!==a.length&&(n=!0,e.setAsyncValidators(o))}}}var s=function(){};return kR(t._rawValidators,s),kR(t._rawAsyncValidators,s),n}function wR(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function bR(e,t){_R(e,t)}function ER(e,t){if(!e.hasOwnProperty("model"))return!1;var n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function SR(e,t){e._syncPendingControls(),t.forEach(function(e){var t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function PR(e,t){return t?(Array.isArray(t),t.forEach(function(e){e.constructor===Ux?n=e:function(e){return Object.getPrototypeOf(e.constructor)===Nx}(e)?r=e:i=e}),i||r||n||null):null;var n,r,i}function OR(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var TR="VALID",IR="INVALID",AR="PENDING",xR="DISABLED";function RR(e){return(LR(e)?e.validators:e)||null}function MR(e){return Array.isArray(e)?eR(e):e||null}function NR(e,t){return(LR(t)?t.asyncValidators:e)||null}function DR(e){return Array.isArray(e)?nR(e):e||null}function LR(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}var FR=function(){function e(t,n){Wg(this,e),this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=function(){},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=n,this._composedValidatorFn=MR(this._rawValidators),this._composedAsyncValidatorFn=DR(this._rawAsyncValidators)}return jg(e,[{key:"validator",get:function(){return this._composedValidatorFn},set:function(e){this._rawValidators=this._composedValidatorFn=e}},{key:"asyncValidator",get:function(){return this._composedAsyncValidatorFn},set:function(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}},{key:"parent",get:function(){return this._parent}},{key:"valid",get:function(){return this.status===TR}},{key:"invalid",get:function(){return this.status===IR}},{key:"pending",get:function(){return this.status==AR}},{key:"disabled",get:function(){return this.status===xR}},{key:"enabled",get:function(){return this.status!==xR}},{key:"dirty",get:function(){return!this.pristine}},{key:"untouched",get:function(){return!this.touched}},{key:"updateOn",get:function(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}},{key:"setValidators",value:function(e){this._rawValidators=e,this._composedValidatorFn=MR(e)}},{key:"setAsyncValidators",value:function(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=DR(e)}},{key:"addValidators",value:function(e){this.setValidators(uR(e,this._rawValidators))}},{key:"addAsyncValidators",value:function(e){this.setAsyncValidators(uR(e,this._rawAsyncValidators))}},{key:"removeValidators",value:function(e){this.setValidators(cR(e,this._rawValidators))}},{key:"removeAsyncValidators",value:function(e){this.setAsyncValidators(cR(e,this._rawAsyncValidators))}},{key:"hasValidator",value:function(e){return sR(this._rawValidators,e)}},{key:"hasAsyncValidator",value:function(e){return sR(this._rawAsyncValidators,e)}},{key:"clearValidators",value:function(){this.validator=null}},{key:"clearAsyncValidators",value:function(){this.asyncValidator=null}},{key:"markAsTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}},{key:"markAllAsTouched",value:function(){this.markAsTouched({onlySelf:!0}),this._forEachChild(function(e){return e.markAllAsTouched()})}},{key:"markAsUntouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!1,this._pendingTouched=!1,this._forEachChild(function(e){e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"markAsDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}},{key:"markAsPristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!0,this._pendingDirty=!1,this._forEachChild(function(e){e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"markAsPending",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.status=AR,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}},{key:"disable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status=xR,this.errors=null,this._forEachChild(function(t){t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(function(e){return e(!0)})}},{key:"enable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status=TR,this._forEachChild(function(t){t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(function(e){return e(!1)})}},{key:"_updateAncestors",value:function(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}},{key:"setParent",value:function(e){this._parent=e}},{key:"updateValueAndValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===TR||this.status===AR)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}},{key:"_updateTreeValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{emitEvent:!0};this._forEachChild(function(t){return t._updateTreeValidity(e)}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}},{key:"_setInitialStatus",value:function(){this.status=this._allControlsDisabled()?xR:TR}},{key:"_runValidator",value:function(){return this.validator?this.validator(this):null}},{key:"_runAsyncValidator",value:function(e){var t=this;if(this.asyncValidator){this.status=AR,this._hasOwnPendingAsyncValidator=!0;var n=Yx(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(function(n){t._hasOwnPendingAsyncValidator=!1,t.setErrors(n,{emitEvent:e})})}}},{key:"_cancelExistingSubscription",value:function(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}},{key:"setErrors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}},{key:"get",value:function(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;var r=e;return t.forEach(function(e){r=r instanceof BR?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof VR&&r.at(e)||null}),r}(this,e)}},{key:"getError",value:function(e,t){var n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}},{key:"hasError",value:function(e,t){return!!this.getError(e,t)}},{key:"root",get:function(){for(var e=this;e._parent;)e=e._parent;return e}},{key:"_updateControlsErrors",value:function(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}},{key:"_initObservables",value:function(){this.valueChanges=new gT,this.statusChanges=new gT}},{key:"_calculateStatus",value:function(){return this._allControlsDisabled()?xR:this.errors?IR:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(AR)?AR:this._anyControlsHaveStatus(IR)?IR:TR}},{key:"_anyControlsHaveStatus",value:function(e){return this._anyControls(function(t){return t.status===e})}},{key:"_anyControlsDirty",value:function(){return this._anyControls(function(e){return e.dirty})}},{key:"_anyControlsTouched",value:function(){return this._anyControls(function(e){return e.touched})}},{key:"_updatePristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"_updateTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"_isBoxedValue",value:function(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}},{key:"_registerOnCollectionChange",value:function(e){this._onCollectionChange=e}},{key:"_setUpdateStrategy",value:function(e){LR(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}},{key:"_parentMarkedDirty",value:function(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}]),e}(),UR=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return Wg(this,n),(e=t.call(this,RR(i),NR(a,i)))._onChange=[],e._applyFormState(r),e._setUpdateStrategy(i),e._initObservables(),e.updateValueAndValidity({onlySelf:!0,emitEvent:!!e.asyncValidator}),e}return jg(n,[{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(function(e){return e(t.value,!1!==n.emitViewToModelChange)}),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setValue(e,t)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}},{key:"_updateValue",value:function(){}},{key:"_anyControls",value:function(e){return!1}},{key:"_allControlsDisabled",value:function(){return this.disabled}},{key:"registerOnChange",value:function(e){this._onChange.push(e)}},{key:"_unregisterOnChange",value:function(e){OR(this._onChange,e)}},{key:"registerOnDisabledChange",value:function(e){this._onDisabledChange.push(e)}},{key:"_unregisterOnDisabledChange",value:function(e){OR(this._onDisabledChange,e)}},{key:"_forEachChild",value:function(e){}},{key:"_syncPendingControls",value:function(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}},{key:"_applyFormState",value:function(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}]),n}(FR),BR=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,RR(r),NR(i,r))).controls=e,a._initObservables(),a._setUpdateStrategy(r),a._setUpControls(),a.updateValueAndValidity({onlySelf:!0,emitEvent:!!a.asyncValidator}),a}return jg(n,[{key:"registerControl",value:function(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}},{key:"addControl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}},{key:"removeControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}},{key:"setControl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}},{key:"contains",value:function(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}},{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),Object.keys(e).forEach(function(r){t._throwIfControlMissing(r),t.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=e&&(Object.keys(e).forEach(function(r){t.controls[r]&&t.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild(function(n,r){n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this._reduceChildren({},function(e,t,n){return e[n]=t instanceof UR?t.value:t.getRawValue(),e})}},{key:"_syncPendingControls",value:function(){var e=this._reduceChildren(!1,function(e,t){return!!t._syncPendingControls()||e});return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error("Cannot find form control with name: ".concat(e,"."))}},{key:"_forEachChild",value:function(e){var t=this;Object.keys(this.controls).forEach(function(n){var r=t.controls[n];r&&e(r,n)})}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild(function(t){t.setParent(e),t._registerOnCollectionChange(e._onCollectionChange)})}},{key:"_updateValue",value:function(){this.value=this._reduceValue()}},{key:"_anyControls",value:function(e){for(var t=0,n=Object.keys(this.controls);t<n.length;t++){var r=n[t],i=this.controls[r];if(this.contains(r)&&e(i))return!0}return!1}},{key:"_reduceValue",value:function(){var e=this;return this._reduceChildren({},function(t,n,r){return(n.enabled||e.disabled)&&(t[r]=n.value),t})}},{key:"_reduceChildren",value:function(e,t){var n=e;return this._forEachChild(function(e,r){n=t(n,e,r)}),n}},{key:"_allControlsDisabled",value:function(){for(var e=0,t=Object.keys(this.controls);e<t.length;e++){var n=t[e];if(this.controls[n].enabled)return!1}return Object.keys(this.controls).length>0||this.disabled}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild(function(t,n){if(void 0===e[n])throw new Error("Must supply a value for form control with name: '".concat(n,"'."))})}}]),n}(FR),VR=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,RR(r),NR(i,r))).controls=e,a._initObservables(),a._setUpdateStrategy(r),a._setUpControls(),a.updateValueAndValidity({onlySelf:!0,emitEvent:!!a.asyncValidator}),a}return jg(n,[{key:"at",value:function(e){return this.controls[e]}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}},{key:"removeAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}},{key:"setControl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}},{key:"length",get:function(){return this.controls.length}},{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),e.forEach(function(e,r){t._throwIfControlMissing(r),t.at(r).setValue(e,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=e&&(e.forEach(function(e,r){t.at(r)&&t.at(r).patchValue(e,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild(function(n,r){n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this.controls.map(function(e){return e instanceof UR?e.value:e.getRawValue()})}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controls.length<1||(this._forEachChild(function(e){return e._registerOnCollectionChange(function(){})}),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}},{key:"_syncPendingControls",value:function(){var e=this.controls.reduce(function(e,t){return!!t._syncPendingControls()||e},!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error("Cannot find form control at index ".concat(e))}},{key:"_forEachChild",value:function(e){this.controls.forEach(function(t,n){e(t,n)})}},{key:"_updateValue",value:function(){var e=this;this.value=this.controls.filter(function(t){return t.enabled||e.disabled}).map(function(e){return e.value})}},{key:"_anyControls",value:function(e){return this.controls.some(function(t){return t.enabled&&e(t)})}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild(function(t){return e._registerControl(t)})}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild(function(t,n){if(void 0===e[n])throw new Error("Must supply a value for form control at index: ".concat(n,"."))})}},{key:"_allControlsDisabled",value:function(){var e,t=Hg(this.controls);try{for(t.s();!(e=t.n()).done;){if(e.value.enabled)return!1}}catch(n){t.e(n)}finally{t.f()}return this.controls.length>0||this.disabled}},{key:"_registerControl",value:function(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}]),n}(FR),zR={provide:hR,useExisting:am(function(){return GR})},HR=Promise.resolve(null),GR=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).submitted=!1,i._directives=[],i.ngSubmit=new gT,i.form=new BR({},eR(e),nR(r)),i}return jg(n,[{key:"ngAfterViewInit",value:function(){this._setUpdateStrategy()}},{key:"formDirective",get:function(){return this}},{key:"control",get:function(){return this.form}},{key:"path",get:function(){return[]}},{key:"controls",get:function(){return this.form.controls}},{key:"addControl",value:function(e){var t=this;HR.then(function(){var n=t._findContainer(e.path);e.control=n.registerControl(e.name,e.control),yR(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),t._directives.push(e)})}},{key:"getControl",value:function(e){return this.form.get(e.path)}},{key:"removeControl",value:function(e){var t=this;HR.then(function(){var n=t._findContainer(e.path);n&&n.removeControl(e.name),OR(t._directives,e)})}},{key:"addFormGroup",value:function(e){var t=this;HR.then(function(){var n=t._findContainer(e.path),r=new BR({});bR(r,e),n.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}},{key:"removeFormGroup",value:function(e){var t=this;HR.then(function(){var n=t._findContainer(e.path);n&&n.removeControl(e.name)})}},{key:"getFormGroup",value:function(e){return this.form.get(e.path)}},{key:"updateModel",value:function(e,t){var n=this;HR.then(function(){n.form.get(e.path).setValue(t)})}},{key:"setValue",value:function(e){this.control.setValue(e)}},{key:"onSubmit",value:function(e){return this.submitted=!0,SR(this.form,this._directives),this.ngSubmit.emit(e),!1}},{key:"onReset",value:function(){this.resetForm()}},{key:"resetForm",value:function(e){this.form.reset(e),this.submitted=!1}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}},{key:"_findContainer",value:function(e){return e.pop(),e.length?this.form.get(e):this.form}}]),n}(hR);return e.\u0275fac=function(t){return new(t||e)(QE(zx,10),QE(Hx,10))},e.\u0275dir=Ym({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&uS("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[tO([zR]),xE]}),e}(),$R={provide:fR,useExisting:am(function(){return qR})},WR=Promise.resolve(null),qR=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).control=new UR,o._registered=!1,o.update=new gT,o._parent=e,o._setValidators(r),o._setAsyncValidators(i),o.valueAccessor=PR(0,a),o}return jg(n,[{key:"ngOnChanges",value:function(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),ER(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}},{key:"ngOnDestroy",value:function(){this.formDirective&&this.formDirective.removeControl(this)}},{key:"path",get:function(){return this._parent?gR(this.name,this._parent):[this.name]}},{key:"formDirective",get:function(){return this._parent?this._parent.formDirective:null}},{key:"viewToModelUpdate",value:function(e){this.viewModel=e,this.update.emit(e)}},{key:"_setUpControl",value:function(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}},{key:"_isStandalone",value:function(){return!this._parent||!(!this.options||!this.options.standalone)}},{key:"_setUpStandalone",value:function(){yR(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}},{key:"_checkForErrors",value:function(){this._isStandalone()||this._checkParentType(),this._checkName()}},{key:"_checkParentType",value:function(){}},{key:"_checkName",value:function(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}},{key:"_updateValue",value:function(e){var t=this;WR.then(function(){t.control.setValue(e,{emitViewToModelChange:!1})})}},{key:"_updateDisabled",value:function(e){var t=this,n=e.isDisabled.currentValue,r=""===n||n&&"false"!==n;WR.then(function(){r&&!t.control.disabled?t.control.disable():!r&&t.control.disabled&&t.control.enable()})}}]),n}(fR);return e.\u0275fac=function(t){return new(t||e)(QE(hR,9),QE(zx,10),QE(Hx,10),QE(Dx,10))},e.\u0275dir=Ym({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[tO([$R]),xE,uk]}),e}(),jR=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ym({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e}(),ZR=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({}),e}(),YR={provide:Dx,useExisting:am(function(){return KR}),multi:!0},KR=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"writeValue",value:function(e){this.setProperty("value",parseFloat(e))}},{key:"registerOnChange",value:function(e){this.onChange=function(t){e(""==t?null:parseFloat(t))}}}]),n}(Nx);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275dir=Ym({type:t,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&uS("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[tO([YR]),xE]}),t}(),QR=new Y_("NgModelWithFormControlWarning"),XR={provide:hR,useExisting:am(function(){return JR})},JR=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).validators=e,i.asyncValidators=r,i.submitted=!1,i._onCollectionChange=function(){return i._updateDomValue()},i.directives=[],i.form=null,i.ngSubmit=new gT,i._setValidators(e),i._setAsyncValidators(r),i}return jg(n,[{key:"ngOnChanges",value:function(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}},{key:"ngOnDestroy",value:function(){this.form&&(CR(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(function(){}))}},{key:"formDirective",get:function(){return this}},{key:"control",get:function(){return this.form}},{key:"path",get:function(){return[]}},{key:"addControl",value:function(e){var t=this.form.get(e.path);return yR(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}},{key:"getControl",value:function(e){return this.form.get(e.path)}},{key:"removeControl",value:function(e){mR(e.control||null,e,!1),OR(this.directives,e)}},{key:"addFormGroup",value:function(e){this._setUpFormContainer(e)}},{key:"removeFormGroup",value:function(e){this._cleanUpFormContainer(e)}},{key:"getFormGroup",value:function(e){return this.form.get(e.path)}},{key:"addFormArray",value:function(e){this._setUpFormContainer(e)}},{key:"removeFormArray",value:function(e){this._cleanUpFormContainer(e)}},{key:"getFormArray",value:function(e){return this.form.get(e.path)}},{key:"updateModel",value:function(e,t){this.form.get(e.path).setValue(t)}},{key:"onSubmit",value:function(e){return this.submitted=!0,SR(this.form,this.directives),this.ngSubmit.emit(e),!1}},{key:"onReset",value:function(){this.resetForm()}},{key:"resetForm",value:function(e){this.form.reset(e),this.submitted=!1}},{key:"_updateDomValue",value:function(){var e=this;this.directives.forEach(function(t){var n=t.control,r=e.form.get(t.path);n!==r&&(mR(n||null,t),r instanceof UR&&(yR(r,t),t.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}},{key:"_setUpFormContainer",value:function(e){var t=this.form.get(e.path);bR(t,e),t.updateValueAndValidity({emitEvent:!1})}},{key:"_cleanUpFormContainer",value:function(e){if(this.form){var t=this.form.get(e.path);t&&function(e,t){return CR(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}},{key:"_updateRegistrations",value:function(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(function(){})}},{key:"_updateValidators",value:function(){_R(this.form,this),this._oldForm&&CR(this._oldForm,this)}},{key:"_checkFormPresent",value:function(){}}]),n}(hR);return e.\u0275fac=function(t){return new(t||e)(QE(zx,10),QE(Hx,10))},e.\u0275dir=Ym({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&uS("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[tO([XR]),xE,uk]}),e}(),eM={provide:fR,useExisting:am(function(){return tM})},tM=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this))._ngModelWarningConfig=o,s._added=!1,s.update=new gT,s._ngModelWarningSent=!1,s._parent=e,s._setValidators(r),s._setAsyncValidators(i),s.valueAccessor=PR(0,a),s}return jg(n,[{key:"isDisabled",set:function(e){}},{key:"ngOnChanges",value:function(e){this._added||this._setUpControl(),ER(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}},{key:"ngOnDestroy",value:function(){this.formDirective&&this.formDirective.removeControl(this)}},{key:"viewToModelUpdate",value:function(e){this.viewModel=e,this.update.emit(e)}},{key:"path",get:function(){return gR(null==this.name?this.name:this.name.toString(),this._parent)}},{key:"formDirective",get:function(){return this._parent?this._parent.formDirective:null}},{key:"_checkParentType",value:function(){}},{key:"_setUpControl",value:function(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}]),n}(fR);return e.\u0275fac=function(t){return new(t||e)(QE(hR,13),QE(zx,10),QE(Hx,10),QE(Dx,10),QE(QR,8))},e.\u0275dir=Ym({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[tO([eM]),xE,uk]}),e._ngModelWarningSentOnce=!1,e}(),nM={provide:Dx,useExisting:am(function(){return iM}),multi:!0};function rM(e,t){return null==e?"".concat(t):(t&&"object"==typeof t&&(t="Object"),"".concat(e,": ").concat(t).slice(0,50))}var iM=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments))._optionMap=new Map,e._idCounter=0,e._compareWith=Object.is,e}return jg(n,[{key:"compareWith",set:function(e){this._compareWith=e}},{key:"writeValue",value:function(e){this.value=e;var t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);var n=rM(t,e);this.setProperty("value",n)}},{key:"registerOnChange",value:function(e){var t=this;this.onChange=function(n){t.value=t._getOptionValue(n),e(t.value)}}},{key:"_registerOption",value:function(){return(this._idCounter++).toString()}},{key:"_getOptionId",value:function(e){for(var t=0,n=Array.from(this._optionMap.keys());t<n.length;t++){var r=n[t];if(this._compareWith(this._optionMap.get(r),e))return r}return null}},{key:"_getOptionValue",value:function(e){var t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}]),n}(Nx);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275dir=Ym({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&uS("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[tO([nM]),xE]}),t}(),aM=function(){var e=function(){function e(t,n,r){Wg(this,e),this._element=t,this._renderer=n,this._select=r,this._select&&(this.id=this._select._registerOption())}return jg(e,[{key:"ngValue",set:function(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(rM(this.id,e)),this._select.writeValue(this._select.value))}},{key:"value",set:function(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}},{key:"_setElementValue",value:function(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}},{key:"ngOnDestroy",value:function(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(uO),QE(hO),QE(iM,9))},e.\u0275dir=Ym({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e}(),oM={provide:Dx,useExisting:am(function(){return uM}),multi:!0};function sM(e,t){return null==e?"".concat(t):("string"==typeof t&&(t="'".concat(t,"'")),t&&"object"==typeof t&&(t="Object"),"".concat(e,": ").concat(t).slice(0,50))}var uM=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments))._optionMap=new Map,e._idCounter=0,e._compareWith=Object.is,e}return jg(n,[{key:"compareWith",set:function(e){this._compareWith=e}},{key:"writeValue",value:function(e){var t,n=this;if(this.value=e,Array.isArray(e)){var r=e.map(function(e){return n._getOptionId(e)});t=function(e,t){e._setSelected(r.indexOf(t.toString())>-1)}}else t=function(e,t){e._setSelected(!1)};this._optionMap.forEach(t)}},{key:"registerOnChange",value:function(e){var t=this;this.onChange=function(n){var r=[];if(void 0!==n.selectedOptions)for(var i=n.selectedOptions,a=0;a<i.length;a++){var o=i.item(a),s=t._getOptionValue(o.value);r.push(s)}else for(var u=n.options,c=0;c<u.length;c++){var l=u.item(c);if(l.selected){var h=t._getOptionValue(l.value);r.push(h)}}t.value=r,e(r)}}},{key:"_registerOption",value:function(e){var t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}},{key:"_getOptionId",value:function(e){for(var t=0,n=Array.from(this._optionMap.keys());t<n.length;t++){var r=n[t];if(this._compareWith(this._optionMap.get(r)._value,e))return r}return null}},{key:"_getOptionValue",value:function(e){var t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}]),n}(Nx);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275dir=Ym({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&uS("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[tO([oM]),xE]}),t}(),cM=function(){var e=function(){function e(t,n,r){Wg(this,e),this._element=t,this._renderer=n,this._select=r,this._select&&(this.id=this._select._registerOption(this))}return jg(e,[{key:"ngValue",set:function(e){null!=this._select&&(this._value=e,this._setElementValue(sM(this.id,e)),this._select.writeValue(this._select.value))}},{key:"value",set:function(e){this._select?(this._value=e,this._setElementValue(sM(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}},{key:"_setElementValue",value:function(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}},{key:"_setSelected",value:function(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}},{key:"ngOnDestroy",value:function(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(uO),QE(hO),QE(uM,9))},e.\u0275dir=Ym({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e}(),lM={provide:zx,useExisting:am(function(){return hM}),multi:!0},hM=function(){var e=function(){function e(){Wg(this,e),this._required=!1}return jg(e,[{key:"required",get:function(){return this._required},set:function(e){this._required=null!=e&&!1!==e&&"false"!="".concat(e),this._onChange&&this._onChange()}},{key:"validate",value:function(e){return this.required?Wx(e):null}},{key:"registerOnValidatorChange",value:function(e){this._onChange=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ym({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&$E("required",t.required?"":null)},inputs:{required:"required"},features:[tO([lM])]}),e}(),fM={provide:zx,useExisting:am(function(){return dM}),multi:!0},dM=function(){var e=function(){function e(){Wg(this,e),this._validator=jx}return jg(e,[{key:"ngOnChanges",value:function(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}},{key:"validate",value:function(e){return this.enabled()?this._validator(e):null}},{key:"registerOnValidatorChange",value:function(e){this._onChange=e}},{key:"_createValidator",value:function(){this._validator=this.enabled()?qx(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):jx}},{key:"enabled",value:function(){return null!=this.maxlength}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ym({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&$E("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[tO([fM]),uk]}),e}(),vM=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({imports:[[ZR]]}),e}(),pM=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({imports:[vM]}),e}(),gM=function(){var e=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"withConfig",value:function(t){return{ngModule:e,providers:[{provide:QR,useValue:t.warnOnNgModelWithFormControl}]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({imports:[vM]}),e}(),yM=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"group",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._reduceControls(e),i=null,a=null;return null!=n&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(n)?(i=null!=n.validators?n.validators:null,a=null!=n.asyncValidators?n.asyncValidators:null,t=null!=n.updateOn?n.updateOn:void 0):(i=null!=n.validator?n.validator:null,a=null!=n.asyncValidator?n.asyncValidator:null)),new BR(r,{asyncValidators:a,updateOn:t,validators:i})}},{key:"control",value:function(e,t,n){return new UR(e,t,n)}},{key:"array",value:function(e,t,n){var r=this,i=e.map(function(e){return r._createControl(e)});return new VR(i,t,n)}},{key:"_reduceControls",value:function(e){var t=this,n={};return Object.keys(e).forEach(function(r){n[r]=t._createControl(e[r])}),n}},{key:"_createControl",value:function(e){return e instanceof UR||e instanceof BR||e instanceof VR?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({factory:function(){return new e},token:e,providedIn:gM}),e}();function mM(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Qy(t,jy(t))}function kM(e,t){return Ug(t)?Hy(e,t,1):Hy(e,1)}function _M(e,t){return by(function(n,r){var i=0;n.subscribe(new Ey(r,function(n){return e.call(t,n,i++)&&r.next(n)}))})}var CM=jg(function e(){Wg(this,e)}),wM=jg(function e(){Wg(this,e)}),bM=function(){function e(t){var n=this;Wg(this,e),this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?function(){n.headers=new Map,t.split("\n").forEach(function(e){var t=e.indexOf(":");if(t>0){var r=e.slice(0,t),i=r.toLowerCase(),a=e.slice(t+1).trim();n.maybeSetNormalizedName(r,i),n.headers.has(i)?n.headers.get(i).push(a):n.headers.set(i,[a])}})}:function(){n.headers=new Map,Object.keys(t).forEach(function(e){var r=t[e],i=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(n.headers.set(i,r),n.maybeSetNormalizedName(e,i))})}:this.headers=new Map}return jg(e,[{key:"has",value:function(e){return this.init(),this.headers.has(e.toLowerCase())}},{key:"get",value:function(e){this.init();var t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}},{key:"keys",value:function(){return this.init(),Array.from(this.normalizedNames.values())}},{key:"getAll",value:function(e){return this.init(),this.headers.get(e.toLowerCase())||null}},{key:"append",value:function(e,t){return this.clone({name:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({name:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({name:e,value:t,op:"d"})}},{key:"maybeSetNormalizedName",value:function(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}},{key:"init",value:function(){var t=this;this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(function(e){return t.applyUpdate(e)}),this.lazyUpdate=null))}},{key:"copyFrom",value:function(e){var t=this;e.init(),Array.from(e.headers.keys()).forEach(function(n){t.headers.set(n,e.headers.get(n)),t.normalizedNames.set(n,e.normalizedNames.get(n))})}},{key:"clone",value:function(t){var n=new e;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}},{key:"applyUpdate",value:function(e){var t=e.name.toLowerCase();switch(e.op){case"a":case"s":var n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);var r=("a"===e.op?this.headers.get(t):void 0)||[];r.push.apply(r,Vg(n)),this.headers.set(t,r);break;case"d":var i=e.value;if(i){var a=this.headers.get(t);if(!a)return;0===(a=a.filter(function(e){return-1===i.indexOf(e)})).length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}else this.headers.delete(t),this.normalizedNames.delete(t)}}},{key:"forEach",value:function(e){var t=this;this.init(),Array.from(this.normalizedNames.keys()).forEach(function(n){return e(t.normalizedNames.get(n),t.headers.get(n))})}}]),e}(),EM=function(){function e(){Wg(this,e)}return jg(e,[{key:"encodeKey",value:function(e){return OM(e)}},{key:"encodeValue",value:function(e){return OM(e)}},{key:"decodeKey",value:function(e){return decodeURIComponent(e)}},{key:"decodeValue",value:function(e){return decodeURIComponent(e)}}]),e}(),SM=/%(\d[a-f0-9])/gi,PM={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function OM(e){return encodeURIComponent(e).replace(SM,function(e,t){var n;return null!==(n=PM[t])&&void 0!==n?n:e})}function TM(e){return"".concat(e)}var IM=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Wg(this,e),this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new EM,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){var n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(function(e){var r=e.indexOf("="),i=Pg(-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],2),a=i[0],o=i[1],s=n.get(a)||[];s.push(o),n.set(a,s)}),n}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(function(e){var r=n.fromObject[e];t.map.set(e,Array.isArray(r)?r:[r])})):this.map=null}return jg(e,[{key:"has",value:function(e){return this.init(),this.map.has(e)}},{key:"get",value:function(e){this.init();var t=this.map.get(e);return t?t[0]:null}},{key:"getAll",value:function(e){return this.init(),this.map.get(e)||null}},{key:"keys",value:function(){return this.init(),Array.from(this.map.keys())}},{key:"append",value:function(e,t){return this.clone({param:e,value:t,op:"a"})}},{key:"appendAll",value:function(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n];Array.isArray(r)?r.forEach(function(e){t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}},{key:"set",value:function(e,t){return this.clone({param:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({param:e,value:t,op:"d"})}},{key:"toString",value:function(){var e=this;return this.init(),this.keys().map(function(t){var n=e.encoder.encodeKey(t);return e.map.get(t).map(function(t){return n+"="+e.encoder.encodeValue(t)}).join("&")}).filter(function(e){return""!==e}).join("&")}},{key:"clone",value:function(t){var n=new e({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}},{key:"init",value:function(){var e=this;null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(function(t){return e.map.set(t,e.cloneFrom.map.get(t))}),this.updates.forEach(function(t){switch(t.op){case"a":case"s":var n=("a"===t.op?e.map.get(t.param):void 0)||[];n.push(TM(t.value)),e.map.set(t.param,n);break;case"d":if(void 0===t.value){e.map.delete(t.param);break}var r=e.map.get(t.param)||[],i=r.indexOf(TM(t.value));-1!==i&&r.splice(i,1),r.length>0?e.map.set(t.param,r):e.map.delete(t.param)}}),this.cloneFrom=this.updates=null)}}]),e}(),AM=function(){function e(){Wg(this,e),this.map=new Map}return jg(e,[{key:"set",value:function(e,t){return this.map.set(e,t),this}},{key:"get",value:function(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}},{key:"delete",value:function(e){return this.map.delete(e),this}},{key:"keys",value:function(){return this.map.keys()}}]),e}();function xM(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function RM(e){return"undefined"!=typeof Blob&&e instanceof Blob}function MM(e){return"undefined"!=typeof FormData&&e instanceof FormData}var NM=function(){function e(t,n,r,i){var a;if(Wg(this,e),this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,a=i):a=r,a&&(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params)),this.headers||(this.headers=new bM),this.context||(this.context=new AM),this.params){var o=this.params.toString();if(0===o.length)this.urlWithParams=n;else{var s=n.indexOf("?");this.urlWithParams=n+(-1===s?"?":s<n.length-1?"&":"")+o}}else this.params=new IM,this.urlWithParams=n}return jg(e,[{key:"serializeBody",value:function(){return null===this.body?null:xM(this.body)||RM(this.body)||MM(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof IM?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}},{key:"detectContentTypeHeader",value:function(){return null===this.body||MM(this.body)?null:RM(this.body)?this.body.type||null:xM(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof IM?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}},{key:"clone",value:function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.method||this.method,i=n.url||this.url,a=n.responseType||this.responseType,o=void 0!==n.body?n.body:this.body,s=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,u=void 0!==n.reportProgress?n.reportProgress:this.reportProgress,c=n.headers||this.headers,l=n.params||this.params,h=null!==(t=n.context)&&void 0!==t?t:this.context;return void 0!==n.setHeaders&&(c=Object.keys(n.setHeaders).reduce(function(e,t){return e.set(t,n.setHeaders[t])},c)),n.setParams&&(l=Object.keys(n.setParams).reduce(function(e,t){return e.set(t,n.setParams[t])},l)),new e(r,i,o,{params:l,headers:c,context:h,reportProgress:u,responseType:a,withCredentials:s})}}]),e}(),DM=((DM=DM||{})[DM.Sent=0]="Sent",DM[DM.UploadProgress=1]="UploadProgress",DM[DM.ResponseHeader=2]="ResponseHeader",DM[DM.DownloadProgress=3]="DownloadProgress",DM[DM.Response=4]="Response",DM[DM.User=5]="User",DM),LM=jg(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";Wg(this,e),this.headers=t.headers||new bM,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}),FM=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Wg(this,n),(e=t.call(this,r)).type=DM.ResponseHeader,e}return jg(n,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new n({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),n}(LM),UM=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Wg(this,n),(e=t.call(this,r)).type=DM.Response,e.body=void 0!==r.body?r.body:null,e}return jg(n,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new n({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),n}(LM),BM=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e,0,"Unknown Error")).name="HttpErrorResponse",r.ok=!1,r.message=r.status>=200&&r.status<300?"Http failure during parsing for ".concat(e.url||"(unknown url)"):"Http failure response for ".concat(e.url||"(unknown url)",": ").concat(e.status," ").concat(e.statusText),r.error=e.error||null,r}return jg(n)}(LM);function VM(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}var zM=function(){var e=function(){function e(t){Wg(this,e),this.handler=t}return jg(e,[{key:"request",value:function(e,t){var n,r,i,a=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e instanceof NM?n=e:(r=o.headers instanceof bM?o.headers:new bM(o.headers),o.params&&(i=o.params instanceof IM?o.params:new IM({fromObject:o.params})),n=new NM(e,t,void 0!==o.body?o.body:null,{headers:r,context:o.context,params:i,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials}));var s=mM(n).pipe(kM(function(e){return a.handler.handle(e)}));if(e instanceof NM||"events"===o.observe)return s;var u=s.pipe(_M(function(e){return e instanceof UM}));switch(o.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return u.pipe(Sy(function(e){if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return u.pipe(Sy(function(e){if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return u.pipe(Sy(function(e){if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return u.pipe(Sy(function(e){return e.body}))}case"response":return u;default:throw new Error("Unreachable: unhandled observe type ".concat(o.observe,"}"))}}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,t)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,t)}},{key:"head",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("HEAD",e,t)}},{key:"jsonp",value:function(e,t){return this.request("JSONP",e,{params:(new IM).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}},{key:"options",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("OPTIONS",e,t)}},{key:"patch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PATCH",e,VM(n,t))}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,VM(n,t))}},{key:"put",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,VM(n,t))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(CM))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),HM=function(){function e(t,n){Wg(this,e),this.next=t,this.interceptor=n}return jg(e,[{key:"handle",value:function(e){return this.interceptor.intercept(e,this.next)}}]),e}(),GM=new Y_("HTTP_INTERCEPTORS"),$M=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"intercept",value:function(e,t){return t.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),WM=/^\)\]\}',?\n/,qM=function(){var e=function(){function e(t){Wg(this,e),this.xhrFactory=t}return jg(e,[{key:"handle",value:function(e){var t=this;if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new yy(function(n){var r=t.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach(function(e,t){return r.setRequestHeader(e,t.join(","))}),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){var i=e.detectContentTypeHeader();null!==i&&r.setRequestHeader("Content-Type",i)}if(e.responseType){var a=e.responseType.toLowerCase();r.responseType="json"!==a?a:"text"}var o=e.serializeBody(),s=null,u=function(){if(null!==s)return s;var t=1223===r.status?204:r.status,n=r.statusText||"OK",i=new bM(r.getAllResponseHeaders()),a=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(r)||e.url;return s=new FM({headers:i,status:t,statusText:n,url:a})},c=function(){var t=u(),i=t.headers,a=t.status,o=t.statusText,s=t.url,c=null;204!==a&&(c=void 0===r.response?r.responseText:r.response),0===a&&(a=c?200:0);var l=a>=200&&a<300;if("json"===e.responseType&&"string"==typeof c){var h=c;c=c.replace(WM,"");try{c=""!==c?JSON.parse(c):null}catch(f){c=h,l&&(l=!1,c={error:f,text:c})}}l?(n.next(new UM({body:c,headers:i,status:a,statusText:o,url:s||void 0})),n.complete()):n.error(new BM({error:c,headers:i,status:a,statusText:o,url:s||void 0}))},l=function(e){var t=u().url,i=new BM({error:e,status:r.status||0,statusText:r.statusText||"Unknown Error",url:t||void 0});n.error(i)},h=!1,f=function(t){h||(n.next(u()),h=!0);var i={type:DM.DownloadProgress,loaded:t.loaded};t.lengthComputable&&(i.total=t.total),"text"===e.responseType&&!!r.responseText&&(i.partialText=r.responseText),n.next(i)},d=function(e){var t={type:DM.UploadProgress,loaded:e.loaded};e.lengthComputable&&(t.total=e.total),n.next(t)};return r.addEventListener("load",c),r.addEventListener("error",l),r.addEventListener("timeout",l),r.addEventListener("abort",l),e.reportProgress&&(r.addEventListener("progress",f),null!==o&&r.upload&&r.upload.addEventListener("progress",d)),r.send(o),n.next({type:DM.Sent}),function(){r.removeEventListener("error",l),r.removeEventListener("abort",l),r.removeEventListener("load",c),r.removeEventListener("timeout",l),e.reportProgress&&(r.removeEventListener("progress",f),null!==o&&r.upload&&r.upload.removeEventListener("progress",d)),r.readyState!==r.DONE&&r.abort()}})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(jA))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),jM=new Y_("XSRF_COOKIE_NAME"),ZM=new Y_("XSRF_HEADER_NAME"),YM=jg(function e(){Wg(this,e)}),KM=function(){var e=function(){function e(t,n,r){Wg(this,e),this.doc=t,this.platform=n,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}return jg(e,[{key:"getToken",value:function(){if("server"===this.platform)return null;var e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=MA(e,this.cookieName),this.lastCookieString=e),this.lastToken}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(xI),pC(BT),pC(jM))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),QM=function(){var e=function(){function e(t,n){Wg(this,e),this.tokenService=t,this.headerName=n}return jg(e,[{key:"intercept",value:function(e,t){var n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);var r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(YM),pC(ZM))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),XM=function(){var e=function(){function e(t,n){Wg(this,e),this.backend=t,this.injector=n,this.chain=null}return jg(e,[{key:"handle",value:function(e){if(null===this.chain){var t=this.injector.get(GM,[]);this.chain=t.reduceRight(function(e,t){return new HM(e,t)},this.backend)}return this.chain.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(wM),pC(IE))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),JM=function(){var e=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"disable",value:function(){return{ngModule:e,providers:[{provide:QM,useClass:$M}]}}},{key:"withOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ngModule:e,providers:[t.cookieName?{provide:jM,useValue:t.cookieName}:[],t.headerName?{provide:ZM,useValue:t.headerName}:[]]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[QM,{provide:GM,useExisting:QM,multi:!0},{provide:YM,useClass:KM},{provide:jM,useValue:"XSRF-TOKEN"},{provide:ZM,useValue:"X-XSRF-TOKEN"}]}),e}(),eN=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[zM,{provide:CM,useClass:XM},qM,{provide:wM,useExisting:qM}],imports:[[JM.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e}(),tN=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this))._value=e,r}return jg(n,[{key:"value",get:function(){return this.getValue()}},{key:"_subscribe",value:function(e){var t=xg(Bg(n.prototype),"_subscribe",this).call(this,e);return!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){var e=this.hasError,t=this.thrownError,n=this._value;if(e)throw t;return this._throwIfClosed(),n}},{key:"next",value:function(e){xg(Bg(n.prototype),"next",this).call(this,this._value=e)}}]),n}(_y);function nN(e,t,n){e?zy(n,e,t):t()}var rN=zg(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function iN(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Gy(1)(Qy(t,jy(t)))}function aN(e){return new yy(function(t){By(e()).subscribe(t)})}function oN(){return by(function(e,t){var n=null;e._refCount++;var r=new Ey(t,void 0,void 0,void 0,function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()}});e.subscribe(r),r.closed||(n=e.connect())})}var sN=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).source=e,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,wy(e)&&(i.lift=e.lift),i}return jg(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}},{key:"_teardown",value:function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()}},{key:"connect",value:function(){var e=this,t=this._connection;if(!t){t=this._connection=new qg;var n=this.getSubject();t.add(this.source.subscribe(new Ey(n,void 0,function(){e._teardown(),n.complete()},function(t){e._teardown(),n.error(t)},function(){return e._teardown()}))),t.closed&&(this._connection=null,t=qg.EMPTY)}return t}},{key:"refCount",value:function(){return oN()(this)}}]),n}(yy);function uN(e,t){return by(function(n,r){var i=null,a=0,o=!1,s=function(){return o&&!i&&r.complete()};n.subscribe(new Ey(r,function(n){null==i||i.unsubscribe();var o=0,u=a++;By(e(n,u)).subscribe(i=new Ey(r,function(e){return r.next(t?t(n,e,u,o++):e)},function(){i=null,s()}))},function(){o=!0,s()}))})}function cN(e,t,n,r,i){return function(a,o){var s=n,u=t,c=0;a.subscribe(new Ey(o,function(t){var n=c++;u=s?e(u,t,n):(s=!0,t),r&&o.next(u)},i&&function(){s&&o.next(u),o.complete()}))}}function lN(e,t){return by(cN(e,t,arguments.length>=2,!0))}function hN(e){return by(function(t,n){var r,i=null,a=!1;i=t.subscribe(new Ey(n,void 0,void 0,function(o){r=By(e(o,hN(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0})),a&&(i.unsubscribe(),i=null,r.subscribe(n))})}function fN(e){return e<=0?function(){return $y}:by(function(t,n){var r=[];t.subscribe(new Ey(n,function(t){r.push(t),e<r.length&&r.shift()},function(){var e,t=Hg(r);try{for(t.s();!(e=t.n()).done;){var i=e.value;n.next(i)}}catch(a){t.e(a)}finally{t.f()}n.complete()},void 0,function(){r=null}))})}function dN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vN;return by(function(t,n){var r=!1;t.subscribe(new Ey(n,function(e){r=!0,n.next(e)},function(){return r?n.complete():n.error(e())}))})}function vN(){return new rN}function pN(e){return by(function(t,n){var r=!1;t.subscribe(new Ey(n,function(e){r=!0,n.next(e)},function(){r||n.next(e),n.complete()}))})}function gN(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?_M(function(t,n){return e(t,n,r)}):gy,Xy(1),n?pN(t):dN(function(){return new rN}))}}function yN(e,t,n){var r=Ug(e)||t||n?{next:e,error:t,complete:n}:e;return r?by(function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(new Ey(t,function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)},function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()},function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)},function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)}))}):gy}var mN=jg(function e(t,n){Wg(this,e),this.id=t,this.url=n}),kN=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Wg(this,n),(i=t.call(this,e,r)).navigationTrigger=a,i.restoredState=o,i}return jg(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(mN),_N=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).urlAfterRedirects=i,a}return jg(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}(mN),CN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).reason=i,a}return jg(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(mN),wN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).error=i,a}return jg(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}(mN),bN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).urlAfterRedirects=i,o.state=a,o}return jg(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(mN),EN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).urlAfterRedirects=i,o.state=a,o}return jg(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(mN),SN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this,e,r)).urlAfterRedirects=i,s.state=a,s.shouldActivate=o,s}return jg(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}(mN),PN=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).urlAfterRedirects=i,o.state=a,o}return jg(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(mN),ON=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).urlAfterRedirects=i,o.state=a,o}return jg(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(mN),TN=function(){function e(t){Wg(this,e),this.route=t}return jg(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),IN=function(){function e(t){Wg(this,e),this.route=t}return jg(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),AN=function(){function e(t){Wg(this,e),this.snapshot=t}return jg(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),xN=function(){function e(t){Wg(this,e),this.snapshot=t}return jg(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),RN=function(){function e(t){Wg(this,e),this.snapshot=t}return jg(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),MN=function(){function e(t){Wg(this,e),this.snapshot=t}return jg(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),NN=function(){function e(t,n,r){Wg(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return jg(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),DN="primary",LN=function(){function e(t){Wg(this,e),this.params=t||{}}return jg(e,[{key:"has",value:function(e){return Object.prototype.hasOwnProperty.call(this.params,e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function FN(e){return new LN(e)}var UN="ngNavigationCancelingError";function BN(e){var t=Error("NavigationCancelingError: "+e);return t[UN]=!0,t}function VN(e,t,n){var r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var i={},a=0;a<r.length;a++){var o=r[a],s=e[a];if(o.startsWith(":"))i[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function zN(e,t){var n,r=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!r||!i||r.length!=i.length)return!1;for(var a=0;a<r.length;a++)if(!HN(e[n=r[a]],t[n]))return!1;return!0}function HN(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;var n=Vg(e).sort(),r=Vg(t).sort();return n.every(function(e,t){return r[t]===e})}return e===t}function GN(e){return Array.prototype.concat.apply([],e)}function $N(e){return e.length>0?e[e.length-1]:null}function WN(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function qN(e){return sS(e)?e:oS(e)?Qy(Promise.resolve(e)):mM(e)}var jN={exact:function e(t,n,r){if(!nD(t.segments,n.segments)||!XN(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(var i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:KN},ZN={exact:function(e,t){return zN(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(function(n){return HN(e[n],t[n])})},ignored:function(){return!0}};function YN(e,t,n){return jN[n.paths](e.root,t.root,n.matrixParams)&&ZN[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function KN(e,t,n){return QN(e,t,t.segments,n)}function QN(e,t,n,r){if(e.segments.length>n.length){var i=e.segments.slice(0,n.length);return!(!nD(i,n)||t.hasChildren()||!XN(i,n,r))}if(e.segments.length===n.length){if(!nD(e.segments,n)||!XN(e.segments,n,r))return!1;for(var a in t.children)if(!e.children[a]||!KN(e.children[a],t.children[a],r))return!1;return!0}var o=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(nD(e.segments,o)&&XN(e.segments,o,r)&&e.children[DN])&&QN(e.children[DN],t,s,r)}function XN(e,t,n){return t.every(function(t,r){return ZN[n](e[r].parameters,t.parameters)})}var JN=function(){function e(t,n,r){Wg(this,e),this.root=t,this.queryParams=n,this.fragment=r}return jg(e,[{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=FN(this.queryParams)),this._queryParamMap}},{key:"toString",value:function(){return aD.serialize(this)}}]),e}(),eD=function(){function e(t,n){var r=this;Wg(this,e),this.segments=t,this.children=n,this.parent=null,WN(n,function(e,t){return e.parent=r})}return jg(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}},{key:"toString",value:function(){return oD(this)}}]),e}(),tD=function(){function e(t,n){Wg(this,e),this.path=t,this.parameters=n}return jg(e,[{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=FN(this.parameters)),this._parameterMap}},{key:"toString",value:function(){return dD(this)}}]),e}();function nD(e,t){return e.length===t.length&&e.every(function(e,n){return e.path===t[n].path})}var rD=jg(function e(){Wg(this,e)}),iD=function(){function e(){Wg(this,e)}return jg(e,[{key:"parse",value:function(e){var t=new mD(e);return new JN(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){var t;return"".concat("/".concat(sD(e.root,!0)),function(e){var t=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return"".concat(cD(t),"=").concat(cD(e))}).join("&"):"".concat(cD(t),"=").concat(cD(n))}).filter(function(e){return!!e});return t.length?"?".concat(t.join("&")):""}(e.queryParams)).concat("string"==typeof e.fragment?"#".concat((t=e.fragment,encodeURI(t))):"")}}]),e}(),aD=new iD;function oD(e){return e.segments.map(function(e){return dD(e)}).join("/")}function sD(e,t){if(!e.hasChildren())return oD(e);if(t){var n=e.children[DN]?sD(e.children[DN],!1):"",r=[];return WN(e.children,function(e,t){t!==DN&&r.push("".concat(t,":").concat(sD(e,!1)))}),r.length>0?"".concat(n,"(").concat(r.join("//"),")"):n}var i=function(e,t){var n=[];return WN(e.children,function(e,r){r===DN&&(n=n.concat(t(e,r)))}),WN(e.children,function(e,r){r!==DN&&(n=n.concat(t(e,r)))}),n}(e,function(t,n){return n===DN?[sD(e.children[DN],!1)]:["".concat(n,":").concat(sD(t,!1))]});return 1===Object.keys(e.children).length&&null!=e.children[DN]?"".concat(oD(e),"/").concat(i[0]):"".concat(oD(e),"/(").concat(i.join("//"),")")}function uD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function cD(e){return uD(e).replace(/%3B/gi,";")}function lD(e){return uD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hD(e){return decodeURIComponent(e)}function fD(e){return hD(e.replace(/\+/g,"%20"))}function dD(e){return"".concat(lD(e.path)).concat(function(e){return Object.keys(e).map(function(t){return";".concat(lD(t),"=").concat(lD(e[t]))}).join("")}(e.parameters))}var vD=/^[^\/()?;=#]+/;function pD(e){var t=e.match(vD);return t?t[0]:""}var gD=/^[^=?&#]+/,yD=/^[^?&#]+/,mD=function(){function e(t){Wg(this,e),this.url=t,this.remaining=t}return jg(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new eD([],{}):new eD([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[DN]=new eD(e,t)),n}},{key:"parseSegment",value:function(){var e=pD(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new tD(hD(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=pD(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=pD(this.remaining);r&&(n=r,this.capture(n))}e[hD(t)]=hD(n)}}},{key:"parseQueryParam",value:function(e){var t=function(e){var t=e.match(gD);return t?t[0]:""}(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=function(e){var t=e.match(yD);return t?t[0]:""}(this.remaining);r&&(n=r,this.capture(n))}var i=fD(t),a=fD(n);if(e.hasOwnProperty(i)){var o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(a)}else e[i]=a}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=pD(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=DN);var a=this.parseChildren();t[i]=1===Object.keys(a).length?a[DN]:new eD([],a),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),kD=function(){function e(t){Wg(this,e),this._root=t}return jg(e,[{key:"root",get:function(){return this._root.value}},{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=_D(e,this._root);return t?t.children.map(function(e){return e.value}):[]}},{key:"firstChild",value:function(e){var t=_D(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=CD(e,this._root);return t.length<2?[]:t[t.length-2].children.map(function(e){return e.value}).filter(function(t){return t!==e})}},{key:"pathFromRoot",value:function(e){return CD(e,this._root).map(function(e){return e.value})}}]),e}();function _D(e,t){if(e===t.value)return t;var n,r=Hg(t.children);try{for(r.s();!(n=r.n()).done;){var i=_D(e,n.value);if(i)return i}}catch(a){r.e(a)}finally{r.f()}return null}function CD(e,t){if(e===t.value)return[t];var n,r=Hg(t.children);try{for(r.s();!(n=r.n()).done;){var i=CD(e,n.value);if(i.length)return i.unshift(t),i}}catch(a){r.e(a)}finally{r.f()}return[]}var wD=function(){function e(t,n){Wg(this,e),this.value=t,this.children=n}return jg(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function bD(e){var t={};return e&&e.children.forEach(function(e){return t[e.value.outlet]=e}),t}var ED=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e)).snapshot=r,AD(Fg(i),e),i}return jg(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}(kD);function SD(e,t){var n=function(e,t){var n=new TD([],{},{},"",{},DN,t,null,e.root,-1,{});return new ID("",new wD(n,[]))}(e,t),r=new tN([new tD("",{})]),i=new tN({}),a=new tN({}),o=new tN({}),s=new tN(""),u=new PD(r,i,o,s,a,DN,t,n.root);return u.snapshot=n.root,new ED(new wD(u,[]),n)}var PD=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=a,this.outlet=o,this.component=s,this._futureSnapshot=u}return jg(e,[{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(Sy(function(e){return FN(e)}))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Sy(function(e){return FN(e)}))),this._queryParamMap}},{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}}]),e}();function OD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var i=n[r],a=n[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(a.component)break;r--}}return function(e){return e.reduce(function(e,t){return{params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var TD=function(){function e(t,n,r,i,a,o,s,u,c,l,h){Wg(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=a,this.outlet=o,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return jg(e,[{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=FN(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=FN(this.queryParams)),this._queryParamMap}},{key:"toString",value:function(){return"Route(url:'".concat(this.url.map(function(e){return e.toString()}).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}}]),e}(),ID=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,r)).url=e,AD(Fg(i),r),i}return jg(n,[{key:"toString",value:function(){return xD(this._root)}}]),n}(kD);function AD(e,t){t.value._routerState=e,t.children.forEach(function(t){return AD(e,t)})}function xD(e){var t=e.children.length>0?" { ".concat(e.children.map(xD).join(", ")," } "):"";return"".concat(e.value).concat(t)}function RD(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,zN(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),zN(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!zN(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),zN(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function MD(e,t){return zN(e.params,t.params)&&function(e,t){return nD(e,t)&&e.every(function(e,n){return zN(e.parameters,t[n].parameters)})}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||MD(e.parent,t.parent))}function ND(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){var r=n.value;r._futureSnapshot=t.value;var i=function(e,t,n){return t.children.map(function(t){var r,i=Hg(n.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(e.shouldReuseRoute(t.value,a.value.snapshot))return ND(e,t,a)}}catch(o){i.e(o)}finally{i.f()}return ND(e,t)})}(e,t,n);return new wD(r,i)}if(e.shouldAttach(t.value)){var a=e.retrieve(t.value);if(null!==a){var o=a.route;return DD(t,o),o}}var s=function(e){return new PD(new tN(e.url),new tN(e.params),new tN(e.queryParams),new tN(e.fragment),new tN(e.data),e.outlet,e.component,e)}(t.value),u=t.children.map(function(t){return ND(e,t)});return new wD(s,u)}function DD(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(var n=0;n<e.children.length;++n)DD(e.children[n],t.children[n])}function LD(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function FD(e){return"object"==typeof e&&null!=e&&e.outlets}function UD(e,t,n,r,i){var a={};return r&&WN(r,function(e,t){a[t]=Array.isArray(e)?e.map(function(e){return"".concat(e)}):"".concat(e)}),new JN(n.root===e?t:BD(n.root,e,t),a,i)}function BD(e,t,n){var r={};return WN(e.children,function(e,i){r[i]=e===t?n:BD(e,t,n)}),new eD(e.segments,r)}var VD=function(){function e(t,n,r){if(Wg(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&LD(r[0]))throw new Error("Root segment cannot have matrix parameters");var i=r.find(FD);if(i&&i!==$N(r))throw new Error("{outlets:{}} has to be the last command")}return jg(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),zD=jg(function e(t,n,r){Wg(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r});function HD(e,t,n){if(e||(e=new eD([],{})),0===e.segments.length&&e.hasChildren())return GD(e,t,n);var r=function(e,t,n){for(var r=0,i=t,a={match:!1,pathIndex:0,commandIndex:0};i<e.segments.length;){if(r>=n.length)return a;var o=e.segments[i],s=n[r];if(FD(s))break;var u="".concat(s),c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!jD(u,c,o))return a;r+=2}else{if(!jD(u,{},o))return a;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var a=new eD(e.segments.slice(0,r.pathIndex),{});return a.children[DN]=new eD(e.segments.slice(r.pathIndex),e.children),GD(a,0,i)}return r.match&&0===i.length?new eD(e.segments,{}):r.match&&!e.hasChildren()?$D(e,t,n):r.match?GD(e,0,i):$D(e,t,n)}function GD(e,t,n){if(0===n.length)return new eD(e.segments,{});var r=function(e){return FD(e[0])?e[0].outlets:Sg({},DN,e)}(n),i={};return WN(r,function(n,r){"string"==typeof n&&(n=[n]),null!==n&&(i[r]=HD(e.children[r],t,n))}),WN(e.children,function(e,t){void 0===r[t]&&(i[t]=e)}),new eD(e.segments,i)}function $D(e,t,n){for(var r=e.segments.slice(0,t),i=0;i<n.length;){var a=n[i];if(FD(a)){var o=WD(a.outlets);return new eD(r,o)}if(0===i&&LD(n[0]))r.push(new tD(e.segments[t].path,qD(n[0]))),i++;else{var s=FD(a)?a.outlets[DN]:"".concat(a),u=i<n.length-1?n[i+1]:null;s&&u&&LD(u)?(r.push(new tD(s,qD(u))),i+=2):(r.push(new tD(s,{})),i++)}}return new eD(r,{})}function WD(e){var t={};return WN(e,function(e,n){"string"==typeof e&&(e=[e]),null!==e&&(t[n]=$D(new eD([],{}),0,e))}),t}function qD(e){var t={};return WN(e,function(e,n){return t[n]="".concat(e)}),t}function jD(e,t,n){return e==n.path&&zN(t,n.parameters)}var ZD=function(){function e(t,n,r,i){Wg(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=i}return jg(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),RD(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,i=bD(t);e.children.forEach(function(e){var t=e.value.outlet;r.deactivateRoutes(e,i[t],n),delete i[t]}),WN(i,function(e,t){r.deactivateRouteAndItsChildren(e,n)})}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,i=t?t.value:null;if(r===i)if(r.component){var a=n.getContext(r.outlet);a&&this.deactivateChildRoutes(e,t,a.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),i=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:i})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){for(var n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=bD(e),a=0,o=Object.keys(i);a<o.length;a++){var s=o[a];this.deactivateRouteAndItsChildren(i[s],r)}n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,i=bD(t);e.children.forEach(function(e){r.activateRoutes(e,i[e.value.outlet],n),r.forwardEvent(new MN(e.value.snapshot))}),e.children.length&&this.forwardEvent(new xN(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,i=t?t.value:null;if(RD(r),r===i)if(r.component){var a=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,a.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),YD(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;o.attachRef=null,o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function YD(e){RD(e.value),e.children.forEach(YD)}var KD=jg(function e(t,n){Wg(this,e),this.routes=t,this.module=n});function QD(e){return"function"==typeof e}function XD(e){return e instanceof JN}var JD=Symbol("INITIAL_VALUE");function eL(){return uN(function(e){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jy(t),i=qy(t),a=Ix(t),o=a.args,s=a.keys;if(0===o.length)return Qy([],r);var u=new yy(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gy;return function(r){nN(t,function(){for(var i=e.length,a=new Array(i),o=i,s=i,u=function(i){nN(t,function(){var u=Qy(e[i],t),c=!1;u.subscribe(new Ey(r,function(e){a[i]=e,c||(c=!0,s--),s||r.next(n(a.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)u(c)},r)}}(o,r,s?function(e){return Rx(s,e)}:gy));return i?u.pipe(xx(i)):u}(e.map(function(e){return e.pipe(Xy(1),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jy(t);return by(function(e,n){(r?iN(t,e,r):iN(t,e)).subscribe(n)})}(JD))})).pipe(lN(function(e,t){var n=!1;return t.reduce(function(e,r,i){return e!==JD?e:(r===JD&&(n=!0),n||!1!==r&&i!==t.length-1&&!XD(r)?e:r)},e)},JD),_M(function(e){return e!==JD}),Sy(function(e){return XD(e)?e:!0===e}),Xy(1))})}var tL=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Gm({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&nS(0,"router-outlet")},directives:function(){return[XL]},encapsulation:2}),e}();function nL(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];rL(r,iL(t,r))}}function rL(e,t){e.children&&nL(e.children,t)}function iL(e,t){return t?e||t.path?e&&!t.path?"".concat(e,"/"):!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function aL(e){var t=e.children&&e.children.map(aL),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==DN&&(n.component=tL),n}function oL(e){return e.outlet||DN}function sL(e,t){var n=e.filter(function(e){return oL(e)===t});return n.push.apply(n,Vg(e.filter(function(e){return oL(e)!==t}))),n}var uL={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function cL(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},uL):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};var i=(t.matcher||VN)(n,e,t);if(!i)return Object.assign({},uL);var a={};WN(i.posParams,function(e,t){a[t]=e.path});var o=i.consumed.length>0?Object.assign(Object.assign({},a),i.consumed[i.consumed.length-1].parameters):a;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function lL(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"corrected";if(n.length>0&&function(e,t,n){return n.some(function(n){return hL(e,t,n)&&oL(n)!==DN})}(e,n,r)){var a=new eD(t,function(e,t,n,r){var i={};i[DN]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var a,o=Hg(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(""===s.path&&oL(s)!==DN){var u=new eD([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,i[oL(s)]=u}}}catch(c){o.e(c)}finally{o.f()}return i}(e,t,r,new eD(n,e.children)));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(function(n){return hL(e,t,n)})}(e,n,r)){var o=new eD(e.segments,function(e,t,n,r,i,a){var o,s={},u=Hg(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(hL(e,n,c)&&!i[oL(c)]){var l=new eD([],{});l._sourceSegment=e,l._segmentIndexShift="legacy"===a?e.segments.length:t.length,s[oL(c)]=l}}}catch(h){u.e(h)}finally{u.f()}return Object.assign(Object.assign({},i),s)}(e,t,n,r,e.children,i));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}var s=new eD(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function hL(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function fL(e,t,n,r){return!!(oL(e)===r||r!==DN&&hL(t,n,e))&&("**"===e.path||cL(t,e,n).matched)}function dL(e,t,n){return 0===t.length&&!e.children[n]}var vL=jg(function e(t){Wg(this,e),this.segmentGroup=t||null}),pL=jg(function e(t){Wg(this,e),this.urlTree=t});function gL(e){return new yy(function(t){return t.error(new vL(e))})}function yL(e){return new yy(function(t){return t.error(new pL(e))})}function mL(e){return new yy(function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))})}var kL=function(){function e(t,n,r,i,a){Wg(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=i,this.config=a,this.allowRedirects=!0,this.ngModule=t.get(HO)}return jg(e,[{key:"apply",value:function(){var e=this,t=lL(this.urlTree.root,[],[],this.config).segmentGroup,n=new eD(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,DN).pipe(Sy(function(t){return e.createUrlTree(_L(t),e.urlTree.queryParams,e.urlTree.fragment)})).pipe(hN(function(t){if(t instanceof pL)return e.allowRedirects=!1,e.match(t.urlTree);throw t instanceof vL?e.noMatchError(t):t}))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,DN).pipe(Sy(function(n){return t.createUrlTree(_L(n),e.queryParams,e.fragment)})).pipe(hN(function(e){throw e instanceof vL?t.noMatchError(e):e}))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,t,n){var r=e.segments.length>0?new eD([],Sg({},DN,e)):e;return new JN(r,t,n)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(Sy(function(e){return new eD([],e)})):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){for(var r=this,i=[],a=0,o=Object.keys(n.children);a<o.length;a++){var s=o[a];"primary"===s?i.unshift(s):i.push(s)}return Qy(i).pipe(kM(function(i){var a=n.children[i],o=sL(t,i);return r.expandSegmentGroup(e,o,a,i).pipe(Sy(function(e){return{segment:e,outlet:i}}))}),lN(function(e,t){return e[t.outlet]=t.segment,e},{}),function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?_M(function(t,n){return e(t,n,r)}):gy,fN(1),n?pN(t):dN(function(){return new rN}))}}())}},{key:"expandSegment",value:function(e,t,n,r,i,a){var o=this;return Qy(n).pipe(kM(function(s){return o.expandSegmentAgainstRoute(e,t,n,s,r,i,a).pipe(hN(function(e){if(e instanceof vL)return mM(null);throw e}))}),gN(function(e){return!!e}),hN(function(e,n){if(e instanceof rN||"EmptyError"===e.name){if(dL(t,r,i))return mM(new eD([],{}));throw new vL(t)}throw e}))}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,i,a,o){return fL(r,t,i,a)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,a):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a):gL(t):gL(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,i,a){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,a):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,a)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var i=this,a=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?yL(a):this.lineralizeSegments(n,a).pipe(Hy(function(n){var a=new eD(n,{});return i.expandSegment(e,a,t,n,r,!1)}))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,i,a){var o=this,s=cL(t,r,i),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return gL(t);var f=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?yL(f):this.lineralizeSegments(r,f).pipe(Hy(function(r){return o.expandSegment(e,t,n,r.concat(i.slice(l)),a,!1)}))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r,i){var a=this;if("**"===n.path)return n.loadChildren?(n._loadedConfig?mM(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(Sy(function(e){return n._loadedConfig=e,new eD(r,{})})):mM(new eD(r,{}));var o=cL(t,n,r),s=o.matched,u=o.consumedSegments,c=o.lastChild;if(!s)return gL(t);var l=r.slice(c);return this.getChildConfig(e,n,r).pipe(Hy(function(e){var r=e.module,o=e.routes,s=lL(t,u,l,o),c=s.segmentGroup,h=s.slicedSegments,f=new eD(c.segments,c.children);if(0===h.length&&f.hasChildren())return a.expandChildren(r,o,f).pipe(Sy(function(e){return new eD(u,e)}));if(0===o.length&&0===h.length)return mM(new eD(u,{}));var d=oL(n)===i;return a.expandSegment(r,f,o,h,d?DN:i,!0).pipe(Sy(function(e){return new eD(u.concat(e.segments),e.children)}))}))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?mM(new KD(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?mM(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(Hy(function(n){return n?r.configLoader.load(e.injector,t).pipe(Sy(function(e){return t._loadedConfig=e,e})):(i=t,new yy(function(e){return e.error(BN("Cannot load children because the guard of the route \"path: '".concat(i.path,"'\" returned false")))}));var i})):mM(new KD([],e))}},{key:"runCanLoadGuards",value:function(e,t,n){var r=this,i=t.canLoad;return i&&0!==i.length?mM(i.map(function(r){var i,a,o=e.get(r);if((a=o)&&QD(a.canLoad))i=o.canLoad(t,n);else{if(!QD(o))throw new Error("Invalid CanLoad guard");i=o(t,n)}return qN(i)})).pipe(eL(),yN(function(e){if(XD(e)){var t=BN('Redirecting to "'.concat(r.urlSerializer.serialize(e),'"'));throw t.url=e,t}}),Sy(function(e){return!0===e})):mM(!0)}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return mM(n);if(r.numberOfChildren>1||!r.children[DN])return mL(e.redirectTo);r=r.children[DN]}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var i=this.createSegmentGroup(e,t.root,n,r);return new JN(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return WN(e,function(e,r){if("string"==typeof e&&e.startsWith(":")){var i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var i=this,a=this.createSegments(e,t.segments,n,r),o={};return WN(t.children,function(t,a){o[a]=i.createSegmentGroup(e,t,n,r)}),new eD(a,o)}},{key:"createSegments",value:function(e,t,n,r){var i=this;return t.map(function(t){return t.path.startsWith(":")?i.findPosParam(e,t,r):i.findOrReturn(t,n)})}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,i=Hg(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.path===e.path)return t.splice(r),a;r++}}catch(o){i.e(o)}finally{i.f()}return e}}]),e}();function _L(e){for(var t={},n=0,r=Object.keys(e.children);n<r.length;n++){var i=r[n],a=_L(e.children[i]);(a.segments.length>0||a.hasChildren())&&(t[i]=a)}return function(e){if(1===e.numberOfChildren&&e.children[DN]){var t=e.children[DN];return new eD(e.segments.concat(t.segments),t.children)}return e}(new eD(e.segments,t))}var CL=jg(function e(t){Wg(this,e),this.path=t,this.route=this.path[this.path.length-1]}),wL=jg(function e(t,n){Wg(this,e),this.component=t,this.route=n});function bL(e,t,n){var r=e._root;return SL(r,t?t._root:null,n,[r.value])}function EL(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function SL(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},a=bD(t);return e.children.forEach(function(e){(function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},a=e.value,o=t?t.value:null,s=n?n.getContext(e.value.outlet):null;if(o&&a.routeConfig===o.routeConfig){var u=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!nD(e.url,t.url);case"pathParamsOrQueryParamsChange":return!nD(e.url,t.url)||!zN(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!MD(e,t)||!zN(e.queryParams,t.queryParams);case"paramsChange":default:return!MD(e,t)}}(o,a,a.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new CL(r)):(a.data=o.data,a._resolvedData=o._resolvedData),SL(e,t,a.component?s?s.children:null:n,r,i),u&&s&&s.outlet&&s.outlet.isActivated&&i.canDeactivateChecks.push(new wL(s.outlet.component,o))}else o&&PL(t,s,i),i.canActivateChecks.push(new CL(r)),SL(e,null,a.component?s?s.children:null:n,r,i)})(e,a[e.value.outlet],n,r.concat([e.value]),i),delete a[e.value.outlet]}),WN(a,function(e,t){return PL(e,n.getContext(t),i)}),i}function PL(e,t,n){var r=bD(e),i=e.value;WN(r,function(e,r){PL(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new wL(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}var OL=jg(function e(){Wg(this,e)});function TL(e){return new yy(function(t){return t.error(e)})}var IL=function(){function e(t,n,r,i,a,o){Wg(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=i,this.paramsInheritanceStrategy=a,this.relativeLinkResolution=o}return jg(e,[{key:"recognize",value:function(){var e=lL(this.urlTree.root,[],[],this.config.filter(function(e){return void 0===e.redirectTo}),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,DN);if(null===t)return null;var n=new TD([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},DN,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new wD(n,t),i=new ID(this.url,r);return this.inheritParamsAndData(i._root),i}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=OD(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach(function(e){return t.inheritParamsAndData(e)})}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){for(var n=[],r=0,i=Object.keys(t.children);r<i.length;r++){var a=i[r],o=t.children[a],s=sL(e,a),u=this.processSegmentGroup(s,o,a);if(null===u)return null;n.push.apply(n,Vg(u))}var c=AL(n);return c.sort(function(e,t){return e.value.outlet===DN?-1:t.value.outlet===DN?1:e.value.outlet.localeCompare(t.value.outlet)}),c}},{key:"processSegment",value:function(e,t,n,r){var i,a=Hg(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=this.processSegmentAgainstRoute(o,t,n,r);if(null!==s)return s}}catch(u){a.e(u)}finally{a.f()}return dL(t,n,r)?[]:null}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo||!fL(e,t,n,r))return null;var i,a=[],o=[];if("**"===e.path){var s=n.length>0?$N(n).parameters:{};i=new TD(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ML(e),oL(e),e.component,e,xL(t),RL(t)+n.length,NL(e))}else{var u=cL(t,e,n);if(!u.matched)return null;a=u.consumedSegments,o=n.slice(u.lastChild),i=new TD(a,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ML(e),oL(e),e.component,e,xL(t),RL(t)+a.length,NL(e))}var c,l=(c=e).children?c.children:c.loadChildren?c._loadedConfig.routes:[],h=lL(t,a,o,l.filter(function(e){return void 0===e.redirectTo}),this.relativeLinkResolution),f=h.segmentGroup,d=h.slicedSegments;if(0===d.length&&f.hasChildren()){var v=this.processChildren(l,f);return null===v?null:[new wD(i,v)]}if(0===l.length&&0===d.length)return[new wD(i,[])];var p=oL(e)===r,g=this.processSegment(l,f,d,p?DN:r);return null===g?null:[new wD(i,g)]}}]),e}();function AL(e){var t,n=[],r=new Set,i=Hg(e);try{var a=function(){var e,i=t.value;if(!function(e){var t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}(i))return n.push(i),"continue";var a=n.find(function(e){return i.value.routeConfig===e.value.routeConfig});void 0!==a?((e=a.children).push.apply(e,Vg(i.children)),r.add(a)):n.push(i)};for(i.s();!(t=i.n()).done;)a()}catch(l){i.e(l)}finally{i.f()}var o,s=Hg(r);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=AL(u.children);n.push(new wD(u.value,c))}}catch(l){s.e(l)}finally{s.f()}return n.filter(function(e){return!r.has(e)})}function xL(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function RL(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function ML(e){return e.data||{}}function NL(e){return e.resolve||{}}function DL(e){return uN(function(t){var n=e(t);return n?Qy(n).pipe(Sy(function(){return t})):mM(t)})}var LL=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n)}(function(){function e(){Wg(this,e)}return jg(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}()),FL=new Y_("ROUTES"),UL=function(){function e(t,n,r,i){Wg(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=i}return jg(e,[{key:"load",value:function(e,t){var n=this;if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);var r=this.loadModuleFactory(t.loadChildren).pipe(Sy(function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var i=r.create(e);return new KD(GN(i.injector.get(FL,void 0,bm.Self|bm.Optional)).map(aL),i)}),hN(function(e){throw t._loader$=void 0,e}));return t._loader$=new sN(r,function(){return new _y}).pipe(oN()),t._loader$}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?Qy(this.loader.load(e)):qN(e()).pipe(Hy(function(e){return e instanceof GO?mM(e):Qy(t.compiler.compileModuleAsync(e))}))}}]),e}(),BL=jg(function e(){Wg(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new VL,this.attachRef=null}),VL=function(){function e(){Wg(this,e),this.contexts=new Map}return jg(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new BL,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),zL=function(){function e(){Wg(this,e)}return jg(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function HL(e){throw e}function GL(e,t,n){return t.parse("/")}function $L(e,t){return mM(null)}var WL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},qL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jL=function(){var e=function(){function e(t,n,r,i,a,o,s,u){var c=this;Wg(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=i,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new _y,this.errorHandler=HL,this.malformedUriErrorHandler=GL,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:$L,afterPreactivation:$L},this.urlHandlingStrategy=new zL,this.routeReuseStrategy=new LL,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=a.get(HO),this.console=a.get(zT);var l=a.get(eI);this.isNgZoneEnabled=l instanceof eI&&eI.isInAngularZone(),this.resetConfig(u),this.currentUrlTree=new JN(new eD([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new UL(o,s,function(e){return c.triggerEvent(new TN(e))},function(e){return c.triggerEvent(new IN(e))}),this.routerState=SD(this.currentUrlTree,this.rootComponentType),this.transitions=new tN({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return jg(e,[{key:"browserPageId",get:function(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}},{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(_M(function(e){return 0!==e.id}),Sy(function(e){return Object.assign(Object.assign({},e),{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})}),uN(function(e){var r=!1,i=!1;return mM(e).pipe(yN(function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign(Object.assign({},t.lastSuccessfulNavigation),{previousNavigation:null}):null}}),uN(function(e){var r=t.browserUrlTree.toString(),a=!t.navigated||e.extractedUrl.toString()!==r||r!==t.currentUrlTree.toString();if(("reload"===t.onSameUrlNavigation||a)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return ZL(e.source)&&(t.browserUrlTree=e.extractedUrl),mM(e).pipe(uN(function(e){var r=t.transitions.getValue();return n.next(new kN(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?$y:Promise.resolve(e)}),function(e,t,n,r){return uN(function(i){return function(e,t,n,r,i){return new kL(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(Sy(function(e){return Object.assign(Object.assign({},i),{urlAfterRedirects:e})}))})}(t.ngModule.injector,t.configLoader,t.urlSerializer,t.config),yN(function(e){t.currentNavigation=Object.assign(Object.assign({},t.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,n,r,a,o){return Hy(function(r){return function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";try{var s=new IL(e,t,n,r,a,o).recognize();return null===s?TL(new OL):mM(s)}catch(i){return TL(i)}}(e,n,r.urlAfterRedirects,(s=r.urlAfterRedirects,t.serializeUrl(s)),a,o).pipe(Sy(function(e){return Object.assign(Object.assign({},r),{targetSnapshot:e})}));var s})}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),yN(function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,e),t.browserUrlTree=e.urlAfterRedirects);var r=new bN(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)}));if(a&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var o=e.id,s=e.extractedUrl,u=e.source,c=e.restoredState,l=e.extras,h=new kN(o,t.serializeUrl(s),u,c);n.next(h);var f=SD(s,t.rootComponentType).snapshot;return mM(Object.assign(Object.assign({},e),{targetSnapshot:f,urlAfterRedirects:s,extras:Object.assign(Object.assign({},l),{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),$y}),DL(function(e){var n=e.targetSnapshot,r=e.id,i=e.extractedUrl,a=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:i,rawUrlTree:a,skipLocationChange:!!s,replaceUrl:!!u})}),yN(function(e){var n=new EN(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),Sy(function(e){return Object.assign(Object.assign({},e),{guards:bL(e.targetSnapshot,e.currentSnapshot,t.rootContexts)})}),function(e,t){return Hy(function(n){var r=n.targetSnapshot,i=n.currentSnapshot,a=n.guards,o=a.canActivateChecks,s=a.canDeactivateChecks;return 0===s.length&&0===o.length?mM(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return Qy(e).pipe(Hy(function(e){return function(e,t,n,r,i){var a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?mM(a.map(function(a){var o,s=EL(a,t,i);if(function(e){return e&&QD(e.canDeactivate)}(s))o=qN(s.canDeactivate(e,t,n,r));else{if(!QD(s))throw new Error("Invalid CanDeactivate guard");o=qN(s(e,t,n,r))}return o.pipe(gN())})).pipe(eL()):mM(!0)}(e.component,e.route,n,t,r)}),gN(function(e){return!0!==e},!0))}(s,r,i,e).pipe(Hy(function(n){return n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return Qy(t).pipe(kM(function(t){return iN(function(e,t){return null!==e&&t&&t(new AN(e)),mM(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new RN(e)),mM(!0)}(t.route,r),function(e,t,n){var r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)}).filter(function(e){return null!==e}).map(function(t){return aN(function(){return mM(t.guards.map(function(i){var a,o=EL(i,t.node,n);if(function(e){return e&&QD(e.canActivateChild)}(o))a=qN(o.canActivateChild(r,e));else{if(!QD(o))throw new Error("Invalid CanActivateChild guard");a=qN(o(r,e))}return a.pipe(gN())})).pipe(eL())})});return mM(i).pipe(eL())}(e,t.path,n),function(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?mM(r.map(function(r){return aN(function(){var i,a=EL(r,t,n);if(function(e){return e&&QD(e.canActivate)}(a))i=qN(a.canActivate(t,e));else{if(!QD(a))throw new Error("Invalid CanActivate guard");i=qN(a(t,e))}return i.pipe(gN())})})).pipe(eL()):mM(!0)}(e,t.route,n))}),gN(function(e){return!0!==e},!0))}(r,o,e,t):mM(n)}),Sy(function(e){return Object.assign(Object.assign({},n),{guardsResult:e})}))})}(t.ngModule.injector,function(e){return t.triggerEvent(e)}),yN(function(e){if(XD(e.guardsResult)){var n=BN('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}var r=new SN(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(r)}),_M(function(e){return!!e.guardsResult||(t.restoreHistory(e),t.cancelNavigationTransition(e,""),!1)}),DL(function(e){if(e.guards.canActivateChecks.length)return mM(e).pipe(yN(function(e){var n=new PN(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),uN(function(e){var n=!1;return mM(e).pipe(function(e,t){return Hy(function(n){var r=n.targetSnapshot,i=n.guards.canActivateChecks;if(!i.length)return mM(n);var a=0;return Qy(i).pipe(kM(function(n){return function(e,t,n,r){return function(e,t,n,r){var i=Object.keys(e);if(0===i.length)return mM({});var a={};return Qy(i).pipe(Hy(function(i){return function(e,t,n,r){var i=EL(e,t,r);return qN(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(yN(function(e){a[i]=e}))}),fN(1),Hy(function(){return Object.keys(a).length===i.length?mM(a):$y}))}(e._resolve,e,t,r).pipe(Sy(function(t){return e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),OD(e,n).resolve),null}))}(n.route,r,e,t)}),yN(function(){return a++}),fN(1),Hy(function(e){return a===i.length?mM(n):$y}))})}(t.paramsInheritanceStrategy,t.ngModule.injector),yN({next:function(){return n=!0},complete:function(){n||(t.restoreHistory(e),t.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),yN(function(e){var n=new ON(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}))}),DL(function(e){var n=e.targetSnapshot,r=e.id,i=e.extractedUrl,a=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:i,rawUrlTree:a,skipLocationChange:!!s,replaceUrl:!!u})}),Sy(function(e){var n=function(e,t,n){var r=ND(e,t._root,n?n._root:void 0);return new ED(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:n})}),yN(function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,e),t.browserUrlTree=e.urlAfterRedirects)}),function(e,t,n){return Sy(function(r){return new ZD(t,r.targetRouterState,r.currentRouterState,n).activate(e),r})}(t.rootContexts,t.routeReuseStrategy,function(e){return t.triggerEvent(e)}),yN({next:function(){r=!0},complete:function(){r=!0}}),function(e){return by(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}(function(){var n;if(!r&&!i){var a="Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId);"replace"===t.canceledNavigationResolution?(t.restoreHistory(e),t.cancelNavigationTransition(e,a)):t.cancelNavigationTransition(e,a)}(null===(n=t.currentNavigation)||void 0===n?void 0:n.id)===e.id&&(t.currentNavigation=null)}),hN(function(r){if(i=!0,function(e){return e&&e[UN]}(r)){var a=XD(r.url);a||(t.navigated=!0,t.restoreHistory(e,!0));var o=new CN(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(o),a?setTimeout(function(){var n=t.urlHandlingStrategy.merge(r.url,t.rawUrlTree),i={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||ZL(e.source)};t.scheduleNavigation(n,"imperative",null,i,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{t.restoreHistory(e,!0);var s=new wN(e.id,t.serializeUrl(e.extractedUrl),r);n.next(s);try{e.resolve(t.errorHandler(r))}catch(o){e.reject(o)}}return $y}))}))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(t){var n=e.extractLocationChangeInfoFromEvent(t);e.shouldScheduleNavigation(e.lastLocationChangeInfo,n)&&setTimeout(function(){var t=n.source,r=n.state,i=n.urlTree,a={replaceUrl:!0};if(r){var o=Object.assign({},r);delete o.navigationId,delete o.\u0275routerPageId,0!==Object.keys(o).length&&(a.state=o)}e.scheduleNavigation(i,t,r,a)},0),e.lastLocationChangeInfo=n}))}},{key:"extractLocationChangeInfoFromEvent",value:function(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}},{key:"shouldScheduleNavigation",value:function(e,t){if(!e)return!0;var n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){nL(e),this.config=e.map(aL),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,i=t.fragment,a=t.queryParamsHandling,o=t.preserveFragment,s=n||this.routerState.root,u=o?this.currentUrlTree.fragment:i,c=null;switch(a){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return UD(t.root,t.root,t,r,i);var a=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new VD(!0,0,e);var t=0,n=!1,r=e.reduce(function(e,r,i){if("object"==typeof r&&null!=r){if(r.outlets){var a={};return WN(r.outlets,function(e,t){a[t]="string"==typeof e?e.split("/"):e}),[].concat(Vg(e),[{outlets:a}])}if(r.segmentPath)return[].concat(Vg(e),[r.segmentPath])}return"string"!=typeof r?[].concat(Vg(e),[r]):0===i?(r.split("/").forEach(function(r,i){0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[].concat(Vg(e),[r])},[]);return new VD(n,t,r)}(n);if(a.toRoot())return UD(t.root,new eD([],{}),t,r,i);var o=function(e,t,n){if(e.isAbsolute)return new zD(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){var r=n.snapshot._urlSegment;return new zD(r,r===t.root,0)}var i=LD(e.commands[0])?0:1;return function(e,t,n){for(var r=e,i=t,a=n;a>i;){if(a-=i,!(r=r.parent))throw new Error("Invalid number of '../'");i=r.segments.length}return new zD(r,!1,i-a)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,e.numberOfDoubleDots)}(a,t,e),s=o.processChildren?GD(o.segmentGroup,o.index,a.commands):HD(o.segmentGroup,o.index,a.commands);return UD(o.segmentGroup,s,t,r,i)}(s,this.currentUrlTree,e,c,null!=u?u:null)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1},n=XD(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){var n;if(n=!0===t?Object.assign({},WL):!1===t?Object.assign({},qL):t,XD(e))return YN(this.currentUrlTree,e,n);var r=this.parseUrl(e);return YN(this.currentUrlTree,r,n)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce(function(t,n){var r=e[n];return null!=r&&(t[n]=r),t},{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe(function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.currentPageId=t.targetPageId,e.events.next(new _N(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,t.resolve(!0)},function(t){e.console.warn("Unhandled Navigation Error: ".concat(t))})}},{key:"scheduleNavigation",value:function(e,t,n,r,i){var a,o;if(this.disposed)return Promise.resolve(!1);var s,u,c,l=this.getTransition(),h=ZL(t)&&l&&!ZL(l.source),f=(this.lastSuccessfulId===l.id||this.currentNavigation?l.rawUrl:l.urlAfterRedirects).toString()===e.toString();if(h&&f)return Promise.resolve(!0);i?(s=i.resolve,u=i.reject,c=i.promise):c=new Promise(function(e,t){s=e,u=t});var d,v=++this.navigationId;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),d=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(a=this.browserPageId)&&void 0!==a?a:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):d=0,this.setTransition({id:v,targetPageId:d,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(function(e){return Promise.reject(e)})}},{key:"setBrowserUrl",value:function(e,t){var n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}},{key:"restoreHistory",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("computed"===this.canceledNavigationResolution){var i=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(t=this.currentNavigation)||void 0===t?void 0:t.finalUrl)||0===i?this.currentUrlTree===(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)&&0===i&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(i)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}},{key:"resetState",value:function(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}},{key:"cancelNavigationTransition",value:function(e,t){var n=new CN(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}},{key:"generateNgRouterState",value:function(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(Q_),pC(rD),pC(VL),pC(qI),pC(IE),pC(CI),pC(QT),pC(void 0))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function ZL(e){return"imperative"!==e}var YL=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.router=t,this.route=n,this.commands=[],this.onChanges=new _y,null==r&&i.setAttribute(a.nativeElement,"tabindex","0")}return jg(e,[{key:"ngOnChanges",value:function(e){this.onChanges.next(this)}},{key:"routerLink",set:function(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}},{key:"onClick",value:function(){var e={skipLocationChange:QL(this.skipLocationChange),replaceUrl:QL(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}},{key:"urlTree",get:function(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:QL(this.preserveFragment)})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL),QE(PD),q_("tabindex"),QE(hO),QE(uO))},e.\u0275dir=Ym({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&uS("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[uk]}),e}(),KL=function(){var e=function(){function e(t,n,r){var i=this;Wg(this,e),this.router=t,this.route=n,this.locationStrategy=r,this.commands=[],this.onChanges=new _y,this.subscription=t.events.subscribe(function(e){e instanceof _N&&i.updateTargetUrlAndHref()})}return jg(e,[{key:"routerLink",set:function(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}},{key:"ngOnChanges",value:function(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"onClick",value:function(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;var a={skipLocationChange:QL(this.skipLocationChange),replaceUrl:QL(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,a),!1}},{key:"updateTargetUrlAndHref",value:function(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}},{key:"urlTree",get:function(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:QL(this.preserveFragment)})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL),QE(PD),QE(zI))},e.\u0275dir=Ym({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&uS("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(HS("href",t.href,uw),$E("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[uk]}),e}();function QL(e){return""===e||!!e}var XL=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=a,this.activated=null,this._activatedRoute=null,this.activateEvents=new gT,this.deactivateEvents=new gT,this.name=i||DN,t.onChildOutletCreated(this.name,this)}return jg(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new JL(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(VL),QE(WO),QE(iO),q_("name"),QE(NO))},e.\u0275dir=Ym({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e}(),JL=function(){function e(t,n,r){Wg(this,e),this.route=t,this.childContexts=n,this.parent=r}return jg(e,[{key:"get",value:function(e,t){return e===PD?this.route:e===VL?this.childContexts:this.parent.get(e,t)}}]),e}(),eF=jg(function e(){Wg(this,e)}),tF=function(){function e(){Wg(this,e)}return jg(e,[{key:"preload",value:function(e,t){return mM(null)}}]),e}(),nF=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.router=t,this.injector=i,this.preloadingStrategy=a,this.loader=new UL(n,r,function(e){return t.triggerEvent(new TN(e))},function(e){return t.triggerEvent(new IN(e))})}return jg(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(_M(function(e){return e instanceof _N}),kM(function(){return e.preload()})).subscribe(function(){})}},{key:"preload",value:function(){var e=this.injector.get(HO);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],i=Hg(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.loadChildren&&!a.canLoad&&a._loadedConfig){var o=a._loadedConfig;r.push(this.processRoutes(o.module,o.routes))}else a.loadChildren&&!a.canLoad?r.push(this.preloadConfig(e,a)):a.children&&r.push(this.processRoutes(e,a.children))}}catch(s){i.e(s)}finally{i.f()}return Qy(r).pipe(Gy(),Sy(function(e){}))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,function(){return(t._loadedConfig?mM(t._loadedConfig):n.loader.load(e.injector,t)).pipe(Hy(function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)}))})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(jL),pC(CI),pC(QT),pC(IE),pC(eF))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),rF=function(){var e=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Wg(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return jg(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe(function(t){t instanceof kN?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof _N&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))})}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe(function(t){t instanceof NN&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))})}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new NN(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(jL),pC(GA),pC(void 0))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),iF=new Y_("ROUTER_CONFIGURATION"),aF=new Y_("ROUTER_FORROOT_GUARD"),oF=[qI,{provide:rD,useClass:iD},{provide:jL,useFactory:function(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,l=new jL(null,e,t,n,r,i,a,GN(o));return u&&(l.urlHandlingStrategy=u),c&&(l.routeReuseStrategy=c),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(s,l),s.enableTracing&&l.events.subscribe(function(e){var t,n;null===(t=console.group)||void 0===t||t.call(console,"Router Event: ".concat(e.constructor.name)),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),l},deps:[rD,VL,qI,IE,CI,QT,FL,iF,[function(){return jg(function e(){Wg(this,e)})}(),new bC],[function(){return jg(function e(){Wg(this,e)})}(),new bC]]},VL,{provide:PD,useFactory:function(e){return e.routerState.root},deps:[jL]},{provide:CI,useClass:EI},nF,tF,function(){function e(){Wg(this,e)}return jg(e,[{key:"preload",value:function(e,t){return t().pipe(hN(function(){return mM(null)}))}}]),e}(),{provide:iF,useValue:{enableTracing:!1}}];function sF(){return new vI("Router",jL)}var uF=function(){var e=function(){function e(t,n){Wg(this,e)}return jg(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[oF,fF(t),{provide:aF,useFactory:hF,deps:[[jL,new bC,new EC]]},{provide:iF,useValue:n||{}},{provide:zI,useFactory:lF,deps:[RI,[new wC(GI),new bC],iF]},{provide:rF,useFactory:cF,deps:[jL,GA,iF]},{provide:eF,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:tF},{provide:vI,multi:!0,useFactory:sF},[dF,{provide:MT,multi:!0,useFactory:vF,deps:[dF]},{provide:gF,useFactory:pF,deps:[dF]},{provide:VT,multi:!0,useExisting:gF}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[fF(t)]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(aF,8),pC(jL,8))},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({}),e}();function cF(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new rF(e,t,n)}function lF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new WI(e,t):new $I(e,t)}function hF(e){return"guarded"}function fF(e){return[{provide:K_,multi:!0,useValue:e},{provide:FL,multi:!0,useValue:e}]}var dF=function(){var e=function(){function e(t){Wg(this,e),this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new _y}return jg(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(NI,Promise.resolve(null)).then(function(){if(e.destroyed)return Promise.resolve(!0);var t=null,n=new Promise(function(e){return t=e}),r=e.injector.get(jL),i=e.injector.get(iF);return"disabled"===i.initialNavigation?(r.setUpLocationChangeListener(),t(!0)):"enabled"===i.initialNavigation||"enabledBlocking"===i.initialNavigation?(r.hooks.afterPreactivation=function(){return e.initNavigation?mM(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()):t(!0),n})}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(iF),n=this.injector.get(nF),r=this.injector.get(rF),i=this.injector.get(jL),a=this.injector.get(kI);e===a.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"ngOnDestroy",value:function(){this.destroyed=!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(IE))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}();function vF(e){return e.appInitializer.bind(e)}function pF(e){return e.bootstrapListener.bind(e)}var gF=new Y_("Router Initializer"),yF=jg(function e(){Wg(this,e)}),mF="*";function kF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:2,steps:e,options:t}}function _F(e){return{type:6,styles:e,offset:null}}function CF(e){Promise.resolve(null).then(e)}var wF=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Wg(this,e),this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+n}return jg(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach(function(e){return e()}),this._onDoneFns=[])}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){}},{key:"play",value:function(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}},{key:"triggerMicrotask",value:function(){var e=this;CF(function(){return e._onFinish()})}},{key:"_onStart",value:function(){this._onStartFns.forEach(function(e){return e()}),this._onStartFns=[]}},{key:"pause",value:function(){}},{key:"restart",value:function(){}},{key:"finish",value:function(){this._onFinish()}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(function(e){return e()}),this._onDestroyFns=[])}},{key:"reset",value:function(){this._started=!1}},{key:"setPosition",value:function(e){this._position=this.totalTime?e*this.totalTime:1}},{key:"getPosition",value:function(){return this.totalTime?this._position/this.totalTime:1}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(function(e){return e()}),t.length=0}}]),e}(),bF=function(){function e(t){var n=this;Wg(this,e),this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;var r=0,i=0,a=0,o=this.players.length;0==o?CF(function(){return n._onFinish()}):this.players.forEach(function(e){e.onDone(function(){++r==o&&n._onFinish()}),e.onDestroy(function(){++i==o&&n._onDestroy()}),e.onStart(function(){++a==o&&n._onStart()})}),this.totalTime=this.players.reduce(function(e,t){return Math.max(e,t.totalTime)},0)}return jg(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach(function(e){return e()}),this._onDoneFns=[])}},{key:"init",value:function(){this.players.forEach(function(e){return e.init()})}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"_onStart",value:function(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(function(e){return e()}),this._onStartFns=[])}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(function(e){return e.play()})}},{key:"pause",value:function(){this.players.forEach(function(e){return e.pause()})}},{key:"restart",value:function(){this.players.forEach(function(e){return e.restart()})}},{key:"finish",value:function(){this._onFinish(),this.players.forEach(function(e){return e.finish()})}},{key:"destroy",value:function(){this._onDestroy()}},{key:"_onDestroy",value:function(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(function(e){return e.destroy()}),this._onDestroyFns.forEach(function(e){return e()}),this._onDestroyFns=[])}},{key:"reset",value:function(){this.players.forEach(function(e){return e.reset()}),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"setPosition",value:function(e){var t=e*this.totalTime;this.players.forEach(function(e){var n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}},{key:"getPosition",value:function(){var e=this.players.reduce(function(e,t){return null===e||t.totalTime>e.totalTime?t:e},null);return null!=e?e.getPosition():0}},{key:"beforeDestroy",value:function(){this.players.forEach(function(e){e.beforeDestroy&&e.beforeDestroy()})}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(function(e){return e()}),t.length=0}}]),e}();function EF(){return"undefined"!=typeof window&&void 0!==window.document}function SF(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function PF(e){switch(e.length){case 0:return new wF;case 1:return e[0];default:return new bF(e)}}function OF(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=[],s=[],u=-1,c=null;if(r.forEach(function(e){var n=e.offset,r=n==u,l=r&&c||{};Object.keys(e).forEach(function(n){var r=n,s=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),s){case"!":s=i[n];break;case mF:s=a[n];break;default:s=t.normalizeStyleValue(n,r,s,o)}l[r]=s}),r||s.push(l),c=l,u=n}),o.length){var l="\n - ";throw new Error("Unable to animate due to the following errors:".concat(l).concat(o.join(l)))}return s}function TF(e,t,n,r){switch(t){case"start":e.onStart(function(){return r(n&&IF(n,"start",e))});break;case"done":e.onDone(function(){return r(n&&IF(n,"done",e))});break;case"destroy":e.onDestroy(function(){return r(n&&IF(n,"destroy",e))})}}function IF(e,t,n){var r,i=AF(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,null!==(r=n.totalTime)&&void 0!==r?r:e.totalTime,!!n.disabled),a=e._data;return null!=a&&(i._data=a),i}function AF(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6?arguments[6]:void 0;return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:a,disabled:!!o}}function xF(e,t,n){var r;return e instanceof Map?(r=e.get(t))||e.set(t,r=n):(r=e[t])||(r=e[t]=n),r}function RF(e){var t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}var MF=function(e,t){return!1},NF=function(e,t){return!1},DF=function(e,t,n){return[]},LF=SF();(LF||"undefined"!=typeof Element)&&(MF=EF()?function(e,t){for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:function(e,t){return e.contains(t)},NF=function(){if(LF||Element.prototype.matches)return function(e,t){return e.matches(t)};var e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?function(e,n){return t.apply(e,[n])}:NF}(),DF=function(e,t,n){var r=[];if(n)for(var i=e.querySelectorAll(t),a=0;a<i.length;a++)r.push(i[a]);else{var o=e.querySelector(t);o&&r.push(o)}return r});var FF=null,UF=!1;function BF(e){FF||(FF=("undefined"!=typeof document?document.body:null)||{},UF=!!FF.style&&"WebkitAppearance"in FF.style);var t=!0;return FF.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(!(t=e in FF.style)&&UF&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in FF.style)),t}var VF=NF,zF=MF,HF=DF;function GF(e){var t={};return Object.keys(e).forEach(function(n){var r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}var $F=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"validateStyleProperty",value:function(e){return BF(e)}},{key:"matchesElement",value:function(e,t){return VF(e,t)}},{key:"containsElement",value:function(e,t){return zF(e,t)}},{key:"query",value:function(e,t,n){return HF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return n||""}},{key:"animate",value:function(e,t,n,r,i){return new wF(n,r)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),WF=function(){var e=jg(function e(){Wg(this,e)});return e.NOOP=new $F,e}(),qF="ng-enter",jF="ng-leave",ZF="ng-trigger",YF=".ng-trigger",KF="ng-animating",QF=".ng-animating";function XF(e){if("number"==typeof e)return e;var t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:JF(parseFloat(t[1]),t[2])}function JF(e,t){switch(t){case"s":return 1e3*e;default:return e}}function eU(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){var r,i=0,a="";if("string"==typeof e){var o=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===o)return t.push('The provided timing value "'.concat(e,'" is invalid.')),{duration:0,delay:0,easing:""};r=JF(parseFloat(o[1]),o[2]);var s=o[3];null!=s&&(i=JF(parseFloat(s),o[4]));var u=o[5];u&&(a=u)}else r=e;if(!n){var c=!1,l=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),c=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),c=!0),c&&t.splice(l,0,'The provided timing value "'.concat(e,'" is invalid.'))}return{duration:r,delay:i,easing:a}}(e,t,n)}function tU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t}function nU(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)for(var r in e)n[r]=e[r];else tU(e,n);return n}function rU(e,t,n){return n?t+":"+n+";":""}function iU(e){for(var t="",n=0;n<e.style.length;n++){var r=e.style.item(n);t+=rU(0,r,e.style.getPropertyValue(r))}for(var i in e.style)e.style.hasOwnProperty(i)&&!i.startsWith("_")&&(t+=rU(0,vU(i),e.style[i]));e.setAttribute("style",t)}function aU(e,t,n){e.style&&(Object.keys(t).forEach(function(r){var i=dU(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),SF()&&iU(e))}function oU(e,t){e.style&&(Object.keys(t).forEach(function(t){var n=dU(t);e.style[n]=""}),SF()&&iU(e))}function sU(e){return Array.isArray(e)?1==e.length?e[0]:kF(e):e}var uU=new RegExp("{{\\s*(.+?)\\s*}}","g");function cU(e){var t=[];if("string"==typeof e){for(var n;n=uU.exec(e);)t.push(n[1]);uU.lastIndex=0}return t}function lU(e,t,n){var r=e.toString(),i=r.replace(uU,function(e,r){var i=t[r];return t.hasOwnProperty(r)||(n.push("Please provide a value for the animation param ".concat(r)),i=""),i.toString()});return i==r?e:i}function hU(e){for(var t=[],n=e.next();!n.done;)t.push(n.value),n=e.next();return t}var fU=/-+([a-z0-9])/g;function dU(e){return e.replace(fU,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[1].toUpperCase()})}function vU(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function pU(e,t){return 0===e||0===t}function gU(e,t,n){var r=Object.keys(n);if(r.length&&t.length){var i=t[0],a=[];if(r.forEach(function(e){i.hasOwnProperty(e)||a.push(e),i[e]=n[e]}),a.length)for(var o=function(){var n=t[s];a.forEach(function(t){n[t]=mU(e,t)})},s=1;s<t.length;s++)o()}return t}function yU(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error("Unable to resolve animation metadata node #".concat(t.type))}}function mU(e,t){return window.getComputedStyle(e)[t]}function kU(e,t){var n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(function(e){return function(e,t,n){if(":"==e[0]){var r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return function(e,t){return parseFloat(t)>parseFloat(e)};case":decrement":return function(e,t){return parseFloat(t)<parseFloat(e)};default:return t.push('The transition alias value "'.concat(e,'" is not supported')),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}var i=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return n.push('The provided transition expression "'.concat(e,'" is not supported')),t;var a=i[1],o=i[2],s=i[3];t.push(wU(a,s)),"<"==o[0]&&("*"!=a||"*"!=s)&&t.push(wU(s,a))}(e,n,t)}):n.push(e),n}var _U=new Set(["true","1"]),CU=new Set(["false","0"]);function wU(e,t){var n=_U.has(e)||CU.has(e),r=_U.has(t)||CU.has(t);return function(i,a){var o="*"==e||e==i,s="*"==t||t==a;return!o&&n&&"boolean"==typeof i&&(o=i?_U.has(e):CU.has(e)),!s&&r&&"boolean"==typeof a&&(s=a?_U.has(t):CU.has(t)),o&&s}}var bU=new RegExp("s*:selfs*,?","g");function EU(e,t,n){return new SU(e).build(t,n)}var SU=function(){function e(t){Wg(this,e),this._driver=t}return jg(e,[{key:"build",value:function(e,t){var n=new PU(t);return this._resetContextStyleTimingState(n),yU(this,sU(e),n)}},{key:"_resetContextStyleTimingState",value:function(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}},{key:"visitTrigger",value:function(e,t){var n=this,r=t.queryCount=0,i=t.depCount=0,a=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(function(e){if(n._resetContextStyleTimingState(t),0==e.type){var s=e,u=s.name;u.toString().split(/\s*,\s*/).forEach(function(e){s.name=e,a.push(n.visitState(s,t))}),s.name=u}else if(1==e.type){var c=n.visitTransition(e,t);r+=c.queryCount,i+=c.depCount,o.push(c)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:a,transitions:o,queryCount:r,depCount:i,options:null}}},{key:"visitState",value:function(e,t){var n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){var i=new Set,a=r||{};if(n.styles.forEach(function(e){if(OU(e)){var t=e;Object.keys(t).forEach(function(e){cU(t[e]).forEach(function(e){a.hasOwnProperty(e)||i.add(e)})})}}),i.size){var o=hU(i.values());t.errors.push('state("'.concat(e.name,'", ...) must define default values for all the following style substitutions: ').concat(o.join(", ")))}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}},{key:"visitTransition",value:function(e,t){t.queryCount=0,t.depCount=0;var n=yU(this,sU(e.animation),t);return{type:1,matchers:kU(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:TU(e.options)}}},{key:"visitSequence",value:function(e,t){var n=this;return{type:2,steps:e.steps.map(function(e){return yU(n,e,t)}),options:TU(e.options)}}},{key:"visitGroup",value:function(e,t){var n=this,r=t.currentTime,i=0,a=e.steps.map(function(e){t.currentTime=r;var a=yU(n,e,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:3,steps:a,options:TU(e.options)}}},{key:"visitAnimate",value:function(e,t){var n=function(e,t){var n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return IU(eU(e,t).duration,0,"");var r=e;if(r.split(/\s+/).some(function(e){return"{"==e.charAt(0)&&"{"==e.charAt(1)})){var i=IU(0,0,"");return i.dynamic=!0,i.strValue=r,i}return IU((n=n||eU(r,t)).duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;var r,i=e.styles?e.styles:_F({});if(5==i.type)r=this.visitKeyframes(i,t);else{var a=e.styles,o=!1;if(!a){o=!0;var s={};n.easing&&(s.easing=n.easing),a=_F(s)}t.currentTime+=n.duration+n.delay;var u=this.visitStyle(a,t);u.isEmptyStep=o,r=u}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}},{key:"visitStyle",value:function(e,t){var n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}},{key:"_makeStyleAst",value:function(e,t){var n=[];Array.isArray(e.styles)?e.styles.forEach(function(e){"string"==typeof e?e==mF?n.push(e):t.errors.push("The provided style string value ".concat(e," is not allowed.")):n.push(e)}):n.push(e.styles);var r=!1,i=null;return n.forEach(function(e){if(OU(e)){var t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(var a in t)if(t[a].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}},{key:"_validateStyleAst",value:function(e,t){var n=this,r=t.currentAnimateTimings,i=t.currentTime,a=t.currentTime;r&&a>0&&(a-=r.duration+r.delay),e.styles.forEach(function(e){"string"!=typeof e&&Object.keys(e).forEach(function(r){if(n._driver.validateStyleProperty(r)){var o=t.collectedStyles[t.currentQuerySelector],s=o[r],u=!0;s&&(a!=i&&a>=s.startTime&&i<=s.endTime&&(t.errors.push('The CSS property "'.concat(r,'" that exists between the times of "').concat(s.startTime,'ms" and "').concat(s.endTime,'ms" is also being animated in a parallel animation between the times of "').concat(a,'ms" and "').concat(i,'ms"')),u=!1),a=s.startTime),u&&(o[r]={startTime:a,endTime:i}),t.options&&function(e,t,n){var r=t.params||{},i=cU(e);i.length&&i.forEach(function(e){r.hasOwnProperty(e)||n.push("Unable to resolve the local animation param ".concat(e," in the given list of values"))})}(e[r],t.options,t.errors)}else t.errors.push('The provided animation property "'.concat(r,'" is not a supported CSS property for animations'))})})}},{key:"visitKeyframes",value:function(e,t){var n=this,r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),r;var i=0,a=[],o=!1,s=!1,u=0,c=e.steps.map(function(e){var r=n._makeStyleAst(e,t),c=null!=r.offset?r.offset:function(e){if("string"==typeof e)return null;var t=null;if(Array.isArray(e))e.forEach(function(e){if(OU(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}});else if(OU(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}return t}(r.styles),l=0;return null!=c&&(i++,l=r.offset=c),s=s||l<0||l>1,o=o||l<u,u=l,a.push(l),r});s&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),o&&t.errors.push("Please ensure that all keyframe offsets are in order");var l=e.steps.length,h=0;i>0&&i<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==i&&(h=1/(l-1));var f=l-1,d=t.currentTime,v=t.currentAnimateTimings,p=v.duration;return c.forEach(function(e,i){var o=h>0?i==f?1:h*i:a[i],s=o*p;t.currentTime=d+v.delay+s,v.duration=s,n._validateStyleAst(e,t),e.offset=o,r.styles.push(e)}),r}},{key:"visitReference",value:function(e,t){return{type:8,animation:yU(this,sU(e.animation),t),options:TU(e.options)}}},{key:"visitAnimateChild",value:function(e,t){return t.depCount++,{type:9,options:TU(e.options)}}},{key:"visitAnimateRef",value:function(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:TU(e.options)}}},{key:"visitQuery",value:function(e,t){var n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;var i=Pg(function(e){var t=!!e.split(/\s*,\s*/).find(function(e){return":self"==e});return t&&(e=e.replace(bU,"")),[e=e.replace(/@\*/g,YF).replace(/@\w+/g,function(e){return YF+"-"+e.substr(1)}).replace(/:animating/g,QF),t]}(e.selector),2),a=i[0],o=i[1];t.currentQuerySelector=n.length?n+" "+a:a,xF(t.collectedStyles,t.currentQuerySelector,{});var s=yU(this,sU(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:s,originalSelector:e.selector,options:TU(e.options)}}},{key:"visitStagger",value:function(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");var n="full"===e.timings?{duration:0,delay:0,easing:"full"}:eU(e.timings,t.errors,!0);return{type:12,animation:yU(this,sU(e.animation),t),timings:n,options:null}}}]),e}(),PU=jg(function e(t){Wg(this,e),this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null});function OU(e){return!Array.isArray(e)&&"object"==typeof e}function TU(e){return e?(e=tU(e)).params&&(e.params=function(e){return e?tU(e):null}(e.params)):e={},e}function IU(e,t,n){return{duration:e,delay:t,easing:n}}function AU(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:a,totalTime:i+a,easing:o,subTimeline:s}}var xU=function(){function e(){Wg(this,e),this._map=new Map}return jg(e,[{key:"consume",value:function(e){var t=this._map.get(e);return t?this._map.delete(e):t=[],t}},{key:"append",value:function(e,t){var n,r=this._map.get(e);r||this._map.set(e,r=[]),(n=r).push.apply(n,Vg(t))}},{key:"has",value:function(e){return this._map.has(e)}},{key:"clear",value:function(){this._map.clear()}}]),e}(),RU=new RegExp(":enter","g"),MU=new RegExp(":leave","g");function NU(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];return(new DU).buildKeyframes(e,t,n,r,i,a,o,s,u,c)}var DU=function(){function e(){Wg(this,e)}return jg(e,[{key:"buildKeyframes",value:function(e,t,n,r,i,a,o,s,u){var c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];u=u||new xU;var l=new FU(e,t,u,r,i,c,[]);l.options=s,l.currentTimeline.setStyles([a],null,l.errors,s),yU(this,n,l);var h=l.timelines.filter(function(e){return e.containsAnimation()});if(h.length&&Object.keys(o).length){var f=h[h.length-1];f.allowOnlyTimelineStyles()||f.setStyles([o],null,l.errors,s)}return h.length?h.map(function(e){return e.buildKeyframes()}):[AU(t,[],[],[],0,0,"",!1)]}},{key:"visitTrigger",value:function(e,t){}},{key:"visitState",value:function(e,t){}},{key:"visitTransition",value:function(e,t){}},{key:"visitAnimateChild",value:function(e,t){var n=t.subInstructions.consume(t.element);if(n){var r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,a=this._visitSubInstructions(n,r,r.options);i!=a&&t.transformIntoNewTimeline(a)}t.previousNode=e}},{key:"visitAnimateRef",value:function(e,t){var n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}},{key:"_visitSubInstructions",value:function(e,t,n){var r=t.currentTimeline.currentTime,i=null!=n.duration?XF(n.duration):null,a=null!=n.delay?XF(n.delay):null;return 0!==i&&e.forEach(function(e){var n=t.appendInstructionToTimeline(e,i,a);r=Math.max(r,n.duration+n.delay)}),r}},{key:"visitReference",value:function(e,t){t.updateOptions(e.options,!0),yU(this,e.animation,t),t.previousNode=e}},{key:"visitSequence",value:function(e,t){var n=this,r=t.subContextCount,i=t,a=e.options;if(a&&(a.params||a.delay)&&((i=t.createSubContext(a)).transformIntoNewTimeline(),null!=a.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=LU);var o=XF(a.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(function(e){return yU(n,e,i)}),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),t.previousNode=e}},{key:"visitGroup",value:function(e,t){var n=this,r=[],i=t.currentTimeline.currentTime,a=e.options&&e.options.delay?XF(e.options.delay):0;e.steps.forEach(function(o){var s=t.createSubContext(e.options);a&&s.delayNextStep(a),yU(n,o,s),i=Math.max(i,s.currentTimeline.currentTime),r.push(s.currentTimeline)}),r.forEach(function(e){return t.currentTimeline.mergeTimelineCollectedStyles(e)}),t.transformIntoNewTimeline(i),t.previousNode=e}},{key:"_visitTiming",value:function(e,t){if(e.dynamic){var n=e.strValue;return eU(t.params?lU(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}},{key:"visitAnimate",value:function(e,t){var n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());var i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}},{key:"visitStyle",value:function(e,t){var n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();var i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}},{key:"visitKeyframes",value:function(e,t){var n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,a=t.createSubContext().currentTimeline;a.easing=n.easing,e.styles.forEach(function(e){a.forwardTime((e.offset||0)*i),a.setStyles(e.styles,e.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+i),t.previousNode=e}},{key:"visitQuery",value:function(e,t){var n=this,r=t.currentTimeline.currentTime,i=e.options||{},a=i.delay?XF(i.delay):0;a&&(6===t.previousNode.type||0==r&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=LU);var o=r,s=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=s.length;var u=null;s.forEach(function(r,i){t.currentQueryIndex=i;var s=t.createSubContext(e.options,r);a&&s.delayNextStep(a),r===t.element&&(u=s.currentTimeline),yU(n,e.animation,s),s.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,s.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}},{key:"visitStagger",value:function(e,t){var n=t.parentContext,r=t.currentTimeline,i=e.timings,a=Math.abs(i.duration),o=a*(t.currentQueryTotal-1),s=a*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":s=o-s;break;case"full":s=n.currentStaggerTime}var u=t.currentTimeline;s&&u.delayNextStep(s);var c=u.currentTime;yU(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}]),e}(),LU={},FU=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this._driver=t,this.element=n,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=a,this.errors=o,this.timelines=s,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=LU,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new UU(this._driver,n,0),s.push(this.currentTimeline)}return jg(e,[{key:"params",get:function(){return this.options.params}},{key:"updateOptions",value:function(e,t){var n=this;if(e){var r=e,i=this.options;null!=r.duration&&(i.duration=XF(r.duration)),null!=r.delay&&(i.delay=XF(r.delay));var a=r.params;if(a){var o=i.params;o||(o=this.options.params={}),Object.keys(a).forEach(function(e){(!t||!o.hasOwnProperty(e))&&(o[e]=lU(a[e],o,n.errors))})}}}},{key:"_copyOptions",value:function(){var e={};if(this.options){var t=this.options.params;if(t){var n=e.params={};Object.keys(t).forEach(function(e){n[e]=t[e]})}}return e}},{key:"createSubContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=n||this.element,a=new e(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}},{key:"transformIntoNewTimeline",value:function(e){return this.previousNode=LU,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}},{key:"appendInstructionToTimeline",value:function(e,t,n){var r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+e.delay,easing:""},i=new BU(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}},{key:"incrementTime",value:function(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}},{key:"delayNextStep",value:function(e){e>0&&this.currentTimeline.delayNextStep(e)}},{key:"invokeQuery",value:function(e,t,n,r,i,a){var o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(RU,"."+this._enterClassName)).replace(MU,"."+this._leaveClassName);var s=this._driver.query(this.element,e,1!=n);0!==n&&(s=n<0?s.slice(s.length+n,s.length):s.slice(0,n)),o.push.apply(o,Vg(s))}return!i&&0==o.length&&a.push('`query("'.concat(t,'")` returned zero elements. (Use `query("').concat(t,'", { optional: true })` if you wish to allow this.)')),o}}]),e}(),UU=function(){function e(t,n,r,i){Wg(this,e),this._driver=t,this.element=n,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}return jg(e,[{key:"containsAnimation",value:function(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}},{key:"getCurrentStyleProperties",value:function(){return Object.keys(this._currentKeyframe)}},{key:"currentTime",get:function(){return this.startTime+this.duration}},{key:"delayNextStep",value:function(e){var t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}},{key:"fork",value:function(t,n){return this.applyStylesToKeyframe(),new e(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}},{key:"_loadKeyframe",value:function(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}},{key:"forwardFrame",value:function(){this.duration+=1,this._loadKeyframe()}},{key:"forwardTime",value:function(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}},{key:"_updateStyle",value:function(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}},{key:"allowOnlyTimelineStyles",value:function(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}},{key:"applyEmptyStep",value:function(e){var t=this;e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(function(e){t._backFill[e]=t._globalTimelineStyles[e]||mF,t._currentKeyframe[e]=mF}),this._currentEmptyStepKeyframe=this._currentKeyframe}},{key:"setStyles",value:function(e,t,n,r){var i=this;t&&(this._previousKeyframe.easing=t);var a=r&&r.params||{},o=function(e,t){var n,r={};return e.forEach(function(e){"*"===e?(n=n||Object.keys(t)).forEach(function(e){r[e]=mF}):nU(e,!1,r)}),r}(e,this._globalTimelineStyles);Object.keys(o).forEach(function(e){var t=lU(o[e],a,n);i._pendingStyles[e]=t,i._localTimelineStyles.hasOwnProperty(e)||(i._backFill[e]=i._globalTimelineStyles.hasOwnProperty(e)?i._globalTimelineStyles[e]:mF),i._updateStyle(e,t)})}},{key:"applyStylesToKeyframe",value:function(){var e=this,t=this._pendingStyles,n=Object.keys(t);0!=n.length&&(this._pendingStyles={},n.forEach(function(n){e._currentKeyframe[n]=t[n]}),Object.keys(this._localTimelineStyles).forEach(function(t){e._currentKeyframe.hasOwnProperty(t)||(e._currentKeyframe[t]=e._localTimelineStyles[t])}))}},{key:"snapshotCurrentStyles",value:function(){var e=this;Object.keys(this._localTimelineStyles).forEach(function(t){var n=e._localTimelineStyles[t];e._pendingStyles[t]=n,e._updateStyle(t,n)})}},{key:"getFinalKeyframe",value:function(){return this._keyframes.get(this.duration)}},{key:"properties",get:function(){var e=[];for(var t in this._currentKeyframe)e.push(t);return e}},{key:"mergeTimelineCollectedStyles",value:function(e){var t=this;Object.keys(e._styleSummary).forEach(function(n){var r=t._styleSummary[n],i=e._styleSummary[n];(!r||i.time>r.time)&&t._updateStyle(n,i.value)})}},{key:"buildKeyframes",value:function(){var e=this;this.applyStylesToKeyframe();var t=new Set,n=new Set,r=1===this._keyframes.size&&0===this.duration,i=[];this._keyframes.forEach(function(a,o){var s=nU(a,!0);Object.keys(s).forEach(function(e){var r=s[e];"!"==r?t.add(e):r==mF&&n.add(e)}),r||(s.offset=o/e.duration),i.push(s)});var a=t.size?hU(t.values()):[],o=n.size?hU(n.values()):[];if(r){var s=i[0],u=tU(s);s.offset=0,u.offset=1,i=[s,u]}return AU(this.element,i,a,o,this.duration,this.startTime,this.easing,!1)}}]),e}(),BU=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return Wg(this,n),(u=t.call(this,e,r,s.delay)).keyframes=i,u.preStyleProps=a,u.postStyleProps=o,u._stretchStartingKeyframe=c,u.timings={duration:s.duration,delay:s.delay,easing:s.easing},u}return jg(n,[{key:"containsAnimation",value:function(){return this.keyframes.length>1}},{key:"buildKeyframes",value:function(){var e=this.keyframes,t=this.timings,n=t.delay,r=t.duration,i=t.easing;if(this._stretchStartingKeyframe&&n){var a=[],o=r+n,s=n/o,u=nU(e[0],!1);u.offset=0,a.push(u);var c=nU(e[0],!1);c.offset=VU(s),a.push(c);for(var l=e.length-1,h=1;h<=l;h++){var f=nU(e[h],!1);f.offset=VU((n+f.offset*r)/o),a.push(f)}r=o,n=0,i="",e=a}return AU(this.element,e,this.preStyleProps,this.postStyleProps,r,n,i,!0)}}]),n}(UU);function VU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t-1);return Math.round(e*n)/n}var zU=jg(function e(){Wg(this,e)}),HU=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"normalizePropertyName",value:function(e,t){return dU(e)}},{key:"normalizeStyleValue",value:function(e,t,n,r){var i="",a=n.toString().trim();if(GU[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{var o=n.match(/^[+-]?[\d\.]+([a-z]*)$/);o&&0==o[1].length&&r.push("Please provide a CSS unit value for ".concat(e,":").concat(n))}return a+i}}]),n}(zU),GU=function(e){var t={};return e.forEach(function(e){return t[e]=!0}),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(","));function $U(e,t,n,r,i,a,o,s,u,c,l,h,f){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:a,toState:r,toStyles:o,timelines:s,queriedElements:u,preStyleProps:c,postStyleProps:l,totalTime:h,errors:f}}var WU={},qU=function(){function e(t,n,r){Wg(this,e),this._triggerName=t,this.ast=n,this._stateStyles=r}return jg(e,[{key:"match",value:function(e,t,n,r){return function(e,t,n,r,i){return e.some(function(e){return e(t,n,r,i)})}(this.ast.matchers,e,t,n,r)}},{key:"buildStyles",value:function(e,t,n){var r=this._stateStyles["*"],i=this._stateStyles[e],a=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):a}},{key:"build",value:function(e,t,n,r,i,a,o,s,u,c){var l=[],h=this.ast.options&&this.ast.options.params||WU,f=this.buildStyles(n,o&&o.params||WU,l),d=s&&s.params||WU,v=this.buildStyles(r,d,l),p=new Set,g=new Map,y=new Map,m="void"===r,k={params:Object.assign(Object.assign({},h),d)},_=c?[]:NU(e,t,this.ast.animation,i,a,f,v,k,u,l),C=0;if(_.forEach(function(e){C=Math.max(e.duration+e.delay,C)}),l.length)return $U(t,this._triggerName,n,r,m,f,v,[],[],g,y,C,l);_.forEach(function(e){var n=e.element,r=xF(g,n,{});e.preStyleProps.forEach(function(e){return r[e]=!0});var i=xF(y,n,{});e.postStyleProps.forEach(function(e){return i[e]=!0}),n!==t&&p.add(n)});var w=hU(p.values());return $U(t,this._triggerName,n,r,m,f,v,_,w,g,y,C)}}]),e}(),jU=function(){function e(t,n,r){Wg(this,e),this.styles=t,this.defaultParams=n,this.normalizer=r}return jg(e,[{key:"buildStyles",value:function(e,t){var n=this,r={},i=tU(this.defaultParams);return Object.keys(e).forEach(function(t){var n=e[t];null!=n&&(i[t]=n)}),this.styles.styles.forEach(function(e){if("string"!=typeof e){var a=e;Object.keys(a).forEach(function(e){var o=a[e];o.length>1&&(o=lU(o,i,t));var s=n.normalizer.normalizePropertyName(e,t);o=n.normalizer.normalizeStyleValue(e,s,o,t),r[s]=o})}}),r}}]),e}(),ZU=function(){function e(t,n,r){var i=this;Wg(this,e),this.name=t,this.ast=n,this._normalizer=r,this.transitionFactories=[],this.states={},n.states.forEach(function(e){i.states[e.name]=new jU(e.style,e.options&&e.options.params||{},r)}),YU(this.states,"true","1"),YU(this.states,"false","0"),n.transitions.forEach(function(e){i.transitionFactories.push(new qU(t,e,i.states))}),this.fallbackTransition=function(e,t,n){return new qU(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[function(e,t){return!0}],options:null,queryCount:0,depCount:0},t)}(t,this.states)}return jg(e,[{key:"containsQueries",get:function(){return this.ast.queryCount>0}},{key:"matchTransition",value:function(e,t,n,r){return this.transitionFactories.find(function(i){return i.match(e,t,n,r)})||null}},{key:"matchStyles",value:function(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}]),e}();function YU(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}var KU=new xU,QU=function(){function e(t,n,r){Wg(this,e),this.bodyNode=t,this._driver=n,this._normalizer=r,this._animations={},this._playersById={},this.players=[]}return jg(e,[{key:"register",value:function(e,t){var n=[],r=EU(this._driver,t,n);if(n.length)throw new Error("Unable to build the animation due to the following errors: ".concat(n.join("\n")));this._animations[e]=r}},{key:"_buildPlayer",value:function(e,t,n){var r=e.element,i=OF(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}},{key:"create",value:function(e,t){var n,r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],o=this._animations[e],s=new Map;if(o?(n=NU(this._driver,t,o,qF,jF,{},{},i,KU,a)).forEach(function(e){var t=xF(s,e.element,{});e.postStyleProps.forEach(function(e){return t[e]=null})}):(a.push("The requested animation doesn't exist or has already been destroyed"),n=[]),a.length)throw new Error("Unable to create the animation due to the following errors: ".concat(a.join("\n")));s.forEach(function(e,t){Object.keys(e).forEach(function(n){e[n]=r._driver.computeStyle(t,n,mF)})});var u=PF(n.map(function(e){var t=s.get(e.element);return r._buildPlayer(e,{},t)}));return this._playersById[e]=u,u.onDestroy(function(){return r.destroy(e)}),this.players.push(u),u}},{key:"destroy",value:function(e){var t=this._getPlayer(e);t.destroy(),delete this._playersById[e];var n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}},{key:"_getPlayer",value:function(e){var t=this._playersById[e];if(!t)throw new Error("Unable to find the timeline player referenced by ".concat(e));return t}},{key:"listen",value:function(e,t,n,r){var i=AF(t,"","","");return TF(this._getPlayer(e),n,i,r),function(){}}},{key:"command",value:function(e,t,n,r){if("register"!=n)if("create"!=n){var i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}else this.create(e,t,r[0]||{});else this.register(e,r[0])}}]),e}(),XU="ng-animate-queued",JU="ng-animate-disabled",eB=".ng-animate-disabled",tB=[],nB={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},rB={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},iB="__ng_removed",aB=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Wg(this,e),this.namespaceId=r;var i=t&&t.hasOwnProperty("value");if(this.value=null!==(n=i?t.value:t)&&void 0!==n?n:null,i){var a=tU(t);delete a.value,this.options=a}else this.options={};this.options.params||(this.options.params={})}return jg(e,[{key:"params",get:function(){return this.options.params}},{key:"absorbOptions",value:function(e){var t=e.params;if(t){var n=this.options.params;Object.keys(t).forEach(function(e){null==n[e]&&(n[e]=t[e])})}}}]),e}(),oB="void",sB=new aB(oB),uB=function(){function e(t,n,r){Wg(this,e),this.id=t,this.hostElement=n,this._engine=r,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,gB(n,this._hostClassName)}return jg(e,[{key:"listen",value:function(e,t,n,r){var i,a=this;if(!this._triggers.hasOwnProperty(t))throw new Error('Unable to listen on the animation trigger event "'.concat(n,'" because the animation trigger "').concat(t,"\" doesn't exist!"));if(null==n||0==n.length)throw new Error('Unable to listen on the animation trigger "'.concat(t,'" because the provided event is undefined!'));if("start"!=(i=n)&&"done"!=i)throw new Error('The provided animation trigger event "'.concat(n,'" for the animation trigger "').concat(t,'" is not supported!'));var o=xF(this._elementListeners,e,[]),s={name:t,phase:n,callback:r};o.push(s);var u=xF(this._engine.statesByElement,e,{});return u.hasOwnProperty(t)||(gB(e,ZF),gB(e,ZF+"-"+t),u[t]=sB),function(){a._engine.afterFlush(function(){var e=o.indexOf(s);e>=0&&o.splice(e,1),a._triggers[t]||delete u[t]})}}},{key:"register",value:function(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}},{key:"_getTrigger",value:function(e){var t=this._triggers[e];if(!t)throw new Error('The provided animation trigger "'.concat(e,'" has not been registered!'));return t}},{key:"trigger",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this._getTrigger(t),o=new lB(this.id,t,e),s=this._engine.statesByElement.get(e);s||(gB(e,ZF),gB(e,ZF+"-"+t),this._engine.statesByElement.set(e,s={}));var u=s[t],c=new aB(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),s[t]=c,u||(u=sB),c.value===oB||u.value!==c.value){var l=xF(this._engine.playersByElement,e,[]);l.forEach(function(e){e.namespaceId==r.id&&e.triggerName==t&&e.queued&&e.destroy()});var h=a.matchTransition(u.value,c.value,e,c.params),f=!1;if(!h){if(!i)return;h=a.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:h,fromState:u,toState:c,player:o,isFallbackTransition:f}),f||(gB(e,XU),o.onStart(function(){yB(e,XU)})),o.onDone(function(){var t=r.players.indexOf(o);t>=0&&r.players.splice(t,1);var n=r._engine.playersByElement.get(e);if(n){var i=n.indexOf(o);i>=0&&n.splice(i,1)}}),this.players.push(o),l.push(o),o}if(!function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0;i<n.length;i++){var a=n[i];if(!t.hasOwnProperty(a)||e[a]!==t[a])return!1}return!0}(u.params,c.params)){var d=[],v=a.matchStyles(u.value,u.params,d),p=a.matchStyles(c.value,c.params,d);d.length?this._engine.reportError(d):this._engine.afterFlush(function(){oU(e,v),aU(e,p)})}}},{key:"deregister",value:function(e){var t=this;delete this._triggers[e],this._engine.statesByElement.forEach(function(t,n){delete t[e]}),this._elementListeners.forEach(function(n,r){t._elementListeners.set(r,n.filter(function(t){return t.name!=e}))})}},{key:"clearElementCache",value:function(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);var t=this._engine.playersByElement.get(e);t&&(t.forEach(function(e){return e.destroy()}),this._engine.playersByElement.delete(e))}},{key:"_signalRemovalForInnerTriggers",value:function(e,t){var n=this,r=this._engine.driver.query(e,YF,!0);r.forEach(function(e){if(!e[iB]){var r=n._engine.fetchNamespacesByElement(e);r.size?r.forEach(function(n){return n.triggerLeaveAnimation(e,t,!1,!0)}):n.clearElementCache(e)}}),this._engine.afterFlushAnimationsDone(function(){return r.forEach(function(e){return n.clearElementCache(e)})})}},{key:"triggerLeaveAnimation",value:function(e,t,n,r){var i=this,a=this._engine.statesByElement.get(e);if(a){var o=[];if(Object.keys(a).forEach(function(t){if(i._triggers[t]){var n=i.trigger(e,t,oB,r);n&&o.push(n)}}),o.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&PF(o).onDone(function(){return i._engine.processLeaveNode(e)}),!0}return!1}},{key:"prepareLeaveAnimationListeners",value:function(e){var t=this,n=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(n&&r){var i=new Set;n.forEach(function(n){var a=n.name;if(!i.has(a)){i.add(a);var o=t._triggers[a].fallbackTransition,s=r[a]||sB,u=new aB(oB),c=new lB(t.id,a,e);t._engine.totalQueuedPlayers++,t._queue.push({element:e,triggerName:a,transition:o,fromState:s,toState:u,player:c,isFallbackTransition:!0})}})}}},{key:"removeNode",value:function(e,t){var n=this,r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),!this.triggerLeaveAnimation(e,t,!0)){var i=!1;if(r.totalAnimations){var a=r.players.length?r.playersByQueriedElement.get(e):[];if(a&&a.length)i=!0;else for(var o=e;o=o.parentNode;)if(r.statesByElement.get(o)){i=!0;break}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,t);else{var s=e[iB];(!s||s===nB)&&(r.afterFlush(function(){return n.clearElementCache(e)}),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}}},{key:"insertNode",value:function(e,t){gB(e,this._hostClassName)}},{key:"drainQueuedTransitions",value:function(e){var t=this,n=[];return this._queue.forEach(function(r){var i=r.player;if(!i.destroyed){var a=r.element,o=t._elementListeners.get(a);o&&o.forEach(function(t){if(t.name==r.triggerName){var n=AF(a,r.triggerName,r.fromState.value,r.toState.value);n._data=e,TF(r.player,t.phase,n,t.callback)}}),i.markedForDestroy?t._engine.afterFlush(function(){i.destroy()}):n.push(r)}}),this._queue=[],n.sort(function(e,n){var r=e.transition.ast.depCount,i=n.transition.ast.depCount;return 0==r||0==i?r-i:t._engine.driver.containsElement(e.element,n.element)?1:-1})}},{key:"destroy",value:function(e){this.players.forEach(function(e){return e.destroy()}),this._signalRemovalForInnerTriggers(this.hostElement,e)}},{key:"elementContainsData",value:function(e){var t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(function(t){return t.element===e})||t}}]),e}(),cB=function(){function e(t,n,r){Wg(this,e),this.bodyNode=t,this.driver=n,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=function(e,t){}}return jg(e,[{key:"_onRemovalComplete",value:function(e,t){this.onRemovalComplete(e,t)}},{key:"queuedPlayers",get:function(){var e=[];return this._namespaceList.forEach(function(t){t.players.forEach(function(t){t.queued&&e.push(t)})}),e}},{key:"createNamespace",value:function(e,t){var n=new uB(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}},{key:"_balanceNamespaceList",value:function(e,t){var n=this._namespaceList.length-1;if(n>=0){for(var r=!1,i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}},{key:"register",value:function(e,t){var n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}},{key:"registerTrigger",value:function(e,t,n){var r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}},{key:"destroy",value:function(e,t){var n=this;if(e){var r=this._fetchNamespace(e);this.afterFlush(function(){n.namespacesByHostElement.delete(r.hostElement),delete n._namespaceLookup[e];var t=n._namespaceList.indexOf(r);t>=0&&n._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(function(){return r.destroy(t)})}}},{key:"_fetchNamespace",value:function(e){return this._namespaceLookup[e]}},{key:"fetchNamespacesByElement",value:function(e){var t=new Set,n=this.statesByElement.get(e);if(n)for(var r=Object.keys(n),i=0;i<r.length;i++){var a=n[r[i]].namespaceId;if(a){var o=this._fetchNamespace(a);o&&t.add(o)}}return t}},{key:"trigger",value:function(e,t,n,r){if(hB(t)){var i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}},{key:"insertNode",value:function(e,t,n,r){if(hB(t)){var i=t[iB];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;var a=this.collectedLeaveElements.indexOf(t);a>=0&&this.collectedLeaveElements.splice(a,1)}if(e){var o=this._fetchNamespace(e);o&&o.insertNode(t,n)}r&&this.collectEnterElement(t)}}},{key:"collectEnterElement",value:function(e){this.collectedEnterElements.push(e)}},{key:"markElementAsDisabled",value:function(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),gB(e,JU)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),yB(e,JU))}},{key:"removeNode",value:function(e,t,n,r){if(hB(t)){var i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){var a=this.namespacesByHostElement.get(t);a&&a.id!==e&&a.removeNode(t,r)}}else this._onRemovalComplete(t,r)}},{key:"markElementAsRemoved",value:function(e,t,n,r){this.collectedLeaveElements.push(t),t[iB]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}},{key:"listen",value:function(e,t,n,r,i){return hB(t)?this._fetchNamespace(e).listen(t,n,r,i):function(){}}},{key:"_buildInstruction",value:function(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}},{key:"destroyInnerAnimations",value:function(e){var t=this,n=this.driver.query(e,YF,!0);n.forEach(function(e){return t.destroyActiveAnimationsForElement(e)}),0!=this.playersByQueriedElement.size&&(n=this.driver.query(e,QF,!0)).forEach(function(e){return t.finishActiveQueriedAnimationOnElement(e)})}},{key:"destroyActiveAnimationsForElement",value:function(e){var t=this.playersByElement.get(e);t&&t.forEach(function(e){e.queued?e.markedForDestroy=!0:e.destroy()})}},{key:"finishActiveQueriedAnimationOnElement",value:function(e){var t=this.playersByQueriedElement.get(e);t&&t.forEach(function(e){return e.finish()})}},{key:"whenRenderingDone",value:function(){var e=this;return new Promise(function(t){if(e.players.length)return PF(e.players).onDone(function(){return t()});t()})}},{key:"processLeaveNode",value:function(e){var t=this,n=e[iB];if(n&&n.setForRemoval){if(e[iB]=nB,n.namespaceId){this.destroyInnerAnimations(e);var r=this._fetchNamespace(n.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}this.driver.matchesElement(e,eB)&&this.markElementAsDisabled(e,!1),this.driver.query(e,eB,!0).forEach(function(e){t.markElementAsDisabled(e,!1)})}},{key:"flush",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=[];if(this.newHostElements.size&&(this.newHostElements.forEach(function(t,n){return e._balanceNamespaceList(t,n)}),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(var r=0;r<this.collectedEnterElements.length;r++)gB(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){var i=[];try{n=this._flushAnimations(i,t)}finally{for(var a=0;a<i.length;a++)i[a]()}}else for(var o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(function(e){return e()}),this._flushFns=[],this._whenQuietFns.length){var s=this._whenQuietFns;this._whenQuietFns=[],n.length?PF(n).onDone(function(){s.forEach(function(e){return e()})}):s.forEach(function(e){return e()})}}},{key:"reportError",value:function(e){throw new Error("Unable to process animations due to the following failed trigger transitions\n ".concat(e.join("\n")))}},{key:"_flushAnimations",value:function(e,t){var n=this,r=new xU,i=[],a=new Map,o=[],s=new Map,u=new Map,c=new Map,l=new Set;this.disabledNodes.forEach(function(e){l.add(e);for(var t=n.driver.query(e,".ng-animate-queued",!0),r=0;r<t.length;r++)l.add(t[r])});var h=this.bodyNode,f=Array.from(this.statesByElement.keys()),d=vB(f,this.collectedEnterElements),v=new Map,p=0;d.forEach(function(e,t){var n=qF+p++;v.set(t,n),e.forEach(function(e){return gB(e,n)})});for(var g=[],y=new Set,m=new Set,k=0;k<this.collectedLeaveElements.length;k++){var _=this.collectedLeaveElements[k],C=_[iB];C&&C.setForRemoval&&(g.push(_),y.add(_),C.hasAnimation?this.driver.query(_,".ng-star-inserted",!0).forEach(function(e){return y.add(e)}):m.add(_))}var w=new Map,b=vB(f,Array.from(y));b.forEach(function(e,t){var n=jF+p++;w.set(t,n),e.forEach(function(e){return gB(e,n)})}),e.push(function(){d.forEach(function(e,t){var n=v.get(t);e.forEach(function(e){return yB(e,n)})}),b.forEach(function(e,t){var n=w.get(t);e.forEach(function(e){return yB(e,n)})}),g.forEach(function(e){n.processLeaveNode(e)})});for(var E=[],S=[],P=this._namespaceList.length-1;P>=0;P--)this._namespaceList[P].drainQueuedTransitions(t).forEach(function(e){var t=e.player,a=e.element;if(E.push(t),n.collectedEnterElements.length){var l=a[iB];if(l&&l.setForMove)return void t.destroy()}var f=!h||!n.driver.containsElement(h,a),d=w.get(a),p=v.get(a),g=n._buildInstruction(e,r,p,d,f);if(g.errors&&g.errors.length)S.push(g);else{if(f)return t.onStart(function(){return oU(a,g.fromStyles)}),t.onDestroy(function(){return aU(a,g.toStyles)}),void i.push(t);if(e.isFallbackTransition)return t.onStart(function(){return oU(a,g.fromStyles)}),t.onDestroy(function(){return aU(a,g.toStyles)}),void i.push(t);g.timelines.forEach(function(e){return e.stretchStartingKeyframe=!0}),r.append(a,g.timelines),o.push({instruction:g,player:t,element:a}),g.queriedElements.forEach(function(e){return xF(s,e,[]).push(t)}),g.preStyleProps.forEach(function(e,t){var n=Object.keys(e);if(n.length){var r=u.get(t);r||u.set(t,r=new Set),n.forEach(function(e){return r.add(e)})}}),g.postStyleProps.forEach(function(e,t){var n=Object.keys(e),r=c.get(t);r||c.set(t,r=new Set),n.forEach(function(e){return r.add(e)})})}});if(S.length){var O=[];S.forEach(function(e){O.push("@".concat(e.triggerName," has failed due to:\n")),e.errors.forEach(function(e){return O.push("- ".concat(e,"\n"))})}),E.forEach(function(e){return e.destroy()}),this.reportError(O)}var T=new Map,I=new Map;o.forEach(function(e){var t=e.element;r.has(t)&&(I.set(t,t),n._beforeAnimationBuild(e.player.namespaceId,e.instruction,T))}),i.forEach(function(e){var t=e.element;n._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(function(e){xF(T,t,[]).push(e),e.destroy()})});var A=g.filter(function(e){return _B(e,u,c)}),x=new Map;dB(x,this.driver,m,c,mF).forEach(function(e){_B(e,u,c)&&A.push(e)});var R=new Map;d.forEach(function(e,t){dB(R,n.driver,new Set(e),u,"!")}),A.forEach(function(e){var t=x.get(e),n=R.get(e);x.set(e,Object.assign(Object.assign({},t),n))});var M=[],N=[],D={};o.forEach(function(e){var t=e.element,o=e.player,s=e.instruction;if(r.has(t)){if(l.has(t))return o.onDestroy(function(){return aU(t,s.toStyles)}),o.disabled=!0,o.overrideTotalTime(s.totalTime),void i.push(o);var u=D;if(I.size>1){for(var c=t,h=[];c=c.parentNode;){var f=I.get(c);if(f){u=f;break}h.push(c)}h.forEach(function(e){return I.set(e,u)})}var d=n._buildAnimation(o.namespaceId,s,T,a,R,x);if(o.setRealPlayer(d),u===D)M.push(o);else{var v=n.playersByElement.get(u);v&&v.length&&(o.parentPlayer=PF(v)),i.push(o)}}else oU(t,s.fromStyles),o.onDestroy(function(){return aU(t,s.toStyles)}),N.push(o),l.has(t)&&i.push(o)}),N.forEach(function(e){var t=a.get(e.element);if(t&&t.length){var n=PF(t);e.setRealPlayer(n)}}),i.forEach(function(e){e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(var L=0;L<g.length;L++){var F=g[L],U=F[iB];if(yB(F,jF),!U||!U.hasAnimation){var B=[];if(s.size){var V=s.get(F);V&&V.length&&B.push.apply(B,Vg(V));for(var z=this.driver.query(F,QF,!0),H=0;H<z.length;H++){var G=s.get(z[H]);G&&G.length&&B.push.apply(B,Vg(G))}}var $=B.filter(function(e){return!e.destroyed});$.length?mB(this,F,$):this.processLeaveNode(F)}}return g.length=0,M.forEach(function(e){n.players.push(e),e.onDone(function(){e.destroy();var t=n.players.indexOf(e);n.players.splice(t,1)}),e.play()}),M}},{key:"elementContainsData",value:function(e,t){var n=!1,r=t[iB];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}},{key:"afterFlush",value:function(e){this._flushFns.push(e)}},{key:"afterFlushAnimationsDone",value:function(e){this._whenQuietFns.push(e)}},{key:"_getPreviousPlayers",value:function(e,t,n,r,i){var a=[];if(t){var o=this.playersByQueriedElement.get(e);o&&(a=o)}else{var s=this.playersByElement.get(e);if(s){var u=!i||i==oB;s.forEach(function(e){e.queued||!u&&e.triggerName!=r||a.push(e)})}}return(n||r)&&(a=a.filter(function(e){return!(n&&n!=e.namespaceId||r&&r!=e.triggerName)})),a}},{key:"_beforeAnimationBuild",value:function(e,t,n){var r,i=this,a=t.element,o=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName,u=Hg(t.timelines);try{var c=function(){var e=r.value.element,u=e!==a,c=xF(n,e,[]);i._getPreviousPlayers(e,u,o,s,t.toState).forEach(function(e){var t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)})};for(u.s();!(r=u.n()).done;)c()}catch(l){u.e(l)}finally{u.f()}oU(a,t.fromStyles)}},{key:"_buildAnimation",value:function(e,t,n,r,i,a){var o=this,s=t.triggerName,u=t.element,c=[],l=new Set,h=new Set,f=t.timelines.map(function(t){var f=t.element;l.add(f);var d=f[iB];if(d&&d.removedBeforeQueried)return new wF(t.duration,t.delay);var v=f!==u,p=function(e){var t=[];return kB(e,t),t}((n.get(f)||tB).map(function(e){return e.getRealPlayer()})).filter(function(e){return!!e.element&&e.element===f}),g=i.get(f),y=a.get(f),m=OF(0,o._normalizer,0,t.keyframes,g,y),k=o._buildPlayer(t,m,p);if(t.subTimeline&&r&&h.add(f),v){var _=new lB(e,s,f);_.setRealPlayer(k),c.push(_)}return k});c.forEach(function(e){xF(o.playersByQueriedElement,e.element,[]).push(e),e.onDone(function(){return function(e,t,n){var r;if(e instanceof Map){if(r=e.get(t)){if(r.length){var i=r.indexOf(n);r.splice(i,1)}0==r.length&&e.delete(t)}}else if(r=e[t]){if(r.length){var a=r.indexOf(n);r.splice(a,1)}0==r.length&&delete e[t]}return r}(o.playersByQueriedElement,e.element,e)})}),l.forEach(function(e){return gB(e,KF)});var d=PF(f);return d.onDestroy(function(){l.forEach(function(e){return yB(e,KF)}),aU(u,t.toStyles)}),h.forEach(function(e){xF(r,e,[]).push(d)}),d}},{key:"_buildPlayer",value:function(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new wF(e.duration,e.delay)}}]),e}(),lB=function(){function e(t,n,r){Wg(this,e),this.namespaceId=t,this.triggerName=n,this.element=r,this._player=new wF,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}return jg(e,[{key:"setRealPlayer",value:function(e){var t=this;this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(function(n){t._queuedCallbacks[n].forEach(function(t){return TF(e,n,void 0,t)})}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}},{key:"getRealPlayer",value:function(){return this._player}},{key:"overrideTotalTime",value:function(e){this.totalTime=e}},{key:"syncPlayerEvents",value:function(e){var t=this,n=this._player;n.triggerCallback&&e.onStart(function(){return n.triggerCallback("start")}),e.onDone(function(){return t.finish()}),e.onDestroy(function(){return t.destroy()})}},{key:"_queueEvent",value:function(e,t){xF(this._queuedCallbacks,e,[]).push(t)}},{key:"onDone",value:function(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}},{key:"onStart",value:function(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}},{key:"onDestroy",value:function(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}},{key:"init",value:function(){this._player.init()}},{key:"hasStarted",value:function(){return!this.queued&&this._player.hasStarted()}},{key:"play",value:function(){!this.queued&&this._player.play()}},{key:"pause",value:function(){!this.queued&&this._player.pause()}},{key:"restart",value:function(){!this.queued&&this._player.restart()}},{key:"finish",value:function(){this._player.finish()}},{key:"destroy",value:function(){this.destroyed=!0,this._player.destroy()}},{key:"reset",value:function(){!this.queued&&this._player.reset()}},{key:"setPosition",value:function(e){this.queued||this._player.setPosition(e)}},{key:"getPosition",value:function(){return this.queued?0:this._player.getPosition()}},{key:"triggerCallback",value:function(e){var t=this._player;t.triggerCallback&&t.triggerCallback(e)}}]),e}();function hB(e){return e&&1===e.nodeType}function fB(e,t){var n=e.style.display;return e.style.display=null!=t?t:"none",n}function dB(e,t,n,r,i){var a=[];n.forEach(function(e){return a.push(fB(e))});var o=[];r.forEach(function(n,r){var a={};n.forEach(function(e){var n=a[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[iB]=rB,o.push(r))}),e.set(r,a)});var s=0;return n.forEach(function(e){return fB(e,a[s++])}),o}function vB(e,t){var n=new Map;if(e.forEach(function(e){return n.set(e,[])}),0==t.length)return n;var r=new Set(t),i=new Map;function a(e){if(!e)return 1;var t=i.get(e);if(t)return t;var o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:a(o),i.set(e,t),t}return t.forEach(function(e){var t=a(e);1!==t&&n.get(t).push(e)}),n}var pB="$$classes";function gB(e,t){if(e.classList)e.classList.add(t);else{var n=e[pB];n||(n=e[pB]={}),n[t]=!0}}function yB(e,t){if(e.classList)e.classList.remove(t);else{var n=e[pB];n&&delete n[t]}}function mB(e,t,n){PF(n).onDone(function(){return e.processLeaveNode(t)})}function kB(e,t){for(var n=0;n<e.length;n++){var r=e[n];r instanceof bF?kB(r.players,t):t.push(r)}}function _B(e,t,n){var r=n.get(e);if(!r)return!1;var i=t.get(e);return i?r.forEach(function(e){return i.add(e)}):t.set(e,r),n.delete(e),!0}var CB=function(){function e(t,n,r){var i=this;Wg(this,e),this.bodyNode=t,this._driver=n,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=function(e,t){},this._transitionEngine=new cB(t,n,r),this._timelineEngine=new QU(t,n,r),this._transitionEngine.onRemovalComplete=function(e,t){return i.onRemovalComplete(e,t)}}return jg(e,[{key:"registerTrigger",value:function(e,t,n,r,i){var a=e+"-"+r,o=this._triggerCache[a];if(!o){var s=[],u=EU(this._driver,i,s);if(s.length)throw new Error('The animation trigger "'.concat(r,'" has failed to build due to the following errors:\n - ').concat(s.join("\n - ")));o=function(e,t,n){return new ZU(e,t,n)}(r,u,this._normalizer),this._triggerCache[a]=o}this._transitionEngine.registerTrigger(t,r,o)}},{key:"register",value:function(e,t){this._transitionEngine.register(e,t)}},{key:"destroy",value:function(e,t){this._transitionEngine.destroy(e,t)}},{key:"onInsert",value:function(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}},{key:"onRemove",value:function(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}},{key:"disableAnimations",value:function(e,t){this._transitionEngine.markElementAsDisabled(e,t)}},{key:"process",value:function(e,t,n,r){if("@"==n.charAt(0)){var i=Pg(RF(n),2),a=i[0],o=i[1];this._timelineEngine.command(a,t,o,r)}else this._transitionEngine.trigger(e,t,n,r)}},{key:"listen",value:function(e,t,n,r,i){if("@"==n.charAt(0)){var a=Pg(RF(n),2),o=a[0],s=a[1];return this._timelineEngine.listen(o,t,s,i)}return this._transitionEngine.listen(e,t,n,r,i)}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._transitionEngine.flush(e)}},{key:"players",get:function(){return this._transitionEngine.players.concat(this._timelineEngine.players)}},{key:"whenRenderingDone",value:function(){return this._transitionEngine.whenRenderingDone()}}]),e}();function wB(e,t){var n=null,r=null;return Array.isArray(t)&&t.length?(n=EB(t[0]),t.length>1&&(r=EB(t[t.length-1]))):t&&(n=EB(t)),n||r?new bB(e,n,r):null}var bB=function(){var e=function(){function e(t,n,r){Wg(this,e),this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;var i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}return jg(e,[{key:"start",value:function(){this._state<1&&(this._startStyles&&aU(this._element,this._startStyles,this._initialStyles),this._state=1)}},{key:"finish",value:function(){this.start(),this._state<2&&(aU(this._element,this._initialStyles),this._endStyles&&(aU(this._element,this._endStyles),this._endStyles=null),this._state=1)}},{key:"destroy",value:function(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(oU(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(oU(this._element,this._endStyles),this._endStyles=null),aU(this._element,this._initialStyles),this._state=3)}}]),e}();return e.initialStylesByElement=new WeakMap,e}();function EB(e){for(var t=null,n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];SB(i)&&((t=t||{})[i]=e[i])}return t}function SB(e){return"display"===e||"position"===e}var PB="animation",OB="animationend",TB=function(){function e(t,n,r,i,a,o,s){var u=this;Wg(this,e),this._element=t,this._name=n,this._duration=r,this._delay=i,this._easing=a,this._fillMode=o,this._onDoneFn=s,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=function(e){return u._handleCallback(e)}}return jg(e,[{key:"apply",value:function(){(function(e,t){var n=NB(e,"").trim();n.length&&(function(e,t){for(var n=0,r=0;r<e.length;r++)","===e.charAt(r)&&n++}(n),t="".concat(n,", ").concat(t)),MB(e,"",t)})(this._element,"".concat(this._duration,"ms ").concat(this._easing," ").concat(this._delay,"ms 1 normal ").concat(this._fillMode," ").concat(this._name)),RB(this._element,this._eventFn,!1),this._startTime=Date.now()}},{key:"pause",value:function(){IB(this._element,this._name,"paused")}},{key:"resume",value:function(){IB(this._element,this._name,"running")}},{key:"setPosition",value:function(e){var t=AB(this._element,this._name);this._position=e*this._duration,MB(this._element,"Delay","-".concat(this._position,"ms"),t)}},{key:"getPosition",value:function(){return this._position}},{key:"_handleCallback",value:function(e){var t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}},{key:"finish",value:function(){this._finished||(this._finished=!0,this._onDoneFn(),RB(this._element,this._eventFn,!0))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){var n=NB(e,"").split(","),r=xB(n,t);r>=0&&(n.splice(r,1),MB(e,"",n.join(",")))}(this._element,this._name))}}]),e}();function IB(e,t,n){MB(e,"PlayState",n,AB(e,t))}function AB(e,t){var n=NB(e,"");return n.indexOf(",")>0?xB(n.split(","),t):xB([n],t)}function xB(e,t){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function RB(e,t,n){n?e.removeEventListener(OB,t):e.addEventListener(OB,t)}function MB(e,t,n,r){var i=PB+t;if(null!=r){var a=e.style[i];if(a.length){var o=a.split(",");o[r]=n,n=o.join(",")}}e.style[i]=n}function NB(e,t){return e.style[PB+t]||""}var DB=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this.element=t,this.keyframes=n,this.animationName=r,this._duration=i,this._delay=a,this._finalStyles=s,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=o||"linear",this.totalTime=i+a,this._buildStyler()}return jg(e,[{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"destroy",value:function(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(function(e){return e()}),this._onDestroyFns=[])}},{key:"_flushDoneFns",value:function(){this._onDoneFns.forEach(function(e){return e()}),this._onDoneFns=[]}},{key:"_flushStartFns",value:function(){this._onStartFns.forEach(function(e){return e()}),this._onStartFns=[]}},{key:"finish",value:function(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}},{key:"setPosition",value:function(e){this._styler.setPosition(e)}},{key:"getPosition",value:function(){return this._styler.getPosition()}},{key:"hasStarted",value:function(){return this._state>=2}},{key:"init",value:function(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}},{key:"play",value:function(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}},{key:"pause",value:function(){this.init(),this._styler.pause()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"reset",value:function(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}},{key:"_buildStyler",value:function(){var e=this;this._styler=new TB(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",function(){return e.finish()})}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(function(e){return e()}),t.length=0}},{key:"beforeDestroy",value:function(){var e=this;this.init();var t={};if(this.hasStarted()){var n=this._state>=3;Object.keys(this._finalStyles).forEach(function(r){"offset"!=r&&(t[r]=n?e._finalStyles[r]:mU(e.element,r))})}this.currentSnapshot=t}}]),e}(),LB=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).element=e,i._startingStyles={},i.__initialized=!1,i._styles=GF(r),i}return jg(n,[{key:"init",value:function(){var e=this;this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(function(t){e._startingStyles[t]=e.element.style[t]}),xg(Bg(n.prototype),"init",this).call(this))}},{key:"play",value:function(){var e=this;!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(function(t){return e.element.style.setProperty(t,e._styles[t])}),xg(Bg(n.prototype),"play",this).call(this))}},{key:"destroy",value:function(){var e=this;!this._startingStyles||(Object.keys(this._startingStyles).forEach(function(t){var n=e._startingStyles[t];n?e.element.style.setProperty(t,n):e.element.style.removeProperty(t)}),this._startingStyles=null,xg(Bg(n.prototype),"destroy",this).call(this))}}]),n}(wF),FB=function(){function e(){Wg(this,e),this._count=0}return jg(e,[{key:"validateStyleProperty",value:function(e){return BF(e)}},{key:"matchesElement",value:function(e,t){return VF(e,t)}},{key:"containsElement",value:function(e,t){return zF(e,t)}},{key:"query",value:function(e,t,n){return HF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"buildKeyframeElement",value:function(e,t,n){n=n.map(function(e){return GF(e)});var r="@keyframes ".concat(t," {\n"),i="";n.forEach(function(e){i=" ";var t=parseFloat(e.offset);r+="".concat(i).concat(100*t,"% {\n"),i+=" ",Object.keys(e).forEach(function(t){var n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+="".concat(i,"animation-timing-function: ").concat(n,";\n")));default:return void(r+="".concat(i).concat(t,": ").concat(n,";\n"))}}),r+="".concat(i,"}\n")}),r+="}\n";var a=document.createElement("style");return a.textContent=r,a}},{key:"animate",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=a.filter(function(e){return e instanceof DB}),s={};pU(n,r)&&o.forEach(function(e){var t=e.currentSnapshot;Object.keys(t).forEach(function(e){return s[e]=t[e]})});var u=function(e){var t={};return e&&(Array.isArray(e)?e:[e]).forEach(function(e){Object.keys(e).forEach(function(n){"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=gU(e,t,s));if(0==n)return new LB(e,u);var c="gen_css_kf_"+this._count++,l=this.buildKeyframeElement(e,c,t);(function(e){var t,n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(l);var h=wB(e,t),f=new DB(e,t,c,n,r,i,u,h);return f.onDestroy(function(){var e;(e=l).parentNode.removeChild(e)}),f}}]),e}(),UB=function(){function e(t,n,r,i){Wg(this,e),this.element=t,this.keyframes=n,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}return jg(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach(function(e){return e()}),this._onDoneFns=[])}},{key:"init",value:function(){this._buildPlayer(),this._preparePlayerBeforeStart()}},{key:"_buildPlayer",value:function(){var e=this;if(!this._initialized){this._initialized=!0;var t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",function(){return e._onFinish()})}}},{key:"_preparePlayerBeforeStart",value:function(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}},{key:"_triggerWebAnimation",value:function(e,t,n){return e.animate(t,n)}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"play",value:function(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(function(e){return e()}),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}},{key:"pause",value:function(){this.init(),this.domPlayer.pause()}},{key:"finish",value:function(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}},{key:"reset",value:function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"_resetDomPlayerState",value:function(){this.domPlayer&&this.domPlayer.cancel()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"hasStarted",value:function(){return this._started}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(function(e){return e()}),this._onDestroyFns=[])}},{key:"setPosition",value:function(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}},{key:"getPosition",value:function(){return this.domPlayer.currentTime/this.time}},{key:"totalTime",get:function(){return this._delay+this._duration}},{key:"beforeDestroy",value:function(){var e=this,t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(function(n){"offset"!=n&&(t[n]=e._finished?e._finalKeyframe[n]:mU(e.element,n))}),this.currentSnapshot=t}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(function(e){return e()}),t.length=0}}]),e}(),BB=function(){function e(){Wg(this,e),this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(VB().toString()),this._cssKeyframesDriver=new FB}return jg(e,[{key:"validateStyleProperty",value:function(e){return BF(e)}},{key:"matchesElement",value:function(e,t){return VF(e,t)}},{key:"containsElement",value:function(e,t){return zF(e,t)}},{key:"query",value:function(e,t,n){return HF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"overrideWebAnimationsSupport",value:function(e){this._isNativeImpl=e}},{key:"animate",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,a);var s={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(s.easing=i);var u={},c=a.filter(function(e){return e instanceof UB});pU(n,r)&&c.forEach(function(e){var t=e.currentSnapshot;Object.keys(t).forEach(function(e){return u[e]=t[e]})});var l=wB(e,t=gU(e,t=t.map(function(e){return nU(e,!1)}),u));return new UB(e,t,s,l)}}]),e}();function VB(){return EF()&&Element.prototype.animate||{}}var zB=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this))._nextAnimationId=0,i._renderer=e.createRenderer(r.body,{id:"0",encapsulation:Tm.None,styles:[],data:{animation:[]}}),i}return jg(n,[{key:"build",value:function(e){var t=this._nextAnimationId.toString();this._nextAnimationId++;var n=Array.isArray(e)?kF(e):e;return $B(this._renderer,null,t,"register",[n]),new HB(t,this._renderer)}}]),n}(yF);return e.\u0275fac=function(t){return new(t||e)(pC(lO),pC(xI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),HB=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this))._id=e,i._renderer=r,i}return jg(n,[{key:"create",value:function(e,t){return new GB(this._id,e,t||{},this._renderer)}}]),n}(function(){return jg(function e(){Wg(this,e)})}()),GB=function(){function e(t,n,r,i){Wg(this,e),this.id=t,this.element=n,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}return jg(e,[{key:"_listen",value:function(e,t){return this._renderer.listen(this.element,"@@".concat(this.id,":").concat(e),t)}},{key:"_command",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return $B(this._renderer,this.element,this.id,e,n)}},{key:"onDone",value:function(e){this._listen("done",e)}},{key:"onStart",value:function(e){this._listen("start",e)}},{key:"onDestroy",value:function(e){this._listen("destroy",e)}},{key:"init",value:function(){this._command("init")}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this._command("play"),this._started=!0}},{key:"pause",value:function(){this._command("pause")}},{key:"restart",value:function(){this._command("restart")}},{key:"finish",value:function(){this._command("finish")}},{key:"destroy",value:function(){this._command("destroy")}},{key:"reset",value:function(){this._command("reset"),this._started=!1}},{key:"setPosition",value:function(e){this._command("setPosition",e)}},{key:"getPosition",value:function(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}]),e}();function $B(e,t,n,r,i){return e.setProperty(t,"@@".concat(n,":").concat(r),i)}var WB="@.disabled",qB=function(){var e=function(){function e(t,n,r){Wg(this,e),this.delegate=t,this.engine=n,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),n.onRemovalComplete=function(e,t){t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}return jg(e,[{key:"createRenderer",value:function(e,t){var n=this,r=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){var i=this._rendererCache.get(r);return i||(i=new jB("",r,this.engine),this._rendererCache.set(r,i)),i}var a=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);return t.data.animation.forEach(function t(r){Array.isArray(r)?r.forEach(t):n.engine.registerTrigger(a,o,e,r.name,r)}),new ZB(this,o,r,this.engine)}},{key:"begin",value:function(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}},{key:"_scheduleCountTask",value:function(){var e=this;this.promise.then(function(){e._microtaskId++})}},{key:"scheduleListenerCallback",value:function(e,t,n){var r=this;e>=0&&e<this._microtaskId?this._zone.run(function(){return t(n)}):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(function(){r._zone.run(function(){r._animationCallbacksBuffer.forEach(function(e){var t=Pg(e,2);(0,t[0])(t[1])}),r._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}},{key:"end",value:function(){var e=this;this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(function(){e._scheduleCountTask(),e.engine.flush(e._microtaskId)}),this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.engine.whenRenderingDone()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(lO),pC(CB),pC(eI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),jB=function(){function e(t,n,r){Wg(this,e),this.namespaceId=t,this.delegate=n,this.engine=r,this.destroyNode=this.delegate.destroyNode?function(e){return n.destroyNode(e)}:null}return jg(e,[{key:"data",get:function(){return this.delegate.data}},{key:"destroy",value:function(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}},{key:"createElement",value:function(e,t){return this.delegate.createElement(e,t)}},{key:"createComment",value:function(e){return this.delegate.createComment(e)}},{key:"createText",value:function(e){return this.delegate.createText(e)}},{key:"appendChild",value:function(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}},{key:"insertBefore",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}},{key:"removeChild",value:function(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}},{key:"selectRootElement",value:function(e,t){return this.delegate.selectRootElement(e,t)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setAttribute",value:function(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)&&t==WB?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}},{key:"setValue",value:function(e,t){this.delegate.setValue(e,t)}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"disableAnimations",value:function(e,t){this.engine.disableAnimations(e,t)}}]),e}(),ZB=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,r,i,a)).factory=e,o.namespaceId=r,o}return jg(n,[{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==WB?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){var r=this;if("@"==t.charAt(0)){var i,a=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e),o=t.substr(1),s="";return"@"!=o.charAt(0)&&(o=(i=Pg(function(e){var t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(o),2))[0],s=i[1]),this.engine.listen(this.namespaceId,a,o,s,function(e){r.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}]),n}(jB),YB=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){return Wg(this,n),t.call(this,e.body,r,i)}return jg(n,[{key:"ngOnDestroy",value:function(){this.flush()}}]),n}(CB);return e.\u0275fac=function(t){return new(t||e)(pC(xI),pC(WF),pC(zU))},e.\u0275prov=dm({token:e,factory:e.\u0275fac}),e}(),KB=new Y_("AnimationModuleType"),QB=[{provide:yF,useClass:zB},{provide:zU,useFactory:function(){return new HU}},{provide:CB,useClass:YB},{provide:lO,useFactory:function(e,t,n){return new qB(e,t,n)},deps:[lx,CB,eI]}],XB=[{provide:WF,useFactory:function(){return"function"==typeof VB()?new BB:new FB}},{provide:KB,useValue:"BrowserAnimations"}].concat(QB),JB=[{provide:WF,useClass:$F},{provide:KB,useValue:"NoopAnimations"}].concat(QB),eV=function(){var e=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"withConfig",value:function(t){return{ngModule:e,providers:t.disableAnimations?JB:XB}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:XB,imports:[Ex]}),e}(),tV=Tg(2616),nV=Tg.n(tV);function rV(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function iV(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){rV(a,r,i,o,s,"next",e)}function s(e){rV(a,r,i,o,s,"throw",e)}o(void 0)})}}var aV=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"expectToBe",value:function(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error("A default switch case did not observe the correct value, expected ".concat(t,", but got ").concat(e," instead."))}},{key:"expectToBeMultiple",value:function(e,t){var n,r=!1,i=Hg(t);try{for(i.s();!(n=i.n()).done;){if(e===n.value){r=!0;break}}}catch(a){i.e(a)}finally{i.f()}if(!1===r)throw new Error("A default switch case did not observe the correct value, expected a value among ".concat(t,", but got ").concat(e," instead."))}},{key:"getNonNullable",value:function(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}]),e}();function oV(e,t){e&&console.log(t)}function sV(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);for(var n=e,r=t,i=0,a=Object.keys(n);i<a.length;i++){var o=a[i];if(!(o in r))return!1;if(!1===sV(n[o],r[o]))return!1}return!0}return e===t}function uV(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(var t in e)if(null!=e[t]&&!1===uV(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function cV(e,t){if(uV(e)&&uV(t))return sV(e,t);throw new Error("Comparing non comparable objects: ".concat(e.constructor.name," and ").concat(t.constructor.name))}var lV=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"isPresent",value:function(){return null!=this.value}},{key:"isAbsent",value:function(){return null==this.value}},{key:"get",value:function(){if(this.isPresent())return this.value;throw new Error("Value is absent")}},{key:"getOrElse",value:function(e){return this.isPresent()?this.value:e}},{key:"equals",value:function(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&cV(this.value,e.value)}},{key:"equalsValue",value:function(t){return this.equals(e.of(t))}},{key:"toString",value:function(){return this.isAbsent()?"MGPOptional.empty()":"MGPOptional.of(".concat(this.value,")")}},{key:"map",value:function(t){return this.isPresent()?e.of(t(this.get())):e.empty()}}],[{key:"of",value:function(t){return new e(t)}},{key:"ofNullable",value:function(t){return null==t?e.empty():e.of(t)}},{key:"empty",value:function(){return new e(null)}}]),e}(),hV=function(e,t){if(!e)throw fV(t)},fV=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},dV=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},vV={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=(15&s)<<2|c>>6,h=63&c;u||(h=64,o||(l=64)),r.push(n[a>>2],n[(3&a)<<4|s>>4],n[l],n[h])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(dV(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw Error();r.push(a<<2|o>>4),64!==s&&(r.push(o<<4&240|s>>2),64!==u&&r.push(s<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},pV=function(e){var t=dV(e);return vV.encodeByteArray(t,!0)},gV=function(e){return pV(e).replace(/\./g,"")},yV=function(e){try{return vV.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function mV(e){return kV(void 0,e)}function kV(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)!t.hasOwnProperty(n)||!_V(n)||(e[n]=kV(e[n],t[n]));return e}function _V(e){return"__proto__"!==e}var CV=function(){function e(){var t=this;Wg(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return jg(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch(function(){}),1===e.length?e(n):e(n,r))}}}]),e}();function wV(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[gV(JSON.stringify({alg:"none",type:"JWT"})),gV(JSON.stringify(a)),""].join(".")}function bV(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function EV(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(bV())}function SV(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function PV(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function OV(){var e=bV();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function TV(){return"object"==typeof indexedDB}function IV(){return new Promise(function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function AV(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}var xV=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,r)).code=e,a.customData=i,a.name="FirebaseError",Object.setPrototypeOf(Fg(a),n.prototype),Error.captureStackTrace&&Error.captureStackTrace(Fg(a),RV.prototype.create),a}return jg(n)}(Ig(Error)),RV=function(){function e(t,n,r){Wg(this,e),this.service=t,this.serviceName=n,this.errors=r}return jg(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(MV,function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error";return new xV(n,"".concat(this.serviceName,": ").concat(i," (").concat(n,")."),t)}}]),e}(),MV=/\{\$([^}]+)}/g;function NV(e){return JSON.parse(e)}function DV(e){return JSON.stringify(e)}var LV=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=NV(yV(a[0])||""),n=NV(yV(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}};function FV(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function UV(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function BV(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function VV(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function zV(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(HV(s)&&HV(u)){if(!zV(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function HV(e){return null!==e&&"object"==typeof e}function GV(e){for(var t=[],n=function(){var e=Pg(i[r],2),n=e[0],a=e[1];Array.isArray(a)?a.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))},r=0,i=Object.entries(e);r<i.length;r++)n();return t.length?"&"+t.join("&"):""}function $V(e){var t={};return e.replace(/^\?/,"").split("&").forEach(function(e){if(e){var n=Pg(e.split("="),2),r=n[0],i=n[1];t[decodeURIComponent(r)]=decodeURIComponent(i)}}),t}function WV(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}var qV=function(){function e(){Wg(this,e),this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return jg(e,[{key:"reset",value:function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}},{key:"compress_",value:function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(var i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(var a=16;a<80;a++){var o=n[a-3]^n[a-8]^n[a-14]^n[a-16];n[a]=4294967295&(o<<1|o>>>31)}for(var s,u,c=this.chain_[0],l=this.chain_[1],h=this.chain_[2],f=this.chain_[3],d=this.chain_[4],v=0;v<80;v++){v<40?v<20?(s=f^l&(h^f),u=1518500249):(s=l^h^f,u=1859775393):v<60?(s=l&h|f&(l|h),u=2400959708):(s=l^h^f,u=3395469782);var p=(c<<5|c>>>27)+s+d+u+n[v]&4294967295;d=f,f=h,h=4294967295&(l<<30|l>>>2),l=c,c=p}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+f&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295}},{key:"update",value:function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;r<t;){if(0===a)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[a]=e.charCodeAt(r),++r,++a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++r,++a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}}},{key:"digest",value:function(){var e=[],t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,i=0;i<5;i++)for(var a=24;a>=0;a-=8)e[r]=this.chain_[i]>>a&255,++r;return e}}]),e}(),jV=function(){function e(t,n){var r=this;Wg(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(function(){t(r)}).catch(function(e){r.error(e)})}return jg(e,[{key:"next",value:function(e){this.forEachObserver(function(t){t.next(e)})}},{key:"error",value:function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)}},{key:"complete",value:function(){this.forEachObserver(function(e){e.complete()}),this.close()}},{key:"subscribe",value:function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=ZV),void 0===r.error&&(r.error=ZV),void 0===r.complete&&(r.complete=ZV);var a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),a}},{key:"unsubscribeOne",value:function(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))}}]),e}();function ZV(){}function YV(e,t){return"".concat(e," failed: ").concat(t," argument ")}var KV=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function QV(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function XV(e){return e&&e._delegate?e._delegate:e}var JV,ez,tz=function(){function e(t,n,r){Wg(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return jg(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),nz="[DEFAULT]",rz=function(){function e(t,n){Wg(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return jg(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new CV;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:nz})}catch(u){}var t,n=Hg(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=Pg(t.value,2),i=r[0],a=r[1],o=this.normalizeInstanceIdentifier(i);try{var s=this.getOrInitializeService({instanceIdentifier:o});a.resolve(s)}catch(c){}}}catch(l){n.e(l)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nz;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Array.from(e.instances.values()),t.next=3,Promise.all([].concat(Vg(n.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()})),Vg(n.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))));case 3:case"end":return t.stop()}},t)}))()}},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nz;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nz;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),o=Hg(this.instancesDeferred.entries());try{for(o.s();!(i=o.n()).done;){var s=Pg(i.value,2),u=s[0],c=s[1];r===this.normalizeInstanceIdentifier(u)&&c.resolve(a)}}catch(l){o.e(l)}finally{o.f()}return a}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(o){}}}catch(s){i.e(s)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===nz?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nz;return this.component?this.component.multipleInstances?e:nz:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}(),iz=function(){function e(t){Wg(this,e),this.name=t,this.providers=new Map}return jg(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new rz(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}(),az=[],oz=function(){return(e=oz||(oz={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",oz;var e}(),sz={debug:oz.DEBUG,verbose:oz.VERBOSE,info:oz.INFO,warn:oz.WARN,error:oz.ERROR,silent:oz.SILENT},uz=oz.INFO,cz=(Sg(Rg={},oz.DEBUG,"log"),Sg(Rg,oz.VERBOSE,"log"),Sg(Rg,oz.INFO,"info"),Sg(Rg,oz.WARN,"warn"),Sg(Rg,oz.ERROR,"error"),Rg),lz=function(e,t){var n;if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=cz[t];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(n=console)[i].apply(n,["[".concat(r,"]  ").concat(e.name,":")].concat(o))}},hz=function(){function e(t){Wg(this,e),this.name=t,this._logLevel=uz,this._logHandler=lz,this._userLogHandler=null,az.push(this)}return jg(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in oz))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"==typeof e?sz[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,oz.DEBUG].concat(t)),this._logHandler.apply(this,[this,oz.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,oz.VERBOSE].concat(t)),this._logHandler.apply(this,[this,oz.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,oz.INFO].concat(t)),this._logHandler.apply(this,[this,oz.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,oz.WARN].concat(t)),this._logHandler.apply(this,[this,oz.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,oz.ERROR].concat(t)),this._logHandler.apply(this,[this,oz.ERROR].concat(t))}}]),e}(),fz=new WeakMap,dz=new WeakMap,vz=new WeakMap,pz=new WeakMap,gz=new WeakMap,yz={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return dz.get(e);if("objectStoreNames"===t)return e.objectStoreNames||vz.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return mz(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function mz(e){if(e instanceof IDBRequest)return function(e){var t=new Promise(function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(mz(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(function(t){t instanceof IDBCursor&&fz.set(t,e)}).catch(function(){}),gz.set(t,e),t}(e);if(pz.has(e))return pz.get(e);var t=function(e){return"function"==typeof e?function(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ez||(ez=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(kz(this),n),mz(fz.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return mz(e.apply(kz(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[kz(this),t].concat(r));return vz.set(a,t.sort?t.sort():[t]),mz(a)}}(e):(e instanceof IDBTransaction&&function(e){if(!dz.has(e)){var t=new Promise(function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});dz.set(e,t)}}(e),function(e,t){return t.some(function(t){return e instanceof t})}(e,JV||(JV=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,yz):e)}(e);return t!==e&&(pz.set(e,t),gz.set(t,e)),t}var kz=function(e){return gz.get(e)};function _z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=mz(s);return i&&s.addEventListener("upgradeneeded",function(e){i(mz(s.result),e.oldVersion,e.newVersion,mz(s.transaction))}),r&&s.addEventListener("blocked",function(){return r()}),u.then(function(e){o&&e.addEventListener("close",function(){return o()}),a&&e.addEventListener("versionchange",function(){return a()})}).catch(function(){}),u}function Cz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,r=indexedDB.deleteDatabase(e);return n&&r.addEventListener("blocked",function(){return n()}),mz(r).then(function(){})}var wz,bz=["get","getKey","getAll","getAllKeys","count"],Ez=["put","add","delete","clear"],Sz=new Map;function Pz(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Sz.get(t))return Sz.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=Ez.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||bz.includes(n))){var a,o=(a=iV(regeneratorRuntime.mark(function e(t){var a,o,s,u,c,l,h=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=this.transaction(t,i?"readwrite":"readonly"),s=o.store,u=h.length,c=new Array(u>1?u-1:0),l=1;l<u;l++)c[l-1]=h[l];return r&&(s=s.index(c.shift())),e.next=6,Promise.all([(a=s)[n].apply(a,c),i&&o.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)});return Sz.set(t,o),o}}}yz=Eg(Eg({},wz=yz),{},{get:function(e,t,n){return Pz(e,t)||wz.get(e,t,n)},has:function(e,t){return!!Pz(e,t)||wz.has(e,t)}});var Oz=function(){function e(t){Wg(this,e),this.container=t}return jg(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map(function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(function(e){return e}).join(" ")}}]),e}(),Tz="@firebase/app",Iz=new hz("@firebase/app"),Az="[DEFAULT]",xz=(Sg(Ng={},Tz,"fire-core"),Sg(Ng,"@firebase/app-compat","fire-core-compat"),Sg(Ng,"@firebase/analytics","fire-analytics"),Sg(Ng,"@firebase/analytics-compat","fire-analytics-compat"),Sg(Ng,"@firebase/app-check","fire-app-check"),Sg(Ng,"@firebase/app-check-compat","fire-app-check-compat"),Sg(Ng,"@firebase/auth","fire-auth"),Sg(Ng,"@firebase/auth-compat","fire-auth-compat"),Sg(Ng,"@firebase/database","fire-rtdb"),Sg(Ng,"@firebase/database-compat","fire-rtdb-compat"),Sg(Ng,"@firebase/functions","fire-fn"),Sg(Ng,"@firebase/functions-compat","fire-fn-compat"),Sg(Ng,"@firebase/installations","fire-iid"),Sg(Ng,"@firebase/installations-compat","fire-iid-compat"),Sg(Ng,"@firebase/messaging","fire-fcm"),Sg(Ng,"@firebase/messaging-compat","fire-fcm-compat"),Sg(Ng,"@firebase/performance","fire-perf"),Sg(Ng,"@firebase/performance-compat","fire-perf-compat"),Sg(Ng,"@firebase/remote-config","fire-rc"),Sg(Ng,"@firebase/remote-config-compat","fire-rc-compat"),Sg(Ng,"@firebase/storage","fire-gcs"),Sg(Ng,"@firebase/storage-compat","fire-gcs-compat"),Sg(Ng,"@firebase/firestore","fire-fst"),Sg(Ng,"@firebase/firestore-compat","fire-fst-compat"),Sg(Ng,"fire-js","fire-js"),Sg(Ng,"firebase","fire-js-all"),Ng),Rz=new Map,Mz=new Map;function Nz(e,t){try{e.container.addComponent(t)}catch(n){Iz.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function Dz(e){var t=e.name;if(Mz.has(t))return Iz.debug("There were multiple attempts to register component ".concat(t,".")),!1;Mz.set(t,e);var n,r=Hg(Rz.values());try{for(r.s();!(n=r.n()).done;){Nz(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function Lz(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}var Fz=new RV("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."}),Uz=function(){function e(t,n,r){var i=this;Wg(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new tz("app",function(){return i},"PUBLIC"))}return jg(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw Fz.create("app-deleted",{appName:this._name})}}]),e}(),Bz="9.9.0";function Vz(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Az,t=Rz.get(e);if(!t)throw Fz.create("no-app",{appName:e});return t}function zz(){return Array.from(Rz.values())}function Hz(e,t,n){var r,i=null!==(r=xz[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Iz.warn(s.join(" "))}Dz(new tz("".concat(i,"-version"),function(){return{library:i,version:t}},"VERSION"))}var Gz="firebase-heartbeat-store",$z=null;function Wz(){return $z||($z=_z("firebase-heartbeat-database",1,{upgrade:function(e,t){switch(t){case 0:e.createObjectStore(Gz)}}}).catch(function(e){throw Fz.create("storage-open",{originalErrorMessage:e.message})})),$z}function qz(){return(qz=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wz();case 3:return e.abrupt("return",e.sent.transaction(Gz).objectStore(Gz).get(Yz(t)));case 6:throw e.prev=6,e.t0=e.catch(0),Fz.create("storage-get",{originalErrorMessage:null===(n=e.t0)||void 0===n?void 0:n.message});case 9:case"end":return e.stop()}},e,null,[[0,6]])}))).apply(this,arguments)}function jz(e,t){return Zz.apply(this,arguments)}function Zz(){return(Zz=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wz();case 3:return i=e.sent.transaction(Gz,"readwrite"),e.next=6,i.objectStore(Gz).put(n,Yz(t));case 6:return e.abrupt("return",i.done);case 9:throw e.prev=9,e.t0=e.catch(0),Fz.create("storage-set",{originalErrorMessage:null===(r=e.t0)||void 0===r?void 0:r.message});case 12:case"end":return e.stop()}},e,null,[[0,9]])}))).apply(this,arguments)}function Yz(e){return"".concat(e.name,"!").concat(e.options.appId)}var Kz=function(){function e(t){var n=this;Wg(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new Xz(r),this._heartbeatsCachePromise=this._storage.read().then(function(e){return n._heartbeatsCache=e,e})}return jg(e,[{key:"triggerHeartbeat",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Qz(),t.t0=null===e._heartbeatsCache,!t.t0){t.next=6;break}return t.next=5,e._heartbeatsCachePromise;case 5:e._heartbeatsCache=t.sent;case 6:if(e._heartbeatsCache.lastSentHeartbeatDate===r||e._heartbeatsCache.heartbeats.some(function(e){return e.date===r})){t.next=8;break}return t.abrupt("return",(e._heartbeatsCache.heartbeats.push({date:r,agent:n}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),e._storage.overwrite(e._heartbeatsCache)));case 8:case"end":return t.stop()}},t)}))()}},{key:"getHeartbeatsHeader",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===e._heartbeatsCache,!t.t0){t.next=4;break}return t.next=4,e._heartbeatsCachePromise;case 4:if(null!==e._heartbeatsCache&&0!==e._heartbeatsCache.heartbeats.length){t.next=6;break}return t.abrupt("return","");case 6:if(n=Qz(),r=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,r=[],i=e.slice(),a=Hg(e);try{var o=function(){var e=t.value,a=r.find(function(t){return t.agent===e.agent});if(a){if(a.dates.push(e.date),Jz(r)>n)return a.dates.pop(),"break"}else if(r.push({agent:e.agent,dates:[e.date]}),Jz(r)>n)return r.pop(),"break";i=i.slice(1)};for(a.s();!(t=a.n()).done;){var s=o();if("break"===s)break}}catch(u){a.e(u)}finally{a.f()}return{heartbeatsToSend:r,unsentEntries:i}}(e._heartbeatsCache.heartbeats),i=r.heartbeatsToSend,a=r.unsentEntries,o=gV(JSON.stringify({version:2,heartbeats:i})),e._heartbeatsCache.lastSentHeartbeatDate=n,!(a.length>0)){t.next=14;break}return e._heartbeatsCache.heartbeats=a,t.next=12,e._storage.overwrite(e._heartbeatsCache);case 12:t.next=15;break;case 14:e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache);case 15:return t.abrupt("return",o);case 16:case"end":return t.stop()}},t)}))()}}]),e}();function Qz(){return(new Date).toISOString().substring(0,10)}var Xz=function(){function e(t){Wg(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return jg(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){return iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!TV()&&IV().then(function(){return!0}).catch(function(){return!1}));case 1:case"end":return e.stop()}},e)}))()}},{key:"read",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._canUseIndexedDBPromise;case 2:if(t.t1=t.sent,!t.t1){t.next=7;break}return t.next=6,function(e){return qz.apply(this,arguments)}(e.app);case 6:t.t1=t.sent;case 7:if(t.t0=t.t1,t.t0){t.next=10;break}t.t0={heartbeats:[]};case 10:return t.abrupt("return",t.t0);case 11:case"end":return t.stop()}},t)}))()}},{key:"overwrite",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._canUseIndexedDBPromise;case 2:if(!n.sent){n.next=7;break}return n.next=5,t.read();case 5:return i=n.sent,n.abrupt("return",jz(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:i.lastSentHeartbeatDate,heartbeats:e.heartbeats}));case 7:case"end":return n.stop()}},n)}))()}},{key:"add",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._canUseIndexedDBPromise;case 2:if(!n.sent){n.next=7;break}return n.next=5,t.read();case 5:return i=n.sent,n.abrupt("return",jz(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:i.lastSentHeartbeatDate,heartbeats:[].concat(Vg(i.heartbeats),Vg(e.heartbeats))}));case 7:case"end":return n.stop()}},n)}))()}}]),e}();function Jz(e){return gV(JSON.stringify({version:2,heartbeats:e})).length}Dz(new tz("platform-logger",function(e){return new Oz(e)},"PRIVATE")),Dz(new tz("heartbeat",function(e){return new Kz(e)},"PRIVATE")),Hz(Tz,"0.7.28",""),Hz(Tz,"0.7.28","esm2017"),Hz("fire-js",""),Hz("firebase","9.9.0","app");var eH="@firebase/installations",tH="0.5.12",nH="w:".concat(tH),rH="FIS_v2",iH=new RV("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function aH(e){return e instanceof xV&&e.code.includes("request-failed")}function oH(e){var t=e.projectId;return"https://firebaseinstallations.googleapis.com/v1/projects/".concat(t,"/installations")}function sH(e){return{token:e.token,requestStatus:2,expiresIn:vH(e.expiresIn),creationTime:Date.now()}}function uH(e,t){return cH.apply(this,arguments)}function cH(){return(cH=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:return r=e.sent.error,e.abrupt("return",iH.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status}));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function lH(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function hH(e,t){var n=t.refreshToken,r=lH(e);return r.append("Authorization",function(e){return"".concat(rH," ").concat(e)}(n)),r}function fH(e){return dH.apply(this,arguments)}function dH(){return(dH=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return n=e.sent,e.abrupt("return",n.status>=500&&n.status<600?t():n);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function vH(e){return Number(e.replace("s","000"))}function pH(e,t){return gH.apply(this,arguments)}function gH(){return(gH=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c,l,h,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,a=n.fid,o=oH(r),s=lH(r),!(u=i.getImmediate({optional:!0}))){e.next=8;break}return e.next=6,u.getHeartbeatsHeader();case 6:(c=e.sent)&&s.append("x-firebase-client",c);case 8:return l={method:"POST",headers:s,body:JSON.stringify({fid:a,authVersion:rH,appId:r.appId,sdkVersion:nH})},e.next=11,fH(function(){return fetch(o,l)});case 11:if(!(h=e.sent).ok){e.next=17;break}return e.next=15,h.json();case 15:return f=e.sent,e.abrupt("return",{fid:f.fid||a,registrationStatus:2,refreshToken:f.refreshToken,authToken:sH(f.authToken)});case 17:return e.next=19,uH("Create Installation",h);case 19:throw e.sent;case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function yH(e){return new Promise(function(t){setTimeout(t,e)})}var mH=/^[cdef][\w-]{21}$/;function kH(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){return function(e){return btoa(String.fromCharCode.apply(String,Vg(e))).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return mH.test(t)?t:""}catch(n){return""}}function _H(e){return"".concat(e.appName,"!").concat(e.appId)}var CH=new Map;function wH(e,t){var n=_H(e);bH(n,t),function(e,t){var n=(!EH&&"BroadcastChannel"in self&&((EH=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){bH(e.data.key,e.data.fid)}),EH);n&&n.postMessage({key:e,fid:t}),0===CH.size&&EH&&(EH.close(),EH=null)}(n,t)}function bH(e,t){var n=CH.get(e);if(n){var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t)}}catch(a){i.e(a)}finally{i.f()}}}var EH=null,SH="firebase-installations-store",PH=null;function OH(){return PH||(PH=_z("firebase-installations-database",1,{upgrade:function(e,t){switch(t){case 0:e.createObjectStore(SH)}}})),PH}function TH(e,t){return IH.apply(this,arguments)}function IH(){return(IH=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_H(t),e.next=3,OH();case 3:return i=e.sent.transaction(SH,"readwrite"),a=i.objectStore(SH),e.next=7,a.get(r);case 7:return o=e.sent,e.next=10,a.put(n,r);case 10:return e.next=12,i.done;case 12:return(!o||o.fid!==n.fid)&&wH(t,n.fid),e.abrupt("return",n);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function AH(e){return xH.apply(this,arguments)}function xH(){return(xH=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=_H(t),e.next=3,OH();case 3:return r=e.sent.transaction(SH,"readwrite"),e.next=6,r.objectStore(SH).delete(n);case 6:return e.next=8,r.done;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function RH(e,t){return MH.apply(this,arguments)}function MH(){return(MH=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_H(t),e.next=3,OH();case 3:return i=e.sent.transaction(SH,"readwrite"),a=i.objectStore(SH),e.next=7,a.get(r);case 7:if(o=e.sent,void 0!==(s=n(o))){e.next=14;break}return e.next=12,a.delete(r);case 12:e.next=16;break;case 14:return e.next=16,a.put(s,r);case 16:return e.next=18,i.done;case 18:return s&&(!o||o.fid!==s.fid)&&wH(t,s.fid),e.abrupt("return",s);case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function NH(e){return DH.apply(this,arguments)}function DH(){return(DH=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,RH(t.appConfig,function(e){var r=LH(e),i=FH(t,r);return n=i.registrationPromise,i.installationEntry});case 2:if(""!==(r=e.sent).fid){e.next=10;break}return e.next=6,n;case 6:e.t1=e.sent,e.t0={installationEntry:e.t1},e.next=11;break;case 10:e.t0={installationEntry:r,registrationPromise:n};case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function LH(e){return HH(e||{fid:kH(),registrationStatus:0})}function FH(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(iH.create("app-offline"))};var n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return UH.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:BH(e)}:{installationEntry:t}}function UH(){return(UH=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pH(t,n);case 3:return r=e.sent,e.abrupt("return",TH(t.appConfig,r));case 7:if(e.prev=7,e.t0=e.catch(0),!aH(e.t0)||409!==e.t0.customData.serverCode){e.next=14;break}return e.next=12,AH(t.appConfig);case 12:e.next=16;break;case 14:return e.next=16,TH(t.appConfig,{fid:n.fid,registrationStatus:0});case 16:throw e.t0;case 17:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}function BH(e){return VH.apply(this,arguments)}function VH(){return(VH=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zH(t.appConfig);case 2:n=e.sent;case 3:if(1!==n.registrationStatus){e.next=11;break}return e.next=6,yH(100);case 6:return e.next=8,zH(t.appConfig);case 8:n=e.sent;case 9:e.next=3;break;case 11:if(0!==n.registrationStatus){e.next=18;break}return e.next=14,NH(t);case 14:return r=e.sent,i=r.installationEntry,a=r.registrationPromise,e.abrupt("return",a||i);case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function zH(e){return RH(e,function(e){if(!e)throw iH.create("installation-not-found");return HH(e)})}function HH(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function GH(e,t){return $H.apply(this,arguments)}function $H(){return($H=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,a=WH(r,n),o=hH(r,n),!(s=i.getImmediate({optional:!0}))){e.next=7;break}return e.next=5,s.getHeartbeatsHeader();case 5:(u=e.sent)&&o.append("x-firebase-client",u);case 7:return c={method:"POST",headers:o,body:JSON.stringify({installation:{sdkVersion:nH,appId:r.appId}})},e.next=10,fH(function(){return fetch(a,c)});case 10:if(!(l=e.sent).ok){e.next=17;break}return e.t0=sH,e.next=15,l.json();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 17:return e.next=19,uH("Generate Auth Token",l);case 19:throw e.sent;case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function WH(e,t){var n=t.fid;return"".concat(oH(e),"/").concat(n,"/authTokens:generate")}function qH(e){return jH.apply(this,arguments)}function jH(){return(jH=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],e.next=3,RH(t.appConfig,function(e){if(!JH(e))throw iH.create("not-registered");var i=e.authToken;if(!n&&eG(i))return e;if(1===i.requestStatus)return r=ZH(t,n),e;if(!navigator.onLine)throw iH.create("app-offline");var a=tG(e);return r=QH(t,a),a});case 3:if(i=e.sent,!r){e.next=10;break}return e.next=7,r;case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=i.authToken;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ZH(e,t){return YH.apply(this,arguments)}function YH(){return(YH=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,KH(t.appConfig);case 2:r=e.sent;case 3:if(1!==r.authToken.requestStatus){e.next=11;break}return e.next=6,yH(100);case 6:return e.next=8,KH(t.appConfig);case 8:r=e.sent;case 9:e.next=3;break;case 11:return i=r.authToken,e.abrupt("return",0===i.requestStatus?qH(t,n):i);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function KH(e){return RH(e,function(e){if(!JH(e))throw iH.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function QH(e,t){return XH.apply(this,arguments)}function XH(){return(XH=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GH(t,n);case 3:return r=e.sent,i=Object.assign(Object.assign({},n),{authToken:r}),e.next=7,TH(t.appConfig,i);case 7:return e.abrupt("return",r);case 10:if(e.prev=10,e.t0=e.catch(0),aH(e.t0)&&(401===e.t0.customData.serverCode||404===e.t0.customData.serverCode)){e.next=18;break}return a=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),e.next=16,TH(t.appConfig,a);case 16:e.next=20;break;case 18:return e.next=20,AH(t.appConfig);case 20:throw e.t0;case 21:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function JH(e){return void 0!==e&&2===e.registrationStatus}function eG(e){return 2===e.requestStatus&&!function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function tG(e){var t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function nG(){return(nG=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,NH(n);case 3:return r=e.sent,i=r.installationEntry,a=r.registrationPromise,e.abrupt("return",(a?a.catch(console.error):qH(n).catch(console.error),i.fid));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rG(){return(rG=iV(regeneratorRuntime.mark(function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],r=t,e.next=4,iG(r);case 4:return e.next=6,qH(r,n);case 6:return e.abrupt("return",e.sent.token);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iG(e){return aG.apply(this,arguments)}function aG(){return(aG=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,NH(t);case 2:if(n=e.sent,r=n.registrationPromise,e.t0=r,!e.t0){e.next=8;break}return e.next=8,r;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oG(e){return iH.create("missing-app-config-values",{valueName:e})}var sG="installations";Dz(new tz(sG,function(e){var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw oG("App Configuration");if(!e.name)throw oG("App Name");for(var t=0,n=["projectId","apiKey","appId"];t<n.length;t++){var r=n[t];if(!e.options[r])throw oG(r)}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Lz(t,"heartbeat"),_delete:function(){return Promise.resolve()}}},"PUBLIC")),Dz(new tz("installations-internal",function(e){var t=Lz(e.getProvider("app").getImmediate(),sG).getImmediate();return{getId:function(){return function(e){return nG.apply(this,arguments)}(t)},getToken:function(e){return function(e){return rG.apply(this,arguments)}(t,e)}}},"PRIVATE")),Hz(eH,tH),Hz(eH,tH,"esm2017");var uG="@firebase/remote-config",cG=new RV("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"}),lG=function(){function e(t,n,r,i){Wg(this,e),this.client=t,this.storage=n,this.storageCache=r,this.logger=i}return jg(e,[{key:"isCachedDataFresh",value:function(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check. Cache age millis: ".concat(n,". Cache max age millis (minimumFetchIntervalMillis setting): ").concat(e,". Is cache hit: ").concat(r,".")),r}},{key:"fetch",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);case 2:if(r=n.sent,i=Pg(r,2),a=i[0],!(o=i[1])||!t.isCachedDataFresh(e.cacheMaxAgeMillis,a)){n.next=8;break}return n.abrupt("return",o);case 8:return e.eTag=o&&o.eTag,n.next=11,t.client.fetch(e);case 11:return s=n.sent,u=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===s.status&&u.push(t.storage.setLastSuccessfulFetchResponse(s)),n.next=16,Promise.all(u);case 16:return n.abrupt("return",s);case 17:case"end":return n.stop()}},n)}))()}}]),e}();function hG(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator;return e.languages&&e.languages[0]||e.language}var fG=function(){function e(t,n,r,i,a,o){Wg(this,e),this.firebaseInstallations=t,this.sdkVersion=n,this.namespace=r,this.projectId=i,this.apiKey=a,this.appId=o}return jg(e,[{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u,c,l,h,f,d,v,p,g,y,m,k,_,C,w;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]);case 2:return o=n.sent,s=Pg(o,2),u=s[0],c=s[1],l="".concat(window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com","/v1/projects/").concat(t.projectId,"/namespaces/").concat(t.namespace,":fetch?key=").concat(t.apiKey),h={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},f={sdk_version:t.sdkVersion,app_instance_id:u,app_instance_id_token:c,app_id:t.appId,language_code:hG()},d={method:"POST",headers:h,body:JSON.stringify(f)},v=fetch(l,d),p=new Promise(function(t,n){e.signal.addEventListener(function(){var e=new Error("The operation was aborted.");e.name="AbortError",n(e)})}),n.prev=12,n.next=15,Promise.race([v,p]);case 15:return n.next=17,v;case 17:g=n.sent,n.next=24;break;case 20:throw n.prev=20,n.t0=n.catch(12),y="fetch-client-network","AbortError"===(null===(r=n.t0)||void 0===r?void 0:r.name)&&(y="fetch-timeout"),cG.create(y,{originalErrorMessage:null===(i=n.t0)||void 0===i?void 0:i.message});case 24:if(m=g.status,k=g.headers.get("ETag")||void 0,200!==g.status){n.next=37;break}return n.prev=27,n.next=30,g.json();case 30:w=n.sent,n.next=36;break;case 33:throw n.prev=33,n.t1=n.catch(27),cG.create("fetch-client-parse",{originalErrorMessage:null===(a=n.t1)||void 0===a?void 0:a.message});case 36:_=w.entries,C=w.state;case 37:if("INSTANCE_STATE_UNSPECIFIED"===C?m=500:"NO_CHANGE"===C?m=304:("NO_TEMPLATE"===C||"EMPTY_CONFIG"===C)&&(_={}),304===m||200===m){n.next=39;break}throw cG.create("fetch-status",{httpStatus:m});case 39:return n.abrupt("return",{status:m,eTag:k,config:_});case 40:case"end":return n.stop()}},n,null,[[12,20],[27,33]])}))()})}]),e}(),dG=function(){function e(t,n){Wg(this,e),this.client=t,this.storage=n}return jg(e,[{key:"fetch",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.storage.getThrottleMetadata();case 2:if(n.t0=n.sent,n.t0){n.next=5;break}n.t0={backoffCount:0,throttleEndTimeMillis:Date.now()};case 5:return r=n.t0,n.abrupt("return",t.attemptFetch(e,r));case 7:case"end":return n.stop()}},n)}))()}},{key:"attemptFetch",value:function(e,t){var n=t.throttleEndTimeMillis,r=t.backoffCount,i=this;return iV(regeneratorRuntime.mark(function t(){var a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,function(e,t){return new Promise(function(n,r){var i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener(function(){clearTimeout(a),r(cG.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,n);case 2:return t.prev=2,t.next=5,i.client.fetch(e);case 5:return a=t.sent,t.next=8,i.storage.deleteThrottleMetadata();case 8:return t.abrupt("return",a);case 11:if(t.prev=11,t.t0=t.catch(2),function(e){if(!(e instanceof xV&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t.t0)){t.next=15;break}throw t.t0;case 15:return o={throttleEndTimeMillis:Date.now()+QV(r),backoffCount:r+1},t.next=18,i.storage.setThrottleMetadata(o);case 18:return t.abrupt("return",i.attemptFetch(e,o));case 19:case"end":return t.stop()}},t,null,[[2,11]])}))()}}]),e}(),vG=function(){function e(t,n,r,i,a){Wg(this,e),this.app=t,this._client=n,this._storageCache=r,this._storage=i,this._logger=a,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return jg(e,[{key:"fetchTimeMillis",get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}},{key:"lastFetchStatus",get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}]),e}();function pG(e,t){var n,r=e.target.error||void 0;return cG.create(t,{originalErrorMessage:r&&(null===(n=r)||void 0===n?void 0:n.message)})}var gG="app_namespace_store",yG=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Promise(function(e,t){var n;try{var i=indexedDB.open("firebase_remote_config",1);i.onerror=function(e){t(pG(e,"storage-open"))},i.onsuccess=function(t){e(t.target.result)},i.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(gG,{keyPath:"compositeKey"})}}}catch(r){t(cG.create("storage-open",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message}))}});Wg(this,e),this.appId=t,this.appName=n,this.namespace=r,this.openDbPromise=i}return jg(e,[{key:"getLastFetchStatus",value:function(){return this.get("last_fetch_status")}},{key:"setLastFetchStatus",value:function(e){return this.set("last_fetch_status",e)}},{key:"getLastSuccessfulFetchTimestampMillis",value:function(){return this.get("last_successful_fetch_timestamp_millis")}},{key:"setLastSuccessfulFetchTimestampMillis",value:function(e){return this.set("last_successful_fetch_timestamp_millis",e)}},{key:"getLastSuccessfulFetchResponse",value:function(){return this.get("last_successful_fetch_response")}},{key:"setLastSuccessfulFetchResponse",value:function(e){return this.set("last_successful_fetch_response",e)}},{key:"getActiveConfig",value:function(){return this.get("active_config")}},{key:"setActiveConfig",value:function(e){return this.set("active_config",e)}},{key:"getActiveConfigEtag",value:function(){return this.get("active_config_etag")}},{key:"setActiveConfigEtag",value:function(e){return this.set("active_config_etag",e)}},{key:"getThrottleMetadata",value:function(){return this.get("throttle_metadata")}},{key:"setThrottleMetadata",value:function(e){return this.set("throttle_metadata",e)}},{key:"deleteThrottleMetadata",value:function(){return this.delete("throttle_metadata")}},{key:"get",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.openDbPromise;case 2:return r=n.sent,n.abrupt("return",new Promise(function(n,i){var a,o=r.transaction([gG],"readonly").objectStore(gG),s=t.createCompositeKey(e);try{var u=o.get(s);u.onerror=function(e){i(pG(e,"storage-get"))},u.onsuccess=function(e){var t=e.target.result;n(t?t.value:void 0)}}catch(u){i(cG.create("storage-get",{originalErrorMessage:null===(a=u)||void 0===a?void 0:a.message}))}}));case 4:case"end":return n.stop()}},n)}))()}},{key:"set",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.openDbPromise;case 2:return i=r.sent,r.abrupt("return",new Promise(function(r,a){var o,s=i.transaction([gG],"readwrite").objectStore(gG),u=n.createCompositeKey(e);try{var c=s.put({compositeKey:u,value:t});c.onerror=function(e){a(pG(e,"storage-set"))},c.onsuccess=function(){r()}}catch(c){a(cG.create("storage-set",{originalErrorMessage:null===(o=c)||void 0===o?void 0:o.message}))}}));case 4:case"end":return r.stop()}},r)}))()}},{key:"delete",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.openDbPromise;case 2:return r=n.sent,n.abrupt("return",new Promise(function(n,i){var a,o=r.transaction([gG],"readwrite").objectStore(gG),s=t.createCompositeKey(e);try{var u=o.delete(s);u.onerror=function(e){i(pG(e,"storage-delete"))},u.onsuccess=function(){n()}}catch(u){i(cG.create("storage-delete",{originalErrorMessage:null===(a=u)||void 0===a?void 0:a.message}))}}));case 4:case"end":return n.stop()}},n)}))()}},{key:"createCompositeKey",value:function(e){return[this.appId,this.appName,this.namespace,e].join()}}]),e}(),mG=function(){function e(t){Wg(this,e),this.storage=t}return jg(e,[{key:"getLastFetchStatus",value:function(){return this.lastFetchStatus}},{key:"getLastSuccessfulFetchTimestampMillis",value:function(){return this.lastSuccessfulFetchTimestampMillis}},{key:"getActiveConfig",value:function(){return this.activeConfig}},{key:"loadFromStorage",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.storage.getLastFetchStatus(),r=e.storage.getLastSuccessfulFetchTimestampMillis(),i=e.storage.getActiveConfig(),t.next=5,n;case 5:return(a=t.sent)&&(e.lastFetchStatus=a),t.next=9,r;case 9:return(o=t.sent)&&(e.lastSuccessfulFetchTimestampMillis=o),t.next=13,i;case 13:(s=t.sent)&&(e.activeConfig=s);case 15:case"end":return t.stop()}},t)}))()}},{key:"setLastFetchStatus",value:function(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}},{key:"setLastSuccessfulFetchTimestampMillis",value:function(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}},{key:"setActiveConfig",value:function(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}]),e}();function kG(){return(kG=iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(TV()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,IV();case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[2,8]])}))).apply(this,arguments)}Dz(new tz("remote-config",function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw cG.create("registration-window");if(!TV())throw cG.create("indexed-db-unavailable");var a=r.options,o=a.projectId,s=a.apiKey,u=a.appId;if(!o)throw cG.create("registration-project-id");if(!s)throw cG.create("registration-api-key");if(!u)throw cG.create("registration-app-id");var c=new yG(u,r.name,n=n||"firebase"),l=new mG(c),h=new hz(uG);h.logLevel=oz.ERROR;var f=new fG(i,Bz,n,o,s,u),d=new dG(f,c),v=new lG(d,c,l,h),p=new vG(r,v,l,c,h);return function(e){var t=XV(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0}))}(p),p},"PUBLIC").setMultipleInstances(!0)),Hz(uG,"0.3.11"),Hz(uG,"0.3.11","esm2017");var _G="/firebase-messaging-sw.js",CG="/firebase-cloud-messaging-push-scope",wG="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",bG="google.c.a.c_id",EG="google.c.a.c_l",SG="google.c.a.ts",PG="google.c.a.e",OG=(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(OG||(OG={})),OG);function TG(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,Vg(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function IG(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var AG="fcm_token_details_db",xG="fcm_token_object_Store";function RG(e){return MG.apply(this,arguments)}function MG(){return(MG=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="databases"in indexedDB,!e.t0){e.next=5;break}return e.next=4,indexedDB.databases();case 4:e.t0=!e.sent.map(function(e){return e.name}).includes(AG);case 5:if(!e.t0){e.next=7;break}return e.abrupt("return",null);case 7:return n=null,e.next=10,_z(AG,5,{upgrade:(r=iV(regeneratorRuntime.mark(function e(r,i,a,o){var s,u,c,l,h,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<2)&&r.objectStoreNames.contains(xG)){e.next=2;break}return e.abrupt("return");case 2:return u=o.objectStore(xG),e.next=5,u.index("fcmSenderId").get(t);case 5:return c=e.sent,e.next=8,u.clear();case 8:if(!c){e.next=17;break}if(2!==i){e.next=16;break}if((l=c).auth&&l.p256dh&&l.endpoint){e.next=13;break}return e.abrupt("return");case 13:n={token:l.fcmToken,createTime:null!==(s=l.createTime)&&void 0!==s?s:Date.now(),subscriptionOptions:{auth:l.auth,p256dh:l.p256dh,endpoint:l.endpoint,swScope:l.swScope,vapidKey:"string"==typeof l.vapidKey?l.vapidKey:TG(l.vapidKey)}},e.next=17;break;case 16:3===i?n={token:(h=c).fcmToken,createTime:h.createTime,subscriptionOptions:{auth:TG(h.auth),p256dh:TG(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:TG(h.vapidKey)}}:4===i&&(n={token:(f=c).fcmToken,createTime:f.createTime,subscriptionOptions:{auth:TG(f.auth),p256dh:TG(f.p256dh),endpoint:f.endpoint,swScope:f.swScope,vapidKey:TG(f.vapidKey)}});case 17:case"end":return e.stop()}},e)})),function(e,t,n,i){return r.apply(this,arguments)})});case 10:return e.sent.close(),e.next=13,Cz(AG);case 13:return e.next=15,Cz("fcm_vapid_details_db");case 15:return e.next=17,Cz("undefined");case 17:return e.abrupt("return",NG(n)?n:null);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}function NG(e){if(!e||!e.subscriptionOptions)return!1;var t=e.subscriptionOptions;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}var DG="firebase-messaging-store",LG=null;function FG(){return LG||(LG=_z("firebase-messaging-database",1,{upgrade:function(e,t){switch(t){case 0:e.createObjectStore(DG)}}})),LG}function UG(e){return BG.apply(this,arguments)}function BG(){return(BG=iV(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=$G(t),e.next=3,FG();case 3:return e.next=5,e.sent.transaction(DG).objectStore(DG).get(n);case 5:if(!(r=e.sent)){e.next=8;break}return e.abrupt("return",r);case 8:return e.next=10,RG(t.appConfig.senderId);case 10:if(!(i=e.sent)){e.next=15;break}return e.next=14,VG(t,i);case 14:return e.abrupt("return",i);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function VG(e,t){return zG.apply(this,arguments)}function zG(){return(zG=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=$G(t),e.next=3,FG();case 3:return i=e.sent.transaction(DG,"readwrite"),e.next=6,i.objectStore(DG).put(n,r);case 6:return e.next=8,i.done;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function HG(e){return GG.apply(this,arguments)}function GG(){return(GG=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=$G(t),e.next=3,FG();case 3:return r=e.sent.transaction(DG,"readwrite"),e.next=6,r.objectStore(DG).delete(n);case 6:return e.next=8,r.done;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $G(e){return e.appConfig.appId}var WG=new RV("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function qG(e,t){return jG.apply(this,arguments)}function jG(){return(jG=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JG(t);case 2:return i=e.sent,a=t$(n),o={method:"POST",headers:i,body:JSON.stringify(a)},e.prev=5,e.next=8,fetch(XG(t.appConfig),o);case 8:return e.next=10,e.sent.json();case 10:s=e.sent,e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),WG.create("token-subscribe-failed",{errorInfo:null===(r=e.t0)||void 0===r?void 0:r.toString()});case 16:if(!s.error){e.next=18;break}throw WG.create("token-subscribe-failed",{errorInfo:s.error.message});case 18:if(s.token){e.next=20;break}throw WG.create("token-subscribe-no-token");case 20:return e.abrupt("return",s.token);case 21:case"end":return e.stop()}},e,null,[[5,13]])}))).apply(this,arguments)}function ZG(e,t){return YG.apply(this,arguments)}function YG(){return(YG=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JG(t);case 2:return i=e.sent,a=t$(n.subscriptionOptions),o={method:"PATCH",headers:i,body:JSON.stringify(a)},e.prev=5,e.next=8,fetch("".concat(XG(t.appConfig),"/").concat(n.token),o);case 8:return e.next=10,e.sent.json();case 10:s=e.sent,e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),WG.create("token-update-failed",{errorInfo:null===(r=e.t0)||void 0===r?void 0:r.toString()});case 16:if(!s.error){e.next=18;break}throw WG.create("token-update-failed",{errorInfo:s.error.message});case 18:if(s.token){e.next=20;break}throw WG.create("token-update-no-token");case 20:return e.abrupt("return",s.token);case 21:case"end":return e.stop()}},e,null,[[5,13]])}))).apply(this,arguments)}function KG(e,t){return QG.apply(this,arguments)}function QG(){return(QG=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JG(t);case 2:return e.t0=e.sent,i={method:"DELETE",headers:e.t0},e.prev=4,e.next=7,fetch("".concat(XG(t.appConfig),"/").concat(n),i);case 7:return e.next=9,e.sent.json();case 9:if(!(a=e.sent).error){e.next=12;break}throw WG.create("token-unsubscribe-failed",{errorInfo:a.error.message});case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(4),WG.create("token-unsubscribe-failed",{errorInfo:null===(r=e.t1)||void 0===r?void 0:r.toString()});case 17:case"end":return e.stop()}},e,null,[[4,14]])}))).apply(this,arguments)}function XG(e){var t=e.projectId;return"https://fcmregistrations.googleapis.com/v1/projects/".concat(t,"/registrations")}function JG(e){return e$.apply(this,arguments)}function e$(){return(e$=iV(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.appConfig,r=t.installations,e.next=3,r.getToken();case 3:return i=e.sent,e.abrupt("return",new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":"FIS ".concat(i)}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function t$(e){var t=e.p256dh,n=e.auth,r=e.endpoint,i=e.vapidKey,a={web:{endpoint:r,auth:n,p256dh:t}};return i!==wG&&(a.web.applicationPubKey=i),a}function n$(e){return r$.apply(this,arguments)}function r$(){return(r$=iV(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l$(t.swRegistration,t.vapidKey);case 2:return n=e.sent,r={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:n.endpoint,auth:TG(n.getKey("auth")),p256dh:TG(n.getKey("p256dh"))},e.next=6,UG(t.firebaseDependencies);case 6:if(!(i=e.sent)){e.next=19;break}if(!f$(i.subscriptionOptions,r)){e.next=10;break}return e.abrupt("return",Date.now()>=i.createTime+6048e5?o$(t,{token:i.token,createTime:Date.now(),subscriptionOptions:r}):i.token);case 10:return e.prev=10,e.next=13,KG(t.firebaseDependencies,i.token);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),console.warn(e.t0);case 18:case 19:return e.abrupt("return",u$(t.firebaseDependencies,r));case 20:case"end":return e.stop()}},e,null,[[10,15]])}))).apply(this,arguments)}function i$(e){return a$.apply(this,arguments)}function a$(){return(a$=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,UG(t.firebaseDependencies);case 2:if(n=e.sent,e.t0=n,!e.t0){e.next=9;break}return e.next=7,KG(t.firebaseDependencies,n.token);case 7:return e.next=9,HG(t.firebaseDependencies);case 9:return e.next=11,t.swRegistration.pushManager.getSubscription();case 11:return r=e.sent,e.abrupt("return",!r||r.unsubscribe());case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function o$(e,t){return s$.apply(this,arguments)}function s$(){return(s$=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ZG(t.firebaseDependencies,n);case 3:return r=e.sent,i=Object.assign(Object.assign({},n),{token:r,createTime:Date.now()}),e.next=7,VG(t.firebaseDependencies,i);case 7:return e.abrupt("return",r);case 10:return e.prev=10,e.t0=e.catch(0),e.next=14,i$(t);case 14:throw e.t0;case 15:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function u$(e,t){return c$.apply(this,arguments)}function c$(){return(c$=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qG(t,n);case 2:return e.t0=e.sent,e.t1=Date.now(),e.t2=n,r={token:e.t0,createTime:e.t1,subscriptionOptions:e.t2},e.next=8,VG(t,r);case 8:return e.abrupt("return",r.token);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l$(e,t){return h$.apply(this,arguments)}function h$(){return(h$=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pushManager.getSubscription();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:IG(n)});case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f$(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function d$(e){var t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(t.notification){e.notification={};var n=t.notification.title;n&&(e.notification.title=n);var r=t.notification.body;r&&(e.notification.body=r);var i=t.notification.image;i&&(e.notification.image=i)}}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){var n,r,i,a,o;if(t.fcmOptions||(null===(n=t.notification)||void 0===n?void 0:n.click_action)){e.fcmOptions={};var s=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(a=t.notification)||void 0===a?void 0:a.click_action;s&&(e.fcmOptions.link=s);var u=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;u&&(e.fcmOptions.analyticsLabel=u)}}(t,e),t}function v$(e){return"object"==typeof e&&!!e&&bG in e}function p$(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function g$(e){return WG.create("missing-app-config-values",{valueName:e})}p$("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),p$("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");var y$=function(){function e(t,n,r){Wg(this,e),this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var i=function(e){if(!e||!e.options)throw g$("App Configuration Object");if(!e.name)throw g$("App Name");for(var t=e.options,n=0,r=["projectId","apiKey","appId","messagingSenderId"];n<r.length;n++){var i=r[n];if(!t[i])throw g$(i)}return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(t);this.firebaseDependencies={app:t,appConfig:i,installations:n,analyticsProvider:r}}return jg(e,[{key:"_delete",value:function(){return Promise.resolve()}}]),e}();function m$(e){return k$.apply(this,arguments)}function k$(){return(k$=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register(_G,{scope:CG});case 3:t.swRegistration=e.sent,t.swRegistration.update().catch(function(){}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),WG.create("failed-service-worker-registration",{browserErrorMessage:null===(n=e.t0)||void 0===n?void 0:n.message});case 10:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}function _$(e,t){return C$.apply(this,arguments)}function C$(){return(C$=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!n&&!t.swRegistration,!e.t0){e.next=4;break}return e.next=4,m$(t);case 4:if(!n&&t.swRegistration){e.next=8;break}if(n instanceof ServiceWorkerRegistration){e.next=7;break}throw WG.create("invalid-sw-registration");case 7:t.swRegistration=n;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w$(e,t){return b$.apply(this,arguments)}function b$(){return(b$=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n?t.vapidKey=n:t.vapidKey||(t.vapidKey=wG);case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function E$(){return(E$=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator){e.next=2;break}throw WG.create("only-available-in-window");case 2:if(e.t0="default"===Notification.permission,!e.t0){e.next=6;break}return e.next=6,Notification.requestPermission();case 6:if("granted"===Notification.permission){e.next=8;break}throw WG.create("permission-blocked");case 8:return e.next=10,w$(t,null==n?void 0:n.vapidKey);case 10:return e.next=12,_$(t,null==n?void 0:n.serviceWorkerRegistration);case 12:return e.abrupt("return",n$(t));case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S$(e,t,n){return P$.apply(this,arguments)}function P$(){return(P$=iV(regeneratorRuntime.mark(function e(t,n,r){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=O$(n),e.next=3,t.firebaseDependencies.analyticsProvider.get();case 3:e.sent.logEvent(i,{message_id:r[bG],message_name:r[EG],message_time:r[SG],message_device_time:Math.floor(Date.now()/1e3)});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O$(e){switch(e){case OG.NOTIFICATION_CLICKED:return"notification_open";case OG.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function T$(){return(T$=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.data).isFirebaseMessaging){e.next=3;break}return e.abrupt("return");case 3:if(t.onMessageHandler&&r.messageType===OG.PUSH_RECEIVED&&("function"==typeof t.onMessageHandler?t.onMessageHandler(d$(r)):t.onMessageHandler.next(d$(r))),i=r.data,e.t0=v$(i)&&"1"===i[PG],!e.t0){e.next=9;break}return e.next=9,S$(t,r.messageType,i);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var I$="@firebase/messaging";function A$(){return(A$=iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,IV();case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return","undefined"!=typeof window&&TV()&&AV()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"));case 9:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}Dz(new tz("messaging",function(e){var t=new y$(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",function(e){return function(e,t){return T$.apply(this,arguments)}(t,e)}),t},"PUBLIC")),Dz(new tz("messaging-internal",function(e){var t=e.getProvider("messaging").getImmediate();return{getToken:function(e){return function(e,t){return E$.apply(this,arguments)}(t,e)}}},"PRIVATE")),Hz(I$,"0.9.16"),Hz(I$,"0.9.16","esm2017");var x$="analytics",R$="firebase_id",M$="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",N$="https://www.googletagmanager.com/gtag/js",D$=new hz("@firebase/analytics");function L$(e){return Promise.all(e.map(function(e){return e.catch(function(e){return e})}))}function F$(e,t){var n=document.createElement("script");n.src="".concat(N$,"?l=").concat(e,"&id=").concat(t),n.async=!0,document.head.appendChild(n)}function U$(e,t,n,r,i,a){return B$.apply(this,arguments)}function B$(){return(B$=iV(regeneratorRuntime.mark(function e(t,n,r,i,a,o){var s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i[a],e.prev=1,!s){e.next=7;break}return e.next=5,n[s];case 5:e.next=14;break;case 7:return e.next=9,L$(r);case 9:if(u=e.sent.find(function(e){return e.measurementId===a}),e.t0=u,!e.t0){e.next=14;break}return e.next=14,n[u.appId];case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(1),D$.error(e.t1);case 19:t("config",a,o);case 20:case"end":return e.stop()}},e,null,[[1,16]])}))).apply(this,arguments)}function V$(e,t,n,r,i){return z$.apply(this,arguments)}function z$(){return(z$=iV(regeneratorRuntime.mark(function e(t,n,r,i,a){var o,s,u,c,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=[],!a||!a.send_to){e.next=26;break}return s=a.send_to,Array.isArray(s)||(s=[s]),e.next=7,L$(r);case 7:u=e.sent,c=Hg(s),e.prev=9,h=function(){var e=l.value,t=u.find(function(t){return t.measurementId===e}),r=t&&n[t.appId];if(!r)return o=[],"break";o.push(r)},c.s();case 12:if((l=c.n()).done){e.next=18;break}if("break"!==h()){e.next=16;break}return e.abrupt("break",18);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),c.e(e.t0);case 23:return e.prev=23,c.f(),e.finish(23);case 26:return 0===o.length&&(o=Object.values(n)),e.next=29,Promise.all(o);case 29:t("event",i,a||{}),e.next=35;break;case 32:e.prev=32,e.t1=e.catch(0),D$.error(e.t1);case 35:case"end":return e.stop()}},e,null,[[0,32],[9,20,23,26]])}))).apply(this,arguments)}function H$(){for(var e=window.document.getElementsByTagName("script"),t=0,n=Object.values(e);t<n.length;t++){var r=n[t];if(r.src&&r.src.includes(N$))return r}return null}var G$=new RV("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),$$=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Wg(this,e),this.throttleMetadata=t,this.intervalMillis=n}return jg(e,[{key:"getThrottleMetadata",value:function(e){return this.throttleMetadata[e]}},{key:"setThrottleMetadata",value:function(e,t){this.throttleMetadata[e]=t}},{key:"deleteThrottleMetadata",value:function(e){delete this.throttleMetadata[e]}}]),e}());function W$(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function q$(e){return j$.apply(this,arguments)}function j$(){return(j$=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.appId,i=t.apiKey,a={method:"GET",headers:W$(i)},o=M$.replace("{app-id}",r),e.next=6,fetch(o,a);case 6:if(200===(s=e.sent).status||304===s.status){e.next=19;break}return u="",e.prev=9,e.next=12,s.json();case 12:c=e.sent,(null===(n=c.error)||void 0===n?void 0:n.message)&&(u=c.error.message),e.next=18;break;case 16:e.prev=16,e.t0=e.catch(9);case 18:throw G$.create("config-fetch-failed",{httpStatus:s.status,responseMessage:u});case 19:return e.abrupt("return",s.json());case 20:case"end":return e.stop()}},e,null,[[9,16]])}))).apply(this,arguments)}function Z$(e){return Y$.apply(this,arguments)}function Y$(){return(Y$=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:$$,r=l.length>2?l[2]:void 0,i=t.options,a=i.appId,o=i.apiKey,s=i.measurementId,a){e.next=5;break}throw G$.create("no-app-id");case 5:if(o){e.next=9;break}if(!s){e.next=8;break}return e.abrupt("return",{measurementId:s,appId:a});case 8:throw G$.create("no-api-key");case 9:return u=n.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new nW,e.abrupt("return",(setTimeout(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.abort();case 1:case"end":return e.stop()}},e)})),void 0!==r?r:6e4),K$({appId:a,apiKey:o,measurementId:s},u,c,n)));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K$(e,t,n){return Q$.apply(this,arguments)}function Q$(){return(Q$=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s,u,c,l,h,f,d,v,p=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.throttleEndTimeMillis,a=n.backoffCount,o=p.length>3&&void 0!==p[3]?p[3]:$$,c=t.appId,l=t.measurementId,e.prev=3,e.next=6,X$(r,i);case 6:e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(3),!l){e.next=12;break}return e.abrupt("return",(D$.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ".concat(l,' provided in the "measurementId" field in the local Firebase config. [').concat(null===(s=e.t0)||void 0===s?void 0:s.message,"]")),{appId:c,measurementId:l}));case 12:throw e.t0;case 13:return e.prev=13,e.next=16,q$(t);case 16:return h=e.sent,e.abrupt("return",(o.deleteThrottleMetadata(c),h));case 20:if(e.prev=20,e.t1=e.catch(13),J$(f=e.t1)){e.next=27;break}if(o.deleteThrottleMetadata(c),!l){e.next=26;break}return e.abrupt("return",(D$.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ".concat(l,' provided in the "measurementId" field in the local Firebase config. [').concat(null==f?void 0:f.message,"]")),{appId:c,measurementId:l}));case 26:throw e.t1;case 27:return d=503===Number(null===(u=null==f?void 0:f.customData)||void 0===u?void 0:u.httpStatus)?QV(a,o.intervalMillis,30):QV(a,o.intervalMillis),v={throttleEndTimeMillis:Date.now()+d,backoffCount:a+1},e.abrupt("return",(o.setThrottleMetadata(c,v),D$.debug("Calling attemptFetch again in ".concat(d," millis")),K$(t,v,r,o)));case 29:case"end":return e.stop()}},e,null,[[3,8],[13,20]])}))).apply(this,arguments)}function X$(e,t){return new Promise(function(n,r){var i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener(function(){clearTimeout(a),r(G$.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function J$(e){if(!(e instanceof xV&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}var eW,tW,nW=function(){function e(){Wg(this,e),this.listeners=[]}return jg(e,[{key:"addEventListener",value:function(e){this.listeners.push(e)}},{key:"abort",value:function(){this.listeners.forEach(function(e){return e()})}}]),e}();function rW(){return(rW=iV(regeneratorRuntime.mark(function e(t,n,r,i,a){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!a.global){e.next=4;break}t("event",r,i),e.next=8;break;case 4:return e.next=6,n;case 6:o=e.sent,t("event",r,Object.assign(Object.assign({},i),{send_to:o}));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iW(e){tW=e}function aW(e){eW=e}function oW(){return sW.apply(this,arguments)}function sW(){return(sW=iV(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(TV()){e.next=2;break}return e.abrupt("return",(D$.warn(G$.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1));case 2:return e.prev=2,e.next=5,IV();case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",(D$.warn(G$.create("indexeddb-unavailable",{errorInfo:null===(t=e.t0)||void 0===t?void 0:t.toString()}).message),!1));case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}},e,null,[[2,7]])}))).apply(this,arguments)}function uW(){return(uW=iV(regeneratorRuntime.mark(function e(t,n,r,i,a,o,s){var u,c,l,h,f,d,v,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(c=Z$(t)).then(function(e){r[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&D$.warn("The measurement ID in the local Firebase config (".concat(t.options.measurementId,") does not match the measurement ID fetched from the server (").concat(e.measurementId,"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config."))}).catch(function(e){return D$.error(e)}),n.push(c),l=oW().then(function(e){if(e)return i.getId()}),e.next=5,Promise.all([c,l]);case 5:return h=e.sent,f=Pg(h,2),d=f[0],v=f[1],H$()||F$(o,d.measurementId),tW&&(a("consent","default",tW),iW(void 0)),a("js",new Date),p=null!==(u=null==s?void 0:s.config)&&void 0!==u?u:{},e.abrupt("return",(p.origin="firebase",p.update=!0,null!=v&&(p[R$]=v),a("config",d.measurementId,p),eW&&(a("set",eW),aW(void 0)),d.measurementId));case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}var cW,lW,hW=function(){function e(t){Wg(this,e),this.app=t}return jg(e,[{key:"_delete",value:function(){return delete fW[this.app.options.appId],Promise.resolve()}}]),e}(),fW={},dW=[],vW={},pW="dataLayer",gW=!1;function yW(){return(yW=iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!SV()&&AV()&&TV()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,IV();case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[2,8]])}))).apply(this,arguments)}var mW="@firebase/analytics";Dz(new tz(x$,function(e,t){var n=t.options;return function(e,t,n){!function(){var e=[];if(SV()&&e.push("This is a browser extension environment."),AV()||e.push("Cookies are not available."),e.length>0){var t=e.map(function(e,t){return"(".concat(t+1,") ").concat(e)}).join(" "),n=G$.create("invalid-analytics-context",{errorInfo:t});D$.warn(n.message)}}();var r=e.options.appId;if(!r)throw G$.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw G$.create("no-api-key");D$.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '.concat(e.options.measurementId,' provided in the "measurementId" field in the local Firebase config.'))}if(null!=fW[r])throw G$.create("already-exists",{id:r});if(!gW){!function(e){var t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(pW);var i=function(e,t,n,r,i){var a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(a=window[i]),window[i]=function(e,t,n,r){function i(){return(i=iV(regeneratorRuntime.mark(function i(a,o,s){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,"event"!==a){i.next=6;break}return i.next=4,V$(e,t,n,o,s);case 4:i.next=12;break;case 6:if("config"!==a){i.next=11;break}return i.next=9,U$(e,t,n,r,o,s);case 9:i.next=12;break;case 11:"consent"===a?e("consent","update",s):e("set",o);case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(0),D$.error(i.t0);case 17:case"end":return i.stop()}},i,null,[[0,14]])}))).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(a,e,t,n),{gtagCore:a,wrappedGtag:window[i]}}(fW,dW,vW,pW,"gtag"),a=i.wrappedGtag,o=i.gtagCore;lW=a,cW=o,gW=!0}return fW[r]=function(e,t,n,r,i,a,o){return uW.apply(this,arguments)}(e,dW,vW,t,cW,pW,n),new hW(e)}(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),n)},"PUBLIC")),Dz(new tz("analytics-internal",function(e){try{var t=e.getProvider(x$).getImmediate();return{logEvent:function(e,n,r){return function(e,t,n,r){e=XV(e),function(e,t,n,r,i){return rW.apply(this,arguments)}(lW,fW[e.app.options.appId],t,n,r).catch(function(e){return D$.error(e)})}(t,e,n,r)}}}catch(t){throw G$.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),Hz(mW,"0.8.0"),Hz(mW,"0.8.0","esm2017");var kW=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this)}return jg(n,[{key:"schedule",value:function(e){return this}}]),n}(qg),_W={setInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=_W.delegate;return((null==e?void 0:e.setInterval)||setInterval).apply(void 0,arguments)}),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=_W.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)}),delegate:void 0},CW=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).scheduler=e,i.work=r,i.pending=!1,i}return jg(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}},{key:"requestAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _W.setInterval(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=n&&this.delay===n&&!1===this.pending)return t;_W.clearInterval(t)}},{key:"execute",value:function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}},{key:"_execute",value:function(e,t){var n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}},{key:"unsubscribe",value:function(){if(!this.closed){var e=this.id,t=this.scheduler,r=t.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$g(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,xg(Bg(n.prototype),"unsubscribe",this).call(this)}}}]),n}(kW),wW={now:function(){return(wW.delegate||Date).now()},delegate:void 0},bW=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.now;Wg(this,e),this.schedulerActionCtor=t,this.now=n}return jg(e,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new this.schedulerActionCtor(this,e).schedule(n,t)}}]),e}();bW.now=wW.now;var EW=function(e){Mg(n,e);var t=Dg(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bW.now;return Wg(this,n),(r=t.call(this,e,i)).actions=[],r._active=!1,r._scheduled=void 0,r}return jg(n,[{key:"flush",value:function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}}]),n}(bW),SW=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n)}(EW))(function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).scheduler=e,i.work=r,i}return jg(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t>0?xg(Bg(n.prototype),"schedule",this).call(this,e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}},{key:"execute",value:function(e,t){return t>0||this.closed?xg(Bg(n.prototype),"execute",this).call(this,e,t):this._execute(e,t)}},{key:"requestAsyncId",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return null!=r&&r>0||null==r&&this.delay>0?xg(Bg(n.prototype),"requestAsyncId",this).call(this,e,t,r):e.flush(this)}}]),n}(CW)),PW=new EW(CW),OW=new vO("7.4.1"),TW="__angularfire_symbol__analyticsIsSupportedValue",IW="__angularfire_symbol__analyticsIsSupported",AW="__angularfire_symbol__remoteConfigIsSupportedValue",xW="__angularfire_symbol__remoteConfigIsSupported",RW="__angularfire_symbol__messagingIsSupportedValue",MW="__angularfire_symbol__messagingIsSupported";function NW(e,t,n){if(t){if(1===t.length)return t[0];var r=t.filter(function(e){return e.app===n});if(1===r.length)return r[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[IW]||(globalThis[IW]=function(){return yW.apply(this,arguments)}().then(function(e){return globalThis[TW]=e}).catch(function(){return globalThis[TW]=!1})),globalThis[MW]||(globalThis[MW]=function(){return A$.apply(this,arguments)}().then(function(e){return globalThis[RW]=e}).catch(function(){return globalThis[RW]=!1})),globalThis[xW]||(globalThis[xW]=function(){return kG.apply(this,arguments)}().then(function(e){return globalThis[AW]=e}).catch(function(){return globalThis[AW]=!1}));var DW=function(e,t){var n=t?[t]:zz(),r=[];return n.forEach(function(t){t.container.getProvider(e).instances.forEach(function(e){r.includes(e)||r.push(e)})}),r};function LW(){}var FW=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SW;Wg(this,e),this.zone=t,this.delegate=n}return jg(e,[{key:"now",value:function(){return this.delegate.now()}},{key:"schedule",value:function(e,t,n){var r=this.zone;return this.delegate.schedule(function(t){var n=this;r.runGuarded(function(){e.apply(n,[t])})},t,n)}}]),e}(),UW=function(){function e(t){Wg(this,e),this.zone=t,this.task=null}return jg(e,[{key:"call",value:function(e,t){var n=this.unscheduleTask.bind(this);return this.task=this.zone.run(function(){return Zone.current.scheduleMacroTask("firebaseZoneBlock",LW,{},LW,LW)}),t.pipe(yN({next:n,complete:n,error:n})).subscribe(e).add(n)}},{key:"unscheduleTask",value:function(){var e=this;setTimeout(function(){null!=e.task&&"scheduled"===e.task.state&&(e.task.invoke(),e.task=null)},10)}}]),e}(),BW=function(){var e=jg(function e(t){Wg(this,e),this.ngZone=t,this.outsideAngular=t.runOutsideAngular(function(){return new FW(Zone.current)}),this.insideAngular=t.run(function(){return new FW(Zone.current,PW)}),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)});return e.\u0275fac=function(t){return new(t||e)(pC(eI))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();function VW(){var e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function zW(e){return VW().ngZone.runOutsideAngular(function(){return e()})}function HW(e){return VW().ngZone.run(function(){return e()})}function GW(e){return VW(),function(e){return function(t){return(t=t.lift(new UW(e.ngZone))).pipe(Yy(e.outsideAngular),Zy(e.insideAngular))}}(VW())(e)}var $W=function(e,t){var n=void 0;return function(){var r=arguments;return t&&setTimeout(function(){"scheduled"===t.state&&t.invoke()},10),HW(function(){return e.apply(n,r)})}},WW=function(e,t){return function(){for(var n,r=this,i=arguments,a=0;a<arguments.length;a++)"function"==typeof i[a]&&(t&&(n||(n=HW(function(){return Zone.current.scheduleMacroTask("firebaseZoneBlock",LW,{},LW,LW)}))),i[a]=$W(i[a],n));var o=zW(function(){return e.apply(r,i)});if(!t){if(o instanceof yy){var s=VW();return o.pipe(Yy(s.outsideAngular),Zy(s.insideAngular))}return HW(function(){return o})}return o instanceof yy?o.pipe(GW):o instanceof Promise?HW(function(){return new Promise(function(e,t){return o.then(function(t){return HW(function(){return e(t)})},function(e){return HW(function(){return t(e)})})})}):"function"==typeof o&&n?function(){return setTimeout(function(){n&&"scheduled"===n.state&&n.invoke()},10),o.apply(this,arguments)}:HW(function(){return o})}},qW=jg(function e(t){return Wg(this,e),t}),jW=jg(function e(){return Wg(this,e),zz()}),ZW=new Y_("angularfire2._apps"),YW={provide:qW,useFactory:function(e){return e&&1===e.length?e[0]:new qW(Vz())},deps:[[new bC,ZW]]},KW={provide:jW,deps:[[new bC,ZW]]};function QW(e){return function(t,n){var r=t.runOutsideAngular(function(){return e(n)});return new qW(r)}}var XW=function(){var e=jg(function e(t){Wg(this,e),Hz("angularfire",OW.full,"core"),Hz("angularfire",OW.full,"app"),Hz("angular",pO.full,t.toString())});return e.\u0275fac=function(t){return new(t||e)(pC(BT))},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[YW,KW]}),e}(),JW=WW(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"object"!=typeof t&&(t={name:t});var n=Object.assign({name:Az,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw Fz.create("bad-app-name",{appName:String(r)});var i=Rz.get(r);if(i){if(zV(e,i.options)&&zV(n,i.config))return i;throw Fz.create("duplicate-app",{appName:r})}var a,o=new iz(r),s=Hg(Mz.values());try{for(s.s();!(a=s.n()).done;){var u=a.value;o.addComponent(u)}}catch(l){s.e(l)}finally{s.f()}var c=new Uz(e,n,o);return Rz.set(r,c),c},!0),eq=new Map,tq={activated:!1,tokenObservers:[]},nq={initialized:!1,enabled:!1};function rq(e){return eq.get(e)||tq}function iq(e,t){eq.set(e,t)}function aq(){return nq}var oq=function(){function e(t,n,r,i,a){if(Wg(this,e),this.operation=t,this.retryPolicy=n,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=a,this.pending=null,this.nextErrorWaitInterval=i,i>a)throw new Error("Proactive refresh lower bound greater than upper bound!")}return jg(e,[{key:"start",value:function(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(function(){})}},{key:"stop",value:function(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}},{key:"isRunning",value:function(){return!!this.pending}},{key:"process",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.stop(),n.prev=1,t.pending=new CV,n.next=5,function(e){return new Promise(function(t){setTimeout(t,e)})}(t.getNextRun(e));case 5:return t.pending.resolve(),n.next=8,t.pending.promise;case 8:return t.pending=new CV,n.next=11,t.operation();case 11:return t.pending.resolve(),n.next=14,t.pending.promise;case 14:t.process(!0).catch(function(){}),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(1),t.retryPolicy(n.t0)?t.process(!1).catch(function(){}):t.stop();case 20:case"end":return n.stop()}},n,null,[[1,17]])}))()}},{key:"getNextRun",value:function(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}]),e}(),sq=new RV("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function uq(e){if(!rq(e).activated)throw sq.create("use-before-activation",{appName:e.name})}function cq(e,t){return lq.apply(this,arguments)}function lq(){return(lq=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c,l,h,f,d,v,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,i=t.body,s={"Content-Type":"application/json"},!(u=n.getImmediate({optional:!0}))){e.next=7;break}return e.next=5,u.getHeartbeatsHeader();case 5:(c=e.sent)&&(s["X-Firebase-Client"]=c);case 7:return l={method:"POST",body:JSON.stringify(i),headers:s},e.prev=8,e.next=11,fetch(r,l);case 11:h=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),sq.create("fetch-network-error",{originalErrorMessage:null===(a=e.t0)||void 0===a?void 0:a.message});case 17:if(200===h.status){e.next=19;break}throw sq.create("fetch-status-error",{httpStatus:h.status});case 19:return e.prev=19,e.next=22,h.json();case 22:f=e.sent,e.next=28;break;case 25:throw e.prev=25,e.t1=e.catch(19),sq.create("fetch-parse-error",{originalErrorMessage:null===(o=e.t1)||void 0===o?void 0:o.message});case 28:if((d=f.ttl.match(/^([\d.]+)(s)$/))&&d[2]&&!isNaN(Number(d[1]))){e.next=31;break}throw sq.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: ".concat(f.ttl)});case 31:return v=1e3*Number(d[1]),p=Date.now(),e.abrupt("return",{token:f.token,expireTimeMillis:p+v,issuedAtTimeMillis:p});case 33:case"end":return e.stop()}},e,null,[[8,14],[19,25]])}))).apply(this,arguments)}function hq(e,t){var n=e.options,r=n.projectId,i=n.appId,a=n.apiKey;return{url:"https://content-firebaseappcheck.googleapis.com/v1/projects/".concat(r,"/apps/").concat(i,":exchangeDebugToken?key=").concat(a),body:{debug_token:t}}}var fq="firebase-app-check-store",dq=null;function vq(){return dq||(dq=new Promise(function(e,t){var n;try{var r=indexedDB.open("firebase-app-check-database",1);r.onsuccess=function(t){e(t.target.result)},r.onerror=function(e){var n;t(sq.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},r.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(fq,{keyPath:"compositeKey"})}}}catch(r){t(sq.create("storage-open",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message}))}}))}function pq(){return(pq=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vq();case 2:return r=e.sent.transaction(fq,"readwrite"),i=r.objectStore(fq).put({compositeKey:t,value:n}),e.abrupt("return",new Promise(function(e,t){i.onsuccess=function(t){e()},r.onerror=function(e){var n;t(sq.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var gq=new hz("@firebase/app-check");function yq(e,t){return TV()?function(e,t){return function(e,t){return pq.apply(this,arguments)}(function(e){return"".concat(e.options.appId,"-").concat(e.name)}(e),t)}(e,t).catch(function(e){gq.warn("Failed to write token to IndexedDB. Error: ".concat(e))}):Promise.resolve()}function mq(){return aq().enabled}function kq(){return _q.apply(this,arguments)}function _q(){return(_q=iV(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=aq()).enabled||!t.token){e.next=3;break}return e.abrupt("return",t.token.promise);case 3:throw Error("\n            Can't get debug token in production mode.\n        ");case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Cq={error:"UNKNOWN_ERROR"};function wq(e){return vV.encodeString(JSON.stringify(e),!1)}function bq(e){return Eq.apply(this,arguments)}function Eq(){return(Eq=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,h=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]&&h[1],uq(r=t.app),i=rq(r),o=i.token){e.next=10;break}return e.next=8,i.cachedTokenPromise;case 8:(s=e.sent)&&Tq(s)&&(o=s);case 10:if(n||!o||!Tq(o)){e.next=12;break}return e.abrupt("return",{token:o.token});case 12:if(c=!1,!mq()){e.next=33;break}if(e.t0=i.exchangeTokenPromise,e.t0){e.next=26;break}return e.t1=cq,e.t2=hq,e.t3=r,e.next=21,kq();case 21:e.t4=e.sent,e.t5=(0,e.t2)(e.t3,e.t4),e.t6=t.heartbeatServiceProvider,i.exchangeTokenPromise=(0,e.t1)(e.t5,e.t6).then(function(e){return i.exchangeTokenPromise=void 0,e}),c=!0;case 26:return e.next=28,i.exchangeTokenPromise;case 28:return l=e.sent,e.next=31,yq(r,l);case 31:return iq(r,Object.assign(Object.assign({},i),{token:l})),e.abrupt("return",{token:l.token});case 33:return e.prev=33,i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().then(function(e){return i.exchangeTokenPromise=void 0,e}),c=!0),e.next=37,i.exchangeTokenPromise;case 37:o=e.sent,e.next=43;break;case 40:e.prev=40,e.t7=e.catch(33),"appCheck/throttled"===e.t7.code?gq.warn(e.t7.message):gq.error(e.t7),a=e.t7;case 43:if(!o){e.next=50;break}return u={token:o.token},iq(r,Object.assign(Object.assign({},i),{token:o})),e.next=48,yq(r,o);case 48:e.next=51;break;case 50:u=Iq(a);case 51:return c&&Oq(r,u),e.abrupt("return",u);case 53:case"end":return e.stop()}},e,null,[[33,40]])}))).apply(this,arguments)}function Sq(e,t){var n=rq(e),r=n.tokenObservers.filter(function(e){return e.next!==t});0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),iq(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function Pq(e){var t=e.app,n=rq(t),r=n.tokenRefresher;r||(r=function(e){var t=e.app;return new oq(iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!rq(t).token){n.next=6;break}return n.next=3,bq(e,!0);case 3:n.t0=n.sent,n.next=9;break;case 6:return n.next=8,bq(e);case 8:n.t0=n.sent;case 9:if(!(r=n.t0).error){n.next=12;break}throw r.error;case 12:case"end":return n.stop()}},n)})),function(){return!0},function(){var e=rq(t);if(e.token){var n=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return n=Math.min(n,e.token.expireTimeMillis-3e5),Math.max(0,n-Date.now())}return 0},3e4,96e4)}(e),iq(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function Oq(e,t){var n,r=Hg(rq(e).tokenObservers);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{"EXTERNAL"===i.type&&null!=t.error?i.error(t.error):i.next(t)}catch(a){}}}catch(o){r.e(o)}finally{r.f()}}function Tq(e){return e.expireTimeMillis-Date.now()>0}function Iq(e){return{token:wq(Cq),error:e}}var Aq=function(){function e(t,n){Wg(this,e),this.app=t,this.heartbeatServiceProvider=n}return jg(e,[{key:"_delete",value:function(){var e,t=Hg(rq(this.app).tokenObservers);try{for(t.s();!(e=t.n()).done;){var n=e.value;Sq(this.app,n.next)}}catch(r){t.e(r)}finally{t.f()}return Promise.resolve()}}]),e}(),xq="app-check-internal";Dz(new tz("app-check",function(e){return function(e,t){return new Aq(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("heartbeat"))},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(e,t,n){e.getProvider(xq).initialize()})),Dz(new tz(xq,function(e){return function(e){return{getToken:function(t){return bq(e,t)},addTokenListener:function(t){return function(e,t,n,r){var i=e.app,a=rq(i),o={next:n,error:void 0,type:"INTERNAL"};if(iq(i,Object.assign(Object.assign({},a),{tokenObservers:[].concat(Vg(a.tokenObservers),[o])})),a.token&&Tq(a.token)){var s=a.token;Promise.resolve().then(function(){n({token:s.token}),Pq(e)}).catch(function(){})}a.cachedTokenPromise.then(function(){return Pq(e)})}(e,0,t)},removeTokenListener:function(t){return Sq(e.app,t)}}}(e.getProvider("app-check").getImmediate())},"PUBLIC").setInstantiationMode("EXPLICIT")),Hz("@firebase/app-check","0.5.11");var Rq=jg(function e(){return Wg(this,e),DW("app-check")});"undefined"!=typeof window&&window;var Mq=new RV("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Nq=new hz("@firebase/auth");function Dq(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Nq.logLevel<=oz.ERROR&&Nq.error.apply(Nq,["Auth (9.9.0): ".concat(e)].concat(n))}function Lq(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Vq.apply(void 0,[e].concat(n))}function Fq(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Vq.apply(void 0,[e].concat(n))}function Uq(e,t,n){var r=Object.assign(Object.assign({},{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Sg({},t,n));return new RV("auth","Firebase",r).create(t,{appName:e.name})}function Bq(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Lq(e,"argument-error"),Uq(e,"argument-error","Type of ".concat(t.constructor.name," does not match expected instance.Did you pass a reference from a different Auth SDK?"))}function Vq(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!=typeof e){var i,a=n[0],o=Vg(n.slice(1));return o[0]&&(o[0].appName=e.name),(i=e._errorFactory).create.apply(i,[a].concat(Vg(o)))}return Mq.create.apply(Mq,[e].concat(n))}function zq(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(!e)throw Vq.apply(void 0,[t].concat(r))}function Hq(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Dq(t),new Error(t)}function Gq(e,t){e||Hq(t)}var $q=new Map;function Wq(e){Gq(e instanceof Function,"Expected a class definition");var t=$q.get(e);return t?(Gq(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,$q.set(e,t),t)}function qq(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function jq(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}var Zq=function(){function e(t,n){Wg(this,e),this.shortDelay=t,this.longDelay=n,Gq(n>t,"Short delay should be less than long delay!"),this.isMobile=EV()||PV()}return jg(e,[{key:"get",value:function(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===jq()||"https:"===jq()||SV()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}]),e}();function Yq(e,t){Gq(e.emulator,"Emulator should always be set here");var n=e.emulator.url;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}var Kq=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"initialize",value:function(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}},{key:"fetch",value:function(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Hq("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"headers",value:function(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Hq("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Hq("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}]),e}(),Qq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Xq=new Zq(3e4,6e4);function Jq(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function ej(e,t,n,r){return tj.apply(this,arguments)}function tj(){return(tj=iV(regeneratorRuntime.mark(function e(t,n,r,i){var a,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},e.abrupt("return",nj(t,a,iV(regeneratorRuntime.mark(function e(){var a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},o={},i&&("GET"===n?o=i:a={body:JSON.stringify(i)}),s=GV(Object.assign({key:t.config.apiKey},o)).slice(1),e.next=5,t._getAdditionalHeaders();case 5:return u=e.sent,e.abrupt("return",(u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode),Kq.fetch()(oj(t,t.config.apiHost,r,s),Object.assign({method:n,headers:u,referrerPolicy:"no-referrer"},a))));case 7:case"end":return e.stop()}},e)}))));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function nj(e,t,n){return rj.apply(this,arguments)}function rj(){return(rj=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._canInitEmulator=!1,i=Object.assign(Object.assign({},Qq),n),e.prev=2,a=new sj(t),e.next=6,Promise.race([r(),a.promise]);case 6:return o=e.sent,a.clearNetworkTimeout(),e.next=10,o.json();case 10:if(!("needConfirmation"in(s=e.sent))){e.next=13;break}throw uj(t,"account-exists-with-different-credential",s);case 13:if(!o.ok||"errorMessage"in s){e.next=15;break}return e.abrupt("return",s);case 15:if(u=o.ok?s.errorMessage:s.error.message,c=u.split(" : "),l=Pg(c,2),h=l[0],f=l[1],"FEDERATED_USER_ID_ALREADY_LINKED"!==h){e.next=18;break}throw uj(t,"credential-already-in-use",s);case 18:if("EMAIL_EXISTS"!==h){e.next=20;break}throw uj(t,"email-already-in-use",s);case 20:if("USER_DISABLED"!==h){e.next=22;break}throw uj(t,"user-disabled",s);case 22:if(d=i[h]||h.toLowerCase().replace(/[_\s]+/g,"-"),!f){e.next=25;break}throw Uq(t,d,f);case 25:Lq(t,d),e.next=33;break;case 28:if(e.prev=28,e.t0=e.catch(2),!(e.t0 instanceof xV)){e.next=32;break}throw e.t0;case 32:Lq(t,"network-request-failed");case 33:case"end":return e.stop()}},e,null,[[2,28]])}))).apply(this,arguments)}function ij(e,t,n,r){return aj.apply(this,arguments)}function aj(){return(aj=iV(regeneratorRuntime.mark(function e(t,n,r,i){var a,o,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>4&&void 0!==s[4]?s[4]:{},e.next=3,ej(t,n,r,i,a);case 3:return o=e.sent,e.abrupt("return",("mfaPendingCredential"in o&&Lq(t,"multi-factor-auth-required",{_serverResponse:o}),o));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oj(e,t,n,r){var i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?Yq(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}var sj=function(){function e(t){var n=this;Wg(this,e),this.auth=t,this.timer=null,this.promise=new Promise(function(e,t){n.timer=setTimeout(function(){return t(Fq(n.auth,"network-request-failed"))},Xq.get())})}return jg(e,[{key:"clearNetworkTimeout",value:function(){clearTimeout(this.timer)}}]),e}();function uj(e,t,n){var r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);var i=Fq(e,t,r);return i.customData._tokenResponse=n,i}function cj(){return(cj=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ej(t,"POST","/v1/accounts:delete",n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function lj(e,t){return hj.apply(this,arguments)}function hj(){return(hj=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ej(t,"POST","/v1/accounts:lookup",n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function fj(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(n){}}function dj(){return(dj=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]&&u[1],r=XV(t),e.next=4,r.getIdToken(n);case 4:return i=e.sent,zq((a=pj(i))&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error"),o="object"==typeof a.firebase?a.firebase:void 0,s=null==o?void 0:o.sign_in_provider,e.abrupt("return",{claims:a,token:i,authTime:fj(vj(a.auth_time)),issuedAtTime:fj(vj(a.iat)),expirationTime:fj(vj(a.exp)),signInProvider:s||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null});case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function vj(e){return 1e3*Number(e)}function pj(e){var t,n=Pg(e.split("."),3),r=n[0],i=n[1],a=n[2];if(void 0===r||void 0===i||void 0===a)return Dq("JWT malformed, contained fewer than 3 sections"),null;try{var o=yV(i);return o?JSON.parse(o):(Dq("Failed to decode base64 JWT payload"),null)}catch(s){return Dq("Caught error parsing JWT payload as JSON",null===(t=s)||void 0===t?void 0:t.toString()),null}}function gj(e,t){return yj.apply(this,arguments)}function yj(){return(yj=iV(regeneratorRuntime.mark(function e(t,n){var r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>2&&void 0!==r[2]&&r[2])){e.next=3;break}return e.abrupt("return",n);case 3:return e.prev=3,e.next=6,n;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),e.t1=e.t0 instanceof xV&&mj(e.t0)&&t.auth.currentUser===t,!e.t1){e.next=15;break}return e.next=15,t.auth.signOut();case 15:throw e.t0;case 16:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function mj(e){var t=e.code;return"auth/user-disabled"===t||"auth/user-token-expired"===t}var kj=function(){function e(t){Wg(this,e),this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}return jg(e,[{key:"_start",value:function(){this.isRunning||(this.isRunning=!0,this.schedule())}},{key:"_stop",value:function(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}},{key:"getInterval",value:function(e){var t;if(e){var n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}this.errorBackoff=3e4;var r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}},{key:"schedule",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if(this.isRunning){var n=this.getInterval(e);this.timerId=setTimeout(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.iteration();case 2:case"end":return e.stop()}},e)})),n)}}},{key:"iteration",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.user.getIdToken(!0);case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",void("auth/network-request-failed"===(null===(n=t.t0)||void 0===n?void 0:n.code)&&e.schedule(!0)));case 8:e.schedule();case 9:case"end":return t.stop()}},t,null,[[0,5]])}))()}}]),e}(),_j=function(){function e(t,n){Wg(this,e),this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}return jg(e,[{key:"_initializeTime",value:function(){this.lastSignInTime=fj(this.lastLoginAt),this.creationTime=fj(this.createdAt)}},{key:"_copy",value:function(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}},{key:"toJSON",value:function(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}]),e}();function Cj(e){return wj.apply(this,arguments)}function wj(){return(wj=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.auth,e.next=3,t.getIdToken();case 3:return i=e.sent,e.next=6,gj(t,lj(r,{idToken:i}));case 6:zq(null==(a=e.sent)?void 0:a.users.length,r,"internal-error"),o=a.users[0],t._notifyReloadListener(o),s=(null===(n=o.providerUserInfo)||void 0===n?void 0:n.length)?Sj(o.providerUserInfo):[],u=Ej(t.providerData,s),c=!!t.isAnonymous&&!(t.email&&o.passwordHash||(null==u?void 0:u.length)),l={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new _j(o.createdAt,o.lastLoginAt),isAnonymous:c},Object.assign(t,l);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function bj(){return(bj=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=XV(t),e.next=3,Cj(n);case 3:return e.next=5,n.auth._persistUserIfCurrent(n);case 5:n.auth._notifyListenersIfCurrent(n);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ej(e,t){return[].concat(Vg(e.filter(function(e){return!t.some(function(t){return t.providerId===e.providerId})})),Vg(t))}function Sj(e){return e.map(function(e){var t=e.providerId,n=Py(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function Pj(){return(Pj=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nj(t,{},iV(regeneratorRuntime.mark(function e(){var r,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=GV({grant_type:"refresh_token",refresh_token:n}).slice(1),i=t.config,a=i.tokenApiHost,o=i.apiKey,s=oj(t,a,"/v1/token","key=".concat(o)),e.next=7,t._getAdditionalHeaders();case 7:return u=e.sent,e.abrupt("return",(u["Content-Type"]="application/x-www-form-urlencoded",Kq.fetch()(s,{method:"POST",headers:u,body:r})));case 9:case"end":return e.stop()}},e)})));case 2:return r=e.sent,e.abrupt("return",{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Oj=function(){function e(){Wg(this,e),this.refreshToken=null,this.accessToken=null,this.expirationTime=null}return jg(e,[{key:"isExpired",get:function(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function(e){zq(e.idToken,"internal-error"),zq(void 0!==e.idToken,"internal-error"),zq(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){var t=pj(e);return zq(t,"internal-error"),zq(void 0!==t.exp,"internal-error"),zq(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(zq(!n.accessToken||n.refreshToken,e,"user-token-expired"),!t&&n.accessToken&&!n.isExpired){r.next=12;break}if(!n.refreshToken){r.next=8;break}return r.next=5,n.refresh(e,n.refreshToken);case 5:r.t1=n.accessToken,r.next=9;break;case 8:r.t1=null;case 9:r.t0=r.t1,r.next=13;break;case 12:r.t0=n.accessToken;case 13:return r.abrupt("return",r.t0);case 14:case"end":return r.stop()}},r)}))()}},{key:"clearRefreshToken",value:function(){this.refreshToken=null}},{key:"refresh",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e,t){return Pj.apply(this,arguments)}(e,t);case 2:i=r.sent,a=i.accessToken,o=i.refreshToken,s=i.expiresIn,n.updateTokensAndExpiration(a,o,Number(s));case 7:case"end":return r.stop()}},r)}))()}},{key:"updateTokensAndExpiration",value:function(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}},{key:"toJSON",value:function(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}},{key:"_clone",value:function(){return Object.assign(new e,this.toJSON())}},{key:"_performRefresh",value:function(){return Hq("not implemented")}}],[{key:"fromJSON",value:function(t,n){var r=n.refreshToken,i=n.accessToken,a=n.expirationTime,o=new e;return r&&(zq("string"==typeof r,"internal-error",{appName:t}),o.refreshToken=r),i&&(zq("string"==typeof i,"internal-error",{appName:t}),o.accessToken=i),a&&(zq("number"==typeof a,"internal-error",{appName:t}),o.expirationTime=a),o}}]),e}();function Tj(e,t){zq("string"==typeof e||void 0===e,"internal-error",{appName:t})}var Ij=function(){function e(t){Wg(this,e);var n=t.uid,r=t.auth,i=t.stsTokenManager,a=Py(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?Vg(a.providerData):[],this.metadata=new _j(a.createdAt||void 0,a.lastLoginAt||void 0)}return jg(e,[{key:"getIdToken",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,gj(t,t.stsTokenManager.getToken(t.auth,e));case 2:if(zq(r=n.sent,t.auth,"internal-error"),n.t0=t.accessToken!==r,!n.t0){n.next=10;break}return t.accessToken=r,n.next=9,t.auth._persistUserIfCurrent(t);case 9:t.auth._notifyListenersIfCurrent(t);case 10:return n.abrupt("return",r);case 11:case"end":return n.stop()}},n)}))()}},{key:"getIdTokenResult",value:function(e){return function(e){return dj.apply(this,arguments)}(this,e)}},{key:"reload",value:function(){return function(e){return bj.apply(this,arguments)}(this)}},{key:"_assign",value:function(e){this!==e&&(zq(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(function(e){return Object.assign({},e)}),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}},{key:"_clone",value:function(t){return new e(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}},{key:"_onReload",value:function(e){zq(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}},{key:"_notifyReloadListener",value:function(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}},{key:"_startProactiveRefresh",value:function(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=!1,e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),i=!0),r.t0=t,!r.t0){r.next=6;break}return r.next=6,Cj(n);case 6:return r.next=8,n.auth._persistUserIfCurrent(n);case 8:i&&n.auth._notifyListenersIfCurrent(n);case 9:case"end":return r.stop()}},r)}))()}},{key:"delete",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getIdToken();case 2:return n=t.sent,t.next=5,gj(e,function(e,t){return cj.apply(this,arguments)}(e.auth,{idToken:n}));case 5:return e.stsTokenManager.clearRefreshToken(),t.abrupt("return",e.auth.signOut());case 7:case"end":return t.stop()}},t)}))()}},{key:"toJSON",value:function(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(function(e){return Object.assign({},e)}),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function(t,n){var r,i,a,o,s,u,c,l,h=null!==(r=n.displayName)&&void 0!==r?r:void 0,f=null!==(i=n.email)&&void 0!==i?i:void 0,d=null!==(a=n.phoneNumber)&&void 0!==a?a:void 0,v=null!==(o=n.photoURL)&&void 0!==o?o:void 0,p=null!==(s=n.tenantId)&&void 0!==s?s:void 0,g=null!==(u=n._redirectEventId)&&void 0!==u?u:void 0,y=null!==(c=n.createdAt)&&void 0!==c?c:void 0,m=null!==(l=n.lastLoginAt)&&void 0!==l?l:void 0,k=n.uid,_=n.emailVerified,C=n.isAnonymous,w=n.providerData,b=n.stsTokenManager;zq(k&&b,t,"internal-error");var E=Oj.fromJSON(this.name,b);zq("string"==typeof k,t,"internal-error"),Tj(h,t.name),Tj(f,t.name),zq("boolean"==typeof _,t,"internal-error"),zq("boolean"==typeof C,t,"internal-error"),Tj(d,t.name),Tj(v,t.name),Tj(p,t.name),Tj(g,t.name),Tj(y,t.name),Tj(m,t.name);var S=new e({uid:k,auth:t,email:f,emailVerified:_,displayName:h,isAnonymous:C,photoURL:v,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:y,lastLoginAt:m});return w&&Array.isArray(w)&&(S.providerData=w.map(function(e){return Object.assign({},e)})),g&&(S._redirectEventId=g),S}},{key:"_fromIdTokenResponse",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(a=new Oj).updateFromServerResponse(n),o=new e({uid:n.localId,auth:t,stsTokenManager:a,isAnonymous:r}),i.next=5,Cj(o);case 5:return i.abrupt("return",o);case 6:case"end":return i.stop()}},i)}))()}}]),e}(),Aj=function(){var e=function(){function e(){Wg(this,e),this.type="NONE",this.storage={}}return jg(e,[{key:"_isAvailable",value:function(){return iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}},e)}))()}},{key:"_set",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n.storage[e]=t;case 1:case"end":return r.stop()}},r)}))()}},{key:"_get",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.storage[e],n.abrupt("return",void 0===r?null:r);case 2:case"end":return n.stop()}},n)}))()}},{key:"_remove",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:delete t.storage[e];case 1:case"end":return n.stop()}},n)}))()}},{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),e}();return e.type="NONE",e}();function xj(e,t,n){return"firebase:".concat(e,":").concat(t,":").concat(n)}var Rj=function(){function e(t,n,r){Wg(this,e),this.persistence=t,this.auth=n,this.userKey=r;var i=this.auth,a=i.config,o=i.name;this.fullUserKey=xj(this.userKey,a.apiKey,o),this.fullPersistenceKey=xj("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}return jg(e,[{key:"setCurrentUser",value:function(e){return this.persistence._set(this.fullUserKey,e.toJSON())}},{key:"getCurrentUser",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.persistence._get(e.fullUserKey);case 2:return n=t.sent,t.abrupt("return",n?Ij._fromJSON(e.auth,n):null);case 4:case"end":return t.stop()}},t)}))()}},{key:"removeCurrentUser",value:function(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.persistence!==e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.getCurrentUser();case 4:return r=n.sent,n.next=7,t.removeCurrentUser();case 7:return t.persistence=e,n.abrupt("return",r?t.setCurrentUser(r):void 0);case 9:case"end":return n.stop()}},n)}))()}},{key:"delete",value:function(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";return iV(regeneratorRuntime.mark(function i(){var a,o,s,u,c,l,h,f,d,v;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n.length){i.next=2;break}return i.abrupt("return",new e(Wq(Aj),t,r));case 2:return i.next=4,Promise.all(n.map(function(){var e=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._isAvailable();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:a=i.sent.filter(function(e){return e}),o=a[0]||Wq(Aj),s=xj(r,t.config.apiKey,t.name),u=null,c=Hg(n),i.prev=9,c.s();case 11:if((l=c.n()).done){i.next=27;break}return h=l.value,i.prev=13,i.next=16,h._get(s);case 16:if(!(f=i.sent)){i.next=21;break}return d=Ij._fromJSON(t,f),h!==o&&(u=d),o=h,i.abrupt("break",27);case 21:i.next=25;break;case 23:i.prev=23,i.t0=i.catch(13);case 25:i.next=11;break;case 27:i.next=32;break;case 29:i.prev=29,i.t1=i.catch(9),c.e(i.t1);case 32:return i.prev=32,c.f(),i.finish(32);case 35:if(v=a.filter(function(e){return e._shouldAllowMigration}),!o._shouldAllowMigration||!v.length){i.next=47;break}if(o=v[0],i.t3=u,!i.t3){i.next=42;break}return i.next=42,o._set(s,u.toJSON());case 42:return i.next=44,Promise.all(n.map(function(){var e=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t===o){e.next=8;break}return e.prev=1,e.next=4,t._remove(s);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}()));case 44:i.t2=new e(o,t,r),i.next=48;break;case 47:i.t2=new e(o,t,r);case 48:return i.abrupt("return",i.t2);case 49:case"end":return i.stop()}},i,null,[[9,29,32,35],[13,23]])}))()}}]),e}();function Mj(e){var t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Fj(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Nj(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Bj(t))return"Blackberry";if(Vj(t))return"Webos";if(Dj(t))return"Safari";if((t.includes("chrome/")||Lj(t))&&!t.includes("edge/"))return"Chrome";if(Uj(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Nj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/firefox\//i.test(e)}function Dj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV(),t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Lj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/crios\//i.test(e)}function Fj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/iemobile/i.test(e)}function Uj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/android/i.test(e)}function Bj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/blackberry/i.test(e)}function Vj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/webos/i.test(e)}function zj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Hj(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return zj(e)||Uj(e)||Vj(e)||Bj(e)||/windows phone/i.test(e)||Fj(e)}function Gj(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Mj(bV());break;case"Worker":t="".concat(Mj(bV()),"-").concat(e);break;default:t=e}return"".concat(t,"/JsCore/9.9.0/").concat(n.length?n.join(","):"FirebaseCore-web")}var $j=function(){function e(t){Wg(this,e),this.auth=t,this.queue=[]}return jg(e,[{key:"pushCallback",value:function(e,t){var n=this,r=function(t){return new Promise(function(n,r){try{n(e(t))}catch(i){r(i)}})};r.onAbort=t,this.queue.push(r);var i=this.queue.length-1;return function(){n.queue[i]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.auth.currentUser!==e){n.next=2;break}return n.abrupt("return");case 2:i=[],n.prev=3,a=Hg(t.queue),n.prev=5,a.s();case 7:if((o=a.n()).done){n.next=14;break}return s=o.value,n.next=11,s(e);case 11:s.onAbort&&i.push(s.onAbort);case 12:n.next=7;break;case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(5),a.e(n.t0);case 19:return n.prev=19,a.f(),n.finish(19);case 22:n.next=30;break;case 24:n.prev=24,n.t1=n.catch(3),i.reverse(),u=Hg(i);try{for(u.s();!(c=u.n()).done;){l=c.value;try{l()}catch(h){}}}catch(f){u.e(f)}finally{u.f()}throw t.auth._errorFactory.create("login-blocked",{originalMessage:null===(r=n.t1)||void 0===r?void 0:r.message});case 30:case"end":return n.stop()}},n,null,[[3,24],[5,16,19,22]])}))()}}]),e}(),Wj=function(){function e(t,n,r){Wg(this,e),this.app=t,this.heartbeatServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jj(this),this.idTokenSubscription=new jj(this),this.beforeStateQueue=new $j(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mq,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion}return jg(e,[{key:"_initializeWithPersistence",value:function(e,t){var n=this;return t&&(this._popupRedirectResolver=Wq(t)),this._initializationPromise=this.queue(iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!n._deleted,!r.t0){r.next=6;break}return r.next=4,Rj.create(n,e);case 4:n.persistenceManager=r.sent,r.t0=!n._deleted;case 6:if(!r.t0){r.next=19;break}if(!(null===(i=n._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)){r.next=15;break}return r.prev=8,r.next=11,n._popupRedirectResolver._initialize(n);case 11:r.next=15;break;case 13:r.prev=13,r.t1=r.catch(8);case 15:return r.next=17,n.initializeCurrentUser(t);case 17:n.lastNotifiedUid=(null===(a=n.currentUser)||void 0===a?void 0:a.uid)||null,!n._deleted&&(n._isInitialized=!0);case 19:case"end":return r.stop()}},r,null,[[8,13]])}))),this._initializationPromise}},{key:"_onStorageEvent",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._deleted){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.assertedPersistence.getCurrentUser();case 4:if(n=t.sent,!e.currentUser&&!n){t.next=13;break}if(!e.currentUser||!n||e.currentUser.uid!==n.uid){t.next=11;break}return e._currentUser._assign(n),t.next=10,e.currentUser.getIdToken();case 10:return t.abrupt("return",void t.sent);case 11:return t.next=13,e._updateCurrentUser(n,!0);case 13:case"end":return t.stop()}},t)}))()}},{key:"initializeCurrentUser",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.assertedPersistence.getCurrentUser();case 2:if(i=n.sent,a=i,o=!1,!e||!t.config.authDomain){n.next=13;break}return n.next=7,t.getOrInitRedirectPersistenceManager();case 7:return s=null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId,u=null==a?void 0:a._redirectEventId,n.next=11,t.tryRedirectSignIn(e);case 11:c=n.sent,(!s||s===u)&&(null==c?void 0:c.user)&&(a=c.user,o=!0);case 13:if(a){n.next=15;break}return n.abrupt("return",t.directlySetCurrentUser(null));case 15:if(a._redirectEventId){n.next=26;break}if(!o){n.next=25;break}return n.prev=17,n.next=20,t.beforeStateQueue.runMiddleware(a);case 20:n.next=25;break;case 22:n.prev=22,n.t0=n.catch(17),a=i,t._popupRedirectResolver._overrideRedirectResult(t,function(){return Promise.reject(n.t0)});case 25:return n.abrupt("return",a?t.reloadAndSetCurrentUserOrClear(a):t.directlySetCurrentUser(null));case 26:return zq(t._popupRedirectResolver,t,"argument-error"),n.next=29,t.getOrInitRedirectPersistenceManager();case 29:return n.abrupt("return",t.redirectUser&&t.redirectUser._redirectEventId===a._redirectEventId?t.directlySetCurrentUser(a):t.reloadAndSetCurrentUserOrClear(a));case 30:case"end":return n.stop()}},n,null,[[17,22]])}))()}},{key:"tryRedirectSignIn",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=null,n.prev=1,n.next=4,t._popupRedirectResolver._completeRedirectFn(t,e,!0);case 4:r=n.sent,n.next=11;break;case 7:return n.prev=7,n.t0=n.catch(1),n.next=11,t._setRedirectUser(null);case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}},n,null,[[1,7]])}))()}},{key:"reloadAndSetCurrentUserOrClear",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Cj(e);case 3:n.next=9;break;case 5:if(n.prev=5,n.t0=n.catch(0),"auth/network-request-failed"===(null===(r=n.t0)||void 0===r?void 0:r.code)){n.next=9;break}return n.abrupt("return",t.directlySetCurrentUser(null));case 9:return n.abrupt("return",t.directlySetCurrentUser(e));case 10:case"end":return n.stop()}},n,null,[[0,5]])}))()}},{key:"useDeviceLanguage",value:function(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}},{key:"_delete",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e._deleted=!0;case 1:case"end":return t.stop()}},t)}))()}},{key:"updateCurrentUser",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e?XV(e):null,n.abrupt("return",(r&&zq(r.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(r&&r._clone(t))));case 2:case"end":return n.stop()}},n)}))()}},{key:"_updateCurrentUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n._deleted){r.next=7;break}if(e&&zq(n.tenantId===e.tenantId,n,"tenant-id-mismatch"),r.t0=t,r.t0){r.next=6;break}return r.next=6,n.beforeStateQueue.runMiddleware(e);case 6:return r.abrupt("return",n.queue(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.directlySetCurrentUser(e);case 2:n.notifyAuthListeners();case 3:case"end":return t.stop()}},t)}))));case 7:case"end":return r.stop()}},r)}))()}},{key:"signOut",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.beforeStateQueue.runMiddleware(null);case 2:if(t.t0=e.redirectPersistenceManager||e._popupRedirectResolver,!t.t0){t.next=6;break}return t.next=6,e._setRedirectUser(null);case 6:return t.abrupt("return",e._updateCurrentUser(null,!0));case 7:case"end":return t.stop()}},t)}))()}},{key:"setPersistence",value:function(e){var t=this;return this.queue(iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.assertedPersistence.setPersistence(Wq(e));case 2:case"end":return n.stop()}},n)})))}},{key:"_getPersistence",value:function(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function(e){this._errorFactory=new RV("auth","Firebase",e())}},{key:"onAuthStateChanged",value:function(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}},{key:"beforeAuthStateChanged",value:function(e,t){return this.beforeStateQueue.pushCallback(e,t)}},{key:"onIdTokenChanged",value:function(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}},{key:"toJSON",value:function(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}},{key:"_setRedirectUser",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getOrInitRedirectPersistenceManager(t);case 2:return i=r.sent,r.abrupt("return",null===e?i.removeCurrentUser():i.setCurrentUser(e));case 4:case"end":return r.stop()}},r)}))()}},{key:"getOrInitRedirectPersistenceManager",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.redirectPersistenceManager){n.next=9;break}return zq(r=e&&Wq(e)||t._popupRedirectResolver,t,"argument-error"),n.next=5,Rj.create(t,[Wq(r._redirectPersistence)],"redirectUser");case 5:return t.redirectPersistenceManager=n.sent,n.next=8,t.redirectPersistenceManager.getCurrentUser();case 8:t.redirectUser=n.sent;case 9:return n.abrupt("return",t.redirectPersistenceManager);case 10:case"end":return n.stop()}},n)}))()}},{key:"_redirectUserForId",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=t._isInitialized,!n.t0){n.next=4;break}return n.next=4,t.queue(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})));case 4:return n.abrupt("return",(null===(r=t._currentUser)||void 0===r?void 0:r._redirectEventId)===e?t._currentUser:(null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId)===e?t.redirectUser:null);case 5:case"end":return n.stop()}},n)}))()}},{key:"_persistUserIfCurrent",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e!==t.currentUser){n.next=2;break}return n.abrupt("return",t.queue(iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.directlySetCurrentUser(e));case 1:case"end":return n.stop()}},n)}))));case 2:case"end":return n.stop()}},n)}))()}},{key:"_notifyListenersIfCurrent",value:function(e){e===this.currentUser&&this.notifyAuthListeners()}},{key:"_key",value:function(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}},{key:"_stopProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}},{key:"_currentUser",get:function(){return this.currentUser}},{key:"notifyAuthListeners",value:function(){var e,t;if(this._isInitialized){this.idTokenSubscription.next(this.currentUser);var n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}}},{key:"registerStateListener",value:function(e,t,n,r){var i=this;if(this._deleted)return function(){};var a="function"==typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return zq(o,this,"internal-error"),o.then(function(){return a(i.currentUser)}),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}},{key:"directlySetCurrentUser",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,!e){n.next=7;break}return n.next=5,t.assertedPersistence.setCurrentUser(e);case 5:n.next=9;break;case 7:return n.next=9,t.assertedPersistence.removeCurrentUser();case 9:case"end":return n.stop()}},n)}))()}},{key:"queue",value:function(e){return this.operations=this.operations.then(e,e),this.operations}},{key:"assertedPersistence",get:function(){return zq(this.persistenceManager,this,"internal-error"),this.persistenceManager}},{key:"_logFramework",value:function(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Gj(this.config.clientPlatform,this._getFrameworks()))}},{key:"_getFrameworks",value:function(){return this.frameworks}},{key:"_getAdditionalHeaders",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={"X-Client-Version":e.clientVersion},e.app.options.appId&&(r["X-Firebase-gmpid"]=e.app.options.appId),t.next=4,null===(n=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===n?void 0:n.getHeartbeatsHeader();case 4:return i=t.sent,t.abrupt("return",(i&&(r["X-Firebase-Client"]=i),r));case 6:case"end":return t.stop()}},t)}))()}}]),e}();function qj(e){return XV(e)}var jj=function(){function e(t){var n,r=this;Wg(this,e),this.auth=t,this.observer=null,this.addObserver=(n=new jV(function(e){return r.observer=e},void 0)).subscribe.bind(n)}return jg(e,[{key:"next",get:function(){return zq(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}]),e}();function Zj(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Yj(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}var Kj=function(){function e(t,n){Wg(this,e),this.providerId=t,this.signInMethod=n}return jg(e,[{key:"toJSON",value:function(){return Hq("not implemented")}},{key:"_getIdTokenResponse",value:function(e){return Hq("not implemented")}},{key:"_linkToIdToken",value:function(e,t){return Hq("not implemented")}},{key:"_getReauthenticationResolver",value:function(e){return Hq("not implemented")}}]),e}();function Qj(){return(Qj=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ej(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Xj(){return(Xj=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ij(t,"POST","/v1/accounts:signInWithPassword",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Jj(e,t){return eZ.apply(this,arguments)}function eZ(){return(eZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ej(t,"POST","/v1/accounts:sendOobCode",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function tZ(e,t){return nZ.apply(this,arguments)}function nZ(){return(nZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Jj(t,n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rZ(e,t){return iZ.apply(this,arguments)}function iZ(){return(iZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Jj(t,n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function aZ(){return(aZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ij(t,"POST","/v1/accounts:signInWithEmailLink",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oZ(){return(oZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ij(t,"POST","/v1/accounts:signInWithEmailLink",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var sZ=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Wg(this,n),(a=t.call(this,"password",i))._email=e,a._password=r,a._tenantId=o,a}return jg(n,[{key:"toJSON",value:function(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=t.signInMethod,n.next="password"===n.t0?3:"emailLink"===n.t0?4:5;break;case 3:return n.abrupt("return",function(e,t){return Xj.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password}));case 4:return n.abrupt("return",function(e,t){return aZ.apply(this,arguments)}(e,{email:t._email,oobCode:t._password}));case 5:Lq(e,"internal-error");case 6:case"end":return n.stop()}},n)}))()}},{key:"_linkToIdToken",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=n.signInMethod,r.next="password"===r.t0?3:"emailLink"===r.t0?4:5;break;case 3:return r.abrupt("return",function(e,t){return Qj.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password}));case 4:return r.abrupt("return",function(e,t){return oZ.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password}));case 5:Lq(e,"internal-error");case 6:case"end":return r.stop()}},r)}))()}},{key:"_getReauthenticationResolver",value:function(e){return this._getIdTokenResponse(e)}}],[{key:"_fromEmailAndPassword",value:function(e,t){return new n(e,t,"password")}},{key:"_fromEmailAndCode",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new n(e,t,"emailLink",r)}},{key:"fromJSON",value:function(e){var t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}}]),n}(Kj);function uZ(e,t){return cZ.apply(this,arguments)}function cZ(){return(cZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ij(t,"POST","/v1/accounts:signInWithIdp",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var lZ=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).pendingToken=null,e}return jg(n,[{key:"toJSON",value:function(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}},{key:"_getIdTokenResponse",value:function(e){return uZ(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,t){var n=this.buildRequest();return n.idToken=t,uZ(e,n)}},{key:"_getReauthenticationResolver",value:function(e){var t=this.buildRequest();return t.autoCreate=!1,uZ(e,t)}},{key:"buildRequest",value:function(){var e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{var t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=GV(t)}return e}}],[{key:"_fromParams",value:function(e){var t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Lq("argument-error"),t}},{key:"fromJSON",value:function(e){var t="string"==typeof e?JSON.parse(e):e,r=t.providerId,i=t.signInMethod,a=Py(t,["providerId","signInMethod"]);if(!r||!i)return null;var o=new n(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}}]),n}(Kj),hZ=function(){function e(t){var n,r,i,a,o,s;Wg(this,e);var u=$V(WV(t)),c=null!==(n=u.apiKey)&&void 0!==n?n:null,l=null!==(r=u.oobCode)&&void 0!==r?r:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=u.mode)&&void 0!==i?i:null);zq(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(a=u.continueUrl)&&void 0!==a?a:null,this.languageCode=null!==(o=u.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=u.tenantId)&&void 0!==s?s:null}return jg(e,null,[{key:"parseLink",value:function(t){var n=function(e){var t=$V(WV(e)).link,n=t?$V(WV(t)).deep_link_id:null,r=$V(WV(e)).deep_link_id;return(r?$V(WV(r)).link:null)||r||n||t||e}(t);try{return new e(n)}catch(r){return null}}}]),e}(),fZ=function(){var e=function(){function e(){Wg(this,e),this.providerId=e.PROVIDER_ID}return jg(e,null,[{key:"credential",value:function(e,t){return sZ._fromEmailAndPassword(e,t)}},{key:"credentialWithLink",value:function(e,t){var n=hZ.parseLink(t);return zq(n,"argument-error"),sZ._fromEmailAndCode(e,n.code,n.tenantId)}}]),e}();return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e}(),dZ=function(){function e(t){Wg(this,e),this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}return jg(e,[{key:"setDefaultLanguage",value:function(e){this.defaultLanguageCode=e}},{key:"setCustomParameters",value:function(e){return this.customParameters=e,this}},{key:"getCustomParameters",value:function(){return this.customParameters}}]),e}(),vZ=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).scopes=[],e}return jg(n,[{key:"addScope",value:function(e){return this.scopes.includes(e)||this.scopes.push(e),this}},{key:"getScopes",value:function(){return Vg(this.scopes)}}]),n}(dZ),pZ=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this,"google.com")).addScope("profile"),e}return jg(n,null,[{key:"credential",value:function(e,t){return lZ._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthIdToken,i=t.oauthAccessToken;if(!r&&!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(vZ);return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e}();function gZ(e,t){return yZ.apply(this,arguments)}function yZ(){return(yZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ij(t,"POST","/v1/accounts:signUp",Jq(t,n)));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var mZ=function(){function e(t){Wg(this,e),this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}return jg(e,null,[{key:"_fromIdTokenResponse",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return iV(regeneratorRuntime.mark(function a(){var o,s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Ij._fromIdTokenResponse(t,r,i);case 2:return o=a.sent,s=kZ(r),a.abrupt("return",new e({user:o,providerId:s,_tokenResponse:r,operationType:n}));case 5:case"end":return a.stop()}},a)}))()}},{key:"_forOperation",value:function(t,n,r){return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t._updateTokensIfNecessary(r,!0);case 2:return a=kZ(r),i.abrupt("return",new e({user:t,providerId:a,_tokenResponse:r,operationType:n}));case 4:case"end":return i.stop()}},i)}))()}}]),e}();function kZ(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}var _Z=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o,s;return Wg(this,n),(o=t.call(this,r.code,r.message)).operationType=i,o.user=a,Object.setPrototypeOf(Fg(o),n.prototype),o.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:r.customData._serverResponse,operationType:i},o}return jg(n,null,[{key:"_fromErrorAndOperation",value:function(e,t,r,i){return new n(e,t,r,i)}}]),n}(xV);function CZ(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(function(n){throw"auth/multi-factor-auth-required"===n.code?_Z._fromErrorAndOperation(e,n,t,r):n})}function wZ(e,t){return bZ.apply(this,arguments)}function bZ(){return(bZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]&&a[2],e.t0=gj,e.t1=t,e.t2=n,e.t3=t.auth,e.next=7,t.getIdToken();case 7:return e.t4=e.sent,e.t5=e.t2._linkToIdToken.call(e.t2,e.t3,e.t4),e.t6=r,e.next=12,(0,e.t0)(e.t1,e.t5,e.t6);case 12:return i=e.sent,e.abrupt("return",mZ._forOperation(t,"link",i));case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function EZ(){return(EZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],a=t.auth,o="reauthenticate",e.prev=2,e.next=5,gj(t,CZ(a,o,n,t),r);case 5:return zq((s=e.sent).idToken,a,"internal-error"),zq(u=pj(s.idToken),a,"internal-error"),c=u.sub,e.abrupt("return",(zq(t.uid===c,a,"user-mismatch"),mZ._forOperation(t,o,s)));case 13:throw e.prev=13,e.t0=e.catch(2),"auth/user-not-found"===(null===(i=e.t0)||void 0===i?void 0:i.code)&&Lq(a,"user-mismatch"),e.t0;case 16:case"end":return e.stop()}},e,null,[[2,13]])}))).apply(this,arguments)}function SZ(e,t){return PZ.apply(this,arguments)}function PZ(){return(PZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i="signIn",e.next=4,CZ(t,i,n);case 4:return a=e.sent,e.next=7,mZ._fromIdTokenResponse(t,i,a);case 7:if(o=e.sent,e.t0=r,e.t0){e.next=12;break}return e.next=12,t._updateCurrentUser(o.user);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function OZ(){return(OZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",SZ(qj(t),n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function TZ(e,t,n){var r;zq((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),zq(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(zq(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(zq(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function IZ(){return(IZ=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=XV(t),a={requestType:"PASSWORD_RESET",email:n},r&&TZ(i,a,r),e.next=4,rZ(i,a);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function AZ(){return(AZ=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=qj(t),e.next=3,gZ(i,{returnSecureToken:!0,email:n,password:r});case 3:return a=e.sent,e.next=6,mZ._fromIdTokenResponse(i,"signIn",a);case 6:return o=e.sent,e.next=9,i._updateCurrentUser(o.user);case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function xZ(){return(xZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=XV(t),e.next=3,t.getIdToken();case 3:return e.t0=e.sent,i={requestType:"VERIFY_EMAIL",idToken:e.t0},n&&TZ(r.auth,i,n),e.next=8,tZ(r.auth,i);case 8:if(a=e.sent,o=a.email,e.t1=o!==t.email,!e.t1){e.next=14;break}return e.next=14,t.reload();case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function RZ(e,t){return MZ.apply(this,arguments)}function MZ(){return(MZ=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ej(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function NZ(){return(NZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.displayName,i=n.photoURL,void 0!==r||void 0!==i){e.next=3;break}return e.abrupt("return");case 3:return a=XV(t),e.next=6,a.getIdToken();case 6:return e.t0=e.sent,e.t1=r,e.t2=i,e.t3=!0,o={idToken:e.t0,displayName:e.t1,photoUrl:e.t2,returnSecureToken:e.t3},e.next=13,gj(a,RZ(a.auth,o));case 13:return s=e.sent,a.displayName=s.displayName||null,a.photoURL=s.photoUrl||null,(u=a.providerData.find(function(e){return"password"===e.providerId}))&&(u.displayName=a.displayName,u.photoURL=a.photoURL),e.next=19,a._updateTokensIfNecessary(s);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}new WeakMap;var DZ="__sak",LZ=function(){function e(t,n){Wg(this,e),this.storageRetriever=t,this.type=n}return jg(e,[{key:"_isAvailable",value:function(){try{return this.storage?(this.storage.setItem(DZ,"1"),this.storage.removeItem(DZ),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"_set",value:function(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}},{key:"_get",value:function(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}},{key:"_remove",value:function(e){return this.storage.removeItem(e),Promise.resolve()}},{key:"storage",get:function(){return this.storageRetriever()}}]),e}(),FZ=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this,function(){return window.localStorage},"LOCAL")).boundEventHandler=function(t,n){return e.onStorageEvent(t,n)},e.listeners={},e.localCache={},e.pollTimer=null,e.safariLocalStorageNotSynced=function(){var e=bV();return Dj(e)||zj(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),e.fallbackToPolling=Hj(),e._shouldAllowMigration=!0,e}return jg(n,[{key:"forAllChangedKeys",value:function(e){for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.storage.getItem(r),a=this.localCache[r];i!==a&&e(r,a,i)}}},{key:"onStorageEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.key){var r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}var a=function(){var e=t.storage.getItem(r);!n&&t.localCache[r]===e||t.notifyListeners(r,e)},o=this.storage.getItem(r);OV()&&10===document.documentMode&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,10):a()}else this.forAllChangedKeys(function(e,n,r){t.notifyListeners(e,r)})}},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t&&JSON.parse(t))}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval(function(){e.forAllChangedKeys(function(t,n,r){e.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:r}),!0)})},1e3)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"attachListener",value:function(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}},{key:"_set",value:function(e,t){var r=this,i=this;return iV(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,xg(Bg(n.prototype),"_set",r).call(i,e,t);case 2:i.localCache[e]=JSON.stringify(t);case 3:case"end":return a.stop()}},a)}))()}},{key:"_get",value:function(e){var t=this,r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,xg(Bg(n.prototype),"_get",t).call(r,e);case 2:return a=i.sent,i.abrupt("return",(r.localCache[e]=JSON.stringify(a),a));case 4:case"end":return i.stop()}},i)}))()}},{key:"_remove",value:function(e){var t=this,r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,xg(Bg(n.prototype),"_remove",t).call(r,e);case 2:delete r.localCache[e];case 3:case"end":return i.stop()}},i)}))()}}]),n}(LZ);return e.type="LOCAL",e}(),UZ=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,function(){return window.sessionStorage},"SESSION")}return jg(n,[{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),n}(LZ);return e.type="SESSION",e}(),BZ=function(){var e=function(){function e(t){Wg(this,e),this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}return jg(e,[{key:"isListeningto",value:function(e){return this.eventTarget===e}},{key:"handleEvent",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=e).data,a=i.eventId,o=i.eventType,s=i.data,null==(u=t.handlersMap[o])?void 0:u.size){n.next=3;break}return n.abrupt("return");case 3:return r.ports[0].postMessage({status:"ack",eventId:a,eventType:o}),c=Array.from(u).map(function(){var e=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(r.origin,s));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.next=7,function(e){return Promise.all(e.map((t=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=!0,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",{fulfilled:e.t0,value:e.t1});case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",{fulfilled:!1,reason:e.t2});case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e){return t.apply(this,arguments)})));var t}(c);case 7:l=n.sent,r.ports[0].postMessage({status:"done",eventId:a,eventType:o,response:l});case 9:case"end":return n.stop()}},n)}))()}},{key:"_subscribe",value:function(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}},{key:"_unsubscribe",value:function(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}],[{key:"_getInstance",value:function(t){var n=this.receivers.find(function(e){return e.isListeningto(t)});if(n)return n;var r=new e(t);return this.receivers.push(r),r}}]),e}();return e.receivers=[],e}();function VZ(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="",r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}var zZ=function(){function e(t){Wg(this,e),this.target=t,this.handlers=new Set}return jg(e,[{key:"removeMessageHandler",value:function(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}},{key:"_send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=this;return iV(regeneratorRuntime.mark(function i(){var a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a="undefined"!=typeof MessageChannel?new MessageChannel:null){i.next=3;break}throw new Error("connection_unavailable");case 3:return i.abrupt("return",new Promise(function(i,u){var c=VZ("",20);a.port1.start();var l=setTimeout(function(){u(new Error("unsupported_event"))},n);s={messageChannel:a,onMessage:function(e){var t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),o=setTimeout(function(){u(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),i(t.data.response);break;default:clearTimeout(l),clearTimeout(o),u(new Error("invalid_response"))}}},r.handlers.add(s),a.port1.addEventListener("message",s.onMessage),r.target.postMessage({eventType:e,eventId:c,data:t},[a.port2])}).finally(function(){s&&r.removeMessageHandler(s)}));case 4:case"end":return i.stop()}},i)}))()}}]),e}();function HZ(){return window}function GZ(){return void 0!==HZ().WorkerGlobalScope&&"function"==typeof HZ().importScripts}function $Z(){return($Z=iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==navigator?void 0:navigator.serviceWorker){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,navigator.serviceWorker.ready;case 5:return e.abrupt("return",e.sent.active);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",null);case 11:case"end":return e.stop()}},e,null,[[2,8]])}))).apply(this,arguments)}var WZ="firebaseLocalStorageDb",qZ="firebaseLocalStorage",jZ="fbase_key",ZZ=function(){function e(t){Wg(this,e),this.request=t}return jg(e,[{key:"toPromise",value:function(){var e=this;return new Promise(function(t,n){e.request.addEventListener("success",function(){t(e.request.result)}),e.request.addEventListener("error",function(){n(e.request.error)})})}}]),e}();function YZ(e,t){return e.transaction([qZ],t?"readwrite":"readonly").objectStore(qZ)}function KZ(){var e=indexedDB.open(WZ,1);return new Promise(function(t,n){e.addEventListener("error",function(){n(e.error)}),e.addEventListener("upgradeneeded",function(){var t=e.result;try{t.createObjectStore(qZ,{keyPath:jZ})}catch(r){n(r)}}),e.addEventListener("success",iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=e.result).objectStoreNames.contains(qZ)){n.next=5;break}t(r),n.next=13;break;case 5:return r.close(),n.next=8,function(){var e=indexedDB.deleteDatabase(WZ);return new ZZ(e).toPromise()}();case 8:return n.t0=t,n.next=11,KZ();case 11:n.t1=n.sent,(0,n.t0)(n.t1);case 13:case"end":return n.stop()}},n)})))})}function QZ(e,t,n){return XZ.apply(this,arguments)}function XZ(){return(XZ=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=YZ(t,!0).put((Sg(i={},jZ,n),Sg(i,"value",r),i)),e.abrupt("return",new ZZ(a).toPromise());case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function JZ(){return(JZ=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=YZ(t,!1).get(n),e.next=3,new ZZ(r).toPromise();case 3:return i=e.sent,e.abrupt("return",void 0===i?null:i.value);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function eY(e,t){var n=YZ(e,!0).delete(t);return new ZZ(n).toPromise()}var tY=function(){var e=function(){function e(){Wg(this,e),this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(function(){},function(){})}return jg(e,[{key:"_openDb",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.db,t.t0){t.next=5;break}return t.next=4,KZ();case 4:e.db=t.sent;case 5:return t.abrupt("return",e.db);case 6:case"end":return t.stop()}},t)}))()}},{key:"_withRetries",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=0;case 1:return n.prev=1,n.next=4,t._openDb();case 4:return i=n.sent,n.next=7,e(i);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(1),!(r++>3)){n.next=14;break}throw n.t0;case 14:t.db&&(t.db.close(),t.db=void 0);case 15:n.next=1;break;case 17:case"end":return n.stop()}},n,null,[[1,10]])}))()}},{key:"initializeServiceWorkerMessaging",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",GZ()?e.initializeReceiver():e.initializeSender());case 1:case"end":return t.stop()}},t)}))()}},{key:"initializeReceiver",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.receiver=BZ._getInstance(GZ()?self:null),e.receiver._subscribe("keyChanged",function(){var t=iV(regeneratorRuntime.mark(function t(n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._poll();case 2:return t.t0=t.sent.includes(r.key),t.abrupt("return",{keyProcessed:t.t0});case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",["keyChanged"]);case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t)}))()}},{key:"initializeSender",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,function(){return $Z.apply(this,arguments)}();case 2:if(e.activeServiceWorker=t.sent,e.activeServiceWorker){t.next=5;break}return t.abrupt("return");case 5:return e.sender=new zZ(e.activeServiceWorker),t.next=8,e.sender._send("ping",{},800);case 8:!(i=t.sent)||(null===(n=i[0])||void 0===n?void 0:n.fulfilled)&&(null===(r=i[0])||void 0===r?void 0:r.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0);case 10:case"end":return t.stop()}},t)}))()}},{key:"notifyServiceWorker",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.sender||!t.activeServiceWorker||function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()!==t.activeServiceWorker){n.next=8;break}return n.prev=1,n.next=4,t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50);case 4:n.next=8;break;case 6:n.prev=6,n.t0=n.catch(1);case 8:case"end":return n.stop()}},n,null,[[1,6]])}))()}},{key:"_isAvailable",value:function(){return iV(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,indexedDB){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,KZ();case 5:return t=e.sent,e.next=8,QZ(t,DZ,"1");case 8:return e.next=10,eY(t,DZ);case 10:return e.abrupt("return",!0);case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,null,[[0,13]])}))()}},{key:"_withPendingWrite",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.pendingWrites++,n.prev=1,n.next=4,e();case 4:return n.prev=4,t.pendingWrites--,n.finish(4);case 7:case"end":return n.stop()}},n,null,[[1,,4,7]])}))()}},{key:"_set",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",n._withPendingWrite(iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n._withRetries(function(n){return QZ(n,e,t)});case 2:return n.localCache[e]=t,r.abrupt("return",n.notifyServiceWorker(e));case 4:case"end":return r.stop()}},r)}))));case 1:case"end":return r.stop()}},r)}))()}},{key:"_get",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._withRetries(function(t){return function(e,t){return JZ.apply(this,arguments)}(t,e)});case 2:return r=n.sent,n.abrupt("return",(t.localCache[e]=r,r));case 4:case"end":return n.stop()}},n)}))()}},{key:"_remove",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._withPendingWrite(iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._withRetries(function(t){return eY(t,e)});case 2:return delete t.localCache[e],n.abrupt("return",t.notifyServiceWorker(e));case 4:case"end":return n.stop()}},n)}))));case 1:case"end":return n.stop()}},n)}))()}},{key:"_poll",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a,o,s,u,c,l,h,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._withRetries(function(e){var t=YZ(e,!1).getAll();return new ZZ(t).toPromise()});case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",[]);case 5:if(0===e.pendingWrites){t.next=7;break}return t.abrupt("return",[]);case 7:r=[],i=new Set,a=Hg(n);try{for(a.s();!(o=a.n()).done;)s=o.value,u=s.fbase_key,c=s.value,i.add(u),JSON.stringify(e.localCache[u])!==JSON.stringify(c)&&(e.notifyListeners(u,c),r.push(u))}catch(d){a.e(d)}finally{a.f()}for(l=0,h=Object.keys(e.localCache);l<h.length;l++)f=h[l],e.localCache[f]&&!i.has(f)&&(e.notifyListeners(f,null),r.push(f));return t.abrupt("return",r);case 12:case"end":return t.stop()}},t)}))()}},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._poll());case 1:case"end":return t.stop()}},t)})),800)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}]),e}();return e.type="LOCAL",e}();function nY(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}function rY(e,t){return t?Wq(t):(zq(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}nY("rcb"),new Zq(3e4,6e4);var iY=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,"custom","custom")).params=e,r}return jg(n,[{key:"_getIdTokenResponse",value:function(e){return uZ(e,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function(e,t){return uZ(e,this._buildIdpRequest(t))}},{key:"_getReauthenticationResolver",value:function(e){return uZ(e,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}]),n}(Kj);function aY(e){return SZ(e.auth,new iY(e),e.bypassAuthState)}function oY(e){var t=e.auth,n=e.user;return zq(n,t,"internal-error"),function(e,t){return EZ.apply(this,arguments)}(n,new iY(e),e.bypassAuthState)}function sY(e){return uY.apply(this,arguments)}function uY(){return(uY=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.auth,r=t.user,e.abrupt("return",(zq(r,n,"internal-error"),wZ(r,new iY(t),t.bypassAuthState)));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var cY=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Wg(this,e),this.auth=t,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}return jg(e,[{key:"execute",value:function(){var e,t=this;return new Promise((e=iV(regeneratorRuntime.mark(function e(n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.pendingPromise={resolve:n,reject:r},e.prev=1,e.next=4,t.resolver._initialize(t.auth);case 4:return t.eventManager=e.sent,e.next=7,t.onExecution();case 7:t.eventManager.registerConsumer(t),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t.reject(e.t0);case 13:case"end":return e.stop()}},e,null,[[1,10]])})),function(t,n){return e.apply(this,arguments)}))}},{key:"onAuthEvent",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.urlResponse,i=e.sessionId,a=e.postBody,o=e.tenantId,s=e.error,u=e.type,!s){n.next=3;break}return n.abrupt("return",void t.reject(s));case 3:return c={auth:t.auth,requestUri:r,sessionId:i,tenantId:o||void 0,postBody:a||void 0,user:t.user,bypassAuthState:t.bypassAuthState},n.prev=4,n.t0=t,n.next=8,t.getIdpTask(u)(c);case 8:n.t1=n.sent,n.t0.resolve.call(n.t0,n.t1),n.next=15;break;case 12:n.prev=12,n.t2=n.catch(4),t.reject(n.t2);case 15:case"end":return n.stop()}},n,null,[[4,12]])}))()}},{key:"onError",value:function(e){this.reject(e)}},{key:"getIdpTask",value:function(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return aY;case"linkViaPopup":case"linkViaRedirect":return sY;case"reauthViaPopup":case"reauthViaRedirect":return oY;default:Lq(this.auth,"internal-error")}}},{key:"resolve",value:function(e){Gq(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}},{key:"reject",value:function(e){Gq(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}]),e}(),lY=new Zq(2e3,1e4);function hY(){return(hY=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=qj(t),Bq(t,n,dZ),a=rY(i,r),e.abrupt("return",new fY(i,"signInViaPopup",n,a).executeNotNull());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var fY=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this,e,r,a,o)).provider=i,s.authWindow=null,s.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=Fg(s),s}return jg(n,[{key:"executeNotNull",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.execute();case 2:return n=t.sent,t.abrupt("return",(zq(n,e.auth,"internal-error"),n));case 4:case"end":return t.stop()}},t)}))()}},{key:"onExecution",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Gq(1===e.filter.length,"Popup operations only handle one event"),n=VZ(),t.next=4,e.resolver._openPopup(e.auth,e.provider,e.filter[0],n);case 4:e.authWindow=t.sent,e.authWindow.associatedEvent=n,e.resolver._originValidation(e.auth).catch(function(t){e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,function(t){t||e.reject(Fq(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation();case 9:case"end":return t.stop()}},t)}))()}},{key:"eventId",get:function(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}},{key:"cancel",value:function(){this.reject(Fq(this.auth,"cancelled-popup-request"))}},{key:"cleanUp",value:function(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}},{key:"pollUserCancellation",value:function(){var e=this;!function t(){var n,r;e.pollId=(null===(r=null===(n=e.authWindow)||void 0===n?void 0:n.window)||void 0===r?void 0:r.closed)?window.setTimeout(function(){e.pollId=null,e.reject(Fq(e.auth,"popup-closed-by-user"))},2e3):window.setTimeout(t,lY.get())}()}}]),n}(cY);return e.currentPopupAction=null,e}(),dY=new Map,vY=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Wg(this,n),(i=t.call(this,e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a)).eventId=null,i}return jg(n,[{key:"execute",value:function(){var e=this,t=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=dY.get(t.auth._key())){r.next=20;break}return r.prev=2,r.next=5,function(e,t){return pY.apply(this,arguments)}(t.resolver,t.auth);case 5:if(!r.sent){r.next=11;break}return r.next=8,xg(Bg(n.prototype),"execute",e).call(t);case 8:r.t0=r.sent,r.next=12;break;case 11:r.t0=null;case 12:a=r.t0,i=function(){return Promise.resolve(a)},r.next=19;break;case 16:r.prev=16,r.t1=r.catch(2),i=function(){return Promise.reject(r.t1)};case 19:dY.set(t.auth._key(),i);case 20:return r.abrupt("return",(t.bypassAuthState||dY.set(t.auth._key(),function(){return Promise.resolve(null)}),i()));case 21:case"end":return r.stop()}},r,null,[[2,16]])}))()}},{key:"onAuthEvent",value:function(e){var t=this,r=function(){return xg(Bg(n.prototype),"onAuthEvent",t)},i=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("signInViaRedirect"!==e.type){t.next=2;break}return t.abrupt("return",r().call(i,e));case 2:if("unknown"===e.type){t.next=12;break}if(!e.eventId){t.next=10;break}return t.next=6,i.auth._redirectUserForId(e.eventId);case 6:if(!(n=t.sent)){t.next=9;break}return t.abrupt("return",(i.user=n,r().call(i,e)));case 9:i.resolve(null);case 10:t.next=13;break;case 12:i.resolve(null);case 13:case"end":return t.stop()}},t)}))()}},{key:"onExecution",value:function(){return iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()}},{key:"cleanUp",value:function(){}}]),n}(cY);function pY(){return(pY=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=mY(n),i=yY(t),e.next=3,i._isAvailable();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,i._get(r);case 7:return e.t0=e.sent,a="true"===e.t0,e.next=11,i._remove(r);case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gY(e,t){dY.set(e._key(),t)}function yY(e){return Wq(e._redirectPersistence)}function mY(e){return xj("pendingRedirect",e.config.apiKey,e.name)}function kY(e,t){return _Y.apply(this,arguments)}function _Y(){return(_Y=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=qj(t),a=rY(i,n),e.next=5,new vY(i,a,r).execute();case 5:if(o=e.sent,e.t0=o&&!r,!e.t0){e.next=13;break}return delete o.user._redirectEventId,e.next=11,i._persistUserIfCurrent(o.user);case 11:return e.next=13,i._setRedirectUser(null,n);case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}var CY=function(){function e(t){Wg(this,e),this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}return jg(e,[{key:"registerConsumer",value:function(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}},{key:"unregisterConsumer",value:function(e){this.consumers.delete(e)}},{key:"onEvent",value:function(e){var t=this;if(this.hasEventBeenHandled(e))return!1;var n=!1;return this.consumers.forEach(function(r){t.isEventForConsumer(e,r)&&(n=!0,t.sendToConsumer(e,r),t.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bY(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}},{key:"sendToConsumer",value:function(e,t){var n;if(e.error&&!bY(e)){var r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Fq(this.auth,r))}else t.onAuthEvent(e)}},{key:"isEventForConsumer",value:function(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}},{key:"hasEventBeenHandled",value:function(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(wY(e))}},{key:"saveEventToCache",value:function(e){this.cachedEventUids.add(wY(e)),this.lastProcessedEventTime=Date.now()}}]),e}();function wY(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(function(e){return e}).join("-")}function bY(e){var t=e.type,n=e.error;return"unknown"===t&&"auth/no-auth-event"===(null==n?void 0:n.code)}function EY(e){return SY.apply(this,arguments)}function SY(){return(SY=iV(regeneratorRuntime.mark(function e(t){var n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",ej(t,"GET","/v1/projects",n));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}var PY=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,OY=/^https?/;function TY(){return(TY=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.emulator){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,EY(t);case 4:n=e.sent,r=n.authorizedDomains,i=Hg(r),e.prev=7,i.s();case 9:if((a=i.n()).done){e.next=20;break}if(o=a.value,e.prev=11,!IY(o)){e.next=14;break}return e.abrupt("return");case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(7),i.e(e.t1);case 25:return e.prev=25,i.f(),e.finish(25);case 28:Lq(t,"unauthorized-domain");case 29:case"end":return e.stop()}},e,null,[[7,22,25,28],[11,16]])}))).apply(this,arguments)}function IY(e){var t=qq(),n=new URL(t),r=n.protocol,i=n.hostname;if(e.startsWith("chrome-extension://")){var a=new URL(e);return""===a.hostname&&""===i?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&a.hostname===i}if(!OY.test(r))return!1;if(PY.test(e))return i===e;var o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}var AY=new Zq(3e4,6e4);function xY(){var e=HZ().___jsl;if(null==e?void 0:e.H)for(var t=0,n=Object.keys(e.H);t<n.length;t++){var r=n[t];if(e.H[r].r=e.H[r].r||[],e.H[r].L=e.H[r].L||[],e.H[r].r=Vg(e.H[r].L),e.CP)for(var i=0;i<e.CP.length;i++)e.CP[i]=null}}var RY=null;function MY(e){return RY=RY||function(e){return new Promise(function(t,n){var r,i,a;function o(){xY(),gapi.load("gapi.iframes",{callback:function(){t(gapi.iframes.getContext())},ontimeout:function(){xY(),n(Fq(e,"network-request-failed"))},timeout:AY.get()})}if(null===(i=null===(r=HZ().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=HZ().gapi)||void 0===a?void 0:a.load)){var s=nY("iframefcb");return HZ()[s]=function(){gapi.load?o():n(Fq(e,"network-request-failed"))},function(e){return new Promise(function(t,n){var r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=function(e){var t=Fq("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}("https://apis.google.com/js/api.js?onload=".concat(s)).catch(function(e){return n(e)})}o()}}).catch(function(e){throw RY=null,e})}(e)}var NY=new Zq(5e3,15e3),DY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function FY(e){var t=e.config;zq(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?Yq(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:Bz},i=LY.get(e.config.apiHost);i&&(r.eid=i);var a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat(GV(r).slice(1))}function UY(){return(UY=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,MY(t);case 2:return n=e.sent,r=HZ().gapi,e.abrupt("return",(zq(r,t,"internal-error"),n.open({where:document.body,url:FY(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DY,dontclear:!0},function(e){return new Promise((n=iV(regeneratorRuntime.mark(function n(r,i){var a,o,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(){HZ().clearTimeout(o),r(e)},n.next=3,e.restyle({setHideOnLeave:!1});case 3:a=Fq(t,"network-request-failed"),o=HZ().setTimeout(function(){i(a)},NY.get()),e.ping(s).then(s,function(){i(a)});case 5:case"end":return n.stop()}},n)})),function(e,t){return n.apply(this,arguments)}));var n})));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var BY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VY=function(){function e(t){Wg(this,e),this.window=t,this.associatedEvent=null}return jg(e,[{key:"close",value:function(){if(this.window)try{this.window.close()}catch(e){}}}]),e}();function zY(e,t,n,r,i,a){zq(e.config.authDomain,e,"auth-domain-config-required"),zq(e.config.apiKey,e,"invalid-api-key");var o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Bz,eventId:i};if(t instanceof dZ){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",BV(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var s=0,u=Object.entries(a||{});s<u.length;s++){var c=Pg(u[s],2),l=c[0],h=c[1];o[l]=h}}if(t instanceof vZ){var f=t.getScopes().filter(function(e){return""!==e});f.length>0&&(o.scopes=f.join(","))}e.tenantId&&(o.tid=e.tenantId);for(var d=o,v=0,p=Object.keys(d);v<p.length;v++){var g=p[v];void 0===d[g]&&delete d[g]}return"".concat(function(e){var t=e.config;return t.emulator?Yq(t,"emulator/auth/handler"):"https://".concat(t.authDomain,"/__/auth/handler")}(e),"?").concat(GV(d).slice(1))}var HY="webStorageSupport",GY=function(){function e(){Wg(this,e),this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=UZ,this._completeRedirectFn=kY,this._overrideRedirectResult=gY}return jg(e,[{key:"_openPopup",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o,s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return Gq(null===(o=i.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()"),s=zY(e,t,n,qq(),r),a.abrupt("return",function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600,a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),s="",u=Object.assign(Object.assign({},BY),{width:r.toString(),height:i.toString(),top:a,left:o}),c=bV().toLowerCase();n&&(s=Lj(c)?"_blank":n),Nj(c)&&(t=t||"http://localhost",u.scrollbars="yes");var l=Object.entries(u).reduce(function(e,t){var n=Pg(t,2),r=n[0],i=n[1];return"".concat(e).concat(r,"=").concat(i,",")},"");if(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bV();return zj(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==s)return function(e,t){var n=document.createElement("a");n.href=e,n.target=t;var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",s),new VY(null);var h=window.open(t||"",s,l);zq(h,e,"popup-blocked");try{h.focus()}catch(f){}return new VY(h)}(e,s,VZ()));case 3:case"end":return a.stop()}},a)}))()}},{key:"_openRedirect",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i._originValidation(e);case 2:return function(e){HZ().location.href=e}(zY(e,t,n,qq(),r)),a.abrupt("return",new Promise(function(){}));case 4:case"end":return a.stop()}},a)}))()}},{key:"_initialize",value:function(e){var t=this,n=e._key();if(this.eventManagers[n]){var r=this.eventManagers[n],i=r.manager,a=r.promise;return i?Promise.resolve(i):(Gq(a,"If manager is not set, promise should be"),a)}var o=this.initAndGetManager(e);return this.eventManagers[n]={promise:o},o.catch(function(){delete t.eventManagers[n]}),o}},{key:"initAndGetManager",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,function(e){return UY.apply(this,arguments)}(e);case 2:return r=n.sent,i=new CY(e),n.abrupt("return",(r.register("authEvent",function(t){return zq(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:i.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:i},t.iframes[e._key()]=r,i));case 5:case"end":return n.stop()}},n)}))()}},{key:"_isIframeWebStorageSupported",value:function(e,t){this.iframes[e._key()].send(HY,{type:HY},function(n){var r,i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[HY];void 0!==i&&t(!!i),Lq(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return TY.apply(this,arguments)}(e)),this.originValidationPromises[t]}},{key:"_shouldInitProactively",get:function(){return Hj()||Dj()||zj()}}]),e}(),$Y="@firebase/auth",WY=function(){function e(t){Wg(this,e),this.auth=t,this.internalListeners=new Map}return jg(e,[{key:"getUid",value:function(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}},{key:"getToken",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.assertAuthConfigured(),n.next=3,t.auth._initializationPromise;case 3:if(!t.auth.currentUser){n.next=10;break}return n.next=6,t.auth.currentUser.getIdToken(e);case 6:n.t1=n.sent,n.t0={accessToken:n.t1},n.next=11;break;case 10:n.t0=null;case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}},n)}))()}},{key:"addAuthTokenListener",value:function(e){if(this.assertAuthConfigured(),!this.internalListeners.has(e)){var t=this.auth.onIdTokenChanged(function(t){var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}}},{key:"removeAuthTokenListener",value:function(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}},{key:"assertAuthConfigured",value:function(){zq(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}]),e}();!function(e){Dz(new tz("auth",function(t,n){var r=n.options,i=t.getProvider("app").getImmediate(),a=t.getProvider("heartbeat"),o=i.options,s=o.apiKey,u=o.authDomain;return function(t,n){zq(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),zq(!(null==u?void 0:u.includes(":")),"argument-error",{appName:t.name});var i={apiKey:s,authDomain:u,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gj(e)},a=new Wj(t,n,i);return function(e,t){var n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Wq);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(a,r),a}(i,a)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(e,t,n){e.getProvider("auth-internal").initialize()})),Dz(new tz("auth-internal",function(e){var t=qj(e.getProvider("auth").getImmediate());return new WY(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Hz($Y,"0.20.5",void 0),Hz($Y,"0.20.5","esm2017")}("Browser");var qY=jg(function e(t){return Wg(this,e),t}),jY=jg(function e(){return Wg(this,e),DW("auth")}),ZY=new Y_("angularfire2.auth-instances");function YY(e){return function(t,n){var r=t.runOutsideAngular(function(){return e(n)});return new qY(r)}}var KY,QY={provide:jY,deps:[[new bC,ZY]]},XY={provide:qY,useFactory:function(e,t){var n=NW("auth",e,t);return n&&new qY(n)},deps:[[new bC,ZY],qW]},JY=function(){var e=jg(function e(){Wg(this,e),Hz("angularfire",OW.full,"auth")});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[XY,QY]}),e}(),eK=WW(function(e,t,n){var r=qj(e);zq(r._canInitEmulator,r,"emulator-config-failed"),zq(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!!(null==n?void 0:n.disableWarnings),a=Zj(t),o=function(e){var t=Zj(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};var r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){var a=i[1];return{host:a,port:Yj(r.substr(a.length+1))}}var o=Pg(r.split(":"),2);return{host:o[0],port:Yj(o[1])}}(t),s=o.host,u=o.port;r.config.emulator={url:"".concat(a,"//").concat(s).concat(null===u?"":":".concat(u),"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:u,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()},!0),tK=WW(function(e,t,n){return AZ.apply(this,arguments)},!0),nK=WW(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vz(),t=Lz(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){var n=Lz(e,"auth");if(n.isInitialized()){var r=n.getImmediate();if(zV(n.getOptions(),null!=t?t:{}))return r;Lq(r,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:GY,persistence:[tY,FZ,UZ]})},!0),rK=WW(function(e,t,n,r){return XV(e).onAuthStateChanged(t,n,r)},!0),iK=WW(function(e,t){return xZ.apply(this,arguments)},!0),aK=WW(function(e,t,n){return IZ.apply(this,arguments)},!0),oK=WW(function(e,t,n){return function(e,t){return OZ.apply(this,arguments)}(XV(e),fZ.credential(t,n))},!0),sK=WW(function(e,t,n){return hY.apply(this,arguments)},!0),uK=WW(function(e,t){return NZ.apply(this,arguments)},!0),cK="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},lK={},hK=hK||{},fK=cK||self;function dK(){}function vK(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function pK(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var gK="closure_uid_"+(1e9*Math.random()>>>0),yK=0;function mK(e,t,n){return e.call.apply(e.bind,arguments)}function kK(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function _K(e,t,n){return(_K=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?mK:kK).apply(null,arguments)}function CK(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function wK(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function bK(){this.s=this.s,this.o=this.o}var EK={};bK.prototype.s=!1,bK.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,gK)&&e[gK]||(e[gK]=++yK)}(this);delete EK[e]}},bK.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var SK=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},PK=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};function OK(e){return Array.prototype.concat.apply([],arguments)}function TK(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function IK(e){return/^[\s\xa0]*$/.test(e)}var AK,xK=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function RK(e,t){return-1!=e.indexOf(t)}function MK(e,t){return e<t?-1:e>t?1:0}e:{var NK=fK.navigator;if(NK){var DK=NK.userAgent;if(DK){AK=DK;break e}}AK=""}function LK(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function FK(e){var t={};for(var n in e)t[n]=e[n];return t}var UK="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function BK(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<UK.length;a++)n=UK[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function VK(e){return VK[" "](e),e}VK[" "]=dK;var zK,HK=RK(AK,"Opera"),GK=RK(AK,"Trident")||RK(AK,"MSIE"),$K=RK(AK,"Edge"),WK=$K||GK,qK=RK(AK,"Gecko")&&!(RK(AK.toLowerCase(),"webkit")&&!RK(AK,"Edge"))&&!(RK(AK,"Trident")||RK(AK,"MSIE"))&&!RK(AK,"Edge"),jK=RK(AK.toLowerCase(),"webkit")&&!RK(AK,"Edge");function ZK(){var e=fK.document;return e?e.documentMode:void 0}e:{var YK="",KK=function(){var e=AK;return qK?/rv:([^\);]+)(\)|;)/.exec(e):$K?/Edge\/([\d\.]+)/.exec(e):GK?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):jK?/WebKit\/(\S+)/.exec(e):HK?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(KK&&(YK=KK?KK[1]:""),GK){var QK=ZK();if(null!=QK&&QK>parseFloat(YK)){zK=String(QK);break e}}zK=YK}var XK={};var JK=fK.document&&GK&&(ZK()||parseInt(zK,10))||void 0,eQ=function(){if(!fK.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{fK.addEventListener("test",dK,t),fK.removeEventListener("test",dK,t)}catch(n){}return e}();function tQ(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function nQ(e,t){if(tQ.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(qK){e:{try{VK(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:rQ[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&nQ.Z.h.call(this)}}tQ.prototype.h=function(){this.defaultPrevented=!0},wK(nQ,tQ);var rQ={2:"touch",3:"pen",4:"mouse"};nQ.prototype.h=function(){nQ.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var iQ="closure_listenable_"+(1e6*Math.random()|0),aQ=0;function oQ(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++aQ,this.ca=this.fa=!1}function sQ(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function uQ(e){this.src=e,this.g={},this.h=0}function cQ(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=SK(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(sQ(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function lQ(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ca&&a.listener==t&&a.capture==!!n&&a.ia==r)return i}return-1}uQ.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=lQ(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new oQ(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var hQ="closure_lm_"+(1e6*Math.random()|0),fQ={};function dQ(e,t,n,r,i){if(r&&r.once)return pQ(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)dQ(e,t[a],n,r,i);return null}return n=wQ(n),e&&e[iQ]?e.N(t,n,pK(r)?!!r.capture:!!r,i):vQ(e,t,n,!1,r,i)}function vQ(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=pK(i)?!!i.capture:!!i,s=_Q(e);if(s||(e[hQ]=s=new uQ(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){var e=kQ;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)eQ||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(mQ(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function pQ(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)pQ(e,t[a],n,r,i);return null}return n=wQ(n),e&&e[iQ]?e.O(t,n,pK(r)?!!r.capture:!!r,i):vQ(e,t,n,!0,r,i)}function gQ(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)gQ(e,t[a],n,r,i);else r=pK(r)?!!r.capture:!!r,n=wQ(n),e&&e[iQ]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=lQ(a=e.g[t],n,r,i))&&(sQ(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--))):e&&(e=_Q(e))&&(t=e.g[t.toString()],e=-1,t&&(e=lQ(t,n,r,i)),(n=-1<e?t[e]:null)&&yQ(n))}function yQ(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[iQ])cQ(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(mQ(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=_Q(t))?(cQ(n,e),0==n.h&&(n.src=null,t[hQ]=null)):sQ(e)}}}function mQ(e){return e in fQ?fQ[e]:fQ[e]="on"+e}function kQ(e,t){if(e.ca)e=!0;else{t=new nQ(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&yQ(e),e=n.call(r,t)}return e}function _Q(e){return(e=e[hQ])instanceof uQ?e:null}var CQ="__closure_events_fn_"+(1e9*Math.random()>>>0);function wQ(e){return"function"==typeof e?e:(e[CQ]||(e[CQ]=function(t){return e.handleEvent(t)}),e[CQ])}function bQ(){bK.call(this),this.i=new uQ(this),this.P=this,this.I=null}function EQ(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new tQ(t,e);else if(t instanceof tQ)t.target=t.target||e;else{var i=t;BK(t=new tQ(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=SQ(o,r,!0,t)&&i}if(i=SQ(o=t.g=e,r,!0,t)&&i,i=SQ(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=SQ(o=t.g=n[a],r,!1,t)&&i}function SQ(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.ca&&o.capture==n){var s=o.listener,u=o.ia||o.src;o.fa&&cQ(e.i,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}wK(bQ,bK),bQ.prototype[iQ]=!0,bQ.prototype.removeEventListener=function(e,t,n,r){gQ(this,e,t,n,r)},bQ.prototype.M=function(){if(bQ.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)sQ(n[r]);delete t.g[e],t.h--}}this.I=null},bQ.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},bQ.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var PQ=fK.JSON.stringify;function OQ(){var e=NQ,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var TQ,IQ=new(function(){function e(t,n){Wg(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return jg(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())(function(){return new AQ},function(e){return e.reset()}),AQ=function(){function e(){Wg(this,e),this.next=this.g=this.h=null}return jg(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function xQ(e){fK.setTimeout(function(){throw e},0)}function RQ(e,t){TQ||function(){var e=fK.Promise.resolve(void 0);TQ=function(){e.then(DQ)}}(),MQ||(TQ(),MQ=!0),NQ.add(e,t)}var MQ=!1,NQ=new(function(){function e(){Wg(this,e),this.h=this.g=null}return jg(e,[{key:"add",value:function(e,t){var n=IQ.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}());function DQ(){for(var e;e=OQ();){try{e.h.call(e.g)}catch(n){xQ(n)}var t=IQ;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}MQ=!1}function LQ(e,t){bQ.call(this),this.h=e||1,this.g=t||fK,this.j=_K(this.kb,this),this.l=Date.now()}function FQ(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function UQ(e,t,n){if("function"==typeof e)n&&(e=_K(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=_K(e.handleEvent,e)}return 2147483647<Number(t)?-1:fK.setTimeout(e,t||0)}function BQ(e){e.g=UQ(function(){e.g=null,e.i&&(e.i=!1,BQ(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}wK(LQ,bQ),(KY=LQ.prototype).da=!1,KY.S=null,KY.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),EQ(this,"tick"),this.da&&(FQ(this),this.start()))}},KY.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},KY.M=function(){LQ.Z.M.call(this),FQ(this),delete this.g};var VQ=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return jg(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:BQ(this)}},{key:"M",value:function(){xg(Bg(n.prototype),"M",this).call(this),this.g&&(fK.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(bK);function zQ(e){bK.call(this),this.h=e,this.g={}}wK(zQ,bK);var HQ=[];function GQ(e,t,n,r){Array.isArray(n)||(n&&(HQ[0]=n.toString()),n=HQ);for(var i=0;i<n.length;i++){var a=dQ(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function $Q(e){LK(e.g,function(e,t){this.g.hasOwnProperty(t)&&yQ(e)},e),e.g={}}function WQ(){this.g=!0}function qQ(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return PQ(n)}catch(s){return t}}(e,n)+(r?" "+r:"")})}zQ.prototype.M=function(){zQ.Z.M.call(this),$Q(this)},zQ.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},WQ.prototype.Aa=function(){this.g=!1},WQ.prototype.info=function(){};var jQ={},ZQ=null;function YQ(){return ZQ=ZQ||new bQ}function KQ(e){tQ.call(this,jQ.Ma,e)}function QQ(e){var t=YQ();EQ(t,new KQ(t,e))}function XQ(e,t){tQ.call(this,jQ.STAT_EVENT,e),this.stat=t}function JQ(e){var t=YQ();EQ(t,new XQ(t,e))}function eX(e,t){tQ.call(this,jQ.Na,e),this.size=t}function tX(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return fK.setTimeout(function(){e()},t)}jQ.Ma="serverreachability",wK(KQ,tQ),jQ.STAT_EVENT="statevent",wK(XQ,tQ),jQ.Na="timingevent",wK(eX,tQ);var nX={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},rX={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function iX(){}function aX(){}iX.prototype.h=null;var oX,sX={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function uX(){tQ.call(this,"d")}function cX(){tQ.call(this,"c")}function lX(){}function hX(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new zQ(this),this.P=dX,this.W=new LQ(e=WK?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new fX}function fX(){this.i=null,this.g="",this.h=!1}wK(uX,tQ),wK(cX,tQ),wK(lX,iX),lX.prototype.g=function(){return new XMLHttpRequest},lX.prototype.i=function(){return{}},oX=new lX;var dX=45e3,vX={},pX={};function gX(e,t,n){e.K=1,e.v=BX(MX(t)),e.s=n,e.U=!0,yX(e,null)}function yX(e,t){e.F=Date.now(),CX(e),e.A=MX(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),XX(n.h,"t",r),e.C=0,n=e.l.H,e.h=new fX,e.g=XJ(e.l,n?t:null,!e.s),0<e.O&&(e.L=new VQ(_K(e.Ia,e,e.g),e.O)),GQ(e.V,e.g,"readystatechange",e.gb),t=e.H?FK(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),QQ(1),function(e,t,n,r,i,a){e.info(function(){if(e.g)if(a)for(var o="",s=a.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function mX(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function kX(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=_X(e,n))==pX){4==t&&(e.o=4,JQ(14),i=!1),qQ(e.j,e.m,null,"[Incomplete Response]");break}if(r==vX){e.o=4,JQ(15),qQ(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}qQ(e.j,e.m,r,null),PX(e,r)}mX(e)&&r!=pX&&r!=vX&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,JQ(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),$J(t),t.L=!0,JQ(11))):(qQ(e.j,e.m,n,"[Invalid Chunked Response]"),SX(e),EX(e))}function _X(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?pX:(n=Number(t.substring(n,r)),isNaN(n)?vX:(r+=1)+n>t.length?pX:(t=t.substr(r,n),e.C=r+n,t))}function CX(e){e.Y=Date.now()+e.P,wX(e,e.P)}function wX(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=tX(_K(e.eb,e),t)}function bX(e){e.B&&(fK.clearTimeout(e.B),e.B=null)}function EX(e){0==e.l.G||e.I||jJ(e.l,e)}function SX(e){bX(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,FQ(e.W),$Q(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function PX(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||iJ(n.i,e)))if(n.I=e.N,!e.J&&iJ(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(g){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=tX(_K(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;qJ(n),DJ(n)}GJ(n),JQ(18)}if(1>=rJ(n.i)&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else YJ(n,11)}else if((e.J||n.g==e)&&qJ(n),!IK(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.U=a[0],a=a[1],2==n.G)if("c"==a[0]){n.J=a[1],n.la=a[2];var o=a[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var s=a[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));var u=a[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.i;!h.g&&(RK(l,"spdy")||RK(l,"quic")||RK(l,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(aJ(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,UX(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=e;if((r=n).oa=QJ(r,r.H?r.la:null,r.W),d.J){oJ(r.i,d);var v=d,p=r.K;p&&v.setTimeout(p),v.B&&(bX(v),CX(v)),r.g=d}else HJ(r);0<n.l.length&&UJ(n)}else"stop"!=a[0]&&"close"!=a[0]||YJ(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?YJ(n,7):NJ(n):"noop"!=a[0]&&n.j&&n.j.wa(a),n.A=0)}QQ(4)}catch(m){}}function OX(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(vK(e)||"string"==typeof e)PK(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(vK(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(vK(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}}function TX(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof TX)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function IX(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];AX(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)AX(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function AX(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(KY=hX.prototype).setTimeout=function(e){this.P=e},KY.gb=function(e){e=e.target;var t=this.L;t&&3==IJ(e)?t.l():this.Ia(e)},KY.Ia=function(e){try{if(e==this.g)e:{var t=IJ(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(3!=t||WK||this.g&&(this.h.h||this.g.ga()||AJ(this.g)))){this.I||4!=t||7==n||QQ(8==n||0>=r?3:2),bX(this);var i=this.g.ba();this.N=i;t:if(mX(this)){var a=AJ(this.g);e="";var o=a.length,s=4==IJ(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){SX(this),EX(this);var u="";break t}this.h.i=new fK.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:s&&n==o-1});a.splice(0,o),this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(e,t,n,r,i,a,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o})}(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!IK(c)){var h=c;break t}}h=null}if(!(i=h)){this.i=!1,this.o=3,JQ(12),SX(this),EX(this);break e}qQ(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,PX(this,i)}this.U?(kX(this,t,u),WK&&this.i&&3==t&&(GQ(this.V,this.W,"tick",this.fb),this.W.start())):(qQ(this.j,this.m,u,null),PX(this,u)),4==t&&SX(this),this.i&&!this.I&&(4==t?jJ(this.l,this):(this.i=!1,CX(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,JQ(12)):(this.o=0,JQ(13)),SX(this),EX(this)}}}catch(f){}},KY.fb=function(){if(this.g){var e=IJ(this.g),t=this.g.ga();this.C<t.length&&(bX(this),kX(this,e,t),this.i&&4!=e&&CX(this))}},KY.cancel=function(){this.I=!0,SX(this)},KY.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(QQ(3),JQ(17)),SX(this),this.o=2,EX(this)):wX(this,this.Y-e)},(KY=TX.prototype).R=function(){IX(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},KY.T=function(){return IX(this),this.g.concat()},KY.get=function(e,t){return AX(this.h,e)?this.h[e]:t},KY.set=function(e,t){AX(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},KY.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var xX=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function RX(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof RX){this.g=void 0!==t?t:e.g,NX(this,e.j),this.s=e.s,DX(this,e.i),LX(this,e.m),this.l=e.l,t=e.h;var n=new ZX;n.i=t.i,t.g&&(n.g=new TX(t.g),n.h=t.h),FX(this,n),this.o=e.o}else e&&(n=String(e).match(xX))?(this.g=!!t,NX(this,n[1]||"",!0),this.s=VX(n[2]||""),DX(this,n[3]||"",!0),LX(this,n[4]),this.l=VX(n[5]||"",!0),FX(this,n[6]||"",!0),this.o=VX(n[7]||"")):(this.g=!!t,this.h=new ZX(null,this.g))}function MX(e){return new RX(e)}function NX(e,t,n){e.j=n?VX(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function DX(e,t,n){e.i=n?VX(t,!0):t}function LX(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function FX(e,t,n){t instanceof ZX?(e.h=t,function(e,t){t&&!e.j&&(YX(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(KX(this,t),XX(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=zX(t,qX)),e.h=new ZX(t,e.g))}function UX(e,t,n){e.h.set(t,n)}function BX(e){return UX(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function VX(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function zX(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,HX),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function HX(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}RX.prototype.toString=function(){var e=[],t=this.j;t&&e.push(zX(t,GX,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(zX(t,GX,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(zX(n,"/"==n.charAt(0)?WX:$X,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",zX(n,jX)),e.join("")};var GX=/[#\/\?@]/g,$X=/[#\?:]/g,WX=/[#\?]/g,qX=/[#\?@]/g,jX=/#/g;function ZX(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function YX(e){e.g||(e.g=new TX,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function KX(e,t){YX(e),t=JX(e,t),AX(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,AX((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&IX(e)))}function QX(e,t){return YX(e),t=JX(e,t),AX(e.g.h,t)}function XX(e,t,n){KX(e,t),0<n.length&&(e.i=null,e.g.set(JX(e,t),TK(n)),e.h+=n.length)}function JX(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function eJ(e){this.l=e||tJ,e=fK.PerformanceNavigationTiming?0<(e=fK.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(fK.g&&fK.g.Ea&&fK.g.Ea()&&fK.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(KY=ZX.prototype).add=function(e,t){YX(this),this.i=null,e=JX(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},KY.forEach=function(e,t){YX(this),this.g.forEach(function(n,r){PK(n,function(n){e.call(t,n,r,this)},this)},this)},KY.T=function(){YX(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},KY.R=function(e){YX(this);var t=[];if("string"==typeof e)QX(this,e)&&(t=OK(t,this.g.get(JX(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=OK(t,e[n])}return t},KY.set=function(e,t){return YX(this),this.i=null,QX(this,e=JX(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},KY.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},KY.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.i=e.join("&")};var tJ=10;function nJ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rJ(e){return e.h?1:e.g?e.g.size:0}function iJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function aJ(e,t){e.g?e.g.add(t):e.h=t}function oJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function sJ(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=Hg(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(a){r.e(a)}finally{r.f()}return n}return TK(e.i)}function uJ(){}function cJ(){this.g=new uJ}function lJ(e,t,n){var r=n||"";try{OX(e,function(e,n){var i=e;pK(e)&&(i=PQ(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function hJ(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function fJ(e){this.l=e.$b||null,this.j=e.ib||!1}function dJ(e,t){bQ.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=vJ,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}eJ.prototype.cancel=function(){if(this.i=sJ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=Hg(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},uJ.prototype.stringify=function(e){return fK.JSON.stringify(e,void 0)},uJ.prototype.parse=function(e){return fK.JSON.parse(e,void 0)},wK(fJ,iX),fJ.prototype.g=function(){return new dJ(this.l,this.j)},fJ.prototype.i=function(e){return function(){return e}}({}),wK(dJ,bQ);var vJ=0;function pJ(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function gJ(e){e.readyState=4,e.l=null,e.j=null,e.A=null,yJ(e)}function yJ(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(KY=dJ.prototype).open=function(e,t){if(this.readyState!=vJ)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,yJ(this)},KY.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||fK).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},KY.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gJ(this)),this.readyState=vJ},KY.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,yJ(this)),this.g&&(this.readyState=3,yJ(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==fK.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pJ(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},KY.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?gJ(this):yJ(this),3==this.readyState&&pJ(this)}},KY.Ua=function(e){this.g&&(this.response=this.responseText=e,gJ(this))},KY.Ta=function(e){this.g&&(this.response=e,gJ(this))},KY.ha=function(){this.g&&gJ(this)},KY.setRequestHeader=function(e,t){this.v.append(e,t)},KY.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},KY.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(dJ.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var mJ=fK.JSON.parse;function kJ(e){bQ.call(this),this.headers=new TX,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=_J,this.K=this.L=!1}wK(kJ,bQ);var _J="",CJ=/^https?$/i,wJ=["POST","PUT"];function bJ(e){return"content-type"==e.toLowerCase()}function EJ(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,SJ(e),OJ(e)}function SJ(e){e.D||(e.D=!0,EQ(e,"complete"),EQ(e,"error"))}function PJ(e){if(e.h&&void 0!==hK&&(!e.C[1]||4!=IJ(e)||2!=e.ba()))if(e.v&&4==IJ(e))UQ(e.Fa,0,e);else if(EQ(e,"readystatechange"),4==IJ(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(xX)[1]||null;if(!a&&fK.self&&fK.self.location){var o=fK.self.location.protocol;a=o.substr(0,o.length-1)}i=!CJ.test(a?a.toLowerCase():"")}t=i}if(t)EQ(e,"complete"),EQ(e,"success");else{e.m=6;try{var s=2<IJ(e)?e.g.statusText:""}catch(u){s=""}e.j=s+" ["+e.ba()+"]",SJ(e)}}finally{OJ(e)}}}function OJ(e,t){if(e.g){TJ(e);var n=e.g,r=e.C[0]?dK:null;e.g=null,e.C=null,t||EQ(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function TJ(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(fK.clearTimeout(e.A),e.A=null)}function IJ(e){return e.g?e.g.readyState:0}function AJ(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case _J:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function xJ(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return LK(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):UX(e,t,n))}function RJ(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function MJ(e){this.za=0,this.l=[],this.h=new WQ,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=RJ("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=RJ("baseRetryDelayMs",5e3,e),this.$a=RJ("retryDelaySeedMs",1e4,e),this.Ya=RJ("forwardChannelMaxRetries",2,e),this.ra=RJ("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new eJ(e&&e.concurrentRequestLimit),this.Ca=new cJ,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function NJ(e){if(LJ(e),3==e.G){var t=e.V++,n=MX(e.F);UX(n,"SID",e.J),UX(n,"RID",t),UX(n,"TYPE","terminate"),VJ(e,n),(t=new hX(e,e.h,t,void 0)).K=2,t.v=BX(MX(n)),n=!1,fK.navigator&&fK.navigator.sendBeacon&&(n=fK.navigator.sendBeacon(t.v.toString(),"")),!n&&fK.Image&&((new Image).src=t.v,n=!0),n||(t.g=XJ(t.l,null),t.g.ea(t.v)),t.F=Date.now(),CX(t)}KJ(e)}function DJ(e){e.g&&($J(e),e.g.cancel(),e.g=null)}function LJ(e){DJ(e),e.u&&(fK.clearTimeout(e.u),e.u=null),qJ(e),e.i.cancel(),e.m&&("number"==typeof e.m&&fK.clearTimeout(e.m),e.m=null)}function FJ(e,t){e.l.push(new(function(){return jg(function e(t,n){Wg(this,e),this.h=t,this.g=n})}())(e.Za++,t)),3==e.G&&UJ(e)}function UJ(e){nJ(e.i)||e.m||(e.m=!0,RQ(e.Ha,e),e.C=0)}function BJ(e,t){var n;n=t?t.m:e.V++;var r=MX(e.F);UX(r,"SID",e.J),UX(r,"RID",n),UX(r,"AID",e.U),VJ(e,r),e.o&&e.s&&xJ(r,e.o,e.s),n=new hX(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=zJ(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),aJ(e.i,n),gX(n,r,t)}function VJ(e,t){e.j&&OX({},function(e,n){UX(t,n,e)})}function zJ(e,t,n){n=Math.min(e.l.length,n);var r=e.j?_K(e.j.Oa,e.j,e):null;e:for(var i=e.l,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].h,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<n;u++){var c=i[u].h,l=i[u].g;if(0>(c-=a))a=Math.max(0,i[u].h-100),s=!1;else try{lJ(l,o,"req"+c+"_")}catch(h){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function HJ(e){e.g||e.u||(e.Y=1,RQ(e.Ga,e),e.A=0)}function GJ(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=tX(_K(e.Ga,e),ZJ(e,e.A)),e.A++,0))}function $J(e){null!=e.B&&(fK.clearTimeout(e.B),e.B=null)}function WJ(e){e.g=new hX(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=MX(e.oa);UX(t,"RID","rpc"),UX(t,"SID",e.J),UX(t,"CI",e.N?"0":"1"),UX(t,"AID",e.U),VJ(e,t),UX(t,"TYPE","xmlhttp"),e.o&&e.s&&xJ(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=BX(MX(t)),n.s=null,n.U=!0,yX(n,e)}function qJ(e){null!=e.v&&(fK.clearTimeout(e.v),e.v=null)}function jJ(e,t){var n=null;if(e.g==t){qJ(e),$J(e),e.g=null;var r=2}else{if(!iJ(e.i,t))return;n=t.D,oJ(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;EQ(r=YQ(),new eX(r,n,t,i)),UJ(e)}else HJ(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(rJ(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=tX(_K(e.Ha,e,t),ZJ(e,e.C)),e.C++,0)))}(e,t)||2==r&&GJ(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:YJ(e,5);break;case 4:YJ(e,10);break;case 3:YJ(e,6);break;default:YJ(e,2)}}function ZJ(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function YJ(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=_K(e.jb,e);n||(n=new RX("//www.google.com/images/cleardot.gif"),fK.location&&"http"==fK.location.protocol||NX(n,"https"),BX(n)),function(e,t){var n=new WQ;if(fK.Image){var r=new Image;r.onload=CK(hJ,n,r,"TestLoadImage: loaded",!0,t),r.onerror=CK(hJ,n,r,"TestLoadImage: error",!1,t),r.onabort=CK(hJ,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=CK(hJ,n,r,"TestLoadImage: timeout",!1,t),fK.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else JQ(2);e.G=0,e.j&&e.j.va(t),KJ(e),LJ(e)}function KJ(e){e.G=0,e.I=-1,e.j&&((0!=sJ(e.i).length||0!=e.l.length)&&(e.i.i.length=0,TK(e.l),e.l.length=0),e.j.ua())}function QJ(e,t,n){var r=function(e){return e instanceof RX?MX(e):new RX(e,void 0)}(n);if(""!=r.i)t&&DX(r,t+"."+r.i),LX(r,r.m);else{var i=fK.location;r=function(e,t,n,r){var i=new RX(null,void 0);return e&&NX(i,e),t&&DX(i,t),n&&LX(i,n),r&&(i.l=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&LK(e.aa,function(e,t){UX(r,t,e)}),n=e.sa,(t=e.D)&&n&&UX(r,t,n),UX(r,"VER",e.ma),VJ(e,r),r}function XJ(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new kJ(n&&e.Ba&&!e.qa?new fJ({ib:!0}):e.qa)).L=e.H,t}function JJ(){}function e1(){if(GK&&!(10<=Number(JK)))throw Error("Environmental error: no available transport.")}function t1(e,t){bQ.call(this),this.g=new MJ(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!IK(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!IK(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new i1(this)}function n1(e){uX.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function r1(){cX.call(this),this.status=1}function i1(e){this.g=e}(KY=kJ.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():oX.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:oX),this.g.onreadystatechange=_K(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void EJ(this,a)}e=n||"";var i=new TX(this.headers);r&&OX(r,function(e,t){i.set(t,e)}),r=function(e){e:{for(var t=bJ,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=fK.FormData&&e instanceof fK.FormData,!(0<=SK(wJ,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{TJ(this),0<this.B&&((this.K=function(e){return GK&&function(){return e=XK,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){for(var e=0,t=xK(String(zK)).split("."),n=xK("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",o=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=MK(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||MK(0==a[2].length,0==o[2].length)||MK(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}();var e}()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_K(this.pa,this)):this.A=UQ(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){EJ(this,a)}},KY.pa=function(){void 0!==hK&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,EQ(this,"timeout"),this.abort(8))},KY.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,EQ(this,"complete"),EQ(this,"abort"),OJ(this))},KY.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),OJ(this,!0)),kJ.Z.M.call(this)},KY.Fa=function(){this.s||(this.F||this.v||this.l?PJ(this):this.cb())},KY.cb=function(){PJ(this)},KY.ba=function(){try{return 2<IJ(this)?this.g.status:-1}catch(e){return-1}},KY.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},KY.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),mJ(t)}},KY.Da=function(){return this.m},KY.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(KY=MJ.prototype).ma=8,KY.G=1,KY.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},KY.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new hX(this,this.h,e,void 0),n=this.s;if(this.P&&(n?BK(n=FK(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"==typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=zJ(this,t,r),UX(i=MX(this.F),"RID",e),UX(i,"CVER",22),this.D&&UX(i,"X-HTTP-Session-Id",this.D),VJ(this,i),this.o&&n&&xJ(i,this.o,n),aJ(this.i,t),this.Ra&&UX(i,"TYPE","init"),this.ja?(UX(i,"$req",r),UX(i,"SID","null"),t.$=!0,gX(t,i,null)):gX(t,i,r),this.G=2}}else 3==this.G&&(e?BJ(this,e):0==this.l.length||nJ(this.i)||BJ(this))},KY.Ga=function(){if(this.u=null,WJ(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=tX(_K(this.bb,this),e)}},KY.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,JQ(10),DJ(this),WJ(this))},KY.ab=function(){null!=this.v&&(this.v=null,DJ(this),GJ(this),JQ(19))},KY.jb=function(e){e?(this.h.info("Successfully pinged google.com"),JQ(2)):(this.h.info("Failed to ping google.com"),JQ(1))},(KY=JJ.prototype).xa=function(){},KY.wa=function(){},KY.va=function(){},KY.ua=function(){},KY.Oa=function(){},e1.prototype.g=function(e,t){return new t1(e,t)},wK(t1,bQ),t1.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),RQ(_K(e.hb,e,t))),JQ(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=QJ(e,null,e.W),UJ(e)},t1.prototype.close=function(){NJ(this.g)},t1.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,FJ(this.g,t)}else this.v?((t={}).__data__=PQ(e),FJ(this.g,t)):FJ(this.g,e)},t1.prototype.M=function(){this.g.j=null,delete this.j,NJ(this.g),delete this.g,t1.Z.M.call(this)},wK(n1,uX),wK(r1,cX),wK(i1,JJ),i1.prototype.xa=function(){EQ(this.g,"a")},i1.prototype.wa=function(e){EQ(this.g,new n1(e))},i1.prototype.va=function(e){EQ(this.g,new r1(e))},i1.prototype.ua=function(){EQ(this.g,"b")},e1.prototype.createWebChannel=e1.prototype.g,t1.prototype.send=t1.prototype.u,t1.prototype.open=t1.prototype.m,t1.prototype.close=t1.prototype.close,nX.NO_ERROR=0,nX.TIMEOUT=8,nX.HTTP_ERROR=6,rX.COMPLETE="complete",aX.EventType=sX,sX.OPEN="a",sX.CLOSE="b",sX.ERROR="c",sX.MESSAGE="d",bQ.prototype.listen=bQ.prototype.N,kJ.prototype.listenOnce=kJ.prototype.O,kJ.prototype.getLastError=kJ.prototype.La,kJ.prototype.getLastErrorCode=kJ.prototype.Da,kJ.prototype.getStatus=kJ.prototype.ba,kJ.prototype.getResponseJson=kJ.prototype.Qa,kJ.prototype.getResponseText=kJ.prototype.ga,kJ.prototype.send=kJ.prototype.ea;var a1=lK.createWebChannelTransport=function(){return new e1},o1=lK.getStatEventTarget=function(){return YQ()},s1=lK.ErrorCode=nX,u1=lK.EventType=rX,c1=lK.Event=jQ,l1=lK.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},h1=lK.FetchXmlHttpFactory=fJ,f1=lK.WebChannel=aX,d1=lK.XhrIo=kJ,v1="@firebase/firestore",p1=function(){function e(t){Wg(this,e),this.uid=t}return jg(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();p1.UNAUTHENTICATED=new p1(null),p1.GOOGLE_CREDENTIALS=new p1("google-credentials-uid"),p1.FIRST_PARTY=new p1("first-party-uid"),p1.MOCK_USER=new p1("mock-user");var g1="9.9.0",y1=new hz("@firebase/firestore");function m1(){return y1.logLevel}function k1(e){if(y1.logLevel<=oz.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(w1);y1.debug.apply(y1,["Firestore (".concat(g1,"): ").concat(e)].concat(Vg(i)))}}function _1(e){if(y1.logLevel<=oz.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(w1);y1.error.apply(y1,["Firestore (".concat(g1,"): ").concat(e)].concat(Vg(i)))}}function C1(e){if(y1.logLevel<=oz.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(w1);y1.warn.apply(y1,["Firestore (".concat(g1,"): ").concat(e)].concat(Vg(i)))}}function w1(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function b1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(g1,") INTERNAL ASSERTION FAILED: ")+e;throw _1(t),new Error(t)}function E1(e,t){e||b1()}function S1(e,t){return e}var P1={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O1=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return jg(n)}(xV),T1=jg(function e(){var t=this;Wg(this,e),this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}),I1=jg(function e(t,n){Wg(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}),A1=function(){function e(){Wg(this,e)}return jg(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(p1.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}]),e}(),x1=function(){function e(t){Wg(this,e),this.token=t,this.changeListener=null}return jg(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),R1=function(){function e(t){Wg(this,e),this.t=t,this.currentUser=p1.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return jg(e,[{key:"start",value:function(e,t){var n=this,r=this,i=this.i,a=function(e){return n.i!==i?(i=n.i,t(e)):Promise.resolve()},o=new T1;this.o=function(){n.i++,n.currentUser=n.u(),o.resolve(),o=new T1,e.enqueueRetryable(function(){return a(n.currentUser)})};var s=function(){var t=o;e.enqueueRetryable(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,a(r.currentUser);case 4:case"end":return e.stop()}},e)})))},u=function(e){k1("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),s()};this.t.onInit(function(e){return u(e)}),setTimeout(function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?u(e):(k1("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new T1)}},0),s()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.i!==t?(k1("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(E1("string"==typeof n.accessToken),new I1(n.accessToken,e.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return E1(null===e||"string"==typeof e),new p1(e)}}]),e}(),M1=jg(function e(t,n,r){Wg(this,e),this.type="FirstParty",this.user=p1.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}),N1=function(){function e(t,n,r){Wg(this,e),this.h=t,this.l=n,this.m=r}return jg(e,[{key:"getToken",value:function(){return Promise.resolve(new M1(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(p1.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),D1=jg(function e(t){Wg(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}),L1=function(){function e(t){Wg(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}return jg(e,[{key:"start",value:function(e,t){var n=this;this.o=function(r){e.enqueueRetryable(function(){return function(e){null!=e.error&&k1("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.p;return n.p=e.token,k1("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()}(r)})};var r=function(e){k1("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit(function(e){return r(e)}),setTimeout(function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?r(e):k1("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(function(t){return t?(E1("string"==typeof t.token),e.p=t.token,new D1(t.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function F1(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var U1=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"I",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=F1(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function B1(e,t){return e<t?-1:e>t?1:0}function V1(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}var z1=function(){function e(t,n){if(Wg(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new O1(P1.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new O1(P1.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new O1(P1.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O1(P1.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return jg(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?B1(this.nanoseconds,e.nanoseconds):B1(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),H1=function(){function e(t){Wg(this,e),this.timestamp=t}return jg(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new z1(0,0))}},{key:"max",value:function(){return new e(new z1(253402300799,999999999))}}]),e}(),G1=function(){function e(t,n,r){Wg(this,e),void 0===n?n=0:n>t.length&&b1(),void 0===r?r=t.length-n:r>t.length-n&&b1(),this.segments=t,this.offset=n,this.len=r}return jg(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),$1=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new O1(P1.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,Vg(s.split("/").filter(function(e){return e.length>0})))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(G1),W1=/^[_a-zA-Z][_a-zA-Z0-9]*$/,q1=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return W1.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new O1(P1.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new O1(P1.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new O1(P1.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(r+=s,i++):(a(),i++)}if(a(),o)throw new O1(P1.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(G1),j1=function(){function e(t){Wg(this,e),this.path=t}return jg(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===$1.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e($1.fromString(t))}},{key:"fromName",value:function(t){return new e($1.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e($1.emptyPath())}},{key:"comparator",value:function(e,t){return $1.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new $1(t.slice()))}}]),e}();function Z1(e){return new Y1(e.readTime,e.key,-1)}var Y1=function(){function e(t,n,r){Wg(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return jg(e,null,[{key:"min",value:function(){return new e(H1.min(),j1.empty(),-1)}},{key:"max",value:function(){return new e(H1.max(),j1.empty(),-1)}}]),e}();function K1(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=j1.comparator(e.documentKey,t.documentKey))?n:B1(e.largestBatchId,t.largestBatchId)}var Q1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";function X1(e){return J1.apply(this,arguments)}function J1(){return(J1=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===P1.FAILED_PRECONDITION&&t.message===Q1){e.next=2;break}throw t;case 2:k1("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var e0=function(){function e(t){var n=this;Wg(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)},function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)})}return jg(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&b1(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}},{key:"toPromise",value:function(){var e=this;return new Promise(function(t,n){e.next(t,n)})}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(n){return e.reject(n)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)}}],[{key:"resolve",value:function(t){return new e(function(e,n){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){n(t)})}},{key:"waitFor",value:function(t){return new e(function(e,n){var r=0,i=0,a=!1;t.forEach(function(t){++r,t.next(function(){++i,a&&i===r&&e()},function(e){return n(e)})}),a=!0,i===r&&e()})}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=Hg(t);try{var a=function(){var t=n.value;r=r.next(function(n){return n?e.resolve(n):t()})};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e(function(e,r){for(var i=t.length,a=new Array(i),o=0,s=function(s){var u=s;n(t[u]).next(function(t){a[u]=t,++o===i&&e(a)},function(e){return r(e)})},u=0;u<i;u++)s(u)})}},{key:"doWhile",value:function(t,n){return new e(function(e,r){!function i(){!0===t()?n().next(function(){i()},r):e()}()})}}]),e}();function t0(e){return"IndexedDbTransactionError"===e.name}var n0=function(){function e(t,n){var r=this;Wg(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.it(e)},this.rt=function(e){return n.writeSequenceNumber(e)})}return jg(e,[{key:"it",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.rt&&this.rt(e),e}}]),e}();function r0(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function i0(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function a0(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}n0.ot=-1;var o0=function(){function e(t,n){Wg(this,e),this.comparator=t,this.root=n||u0.EMPTY}return jg(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,u0.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,u0.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:"toString",value:function(){var e=[];return this.inorderTraversal(function(t,n){return e.push("".concat(t,":").concat(n)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new s0(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new s0(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new s0(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new s0(this.root,e,this.comparator,!0)}}]),e}(),s0=function(){function e(t,n,r,i){Wg(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return jg(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),u0=function(){function e(t,n,r,i,a){Wg(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return jg(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw b1();var e=this.left.check();if(e!==this.right.check())throw b1();return e+(this.isRed()?0:1)}}]),e}();u0.EMPTY=null,u0.RED=!0,u0.BLACK=!1,u0.EMPTY=new(function(){function e(){Wg(this,e),this.size=0}return jg(e,[{key:"key",get:function(){throw b1()}},{key:"value",get:function(){throw b1()}},{key:"color",get:function(){throw b1()}},{key:"left",get:function(){throw b1()}},{key:"right",get:function(){throw b1()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new u0(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var c0=function(){function e(t){Wg(this,e),this.comparator=t,this.data=new o0(this.comparator)}return jg(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new l0(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new l0(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:"isEqual",value:function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),l0=function(){function e(t){Wg(this,e),this.iter=t}return jg(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),h0=function(){function e(t){Wg(this,e),this.fields=t,t.sort(q1.comparator)}return jg(e,[{key:"unionWith",value:function(t){var n,r=new c0(q1.comparator),i=Hg(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(c){i.e(c)}finally{i.f()}var o,s=Hg(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;r=r.add(u)}}catch(c){s.e(c)}finally{s.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=Hg(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return V1(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}],[{key:"empty",value:function(){return new e([])}}]),e}(),f0=function(e){function t(e){Wg(this,t),this.binaryString=e}return jg(t,[{key:Symbol.iterator,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return btoa(this.binaryString)}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return B1(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){return new t(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}}]),t}();f0.EMPTY_BYTE_STRING=new f0("");var d0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function v0(e){if(E1(!!e),"string"==typeof e){var t=0,n=d0.exec(e);if(E1(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:p0(e.seconds),nanos:p0(e.nanos)}}function p0(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function g0(e){return"string"==typeof e?f0.fromBase64String(e):f0.fromUint8Array(e)}function y0(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function m0(e){var t=e.mapValue.fields.__previous_value__;return y0(t)?m0(t):t}function k0(e){var t=v0(e.mapValue.fields.__local_write_time__.timestampValue);return new z1(t.seconds,t.nanos)}var _0=jg(function e(t,n,r,i,a,o,s,u){Wg(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u}),C0=function(){function e(t,n){Wg(this,e),this.projectId=t,this.database=n||"(default)"}return jg(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function w0(e){return null==e}function b0(e){return 0===e&&1/e==-1/0}var E0={fields:{__type__:{stringValue:"__max__"}}};function S0(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?y0(e)?4:B0(e)?9007199254740991:10:b1()}function P0(e,t){if(e===t)return!0;var n,r=S0(e);if(r!==S0(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return k0(e).isEqual(k0(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=v0(e.timestampValue),r=v0(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return n=t,g0(e.bytesValue).isEqual(g0(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return p0(e.geoPointValue.latitude)===p0(t.geoPointValue.latitude)&&p0(e.geoPointValue.longitude)===p0(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return p0(e.integerValue)===p0(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=p0(e.doubleValue),r=p0(t.doubleValue);return n===r?b0(n)===b0(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return V1(e.arrayValue.values||[],t.arrayValue.values||[],P0);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(r0(n)!==r0(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!P0(n[i],r[i])))return!1;return!0}(e,t);default:return b1()}}function O0(e,t){return void 0!==(e.values||[]).find(function(e){return P0(e,t)})}function T0(e,t){if(e===t)return 0;var n,r,i,a,o=S0(e),s=S0(t);if(o!==s)return B1(o,s);switch(o){case 0:case 9007199254740991:return 0;case 1:return B1(e.booleanValue,t.booleanValue);case 2:return r=t,i=p0((n=e).integerValue||n.doubleValue),a=p0(r.integerValue||r.doubleValue),i<a?-1:i>a?1:i===a?0:isNaN(i)?isNaN(a)?0:-1:1;case 3:return I0(e.timestampValue,t.timestampValue);case 4:return I0(k0(e),k0(t));case 5:return B1(e.stringValue,t.stringValue);case 6:return function(e,t){var n=g0(e),r=g0(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=B1(n[i],r[i]);if(0!==a)return a}return B1(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=B1(p0(e.latitude),p0(t.latitude));return 0!==n?n:B1(p0(e.longitude),p0(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=T0(n[i],r[i]);if(a)return a}return B1(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===E0&&t===E0)return 0;if(e===E0)return 1;if(t===E0)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=B1(r[o],a[o]);if(0!==s)return s;var u=T0(n[r[o]],i[a[o]]);if(0!==u)return u}return B1(r.length,a.length)}(e.mapValue,t.mapValue);default:throw b1()}}function I0(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return B1(e,t);var n=v0(e),r=v0(t),i=B1(n.seconds,r.seconds);return 0!==i?i:B1(n.nanos,r.nanos)}function A0(e){return x0(e)}function x0(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(t=e.timestampValue,n=v0(t),"time(".concat(n.seconds,",").concat(n.nanos,")")):"stringValue"in e?e.stringValue:"bytesValue"in e?g0(e.bytesValue).toBase64():"referenceValue"in e?j1.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo(".concat((r=e.geoPointValue).latitude,",").concat(r.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=Hg(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=x0(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=Hg(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(x0(e.fields[a]))}}catch(o){i.e(o)}finally{i.f()}return n+"}"}(e.mapValue):b1();var t,n,r}function R0(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function M0(e){return!!e&&"integerValue"in e}function N0(e){return!!e&&"arrayValue"in e}function D0(e){return!!e&&"nullValue"in e}function L0(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function F0(e){return!!e&&"mapValue"in e}function U0(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return i0(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=U0(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=U0(e.arrayValue.values[r]);return n}return Object.assign({},e)}function B0(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}var V0=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!F0(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=U0(t)}},{key:"setAll",value:function(e){var t=this,n=q1.emptyPath(),r={},i=[];e.forEach(function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=U0(e):i.push(a.lastSegment())});var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());F0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return P0(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];F0(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){i0(t,function(t,n){return e[t]=n});var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(U0(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function z0(e){var t=[];return i0(e.fields,function(e,n){var r=new q1([e]);if(F0(n)){var i=z0(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=Hg(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(r.child(s))}}catch(u){o.e(u)}finally{o.f()}}}else t.push(r)}),new h0(t)}var H0=function(){function e(t,n,r,i,a,o){Wg(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.data=a,this.documentState=o}return jg(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=V0.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=V0.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=H1.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,H1.min(),H1.min(),V0.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,H1.min(),r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,H1.min(),V0.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,H1.min(),V0.empty(),2)}}]),e}(),G0=jg(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;Wg(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=s,this.ut=null});function $0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new G0(e,t,n,r,i,a,o)}function W0(e){var t=S1(e);if(null===t.ut){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(e){return(t=e).field.canonicalString()+t.op.toString()+A0(t.value);var t}).join(","),n+="|ob:",n+=t.orderBy.map(function(e){return(t=e).field.canonicalString()+t.dir;var t}).join(","),w0(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(function(e){return A0(e)}).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(function(e){return A0(e)}).join(",")),t.ut=n}return t.ut}function q0(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!a2(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if((i=e.filters[r]).op!==(a=t.filters[r]).op||!i.field.isEqual(a.field)||!P0(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!s2(e.startAt,t.startAt)&&s2(e.endAt,t.endAt)}function j0(e){return j1.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Z0=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return jg(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(T0(t,this.value)):null!==t&&S0(this.value)===S0(t)&&this.at(T0(t,this.value))}},{key:"at",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return b1()}}},{key:"ht",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,r):new Y0(e,t,r):"array-contains"===t?new J0(e,r):"in"===t?new e2(e,r):"not-in"===t?new t2(e,r):"array-contains-any"===t?new n2(e,r):new n(e,t,r)}},{key:"ct",value:function(e,t,n){return"in"===t?new K0(e,n):new Q0(e,n)}}]),n}(function(){return jg(function e(){Wg(this,e)})}()),Y0=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r,i)).key=j1.fromName(i.referenceValue),a}return jg(n,[{key:"matches",value:function(e){var t=j1.comparator(e.key,this.key);return this.at(t)}}]),n}(Z0),K0=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,"in",r)).keys=X0(0,r),i}return jg(n,[{key:"matches",value:function(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(Z0),Q0=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,"not-in",r)).keys=X0(0,r),i}return jg(n,[{key:"matches",value:function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(Z0);function X0(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return j1.fromName(e.referenceValue)})}var J0=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,"array-contains",r)}return jg(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return N0(t)&&O0(t.arrayValue,this.value)}}]),n}(Z0),e2=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,"in",r)}return jg(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&O0(this.value.arrayValue,t)}}]),n}(Z0),t2=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,"not-in",r)}return jg(n,[{key:"matches",value:function(e){if(O0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!O0(this.value.arrayValue,t)}}]),n}(Z0),n2=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,"array-contains-any",r)}return jg(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!N0(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return O0(t.value.arrayValue,e)})}}]),n}(Z0),r2=jg(function e(t,n){Wg(this,e),this.position=t,this.inclusive=n}),i2=jg(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";Wg(this,e),this.field=t,this.dir=n});function a2(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function o2(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?j1.comparator(j1.fromName(o.referenceValue),n.key):T0(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function s2(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!P0(e.position[n],t.position[n]))return!1;return!0}var u2=jg(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Wg(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=s,this.endAt=u,this.lt=null,this.ft=null});function c2(e){return new u2(e)}function l2(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function h2(e){var t,n=Hg(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.ht())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function f2(e){return null!==e.collectionGroup}function d2(e){var t=S1(e);if(null===t.lt){t.lt=[];var n=h2(t),r=l2(t);if(null!==n&&null===r)n.isKeyField()||t.lt.push(new i2(n)),t.lt.push(new i2(q1.keyField(),"asc"));else{var i,a=!1,o=Hg(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.lt.push(s),s.field.isKeyField()&&(a=!0)}}catch(c){o.e(c)}finally{o.f()}if(!a){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new i2(q1.keyField(),u))}}}return t.lt}function v2(e){var t=S1(e);if(!t.ft)if("F"===t.limitType)t.ft=$0(t.path,t.collectionGroup,d2(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=Hg(d2(t));try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(new i2(a.field,"desc"===a.dir?"asc":"desc"))}}catch(u){i.e(u)}finally{i.f()}var o=t.endAt?new r2(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new r2(t.startAt.position,t.startAt.inclusive):null;t.ft=$0(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.ft}function p2(e,t,n){return new u2(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function g2(e,t){return q0(v2(e),v2(t))&&e.limitType===t.limitType}function y2(e){return"".concat(W0(v2(e)),"|lt:").concat(e.limitType)}function m2(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(A0(t.value));var t}).join(", "),"]")),w0(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(function(e){return"".concat((t=e).field.canonicalString()," (").concat(t.dir,")");var t}).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(function(e){return A0(e)}).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(function(e){return A0(e)}).join(",")),"Target(".concat(t,")")}(v2(e)),"; limitType=").concat(e.limitType,")")}function k2(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):j1.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=Hg(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=Hg(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&(s=t,!((o=e).startAt&&(n=o.startAt,r=d2(o),i=s,a=o2(n,r,i),!(n.inclusive?a<=0:a<0))||o.endAt&&!function(e,t,n){var r=o2(e,t,n);return e.inclusive?r>=0:r>0}(o.endAt,d2(o),s)));var n,r,i,a,o,s}function _2(e){return function(t,n){var r,i=!1,a=Hg(d2(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=C2(o,t,n);if(0!==s)return s;i=i||o.field.isKeyField()}}catch(u){a.e(u)}finally{a.f()}return 0}}function C2(e,t,n){var r,i,a,o,s=e.field.isKeyField()?j1.comparator(t.key,n.key):(r=e.field,i=n,a=t.data.field(r),o=i.data.field(r),null!==a&&null!==o?T0(a,o):b1());switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return b1()}}function w2(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:b0(t)?"-0":t}}function b2(e){return{integerValue:""+e}}var E2=jg(function e(){Wg(this,e),this._=void 0});function S2(e,t,n){return e instanceof T2?(i=t,a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(a.fields.__previous_value__=i),{mapValue:a}):e instanceof I2?A2(e,t):e instanceof x2?R2(e,t):function(e,t){var n=O2(e,t),r=N2(n)+N2(e._t);return M0(n)&&M0(e._t)?b2(r):w2(e.wt,r)}(e,t);var r,i,a}function P2(e,t,n){return e instanceof I2?A2(e,t):e instanceof x2?R2(e,t):n}function O2(e,t){return e instanceof M2?M0(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}var T2=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n)}(E2),I2=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).elements=e,r}return jg(n)}(E2);function A2(e,t){var n,r=D2(t),i=Hg(e.elements);try{var a=function(){var e=n.value;r.some(function(t){return P0(t,e)})||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var x2=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).elements=e,r}return jg(n)}(E2);function R2(e,t){var n,r=D2(t),i=Hg(e.elements);try{var a=function(){var e=n.value;r=r.filter(function(t){return!P0(t,e)})};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var M2=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).wt=e,i._t=r,i}return jg(n)}(E2);function N2(e){return p0(e.integerValue||e.doubleValue)}function D2(e){return N0(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var L2=jg(function e(t,n){Wg(this,e),this.field=t,this.transform=n}),F2=jg(function e(t,n){Wg(this,e),this.version=t,this.transformResults=n}),U2=function(){function e(t,n){Wg(this,e),this.updateTime=t,this.exists=n}return jg(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function B2(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var V2=jg(function e(){Wg(this,e)});function z2(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new J2(e.key,U2.none()):new q2(e.key,e.data,U2.none());var n,r=e.data,i=V0.empty(),a=new c0(q1.comparator),o=Hg(t.fields);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!a.has(s)){var u=r.field(s);null===u&&s.length>1&&(s=s.popLast(),u=r.field(s)),null===u?i.delete(s):i.set(s,u),a=a.add(s)}}}catch(c){o.e(c)}finally{o.f()}return new j2(e.key,i,new h0(a.toArray()),U2.none())}function H2(e,t,n){var r,i,a,o,s;e instanceof q2?(i=t,a=n,o=(r=e).value.clone(),s=Y2(r.fieldTransforms,i,a.transformResults),o.setAll(s),i.convertToFoundDocument(a.version,o).setHasCommittedMutations()):e instanceof j2?function(e,t,n){if(B2(e.precondition,t)){var r=Y2(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Z2(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function G2(e,t,n,r){return e instanceof q2?function(e,t,n,r){if(!B2(e.precondition,t))return n;var i=e.value.clone(),a=K2(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof j2?function(e,t,n,r){if(!B2(e.precondition,t))return n;var i=K2(e.fieldTransforms,r,t),a=t.data;return a.setAll(Z2(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(function(e){return e.field}))}(e,t,n,r):(a=n,B2(e.precondition,i=t)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):a);var i,a}function $2(e,t){var n,r=null,i=Hg(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),s=O2(a.transform,o||null);null!=s&&(null===r&&(r=V0.empty()),r.set(a.field,s))}}catch(u){i.e(u)}finally{i.f()}return r||null}function W2(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&V1(n,r,function(e,t){return function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof I2&&r instanceof I2||n instanceof x2&&r instanceof x2?V1(n.elements,r.elements,P0):n instanceof M2&&r instanceof M2?P0(n._t,r._t):n instanceof T2&&r instanceof T2);var n,r}(e,t)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}var q2=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return Wg(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return jg(n,[{key:"getFieldMask",value:function(){return null}}]),n}(V2),j2=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return Wg(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=s,o.type=1,o}return jg(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(V2);function Z2(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function Y2(e,t,n){var r=new Map;E1(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,P2(o,s,n[i]))}return r}function K2(e,t,n){var r,i=new Map,a=Hg(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.transform,u=n.data.field(o.field);i.set(o.field,S2(s,u,t))}}catch(c){a.e(c)}finally{a.f()}return i}var Q2,X2,J2=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return jg(n,[{key:"getFieldMask",value:function(){return null}}]),n}(V2),e3=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return jg(n,[{key:"getFieldMask",value:function(){return null}}]),n}(V2),t3=jg(function e(t){Wg(this,e),this.count=t});function n3(e){switch(e){default:return b1();case P1.CANCELLED:case P1.UNKNOWN:case P1.DEADLINE_EXCEEDED:case P1.RESOURCE_EXHAUSTED:case P1.INTERNAL:case P1.UNAVAILABLE:case P1.UNAUTHENTICATED:return!1;case P1.INVALID_ARGUMENT:case P1.NOT_FOUND:case P1.ALREADY_EXISTS:case P1.PERMISSION_DENIED:case P1.FAILED_PRECONDITION:case P1.ABORTED:case P1.OUT_OF_RANGE:case P1.UNIMPLEMENTED:case P1.DATA_LOSS:return!0}}function r3(e){if(void 0===e)return _1("GRPC error has no .code"),P1.UNKNOWN;switch(e){case Q2.OK:return P1.OK;case Q2.CANCELLED:return P1.CANCELLED;case Q2.UNKNOWN:return P1.UNKNOWN;case Q2.DEADLINE_EXCEEDED:return P1.DEADLINE_EXCEEDED;case Q2.RESOURCE_EXHAUSTED:return P1.RESOURCE_EXHAUSTED;case Q2.INTERNAL:return P1.INTERNAL;case Q2.UNAVAILABLE:return P1.UNAVAILABLE;case Q2.UNAUTHENTICATED:return P1.UNAUTHENTICATED;case Q2.INVALID_ARGUMENT:return P1.INVALID_ARGUMENT;case Q2.NOT_FOUND:return P1.NOT_FOUND;case Q2.ALREADY_EXISTS:return P1.ALREADY_EXISTS;case Q2.PERMISSION_DENIED:return P1.PERMISSION_DENIED;case Q2.FAILED_PRECONDITION:return P1.FAILED_PRECONDITION;case Q2.ABORTED:return P1.ABORTED;case Q2.OUT_OF_RANGE:return P1.OUT_OF_RANGE;case Q2.UNIMPLEMENTED:return P1.UNIMPLEMENTED;case Q2.DATA_LOSS:return P1.DATA_LOSS;default:return b1()}}(X2=Q2||(Q2={}))[X2.OK=0]="OK",X2[X2.CANCELLED=1]="CANCELLED",X2[X2.UNKNOWN=2]="UNKNOWN",X2[X2.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X2[X2.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X2[X2.NOT_FOUND=5]="NOT_FOUND",X2[X2.ALREADY_EXISTS=6]="ALREADY_EXISTS",X2[X2.PERMISSION_DENIED=7]="PERMISSION_DENIED",X2[X2.UNAUTHENTICATED=16]="UNAUTHENTICATED",X2[X2.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X2[X2.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X2[X2.ABORTED=10]="ABORTED",X2[X2.OUT_OF_RANGE=11]="OUT_OF_RANGE",X2[X2.UNIMPLEMENTED=12]="UNIMPLEMENTED",X2[X2.INTERNAL=13]="INTERNAL",X2[X2.UNAVAILABLE=14]="UNAVAILABLE",X2[X2.DATA_LOSS=15]="DATA_LOSS";var i3=function(){function e(t,n){Wg(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return jg(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=Pg(r.value,2),o=a[0],s=a[1];if(this.equalsFn(o,e))return s}}catch(u){i.e(u)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){i0(this.inner,function(t,n){var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=Pg(r.value,2),o=a[0],s=a[1];e(o,s)}}catch(u){i.e(u)}finally{i.f()}})}},{key:"isEmpty",value:function(){return a0(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),a3=new o0(j1.comparator);function o3(){return a3}var s3=new o0(j1.comparator);function u3(){for(var e=s3,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.insert(o.key,o)}return e}function c3(e){var t=s3;return e.forEach(function(e,n){return t=t.insert(e,n.overlayedDocument)}),t}function l3(){return f3()}function h3(){return f3()}function f3(){return new i3(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var d3=new o0(j1.comparator),v3=new c0(j1.comparator);function p3(){for(var e=v3,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var g3=new c0(B1);function y3(){return g3}var m3=function(){function e(t,n,r,i,a){Wg(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return jg(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,k3.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(H1.min(),r,y3(),o3(),p3())}}]),e}(),k3=function(){function e(t,n,r,i,a){Wg(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return jg(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(f0.EMPTY_BYTE_STRING,n,p3(),p3(),p3())}}]),e}(),_3=jg(function e(t,n,r,i){Wg(this,e),this.gt=t,this.removedTargetIds=n,this.key=r,this.yt=i}),C3=jg(function e(t,n){Wg(this,e),this.targetId=t,this.It=n}),w3=jg(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f0.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Wg(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}),b3=function(){function e(){Wg(this,e),this.Tt=0,this.Et=P3(),this.At=f0.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}return jg(e,[{key:"current",get:function(){return this.Rt}},{key:"resumeToken",get:function(){return this.At}},{key:"Pt",get:function(){return 0!==this.Tt}},{key:"vt",get:function(){return this.bt}},{key:"Vt",value:function(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}},{key:"St",value:function(){var e=p3(),t=p3(),n=p3();return this.Et.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:b1()}}),new k3(this.At,this.Rt,e,t,n)}},{key:"Dt",value:function(){this.bt=!1,this.Et=P3()}},{key:"Ct",value:function(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}},{key:"xt",value:function(e){this.bt=!0,this.Et=this.Et.remove(e)}},{key:"Nt",value:function(){this.Tt+=1}},{key:"kt",value:function(){this.Tt-=1}},{key:"Ot",value:function(){this.bt=!0,this.Rt=!0}}]),e}(),E3=function(){function e(t){Wg(this,e),this.Mt=t,this.Ft=new Map,this.$t=o3(),this.Bt=S3(),this.Lt=new c0(B1)}return jg(e,[{key:"Ut",value:function(e){var t,n=Hg(e.gt);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.yt&&e.yt.isFoundDocument()?this.qt(r,e.yt):this.Kt(r,e.key,e.yt)}}catch(s){n.e(s)}finally{n.f()}var i,a=Hg(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.Kt(o,e.key,e.yt)}}catch(s){a.e(s)}finally{a.f()}}},{key:"Gt",value:function(e){var t=this;this.forEachTarget(e,function(n){var r=t.Qt(n);switch(e.state){case 0:t.jt(n)&&r.Vt(e.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(e.resumeToken);break;case 2:r.kt(),r.Pt||t.removeTarget(n);break;case 3:t.jt(n)&&(r.Ot(),r.Vt(e.resumeToken));break;case 4:t.jt(n)&&(t.Wt(n),r.Vt(e.resumeToken));break;default:b1()}})}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach(function(e,r){n.jt(r)&&t(r)})}},{key:"zt",value:function(e){var t=e.targetId,n=e.It.count,r=this.Ht(t);if(r){var i=r.target;if(j0(i))if(0===n){var a=new j1(i.path);this.Kt(t,a,H0.newNoDocument(a,H1.min()))}else E1(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}},{key:"Yt",value:function(e){var t=this,n=new Map;this.Ft.forEach(function(r,i){var a=t.Ht(i);if(a){if(r.current&&j0(a.target)){var o=new j1(a.target.path);null!==t.$t.get(o)||t.Xt(i,o)||t.Kt(i,o,H0.newNoDocument(o,e))}r.vt&&(n.set(i,r.St()),r.Dt())}});var r=p3();this.Bt.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.Ht(e);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))}),this.$t.forEach(function(t,n){return n.setReadTime(e)});var i=new m3(e,n,this.Lt,this.$t,r);return this.$t=o3(),this.Bt=S3(),this.Lt=new c0(B1),i}},{key:"qt",value:function(e,t){if(this.jt(e)){var n=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}}},{key:"Kt",value:function(e,t,n){if(this.jt(e)){var r=this.Qt(e);this.Xt(e,t)?r.Ct(t,1):r.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Ft.delete(e)}},{key:"Jt",value:function(e){var t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Nt",value:function(e){this.Qt(e).Nt()}},{key:"Qt",value:function(e){var t=this.Ft.get(e);return t||(t=new b3,this.Ft.set(e,t)),t}},{key:"Zt",value:function(e){var t=this.Bt.get(e);return t||(t=new c0(B1),this.Bt=this.Bt.insert(e,t)),t}},{key:"jt",value:function(e){var t=null!==this.Ht(e);return t||k1("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Ht",value:function(e){var t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}},{key:"Wt",value:function(e){var t=this;this.Ft.set(e,new b3),this.Mt.getRemoteKeysForTarget(e).forEach(function(n){t.Kt(e,n,null)})}},{key:"Xt",value:function(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}]),e}();function S3(){return new o0(j1.comparator)}function P3(){return new o0(j1.comparator)}var O3={asc:"ASCENDING",desc:"DESCENDING"},T3={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},I3=jg(function e(t,n){Wg(this,e),this.databaseId=t,this.dt=n});function A3(e,t){return e.dt?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function x3(e,t){return e.dt?t.toBase64():t.toUint8Array()}function R3(e,t){return A3(e,t.toTimestamp())}function M3(e){return E1(!!e),H1.fromTimestamp((t=v0(e),new z1(t.seconds,t.nanos)));var t}function N3(e,t){return(n=e,new $1(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function D3(e){var t=$1.fromString(e);return E1(J3(t)),t}function L3(e,t){return N3(e.databaseId,t.path)}function F3(e,t){var n=D3(t);if(n.get(1)!==e.databaseId.projectId)throw new O1(P1.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new O1(P1.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new j1(V3(n))}function U3(e,t){return N3(e.databaseId,t)}function B3(e){return new $1(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function V3(e){return E1(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function z3(e,t,n){return{name:L3(e,t),fields:n.value.mapValue.fields}}function H3(e,t){return{documents:[U3(e,t.path)]}}function G3(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=U3(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=U3(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(function(e){return function(e){if("=="===e.op){if(L0(e.value))return{unaryFilter:{field:Z3(e.field),op:"IS_NAN"}};if(D0(e.value))return{unaryFilter:{field:Z3(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(L0(e.value))return{unaryFilter:{field:Z3(e.field),op:"IS_NOT_NAN"}};if(D0(e.value))return{unaryFilter:{field:Z3(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Z3(e.field),op:j3(e.op),value:e.value}}}(e)});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map(function(e){return{field:Z3((t=e).field),direction:q3(t.dir)};var t})}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o,s,u,c=(o=t.limit,e.dt||w0(o)?o:{value:o});return null!==c&&(n.structuredQuery.limit=c),t.startAt&&(n.structuredQuery.startAt={before:(s=t.startAt).inclusive,values:s.position}),t.endAt&&(n.structuredQuery.endAt={before:!(u=t.endAt).inclusive,values:u.position}),n}function $3(e){var t=function(e){var t=D3(e);return 4===t.length?$1.emptyPath():V3(t)}(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){E1(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=W3(n.where));var s=[];n.orderBy&&(s=n.orderBy.map(function(e){return new i2(Y3((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));var u=null;n.limit&&(u=function(e){var t;return w0(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c,l=null;n.startAt&&(l=new r2((c=n.startAt).values||[],!!c.before));var h=null;return n.endAt&&(h=function(e){return new r2(e.values||[],!e.before)}(n.endAt)),function(e,t,n,r,i,a,o,s){return new u2(e,t,n,r,i,"F",o,s)}(t,i,s,o,u,0,l,h)}function W3(e){return e?void 0!==e.unaryFilter?[Q3(e)]:void 0!==e.fieldFilter?[K3(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return W3(e)}).reduce(function(e,t){return e.concat(t)}):b1():[]}function q3(e){return O3[e]}function j3(e){return T3[e]}function Z3(e){return{fieldPath:e.canonicalString()}}function Y3(e){return q1.fromServerFormat(e.fieldPath)}function K3(e){return Z0.create(Y3(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return b1()}}(e.fieldFilter.op),e.fieldFilter.value)}function Q3(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Y3(e.unaryFilter.field);return Z0.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Y3(e.unaryFilter.field);return Z0.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Y3(e.unaryFilter.field);return Z0.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Y3(e.unaryFilter.field);return Z0.create(i,"!=",{nullValue:"NULL_VALUE"});default:return b1()}}function X3(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function J3(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}var e4=function(){function e(t,n,r,i){Wg(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return jg(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&H2(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=Hg(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=G2(i,e,t,this.localWriteTime))}}catch(u){r.e(u)}finally{r.f()}var a,o=Hg(this.mutations);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.key.isEqual(e.key)&&(t=G2(s,e,t,this.localWriteTime))}}catch(u){o.e(u)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=h3();return this.mutations.forEach(function(i){var a=e.get(i.key),o=a.overlayedDocument,s=n.applyToLocalView(o,a.mutatedFields),u=z2(o,s=t.has(i.key)?null:s);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(H1.min())}),r}},{key:"keys",value:function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},p3())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&V1(this.mutations,e.mutations,function(e,t){return W2(e,t)})&&V1(this.baseMutations,e.baseMutations,function(e,t){return W2(e,t)})}}]),e}(),t4=function(){function e(t,n,r,i){Wg(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return jg(e,null,[{key:"from",value:function(t,n,r){E1(t.mutations.length===r.length);for(var i=d3,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),n4=function(){function e(t,n){Wg(this,e),this.largestBatchId=t,this.mutation=n}return jg(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),r4=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H1.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:H1.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f0.EMPTY_BYTE_STRING;Wg(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return jg(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),i4=jg(function e(t){Wg(this,e),this.ne=t});function a4(e){var t=$3({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?p2(t,t.limit,"L"):t}var o4=function(){function e(){Wg(this,e)}return jg(e,[{key:"re",value:function(e,t){this.oe(e,t),t.ue()}},{key:"oe",value:function(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(p0(e.integerValue));else if("doubleValue"in e){var n=p0(e.doubleValue);isNaN(n)?this.ce(t,13):(this.ce(t,15),b0(n)?t.ae(0):t.ae(n))}else if("timestampValue"in e){var r=e.timestampValue;this.ce(t,20),"string"==typeof r?t.he(r):(t.he("".concat(r.seconds||"")),t.ae(r.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(g0(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.ce(t,45),t.ae(i.latitude||0),t.ae(i.longitude||0)}else"mapValue"in e?B0(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):b1()}},{key:"le",value:function(e,t){this.ce(t,25),this.ge(e,t)}},{key:"ge",value:function(e,t){t.he(e)}},{key:"we",value:function(e,t){var n=e.fields||{};this.ce(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.le(a,t),this.oe(n[a],t)}}},{key:"me",value:function(e,t){var n=e.values||[];this.ce(t,50);var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.oe(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"_e",value:function(e,t){var n=this;this.ce(t,37),j1.fromName(e).path.forEach(function(e){n.ce(t,60),n.ge(e,t)})}},{key:"ce",value:function(e,t){e.ae(t)}},{key:"fe",value:function(e){e.ae(2)}}]),e}();o4.ye=new o4;var s4=function(){function e(){Wg(this,e),this.ze=new u4}return jg(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.ze.add(t),e0.resolve()}},{key:"getCollectionParents",value:function(e,t){return e0.resolve(this.ze.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return e0.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return e0.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return e0.resolve(null)}},{key:"getIndexType",value:function(e,t){return e0.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return e0.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return e0.resolve(null)}},{key:"getMinOffset",value:function(e,t){return e0.resolve(Y1.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return e0.resolve(Y1.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return e0.resolve()}},{key:"updateIndexEntries",value:function(e,t){return e0.resolve()}}]),e}(),u4=function(){function e(){Wg(this,e),this.index={}}return jg(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new c0($1.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new c0($1.comparator)).toArray()}}]),e}();new Uint8Array(0);var c4=function(){function e(t,n,r){Wg(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return jg(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();c4.DEFAULT_COLLECTION_PERCENTILE=10,c4.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,c4.DEFAULT=new c4(41943040,c4.DEFAULT_COLLECTION_PERCENTILE,c4.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),c4.DISABLED=new c4(-1,0,0);var l4=function(){function e(t){Wg(this,e),this.En=t}return jg(e,[{key:"next",value:function(){return this.En+=2,this.En}}],[{key:"An",value:function(){return new e(0)}},{key:"Rn",value:function(){return new e(-1)}}]),e}(),h4=jg(function e(t,n){Wg(this,e),this.overlayedDocument=t,this.mutatedFields=n}),f4=function(){function e(t,n,r,i){Wg(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return jg(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next(function(i){return r=i,n.getBaseDocument(e,t,r)}).next(function(e){return null!==r&&G2(r.mutation,e,h0.empty(),z1.now()),e})}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t,p3()).next(function(){return t})})}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p3(),i=l3();return this.populateOverlays(e,i,t).next(function(){return n.computeViews(e,t,i,r).next(function(e){var t=u3();return e.forEach(function(e,n){t=t.insert(e,n.overlayedDocument)}),t})})}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=l3();return this.populateOverlays(e,r,t).next(function(){return n.computeViews(e,t,r,p3())})}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach(function(e){t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(function(e){e.forEach(function(e,n){t.set(e,n)})})}},{key:"computeViews",value:function(e,t,n,r){var i=o3(),a=f3(),o=f3();return t.forEach(function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof j2)?i=i.insert(t.key,t):void 0!==o&&(a.set(t.key,o.mutation.getFieldMask()),G2(o.mutation,t,o.mutation.getFieldMask(),z1.now()))}),this.recalculateAndSaveOverlays(e,i).next(function(e){return e.forEach(function(e,t){return a.set(e,t)}),t.forEach(function(e,t){var n;return o.set(e,new h4(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o})}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=f3(),i=new o0(function(e,t){return e-t}),a=p3();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){var n,a=Hg(e);try{var o=function(){var e=n.value;e.keys().forEach(function(n){var a=t.get(n);if(null!==a){var o=r.get(n)||h0.empty();o=e.applyToLocalView(a,o),r.set(n,o);var s=(i.get(e.batchId)||p3()).add(n);i=i.insert(e.batchId,s)}})};for(a.s();!(n=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}}).next(function(){for(var o=[],s=i.getReverseIterator(),u=function(){var i=s.getNext(),u=i.key,c=i.value,l=h3();c.forEach(function(e){if(!a.has(e)){var n=z2(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}}),o.push(n.documentOverlayCache.saveOverlays(e,u,l))};s.hasNext();)u();return e0.waitFor(o)}).next(function(){return r})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.recalculateAndSaveOverlays(e,t)})}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return j1.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):f2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(function(a){var o=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):e0.resolve(l3()),s=-1,u=a;return o.next(function(t){return e0.forEach(t,function(t,n){return s<n.largestBatchId&&(s=n.largestBatchId),a.get(t)?e0.resolve():i.getBaseDocument(e,t,n).next(function(e){u=u.insert(t,e)})}).next(function(){return i.populateOverlays(e,t,a)}).next(function(){return i.computeViews(e,u,t,p3())}).next(function(e){return{batchId:s,changes:c3(e)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new j1(t)).next(function(e){var t=u3();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,i=t.collectionGroup,a=u3();return this.indexManager.getCollectionParents(e,i).next(function(o){return e0.forEach(o,function(o){var s,u,c=(s=t,u=o.child(i),new u2(u,null,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt));return r.getDocumentsMatchingCollectionQuery(e,c,n).next(function(e){e.forEach(function(e,t){a=a.insert(e,t)})})}).next(function(){return a})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,i=this;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next(function(a){return r=a,i.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)}).next(function(e){e.forEach(function(e,t){var n=t.getKey();null===r.get(n)&&(r=r.insert(n,H0.newInvalidDocument(n)))});var n=u3();return r.forEach(function(r,i){var a=e.get(r);void 0!==a&&G2(a.mutation,i,h0.empty(),z1.now()),k2(t,i)&&(n=n.insert(r,i))}),n})}},{key:"getBaseDocument",value:function(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):e0.resolve(H0.newInvalidDocument(t))}}]),e}(),d4=function(){function e(t){Wg(this,e),this.wt=t,this.Jn=new Map,this.Yn=new Map}return jg(e,[{key:"getBundleMetadata",value:function(e,t){return e0.resolve(this.Jn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Jn.set(t.id,{id:(n=t).id,version:n.version,createTime:M3(n.createTime)}),e0.resolve()}},{key:"getNamedQuery",value:function(e,t){return e0.resolve(this.Yn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Yn.set(t.name,{name:(n=t).name,query:a4(n.bundledQuery),readTime:M3(n.readTime)}),e0.resolve();var n}}]),e}(),v4=function(){function e(){Wg(this,e),this.overlays=new o0(j1.comparator),this.Xn=new Map}return jg(e,[{key:"getOverlay",value:function(e,t){return e0.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=l3();return e0.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach(function(n,i){r.ie(e,t,i)}),e0.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Xn.get(n);return void 0!==i&&(i.forEach(function(e){return r.overlays=r.overlays.remove(e)}),this.Xn.delete(n)),e0.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=l3(),i=t.length+1,a=new j1(t.child("")),o=this.overlays.getIteratorFrom(a);o.hasNext();){var s=o.getNext().value,u=s.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&s.largestBatchId>n&&r.set(s.getKey(),s)}return e0.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new o0(function(e,t){return e-t}),a=this.overlays.getIterator();a.hasNext();){var o=a.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var s=i.get(o.largestBatchId);null===s&&(s=l3(),i=i.insert(o.largestBatchId,s)),s.set(o.getKey(),o)}}for(var u=l3(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(e,t){return u.set(e,t)}),!(u.size()>=r)););return e0.resolve(u)}},{key:"ie",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new n4(t,n));var a=this.Xn.get(t);void 0===a&&(a=p3(),this.Xn.set(t,a)),this.Xn.set(t,a.add(n.key))}}]),e}(),p4=function(){function e(){Wg(this,e),this.Zn=new c0(g4.ts),this.es=new c0(g4.ns)}return jg(e,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(e,t){var n=new g4(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})}},{key:"removeReference",value:function(e,t){this.rs(new g4(e,t))}},{key:"os",value:function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})}},{key:"us",value:function(e){var t=this,n=new j1(new $1([])),r=new g4(n,e),i=new g4(n,e+1),a=[];return this.es.forEachInRange([r,i],function(e){t.rs(e),a.push(e.key)}),a}},{key:"cs",value:function(){var e=this;this.Zn.forEach(function(t){return e.rs(t)})}},{key:"rs",value:function(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}},{key:"hs",value:function(e){var t=new j1(new $1([])),n=new g4(t,e),r=new g4(t,e+1),i=p3();return this.es.forEachInRange([n,r],function(e){i=i.add(e.key)}),i}},{key:"containsKey",value:function(e){var t=new g4(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),g4=function(){function e(t,n){Wg(this,e),this.key=t,this.ls=n}return jg(e,null,[{key:"ts",value:function(e,t){return j1.comparator(e.key,t.key)||B1(e.ls,t.ls)}},{key:"ns",value:function(e,t){return B1(e.ls,t.ls)||j1.comparator(e.key,t.key)}}]),e}(),y4=function(){function e(t,n){Wg(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.fs=1,this.ds=new c0(g4.ts)}return jg(e,[{key:"checkEmpty",value:function(e){return e0.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.fs;this.fs++;var a=new e4(i,t,n,r);this.mutationQueue.push(a);var o,s=Hg(r);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.ds=this.ds.add(new g4(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast())}}catch(c){s.e(c)}finally{s.f()}return e0.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return e0.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this.ws(t+1),r=n<0?0:n;return e0.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return e0.resolve(0===this.mutationQueue.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(e){return e0.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new g4(t,0),i=new g4(t,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([r,i],function(e){var t=n._s(e.ls);a.push(t)}),e0.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new c0(B1);return t.forEach(function(e){var t=new g4(e,0),i=new g4(e,Number.POSITIVE_INFINITY);n.ds.forEachInRange([t,i],function(e){r=r.add(e.ls)})}),e0.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;j1.isDocumentKey(i)||(i=i.child(""));var a=new g4(new j1(i),0),o=new c0(B1);return this.ds.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ls)),!0)},a),e0.resolve(this.gs(o))}},{key:"gs",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=t._s(e);null!==r&&n.push(r)}),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;E1(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();var r=this.ds;return e0.forEach(t.mutations,function(i){var a=new g4(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.ds=r})}},{key:"In",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new g4(t,0),r=this.ds.firstAfterOrEqual(n);return e0.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return e0.resolve()}},{key:"ys",value:function(e,t){return this.ws(e)}},{key:"ws",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"_s",value:function(e){var t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),m4=function(){function e(t){Wg(this,e),this.ps=t,this.docs=new o0(j1.comparator),this.size=0}return jg(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return e0.resolve(n?n.document.mutableCopy():H0.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=o3();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():H0.newInvalidDocument(e))}),e0.resolve(r)}},{key:"getAllFromCollection",value:function(e,t,n){for(var r=o3(),i=new j1(t.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var o=a.getNext(),s=o.key,u=o.value.document;if(!t.isPrefixOf(s.path))break;s.path.length>t.length+1||K1(Z1(u),n)<=0||(r=r.insert(u.key,u.mutableCopy()))}return e0.resolve(r)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){b1()}},{key:"Is",value:function(e,t){return e0.forEach(this.docs,function(e){return t(e)})}},{key:"newChangeBuffer",value:function(e){return new k4(this)}},{key:"getSize",value:function(e){return e0.resolve(this.size)}}]),e}(),k4=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).zn=e,r}return jg(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(t.zn.addEntry(e,i)):t.zn.removeEntry(r)}),e0.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.zn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.zn.getEntries(e,t)}}]),n}(function(){function e(){Wg(this,e),this.changes=new i3(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return jg(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,H0.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?e0.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}()),_4=function(){function e(t){Wg(this,e),this.persistence=t,this.Ts=new i3(function(e){return W0(e)},q0),this.lastRemoteSnapshotVersion=H1.min(),this.highestTargetId=0,this.Es=0,this.As=new p4,this.targetCount=0,this.Rs=l4.An()}return jg(e,[{key:"forEachTarget",value:function(e,t){return this.Ts.forEach(function(e,n){return t(n)}),e0.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return e0.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return e0.resolve(this.Es)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Rs.next(),e0.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),e0.resolve()}},{key:"vn",value:function(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new l4(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.vn(t),this.targetCount+=1,e0.resolve()}},{key:"updateTargetData",value:function(e,t){return this.vn(t),e0.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,e0.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Ts.forEach(function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Ts.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)}),e0.waitFor(a).next(function(){return i})}},{key:"getTargetCount",value:function(e){return e0.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Ts.get(t)||null;return e0.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.As.ss(t,n),e0.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.As.os(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),e0.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.As.us(t),e0.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.As.hs(t);return e0.resolve(n)}},{key:"containsKey",value:function(e,t){return e0.resolve(this.As.containsKey(t))}}]),e}(),C4=function(){function e(t,n){var r=this;Wg(this,e),this.bs={},this.overlays={},this.Ps=new n0(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new _4(this),this.indexManager=new s4,this.remoteDocumentCache=new m4(function(e){return r.referenceDelegate.Ss(e)}),this.wt=new i4(n),this.Ds=new d4(this.wt)}return jg(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.vs=!1,Promise.resolve()}},{key:"started",get:function(){return this.vs}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new v4,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.bs[e.toKey()];return n||(n=new y4(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(e,t,n){var r=this;k1("MemoryPersistence","Starting transaction:",e);var i=new w4(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next(function(e){return r.referenceDelegate.xs(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})}},{key:"Ns",value:function(e,t){return e0.or(Object.values(this.bs).map(function(n){return function(){return n.containsKey(e,t)}}))}}]),e}(),w4=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return jg(n)}(function(){function e(){Wg(this,e),this.onCommittedListeners=[]}return jg(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(e){return e()})}}]),e}()),b4=function(){function e(t){Wg(this,e),this.persistence=t,this.ks=new p4,this.Os=null}return jg(e,[{key:"Fs",get:function(){if(this.Os)return this.Os;throw b1()}},{key:"addReference",value:function(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),e0.resolve()}},{key:"removeReference",value:function(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),e0.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Fs.add(t.toString()),e0.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.ks.us(t.targetId).forEach(function(e){return n.Fs.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.Fs.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})}},{key:"Cs",value:function(){this.Os=new Set}},{key:"xs",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return e0.forEach(this.Fs,function(r){var i=j1.fromPath(r);return t.$s(e,i).next(function(e){e||n.removeEntry(i,H1.min())})}).next(function(){return t.Os=null,n.apply(e)})}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next(function(e){e?n.Fs.delete(t.toString()):n.Fs.add(t.toString())})}},{key:"Ss",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return e0.or([function(){return e0.resolve(n.ks.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ns(e,t)}])}}],[{key:"Ms",value:function(t){return new e(t)}}]),e}(),E4=function(){function e(t,n,r,i){Wg(this,e),this.targetId=t,this.fromCache=n,this.Pi=r,this.vi=i}return jg(e,null,[{key:"Vi",value:function(t,n){var r,i=p3(),a=p3(),o=Hg(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(u){o.e(u)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),S4=function(){function e(){Wg(this,e),this.Si=!1}return jg(e,[{key:"initialize",value:function(e,t){this.Di=e,this.indexManager=t,this.Si=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return this.Ci(e,t).next(function(a){return a||i.xi(e,t,r,n)}).next(function(n){return n||i.Ni(e,t)})}},{key:"Ci",value:function(e,t){return e0.resolve(null)}},{key:"xi",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||r.isEqual(H1.min())?this.Ni(e,t):this.Di.getDocuments(e,n).next(function(a){var o=i.ki(t,a);return i.Oi(t,o,n,r)?i.Ni(e,t):(m1()<=oz.DEBUG&&k1("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),m2(t)),i.Mi(e,o,t,function(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=H1.fromTimestamp(1e9===r?new z1(n+1,0):new z1(n,r));return new Y1(i,j1.empty(),-1)}(r)))})}},{key:"ki",value:function(e,t){var n=new c0(_2(e));return t.forEach(function(t,r){k2(e,r)&&(n=n.add(r))}),n}},{key:"Oi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ni",value:function(e,t){return m1()<=oz.DEBUG&&k1("QueryEngine","Using full collection scan to execute query:",m2(t)),this.Di.getDocumentsMatchingQuery(e,t,Y1.min())}},{key:"Mi",value:function(e,t,n,r){return this.Di.getDocumentsMatchingQuery(e,n,r).next(function(e){return t.forEach(function(t){e=e.insert(t.key,t)}),e})}}]),e}(),P4=function(){function e(t,n,r,i){Wg(this,e),this.persistence=t,this.Fi=n,this.wt=i,this.$i=new o0(B1),this.Bi=new i3(function(e){return W0(e)},q0),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(r)}return jg(e,[{key:"qi",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new f4(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.$i)})}}]),e}();function O4(e,t){return T4.apply(this,arguments)}function T4(){return(T4=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=S1(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next(function(i){return t=i,r.qi(n),r.mutationQueue.getAllMutationBatches(e)}).next(function(n){var i,a=[],o=[],s=p3(),u=Hg(t);try{for(u.s();!(i=u.n()).done;){var c=i.value;a.push(c.batchId);var l,h=Hg(c.mutations);try{for(h.s();!(l=h.n()).done;){var f=l.value;s=s.add(f.key)}}catch(k){h.e(k)}finally{h.f()}}}catch(k){u.e(k)}finally{u.f()}var d,v=Hg(n);try{for(v.s();!(d=v.n()).done;){var p=d.value;o.push(p.batchId);var g,y=Hg(p.mutations);try{for(y.s();!(g=y.n()).done;){var m=g.value;s=s.add(m.key)}}catch(k){y.e(k)}finally{y.f()}}}catch(k){v.e(k)}finally{v.f()}return r.localDocuments.getDocuments(e,s).next(function(e){return{Ki:e,removedBatchIds:a,addedBatchIds:o}})})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function I4(e,t){var n=S1(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var r,i,a,o,s,u,c,l=t.batch.keys(),h=n.Ui.newChangeBuffer({trackRemovals:!0});return(r=n,i=e,a=t,o=h,s=a.batch,u=s.keys(),c=e0.resolve(),u.forEach(function(e){c=c.next(function(){return o.getEntry(i,e)}).next(function(t){var n=a.docVersions.get(e);E1(null!==n),t.version.compareTo(n)<0&&(s.applyToRemoteDocument(t,a),t.isValidDocument()&&(t.setReadTime(a.commitVersion),o.addEntry(t)))})}),c.next(function(){return r.mutationQueue.removeMutationBatch(i,s)})).next(function(){return h.apply(e)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,l,t.batch.batchId)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=p3(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))}).next(function(){return n.localDocuments.getDocuments(e,l)})})}function A4(e){var t=S1(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.Vs.getLastRemoteSnapshotVersion(e)})}function x4(e,t){var n=S1(e),r=t.snapshotVersion,i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(e){var a=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;var o=[];t.targetChanges.forEach(function(a,s){var u=i.get(s);if(u){o.push(n.Vs.removeMatchingKeys(e,a.removedDocuments,s).next(function(){return n.Vs.addMatchingKeys(e,a.addedDocuments,s)}));var c,l,h,f=u.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(s)?f=f.withResumeToken(f0.EMPTY_BYTE_STRING,H1.min()).withLastLimboFreeSnapshotVersion(H1.min()):a.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(a.resumeToken,r)),i=i.insert(s,f),l=f,h=a,(0===(c=u).resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-c.snapshotVersion.toMicroseconds()>=3e8||h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size>0)&&o.push(n.Vs.updateTargetData(e,f))}});var s=o3(),u=p3();if(t.documentUpdates.forEach(function(r){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){var r=p3(),i=p3();return n.forEach(function(e){return r=r.add(e)}),t.getEntries(e,r).next(function(e){var r=o3();return n.forEach(function(n,a){var o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(H1.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||0===a.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):k1("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",a.version)}),{Gi:r,Qi:i}})}(e,a,t.documentUpdates).next(function(e){s=e.Gi,u=e.Qi})),!r.isEqual(H1.min())){var c=n.Vs.getLastRemoteSnapshotVersion(e).next(function(t){return n.Vs.setTargetsMetadata(e,e.currentSequenceNumber,r)});o.push(c)}return e0.waitFor(o).next(function(){return a.apply(e)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(e,s,u)}).next(function(){return s})}).then(function(e){return n.$i=i,e})}function R4(e,t){var n=S1(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)})}function M4(e,t){var n=S1(e);return n.persistence.runTransaction("Allocate target","readwrite",function(e){var r;return n.Vs.getTargetData(e,t).next(function(i){return i?(r=i,e0.resolve(r)):n.Vs.allocateTargetId(e).next(function(i){return r=new r4(t,i,0,e.currentSequenceNumber),n.Vs.addTargetData(e,r).next(function(){return r})})})}).then(function(e){var r=n.$i.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(e.targetId,e),n.Bi.set(t,e.targetId)),e})}function N4(e,t,n){return D4.apply(this,arguments)}function D4(){return(D4=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=S1(t),a=i.$i.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,function(e){return i.persistence.referenceDelegate.removeTarget(e,a)});case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),t0(e.t1)){e.next=12;break}throw e.t1;case 12:k1("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.$i=i.$i.remove(n),i.Bi.delete(a.target);case 14:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function L4(e,t,n){var r=S1(e),i=H1.min(),a=p3();return r.persistence.runTransaction("Execute query","readonly",function(e){return(o=r,s=e,u=v2(t),c=S1(o),l=c.Bi.get(u),void 0!==l?e0.resolve(c.$i.get(l)):c.Vs.getTargetData(s,u)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(e,t.targetId).next(function(e){a=e})}).next(function(){return r.Fi.getDocumentsMatchingQuery(e,t,n?i:H1.min(),n?a:p3())}).next(function(e){return function(e,t,n){var r=H1.min();n.forEach(function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Li.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ji:a}});var o,s,u,c,l})}var F4=function(){function e(){Wg(this,e),this.activeTargetIds=y3()}return jg(e,[{key:"Xi",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Zi",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Yi",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),U4=function(){function e(){Wg(this,e),this.Fr=new F4,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return jg(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.$r[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Fr.Zi(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.$r[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Fr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Fr=new F4,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),B4=function(){function e(){Wg(this,e)}return jg(e,[{key:"Br",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),V4=function(){function e(){var t=this;Wg(this,e),this.Lr=function(){return t.Ur()},this.qr=function(){return t.Kr()},this.Gr=[],this.Qr()}return jg(e,[{key:"Br",value:function(e){this.Gr.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}},{key:"Qr",value:function(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}},{key:"Ur",value:function(){k1("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=Hg(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Kr",value:function(){k1("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=Hg(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"V",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),z4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},H4=function(){function e(t){Wg(this,e),this.jr=t.jr,this.Wr=t.Wr}return jg(e,[{key:"zr",value:function(e){this.Hr=e}},{key:"Jr",value:function(e){this.Yr=e}},{key:"onMessage",value:function(e){this.Xr=e}},{key:"close",value:function(){this.Wr()}},{key:"send",value:function(e){this.jr(e)}},{key:"Zr",value:function(){this.Hr()}},{key:"eo",value:function(e){this.Yr(e)}},{key:"no",value:function(e){this.Xr(e)}}]),e}(),G4=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return jg(n,[{key:"co",value:function(e,t,n,r){return new Promise(function(i,a){var o=new d1;o.listenOnce(u1.COMPLETE,function(){try{switch(o.getLastErrorCode()){case s1.NO_ERROR:var t=o.getResponseJson();k1("Connection","XHR received:",JSON.stringify(t)),i(t);break;case s1.TIMEOUT:k1("Connection",'RPC "'+e+'" timed out'),a(new O1(P1.DEADLINE_EXCEEDED,"Request time out"));break;case s1.HTTP_ERROR:var n=o.getStatus();if(k1("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=(u=r.status,c=u.toLowerCase().replace(/_/g,"-"),Object.values(P1).indexOf(c)>=0?c:P1.UNKNOWN);a(new O1(s,r.message))}else a(new O1(P1.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new O1(P1.UNAVAILABLE,"Connection failed."));break;default:b1()}}finally{k1("Connection",'RPC "'+e+'" completed.')}var u,c});var s=JSON.stringify(r);o.send(t,"POST",s,n,15)})}},{key:"ho",value:function(e,t,n){var r=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=a1(),a=o1(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new h1({})),this.uo(o.initMessageHeaders,t,n),EV()||PV()||bV().indexOf("Electron/")>=0||OV()||bV().indexOf("MSAppHost/")>=0||SV()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=r.join("");k1("Connection","Creating WebChannel: "+s,o);var u=i.createWebChannel(s,o),c=!1,l=!1,h=new H4({jr:function(e){l?k1("Connection","Not sending because WebChannel is closed:",e):(c||(k1("Connection","Opening WebChannel transport."),u.open(),c=!0),k1("Connection","WebChannel sending:",e),u.send(e))},Wr:function(){return u.close()}}),f=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(t){setTimeout(function(){throw t},0)}})};return f(u,f1.EventType.OPEN,function(){l||k1("Connection","WebChannel transport opened.")}),f(u,f1.EventType.CLOSE,function(){l||(l=!0,k1("Connection","WebChannel transport closed"),h.eo())}),f(u,f1.EventType.ERROR,function(e){l||(l=!0,C1("Connection","WebChannel transport errored:",e),h.eo(new O1(P1.UNAVAILABLE,"The operation could not be completed")))}),f(u,f1.EventType.MESSAGE,function(e){var t;if(!l){var n=e.data[0];E1(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){k1("Connection","WebChannel received error:",i);var a=i.status,o=function(e){var t=Q2[e];if(void 0!==t)return r3(t)}(a),s=i.message;void 0===o&&(o=P1.INTERNAL,s="Unknown error status: "+a+" with message "+i.message),l=!0,h.eo(new O1(o,s)),u.close()}else k1("Connection","WebChannel received:",n),h.no(n)}}),f(a,c1.STAT_EVENT,function(e){e.stat===l1.PROXY?k1("Connection","Detected buffering proxy"):e.stat===l1.NOPROXY&&k1("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Zr()},0),h}}]),n}(function(){function e(t){Wg(this,e),this.databaseInfo=t,this.databaseId=t.databaseId,this.so=(t.ssl?"https":"http")+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return jg(e,[{key:"ro",value:function(e,t,n,r,i){var a=this.oo(e,t);k1("RestConnection","Sending: ",a,n);var o={};return this.uo(o,r,i),this.co(e,a,o,n).then(function(e){return k1("RestConnection","Received: ",e),e},function(t){throw C1("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t})}},{key:"ao",value:function(e,t,n,r,i,a){return this.ro(e,t,n,r,i)}},{key:"uo",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+g1,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(function(t,n){return e[n]=t}),n&&n.headers.forEach(function(t,n){return e[n]=t})}},{key:"oo",value:function(e,t){return"".concat(this.so,"/v1/").concat(t,":").concat(z4[e])}}]),e}());function $4(){return"undefined"!=typeof document?document:null}function W4(e){return new I3(e,!0)}var q4=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;Wg(this,e),this.js=t,this.timerId=n,this.lo=r,this.fo=i,this._o=a,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}return jg(e,[{key:"reset",value:function(){this.wo=0}},{key:"po",value:function(){this.wo=this._o}},{key:"Io",value:function(e){var t=this;this.cancel();var n=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),i=Math.max(0,n-r);i>0&&k1("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.wo," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.mo=this.js.enqueueAfterDelay(this.timerId,i,function(){return t.yo=Date.now(),e()}),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}},{key:"Eo",value:function(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}},{key:"cancel",value:function(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}},{key:"To",value:function(){return(Math.random()-.5)*this.wo}}]),e}(),j4=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this.js=t,this.Ao=r,this.Ro=i,this.bo=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new q4(t,n)}return jg(e,[{key:"Do",value:function(){return 1===this.state||5===this.state||this.Co()}},{key:"Co",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.xo()}},{key:"stop",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.Do(),!t.t0){t.next=4;break}return t.next=4,e.close(0);case 4:case"end":return t.stop()}},t)}))()}},{key:"No",value:function(){this.state=0,this.So.reset()}},{key:"ko",value:function(){var e=this;this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,function(){return e.Oo()}))}},{key:"Mo",value:function(e){this.Fo(),this.stream.send(e)}},{key:"Oo",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.Co()){t.next=2;break}return t.abrupt("return",e.close(0));case 2:case"end":return t.stop()}},t)}))()}},{key:"Fo",value:function(){this.vo&&(this.vo.cancel(),this.vo=null)}},{key:"$o",value:function(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}},{key:"close",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.Fo(),n.$o(),n.So.cancel(),n.Po++,4!==e?n.So.reset():t&&t.code===P1.RESOURCE_EXHAUSTED?(_1(t.toString()),_1("Using maximum backoff delay to prevent overloading the backend."),n.So.po()):t&&t.code===P1.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Bo(),n.stream.close(),n.stream=null),n.state=e,r.next=9,n.listener.Jr(t);case 9:case"end":return r.stop()}},r)}))()}},{key:"Bo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Lo(this.Po),n=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(t){var r=Pg(t,2),i=r[0],a=r[1];e.Po===n&&e.Uo(i,a)},function(n){t(function(){var t=new O1(P1.UNKNOWN,"Fetching auth token failed: "+n.message);return e.qo(t)})})}},{key:"Uo",value:function(e,t){var n=this,r=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(function(){r(function(){return n.state=2,n.Vo=n.js.enqueueAfterDelay(n.Ro,1e4,function(){return n.Co()&&(n.state=3),Promise.resolve()}),n.listener.zr()})}),this.stream.Jr(function(e){r(function(){return n.qo(e)})}),this.stream.onMessage(function(e){r(function(){return n.onMessage(e)})})}},{key:"xo",value:function(){var e=this;this.state=5,this.So.Io(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}},t)})))}},{key:"qo",value:function(e){return k1("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Lo",value:function(e){var t=this;return function(n){t.js.enqueueAndForget(function(){return t.Po===e?n():(k1("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]),e}(),Z4=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,s)).wt=o,u}return jg(n,[{key:"Ko",value:function(e,t){return this.bo.ho("Listen",e,t)}},{key:"onMessage",value:function(e){this.So.reset();var t=function(e,t){var n,r;if("targetChange"in t){var i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:b1(),a=t.targetChange.targetIds||[],o=function(e,t){return e.dt?(E1(void 0===t||"string"==typeof t),f0.fromBase64String(t||"")):(E1(void 0===t||t instanceof Uint8Array),f0.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,u=s&&function(e){var t=void 0===e.code?P1.UNKNOWN:r3(e.code);return new O1(t,e.message||"")}(s);n=new w3(i,a,o,u||null)}else if("documentChange"in t){var c=t.documentChange,l=F3(e,c.document.name),h=M3(c.document.updateTime),f=new V0({mapValue:{fields:c.document.fields}}),d=H0.newFoundDocument(l,h,f);n=new _3(c.targetIds||[],c.removedTargetIds||[],d.key,d)}else if("documentDelete"in t){var v=t.documentDelete,p=F3(e,v.document),g=v.readTime?M3(v.readTime):H1.min(),y=H0.newNoDocument(p,g);n=new _3([],v.removedTargetIds||[],y.key,y)}else if("documentRemove"in t){var m=t.documentRemove,k=F3(e,m.document);n=new _3([],m.removedTargetIds||[],k,null)}else{if(!("filter"in t))return b1();var _=t.filter,C=new t3(_.count||0);n=new C3(_.targetId,C)}return n}(this.wt,e),n=function(e){if(!("targetChange"in e))return H1.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?H1.min():t.readTime?M3(t.readTime):H1.min()}(e);return this.listener.Go(t,n)}},{key:"Qo",value:function(e){var t,n,r,i,a={};a.database=B3(this.wt),a.addTarget=(t=this.wt,i=(n=e).target,(r=j0(i)?{documents:H3(t,i)}:{query:G3(t,i)}).targetId=n.targetId,n.resumeToken.approximateByteSize()>0?r.resumeToken=x3(t,n.resumeToken):n.snapshotVersion.compareTo(H1.min())>0&&(r.readTime=A3(t,n.snapshotVersion.toTimestamp())),r);var o=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return b1()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);o&&(a.labels=o),this.Mo(a)}},{key:"jo",value:function(e){var t={};t.database=B3(this.wt),t.removeTarget=e,this.Mo(t)}}]),n}(j4),Y4=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,s)).wt=o,u.Wo=!1,u}return jg(n,[{key:"zo",get:function(){return this.Wo}},{key:"start",value:function(){this.Wo=!1,this.lastStreamToken=void 0,xg(Bg(n.prototype),"start",this).call(this)}},{key:"Bo",value:function(){this.Wo&&this.Ho([])}},{key:"Ko",value:function(e,t){return this.bo.ho("Write",e,t)}},{key:"onMessage",value:function(e){if(E1(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();var t=function(e,t){return e&&e.length>0?(E1(void 0!==t),e.map(function(e){return function(e,t){var n=M3(e.updateTime?e.updateTime:t);return n.isEqual(H1.min())&&(n=M3(t)),new F2(n,e.transformResults||[])}(e,t)})):[]}(e.writeResults,e.commitTime),n=M3(e.commitTime);return this.listener.Jo(n,t)}return E1(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}},{key:"Xo",value:function(){var e={};e.database=B3(this.wt),this.Mo(e)}},{key:"Ho",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return function(e,t){var n,r;if(t instanceof q2)n={update:z3(e,t.key,t.value)};else if(t instanceof J2)n={delete:L3(e,t.key)};else if(t instanceof j2)n={update:z3(e,t.key,t.data),updateMask:X3(t.fieldMask)};else{if(!(t instanceof e3))return b1();n={verify:L3(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof T2)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof I2)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof x2)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof M2)return{fieldPath:t.field.canonicalString(),increment:n._t};throw b1()}(0,e)})),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:R3(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:b1()),n}(t.wt,e)})};this.Mo(n)}}]),n}(j4),K4=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.bo=i,o.wt=a,o.Zo=!1,o}return jg(n,[{key:"tu",value:function(){if(this.Zo)throw new O1(P1.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"ro",value:function(e,t,n){var r=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=Pg(i,2),o=a[0],s=a[1];return r.bo.ro(e,t,n,o,s)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===P1.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new O1(P1.UNKNOWN,e.toString())})}},{key:"ao",value:function(e,t,n,r){var i=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(a){var o=Pg(a,2),s=o[0],u=o[1];return i.bo.ao(e,t,n,s,u,r)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===P1.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new O1(P1.UNKNOWN,e.toString())})}},{key:"terminate",value:function(){this.Zo=!0}}]),n}(function(){return jg(function e(){Wg(this,e)})}()),Q4=function(){function e(t,n){Wg(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}return jg(e,[{key:"iu",value:function(){var e=this;0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.nu=null,e.ou("Backend didn't respond within 10 seconds."),e.ru("Offline"),Promise.resolve()}))}},{key:"uu",value:function(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ru("Offline")))}},{key:"set",value:function(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}},{key:"ru",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"ou",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.su?(_1(t),this.su=!1):k1("OnlineStateTracker",t)}},{key:"cu",value:function(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}]),e}(),X4=jg(function e(t,n,r,i,a){Wg(this,e);var o=this;this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=a,this.du.Br(function(e){r.enqueueAndForget(iV(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=c5(o),!e.t0){e.next=5;break}return k1("RemoteStore","Restarting streams for network reachability change."),e.next=5,(t=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=S1(t)).lu.add(4),e.next=4,t5(n);case 4:return n._u.set("Unknown"),n.lu.delete(4),e.next=8,J4(n);case 8:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})(o);case 5:case"end":return e.stop()}},e)})))}),this._u=new Q4(r,i)});function J4(e){return e5.apply(this,arguments)}function e5(){return(e5=iV(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c5(t)){e.next=18;break}n=Hg(t.fu),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,null,[[2,12,15,18]])}))).apply(this,arguments)}function t5(e){return n5.apply(this,arguments)}function n5(){return(n5=iV(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Hg(t.fu),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])}))).apply(this,arguments)}function r5(e,t){var n=S1(e);n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),u5(n)?s5(n):F5(n).Co()&&a5(n,t))}function i5(e,t){var n=S1(e),r=F5(n);n.hu.delete(t),r.Co()&&o5(n,t),0===n.hu.size&&(r.Co()?r.ko():c5(n)&&n._u.set("Unknown"))}function a5(e,t){e.wu.Nt(t.targetId),F5(e).Qo(t)}function o5(e,t){e.wu.Nt(t),F5(e).jo(t)}function s5(e){e.wu=new E3({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},te:function(t){return e.hu.get(t)||null}}),F5(e).start(),e._u.iu()}function u5(e){return c5(e)&&!F5(e).Do()&&e.hu.size>0}function c5(e){return 0===S1(e).lu.size}function l5(e){e.wu=void 0}function h5(e){return f5.apply(this,arguments)}function f5(){return(f5=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.hu.forEach(function(e,n){a5(t,e)});case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d5(e,t){return v5.apply(this,arguments)}function v5(){return(v5=iV(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l5(t),u5(t)?(t._u.uu(n),s5(t)):t._u.set("Unknown");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p5(e,t,n){return g5.apply(this,arguments)}function g5(){return(g5=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t._u.set("Online"),!(n instanceof w3&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,(a=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=Hg(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.hu.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.hu.delete(o),t.wu.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}},e,null,[[2,16,19,22]])})),function(e,t){return a.apply(this,arguments)})(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),k1("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,y5(t,e.t0);case 11:e.next=29;break;case 13:if(n instanceof _3?t.wu.Ut(n):n instanceof C3?t.wu.zt(n):t.wu.Gt(n),r.isEqual(H1.min())){e.next=29;break}return e.prev=14,e.next=17,A4(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.wu.Yt(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.hu.get(r);i&&e.hu.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.hu.get(t);if(n){e.hu.set(t,n.withResumeToken(f0.EMPTY_BYTE_STRING,n.snapshotVersion)),o5(e,t);var r=new r4(n.target,t,1,n.sequenceNumber);a5(e,r)}}),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 22:e.next=29;break;case 24:return e.prev=24,e.t2=e.catch(14),k1("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,y5(t,e.t2);case 29:case"end":return e.stop()}},e,null,[[1,6],[14,24]])}))).apply(this,arguments)}function y5(e,t,n){return m5.apply(this,arguments)}function m5(){return(m5=iV(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t0(n)){e.next=2;break}throw n;case 2:return t.lu.add(1),e.next=5,t5(t);case 5:t._u.set("Offline"),r||(r=function(){return A4(t.localStore)}),t.asyncQueue.enqueueRetryable(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k1("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.lu.delete(1),e.next=6,J4(t);case 6:case"end":return e.stop()}},e)})));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k5(e,t){return t().catch(function(n){return y5(e,n,t)})}function _5(e){return C5.apply(this,arguments)}function C5(){return(C5=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=S1(t),r=U5(n),i=n.au.length>0?n.au[n.au.length-1].batchId:-1;case 2:if(!w5(n)){e.next=19;break}return e.prev=3,e.next=6,R4(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.au.length&&r.ko(),e.abrupt("break",19);case 10:i=a.batchId,b5(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,y5(n,e.t0);case 17:e.next=2;break;case 19:E5(n)&&S5(n);case 20:case"end":return e.stop()}},e,null,[[3,13]])}))).apply(this,arguments)}function w5(e){return c5(e)&&e.au.length<10}function b5(e,t){e.au.push(t);var n=U5(e);n.Co()&&n.zo&&n.Ho(t.mutations)}function E5(e){return c5(e)&&!U5(e).Do()&&e.au.length>0}function S5(e){U5(e).start()}function P5(e){return O5.apply(this,arguments)}function O5(){return(O5=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:U5(t).Xo();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function T5(e){return I5.apply(this,arguments)}function I5(){return(I5=iV(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=U5(t),r=Hg(t.au);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Ho(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A5(e,t,n){return x5.apply(this,arguments)}function x5(){return(x5=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.au.shift(),a=t4.from(i,n,r),e.next=3,k5(t,function(){return t.remoteSyncer.applySuccessfulWrite(a)});case 3:return e.next=5,_5(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function R5(e,t){return M5.apply(this,arguments)}function M5(){return(M5=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&U5(t).zo,!e.t0){e.next=4;break}return e.next=4,(r=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n3(i=n.code)||i===P1.ABORTED){e.next=7;break}return r=t.au.shift(),U5(t).No(),e.next=5,k5(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return e.next=7,_5(t);case 7:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})(t,n);case 4:E5(t)&&S5(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function N5(e,t){return D5.apply(this,arguments)}function D5(){return(D5=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=S1(t)).asyncQueue.verifyOperationInProgress(),k1("RemoteStore","RemoteStore received new credentials"),i=c5(r),r.lu.add(3),e.next=6,t5(r);case 6:return i&&r._u.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.lu.delete(3),e.next=12,J4(r);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function L5(){return(L5=iV(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S1(t),!n){e.next=7;break}return r.lu.delete(2),e.next=5,J4(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.lu.add(2),e.next=12,t5(r);case 12:r._u.set("Unknown");case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F5(e){return e.mu||(e.mu=(t=e.datastore,n=e.asyncQueue,r={zr:h5.bind(null,e),Jr:d5.bind(null,e),Go:p5.bind(null,e)},(i=S1(t)).tu(),new Z4(n,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,r)),e.fu.push(function(){var t=iV(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.mu.No(),u5(e)?s5(e):e._u.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.mu.stop();case 6:l5(e);case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.mu;var t,n,r,i}function U5(e){return e.gu||(e.gu=(t=e.datastore,n=e.asyncQueue,r={zr:P5.bind(null,e),Jr:R5.bind(null,e),Yo:T5.bind(null,e),Jo:A5.bind(null,e)},(i=S1(t)).tu(),new Y4(n,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,r)),e.fu.push(function(){var t=iV(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.gu.No(),t.next=4,_5(e);case 4:t.next=9;break;case 6:return t.next=8,e.gu.stop();case 8:e.au.length>0&&(k1("RemoteStore","Stopping write stream with ".concat(e.au.length," pending writes")),e.au=[]);case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.gu;var t,n,r,i}var B5=function(){function e(t,n,r,i,a){Wg(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new T1,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return jg(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new O1(P1.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function V5(e,t){if(_1("AsyncQueue","".concat(t,": ").concat(e)),t0(e))return new O1(P1.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var z5=function(){function e(t){Wg(this,e),this.comparator=t?function(e,n){return t(e,n)||j1.comparator(e.key,n.key)}:function(e,t){return j1.comparator(e.key,t.key)},this.keyedMap=u3(),this.sortedSet=new o0(this.comparator)}return jg(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),H5=function(){function e(){Wg(this,e),this.yu=new o0(j1.comparator)}return jg(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.yu.get(t);n?0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):b1():this.yu=this.yu.insert(t,e)}},{key:"pu",value:function(){var e=[];return this.yu.inorderTraversal(function(t,n){e.push(n)}),e}}]),e}(),G5=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return jg(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&g2(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach(function(e){a.push({type:0,doc:e})}),new e(t,n,z5.emptySet(n),a,r,i,!0,!1)}}]),e}(),$5=jg(function e(){Wg(this,e),this.Iu=void 0,this.listeners=[]}),W5=jg(function e(){Wg(this,e),this.queries=new i3(function(e){return y2(e)},g2),this.onlineState="Unknown",this.Tu=new Set});function q5(e,t){return j5.apply(this,arguments)}function j5(){return(j5=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S1(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new $5),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.Iu=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),s=V5(e.t0,"Initialization of query '".concat(m2(n.query),"' failed")),e.abrupt("return",void n.onError(s));case 13:r.queries.set(i,o),o.listeners.push(n),n.Eu(r.onlineState),o.Iu&&n.Au(o.Iu)&&X5(r);case 14:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function Z5(e,t){return Y5.apply(this,arguments)}function Y5(){return(Y5=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S1(t),i=n.query,a=!1,(o=r.queries.get(i))&&(s=o.listeners.indexOf(n))>=0&&(o.listeners.splice(s,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K5(e,t){var n,r=S1(e),i=!1,a=Hg(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=r.queries.get(o.query);if(s){var u,c=Hg(s.listeners);try{for(c.s();!(u=c.n()).done;){u.value.Au(o)&&(i=!0)}}catch(l){c.e(l)}finally{c.f()}s.Iu=o}}}catch(l){a.e(l)}finally{a.f()}i&&X5(r)}function Q5(e,t,n){var r=S1(e),i=r.queries.get(t);if(i){var a,o=Hg(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(s){o.e(s)}finally{o.f()}}r.queries.delete(t)}function X5(e){e.Tu.forEach(function(e){e.next()})}var J5=function(){function e(t,n,r){Wg(this,e),this.query=t,this.Ru=n,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}return jg(e,[{key:"Au",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=Hg(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(o){r.e(o)}finally{r.f()}e=new G5(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),a=!0):this.Vu(e,this.onlineState)&&(this.Su(e),a=!0),this.Pu=e,a}},{key:"onError",value:function(e){this.Ru.error(e)}},{key:"Eu",value:function(e){this.onlineState=e;var t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}},{key:"Vu",value:function(e,t){return!e.fromCache||!(this.options.Du&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}},{key:"vu",value:function(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}},{key:"Su",value:function(e){e=G5.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}]),e}(),e6=jg(function e(t){Wg(this,e),this.key=t}),t6=jg(function e(t){Wg(this,e),this.key=t}),n6=function(){function e(t,n){Wg(this,e),this.query=t,this.Fu=n,this.$u=null,this.current=!1,this.Bu=p3(),this.mutatedKeys=p3(),this.Lu=_2(t),this.Uu=new z5(this.Lu)}return jg(e,[{key:"qu",get:function(){return this.Fu}},{key:"Ku",value:function(e,t){var n=this,r=t?t.Gu:new H5,i=t?t.Uu:this.Uu,a=t?t.mutatedKeys:this.mutatedKeys,o=i,s=!1,u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),h=k2(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Qu(l,h)||(r.track({type:2,doc:h}),v=!0,(u&&n.Lu(h,u)>0||c&&n.Lu(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(u||c)&&(s=!0)),v&&(h?(o=o.add(h),a=d?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))}),null!==this.query.limit)for(;o.size>this.query.limit;){var l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Uu:o,Gu:r,Oi:s,mutatedKeys:a}}},{key:"Qu",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;var a=e.Gu.pu();a.sort(function(e,t){return n=e.type,i=t.type,(a=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b1()}})(n)-a(i)||r.Lu(e.doc,t.doc);var n,i,a}),this.ju(n);var o=t?this.Wu():[],s=0===this.Bu.size&&this.current?1:0,u=s!==this.$u;return this.$u=s,0!==a.length||u?{snapshot:new G5(this.query,e.Uu,i,a,e.mutatedKeys,0===s,u,!1),zu:o}:{zu:o}}},{key:"Eu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new H5,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}},{key:"Hu",value:function(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}},{key:"ju",value:function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.Fu=t.Fu.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.Fu=t.Fu.delete(e)}),this.current=e.current)}},{key:"Wu",value:function(){var e=this;if(!this.current)return[];var t=this.Bu;this.Bu=p3(),this.Uu.forEach(function(t){e.Hu(t.key)&&(e.Bu=e.Bu.add(t.key))});var n=[];return t.forEach(function(t){e.Bu.has(t)||n.push(new t6(t))}),this.Bu.forEach(function(e){t.has(e)||n.push(new e6(e))}),n}},{key:"Ju",value:function(e){this.Fu=e.ji,this.Bu=p3();var t=this.Ku(e.documents);return this.applyChanges(t,!0)}},{key:"Yu",value:function(){return G5.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}]),e}(),r6=jg(function e(t,n,r){Wg(this,e),this.query=t,this.targetId=n,this.view=r}),i6=jg(function e(t){Wg(this,e),this.key=t,this.Xu=!1}),a6=function(){function e(t,n,r,i,a,o){Wg(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Zu={},this.tc=new i3(function(e){return y2(e)},g2),this.ec=new Map,this.nc=new Set,this.sc=new o0(j1.comparator),this.ic=new Map,this.rc=new p4,this.oc={},this.uc=new Map,this.cc=l4.Rn(),this.onlineState="Unknown",this.ac=void 0}return jg(e,[{key:"isPrimaryClient",get:function(){return!0===this.ac}}]),e}();function o6(e,t){return s6.apply(this,arguments)}function s6(){return(s6=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=N6(t),!(o=r.tc.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.Yu(),e.next=15;break;case 6:return e.next=8,M4(r.localStore,v2(n));case 8:return s=e.sent,r.isPrimaryClient&&r5(r.remoteStore,s),u=r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.targetId,e.next=14,u6(r,n,i,"current"===u);case 14:a=e.sent;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u6(e,t,n,r){return c6.apply(this,arguments)}function c6(){return(c6=iV(regeneratorRuntime.mark(function e(t,n,r,i){var a,o,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.hc=function(e,n,r){return(i=iV(regeneratorRuntime.mark(function e(t,n,r,i){var a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Ku(r),e.t0=a.Oi,!e.t0){e.next=6;break}return e.next=5,L4(t.localStore,n.query,!1).then(function(e){var t=e.documents;return n.view.Ku(t,a)});case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(P6(t,n.targetId,s.zu),s.snapshot));case 8:case"end":return e.stop()}},e)})),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,L4(t.localStore,n,!0);case 3:return a=e.sent,o=new n6(n,a.ji),s=o.Ku(a.documents),u=k3.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),c=o.applyChanges(s,t.isPrimaryClient,u),P6(t,r,c.zu),l=new r6(n,r,o),e.abrupt("return",(t.tc.set(n,l),t.ec.has(r)?t.ec.get(r).push(n):t.ec.set(r,[n]),c.snapshot));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l6(e,t){return h6.apply(this,arguments)}function h6(){return(h6=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S1(t),i=r.tc.get(n),!((a=r.ec.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.ec.set(i.targetId,a.filter(function(e){return!g2(e,n)})),void r.tc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,N4(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),i5(r.remoteStore,i.targetId),E6(r,i.targetId)}).catch(X1);case 9:e.next=14;break;case 11:return E6(r,i.targetId),e.next=14,N4(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f6(){return(f6=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=D6(t),e.prev=1,e.next=4,function(e,t){var n,r,i=S1(e),a=z1.now(),o=t.reduce(function(e,t){return e.add(t.key)},p3());return i.persistence.runTransaction("Locally write mutations","readwrite",function(e){var s=o3(),u=p3();return i.Ui.getEntries(e,o).next(function(e){(s=e).forEach(function(e,t){t.isValidDocument()||(u=u.add(e))})}).next(function(){return i.localDocuments.getOverlayedDocuments(e,s)}).next(function(r){n=r;var o,s=[],u=Hg(t);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=$2(c,n.get(c.key).overlayedDocument);null!=l&&s.push(new j2(c.key,l,z0(l.value.mapValue),U2.exists(!0)))}}catch(h){u.e(h)}finally{u.f()}return i.mutationQueue.addMutationBatch(e,a,s,t)}).next(function(t){r=t;var a=t.applyToLocalDocumentSet(n,u);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)})}).then(function(){return{batchId:r.batchId,changes:c3(n)}})}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),s=i,u=a.batchId,c=r,l=void 0,(l=s.oc[s.currentUser.toKey()])||(l=new o0(B1)),l=l.insert(u,c),s.oc[s.currentUser.toKey()]=l,e.next=9,I6(i,a.changes);case 9:return e.next=11,_5(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=V5(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}var s,u,c,l},e,null,[[1,13]])}))).apply(this,arguments)}function d6(e,t){return v6.apply(this,arguments)}function v6(){return(v6=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=S1(t),e.prev=1,e.next=4,x4(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach(function(e,t){var n=r.ic.get(t);n&&(E1(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Xu=!0:e.modifiedDocuments.size>0?E1(n.Xu):e.removedDocuments.size>0&&(E1(n.Xu),n.Xu=!1))}),e.next=8,I6(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,X1(e.t0);case 14:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function p6(e,t,n){var r=S1(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.tc.forEach(function(e,n){var r=n.view.Eu(t);r.snapshot&&i.push(r.snapshot)}),function(e,t){var n=S1(e);n.onlineState=t;var r=!1;n.queries.forEach(function(e,n){var i,a=Hg(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.Eu(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}}),r&&X5(n)}(r.eventManager,t),i.length&&r.Zu.Go(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function g6(e,t,n){return y6.apply(this,arguments)}function y6(){return(y6=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((i=S1(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.ic.get(n),!(o=a&&a.key)){e.next=14;break}return s=(s=new o0(j1.comparator)).insert(o,H0.newNoDocument(o,H1.min())),u=p3().add(o),c=new m3(H1.min(),new Map,new c0(B1),s,u),e.next=9,d6(i,c);case 9:i.sc=i.sc.remove(o),i.ic.delete(n),T6(i),e.next=16;break;case 14:return e.next=16,N4(i.localStore,n,!1).then(function(){return E6(i,n,r)}).catch(X1);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m6(e,t){return k6.apply(this,arguments)}function k6(){return(k6=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=S1(t),i=n.batch.batchId,e.prev=1,e.next=4,I4(r.localStore,n);case 4:return a=e.sent,b6(r,i,null),w6(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,I6(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,X1(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function _6(e,t,n){return C6.apply(this,arguments)}function C6(){return(C6=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=S1(t),e.prev=1,e.next=4,function(e,t){var n=S1(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next(function(t){return E1(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)}).next(function(){return n.localDocuments.getDocuments(e,r)})})}(i.localStore,n);case 4:return a=e.sent,b6(i,n,r),w6(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,I6(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,X1(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function w6(e,t){(e.uc.get(t)||[]).forEach(function(e){e.resolve()}),e.uc.delete(t)}function b6(e,t,n){var r=S1(e),i=r.oc[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.oc[r.currentUser.toKey()]=i}}function E6(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=Hg(e.ec.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.tc.delete(a),n&&e.Zu.lc(a,n)}}catch(o){i.e(o)}finally{i.f()}e.ec.delete(t),e.isPrimaryClient&&e.rc.us(t).forEach(function(t){e.rc.containsKey(t)||S6(e,t)})}function S6(e,t){e.nc.delete(t.path.canonicalString());var n=e.sc.get(t);null!==n&&(i5(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),T6(e))}function P6(e,t,n){var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof e6?(e.rc.addReference(a.key,t),O6(e,a)):a instanceof t6?(k1("SyncEngine","Document no longer in limbo: "+a.key),e.rc.removeReference(a.key,t),e.rc.containsKey(a.key)||S6(e,a.key)):b1()}}catch(o){i.e(o)}finally{i.f()}}function O6(e,t){var n=t.key,r=n.path.canonicalString();e.sc.get(n)||e.nc.has(r)||(k1("SyncEngine","New document in limbo: "+n),e.nc.add(r),T6(e))}function T6(e){for(;e.nc.size>0&&e.sc.size<e.maxConcurrentLimboResolutions;){var t=e.nc.values().next().value;e.nc.delete(t);var n=new j1($1.fromString(t)),r=e.cc.next();e.ic.set(r,new i6(n)),e.sc=e.sc.insert(n,r),r5(e.remoteStore,new r4(v2(c2(n.path)),r,2,n0.ot))}}function I6(e,t,n){return A6.apply(this,arguments)}function A6(){return(A6=iV(regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=S1(t),a=[],o=[],s=[],e.t0=i.tc.isEmpty(),e.t0){e.next=9;break}return i.tc.forEach(function(e,t){s.push(i.hc(t,n,r).then(function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=E4.Vi(t.targetId,e);o.push(n)}}))}),e.next=6,Promise.all(s);case 6:return i.Zu.Go(a),e.next=9,(u=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=S1(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return e0.forEach(n,function(t){return e0.forEach(t.Pi,function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)}).next(function(){return e0.forEach(t.vi,function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)})})})});case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),t0(e.t0)){e.next=10;break}throw e.t0;case 10:k1("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=Hg(n);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.targetId,o.fromCache||(u=r.$i.get(s),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),r.$i=r.$i.insert(s,c))}catch(l){i.e(l)}finally{i.f()}case 13:case"end":return e.stop()}},e,null,[[1,6]])})),function(e,t){return u.apply(this,arguments)})(i.localStore,o);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x6(e,t){return R6.apply(this,arguments)}function R6(){return(R6=iV(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=S1(t)).currentUser.isEqual(n)){e.next=12;break}return k1("SyncEngine","User change. New user:",n.toKey()),e.next=5,O4(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,(a=r).uc.forEach(function(e){e.forEach(function(e){e.reject(new O1(P1.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),a.uc.clear(),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=12,I6(r,i.Ki);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function M6(e,t){var n=S1(e),r=n.ic.get(t);if(r&&r.Xu)return p3().add(r.key);var i=p3(),a=n.ec.get(t);if(!a)return i;var o,s=Hg(a);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=n.tc.get(u);i=i.unionWith(c.view.qu)}}catch(l){s.e(l)}finally{s.f()}return i}function N6(e){var t=S1(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=d6.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=M6.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=g6.bind(null,t),t.Zu.Go=K5.bind(null,t.eventManager),t.Zu.lc=Q5.bind(null,t.eventManager),t}function D6(e){var t=S1(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=m6.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_6.bind(null,t),t}var L6=function(){function e(){Wg(this,e),this.synchronizeTabs=!1}return jg(e,[{key:"initialize",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.wt=W4(e.databaseInfo.databaseId),t.sharedClientState=t.dc(e),t.persistence=t._c(e),n.next=5,t.persistence.start();case 5:t.localStore=t.wc(e),t.gcScheduler=t.mc(e,t.localStore),t.indexBackfillerScheduler=t.gc(e,t.localStore);case 8:case"end":return n.stop()}},n)}))()}},{key:"mc",value:function(e,t){return null}},{key:"gc",value:function(e,t){return null}},{key:"wc",value:function(e){return function(e,t,n,r){return new P4(e,t,n,r)}(this.persistence,new S4,e.initialUser,this.wt)}},{key:"_c",value:function(e){return new C4(b4.Ms,this.wt)}},{key:"dc",value:function(e){return new U4}},{key:"terminate",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.gcScheduler&&e.gcScheduler.stop(),t.next=3,e.sharedClientState.shutdown();case 3:return t.next=5,e.persistence.shutdown();case 5:case"end":return t.stop()}},t)}))()}}]),e}(),F6=function(){function e(){Wg(this,e)}return jg(e,[{key:"initialize",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=n.localStore,r.t0){r.next=12;break}return n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=function(e){return p6(n.syncEngine,e,1)},n.remoteStore.remoteSyncer.handleCredentialChange=x6.bind(null,n.syncEngine),r.next=12,function(e,t){return L5.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient);case 12:case"end":return r.stop()}},r)}))()}},{key:"createEventManager",value:function(e){return new W5}},{key:"createDatastore",value:function(e){var t=W4(e.databaseInfo.databaseId),n=new G4(e.databaseInfo);return new K4(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return p6(o.syncEngine,e,0)},a=V4.V()?new V4:new B4,new X4(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return n=this.localStore,r=this.remoteStore,i=this.eventManager,a=this.sharedClientState,o=e.initialUser,s=e.maxConcurrentLimboResolutions,u=t,c=new a6(n,r,i,a,o,s),u&&(c.ac=!0),c;var n,r,i,a,o,s,u,c}},{key:"terminate",value:function(){return(e=iV(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=S1(t),k1("RemoteStore","RemoteStore shutting down."),n.lu.add(5),e.next=5,t5(n);case 5:n.du.shutdown(),n._u.set("Unknown");case 7:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}(),U6=function(){function e(t){Wg(this,e),this.observer=t,this.muted=!1}return jg(e,[{key:"next",value:function(e){this.observer.next&&this.Ic(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"Tc",value:function(){this.muted=!0}},{key:"Ic",value:function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)}}]),e}(),B6=function(){function e(t,n,r,i){var a=this;Wg(this,e);var o,s=this;this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=p1.UNAUTHENTICATED,this.clientId=U1.I(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,(o=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k1("FirestoreClient","Received user=",t.uid),e.next=3,s.authCredentialListener(t);case 3:s.user=t;case 4:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)})),this.appCheckCredentials.start(r,function(e){return k1("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)})}return jg(e,[{key:"getConfiguration",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100});case 1:case"end":return t.stop()}},t)}))()}},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new O1(P1.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new T1;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=V5(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}},n,null,[[0,14]])}))),t.promise}}]),e}();function V6(e,t){return z6.apply(this,arguments)}function z6(){return(z6=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),k1("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,O4(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=n;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H6(e,t){return G6.apply(this,arguments)}function G6(){return(G6=iV(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,$6(t);case 3:return r=e.sent,k1("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener(function(e){return N5(n.remoteStore,e)}),t.setAppCheckTokenChangeListener(function(e,t){return N5(n.remoteStore,t)}),t.onlineComponents=n;case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $6(e){return W6.apply(this,arguments)}function W6(){return(W6=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return k1("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,V6(t,new L6);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q6(e){return j6.apply(this,arguments)}function j6(){return(j6=iV(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return k1("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,H6(t,new F6);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Z6(e){return Y6.apply(this,arguments)}function Y6(){return(Y6=iV(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q6(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=o6.bind(null,n.syncEngine),r.onUnlisten=l6.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var K6=new Map;function Q6(e,t,n){if(!n)throw new O1(P1.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function X6(e){if(!j1.isDocumentKey(e))throw new O1(P1.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function J6(e){if(j1.isDocumentKey(e))throw new O1(P1.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function e8(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=(n=e).constructor?n.constructor.name:null;return t?"a custom ".concat(t," object"):"an object"}var n;return"function"==typeof e?"a function":b1()}function t8(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new O1(P1.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=e8(e);throw new O1(P1.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}var n8=function(){function e(t){var n;if(Wg(this,e),void 0===t.host){if(void 0!==t.ssl)throw new O1(P1.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new O1(P1.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new O1(P1.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}return jg(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),r8=function(){function e(t,n,r){Wg(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new n8({}),this._settingsFrozen=!1,t instanceof C0?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new O1(P1.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new C0(e.options.projectId)}(t))}return jg(e,[{key:"app",get:function(){if(!this._app)throw new O1(P1.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new O1(P1.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new n8(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new A1;switch(e.type){case"gapi":var t=e.client;return E1(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new N1(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new O1(P1.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=K6.get(e))&&(k1("ComponentProvider","Removing Datastore"),K6.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();var i8=function(){function e(t,n,r){Wg(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return jg(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new o8(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),a8=function(){function e(t,n,r){Wg(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return jg(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),o8=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r,c2(i)))._path=i,a.type="collection",a}return jg(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new i8(this.firestore,null,new j1(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(a8);function s8(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=XV(e),1===arguments.length&&(t=U1.I()),Q6("doc","path",t),e instanceof r8){var a=$1.fromString.apply($1,[t].concat(r));return X6(a),new i8(e,null,new j1(a))}if(!(e instanceof i8||e instanceof o8))throw new O1(P1.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child($1.fromString.apply($1,[t].concat(r)));return X6(o),new i8(e.firestore,e instanceof o8?e.converter:null,new j1(o))}var u8=function(){function e(){var t=this;Wg(this,e),this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new q4(this,"async_queue_retry"),this.Kc=function(){var e=$4();e&&k1("AsyncQueue","Visibility state changed to "+e.visibilityState),t.So.Eo()};var n=$4();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Kc)}return jg(e,[{key:"isShuttingDown",get:function(){return this.Fc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Gc(),this.Qc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;var t=$4();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}},{key:"enqueue",value:function(e){var t=this;if(this.Gc(),this.Fc)return new Promise(function(){});var n=new T1;return this.Qc(function(){return t.Fc&&t.Uc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget(function(){return t.Mc.push(e),t.jc()})}},{key:"jc",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0===e.Mc.length){t.next=14;break}return t.prev=1,t.next=4,e.Mc[0]();case 4:e.Mc.shift(),e.So.reset(),t.next=13;break;case 8:if(t.prev=8,t.t0=t.catch(1),t0(t.t0)){t.next=12;break}throw t.t0;case 12:k1("AsyncQueue","Operation failed with retryable error: "+t.t0);case 13:e.Mc.length>0&&e.So.Io(function(){return e.jc()});case 14:case"end":return t.stop()}},t,null,[[1,8]])}))()}},{key:"Qc",value:function(e){var t=this,n=this.Oc.then(function(){return t.Lc=!0,e().catch(function(e){throw t.Bc=e,t.Lc=!1,_1("INTERNAL UNHANDLED ERROR: ",(r=(n=e).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),e;var n,r}).then(function(e){return t.Lc=!1,e})});return this.Oc=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Gc(),this.qc.indexOf(e)>-1&&(t=0);var i=B5.createAndSchedule(this,e,t,n,function(e){return r.Wc(e)});return this.$c.push(i),i}},{key:"Gc",value:function(){this.Bc&&b1()}},{key:"verifyOperationInProgress",value:function(){}},{key:"zc",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.Oc,t.next=3,n;case 3:if(n!==e.Oc){t.next=0;break}case 4:case"end":return t.stop()}},t)}))()}},{key:"Hc",value:function(e){var t,n=Hg(this.$c);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Jc",value:function(e){var t=this;return this.zc().then(function(){t.$c.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var n,r=Hg(t.$c);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.zc()})}},{key:"Yc",value:function(e){this.qc.push(e)}},{key:"Wc",value:function(e){var t=this.$c.indexOf(e);this.$c.splice(t,1)}}]),e}();function c8(e){return function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=e,r=0,i=["next","error","complete"];r<i.length;r++){var a=i[r];if(a in n&&"function"==typeof n[a])return!0}return!1}(e)}var l8=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new u8,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return jg(n,[{key:"_terminate",value:function(){return this._firestoreClient||f8(this),this._firestoreClient.terminate()}}]),n}(r8);function h8(e){return e._firestoreClient||f8(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function f8(e){var t,n,r,i=e._freezeSettings(),a=(n=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new _0(e._databaseId,n,e._persistenceKey,(r=i).host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams));e._firestoreClient=new B6(e._authCredentials,e._appCheckCredentials,e._queue,a)}var d8=function(){function e(){Wg(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new O1(P1.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new q1(n)}return jg(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}(),v8=function(){function e(t){Wg(this,e),this._byteString=t}return jg(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(f0.fromBase64String(t))}catch(n){throw new O1(P1.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}},{key:"fromUint8Array",value:function(t){return new e(f0.fromUint8Array(t))}}]),e}(),p8=jg(function e(t){Wg(this,e),this._methodName=t}),g8=function(){function e(t,n){if(Wg(this,e),!isFinite(t)||t<-90||t>90)throw new O1(P1.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new O1(P1.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return jg(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return B1(this._lat,e._lat)||B1(this._long,e._long)}}]),e}(),y8=/^__.*__$/,m8=function(){function e(t,n,r){Wg(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return jg(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new j2(e,this.data,this.fieldMask,t,this.fieldTransforms):new q2(e,this.data,t,this.fieldTransforms)}}]),e}(),k8=function(){function e(t,n,r){Wg(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return jg(e,[{key:"toMutation",value:function(e,t){return new j2(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function _8(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b1()}}var C8=function(){function e(t,n,r,i,a,o){Wg(this,e),this.settings=t,this.databaseId=n,this.wt=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Xc(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return jg(e,[{key:"path",get:function(){return this.settings.path}},{key:"Zc",get:function(){return this.settings.Zc}},{key:"ta",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ea",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.sa(e),r}},{key:"ia",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.Xc(),r}},{key:"ra",value:function(e){return this.ta({path:void 0,na:!0})}},{key:"oa",value:function(e){return N8(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:"Xc",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.sa(this.path.get(e))}},{key:"sa",value:function(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(_8(this.Zc)&&y8.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}]),e}(),w8=function(){function e(t,n,r){Wg(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.wt=r||W4(t)}return jg(e,[{key:"aa",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new C8({Zc:e,methodName:t,ca:n,path:q1.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}]),e}();function b8(e){var t=e._freezeSettings(),n=W4(e._databaseId);return new w8(e._databaseId,!!t.ignoreUndefinedProperties,n)}function E8(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.aa(a.merge||a.mergeFields?2:0,t,n,i);A8("Data must be an object, but it was:",o,r);var s,u,c=T8(r,o);if(a.merge)s=new h0(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){var l,h=[],f=Hg(a.mergeFields);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=x8(t,d,n);if(!o.contains(v))throw new O1(P1.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));D8(h,v)||h.push(v)}}catch(p){f.e(p)}finally{f.f()}s=new h0(h),u=o.fieldTransforms.filter(function(e){return s.covers(e.field)})}else s=null,u=o.fieldTransforms;return new m8(new V0(c),s,u)}var S8=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Zc)throw e.oa(1===e.Zc?"".concat(this._methodName,"() can only appear at the top level of your update data"):"".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(p8),P8=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"_toFieldTransform",value:function(e){return new L2(e.path,new T2)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(p8);function O8(e,t){if(I8(e=XV(e)))return A8("Unsupported field value:",t,e),T8(e,t);if(e instanceof p8)return function(e,t){if(!_8(t.Zc))throw t.oa("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.oa("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=Hg(e);try{for(a.s();!(n=a.n()).done;){var o=O8(n.value,t.ra(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(s){a.e(s)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=XV(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!b0(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?b2(t):w2(e,t)}(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=z1.fromDate(e);return{timestampValue:A3(t.wt,n)}}if(e instanceof z1){var r=new z1(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:A3(t.wt,r)}}if(e instanceof g8)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof v8)return{bytesValue:x3(t.wt,e._byteString)};if(e instanceof i8){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.oa("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:N3(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa("Unsupported field value: ".concat(e8(e)))}(e,t)}function T8(e,t){var n={};return a0(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):i0(e,function(e,r){var i=O8(r,t.ea(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function I8(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof z1||e instanceof g8||e instanceof v8||e instanceof i8||e instanceof p8)}function A8(e,t,n){if(!I8(n)||"object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){var r=e8(n);throw t.oa("an object"===r?e+" a custom object":e+" "+r)}var i}function x8(e,t,n){if((t=XV(t))instanceof d8)return t._internalPath;if("string"==typeof t)return M8(e,t);throw N8("Field path arguments must be of type string or ",e,!1,void 0,n)}var R8=new RegExp("[~\\*/\\[\\]]");function M8(e,t,n){if(t.search(R8)>=0)throw N8("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return Ag(d8,Vg(t.split(".")))._internalPath}catch(r){throw N8("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function N8(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(a||o)&&(u+=" (found",a&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(i)),u+=")"),new O1(P1.INVALID_ARGUMENT,s+e+u)}function D8(e,t){return e.some(function(e){return e.isEqual(t)})}var L8=function(){function e(t,n,r,i,a){Wg(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return jg(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new i8(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new F8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(U8("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),F8=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"data",value:function(){return xg(Bg(n.prototype),"data",this).call(this)}}]),n}(L8);function U8(e,t){return"string"==typeof t?M8(e,t):t instanceof d8?t._internalPath:t._delegate._internalPath}var B8=function(){function e(t,n){Wg(this,e),this.hasPendingWrites=t,this.fromCache=n}return jg(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),V8=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,i,a,s))._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return jg(n,[{key:"exists",value:function(){return xg(Bg(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new z8(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(U8("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(L8),z8=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return xg(Bg(n.prototype),"data",this).call(this,e)}}]),n}(V8),H8=function(){function e(t,n,r,i){Wg(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new B8(i.hasPendingWrites,i.fromCache),this.query=r}return jg(e,[{key:"docs",get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new z8(n._firestore,n._userDataWriter,r.key,r,new B8(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O1(P1.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){return{type:"added",doc:new z8(e._firestore,e._userDataWriter,t.doc.key,t.doc,new B8(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new z8(e._firestore,e._userDataWriter,t.doc.key,t.doc,new B8(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:G8(t.type),doc:n,oldIndex:i,newIndex:a}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function G8(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b1()}}function $8(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new O1(P1.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var W8=jg(function e(){Wg(this,e)});var q8=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).fa=e,a.da=r,a._a=i,a.type="where",a}return jg(n,[{key:"_apply",value:function(e){var t,n,r,i=b8(e.firestore),a=function(e,t,n,r,i,a,o){var s;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new O1(P1.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){K8(o,a);var u,c=[],l=Hg(o);try{for(l.s();!(u=l.n()).done;){var h=u.value;c.push(Y8(r,e,h))}}catch(d){l.e(d)}finally{l.f()}s={arrayValue:{values:c}}}else s=Y8(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||K8(o,a),s=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return O8(n,e.aa(r?4:3,t))}(n,"where",o,"in"===a||"not-in"===a);var f=Z0.create(i,a,s);return function(e,t){if(t.ht()){var n=h2(e);if(null!==n&&!n.isEqual(t.field))throw new O1(P1.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=l2(e);null!==r&&Q8(0,t.field,r)}var i=function(e,t){var n,r=Hg(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw new O1(P1.INVALID_ARGUMENT,i===t.op?"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter."):"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,f),f}(e._query,0,i,e.firestore._databaseId,this.fa,this.da,this._a);return new a8(e.firestore,e.converter,(t=e._query,n=a,r=t.filters.concat([n]),new u2(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)))}}]),n}(W8);var j8=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).fa=e,i.wa=r,i.type="orderBy",i}return jg(n,[{key:"_apply",value:function(e){var t,n,r,i=function(e,t,n){if(null!==e.startAt)throw new O1(P1.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new O1(P1.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new i2(t,n);return function(e,t){if(null===l2(e)){var n=h2(e);null!==n&&Q8(0,n,t.field)}}(e,r),r}(e._query,this.fa,this.wa);return new a8(e.firestore,e.converter,(t=e._query,n=i,r=t.explicitOrderBy.concat([n]),new u2(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}]),n}(W8);var Z8=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).type=e,a.ma=r,a.ga=i,a}return jg(n,[{key:"_apply",value:function(e){return new a8(e.firestore,e.converter,p2(e._query,this.ma,this.ga))}}]),n}(W8);function Y8(e,t,n){if("string"==typeof(n=XV(n))){if(""===n)throw new O1(P1.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!f2(t)&&-1!==n.indexOf("/"))throw new O1(P1.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child($1.fromString(n));if(!j1.isDocumentKey(r))throw new O1(P1.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return R0(e,new j1(r))}if(n instanceof i8)return R0(e,n._key);throw new O1(P1.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(e8(n),"."))}function K8(e,t){if(!Array.isArray(e)||0===e.length)throw new O1(P1.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new O1(P1.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Q8(e,t,n){if(!n.isEqual(t))throw new O1(P1.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}function X8(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var J8=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).firestore=e,r}return jg(n,[{key:"convertBytes",value:function(e){return new v8(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new i8(this.firestore,null,t)}}]),n}(function(){function e(){Wg(this,e)}return jg(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(S0(e)){case 0:return null;case 1:return e.booleanValue;case 2:return p0(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(g0(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw b1()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return i0(e.fields,function(e,i){r[e]=n.convertValue(i,t)}),r}},{key:"convertGeoPoint",value:function(e){return new g8(p0(e.latitude),p0(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=m0(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(k0(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=v0(e);return new z1(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=$1.fromString(e);E1(J3(n));var r=new C0(n.get(1),n.get(3)),i=new j1(n.popFirst(5));return r.isEqual(t)||_1("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}());function e7(e,t){return n=h8(e),r=t,i=new T1,n.asyncQueue.enqueueAndForget(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e,t,n){return f6.apply(this,arguments)},e.next=3,function(e){return q6(e).then(function(e){return e.syncEngine})}(n);case 3:return e.t1=e.sent,e.t2=r,e.t3=i,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}},e)}))),i.promise;var n,r,i}function t7(e,t,n){var r=n.docs.get(t._key),i=new J8(e);return new V8(e,i,t._key,r,new B8(n.hasPendingWrites,n.fromCache),t.converter)}function n7(){return new P8("serverTimestamp")}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];g1="9.9.0",Dz(new tz("firestore",function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new l8(i,new R1(e.getProvider("auth-internal")),new L1(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC")),Hz(v1,"3.4.12",e),Hz(v1,"3.4.12","esm2017")}();var r7=jg(function e(t){return Wg(this,e),t}),i7=new Y_("angularfire2.firestore-instances");function a7(e){return function(t,n){var r=t.runOutsideAngular(function(){return e(n)});return new r7(r)}}var o7={provide:jg(function e(){return Wg(this,e),DW("firestore")}),deps:[[new bC,i7]]},s7={provide:r7,useFactory:function(e,t){var n=NW("firestore",e,t);return n&&new r7(n)},deps:[[new bC,i7],qW]},u7=function(){var e=jg(function e(){Wg(this,e),Hz("angularfire",OW.full,"fst")});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[s7,o7]}),e}(),c7=WW(function(e,t){var n=t8(e.firestore,l8),r=s8(e),i=X8(e.converter,t);return e7(n,[E8(b8(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,U2.exists(!1))]).then(function(){return r})},!0),l7=WW(function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=XV(e),Q6("collection","path",t),e instanceof r8){var a=$1.fromString.apply($1,[t].concat(r));return J6(a),new o8(e,null,a)}if(!(e instanceof i8||e instanceof o8))throw new O1(P1.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child($1.fromString.apply($1,[t].concat(r)));return J6(o),new o8(e.firestore,null,o)},!0),h7=WW(function(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=t8(e,r8))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&C1("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=p1.MOCK_USER;else{o=wV(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new O1(P1.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new p1(u)}e._authCredentials=new x1(new I1(o,s))}},!0),f7=WW(function(e){return e7(t8(e.firestore,l8),[new J2(e._key,U2.none())])},!0),d7=WW(s8,!0),v7=WW(function(e){e=t8(e,i8);var t=t8(e.firestore,l8);return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new T1;return e.asyncQueue.enqueueAndForget(iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new U6({next:function(a){t.enqueueAndForget(function(){return Z5(e,o)});var s=a.docs.has(n);!s&&a.fromCache?i.reject(new O1(P1.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&a.fromCache&&r&&"server"===r.source?i.reject(new O1(P1.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new J5(c2(n.path),a,{includeMetadataChanges:!0,Du:!0});return q5(e,o)},i.next=3,Z6(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}(h8(t),e._key).then(function(n){return t7(t,e,n)})},!0),p7=WW(function(e){e=t8(e,a8);var t=t8(e.firestore,l8),n=h8(t),r=new J8(t);return $8(e._query),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new T1;return e.asyncQueue.enqueueAndForget(iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new U6({next:function(n){t.enqueueAndForget(function(){return Z5(e,o)}),n.fromCache&&"server"===r.source?i.reject(new O1(P1.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new J5(n,a,{includeMetadataChanges:!0,Du:!0});return q5(e,o)},i.next=3,Z6(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}(n,e._query).then(function(n){return new H8(t,r,e,n)})},!0),g7=WW(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vz();return Lz(e,"firestore").getImmediate()},!0),y7=WW(function(e){return function(e,t){if(t<=0)throw new O1(P1.INVALID_ARGUMENT,"Function ".concat("limit","() requires a positive number, but it was: ").concat(t,"."))}(0,e),new Z8("limit",e,"F")},!0),m7=WW(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=XV(e);var s={includeMetadataChanges:!1},u=0;"object"!=typeof n[u]||c8(n[u])||(s=n[u],u++);var c,l,h,f={includeMetadataChanges:s.includeMetadataChanges};if(c8(n[u])){var d=n[u];n[u]=null===(i=d.next)||void 0===i?void 0:i.bind(d),n[u+1]=null===(a=d.error)||void 0===a?void 0:a.bind(d),n[u+2]=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}if(e instanceof i8)l=t8(e.firestore,l8),h=c2(e._key.path),c={next:function(t){n[u]&&n[u](t7(l,e,t))},error:n[u+1],complete:n[u+2]};else{var v=t8(e,a8);l=t8(v.firestore,l8),h=v._query;var p=new J8(l);c={next:function(e){n[u]&&n[u](new H8(l,p,v,e))},error:n[u+1],complete:n[u+2]},$8(e._query)}return function(e,t,n,r){var i=new U6(r),a=new J5(t,i,n);return e.asyncQueue.enqueueAndForget(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=q5,t.next=3,Z6(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)}))),function(){i.Tc(),e.asyncQueue.enqueueAndForget(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Z5,t.next=3,Z6(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)})))}}(h8(l),h,f,c)},!0),k7=WW(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=U8("orderBy",e);return new j8(r,n)},!0),_7=WW(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=o._apply(e)}return e},!0),C7=WW(function(e,t,n){e=t8(e,i8);var r=t8(e.firestore,l8),i=X8(e.converter,t,n);return e7(r,[E8(b8(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,U2.none())])},!0),w7=WW(function(e,t,n){e=t8(e,i8);for(var r,i=t8(e.firestore,l8),a=b8(i),o=arguments.length,s=new Array(o>3?o-3:0),u=3;u<o;u++)s[u-3]=arguments[u];return r="string"==typeof(t=XV(t))||t instanceof d8?function(e,t,n,r,i,a){var o=e.aa(1,t,n),s=[x8(t,r,n)],u=[i];if(a.length%2!=0)throw new O1(P1.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)s.push(x8(t,a[c])),u.push(a[c+1]);for(var l=[],h=V0.empty(),f=s.length-1;f>=0;--f)if(!D8(l,s[f])){var d=s[f],v=u[f];v=XV(v);var p=o.ia(d);if(v instanceof S8)l.push(d);else{var g=O8(v,p);null!=g&&(l.push(d),h.set(d,g))}}var y=new h0(l);return new k8(h,y,o.fieldTransforms)}(a,"updateDoc",e._key,t,n,s):function(e,t,n,r){var i=e.aa(1,t,n);A8("Data must be an object, but it was:",i,r);var a=[],o=V0.empty();i0(r,function(e,r){var s=M8(t,e,n);r=XV(r);var u=i.ia(s);if(r instanceof S8)a.push(s);else{var c=O8(r,u);null!=c&&(a.push(s),o.set(s,c))}});var s=new h0(a);return new k8(o,s,i.fieldTransforms)}(a,"updateDoc",e._key,t),e7(i,[r.toMutation(e._key,U2.exists(!0))])},!0),b7=WW(function(e,t,n){var r=t,i=U8("where",e);return new q8(i,r,n)},!0),E7=function(){var e=function(){function e(t,n){Wg(this,e),this.collectionName=t,this.firestore=n,this.subDAOs={},this.collection=l7(n,this.collectionName).withConverter({fromFirestore:function(e){return e.data()},toFirestore:function(e){return e}})}return jg(e,[{key:"create",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c7(t.collection,e);case 2:return n.abrupt("return",n.sent.id);case 3:case"end":return n.stop()}},n)}))()}},{key:"read",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v7(d7(t.collection,e));case 2:return r=n.sent,n.abrupt("return",r.exists()?lV.of(aV.getNonNullable(r.data())):lV.empty());case 4:case"end":return n.stop()}},n)}))()}},{key:"exists",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.read(e);case 2:return n.abrupt("return",n.sent.isPresent());case 3:case"end":return n.stop()}},n)}))()}},{key:"update",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",w7(d7(n.collection,e),t));case 1:case"end":return r.stop()}},r)}))()}},{key:"delete",value:function(e){return f7(d7(this.collection,e))}},{key:"set",value:function(t,n){return oV(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),C7(d7(this.collection,t),n)}},{key:"subscribeToChanges",value:function(e,t){return m7(d7(this.collection,e),function(e){t(lV.ofNullable(e.data()))})}},{key:"findWhere",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=r.constructQuery(e,t,n),i.next=3,p7(a);case 3:return i.abrupt("return",i.sent.docs.map(function(e){return{id:e.id,data:e.data()}}));case 4:case"end":return i.stop()}},i)}))()}},{key:"observingWhere",value:function(t,n,r){var i=this,a=this.constructQuery(t,r);return m7(a,function(t){var r=[],a=[],o=[];t.docChanges().forEach(function(e){var t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":a.push(t);break;case"removed":o.push(t)}}),r.length>0&&(oV(e.VERBOSE,"firebase gave us "+r.length+" NEW "+i.collectionName),n.onDocumentCreated(r)),a.length>0&&(oV(e.VERBOSE,"firebase gave us "+a.length+" MODIFIED "+i.collectionName),n.onDocumentModified(a)),o.length>0&&(oV(e.VERBOSE,"firebase gave us "+o.length+" DELETED "+i.collectionName),n.onDocumentDeleted(o))})}},{key:"constructQuery",value:function(e,t,n){var r=_7(this.collection);null!=t&&(r=_7(r,k7(t))),null!=n&&(r=_7(r,y7(n)));var i,a=Hg(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;r=_7(r,b7(o[0],o[1],o[2]))}}catch(s){a.e(s)}finally{a.f()}return r}},{key:"subCollectionDAO",value:function(t,n){var r="".concat(this.collection.path,"/").concat(t,"/").concat(n);if(r in this.subDAOs)return this.subDAOs[r];var i=new(function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,r,e)}return jg(n)}(e))(this.firestore);return this.subDAOs[r]=i,i}}]),e}();return e.VERBOSE=!1,e}(),S7=function(){function e(){Wg(this,e)}return jg(e,[{key:"equals",value:function(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&cV(this.get(),e.get())}}],[{key:"success",value:function(e){return new P7(e)}},{key:"failure",value:function(e){return new O7(e)}}]),e}(),P7=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).value=e,r}return jg(n,[{key:"isSuccess",value:function(){return!0}},{key:"isFailure",value:function(){return!1}},{key:"get",value:function(){return this.value}},{key:"getReason",value:function(){throw new Error("Cannot get failure reason from a success")}},{key:"getReasonOr",value:function(e){return e}},{key:"toOptional",value:function(){return lV.of(this.value)}},{key:"toString",value:function(){return"MGPFallible.success(".concat(this.value,")")}}]),n}(S7),O7=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).reason=e,r}return jg(n,[{key:"isSuccess",value:function(){return!1}},{key:"isFailure",value:function(){return!0}},{key:"get",value:function(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}},{key:"getReason",value:function(){return this.reason}},{key:"getReasonOr",value:function(e){return this.getReason()}},{key:"toOptional",value:function(){return lV.empty()}},{key:"toString",value:function(){return"MGPFallible.failure(".concat(this.reason,")")}}]),n}(S7),T7=function(){function e(t){Wg(this,e),this.reason=t}return jg(e,[{key:"isFailure",value:function(){return!1===this.isSuccess()}},{key:"isSuccess",value:function(){return null==this.reason}},{key:"getReason",value:function(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}},{key:"toFallible",value:function(e){return this.isSuccess()?S7.success(e):S7.failure(this.getReason())}},{key:"toFailedFallible",value:function(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return S7.failure(this.getReason())}}],[{key:"ofFallible",value:function(t){return t.isSuccess()?e.SUCCESS:e.failure(t.getReason())}},{key:"failure",value:function(t){return new e(t)}}]),e}();T7.SUCCESS=new T7(null);var I7=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,"errors",e)}return jg(n,[{key:"findErrors",value:function(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}]),n}(E7);return e.\u0275fac=function(t){return new(t||e)(pC(r7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),A7=Tg(811),x7=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"infoMessage",value:function(e){this.message(e,"is-info")}},{key:"gameMessage",value:function(e){this.message(e,"is-warning")}},{key:"criticalMessage",value:function(e){this.message(e,"is-danger")}},{key:"message",value:function(e,t){(0,A7.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),R7=function(){function t(e,n,r){Wg(this,t),this.errorDAO=e,this.router=n,this.messageDisplayer=r,t.setSingletonInstance(this)}return jg(t,[{key:"logError",value:function(t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o,s,u,c,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i.messageDisplayer.criticalMessage($localize(e||(e=wg(["An unexpected error was encountered. We have logged it and will try to fix its cause as soon as possible."])))),o=i.router.url,a.next=4,i.errorDAO.findErrors(t,o,n,r);case 4:if(0!==(s=a.sent).length){a.next=12;break}return u={component:t,route:o,message:n,firstEncounter:n7(),lastEncounter:n7(),occurences:1},null!=r&&(u.data=r),a.next=10,i.errorDAO.create(u);case 10:a.next=15;break;case 12:return c=s[0].id,l=s[0].data,a.next=15,i.errorDAO.update(c,{lastEncounter:n7(),occurences:l.occurences+1});case 15:case"end":return a.stop()}},a)}))()}}],[{key:"setSingletonInstance",value:function(e){t.singleton=lV.of(e)}},{key:"logErrorAndFail",value:function(e,n,r){throw t.logError(e,n,r),new Error("".concat(e,": ").concat(n," (extra data: ").concat(JSON.stringify(r),")"))}},{key:"logError",value:function(e,t,n){if(this.singleton.isAbsent())throw new Error("".concat(e,": ").concat(t," (extra data: ").concat(JSON.stringify(n),")"));return this.singleton.get().logError(e,t,n),T7.failure(e+": "+t)}}]),t}();function M7(e,t){if(!1===e)throw R7.logError("Assertion failure",t),new Error("Assertion failure: ".concat(t))}R7.singleton=lV.empty(),R7.\u0275fac=function(e){return new(e||R7)(pC(I7),pC(jL),pC(x7))},R7.\u0275prov=dm({token:R7,factory:R7.\u0275fac,providedIn:"root"});var N7=jg(function e(t){Wg(this,e),this.value=t});N7.HARD_DRAW=new N7(0),N7.RESIGN=new N7(1),N7.ESCAPE=new N7(2),N7.VICTORY=new N7(3),N7.TIMEOUT=new N7(4),N7.UNACHIEVED=new N7(5),N7.AGREED_DRAW_BY_ZERO=new N7(6),N7.AGREED_DRAW_BY_ONE=new N7(7);var D7=function(){function e(t,n){Wg(this,e),this.id=t,this.data=n}return jg(e,[{key:"getTurn",value:function(){return this.data.turn}},{key:"isHardDraw",value:function(){return this.data.result===N7.HARD_DRAW.value}},{key:"isAgreedDraw",value:function(){return this.data.result===N7.AGREED_DRAW_BY_ZERO.value||this.data.result===N7.AGREED_DRAW_BY_ONE.value}},{key:"getDrawAccepter",value:function(){return this.data.result===N7.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(M7(this.data.result===N7.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),aV.getNonNullable(this.data.playerOne))}},{key:"isWin",value:function(){return this.data.result===N7.VICTORY.value}},{key:"isTimeout",value:function(){return this.data.result===N7.TIMEOUT.value}},{key:"isResign",value:function(){return this.data.result===N7.RESIGN.value}},{key:"getWinner",value:function(){return lV.ofNullable(this.data.winner)}},{key:"getLoser",value:function(){return lV.ofNullable(this.data.loser)}},{key:"setWinnerAndLoser",value:function(t,n){return new e(this.id,Eg(Eg({},this.data),{},{winner:t,loser:n}))}}]),e}(),L7=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),r=t.call(this,"parties",e),oV(n.VERBOSE,"PartDAO.constructor"),r}return jg(n,[{key:"updateAndBumpIndex",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(r=Eg(Eg({},r),{},{lastUpdate:{index:n+1,player:t.value}}),i.update(e,r)));case 1:case"end":return a.stop()}},a)}))()}},{key:"observeActiveParts",value:function(e){return this.observingWhere([["result","==",N7.UNACHIEVED.value]],e)}},{key:"userHasActivePart",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.findWhere([["playerZero","==",e],["result","==",N7.UNACHIEVED.value]]);case 2:return r=n.sent,n.next=5,t.findWhere([["playerOne","==",e],["result","==",N7.UNACHIEVED.value]]);case 5:return i=n.sent,n.abrupt("return",r.length>0||i.length>0);case 7:case"end":return n.stop()}},n)}))()}}]),n}(E7);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(r7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),F7=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),r=t.call(this,"chats",e),oV(n.VERBOSE,"ChatDAO.constructor"),r}return jg(n,[{key:"addMessage",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",n.subCollectionDAO(e,"messages").create(t));case 1:case"end":return r.stop()}},r)}))()}},{key:"getLastMessages",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",n.subCollectionDAO(e,"messages").findWhere([],"postedTime",t));case 1:case"end":return r.stop()}},r)}))()}},{key:"subscribeToMessages",value:function(e,t){return this.subCollectionDAO(e,"messages").observingWhere([],t,"postedTime")}}]),n}(E7);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(r7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),U7=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_SEND_MESSAGE=function(){return $localize(t||(t=wg(["You're not allowed to send a message here."])))},e.FORBIDDEN_MESSAGE=function(){return $localize(n||(n=wg(["This message is forbidden."])))},e}(),B7=function(){var e=function(){function e(t){Wg(this,e),this.chatDAO=t,this.followedChatId=lV.empty(),oV(e.VERBOSE,"ChatService.constructor")}return jg(e,[{key:"startObserving",value:function(t,n){oV(e.VERBOSE,"ChatService.startObserving "+t),this.followedChatId.isAbsent()?(oV(e.VERBOSE,"[start watching chat "+t),this.followedChatId=lV.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToMessages(t,n)):this.followedChatId.equalsValue(t)?R7.logErrorAndFail("ChatService","Already observing same chat",{chatId:t}):R7.logErrorAndFail("ChatService","Already observing another chat",{chatId:t,followedChatId:this.followedChatId.get()})}},{key:"stopObserving",value:function(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");oV(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=lV.empty(),this.followedChatUnsubscribe()}},{key:"isObserving",value:function(){return this.followedChatId.isPresent()}},{key:"deleteChat",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(oV(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)));case 1:case"end":return r.stop()}},r)}))()}},{key:"createNewChat",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.chatDAO.set(e,{}));case 1:case"end":return n.stop()}},n)}))()}},{key:"sendMessage",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.followedChatId.isAbsent()){i.next=2;break}return i.abrupt("return",T7.failure("Cannot send message if not observing chat"));case 2:if(a=r.followedChatId.get(),!1!==r.userCanSendMessage(e.name,a)){i.next=5;break}return i.abrupt("return",T7.failure(U7.CANNOT_SEND_MESSAGE()));case 5:if(!r.isForbiddenMessage(t)){i.next=7;break}return i.abrupt("return",T7.failure(U7.FORBIDDEN_MESSAGE()));case 7:return o={content:t,sender:e,postedTime:n7(),currentTurn:n},i.next=10,r.chatDAO.addMessage(a,o);case 10:return i.abrupt("return",T7.SUCCESS);case 11:case"end":return i.stop()}},i)}))()}},{key:"userCanSendMessage",value:function(e,t){return""!==e}},{key:"isForbiddenMessage",value:function(e){return""===e}},{key:"ngOnDestroy",value:function(){this.isObserving()&&this.stopObserving()}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(F7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),V7=jg(function e(t,n,r){Wg(this,e),this.onDocumentCreated=t,this.onDocumentModified=n,this.onDocumentDeleted=r}),z7=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),r=t.call(this,n.COLLECTION_NAME,e),oV(n.VERBOSE,"UserDAO.constructor"),r}return jg(n,[{key:"usernameIsAvailable",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.findWhere([["username","==",e]]);case 2:return n.t0=n.sent.length,n.abrupt("return",0===n.t0);case 4:case"end":return n.stop()}},n)}))()}},{key:"setUsername",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.update(e,{username:t});case 2:case"end":return r.stop()}},r)}))()}},{key:"markVerified",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.update(e,{verified:!0});case 2:case"end":return n.stop()}},n)}))()}},{key:"observeUserByUsername",value:function(e,t){return this.observingWhere([["username","==",e]],t)}},{key:"observeActiveUsers",value:function(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}},{key:"updatePresenceToken",value:function(e){return this.update(e,{last_changed:n7()})}}]),n}(E7);return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(pC(r7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),H7=function(){var e=function(){function e(t){Wg(this,e),this.userDAO=t,this.activeUsersBS=new tN([]),this.activeUsersObs=this.activeUsersBS.asObservable()}return jg(e,[{key:"startObserving",value:function(){var t=this;oV(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");var n=new V7(function(n){var r;oV(e.VERBOSE,"our DAO gave us "+n.length+" new user(s)");var i=(r=t.activeUsersBS.value).concat.apply(r,Vg(n));t.activeUsersBS.next(t.sort(i))},function(n){var r=t.activeUsersBS.value;oV(e.VERBOSE,"our DAO updated "+n.length+" user(s)");var i,a=Hg(n);try{var o=function(){var e=i.value;r.forEach(function(t){t.id===e.id&&(t.data=e.data)}),r=t.sort(r)};for(a.s();!(i=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}t.activeUsersBS.next(r)},function(e){var n=t.activeUsersBS.value.filter(function(t){return!e.some(function(e){return e.id===t.id})});t.activeUsersBS.next(t.sort(n))});this.unsubscribe=this.userDAO.observeActiveUsers(n)}},{key:"stopObserving",value:function(){this.unsubscribe(),this.activeUsersBS.next([])}},{key:"sort",value:function(e){return e.sort(function(e,t){var n=aV.getNonNullable(e.data).last_changed,r=aV.getNonNullable(n).seconds,i=aV.getNonNullable(t.data).last_changed;return r-aV.getNonNullable(i).seconds})}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(z7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),G7=function(){var e=function(){function e(t,n){Wg(this,e),this.activeUsersService=t,this.userDAO=n}return jg(e,[{key:"getActiveUsersObs",value:function(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}},{key:"unSubFromActiveUsersObs",value:function(){this.activeUsersService.stopObserving()}},{key:"observeUserByUsername",value:function(e,t){return this.userDAO.observeUserByUsername(e,t)}},{key:"observeUser",value:function(e,t){return this.userDAO.subscribeToChanges(e,t)}},{key:"getUserLastChanged",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.userDAO.read(e);case 2:if(!(r=n.sent).isAbsent()){n.next=5;break}return n.abrupt("return",lV.empty());case 5:return i=r.get().last_changed,n.abrupt("return",(M7(null!=i,"should not receive a last_changed equal to null"),lV.of(i)));case 7:case"end":return n.stop()}},n)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(H7),pC(z7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),$7=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wW;return Wg(this,n),(e=t.call(this))._bufferSize=r,e._windowTime=i,e._timestampProvider=a,e._buffer=[],e._infiniteTimeWindow=!0,e._infiniteTimeWindow=i===1/0,e._bufferSize=Math.max(1,r),e._windowTime=Math.max(1,i),e}return jg(n,[{key:"next",value:function(e){var t=this.isStopped,r=this._buffer,i=this._infiniteTimeWindow,a=this._timestampProvider,o=this._windowTime;t||(r.push(e),!i&&r.push(a.now()+o)),this._trimBuffer(),xg(Bg(n.prototype),"next",this).call(this,e)}},{key:"_subscribe",value:function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t}},{key:"_trimBuffer",value:function(){var e=this._bufferSize,t=this._timestampProvider,n=this._buffer,r=this._infiniteTimeWindow,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){for(var a=t.now(),o=0,s=1;s<n.length&&n[s]<=a;s+=2)o=s;o&&n.splice(0,o+1)}}}]),n}(_y),W7="@firebase/database",q7="",j7=function(){function e(t){Wg(this,e),this.domStorage_=t,this.prefix_="firebase:"}return jg(e,[{key:"set",value:function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),DV(t))}},{key:"get",value:function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:NV(t)}},{key:"remove",value:function(e){this.domStorage_.removeItem(this.prefixedName_(e))}},{key:"prefixedName_",value:function(e){return this.prefix_+e}},{key:"toString",value:function(){return this.domStorage_.toString()}}]),e}(),Z7=function(){function e(){Wg(this,e),this.cache_={},this.isInMemoryStorage=!0}return jg(e,[{key:"set",value:function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}},{key:"get",value:function(e){return FV(this.cache_,e)?this.cache_[e]:null}},{key:"remove",value:function(e){delete this.cache_[e]}}]),e}(),Y7=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new j7(t)}}catch(n){}return new Z7},K7=Y7("localStorage"),Q7=Y7("sessionStorage"),X7=new hz("@firebase/database"),J7=function(){var e=1;return function(){return e++}}(),e9=function(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,hV(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new qV;n.update(t);var r=n.digest();return vV.encodeByteArray(r)},t9=function e(){for(var t="",n=0;n<arguments.length;n++){var r=n<0||arguments.length<=n?void 0:arguments[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=e.apply(null,r):t+="object"==typeof r?DV(r):r,t+=" "}return t},n9=null,r9=!0,i9=function(){if(!0===r9&&(r9=!1,null===n9&&!0===Q7.get("logging_enabled")&&(hV(!0,"Can't turn on custom loggers persistently."),X7.logLevel=oz.VERBOSE,n9=X7.log.bind(X7))),n9){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t9.apply(null,t);n9(r)}},a9=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i9.apply(void 0,[e].concat(n))}},o9=function(){var e="FIREBASE INTERNAL ERROR: "+t9.apply(void 0,arguments);X7.error(e)},s9=function(){var e="FIREBASE FATAL ERROR: ".concat(t9.apply(void 0,arguments));throw X7.error(e),new Error(e)},u9=function(){var e="FIREBASE WARNING: "+t9.apply(void 0,arguments);X7.warn(e)},c9=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},l9="[MIN_NAME]",h9="[MAX_NAME]",f9=function(e,t){if(e===t)return 0;if(e===l9||t===h9)return-1;if(t===l9||e===h9)return 1;var n=_9(e),r=_9(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},d9=function(e,t){return e===t?0:e<t?-1:1},v9=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+DV(t))},p9=function e(t){if("object"!=typeof t||null===t)return DV(t);var n=[];for(var r in t)n.push(r);n.sort();for(var i="{",a=0;a<n.length;a++)0!==a&&(i+=","),i+=DV(n[a]),i+=":",i+=e(t[n[a]]);return i+="}"},g9=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function y9(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var m9=function(e){hV(!c9(e),"Invalid JSON number");var t,n,r,i,a,o=1023;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,1-o)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),o))+o,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var s=[];for(a=52;a;a-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var u=s.join(""),c="";for(a=0;a<64;a+=8){var l=parseInt(u.substr(a,8),2).toString(16);1===l.length&&(l="0"+l),c+=l}return c.toLowerCase()},k9=new RegExp("^-?(0*)\\d{1,10}$"),_9=function(e){if(k9.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},C9=function(e){try{e()}catch(t){setTimeout(function(){throw u9("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},w9=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},b9=function(){function e(t,n){var r=this;Wg(this,e),this.appName_=t,this.appCheckProvider=n,this.appCheck=null==n?void 0:n.getImmediate({optional:!0}),this.appCheck||null==n||n.get().then(function(e){return r.appCheck=e})}return jg(e,[{key:"getToken",value:function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise(function(n,r){setTimeout(function(){t.appCheck?t.getToken(e).then(n,r):n(null)},0)})}},{key:"addTokenChangeListener",value:function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(function(t){return t.addTokenListener(e)})}},{key:"notifyForInvalidToken",value:function(){u9('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" are invalid. This usually indicates your app was not initialized correctly.'))}}]),e}(),E9=function(){function e(t,n,r){var i=this;Wg(this,e),this.appName_=t,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(function(e){return i.auth_=e})}return jg(e,[{key:"getToken",value:function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(i9("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):new Promise(function(n,r){setTimeout(function(){t.auth_?t.getToken(e).then(n,r):n(null)},0)})}},{key:"addTokenChangeListener",value:function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)})}},{key:"removeTokenChangeListener",value:function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})}},{key:"notifyForInvalidToken",value:function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',u9(e)}}]),e}(),S9=function(){var e=function(){function e(t){Wg(this,e),this.accessToken=t}return jg(e,[{key:"getToken",value:function(e){return Promise.resolve({accessToken:this.accessToken})}},{key:"addTokenChangeListener",value:function(e){e(this.accessToken)}},{key:"removeTokenChangeListener",value:function(e){}},{key:"notifyForInvalidToken",value:function(){}}]),e}();return e.OWNER="owner",e}(),P9=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,O9="long_polling",T9=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Wg(this,e),this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=K7.get("host:"+t)||this._host}return jg(e,[{key:"isCacheableHost",value:function(){return"s-"===this.internalHost.substr(0,2)}},{key:"isCustomHost",value:function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}},{key:"host",get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&K7.set("host:"+this._host,this.internalHost))}},{key:"toString",value:function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}},{key:"toURLString",value:function(){return"".concat(this.secure?"https://":"http://").concat(this.host,"/").concat(this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"")}}]),e}();function I9(e,t,n){var r;if(hV("string"==typeof t,"typeof type must == string"),hV("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==O9)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return y9(n,function(e,t){i.push(e+"="+t)}),r+i.join("&")}var A9=function(){function e(){Wg(this,e),this.counters_={}}return jg(e,[{key:"incrementCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;FV(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}},{key:"get",value:function(){return mV(this.counters_)}}]),e}(),x9={},R9={};function M9(e){var t=e.toString();return x9[t]||(x9[t]=new A9),x9[t]}var N9=function(){function e(t){Wg(this,e),this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return jg(e,[{key:"closeAfter",value:function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}},{key:"handleResponse",value:function(e,t){var n=this,r=function(){var e=n.pendingResponses[n.currentResponseNum];delete n.pendingResponses[n.currentResponseNum];for(var t=function(t){e[t]&&C9(function(){n.onMessage_(e[t])})},r=0;r<e.length;++r)t(r);if(n.currentResponseNum===n.closeAfterResponse)return n.onClose&&(n.onClose(),n.onClose=null),"break";n.currentResponseNum++};for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}}}]),e}(),D9=function(){function e(t,n,r,i,a,o,s){var u=this;Wg(this,e),this.connId=t,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=a9(t),this.stats_=M9(n),this.urlFn=function(e){return u.appCheckToken&&(e.ac=u.appCheckToken),I9(n,O9,e)}}return jg(e,[{key:"open",value:function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new N9(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{var t=!1,n=function n(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new L9(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1],o=t[2];t[3],t[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=a,n.password=o;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,a)},function(){n.onClosed_()},n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&P9.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,function(){})}})}},{key:"start",value:function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}},{key:"markConnectionHealthy",value:function(){}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}},{key:"send",value:function(e){var t=DV(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=pV(t),r=g9(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}},{key:"addDisconnectPingFrame",value:function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},{key:"incrementIncomingBytes_",value:function(e){var t=DV(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}],[{key:"forceAllow",value:function(){e.forceAllow_=!0}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){return!(!e.forceAllow_&&(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}}]),e}(),L9=function(){function e(t,n,r,i){Wg(this,e),this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=J7(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var a="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(a='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(s){i9("frame writing exception"),s.stack&&i9(s.stack),i9(s)}}return jg(e,[{key:"close",value:function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())}},{key:"startLongPoll",value:function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}},{key:"newRequest_",value:function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}},{key:"enqueueSegment",value:function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}},{key:"addLongPollTag_",value:function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,function(){clearTimeout(i),r()})}},{key:"addTag",value:function(e,t){var n=this;setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;(!e||"loaded"===e||"complete"===e)&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){i9("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))}}],[{key:"createIFrame_",value:function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||i9("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}}]),e}(),F9=null;"undefined"!=typeof MozWebSocket?F9=MozWebSocket:"undefined"!=typeof WebSocket&&(F9=WebSocket);var U9=function(){var e=function(){function e(t,n,r,i,a,o,s){Wg(this,e),this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=a9(this.connId),this.stats_=M9(n),this.connURL=e.connectionURL_(n,o,s,i,r),this.nodeAdmin=n.nodeAdmin}return jg(e,[{key:"open",value:function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,K7.set("previous_websocket_failure",!0);try{var r;this.mySock=new F9(this.connURL,[],undefined)}catch(r){this.log_("Error instantiating WebSocket.");var i=r.message||r.data;return i&&this.log_(i),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}}},{key:"start",value:function(){}},{key:"markConnectionHealthy",value:function(){K7.remove("previous_websocket_failure")}},{key:"appendFrame_",value:function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=NV(t);this.onMessage(n)}}},{key:"handleNewFrameCount_",value:function(e){this.totalFrames=e,this.frames=[]}},{key:"extractFrameCount_",value:function(e){if(hV(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}},{key:"handleIncomingFrame",value:function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}}},{key:"send",value:function(e){this.resetKeepAlive();var t=DV(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=g9(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}},{key:"resetKeepAlive",value:function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))}},{key:"sendString_",value:function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}],[{key:"connectionURL_",value:function(e,t,n,r,i){var a={v:"5"};return"undefined"!=typeof location&&location.hostname&&P9.test(location.hostname)&&(a.r="f"),t&&(a.s=t),n&&(a.ls=n),r&&(a.ac=r),i&&(a.p=i),I9(e,"websocket",a)}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==F9&&!e.forceDisallow_}},{key:"previouslyFailed",value:function(){return K7.isInMemoryStorage||!0===K7.get("previous_websocket_failure")}}]),e}();return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),B9=function(){var e=function(){function e(t){Wg(this,e),this.initTransports_(t)}return jg(e,[{key:"initTransports_",value:function(t){var n=U9&&U9.isAvailable(),r=n&&!U9.previouslyFailed();if(t.webSocketOnly&&(n||u9("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[U9];else{var i,a=this.transports_=[],o=Hg(e.ALL_TRANSPORTS);try{for(o.s();!(i=o.n()).done;){var s=i.value;s&&s.isAvailable()&&a.push(s)}}catch(u){o.e(u)}finally{o.f()}e.globalTransportInitialized_=!0}}},{key:"initialTransport",value:function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}},{key:"upgradeTransport",value:function(){return this.transports_.length>1?this.transports_[1]:null}}],[{key:"ALL_TRANSPORTS",get:function(){return[D9,U9]}},{key:"IS_TRANSPORT_INITIALIZED",get:function(){return this.globalTransportInitialized_}}]),e}();return e.globalTransportInitialized_=!1,e}(),V9=function(){function e(t,n,r,i,a,o,s,u,c,l){Wg(this,e),this.id=t,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=a9("c:"+this.id+":"),this.transportManager_=new B9(n),this.log_("Connection created"),this.start_()}return jg(e,[{key:"start_",value:function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=w9(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))}},{key:"nextTransportId_",value:function(){return"c:"+this.id+":"+this.connectionCount++}},{key:"disconnReceiver_",value:function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}}},{key:"connReceiver_",value:function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}}},{key:"sendRequest",value:function(e){this.sendData_({t:"d",d:e})}},{key:"tryCleanupConnection",value:function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}},{key:"onSecondaryControl_",value:function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}},{key:"onSecondaryMessageReceived_",value:function(e){var t=v9("t",e),n=v9("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}},{key:"upgradeIfSecondaryHealthy_",value:function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}},{key:"proceedWithUpgrade_",value:function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}},{key:"onPrimaryMessageReceived_",value:function(e){var t=v9("t",e),n=v9("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}},{key:"onDataMessage_",value:function(e){this.onPrimaryResponse_(),this.onMessage_(e)}},{key:"onPrimaryResponse_",value:function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}},{key:"onControl_",value:function(e){var t=v9("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?o9("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):o9("Unknown control packet command: "+t)}}},{key:"onHandshake_",value:function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&u9("Protocol version mismatch detected"),this.tryStartUpgrade_())}},{key:"tryStartUpgrade_",value:function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}},{key:"startUpgrade_",value:function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),w9(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))}},{key:"onReset_",value:function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}},{key:"onConnectionEstablished_",value:function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):w9(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}},{key:"sendPingOnPrimaryIfNecessary_",value:function(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}},{key:"onSecondaryConnectionLost_",value:function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}},{key:"onConnectionLost_",value:function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(K7.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}},{key:"onConnectionShutdown_",value:function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}},{key:"sendData_",value:function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}},{key:"close",value:function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}},{key:"closeConnections_",value:function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}]),e}(),z9=function(){function e(){Wg(this,e)}return jg(e,[{key:"put",value:function(e,t,n,r){}},{key:"merge",value:function(e,t,n,r){}},{key:"refreshAuthToken",value:function(e){}},{key:"refreshAppCheckToken",value:function(e){}},{key:"onDisconnectPut",value:function(e,t,n){}},{key:"onDisconnectMerge",value:function(e,t,n){}},{key:"onDisconnectCancel",value:function(e,t){}},{key:"reportStats",value:function(e){}}]),e}(),H9=function(){function e(t){Wg(this,e),this.allowedEvents_=t,this.listeners_={},hV(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return jg(e,[{key:"trigger",value:function(e){if(Array.isArray(this.listeners_[e])){for(var t=Vg(this.listeners_[e]),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(t[a].context,r)}}},{key:"on",value:function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}},{key:"off",value:function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}},{key:"validateEventType_",value:function(e){hV(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)}}]),e}(),G9=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this,["online"])).online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!EV()&&(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return jg(n,[{key:"getInitialEvent",value:function(e){return hV("online"===e,"Unknown event type: "+e),[this.online_]}},{key:"currentlyOnline",value:function(){return this.online_}}],[{key:"getInstance",value:function(){return new n}}]),n}(H9),$9=function(){function e(t,n){if(Wg(this,e),void 0===n){this.pieces_=t.split("/");for(var r=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}return jg(e,[{key:"toString",value:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}]),e}();function W9(){return new $9("")}function q9(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function j9(e){return e.pieces_.length-e.pieceNum_}function Z9(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new $9(e.pieces_,t)}function Y9(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function K9(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function Q9(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new $9(t,0)}function X9(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof $9)for(var i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else for(var a=t.split("/"),o=0;o<a.length;o++)a[o].length>0&&n.push(a[o]);return new $9(n,0)}function J9(e){return e.pieceNum_>=e.pieces_.length}function eee(e,t){var n=q9(e),r=q9(t);if(null===n)return t;if(n===r)return eee(Z9(e),Z9(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function tee(e,t){for(var n=K9(e,0),r=K9(t,0),i=0;i<n.length&&i<r.length;i++){var a=f9(n[i],r[i]);if(0!==a)return a}return n.length===r.length?0:n.length<r.length?-1:1}function nee(e,t){if(j9(e)!==j9(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ree(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(j9(e)>j9(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var iee=jg(function e(t,n){Wg(this,e),this.errorPrefix_=n,this.parts_=K9(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=KV(this.parts_[r]);aee(this)});function aee(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+oee(e))}function oee(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var see,uee,cee=function(e){Mg(n,e);var t=Dg(n);function n(){var e,r,i;return Wg(this,n),e=t.call(this,["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(i="visibilitychange",r="hidden"):void 0!==document.mozHidden?(i="mozvisibilitychange",r="mozHidden"):void 0!==document.msHidden?(i="msvisibilitychange",r="msHidden"):void 0!==document.webkitHidden&&(i="webkitvisibilitychange",r="webkitHidden")),e.visible_=!0,i&&document.addEventListener(i,function(){var t=!document[r];t!==e.visible_&&(e.visible_=t,e.trigger("visible",t))},!1),e}return jg(n,[{key:"getInitialEvent",value:function(e){return hV("visible"===e,"Unknown event type: "+e),[this.visible_]}}],[{key:"getInstance",value:function(){return new n}}]),n}(H9),lee=1e3,hee=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s,u,c){var l;if(Wg(this,n),(l=t.call(this)).repoInfo_=e,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=a,l.onServerInfoUpdate_=o,l.authTokenProvider_=s,l.appCheckTokenProvider_=u,l.authOverride_=c,l.id=n.nextPersistentConnectionId_++,l.log_=a9("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=lee,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.appCheckToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.invalidAppCheckTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return cee.getInstance().on("visible",l.onVisible_,Fg(l)),-1===e.host.indexOf("fblocal")&&G9.getInstance().on("online",l.onOnline_,Fg(l)),Lg(l)}return jg(n,[{key:"sendRequest",value:function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(DV(i)),hV(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}},{key:"get",value:function(e){this.initConnection_();var t=new CV,n={p:e._path.toString(),q:e._queryObject};return this.outstandingGets_.push({action:"g",request:n,onComplete:function(e){var n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),t.promise}},{key:"listen",value:function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+i),this.listens.has(a)||this.listens.set(a,new Map),hV(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),hV(!this.listens.get(a).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(i,o),this.connected_&&this.sendListen_(o)}},{key:"sendGet_",value:function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}},{key:"sendListen_",value:function(e){var t=this,r=e.query,i=r._path.toString(),a=r._queryIdentifier;this.log_("Listen on "+i+" for "+a);var o={p:i};e.tag&&(o.q=r._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,function(o){var s=o.d,u=o.s;n.warnOnListenWarnings_(s,r),(t.listens.get(i)&&t.listens.get(i).get(a))===e&&(t.log_("listen response",o),"ok"!==u&&t.removeListen_(i,a),e.onComplete&&e.onComplete(u,s))})}},{key:"refreshAuthToken",value:function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)}},{key:"reduceReconnectDelayIfAdminCredential_",value:function(e){(e&&40===e.length||function(e){var t=LV(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}},{key:"refreshAppCheckToken",value:function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})}},{key:"tryAuth",value:function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=function(e){var t=LV(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}}},{key:"tryAppCheck",value:function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)})}},{key:"unlisten",value:function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),hV(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}},{key:"sendUnlisten_",value:function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}},{key:"onDisconnectPut",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}},{key:"onDisconnectMerge",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}},{key:"onDisconnectCancel",value:function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}},{key:"sendOnDisconnect_",value:function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})}},{key:"put",value:function(e,t,n,r){this.putInternal("p",e,t,n,r)}},{key:"merge",value:function(e,t,n,r){this.putInternal("m",e,t,n,r)}},{key:"putInternal",value:function(e,t,n,r,i){this.initConnection_();var a={p:t,d:n};void 0!==i&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}},{key:"sendPut_",value:function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})}},{key:"reportStats",value:function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){"ok"!==e.s&&t.log_("reportStats","Error sending stats: "+e.d)})}}},{key:"onDataMessage_",value:function(e){if("r"in e){this.log_("from server: "+DV(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}},{key:"onDataPush_",value:function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):o9("Unrecognized action received from server: "+DV(e)+"\nAre you using the latest client?")}},{key:"onReady_",value:function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}},{key:"scheduleConnect_",value:function(e){var t=this;hV(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))}},{key:"initConnection_",value:function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}},{key:"onVisible_",value:function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=lee,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}},{key:"onOnline_",value:function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=lee,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}},{key:"onRealtimeDisconnect_",value:function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=lee),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}},{key:"establishConnection_",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var r,i,a,o,s,u,c,l,h,f,d,v,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.shouldReconnect_()){t.next=21;break}return e.log_("Making a connection attempt"),e.lastConnectionAttemptTime_=(new Date).getTime(),e.lastConnectionEstablishedTime_=null,r=e.onDataMessage_.bind(e),i=e.onReady_.bind(e),a=e.onRealtimeDisconnect_.bind(e),o=e.id+":"+n.nextConnectionId_++,s=e.lastSessionId,u=!1,c=null,l=function(){c?c.close():(u=!0,a())},e.realtime_={close:l,sendRequest:function(e){hV(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}},h=e.forceTokenRefresh_,e.forceTokenRefresh_=!1,t.prev=8,t.next=11,Promise.all([e.authTokenProvider_.getToken(h),e.appCheckTokenProvider_.getToken(h)]);case 11:f=t.sent,d=Pg(f,2),v=d[0],p=d[1],u?i9("getToken() completed but was canceled"):(i9("getToken() completed. Creating connection."),e.authToken_=v&&v.accessToken,e.appCheckToken_=p&&p.token,c=new V9(o,e.repoInfo_,e.applicationId_,e.appCheckToken_,e.authToken_,r,i,a,function(t){u9(t+" ("+e.repoInfo_.toString()+")"),e.interrupt("server_kill")},s)),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(8),e.log_("Failed to get token: "+t.t0),u||(e.repoInfo_.nodeAdmin&&u9(t.t0),l());case 21:case"end":return t.stop()}},t,null,[[8,18]])}))()}},{key:"interrupt",value:function(e){i9("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}},{key:"resume",value:function(e){i9("Resuming connection for reason: "+e),delete this.interruptReasons_[e],BV(this.interruptReasons_)&&(this.reconnectDelay_=lee,this.realtime_||this.scheduleConnect_(0))}},{key:"handleTimestamp_",value:function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}},{key:"cancelSentTransactions_",value:function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}},{key:"onListenRevoked_",value:function(e,t){var n;n=t?t.map(function(e){return p9(e)}).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}},{key:"removeListen_",value:function(e,t){var n,r=new $9(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n}},{key:"onAuthRevoked_",value:function(e,t){i9("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}},{key:"onAppCheckRevoked_",value:function(e,t){i9("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}},{key:"onSecurityDebugPacket_",value:function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}},{key:"restoreState_",value:function(){this.tryAuth(),this.tryAppCheck();var e,t=Hg(this.listens.values());try{for(t.s();!(e=t.n()).done;){var n,r=Hg(e.value.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;this.sendListen_(i)}}catch(u){r.e(u)}finally{r.f()}}}catch(u){t.e(u)}finally{t.f()}for(var a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){var o=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(o.action,o.pathString,o.data,o.onComplete)}for(var s=0;s<this.outstandingGets_.length;s++)this.outstandingGets_[s]&&this.sendGet_(s)}},{key:"sendConnectStats_",value:function(){var e={};e["sdk.js."+q7.replace(/\./g,"-")]=1,EV()?e["framework.cordova"]=1:PV()&&(e["framework.reactnative"]=1),this.reportStats(e)}},{key:"shouldReconnect_",value:function(){var e=G9.getInstance().currentlyOnline();return BV(this.interruptReasons_)&&e}}],[{key:"warnOnListenWarnings_",value:function(e,t){if(e&&"object"==typeof e&&FV(e,"w")){var n=UV(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();u9("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".concat(r," at ").concat(i," to your security rules for better performance."))}}}}]),n}(z9);return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(),fee=function(){function e(t,n){Wg(this,e),this.name=t,this.node=n}return jg(e,null,[{key:"Wrap",value:function(t,n){return new e(t,n)}}]),e}(),dee=function(){function e(){Wg(this,e)}return jg(e,[{key:"getCompare",value:function(){return this.compare.bind(this)}},{key:"indexedValueChanged",value:function(e,t){var n=new fee(l9,e),r=new fee(l9,t);return 0!==this.compare(n,r)}},{key:"minPost",value:function(){return fee.MIN}}]),e}(),vee=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"compare",value:function(e,t){return f9(e.name,t.name)}},{key:"isDefinedOn",value:function(e){throw fV("KeyIndex.isDefinedOn not expected to be called.")}},{key:"indexedValueChanged",value:function(e,t){return!1}},{key:"minPost",value:function(){return fee.MIN}},{key:"maxPost",value:function(){return new fee(h9,see)}},{key:"makePost",value:function(e,t){return hV("string"==typeof e,"KeyIndex indexValue must always be a string."),new fee(e,see)}},{key:"toString",value:function(){return".key"}}],[{key:"__EMPTY_NODE",get:function(){return see},set:function(e){see=e}}]),n}(dee),pee=new vee,gee=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Wg(this,e),this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return jg(e,[{key:"getNext",value:function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}},{key:"hasNext",value:function(){return this.nodeStack_.length>0}},{key:"peek",value:function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}]),e}(),yee=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:mee.EMPTY_NODE,this.right=null!=a?a:mee.EMPTY_NODE}return jg(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"count",value:function(){return this.left.count()+1+this.right.count()}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min_",value:function(){return this.left.isEmpty()?this:this.left.min_()}},{key:"minKey",value:function(){return this.min_().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}},{key:"removeMin_",value:function(){if(this.left.isEmpty())return mee.EMPTY_NODE;var e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}},{key:"remove",value:function(e,t){var n,r;if(t(e,(n=this).key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return mee.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}},{key:"isRed_",value:function(){return this.color}},{key:"fixUp_",value:function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}},{key:"moveRedLeft_",value:function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}},{key:"moveRedRight_",value:function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}},{key:"rotateLeft_",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight_",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip_",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth_",value:function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}},{key:"check_",value:function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}]),e}();return e.RED=!0,e.BLACK=!1,e}(),mee=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.EMPTY_NODE;Wg(this,e),this.comparator_=t,this.root_=n}return jg(e,[{key:"insert",value:function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,yee.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,yee.BLACK,null,null))}},{key:"get",value:function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}},{key:"getPredecessorKey",value:function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}},{key:"isEmpty",value:function(){return this.root_.isEmpty()}},{key:"count",value:function(){return this.root_.count()}},{key:"minKey",value:function(){return this.root_.minKey()}},{key:"maxKey",value:function(){return this.root_.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root_.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.root_.reverseTraversal(e)}},{key:"getIterator",value:function(e){return new gee(this.root_,null,this.comparator_,!1,e)}},{key:"getIteratorFrom",value:function(e,t){return new gee(this.root_,e,this.comparator_,!1,t)}},{key:"getReverseIteratorFrom",value:function(e,t){return new gee(this.root_,e,this.comparator_,!0,t)}},{key:"getReverseIterator",value:function(e){return new gee(this.root_,null,this.comparator_,!0,e)}}]),e}();function kee(e,t){return f9(e.name,t.name)}function _ee(e,t){return f9(e,t)}mee.EMPTY_NODE=new(function(){function e(){Wg(this,e)}return jg(e,[{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new yee(e,t,null)}},{key:"remove",value:function(e,t){return this}},{key:"count",value:function(){return 0}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"check_",value:function(){return 0}},{key:"isRed_",value:function(){return!1}}]),e}());var Cee,wee,bee,Eee,See,Pee=function(e){return"number"==typeof e?"number:"+m9(e):"string:"+e},Oee=function(e){if(e.isLeafNode()){var t=e.val();hV("string"==typeof t||"number"==typeof t||"object"==typeof t&&FV(t,".sv"),"Priority must be a string or number.")}else hV(e===uee||e.isEmpty(),"priority of unexpected type.");hV(e===uee||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Tee=function(){var e=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.__childrenNodeConstructor.EMPTY_NODE;Wg(this,e),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,hV(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Oee(this.priorityNode_)}return jg(e,[{key:"isLeafNode",value:function(){return!0}},{key:"getPriority",value:function(){return this.priorityNode_}},{key:"updatePriority",value:function(t){return new e(this.value_,t)}},{key:"getImmediateChild",value:function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"getChild",value:function(t){return J9(t)?this:".priority"===q9(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"hasChild",value:function(){return!1}},{key:"getPredecessorChildName",value:function(e,t){return null}},{key:"updateImmediateChild",value:function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}},{key:"updateChild",value:function(t,n){var r=q9(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(hV(".priority"!==r||1===j9(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(Z9(t),n)))}},{key:"isEmpty",value:function(){return!1}},{key:"numChildren",value:function(){return 0}},{key:"forEachChild",value:function(e,t){return!1}},{key:"val",value:function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Pee(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?m9(this.value_):this.value_,this.lazyHash_=e9(e)}return this.lazyHash_}},{key:"getValue",value:function(){return this.value_}},{key:"compareTo",value:function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(hV(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}},{key:"compareToLeafNode_",value:function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),a=e.VALUE_TYPE_ORDER.indexOf(r);return hV(i>=0,"Unknown leaf type: "+n),hV(a>=0,"Unknown leaf type: "+r),i===a?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-i}},{key:"withIndex",value:function(){return this}},{key:"isIndexed",value:function(){return!0}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}],[{key:"__childrenNodeConstructor",get:function(){return Cee},set:function(e){Cee=e}}]),e}();return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}(),Iee=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"compare",value:function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?f9(e.name,t.name):i}},{key:"isDefinedOn",value:function(e){return!e.getPriority().isEmpty()}},{key:"indexedValueChanged",value:function(e,t){return!e.getPriority().equals(t.getPriority())}},{key:"minPost",value:function(){return fee.MIN}},{key:"maxPost",value:function(){return new fee(h9,new Tee("[PRIORITY-POST]",bee))}},{key:"makePost",value:function(e,t){var n=wee(e);return new fee(t,new Tee("[PRIORITY-POST]",n))}},{key:"toString",value:function(){return".priority"}}]),n}(dee)),Aee=Math.log(2),xee=function(){function e(t){var n=this;Wg(this,e),this.count=parseInt(Math.log(t+1)/Aee,10),this.current_=this.count-1;var r=parseInt(Array(n.count+1).join("1"),2);this.bits_=t+1&r}return jg(e,[{key:"nextBitIsOne",value:function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}]),e}(),Ree=function(e,t,n,r){e.sort(t);var i=function t(r,i){var a,o,s=i-r;if(0===s)return null;if(1===s)return a=e[r],o=n?n(a):a,new yee(o,a.node,yee.BLACK,null,null);var u=parseInt(s/2,10)+r,c=t(r,u),l=t(u+1,i);return a=e[u],o=n?n(a):a,new yee(o,a.node,yee.BLACK,c,l)},a=function(t){for(var r=null,a=null,o=e.length,s=function(t,r){var a=o-t,s=o;o-=t;var c=i(a+1,s),l=e[a],h=n?n(l):l;u(new yee(h,l.node,r,null,c))},u=function(e){r?(r.left=e,r=e):(a=e,r=e)},c=0;c<t.count;++c){var l=t.nextBitIsOne(),h=Math.pow(2,t.count-(c+1));l?s(h,yee.BLACK):(s(h,yee.BLACK),s(h,yee.RED))}return a}(new xee(e.length));return new mee(r||t,a)},Mee={},Nee=function(){function e(t,n){Wg(this,e),this.indexes_=t,this.indexSet_=n}return jg(e,[{key:"get",value:function(e){var t=UV(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof mee?t:null}},{key:"hasIndex",value:function(e){return FV(this.indexSet_,e.toString())}},{key:"addIndex",value:function(t,n){hV(t!==pee,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],a=!1,o=n.getIterator(fee.Wrap),s=o.getNext();s;)a=a||t.isDefinedOn(s.node),i.push(s),s=o.getNext();r=a?Ree(i,t.getCompare()):Mee;var u=t.toString(),c=Object.assign({},this.indexSet_);c[u]=t;var l=Object.assign({},this.indexes_);return l[u]=r,new e(l,c)}},{key:"addToIndexes",value:function(t,n){var r=this;return new e(VV(this.indexes_,function(e,i){var a=UV(r.indexSet_,i);if(hV(a,"Missing index implementation for "+i),e===Mee){if(a.isDefinedOn(t.node)){for(var o=[],s=n.getIterator(fee.Wrap),u=s.getNext();u;)u.name!==t.name&&o.push(u),u=s.getNext();return o.push(t),Ree(o,a.getCompare())}return Mee}var c=n.get(t.name),l=e;return c&&(l=l.remove(new fee(t.name,c))),l.insert(t,t.node)}),this.indexSet_)}},{key:"removeFromIndexes",value:function(t,n){return new e(VV(this.indexes_,function(e){if(e===Mee)return e;var r=n.get(t.name);return r?e.remove(new fee(t.name,r)):e}),this.indexSet_)}}],[{key:"Default",get:function(){return hV(Mee&&Iee,"ChildrenNode.ts has not been loaded"),Eee=Eee||new e({".priority":Mee},{".priority":Iee})}}]),e}(),Dee=function(){var e=function(){function e(t,n,r){Wg(this,e),this.children_=t,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Oee(this.priorityNode_),this.children_.isEmpty()&&hV(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return jg(e,[{key:"isLeafNode",value:function(){return!1}},{key:"getPriority",value:function(){return this.priorityNode_||See}},{key:"updatePriority",value:function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}},{key:"getImmediateChild",value:function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?See:t}},{key:"getChild",value:function(e){var t=q9(e);return null===t?this:this.getImmediateChild(t).getChild(Z9(e))}},{key:"hasChild",value:function(e){return null!==this.children_.get(e)}},{key:"updateImmediateChild",value:function(t,n){if(hV(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r,i,a=new fee(t,n);n.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(a,this.children_)):(r=this.children_.insert(t,n),i=this.indexMap_.addToIndexes(a,this.children_));var o=r.isEmpty()?See:this.priorityNode_;return new e(r,o,i)}},{key:"updateChild",value:function(e,t){var n=q9(e);if(null===n)return t;hV(".priority"!==q9(e)||1===j9(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(Z9(e),t);return this.updateImmediateChild(n,r)}},{key:"isEmpty",value:function(){return this.children_.isEmpty()}},{key:"numChildren",value:function(){return this.children_.count()}},{key:"val",value:function(t){if(this.isEmpty())return null;var n={},r=0,i=0,a=!0;if(this.forEachChild(Iee,function(o,s){n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1}),!t&&a&&i<2*r){var o=[];for(var s in n)o[s]=n[s];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Pee(this.getPriority().val())+":"),this.forEachChild(Iee,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":e9(e)}return this.lazyHash_}},{key:"getPredecessorChildName",value:function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new fee(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}},{key:"getFirstChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}},{key:"getFirstChild",value:function(e){var t=this.getFirstChildName(e);return t?new fee(t,this.children_.get(t)):null}},{key:"getLastChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}},{key:"getLastChild",value:function(e){var t=this.getLastChildName(e);return t?new fee(t,this.children_.get(t)):null}},{key:"forEachChild",value:function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)}},{key:"getIterator",value:function(e){return this.getIteratorFrom(e.minPost(),e)}},{key:"getIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,fee.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}},{key:"getReverseIterator",value:function(e){return this.getReverseIteratorFrom(e.maxPost(),e)}},{key:"getReverseIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,fee.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}},{key:"compareTo",value:function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Lee?-1:0}},{key:"withIndex",value:function(t){if(t===pee||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}},{key:"isIndexed",value:function(e){return e===pee||this.indexMap_.hasIndex(e)}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Iee),r=t.getIterator(Iee),i=n.getNext(),a=r.getNext();i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=n.getNext(),a=r.getNext()}return null===i&&null===a}return!1}return!1}},{key:"resolveIndex_",value:function(e){return e===pee?null:this.indexMap_.get(e.toString())}}],[{key:"EMPTY_NODE",get:function(){return See||(See=new e(new mee(_ee),null,Nee.Default))}}]),e}();return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Lee=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,new mee(_ee),Dee.EMPTY_NODE,Nee.Default)}return jg(n,[{key:"compareTo",value:function(e){return e===this?0:1}},{key:"equals",value:function(e){return e===this}},{key:"getPriority",value:function(){return this}},{key:"getImmediateChild",value:function(e){return Dee.EMPTY_NODE}},{key:"isEmpty",value:function(){return!1}}]),n}(Dee));function Fee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return Dee.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),hV(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Tee(e,Fee(t));if(e instanceof Array){var n=Dee.EMPTY_NODE;return y9(e,function(t,r){if(FV(e,t)&&"."!==t.substring(0,1)){var i=Fee(r);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(t,i))}}),n.updatePriority(Fee(t))}var r=[],i=!1;if(y9(e,function(e,t){if("."!==e.substring(0,1)){var n=Fee(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new fee(e,n)))}}),0===r.length)return Dee.EMPTY_NODE;var a=Ree(r,kee,function(e){return e.name},_ee);if(i){var o=Ree(r,Iee.getCompare());return new Dee(a,Fee(t),new Nee({".priority":o},{".priority":Iee}))}return new Dee(a,Fee(t),Nee.Default)}Object.defineProperties(fee,{MIN:{value:new fee(l9,Dee.EMPTY_NODE)},MAX:{value:new fee(h9,Lee)}}),vee.__EMPTY_NODE=Dee.EMPTY_NODE,Tee.__childrenNodeConstructor=Dee,function(e){uee=e}(Lee),function(e){bee=e}(Lee),function(e){wee=e}(Fee);var Uee=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).indexPath_=e,hV(!J9(e)&&".priority"!==q9(e),"Can't create PathIndex with empty path or .priority key"),r}return jg(n,[{key:"extractChild",value:function(e){return e.getChild(this.indexPath_)}},{key:"isDefinedOn",value:function(e){return!e.getChild(this.indexPath_).isEmpty()}},{key:"compare",value:function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?f9(e.name,t.name):i}},{key:"makePost",value:function(e,t){var n=Fee(e),r=Dee.EMPTY_NODE.updateChild(this.indexPath_,n);return new fee(t,r)}},{key:"maxPost",value:function(){var e=Dee.EMPTY_NODE.updateChild(this.indexPath_,Lee);return new fee(h9,e)}},{key:"toString",value:function(){return K9(this.indexPath_,0).join("/")}}]),n}(dee),Bee=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"compare",value:function(e,t){var n=e.node.compareTo(t.node);return 0===n?f9(e.name,t.name):n}},{key:"isDefinedOn",value:function(e){return!0}},{key:"indexedValueChanged",value:function(e,t){return!e.equals(t)}},{key:"minPost",value:function(){return fee.MIN}},{key:"maxPost",value:function(){return fee.MAX}},{key:"makePost",value:function(e,t){var n=Fee(e);return new fee(t,n)}},{key:"toString",value:function(){return".value"}}]),n}(dee));function Vee(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var zee=function(){function e(){Wg(this,e),this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Iee}return jg(e,[{key:"hasStart",value:function(){return this.startSet_}},{key:"hasStartAfter",value:function(){return this.startAfterSet_}},{key:"hasEndBefore",value:function(){return this.endBeforeSet_}},{key:"isViewFromLeft",value:function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}},{key:"getIndexStartValue",value:function(){return hV(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}},{key:"getIndexStartName",value:function(){return hV(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:l9}},{key:"hasEnd",value:function(){return this.endSet_}},{key:"getIndexEndValue",value:function(){return hV(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}},{key:"getIndexEndName",value:function(){return hV(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:h9}},{key:"hasLimit",value:function(){return this.limitSet_}},{key:"hasAnchoredLimit",value:function(){return this.limitSet_&&""!==this.viewFrom_}},{key:"getLimit",value:function(){return hV(this.limitSet_,"Only valid if limit has been set"),this.limit_}},{key:"getIndex",value:function(){return this.index_}},{key:"loadsAllData",value:function(){return!(this.startSet_||this.endSet_||this.limitSet_)}},{key:"isDefault",value:function(){return this.loadsAllData()&&this.index_===Iee}},{key:"copy",value:function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}]),e}();function Hee(e){var t,n={};return e.isDefault()||(e.index_===Iee?t="$priority":e.index_===Bee?t="$value":e.index_===pee?t="$key":(hV(e.index_ instanceof Uee,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=DV(t),e.startSet_&&(n.startAt=DV(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+DV(e.indexStartName_))),e.endSet_&&(n.endAt=DV(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+DV(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function Gee(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Iee&&(t.i=e.index_.toString()),t}var $ee=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).repoInfo_=e,o.onDataUpdate_=r,o.authTokenProvider_=i,o.appCheckTokenProvider_=a,o.log_=a9("p:rest:"),o.listens_={},o}return jg(n,[{key:"reportStats",value:function(e){throw new Error("Method not implemented.")}},{key:"listen",value:function(e,t,r,i){var a=this,o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);var s=n.getListenId_(e,r),u={};this.listens_[s]=u;var c=Hee(e._queryParams);this.restRequest_(o+".json",c,function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&a.onDataUpdate_(o,n,!1,r),UV(a.listens_,s)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}},{key:"unlisten",value:function(e,t){var r=n.getListenId_(e,t);delete this.listens_[r]}},{key:"get",value:function(e){var t=this,n=Hee(e._queryParams),r=e._path.toString(),i=new CV;return this.restRequest_(r+".json",n,function(e,n){var a=n;404===e&&(a=null,e=null),null===e?(t.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}},{key:"refreshAuthToken",value:function(e){}},{key:"restRequest_",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(i){var a=Pg(i,2),o=a[0],s=a[1];o&&o.accessToken&&(n.auth=o.accessToken),s&&s.token&&(n.ac=s.token);var u=(t.repoInfo_.secure?"https://":"http://")+t.repoInfo_.host+e+"?ns="+t.repoInfo_.namespace+GV(n);t.log_("Sending REST request for "+u);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(r&&4===c.readyState){t.log_("REST Response for "+u+" received. status:",c.status,"response:",c.responseText);var e=null;if(c.status>=200&&c.status<300){try{e=NV(c.responseText)}catch(n){u9("Failed to parse JSON response for "+u+": "+c.responseText)}r(null,e)}else 401!==c.status&&404!==c.status&&u9("Got unsuccessful REST response for "+u+" Status: "+c.status),r(c.status);r=null}},c.open("GET",u,!0),c.send()})}}],[{key:"getListenId_",value:function(e,t){return void 0!==t?"tag$"+t:(hV(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}}]),n}(z9),Wee=function(){function e(){Wg(this,e),this.rootNode_=Dee.EMPTY_NODE}return jg(e,[{key:"getNode",value:function(e){return this.rootNode_.getChild(e)}},{key:"updateSnapshot",value:function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}]),e}();function qee(){return{value:null,children:new Map}}function jee(e,t,n){if(J9(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=q9(t);e.children.has(r)||e.children.set(r,qee()),jee(e.children.get(r),t=Z9(t),n)}}function Zee(e,t){if(J9(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(Iee,function(t,n){jee(e,new $9(t),n)}),Zee(e,t)}if(e.children.size>0){var r=q9(t);return t=Z9(t),e.children.has(r)&&Zee(e.children.get(r),t)&&e.children.delete(r),0===e.children.size}return!0}function Yee(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(function(e,n){t(n,e)})}(e,function(e,r){Yee(r,new $9(t.toString()+"/"+e),n)})}var Kee=function(){function e(t){Wg(this,e),this.collection_=t,this.last_=null}return jg(e,[{key:"get",value:function(){var e=this.collection_.get(),t=Object.assign({},e);return this.last_&&y9(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t}}]),e}(),Qee=function(){function e(t,n){Wg(this,e),this.server_=n,this.statsToReport_={},this.statsListener_=new Kee(t);var r=1e4+2e4*Math.random();w9(this.reportStats_.bind(this),Math.floor(r))}return jg(e,[{key:"reportStats_",value:function(){var e=this,t=this.statsListener_.get(),n={},r=!1;y9(t,function(t,i){i>0&&FV(e.statsToReport_,t)&&(n[t]=i,r=!0)}),r&&this.server_.reportStats(n),w9(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}]),e}(),Xee=(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Xee||(Xee={})),Xee);function Jee(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}var ete,tte=function(){function e(t,n,r){Wg(this,e),this.path=t,this.affectedTree=n,this.revert=r,this.type=Xee.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return jg(e,[{key:"operationForChild",value:function(t){if(J9(this.path)){if(null!=this.affectedTree.value)return hV(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new $9(t));return new e(W9(),n,this.revert)}return hV(q9(this.path)===t,"operationForChild called for unrelated child."),new e(Z9(this.path),this.affectedTree,this.revert)}}]),e}(),nte=function(){function e(t,n,r){Wg(this,e),this.source=t,this.path=n,this.snap=r,this.type=Xee.OVERWRITE}return jg(e,[{key:"operationForChild",value:function(t){return J9(this.path)?new e(this.source,W9(),this.snap.getImmediateChild(t)):new e(this.source,Z9(this.path),this.snap)}}]),e}(),rte=function(){function e(t,n,r){Wg(this,e),this.source=t,this.path=n,this.children=r,this.type=Xee.MERGE}return jg(e,[{key:"operationForChild",value:function(t){if(J9(this.path)){var n=this.children.subtree(new $9(t));return n.isEmpty()?null:n.value?new nte(this.source,W9(),n.value):new e(this.source,W9(),n)}return hV(q9(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,Z9(this.path),this.children)}},{key:"toString",value:function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}]),e}(),ite=function(){function e(t,n,r){Wg(this,e),this.node_=t,this.fullyInitialized_=n,this.filtered_=r}return jg(e,[{key:"isFullyInitialized",value:function(){return this.fullyInitialized_}},{key:"isFiltered",value:function(){return this.filtered_}},{key:"isCompleteForPath",value:function(e){if(J9(e))return this.isFullyInitialized()&&!this.filtered_;var t=q9(e);return this.isCompleteForChild(t)}},{key:"isCompleteForChild",value:function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}},{key:"getNode",value:function(){return this.node_}}]),e}();function ate(e,t,n,r,i,a){var o=r.filter(function(e){return e.type===n});o.sort(function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw fV("Should only compare child_ events.");var r=new fee(t.childName,t.snapshotNode),i=new fee(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)}),o.forEach(function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,a);i.forEach(function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function ote(e,t){return{eventCache:e,serverCache:t}}function ste(e,t,n,r){return ote(new ite(t,n,r),e.serverCache)}function ute(e,t,n,r){return ote(e.eventCache,new ite(t,n,r))}function cte(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function lte(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var hte=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(ete||(ete=new mee(d9)),ete);Wg(this,e),this.value=t,this.children=n}return jg(e,[{key:"isEmpty",value:function(){return null===this.value&&this.children.isEmpty()}},{key:"findRootMostMatchingPathAndValue",value:function(e,t){if(null!=this.value&&t(this.value))return{path:W9(),value:this.value};if(J9(e))return null;var n=q9(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(Z9(e),t);return null!=i?{path:X9(new $9(n),i.path),value:i.value}:null}return null}},{key:"findRootMostValueAndPath",value:function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})}},{key:"subtree",value:function(t){if(J9(t))return this;var n=q9(t),r=this.children.get(n);return null!==r?r.subtree(Z9(t)):new e(null)}},{key:"set",value:function(t,n){if(J9(t))return new e(n,this.children);var r=q9(t),i=(this.children.get(r)||new e(null)).set(Z9(t),n),a=this.children.insert(r,i);return new e(this.value,a)}},{key:"remove",value:function(t){if(J9(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=q9(t),r=this.children.get(n);if(r){var i,a=r.remove(Z9(t));return i=a.isEmpty()?this.children.remove(n):this.children.insert(n,a),null===this.value&&i.isEmpty()?new e(null):new e(this.value,i)}return this}},{key:"get",value:function(e){if(J9(e))return this.value;var t=q9(e),n=this.children.get(t);return n?n.get(Z9(e)):null}},{key:"setTree",value:function(t,n){if(J9(t))return n;var r,i=q9(t),a=(this.children.get(i)||new e(null)).setTree(Z9(t),n);return r=a.isEmpty()?this.children.remove(i):this.children.insert(i,a),new e(this.value,r)}},{key:"fold",value:function(e){return this.fold_(W9(),e)}},{key:"fold_",value:function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(X9(e,r),t)}),t(e,this.value,n)}},{key:"findOnPath",value:function(e,t){return this.findOnPath_(e,W9(),t)}},{key:"findOnPath_",value:function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(J9(e))return null;var i=q9(e),a=this.children.get(i);return a?a.findOnPath_(Z9(e),X9(t,i),n):null}},{key:"foreachOnPath",value:function(e,t){return this.foreachOnPath_(e,W9(),t)}},{key:"foreachOnPath_",value:function(t,n,r){if(J9(t))return this;this.value&&r(n,this.value);var i=q9(t),a=this.children.get(i);return a?a.foreachOnPath_(Z9(t),X9(n,i),r):new e(null)}},{key:"foreach",value:function(e){this.foreach_(W9(),e)}},{key:"foreach_",value:function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(X9(e,n),t)}),this.value&&t(e,this.value)}},{key:"foreachChild",value:function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})}}],[{key:"fromObject",value:function(t){var n=new e(null);return y9(t,function(e,t){n=n.set(new $9(e),t)}),n}}]),e}(),fte=function(){function e(t){Wg(this,e),this.writeTree_=t}return jg(e,null,[{key:"empty",value:function(){return new e(new hte(null))}}]),e}();function dte(e,t,n){if(J9(t))return new fte(new hte(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,a=r.value,o=eee(i,t);return a=a.updateChild(o,n),new fte(e.writeTree_.set(i,a))}var s=new hte(n),u=e.writeTree_.setTree(t,s);return new fte(u)}function vte(e,t,n){var r=e;return y9(n,function(e,n){r=dte(r,X9(t,e),n)}),r}function pte(e,t){if(J9(t))return fte.empty();var n=e.writeTree_.setTree(t,new hte(null));return new fte(n)}function gte(e,t){return null!=yte(e,t)}function yte(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eee(n.path,t)):null}function mte(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Iee,function(e,n){t.push(new fee(e,n))}):e.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new fee(e,n.value))}),t}function kte(e,t){if(J9(t))return e;var n=yte(e,t);return new fte(null!=n?new hte(n):e.writeTree_.subtree(t))}function _te(e){return e.writeTree_.isEmpty()}function Cte(e,t){return wte(W9(),e.writeTree_,t)}function wte(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal(function(t,i){".priority"===t?(hV(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=wte(X9(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(X9(e,".priority"),r)),n}function bte(e,t){return Nte(t,e)}function Ete(e,t){if(e.snap)return ree(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&ree(X9(e.path,n),t))return!0;return!1}function Ste(e){return e.visible}function Pte(e,t,n){for(var r=fte.empty(),i=0;i<e.length;++i){var a=e[i];if(t(a)){var o=a.path,s=void 0;if(a.snap)ree(n,o)?r=dte(r,s=eee(n,o),a.snap):ree(o,n)&&(s=eee(o,n),r=dte(r,W9(),a.snap.getChild(s)));else{if(!a.children)throw fV("WriteRecord should have .snap or .children");if(ree(n,o))r=vte(r,s=eee(n,o),a.children);else if(ree(o,n))if(J9(s=eee(o,n)))r=vte(r,W9(),a.children);else{var u=UV(a.children,q9(s));if(u){var c=u.getChild(Z9(s));r=dte(r,W9(),c)}}}}}return r}function Ote(e,t,n,r,i){if(r||i){var a=kte(e.visibleWrites,t);return!i&&_te(a)?n:i||null!=n||gte(a,W9())?Cte(Pte(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ree(e.path,t)||ree(t,e.path))},t),n||Dee.EMPTY_NODE):null}var o=yte(e.visibleWrites,t);if(null!=o)return o;var s=kte(e.visibleWrites,t);return _te(s)?n:null!=n||gte(s,W9())?Cte(s,n||Dee.EMPTY_NODE):null}function Tte(e,t,n,r){return Ote(e.writeTree,e.treePath,t,n,r)}function Ite(e,t){return function(e,t,n){var r=Dee.EMPTY_NODE,i=yte(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Iee,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(n){var a=kte(e.visibleWrites,t);return n.forEachChild(Iee,function(e,t){var n=Cte(kte(a,new $9(e)),t);r=r.updateImmediateChild(e,n)}),mte(a).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}return mte(kte(e.visibleWrites,t)).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Ate(e,t,n,r){return function(e,t,n,r,i){hV(r||i,"Either existingEventSnap or existingServerSnap must exist");var a=X9(t,n);if(gte(e.visibleWrites,a))return null;var o=kte(e.visibleWrites,a);return _te(o)?i.getChild(n):Cte(o,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function xte(e,t){return function(e,t){return yte(e.visibleWrites,t)}(e.writeTree,X9(e.treePath,t))}function Rte(e,t,n){return function(e,t,n,r){var i=X9(t,n),a=yte(e.visibleWrites,i);return null!=a?a:r.isCompleteForChild(n)?Cte(kte(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Mte(e,t){return Nte(X9(e.treePath,t),e.writeTree)}function Nte(e,t){return{treePath:e,writeTree:t}}var Dte,Lte,Fte=function(){function e(){Wg(this,e),this.changeMap=new Map}return jg(e,[{key:"trackChildChange",value:function(e){var t=e.type,n=e.childName;hV("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),hV(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Vee(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw fV("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Vee(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}},{key:"getChanges",value:function(){return Array.from(this.changeMap.values())}}]),e}(),Ute=new(function(){function e(){Wg(this,e)}return jg(e,[{key:"getCompleteChild",value:function(e){return null}},{key:"getChildAfterChild",value:function(e,t,n){return null}}]),e}()),Bte=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Wg(this,e),this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=r}return jg(e,[{key:"getCompleteChild",value:function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new ite(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Rte(this.writes_,e,n)}},{key:"getChildAfterChild",value:function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:lte(this.viewCache_),i=function(e,t,n,r,i,a){return function(e,t,n,r,i,a,o){var s,u=kte(e.visibleWrites,t),c=yte(u,W9());if(null!=c)s=c;else{if(null==n)return[];s=Cte(u,n)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var l=[],h=o.getCompare(),f=a?s.getReverseIteratorFrom(r,o):s.getIteratorFrom(r,o),d=f.getNext();d&&l.length<1;)0!==h(d,r)&&l.push(d),d=f.getNext();return l}(e.writeTree,e.treePath,t,n,0,i,a)}(this.writes_,r,t,0,n,e);return 0===i.length?null:i[0]}}]),e}();function Vte(e,t,n,r,i,a){var o,s,u=t.eventCache;if(null!=xte(r,n))return t;if(J9(n))if(hV(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=lte(t),l=Ite(r,c instanceof Dee?c:Dee.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),l,a)}else{var h=Tte(r,lte(t));o=e.filter.updateFullNode(t.eventCache.getNode(),h,a)}else{var f=q9(n);if(".priority"===f){hV(1===j9(n),"Can't have a priority with additional path components");var d=u.getNode(),v=Ate(r,n,d,s=t.serverCache.getNode());o=null!=v?e.filter.updatePriority(d,v):u.getNode()}else{var p,g=Z9(n);if(u.isCompleteForChild(f)){s=t.serverCache.getNode();var y=Ate(r,n,u.getNode(),s);p=null!=y?u.getNode().getImmediateChild(f).updateChild(g,y):u.getNode().getImmediateChild(f)}else p=Rte(r,f,t.serverCache);o=null!=p?e.filter.updateChild(u.getNode(),f,p,g,i,a):u.getNode()}}return ste(t,o,u.isFullyInitialized()||J9(n),e.filter.filtersNodes())}function zte(e,t,n,r,i,a,o,s){var u,c=t.serverCache,l=o?e.filter:e.filter.getIndexedFilter();if(J9(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),h,null)}else{var f=q9(n);if(!c.isCompleteForPath(n)&&j9(n)>1)return t;var d=Z9(n),v=c.getNode().getImmediateChild(f).updateChild(d,r);u=".priority"===f?l.updatePriority(c.getNode(),v):l.updateChild(c.getNode(),f,v,d,Ute,null)}var p=ute(t,u,c.isFullyInitialized()||J9(n),l.filtersNodes());return Vte(e,p,n,i,new Bte(i,p,a),s)}function Hte(e,t,n,r,i,a,o){var s,u,c=t.eventCache,l=new Bte(i,t,a);if(J9(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,o),s=ste(t,u,!0,e.filter.filtersNodes());else{var h=q9(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),s=ste(t,u,c.isFullyInitialized(),c.isFiltered());else{var f,d=Z9(n),v=c.getNode().getImmediateChild(h);if(J9(d))f=r;else{var p=l.getCompleteChild(h);f=null!=p?".priority"===Y9(d)&&p.getChild(Q9(d)).isEmpty()?p:p.updateChild(d,r):Dee.EMPTY_NODE}s=v.equals(f)?t:ste(t,e.filter.updateChild(c.getNode(),h,f,d,l,o),c.isFullyInitialized(),e.filter.filtersNodes())}}return s}function Gte(e,t){return e.eventCache.isCompleteForChild(t)}function $te(e,t,n){return n.foreach(function(e,n){t=t.updateChild(e,n)}),t}function Wte(e,t,n,r,i,a,o,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,c=t;u=J9(n)?r:new hte(null).setTree(n,r);var l=t.serverCache.getNode();return u.children.inorderTraversal(function(n,r){if(l.hasChild(n)){var u=$te(0,t.serverCache.getNode().getImmediateChild(n),r);c=zte(e,c,new $9(n),u,i,a,o,s)}}),u.children.inorderTraversal(function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!l.hasChild(n)&&!u){var h=$te(0,t.serverCache.getNode().getImmediateChild(n),r);c=zte(e,c,new $9(n),h,i,a,o,s)}}),c}function qte(e,t){var n=lte(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!J9(t)&&!n.getImmediateChild(q9(t)).isEmpty())?n.getChild(t):null}function jte(e,t,n,r){t.type===Xee.MERGE&&null!==t.source.queryId&&(hV(lte(e.viewCache_),"We should always have a full cache before handling merges"),hV(cte(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_,a=function(e,t,n,r,i){var a,o,s=new Fte;if(n.type===Xee.OVERWRITE){var u=n;u.source.fromUser?a=Hte(e,t,u.path,u.snap,r,i,s):(hV(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.serverCache.isFiltered()&&!J9(u.path),a=zte(e,t,u.path,u.snap,r,i,o,s))}else if(n.type===Xee.MERGE){var c=n;c.source.fromUser?a=function(e,t,n,r,i,a,o){var s=t;return r.foreach(function(r,u){var c=X9(n,r);Gte(t,q9(c))&&(s=Hte(e,s,c,u,i,a,o))}),r.foreach(function(r,u){var c=X9(n,r);Gte(t,q9(c))||(s=Hte(e,s,c,u,i,a,o))}),s}(e,t,c.path,c.children,r,i,s):(hV(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),a=Wte(e,t,c.path,c.children,r,i,o,s))}else if(n.type===Xee.ACK_USER_WRITE){var l=n;a=l.revert?function(e,t,n,r,i,a){var o;if(null!=xte(r,n))return t;var s,u=new Bte(r,t,i),c=t.eventCache.getNode();if(J9(n)||".priority"===q9(n)){var l;if(t.serverCache.isFullyInitialized())l=Tte(r,lte(t));else{var h=t.serverCache.getNode();hV(h instanceof Dee,"serverChildren would be complete if leaf node"),l=Ite(r,h)}l=l,s=e.filter.updateFullNode(c,l,a)}else{var f=q9(n),d=Rte(r,f,t.serverCache);null==d&&t.serverCache.isCompleteForChild(f)&&(d=c.getImmediateChild(f)),(s=null!=d?e.filter.updateChild(c,f,d,Z9(n),u,a):t.eventCache.getNode().hasChild(f)?e.filter.updateChild(c,f,Dee.EMPTY_NODE,Z9(n),u,a):c).isEmpty()&&t.serverCache.isFullyInitialized()&&((o=Tte(r,lte(t))).isLeafNode()&&(s=e.filter.updateFullNode(s,o,a)))}return o=t.serverCache.isFullyInitialized()||null!=xte(r,W9()),ste(t,s,o,e.filter.filtersNodes())}(e,t,l.path,r,i,s):function(e,t,n,r,i,a,o){if(null!=xte(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(J9(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return zte(e,t,n,u.getNode().getChild(n),i,a,s,o);if(J9(n)){var c=new hte(null);return u.getNode().forEachChild(pee,function(e,t){c=c.set(new $9(e),t)}),Wte(e,t,n,c,i,a,s,o)}return t}var l=new hte(null);return r.foreach(function(e,t){var r=X9(n,e);u.isCompleteForPath(r)&&(l=l.set(e,u.getNode().getChild(r)))}),Wte(e,t,n,l,i,a,s,o)}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Xee.LISTEN_COMPLETE)throw fV("Unknown operation type: "+n.type);a=function(e,t,n,r,i){var a=t.serverCache;return Vte(e,ute(t,a.getNode(),a.isFullyInitialized()||J9(n),a.isFiltered()),n,r,Ute,i)}(e,t,n.path,r,s)}var h=s.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=cte(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(cte(t)))}}(t,a,h),{viewCache:a,changes:h}}(e.processor_,i,t,n,r);return function(e,t){hV(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),hV(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,a.viewCache),hV(a.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,r){return function(e,t,n,r){var i=[],a=[];return t.forEach(function(t){"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&a.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),ate(e,i,"child_removed",t,r,n),ate(e,i,"child_added",t,r,n),ate(e,i,"child_moved",a,r,n),ate(e,i,"child_changed",t,r,n),ate(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,e.eventRegistrations_)}(e,a.changes,a.viewCache.eventCache.getNode())}function Zte(e,t,n,r){var i=t.source.queryId;if(null!==i){var a=e.views.get(i);return hV(null!=a,"SyncTree gave us an op for an invalid query."),jte(a,t,n,r)}var o,s=[],u=Hg(e.views.values());try{for(u.s();!(o=u.n()).done;){var c=o.value;s=s.concat(jte(c,t,n,r))}}catch(l){u.e(l)}finally{u.f()}return s}function Yte(e,t){var n,r=null,i=Hg(e.views.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r||qte(a,t)}}catch(o){i.e(o)}finally{i.f()}return r}var Kte=jg(function e(t){Wg(this,e),this.listenProvider_=t,this.syncPointTree_=new hte(null),this.pendingWriteTree_={visibleWrites:fte.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map});function Qte(e,t,n,r,i){return function(e,t,n,r,i){hV(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=dte(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?tne(e,new nte({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Xte(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){var n=e.allWrites.findIndex(function(e){return e.writeId===t});hV(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,a=!1,o=e.allWrites.length-1;i&&o>=0;){var s=e.allWrites[o];s.visible&&(o>=n&&Ete(s,r.path)?i=!1:ree(r.path,s.path)&&(a=!0)),o--}return!!i&&(a?(function(e){e.visibleWrites=Pte(e.allWrites,Ste,W9()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=pte(e.visibleWrites,r.path):y9(r.children,function(t){e.visibleWrites=pte(e.visibleWrites,X9(r.path,t))}),!0))}(e.pendingWriteTree_,t)){var i=new hte(null);return null!=r.snap?i=i.set(W9(),!0):y9(r.children,function(e){i=i.set(new $9(e),!0)}),tne(e,new tte(r.path,i,n))}return[]}function Jte(e,t,n){return tne(e,new nte({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function ene(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,function(e,n){var r=Yte(n,eee(e,t));if(r)return r});return Ote(r,t,i,n,!0)}function tne(e,t){return nne(t,e.syncPointTree_,null,bte(e.pendingWriteTree_,W9()))}function nne(e,t,n,r){if(J9(e.path))return rne(e,t,n,r);var i=t.get(W9());null==n&&null!=i&&(n=Yte(i,W9()));var a=[],o=q9(e.path),s=e.operationForChild(o),u=t.children.get(o);if(u&&s){var c=n?n.getImmediateChild(o):null,l=Mte(r,o);a=a.concat(nne(s,u,c,l))}return i&&(a=a.concat(Zte(i,e,r,n))),a}function rne(e,t,n,r){var i=t.get(W9());null==n&&null!=i&&(n=Yte(i,W9()));var a=[];return t.children.inorderTraversal(function(t,i){var o=n?n.getImmediateChild(t):null,s=Mte(r,t),u=e.operationForChild(t);u&&(a=a.concat(rne(u,i,o,s)))}),i&&(a=a.concat(Zte(i,e,r,n))),a}function ine(e,t){return e.tagToQueryMap.get(t)}function ane(e){var t=e.indexOf("$");return hV(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new $9(e.substr(0,t))}}function one(e,t,n){var r=e.syncPointTree_.get(t);return hV(r,"Missing sync point for query tag that we're tracking"),Zte(r,n,bte(e.pendingWriteTree_,t),null)}var sne=function(){function e(t){Wg(this,e),this.node_=t}return jg(e,[{key:"getImmediateChild",value:function(t){return new e(this.node_.getImmediateChild(t))}},{key:"node",value:function(){return this.node_}}]),e}(),une=function(){function e(t,n){Wg(this,e),this.syncTree_=t,this.path_=n}return jg(e,[{key:"getImmediateChild",value:function(t){var n=X9(this.path_,t);return new e(this.syncTree_,n)}},{key:"node",value:function(){return ene(this.syncTree_,this.path_)}}]),e}(),cne=function(e,t,n){return e&&"object"==typeof e?(hV(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?lne(e[".sv"],t,n):"object"==typeof e[".sv"]?hne(e[".sv"],t):void hV(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},lne=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:hV(!1,"Unexpected server value: "+e)}},hne=function(e,t,n){e.hasOwnProperty("increment")||hV(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&hV(!1,"Unexpected increment value: "+r);var i=t.node();if(hV(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var a=i.getValue();return"number"!=typeof a?r:a+r},fne=function(e,t,n){return dne(e,new sne(t),n)};function dne(e,t,n){var r,i=e.getPriority().val(),a=cne(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e,s=cne(o.getValue(),t,n);return s!==o.getValue()||a!==o.getPriority().val()?new Tee(s,Fee(a)):e}var u=e;return r=u,a!==u.getPriority().val()&&(r=r.updatePriority(new Tee(a))),u.forEachChild(Iee,function(e,i){var a=dne(i,t.getImmediateChild(e),n);a!==i&&(r=r.updateImmediateChild(e,a))}),r}var vne=jg(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};Wg(this,e),this.name=t,this.parent=n,this.node=r});function pne(e,t){for(var n=t instanceof $9?t:new $9(t),r=e,i=q9(n);null!==i;){var a=UV(r.node.children,i)||{children:{},childCount:0};r=new vne(i,r,a),i=q9(n=Z9(n))}return r}function gne(e){return e.node.value}function yne(e,t){e.node.value=t,wne(e)}function mne(e){return e.node.childCount>0}function kne(e,t){y9(e.node.children,function(n,r){t(new vne(n,e,r))})}function _ne(e,t,n,r){n&&!r&&t(e),kne(e,function(e){_ne(e,t,!0,r)}),n&&r&&t(e)}function Cne(e){return new $9(null===e.parent?e.name:Cne(e.parent)+"/"+e.name)}function wne(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===gne(e)&&!mne(e)}(n),i=FV(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,wne(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,wne(e))}(e.parent,e.name,e)}var bne=/[\[\].#$\/\u0000-\u001F\u007F]/,Ene=/[\[\].#$\u0000-\u001F\u007F]/,Sne=10485760,Pne=function(e){return"string"==typeof e&&0!==e.length&&!bne.test(e)},One=function(e){return"string"==typeof e&&0!==e.length&&!Ene.test(e)},Tne=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!c9(e)||e&&"object"==typeof e&&FV(e,".sv")},Ine=function(e,t,n,r){r&&void 0===t||Ane(YV(e,"value"),t,n)},Ane=function e(t,n,r){var i=r instanceof $9?new iee(r,t):r;if(void 0===n)throw new Error(t+"contains undefined "+oee(i));if("function"==typeof n)throw new Error(t+"contains a function "+oee(i)+" with contents = "+n.toString());if(c9(n))throw new Error(t+"contains "+n.toString()+" "+oee(i));if("string"==typeof n&&n.length>Sne/3&&KV(n)>Sne)throw new Error(t+"contains a string greater than "+Sne+" utf8 bytes "+oee(i)+" ('"+n.substring(0,50)+"...')");if(n&&"object"==typeof n){var a=!1,o=!1;if(y9(n,function(n,r){if(".value"===n)a=!0;else if(".priority"!==n&&".sv"!==n&&(o=!0,!Pne(n)))throw new Error(t+" contains an invalid key ("+n+") "+oee(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=KV(t),aee(e)})(i,n),e(t,r,i),function(e){var t=e.parts_.pop();e.byteLength_-=KV(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),a&&o)throw new Error(t+' contains ".value" child '+oee(i)+" in addition to actual children.")}},xne=function(e,t,n,r){if(!(r&&void 0===n||One(n)))throw new Error(YV(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Rne=function(e,t){if(".info"===q9(t))throw new Error(e+" failed = Can't modify data under /.info/")},Mne=jg(function e(){Wg(this,e),this.eventLists_=[],this.recursionDepth_=0});function Nne(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],a=i.getPath();null!==n&&!nee(a,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:a}),n.events.push(i)}n&&e.eventLists_.push(n)}function Dne(e,t,n){Nne(e,n),function(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?(Lne(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,function(e){return ree(e,t)||ree(t,e)})}function Lne(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();n9&&i9("event: "+n.toString()),C9(r)}}}var Fne=function(){function e(t,n,r,i){Wg(this,e),this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Mne,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=qee(),this.transactionQueueTree_=new vne,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return jg(e,[{key:"toString",value:function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}]),e}();function Une(e){var t=e.infoData_.getNode(new $9(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Bne(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:Une(e)})}function Vne(e,t,n,r,i){e.dataUpdateCount++;var a=new $9(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var o=[];if(i)if(r){var s=VV(n,function(e){return Fee(e)});o=function(e,t,n,r){var i=ine(e,r);if(i){var a=ane(i),o=a.path,s=a.queryId,u=eee(o,t),c=hte.fromObject(n);return one(e,o,new rte(Jee(s),u,c))}return[]}(e.serverSyncTree_,a,s,i)}else{var u=Fee(n);o=function(e,t,n,r){var i=ine(e,r);if(null!=i){var a=ane(i),o=a.path,s=a.queryId,u=eee(o,t);return one(e,o,new nte(Jee(s),u,n))}return[]}(e.serverSyncTree_,a,u,i)}else if(r){var c=VV(n,function(e){return Fee(e)});o=function(e,t,n){var r=hte.fromObject(n);return tne(e,new rte({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,a,c)}else{var l=Fee(n);o=Jte(e.serverSyncTree_,a,l)}var h=a;o.length>0&&(h=Kne(e,a)),Dne(e.eventQueue_,h,o)}function zne(e,t){Hne(e,"connected",t),!1===t&&function(e){qne(e,"onDisconnectEvents");var t=Bne(e),n=qee();Yee(e.onDisconnect_,W9(),function(r,i){var a=function(e,t,n,r){return dne(t,new une(n,e),r)}(r,i,e.serverSyncTree_,t);jee(n,r,a)});var r=[];Yee(n,W9(),function(t,n){r=r.concat(Jte(e.serverSyncTree_,t,n));var i=tre(e,t);Kne(e,i)}),e.onDisconnect_=qee(),Dne(e.eventQueue_,W9(),r)}(e)}function Hne(e,t,n){var r=new $9("/.info/"+t),i=Fee(n);e.infoData_.updateSnapshot(r,i);var a=Jte(e.infoSyncTree_,r,i);Dne(e.eventQueue_,r,a)}function Gne(e){return e.nextWriteId_++}function $ne(e,t,n){e.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&Zee(e.onDisconnect_,t),jne(0,n,r,i)})}function Wne(e,t,n,r){var i=Fee(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),function(n,a){"ok"===n&&jee(e.onDisconnect_,t,i),jne(0,r,n,a)})}function qne(e){for(var t="",n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.persistentConnection_&&(t=e.persistentConnection_.id+":"),i9.apply(void 0,[t].concat(r))}function jne(e,t,n,r){t&&C9(function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var a=new Error(i);a.code=e,t(a)}})}function Zne(e,t,n){return ene(e.serverSyncTree_,t,n)||Dee.EMPTY_NODE}function Yne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||ere(e,t),gne(t)){var n=Xne(e,t);hV(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return 0===e.status})&&function(e,t,n){for(var r=n.map(function(e){return e.currentWriteId}),i=Zne(e,t,r),a=i,o=i.hash(),s=0;s<n.length;s++){var u=n[s];hV(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var c=eee(t,u.path);a=a.updateChild(c,u.currentOutputSnapshotRaw)}var l=a.val(!0),h=t;e.server_.put(h.toString(),l,function(r){qne(e,"transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var a=[],o=function(t){n[t].status=2,i=i.concat(Xte(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&a.push(function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)}),n[t].unwatcher()},s=0;s<n.length;s++)o(s);ere(e,pne(e.transactionQueueTree_,t)),Yne(e,e.transactionQueueTree_),Dne(e.eventQueue_,t,i);for(var u=0;u<a.length;u++)C9(a[u])}else{if("datastale"===r)for(var c=0;c<n.length;c++)n[c].status=3===n[c].status?4:0;else{u9("transaction at "+h.toString()+" failed: "+r);for(var l=0;l<n.length;l++)n[l].status=4,n[l].abortReason=r}Kne(e,t)}},o)}(e,Cne(t),n)}else mne(t)&&kne(t,function(t){Yne(e,t)})}function Kne(e,t){var n=Qne(e,t),r=Cne(n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],a=t.filter(function(e){return 0===e.status}).map(function(e){return e.currentWriteId}),o=function(o){var s=t[o],u=eee(n,s.path),c=void 0,l=!1;if(hV(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)l=!0,c=s.abortReason,i=i.concat(Xte(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)l=!0,c="maxretry",i=i.concat(Xte(e.serverSyncTree_,s.currentWriteId,!0));else{var h=Zne(e,s.path,a);s.currentInputSnapshot=h;var f=t[o].update(h.val());if(void 0!==f){Ane("transaction failed: Data returned ",f,s.path);var d=Fee(f);"object"==typeof f&&null!=f&&FV(f,".priority")||(d=d.updatePriority(h.getPriority()));var v=s.currentWriteId,p=Bne(e),g=fne(d,h,p);s.currentOutputSnapshotRaw=d,s.currentOutputSnapshotResolved=g,s.currentWriteId=Gne(e),a.splice(a.indexOf(v),1),i=(i=i.concat(Qte(e.serverSyncTree_,s.path,g,s.currentWriteId,s.applyLocally))).concat(Xte(e.serverSyncTree_,v,!0))}else l=!0,c="nodata",i=i.concat(Xte(e.serverSyncTree_,s.currentWriteId,!0))}Dne(e.eventQueue_,n,i),i=[],l&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===c?function(){return t[o].onComplete(null,!1,t[o].currentInputSnapshot)}:function(){return t[o].onComplete(new Error(c),!1,null)}))},s=0;s<t.length;s++)o(s);ere(e,e.transactionQueueTree_);for(var u=0;u<r.length;u++)C9(r[u]);Yne(e,e.transactionQueueTree_)}}(e,Xne(e,n),r),r}function Qne(e,t){var n,r=e.transactionQueueTree_;for(n=q9(t);null!==n&&void 0===gne(r);)r=pne(r,n),n=q9(t=Z9(t));return r}function Xne(e,t){var n=[];return Jne(e,t,n),n.sort(function(e,t){return e.order-t.order}),n}function Jne(e,t,n){var r=gne(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);kne(t,function(t){Jne(e,t,n)})}function ere(e,t){var n=gne(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,yne(t,n.length>0?n:void 0)}kne(t,function(t){ere(e,t)})}function tre(e,t){var n=Cne(Qne(e,t)),r=pne(e.transactionQueueTree_,t);return function(e,t,n){for(var r=e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,function(t){nre(e,t)}),nre(e,r),_ne(r,function(t){nre(e,t)}),n}function nre(e,t){var n=gne(t);if(n){for(var r=[],i=[],a=-1,o=0;o<n.length;o++)3===n[o].status||(1===n[o].status?(hV(a===o-1,"All SENT items should be at beginning of queue."),a=o,n[o].status=3,n[o].abortReason="set"):(hV(0===n[o].status,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(Xte(e.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));-1===a?yne(t,void 0):n.length=a+1,Dne(e.eventQueue_,Cne(t),i);for(var s=0;s<r.length;s++)C9(r[s])}}var rre=function(e,t){var n=ire(e),r=n.namespace;return"firebase.com"===n.domain&&s9(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&s9("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&u9("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new T9(n.host,n.secure,r,"ws"===n.scheme||"wss"===n.scheme,t,"",r!==n.subdomain),path:new $9(n.pathString)}},ire=function(e){var t="",n="",r="",i="",a="",o=!0,s="https",u=443;if("string"==typeof e){var c=e.indexOf("//");c>=0&&(s=e.substring(0,c-1),e=e.substring(c+2));var l=e.indexOf("/");-1===l&&(l=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(l,h)),l<h&&(i=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(a){}t+="/"+i}return t}(e.substring(l,h)));var f=function(e){var t={};"?"===e.charAt(0)&&(e=e.substring(1));var n,r=Hg(e.split("&"));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(0!==i.length){var a=i.split("=");2===a.length?t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):u9("Invalid query segment '".concat(i,"' in query '").concat(e,"'"))}}}catch(o){r.e(o)}finally{r.f()}return t}(e.substring(Math.min(e.length,h)));(c=t.indexOf(":"))>=0?(o="https"===s||"wss"===s,u=parseInt(t.substring(c+1),10)):c=t.length;var d=t.slice(0,c);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var v=t.indexOf(".");r=t.substring(0,v).toLowerCase(),n=t.substring(v+1),a=r}"ns"in f&&(a=f.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:o,scheme:s,pathString:i,namespace:a}},are=function(){function e(t,n){Wg(this,e),this._repo=t,this._path=n}return jg(e,[{key:"cancel",value:function(){var e=new CV;return $ne(this._repo,this._path,e.wrapCallback(function(){})),e.promise}},{key:"remove",value:function(){Rne("OnDisconnect.remove",this._path);var e=new CV;return Wne(this._repo,this._path,null,e.wrapCallback(function(){})),e.promise}},{key:"set",value:function(e){Rne("OnDisconnect.set",this._path),Ine("OnDisconnect.set",e,this._path,!1);var t=new CV;return Wne(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise}},{key:"setWithPriority",value:function(e,t){Rne("OnDisconnect.setWithPriority",this._path),Ine("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(c9(t))throw new Error(YV(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Tne(t))throw new Error(YV(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}("OnDisconnect.setWithPriority",t);var n=new CV;return function(e,t,n,r,i){var a=Fee(n,r);e.server_.onDisconnectPut(t.toString(),a.val(!0),function(n,r){"ok"===n&&jee(e.onDisconnect_,t,a),jne(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(function(){})),n.promise}},{key:"update",value:function(e){Rne("OnDisconnect.update",this._path),function(e,t,n,r){var i=YV("OnDisconnect.update","values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var a=[];y9(t,function(e,t){var r=new $9(e);if(Ane(i,t,X9(n,r)),".priority"===Y9(r)&&!Tne(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(r)}),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=K9(r=t[n]),a=0;a<i.length;a++)if((".priority"!==i[a]||a!==i.length-1)&&!Pne(i[a]))throw new Error(e+"contains an invalid key ("+i[a]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(tee);var o=null;for(n=0;n<t.length;n++){if(r=t[n],null!==o&&ree(o,r))throw new Error(e+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(i,a)}(0,e,this._path);var t=new CV;return function(e,t,n,r){if(BV(n))return i9("onDisconnect().update() called with empty data.  Don't do anything."),void jne(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,function(i,a){"ok"===i&&y9(n,function(n,r){var i=Fee(r);jee(e.onDisconnect_,X9(t,n),i)}),jne(0,r,i,a)})}(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise}}]),e}(),ore=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r,new zee,!1)}return jg(n,[{key:"parent",get:function(){var e=Q9(this._path);return null===e?null:new n(this._repo,e)}},{key:"root",get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}}]),n}(function(){function e(t,n,r,i){Wg(this,e),this._repo=t,this._path=n,this._queryParams=r,this._orderByCalled=i}return jg(e,[{key:"key",get:function(){return J9(this._path)?null:Y9(this._path)}},{key:"ref",get:function(){return new ore(this._repo,this._path)}},{key:"_queryIdentifier",get:function(){var e=Gee(this._queryParams),t=p9(e);return"{}"===t?"default":t}},{key:"_queryObject",get:function(){return Gee(this._queryParams)}},{key:"isEqual",value:function(t){if(!((t=XV(t))instanceof e))return!1;var n=this._repo===t._repo,r=nee(this._path,t._path);return n&&r&&this._queryIdentifier===t._queryIdentifier}},{key:"toJSON",value:function(){return this.toString()}},{key:"toString",value:function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}]),e}());(function(e){hV(!Dte,"__referenceConstructor has already been defined"),Dte=e})(ore),function(e){hV(!Lte,"__referenceConstructor has already been defined"),Lte=e}(ore);var sre={};var ure=function(){function e(t,n){Wg(this,e),this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}return jg(e,[{key:"_repo",get:function(){return this._instanceStarted||(function(e,t,n){if(e.stats_=M9(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new $ee(e.repoInfo_,function(t,n,r,i){Vne(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(function(){return zne(e,!0)},0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{DV(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new hee(e.repoInfo_,t,function(t,n,r,i){Vne(e,t,n,r,i)},function(t){zne(e,t)},function(t){!function(e,t){y9(t,function(t,n){Hne(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(function(t){e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(function(t){e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){var n=e.toString();return R9[n]||(R9[n]=t()),R9[n]}(e.repoInfo_,function(){return new Qee(e.stats_,e.server_)}),e.infoData_=new Wee,e.infoSyncTree_=new Kte({startListening:function(t,n,r,i){var a=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(a=Jte(e.infoSyncTree_,t._path,o),setTimeout(function(){i("ok")},0)),a},stopListening:function(){}}),Hne(e,"connected",!1),e.serverSyncTree_=new Kte({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,function(n,r){var a=i(n,r);Dne(e.eventQueue_,t._path,a)}),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}},{key:"_root",get:function(){return this._rootInternal||(this._rootInternal=new ore(this._repo,W9())),this._rootInternal}},{key:"_delete",value:function(){return null!==this._rootInternal&&(function(e,t){var n=sre[t];(!n||n[e.key]!==e)&&s9("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}},{key:"_checkNotDeleted",value:function(e){null===this._rootInternal&&s9("Cannot call "+e+" on a deleted database.")}}]),e}();var cre={".sv":"timestamp"};function lre(){return cre}hee.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},hee.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},q7="9.9.0",Dz(new tz("database",function(e,t){var n=t.instanceIdentifier;return function(e,t,n,r,i){var a=r||e.options.databaseURL;void 0===a&&(e.options.projectId||s9("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),i9("Using default host for project ",e.options.projectId),a="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));var o,s,u=rre(a,i),c=u.repoInfo;"undefined"!=typeof process&&process.env&&(s=process.env.FIREBASE_DATABASE_EMULATOR_HOST),s?(o=!0,a="http://".concat(s,"?ns=").concat(c.namespace),c=(u=rre(a,i)).repoInfo):o=!u.repoInfo.secure;var l=i&&o?new S9(S9.OWNER):new E9(e.name,e.options,t);(function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Pne(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),One(e)}(n))throw new Error(YV("Invalid Firebase Database URL","url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})(0,u),J9(u.path)||s9("Database URL must point to the root of a Firebase Database (not including a child path).");var h=function(e,t,n,r){var i=sre[t.name];i||(i={},sre[t.name]=i);var a=i[e.toURLString()];return a&&s9("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new Fne(e,!1,n,r),i[e.toURLString()]=a,a}(c,e,l,new b9(e.name,n));return new ure(h,e)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)},"PUBLIC").setMultipleInstances(!0)),Hz(W7,"0.13.3",void 0),Hz(W7,"0.13.3","esm2017");var hre=jg(function e(t){return Wg(this,e),t}),fre=new Y_("angularfire2.database-instances");function dre(e){return function(t,n){var r=t.runOutsideAngular(function(){return e(n)});return new hre(r)}}var vre={provide:jg(function e(){return Wg(this,e),DW("database")}),deps:[[new bC,fre]]},pre={provide:hre,useFactory:function(e,t){var n=NW("database",e,t);return n&&new hre(n)},deps:[[new bC,fre],qW]},gre=function(){var e=jg(function e(){Wg(this,e),Hz("angularfire",OW.full,"rtdb")});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({providers:[pre,vre]}),e}(),yre=WW(function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(e=XV(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&s9("Cannot call useEmulator() after instance has already been initialized.");var i,a=e._repoInternal;if(a.repoInfo_.nodeAdmin)r.mockUserToken&&s9('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new S9(S9.OWNER);else if(r.mockUserToken){var o="string"==typeof r.mockUserToken?r.mockUserToken:wV(r.mockUserToken,e.app.options.projectId);i=new S9(o)}!function(e,t,n,r){e.repoInfo_=new T9("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(a,t,n,i)},!0),mre=WW(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vz(),t=arguments.length>1?arguments[1]:void 0;return Lz(e,"database").getImmediate({identifier:t})},!0),kre=WW(function(e){return e=XV(e),new are(e._repo,e._path)},!0),_re=WW(function(e,t){return(e=XV(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===q9((e=XV(e))._path)?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),xne("child","path",n,!1)):xne("child","path",t,!1),new ore(e._repo,X9(e._path,t));var n}(e._root,t):e._root},!0),Cre=WW(function(e,t){e=XV(e),Rne("set",e._path),Ine("set",t,e._path,!1);var n=new CV;return function(e,t,n,r,i){qne(e,"set",{path:t.toString(),value:n,priority:null});var a=Bne(e),o=Fee(n,null),s=ene(e.serverSyncTree_,t),u=fne(o,s,a),c=Gne(e),l=Qte(e.serverSyncTree_,t,u,c,!0);Nne(e.eventQueue_,l),e.server_.put(t.toString(),o.val(!0),function(n,r){var a="ok"===n;a||u9("set at "+t+" failed: "+n);var o=Xte(e.serverSyncTree_,c,!a);Dne(e.eventQueue_,t,o),jne(0,i,n,r)});var h=tre(e,t);Kne(e,h),Dne(e.eventQueue_,h,[])}(e._repo,e._path,t,0,n.wrapCallback(function(){})),n.promise},!0),wre=function(){function e(t){Wg(this,e),this.db=t}return jg(e,[{key:"setOffline",value:function(t){return Cre(_re(this.db,"/status/"+t),e.OFFLINE)}},{key:"launchAutomaticPresenceUpdate",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=_re(n.db,"/status/"+t),r.next=3,Cre(i,e.ONLINE);case 3:return r.next=5,kre(i).set(e.OFFLINE);case 5:case"end":return r.stop()}},r)}))()}}]),e}();wre.OFFLINE={last_changed:lre()},wre.ONLINE={last_changed:lre()},wre.\u0275fac=function(e){return new(e||wre)(pC(hre))},wre.\u0275prov=dm({token:wre,factory:wre.\u0275fac,providedIn:"root"});var bre=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"createUserWithEmailAndPassword",value:function(e,t,n){return tK(e,t,n)}},{key:"sendEmailVerification",value:function(e){return iK(e)}},{key:"sendPasswordResetEmail",value:function(e,t){return aK(e,t)}},{key:"signInWithEmailAndPassword",value:function(e,t,n){return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,oK(e,t,n);case 2:return r.abrupt("return",r.sent.user);case 3:case"end":return r.stop()}},r)}))()}},{key:"signInWithPopup",value:function(e,t){return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,sK(e,t);case 2:return n.abrupt("return",n.sent.user);case 3:case"end":return n.stop()}},n)}))()}},{key:"updateProfile",value:function(e,t){return uK(e,t)}}]),e}(),Ere=function(){function e(t,n,r,i){Wg(this,e),this.id=t,this.email=n,this.username=r,this.verified=i}return jg(e,[{key:"isConnected",value:function(){return this.email.isPresent()}},{key:"toMinimalUser",value:function(){return{id:this.id,name:this.username.get()}}}]),e}();Ere.NOT_CONNECTED=new Ere("",lV.empty(),lV.empty(),!1);var Sre=function(){var e=function(){function e(t,n,r){Wg(this,e);var i,a=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=lV.empty(),this.userUnsubscribe=lV.empty(),oV(e.VERBOSE,"ConnectedUserService constructor"),this.userRS=new $7(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=rK(this.auth,(i=iV(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=n){t.next=4;break}oV(e.VERBOSE,"User is not connected"),a.userUnsubscribe.isPresent()&&a.userUnsubscribe.get()(),a.userRS.next(Ere.NOT_CONNECTED),a.user=lV.empty(),t.next=8;break;case 4:return M7(a.user.isAbsent(),"ConnectedUserService received a double update for an user, this is unexpected"),t.next=7,a.connectivityDAO.launchAutomaticPresenceUpdate(n.uid);case 7:a.userUnsubscribe=lV.of(a.userDAO.subscribeToChanges(n.uid,function(t){if(t.isPresent()){var r=t.get().username;oV(e.VERBOSE,"User ".concat(r," is connected, and the verified status is ").concat(a.emailVerified(n)));var i=!0===a.emailVerified(n)&&null!=r;if(!0===i&&!1===t.get().verified)return a.userDAO.markVerified(n.uid);var o=new Ere(n.uid,lV.ofNullable(n.email),lV.ofNullable(r),i);a.user=lV.of(o),a.userRS.next(o)}}));case 8:case"end":return t.stop()}},t)})),function(e){return i.apply(this,arguments)}))}return jg(e,[{key:"emailVerified",value:function(e){return e.emailVerified}},{key:"sendPasswordResetEmail",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,bre.sendPasswordResetEmail(t.auth,e);case 3:return n.abrupt("return",T7.SUCCESS);case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",T7.failure(t.mapFirebaseError(n.t0)));case 9:case"end":return n.stop()}},n,null,[[0,6]])}))()}},{key:"doRegister",value:function(t,n,i){var a=this;return iV(regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return oV(e.VERBOSE,"ConnectedUserService.doRegister("+n+")"),o.next=3,a.userDAO.usernameIsAvailable(t);case 3:if(!o.sent){o.next=7;break}o.t0=a.registerAfterUsernameCheck(t,n,i),o.next=8;break;case 7:o.t0=S7.failure($localize(r||(r=wg(["This username is already in use."]))));case 8:return o.abrupt("return",o.t0);case 9:case"end":return o.stop()}},o)}))()}},{key:"registerAfterUsernameCheck",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,bre.createUserWithEmailAndPassword(r.auth,t,n);case 3:return a=i.sent,o=aV.getNonNullable(a.user),i.next=7,r.createUser(o.uid,e);case 7:return i.abrupt("return",S7.success(o));case 10:return i.prev=10,i.t0=i.catch(0),i.abrupt("return",S7.failure(r.mapFirebaseError(i.t0)));case 13:case"end":return i.stop()}},i,null,[[0,10]])}))()}},{key:"mapFirebaseError",value:function(e){switch(e.code){case"auth/email-already-in-use":return $localize(i||(i=wg(["This email address is already in use."])));case"auth/invalid-email":return $localize(a||(a=wg(["This email address is invalid."])));case"auth/user-not-found":case"auth/wrong-password":return $localize(o||(o=wg(["You have entered invalid credentials."])));case"auth/invalid-credential":return $localize(s||(s=wg(["The credential is invalid or has expired, please try again."])));case"auth/weak-password":return $localize(u||(u=wg(["Your password is too weak, please use a stronger password."])));case"auth/too-many-requests":return $localize(c||(c=wg(["There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later."])));case"auth/popup-closed-by-user":return $localize(l||(l=wg(["You closed the authentication popup without finalizing your log in."])));case"auth/popup-blocked":return $localize(h||(h=wg(["The authentication popup was blocked. Try again after disabling popup blocking."])));default:return R7.logError("ConnectedUserService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}},{key:"sendEmailVerification",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(oV(e.VERBOSE,"ConnectedUserService.sendEmailVerification()"),(r=lV.ofNullable(t.auth.currentUser)).isPresent()){n.next=4;break}return n.abrupt("return",R7.logError("ConnectedUserService","Unlogged users cannot request for email verification"));case 4:if(!t.emailVerified(r.get())){n.next=6;break}return n.abrupt("return",R7.logError("ConnectedUserService","Verified users should not ask email verification after being verified"));case 6:return n.prev=6,n.next=9,bre.sendEmailVerification(r.get());case 9:return n.abrupt("return",T7.SUCCESS);case 12:return n.prev=12,n.t0=n.catch(6),n.abrupt("return",T7.failure(t.mapFirebaseError(n.t0)));case 15:case"end":return n.stop()}},n,null,[[6,12]])}))()}},{key:"doEmailLogin",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return oV(e.VERBOSE,"ConnectedUserService.doEmailLogin("+t+")"),i.prev=1,i.next=4,bre.signInWithEmailAndPassword(r.auth,t,n);case 4:return i.abrupt("return",T7.SUCCESS);case 7:return i.prev=7,i.t0=i.catch(1),i.abrupt("return",T7.failure(r.mapFirebaseError(i.t0)));case 10:case"end":return i.stop()}},i,null,[[1,7]])}))()}},{key:"createUser",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t){r.next=5;break}return r.next=3,n.userDAO.set(e,{verified:!1});case 3:r.next=7;break;case 5:return r.next=7,n.userDAO.set(e,{username:t,verified:!1});case 7:case"end":return r.stop()}},r)}))()}},{key:"doGoogleLogin",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=T7,t.next=3,e.registerOrLoginWithGoogle();case 3:return t.t1=t.sent,t.abrupt("return",t.t0.ofFallible.call(t.t0,t.t1));case 5:case"end":return t.stop()}},t)}))()}},{key:"registerOrLoginWithGoogle",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(n=new pZ).addScope("profile"),n.addScope("email"),t.next=5,bre.signInWithPopup(e.auth,n);case 5:return r=t.sent,t.t0=!1,t.next=9,e.userDAO.exists(r.uid);case 9:if(t.t1=t.sent,t.t2=t.t0===t.t1,!t.t2){t.next=14;break}return t.next=14,e.createUser(r.uid);case 14:return t.abrupt("return",S7.success(r));case 17:return t.prev=17,t.t3=t.catch(0),t.abrupt("return",S7.failure(e.mapFirebaseError(t.t3)));case 20:case"end":return t.stop()}},t,null,[[0,17]])}))()}},{key:"disconnect",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=lV.ofNullable(e.auth.currentUser)).isPresent()){t.next=8;break}return r=n.get().uid,t.next=5,e.connectivityDAO.setOffline(r);case 5:return t.next=7,e.auth.signOut();case 7:return t.abrupt("return",T7.SUCCESS);case 8:return t.abrupt("return",T7.failure("Cannot disconnect a non-connected user"));case 9:case"end":return t.stop()}},t)}))()}},{key:"getUserObs",value:function(){return this.userObs}},{key:"setUsername",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(""!==e){n.next=2;break}return n.abrupt("return",T7.failure($localize(f||(f=wg(["Your username may not be empty."])))));case 2:return n.prev=2,n.t0=!1,n.next=6,t.userDAO.usernameIsAvailable(e);case 6:if(n.t1=n.sent,n.t0!==n.t1){n.next=9;break}return n.abrupt("return",T7.failure($localize(d||(d=wg(["This username is already in use, please select a different one."])))));case 9:return r=aV.getNonNullable(t.auth.currentUser),n.next=12,bre.updateProfile(r,{displayName:e});case 12:return n.next=14,t.userDAO.setUsername(r.uid,e);case 14:return n.next=16,t.userDAO.markVerified(r.uid);case 16:return n.next=18,t.reloadUser();case 18:return n.abrupt("return",T7.SUCCESS);case 21:return n.prev=21,n.t2=n.catch(2),n.abrupt("return",T7.failure(t.mapFirebaseError(n.t2)));case 24:case"end":return n.stop()}},n,null,[[2,21]])}))()}},{key:"setPicture",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=aV.getNonNullable(t.auth.currentUser),n.next=4,bre.updateProfile(r,{photoURL:e});case 4:return n.abrupt("return",T7.SUCCESS);case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",T7.failure(t.mapFirebaseError(n.t0)));case 10:case"end":return n.stop()}},n,null,[[0,7]])}))()}},{key:"reloadUser",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=aV.getNonNullable(e.auth.currentUser),t.next=3,n.getIdToken(!0);case 3:return t.next=5,n.reload();case 5:case"end":return t.stop()}},t)}))()}},{key:"updateObservedPart",value:function(e){return M7(this.user.isPresent(),"Should not call updateObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:e})}},{key:"removeObservedPart",value:function(){return M7(this.user.isPresent(),"Should not call removeObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:null})}},{key:"sendPresenceToken",value:function(){return M7(this.user.isPresent(),"Should not call sendPresenceToken when not connected"),this.userDAO.updatePresenceToken(this.user.get().id)}},{key:"ngOnDestroy",value:function(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(z7),pC(qY),pC(wre))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Pre=function(){function e(t){Wg(this,e),this.value=t}return jg(e,null,[{key:"of",value:function(t){switch(t){case"CREATOR":return e.CREATOR;case"RANDOM":return e.RANDOM;default:return M7("CHOSEN_PLAYER"===t,"Invalid value for FirstPlayer: "+t+"."),e.CHOSEN_PLAYER}}}]),e}();Pre.CREATOR=new Pre("CREATOR"),Pre.RANDOM=new Pre("RANDOM"),Pre.CHOSEN_PLAYER=new Pre("CHOSEN_PLAYER");var Ore=function(){function e(t){Wg(this,e),this.value=t}return jg(e,null,[{key:"of",value:function(t){switch(t){case"STANDARD":return e.STANDARD;case"BLITZ":return e.BLITZ;case"CUSTOM":return e.CUSTOM;default:throw new Error("Invalid part type: "+t+".")}}}]),e}();Ore.STANDARD=new Ore("STANDARD"),Ore.BLITZ=new Ore("BLITZ"),Ore.CUSTOM=new Ore("CUSTOM"),Ore.NORMAL_MOVE_DURATION=120,Ore.NORMAL_PART_DURATION=1800,Ore.BLITZ_MOVE_DURATION=30,Ore.BLITZ_PART_DURATION=900;var Tre=jg(function e(t){Wg(this,e),this.value=t});Tre.PART_CREATED=new Tre(0),Tre.CONFIG_PROPOSED=new Tre(2),Tre.PART_STARTED=new Tre(3),Tre.PART_FINISHED=new Tre(4);var Ire=jg(function e(){Wg(this,e)}),Are=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return this.encodeMove(e)}},{key:"decode",value:function(e){return M7(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}],[{key:"disjunction3",value:function(e,t,r,i,a){return new(function(n){Mg(s,n);var o=Dg(s);function s(){return Wg(this,s),o.apply(this,arguments)}return jg(s,[{key:"encodeMove",value:function(n){return i(n)?{type:"T1",encoded:e.encode(n)}:a(n)?{type:"T2",encoded:t.encode(n)}:{type:"T3",encoded:r.encode(n)}}},{key:"decodeMove",value:function(n){var i=aV.getNonNullable(n).type,a=aV.getNonNullable(n).encoded;return"T1"===i?e.decode(a):"T2"===i?t.decode(a):r.decode(a)}}]),s}(n))}}]),n}(Ire),xre=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"shift",value:function(){return this.maxValue()+1}},{key:"encodeMove",value:function(e){return this.encodeNumber(e)}},{key:"decodeMove",value:function(e){return M7("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}],[{key:"ofN",value:function(e,t,r){return new(function(n){Mg(a,n);var i=Dg(a);function a(){return Wg(this,a),i.apply(this,arguments)}return jg(a,[{key:"maxValue",value:function(){return e}},{key:"encodeNumber",value:function(e){return t(e)}},{key:"decodeNumber",value:function(e){return r(e)}}]),a}(n))}},{key:"tuple",value:function(e,t,r){return new(function(n){Mg(a,n);var i=Dg(a);function a(){return Wg(this,a),i.apply(this,arguments)}return jg(a,[{key:"maxValue",value:function(){var t=0;return Object.keys(e).forEach(function(n){t=t*e[n].shift()+e[n].maxValue()}),t}},{key:"encodeNumber",value:function(n){var r=t(n),i=0;return Object.keys(r).forEach(function(t){i=i*e[t].shift()+e[t].encode(r[t])}),i}},{key:"decodeNumber",value:function(t){var n={},i=t;return Object.keys(e).reverse().forEach(function(t){var r=i%e[t].shift();i=(i-r)/e[t].shift(),n[t]=e[t].decode(r)}),r(n)}}]),a}(n))}},{key:"disjunction",value:function(e,t,r){return new(function(n){Mg(a,n);var i=Dg(a);function a(){return Wg(this,a),i.apply(this,arguments)}return jg(a,[{key:"maxValue",value:function(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}},{key:"encodeNumber",value:function(n){return r(n)?2*e.encodeNumber(n):2*t.encodeNumber(n)+1}},{key:"decodeNumber",value:function(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}]),a}(n))}},{key:"numberEncoder",value:function(e){return new(function(t){Mg(r,t);var n=Dg(r);function r(){return Wg(this,r),n.apply(this,arguments)}return jg(r,[{key:"maxValue",value:function(){return e}},{key:"encodeNumber",value:function(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}},{key:"decodeNumber",value:function(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}]),r}(n))}}]),n}(Are);xre.booleanEncoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 1}},{key:"encodeNumber",value:function(e){return e?1:0}},{key:"decodeNumber",value:function(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}}]),n}(xre));var Rre=function(){function e(){Wg(this,e),this.value=2}return jg(e,[{key:"isPlayer",value:function(){return!1}},{key:"toString",value:function(){return"PlayerNone"}},{key:"equals",value:function(e){return this===e}}]),e}();Rre.NONE=new Rre;var Mre,Nre=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"isPlayer",value:function(){return!0}},{key:"toString",value:function(){return"Player "+this.value}},{key:"equals",value:function(e){return this===e}},{key:"getScoreModifier",value:function(){return 0===this.value?-1:1}},{key:"getPreVictory",value:function(){return this.getVictoryValue()-this.getScoreModifier()}},{key:"getDefeatValue",value:function(){return this===e.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}},{key:"getVictoryValue",value:function(){return this===e.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}},{key:"getOpponent",value:function(){switch(this){case e.ZERO:return e.ONE;default:return aV.expectToBe(this,e.ONE),e.ZERO}}}],[{key:"of",value:function(t){switch(t){case 0:return e.ZERO;default:return aV.expectToBe(t,1),e.ONE}}},{key:"fromTurn",value:function(t){return t%2==0?e.ZERO:e.ONE}}]),e}();Nre.numberEncoder=xre.ofN(2,function(e){return e.value},function(e){return 2===e?Mre.NONE:Nre.of(e)}),Nre.ZERO=new Nre(0),Nre.ONE=new Nre(1),Nre.PLAYERS=[Nre.ZERO,Nre.ONE],function(e){e.ZERO=Nre.ZERO,e.ONE=Nre.ONE,e.NONE=Rre.NONE}(Mre||(Mre={}));var Dre=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"rematchAccepted",value:function(e,t){return Lre("RematchAccepted",{typeGame:e,partId:t})}},{key:"getPlayer",value:function(e){return Nre.of(aV.getNonNullable(e.data).player)}},{key:"getTypeGame",value:function(e){return aV.getNonNullable(e.data).typeGame}},{key:"getPartId",value:function(e){return aV.getNonNullable(e.data).partId}}]),e}();function Lre(e,t){return{code:e,data:t}}function Fre(e){return function(t){return Lre(e,{player:t.value})}}Dre.drawProposed=Fre("DrawProposed"),Dre.drawAccepted=Lre("DrawAccepted",{}),Dre.drawRefused=Fre("DrawRefused"),Dre.takeBackAsked=Fre("TakeBackAsked"),Dre.takeBackRefused=Fre("TakeBackRefused"),Dre.takeBackAccepted=Fre("TakeBackAccepted"),Dre.rematchProposed=Fre("RematchProposed"),Dre.addTurnTime=Fre("AddTurnTime"),Dre.addGlobalTime=Fre("AddGlobalTime");var Ure=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"mapBiArray",value:function(e,t){for(var n=[],r=0;r<e.length;){n[r]=[];for(var i=0;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}},{key:"createTable",value:function(e,t,n){for(var r=[],i=t-1;i>=0;){r[i]=[];for(var a=e-1;a>=0;)r[i][a]=n,a--;i--}return r}},{key:"copyBiArray",value:function(t){for(var n=[],r=0;r<t.length;)n[r]=e.copyImmutableArray(t[r]),r++;return n}},{key:"copyImmutableArray",value:function(e){for(var t=[],n=0;n<e.length;)t[n]=e[n],n++;return t}},{key:"sortByDescending",value:function(e,t){e.sort(function(e,n){var r=t(e),i=t(n);return r<i?1:r>i?-1:0})}},{key:"compareArray",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!1===cV(e[n],t[n]))return!1;return!0}},{key:"compareTable",value:function(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!1===e.compareArray(t[r],n[r]))return!1;return!0}}]),e}(),Bre=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),r=t.call(this,"joiners",e),oV(n.VERBOSE,"JoinerDAO.constructor"),r}return jg(n)}(E7);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(r7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Vre=function(){var e=function(){function e(t){Wg(this,e),this.joinerDAO=t,this.joinerUnsubscribe=lV.empty(),oV(e.VERBOSE,"JoinerService.constructor")}return jg(e,[{key:"subscribeToChanges",value:function(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=lV.of(this.joinerDAO.subscribeToChanges(e,t))}},{key:"unsubscribe",value:function(){M7(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=lV.empty()}},{key:"createInitialJoiner",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(oV(e.VERBOSE,"JoinerService.createInitialJoiner("+t.id+", "+n+")"),r.set(n,{candidates:[],chosenOpponent:null,firstPlayer:Pre.RANDOM.value,partType:Ore.STANDARD.value,partStatus:Tre.PART_CREATED.value,maximalMoveDuration:Ore.NORMAL_MOVE_DURATION,totalPartDuration:Ore.NORMAL_PART_DURATION,creator:t})));case 1:case"end":return i.stop()}},i)}))()}},{key:"joinGame",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return oV(e.VERBOSE,"JoinerService.joinGame("+t+", "+n.id+")"),i.next=3,r.joinerDAO.read(t);case 3:if(!(a=i.sent).isAbsent()){i.next=6;break}return i.abrupt("return",T7.failure(e.GAME_DOES_NOT_EXIST()));case 6:if(!(o=Ure.copyImmutableArray(a.get().candidates)).some(function(e){return e.id===n.id})){i.next=11;break}i.t0=T7.failure(e.USER_ALREADY_IN_GAME()),i.next=17;break;case 11:if(i.t1=n.id===a.get().creator.id,i.t1){i.next=16;break}return o[o.length]=n,i.next=16,r.joinerDAO.update(t,{candidates:o});case 16:i.t0=T7.SUCCESS;case 17:return i.abrupt("return",i.t0);case 18:case"end":return i.stop()}},i)}))()}},{key:"cancelJoining",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(e.VERBOSE,"JoinerService.cancelJoining("+t.name+"); this.observedJoinerId = "+n.observedJoinerId),null!=n.observedJoinerId){r.next=2;break}throw new Error("cannot cancel joining when not observing a joiner");case 2:return r.next=4,n.joinerDAO.read(n.observedJoinerId);case 4:if((i=r.sent).isAbsent()){r.next=15;break}if(o=i.get(),s=Ure.copyImmutableArray(o.candidates),u=s.findIndex(function(e){return e.id===t.id}),c=o.chosenOpponent,l=o.partStatus,s.splice(u,1),(null===(a=c)||void 0===a?void 0:a.id)!==t.id){r.next=12;break}c=null,l=Tre.PART_CREATED.value,r.next=14;break;case 12:if(-1!==u){r.next=14;break}throw new Error("someone that was not candidate nor ChosenOpponent just left the chat: "+t.name);case 14:return r.abrupt("return",n.joinerDAO.update(n.observedJoinerId,{chosenOpponent:c,partStatus:l,candidates:s}));case 15:case"end":return r.stop()}},r)}))()}},{key:"updateCandidates",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return oV(e.VERBOSE,"JoinerService.reviewConfig"),M7(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),i={candidates:t},r.abrupt("return",n.joinerDAO.update(aV.getNonNullable(n.observedJoinerId),i));case 3:case"end":return r.stop()}},r)}))()}},{key:"deleteJoiner",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(oV(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),M7(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(aV.getNonNullable(t.observedJoinerId))));case 1:case"end":return n.stop()}},n)}))()}},{key:"proposeConfig",value:function(t,n,r,i,a){var o=this;return iV(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(oV(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:a}}),oV(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),M7(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(aV.getNonNullable(o.observedJoinerId),{partStatus:Tre.CONFIG_PROPOSED.value,chosenOpponent:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:a,firstPlayer:i.value})));case 1:case"end":return s.stop()}},s)}))()}},{key:"setChosenOpponent",value:function(t){return oV(e.VERBOSE,"JoinerService.setChosenOpponent(".concat(t.name,")")),M7(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(aV.getNonNullable(this.observedJoinerId),{chosenOpponent:t})}},{key:"reviewConfig",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(oV(e.VERBOSE,"JoinerService.reviewConfig"),M7(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(aV.getNonNullable(t.observedJoinerId),{partStatus:Tre.PART_CREATED.value})));case 1:case"end":return n.stop()}},n)}))()}},{key:"reviewConfigAndRemoveChosenOpponentAndUpdateCandidates",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(oV(e.VERBOSE,"JoinerService.reviewConfig"),M7(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(aV.getNonNullable(n.observedJoinerId),{partStatus:Tre.PART_CREATED.value,candidates:t,chosenOpponent:null})));case 1:case"end":return r.stop()}},r)}))()}},{key:"acceptConfig",value:function(){return oV(e.VERBOSE,"JoinerService.acceptConfig"),M7(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(aV.getNonNullable(this.observedJoinerId),{partStatus:Tre.PART_STARTED.value})}},{key:"createJoiner",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(oV(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)));case 1:case"end":return r.stop()}},r)}))()}},{key:"readJoinerById",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return oV(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),r.next=3,n.joinerDAO.read(t);case 3:return r.abrupt("return",r.sent.get());case 4:case"end":return r.stop()}},r)}))()}},{key:"set",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(oV(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)));case 1:case"end":return i.stop()}},i)}))()}},{key:"updateJoinerById",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(oV(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)));case 1:case"end":return i.stop()}},i)}))()}}]),e}();return e.VERBOSE=!1,e.USER_ALREADY_IN_GAME=function(){return $localize(v||(v=wg(["You cannot join this game because you are already in another one."])))},e.GAME_DOES_NOT_EXIST=function(){return $localize(p||(p=wg(["Game does not exist"])))},e.\u0275fac=function(t){return new(t||e)(pC(Bre))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),zre=function(){var e=function(){function e(t,n,r){Wg(this,e),this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=lV.empty(),oV(e.VERBOSE,"GameService.constructor")}return jg(e,[{key:"getPartValidity",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.partDAO.read(e);case 2:return i=r.sent,r.abrupt("return",i.isAbsent()?T7.failure("NONEXISTENT_PART"):i.get().typeGame===t?T7.SUCCESS:T7.failure("WRONG_GAME_TYPE"));case 4:case"end":return r.stop()}},r)}))()}},{key:"createUnstartedPart",value:function(t,n){return oV(e.VERBOSE,"GameService.createPart("+t.name+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t.name,turn:-1,result:N7.UNACHIEVED.value,listMoves:[]})}},{key:"createChat",value:function(t){return oV(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}},{key:"createPartJoinerAndChat",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return oV(e.VERBOSE,"GameService.createGame(".concat(t.id,", ").concat(n,")")),i.next=3,r.createUnstartedPart(t,n);case 3:return a=i.sent,i.next=6,r.joinerService.createInitialJoiner(t,a);case 6:return i.next=8,r.createChat(a);case 8:return i.abrupt("return",a);case 9:case"end":return i.stop()}},i)}))()}},{key:"startGameWithConfig",value:function(t,n,r,i){oV(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));var a=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,a)}},{key:"getStartingConfig",value:function(e){var t,n,r=Pre.of(e.firstPlayer);return r===Pre.RANDOM&&(r=Math.random()<.5?Pre.CREATOR:Pre.CHOSEN_PLAYER),r===Pre.CREATOR?(t=e.creator.name,n=aV.getNonNullable(e.chosenOpponent).name):(t=aV.getNonNullable(e.chosenOpponent).name,n=e.creator.name),{playerZero:t,playerOne:n,turn:0,beginning:n7(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}},{key:"deletePart",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(oV(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)));case 1:case"end":return r.stop()}},r)}))()}},{key:"acceptConfig",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return oV(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),i.next=3,r.joinerService.acceptConfig();case 3:return i.abrupt("return",r.startGameWithConfig(t,Nre.ONE,0,n));case 4:case"end":return i.stop()}},i)}))()}},{key:"startObserving",value:function(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");oV(e.VERBOSE,"[start watching part "+t),this.followedPartId=lV.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}},{key:"resign",value:function(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:N7.RESIGN.value,request:null})}},{key:"notifyTimeout",value:function(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:N7.TIMEOUT.value,request:null})}},{key:"sendRequest",value:function(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}},{key:"proposeDraw",value:function(e,t,n){return this.sendRequest(e,n,t,Dre.drawProposed(n))}},{key:"acceptDraw",value:function(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===Nre.ZERO?N7.AGREED_DRAW_BY_ZERO:N7.AGREED_DRAW_BY_ONE).value,request:null})}},{key:"refuseDraw",value:function(e,t,n){return this.sendRequest(e,n,t,Dre.drawRefused(n))}},{key:"proposeRematch",value:function(e,t,n){return this.sendRequest(e,n,t,Dre.rematchProposed(n))}},{key:"acceptRematch",value:function(t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o,s,u,c,l,h,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return oV(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t}),o=aV.getNonNullable(t.data),a.next=4,i.joinerService.readJoinerById(t.id);case 4:return s=a.sent,u=o.playerZero===s.creator.name?Pre.CHOSEN_PLAYER:Pre.CREATOR,c=Eg(Eg({},s),{},{candidates:[],firstPlayer:u.value,partStatus:Tre.PART_STARTED.value}),a.next=9,i.joinerService.createJoiner(c);case 9:return l=a.sent,h=i.getStartingConfig(c),f=Eg({lastUpdate:{index:0,player:r.value},typeGame:o.typeGame,result:N7.UNACHIEVED.value,listMoves:[]},h),a.next=14,i.partDAO.set(l,f);case 14:return a.next=16,i.createChat(l);case 16:return a.abrupt("return",i.sendRequest(t.id,r,n,Dre.rematchAccepted(o.typeGame,l)));case 17:case"end":return a.stop()}},a)}))()}},{key:"askTakeBack",value:function(e,t,n){return this.sendRequest(e,n,t,Dre.takeBackAsked(n))}},{key:"acceptTakeBack",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o,s,u,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return M7(Dre.getPlayer(aV.getNonNullable(t.data.request))!==n,"Illegal to accept your own request"),o=Dre.takeBackAccepted(n),(s=t.data.listMoves.slice(0,t.data.listMoves.length-1)).length%2===n.value&&(s=s.slice(0,s.length-1)),u={request:o,listMoves:s,turn:s.length,lastUpdateTime:n7(),remainingMsForZero:aV.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:aV.getNonNullable(t.data.remainingMsForOne)-r[1]},c=t.data.lastUpdate.index,a.next=7,i.partDAO.updateAndBumpIndex(e,n,c,u);case 7:return a.abrupt("return",a.sent);case 8:case"end":return a.stop()}},a)}))()}},{key:"refuseTakeBack",value:function(e,t,n){var r=Dre.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}},{key:"addGlobalTime",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o={request:Dre.addGlobalTime(r.getOpponent())},o=r===Nre.ZERO?Eg(Eg({},o),{},{remainingMsForOne:aV.getNonNullable(n.remainingMsForOne)+3e5}):Eg(Eg({},o),{},{remainingMsForZero:aV.getNonNullable(n.remainingMsForZero)+3e5}),a.next=4,i.partDAO.updateAndBumpIndex(e,r,t,o);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}},a)}))()}},{key:"addTurnTime",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a={request:Dre.addTurnTime(e.getOpponent())},i.next=3,r.partDAO.updateAndBumpIndex(n,e,t,a);case 3:return i.abrupt("return",i.sent);case 4:case"end":return i.stop()}},i)}))()}},{key:"stopObserving",value:function(){oV(e.VERBOSE,"GameService.stopObserving();"),this.followedPartId=lV.empty(),this.followedPartUnsubscribe()}},{key:"updateDBBoard",value:function(t,n,r,i,a,o,s,u){var c=this;return iV(regeneratorRuntime.mark(function l(){var h,f,d,v,p;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return oV(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:a,msToSubstract:i,notifyDraw:o,winner:s,loser:u}}),l.next=3,c.partDAO.read(t);case 3:return h=l.sent.get(),f=h.lastUpdate.index,d=h.turn+1,(v=Ure.copyImmutableArray(h.listMoves))[v.length]=r,p={listMoves:v,turn:d,request:null,lastUpdateTime:n7()},p=c.updateScore(p,a),p=c.substractMs(p,h,i),null!=s?p=Eg(Eg({},p),{},{winner:s,loser:u,result:N7.VICTORY.value}):!0===o&&(p=Eg(Eg({},p),{},{result:N7.HARD_DRAW.value})),l.next=14,c.partDAO.updateAndBumpIndex(t,n,f,p);case 14:return l.abrupt("return",l.sent);case 15:case"end":return l.stop()}},l)}))()}},{key:"updateScore",value:function(e,t){return void 0!==t?Eg(Eg({},e),{},{scorePlayerZero:t[0],scorePlayerOne:t[1]}):e}},{key:"substractMs",value:function(e,t,n){return n[0]>0?Eg(Eg({},e),{},{remainingMsForZero:aV.getNonNullable(t.remainingMsForZero)-n[0]}):n[1]>0?Eg(Eg({},e),{},{remainingMsForOne:aV.getNonNullable(t.remainingMsForOne)-n[1]}):e}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(pC(L7),pC(Vre),pC(B7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Hre=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getNavigatorLanguage",value:function(){return navigator.language}},{key:"getLocale",value:function(){var t,n,r=(null!==(t=null!==(n=localStorage.getItem("locale"))&&void 0!==n?n:e.getNavigatorLanguage())&&void 0!==t?t:"fr").slice(0,2).toLowerCase();return["en","fr"].some(function(e){return e===r})?r:"fr"}}]),e}(),Gre=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"changeTheme",value:function(e){localStorage.setItem("theme",e)}},{key:"getTheme",value:function(){return lV.ofNullable(localStorage.getItem("theme"))}},{key:"changeLanguage",value:function(e){localStorage.setItem("locale",e.toLowerCase())}},{key:"getLanguage",value:function(){return Hre.getLocale()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),$re=function(){var e=function(){function e(t,n){Wg(this,e),this.document=t,this.userSettingsService=n,this.availableThemes=["dark","light"];var r=this.getStoredTheme();r.isPresent()?this.loadTheme(r.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}return jg(e,[{key:"getStoredTheme",value:function(){var e=this.userSettingsService.getTheme();if(e.isPresent()){var t=e.get();if(this.availableThemes.some(function(e){return e===t}))return lV.of(t)}return lV.empty()}},{key:"loadTheme",value:function(e){this.loadStyle(e+".css"),this.theme=e}},{key:"loadStyle",value:function(e){var t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{var r=this.document.createElement("link");r.id="theme",r.rel="stylesheet",r.href="".concat(e),t.appendChild(r)}}},{key:"getTheme",value:function(){return this.theme}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(xI),pC(Gre))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Wre={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},qre={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},jre={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},Zre={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},Yre={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},Kre={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]};function Qre(e){return(Qre="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xre(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jre(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Xre(e,t,n[t])})}return e}function eie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,a=u}finally{try{!r&&null!=s.return&&s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var tie={},nie={};try{"undefined"!=typeof window&&(tie=window),"undefined"!=typeof document&&(nie=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch(zwe){}var rie=(tie.navigator||{}).userAgent,iie=void 0===rie?"":rie,aie=tie,oie=nie,sie=!!oie.documentElement&&!!oie.head&&"function"==typeof oie.addEventListener&&"function"==typeof oie.createElement,uie=(~iie.indexOf("MSIE")||iie.indexOf("Trident/"),"___FONT_AWESOME___"),cie="svg-inline--fa",lie=[1,2,3,4,5,6,7,8,9,10],hie=lie.concat([11,12,13,14,15,16,17,18,19,20]),fie={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},die=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",fie.GROUP,fie.SWAP_OPACITY,fie.PRIMARY,fie.SECONDARY].concat(lie.map(function(e){return"".concat(e,"x")})).concat(hie.map(function(e){return"w-".concat(e)})),aie.FontAwesomeConfig||{});oie&&"function"==typeof oie.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=eie(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=oie.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(die[n]=r)});var vie=Jre({},{familyPrefix:"fa",replacementClass:cie,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},die);vie.autoReplaceSvg||(vie.observeMutations=!1);var pie=Jre({},vie);aie.FontAwesomeConfig=pie;var gie=aie||{};gie[uie]||(gie[uie]={}),gie[uie].styles||(gie[uie].styles={}),gie[uie].hooks||(gie[uie].hooks={}),gie[uie].shims||(gie[uie].shims=[]);var yie=gie[uie],mie=[];sie&&((oie.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(oie.readyState)||oie.addEventListener("DOMContentLoaded",function e(){oie.removeEventListener("DOMContentLoaded",e),mie.map(function(e){return e()})}));var kie,_ie="pending",Cie="fulfilled",wie="rejected",bie=function(){},Eie="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,Sie="undefined"==typeof setImmediate?setTimeout:setImmediate,Pie=[];function Oie(){for(var e=0;e<Pie.length;e++)Pie[e][0](Pie[e][1]);Pie=[],kie=!1}function Tie(e,t){Pie.push([e,t]),kie||(kie=!0,Sie(Oie,0))}function Iie(e){var t=e.owner,n=t._state,r=t._data,i=e[n],a=e.then;if("function"==typeof i){n=Cie;try{r=i(r)}catch(o){Mie(a,o)}}Aie(a,r)||(n===Cie&&xie(a,r),n===wie&&Mie(a,r))}function Aie(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===Qre(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?Rie(e,r):xie(e,r))},function(t){n||(n=!0,Mie(e,t))}),!0}}catch(i){return n||Mie(e,i),!0}return!1}function xie(e,t){(e===t||!Aie(e,t))&&Rie(e,t)}function Rie(e,t){e._state===_ie&&(e._state="settled",e._data=t,Tie(Die,e))}function Mie(e,t){e._state===_ie&&(e._state="settled",e._data=t,Tie(Lie,e))}function Nie(e){e._then=e._then.forEach(Iie)}function Die(e){e._state=Cie,Nie(e)}function Lie(e){e._state=wie,Nie(e),!e._handled&&Eie&&global.process.emit("unhandledRejection",e._data,e)}function Fie(e){global.process.emit("rejectionHandled",e)}function Uie(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof Uie))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){Mie(t,e)}try{e(function(e){xie(t,e)},n)}catch(r){n(r)}}(e,this)}Uie.prototype={constructor:Uie,_state:_ie,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(bie),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===wie&&Eie&&Tie(Fie,this)),this._state===Cie||this._state===wie?Tie(Iie,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},Uie.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new Uie(function(t,n){var r=[],i=0;function a(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,s=0;s<e.length;s++)(o=e[s])&&"function"==typeof o.then?o.then(a(s),n):r[s]=o;i||t(r)})},Uie.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new Uie(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},Uie.resolve=function(e){return e&&"object"===Qre(e)&&e.constructor===Uie?e:new Uie(function(t){t(e)})},Uie.reject=function(e){return new Uie(function(t,n){n(e)})};var Bie={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function Vie(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function zie(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Hie(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function Gie(e){return e.size!==Bie.size||e.x!==Bie.x||e.y!==Bie.y||e.rotate!==Bie.rotate||e.flipX||e.flipY}function $ie(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),a="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(a," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var Wie={x:0,y:0,width:"100%",height:"100%"};function qie(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function jie(e){return"g"===e.tag?e.children:[e]}function Zie(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,a=e.iconName,o=e.transform,s=e.symbol,u=e.title,c=e.maskId,l=e.titleId,h=e.extra,f=e.watchable,d=void 0!==f&&f,v=r.found?r:n,p=v.width,g=v.height,y="fak"===i,m=y?"":"fa-w-".concat(Math.ceil(p/g*16)),k=[pie.replacementClass,a?"".concat(pie.familyPrefix,"-").concat(a):"",m].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),_={children:[],attributes:Jre({},h.attributes,{"data-prefix":i,"data-icon":a,class:k,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(p," ").concat(g)})},C=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(p/g*16*.0625,"em")}:{};d&&(_.attributes["data-fa-i2svg"]=""),u&&_.children.push({tag:"title",attributes:{id:_.attributes["aria-labelledby"]||"title-".concat(l||Vie())},children:[u]});var w=Jre({},_,{prefix:i,iconName:a,main:n,mask:r,maskId:c,transform:o,symbol:s,styles:Jre({},C,h.styles)}),b=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,a=e.maskId,o=r.icon,s=i.icon,u=$ie({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),c={tag:"rect",attributes:Jre({},Wie,{fill:"white"})},l=o.children?{children:o.children.map(qie)}:{},h={tag:"g",attributes:Jre({},u.inner),children:[qie(Jre({tag:o.tag,attributes:Jre({},o.attributes,u.path)},l))]},f={tag:"g",attributes:Jre({},u.outer),children:[h]},d="mask-".concat(a||Vie()),v="clip-".concat(a||Vie()),p={tag:"mask",attributes:Jre({},Wie,{id:d,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[c,f]},g={tag:"defs",children:[{tag:"clipPath",attributes:{id:v},children:jie(s)},p]};return t.push(g,{tag:"rect",attributes:Jre({fill:"currentColor","clip-path":"url(#".concat(v,")"),mask:"url(#".concat(d,")")},Wie)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,a=Hie(e.styles);if(a.length>0&&(n.style=a),Gie(i)){var o=$ie({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:Jre({},o.outer),children:[{tag:"g",attributes:Jre({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:Jre({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),E=b.attributes;return w.children=b.children,w.attributes=E,s?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Jre({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(pie.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,a=e.styles,o=e.transform;if(Gie(o)&&n.found&&!r.found){var s={x:n.width/n.height/2,y:.5};i.style=Hie(Jre({},a,{"transform-origin":"".concat(s.x+o.x/16,"em ").concat(s.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var Yie=function(e,t,n,r){var i,a,o,s=Object.keys(e),u=s.length,c=void 0!==r?function(e,t){return function(n,r,i,a){return e.call(t,n,r,i,a)}}(t,r):t;for(void 0===n?(i=1,o=e[s[0]]):(i=0,o=n);i<u;i++)o=c(o,e[a=s[i]],a,e);return o};function Kie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,a=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof yie.hooks.addPack||i?yie.styles[e]=Jre({},yie.styles[e]||{},a):yie.hooks.addPack(e,a),"fas"===e&&Kie("fa",t)}var Qie=yie.styles,Xie=yie.shims,Jie=function(){var e=function(e){return Yie(Qie,function(t,n,r){return t[r]=Yie(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in Qie;Yie(Xie,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function eae(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function tae(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,a=void 0===i?[]:i;return"string"==typeof e?zie(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(zie(e[n]),'" ')},"").trim()}(r),">").concat(a.map(tae).join(""),"</").concat(t,">")}function nae(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}Jie(),(nae.prototype=Object.create(Error.prototype)).constructor=nae;var rae={fill:"currentColor"},iae={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},aae=(Jre({},rae,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),Jre({},iae,{attributeName:"opacity"}));function oae(e){var t=e[0],n=e[1],r=eie(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(pie.familyPrefix,"-").concat(fie.GROUP)},children:[{tag:"path",attributes:{class:"".concat(pie.familyPrefix,"-").concat(fie.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(pie.familyPrefix,"-").concat(fie.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function sae(){pie.autoAddCss&&!hae&&(function(e){if(e&&sie){var t=oie.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=oie.head.childNodes,r=null,i=n.length-1;i>-1;i--){var a=n[i],o=(a.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=a)}oie.head.insertBefore(t,r)}}(function(){var e="fa",t=cie,n=pie.familyPrefix,r=pie.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var a=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),s=new RegExp("\\.".concat(t),"g");i=i.replace(a,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(s,".".concat(r))}return i}()),hae=!0)}function uae(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return tae(e)})}}),Object.defineProperty(e,"node",{get:function(){if(sie){var t=oie.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function cae(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return eae(lae.definitions,n,r)||eae(yie.styles,n,r)}Jre({},rae,{cx:"256",cy:"364",r:"28"}),Jre({},iae,{attributeName:"r",values:"28;14;28;28;14;28;"}),Jre({},aae,{values:"1;0;1;1;0;1;"}),Jre({},rae,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),Jre({},aae,{values:"1;0;0;0;0;1;"}),Jre({},rae,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),Jre({},aae,{values:"0;0;1;1;0;0;"});var lae=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=Jre({},e.definitions[t]||{},i[t]),Kie(t,i[t]),Jie()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,a=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][a]=o}),e}}]),e}()),hae=!1,fae=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:cae(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:cae(i||{})),e(r,Jre({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?Bie:n,i=t.symbol,a=void 0!==i&&i,o=t.mask,s=void 0===o?null:o,u=t.maskId,c=void 0===u?null:u,l=t.title,h=void 0===l?null:l,f=t.titleId,d=void 0===f?null:f,v=t.classes,p=void 0===v?[]:v,g=t.attributes,y=void 0===g?{}:g,m=t.styles,k=void 0===m?{}:m;if(e){var _=e.prefix,C=e.iconName,w=e.icon;return uae(Jre({type:"icon"},e),function(){return sae(),pie.autoA11y&&(h?y["aria-labelledby"]="".concat(pie.replacementClass,"-title-").concat(d||Vie()):(y["aria-hidden"]="true",y.focusable="false")),Zie({icons:{main:oae(w),mask:s?oae(s.icon):{found:!1,width:null,height:null,icon:{}}},prefix:_,iconName:C,transform:Jre({},Bie,r),symbol:a,title:h,maskId:c,titleId:d,extra:{attributes:y,styles:k,classes:p}})})}}),dae=["*"],vae=function(e){var t,n=(Sg(t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip},"fa-".concat(e.size),null!==e.size),Sg(t,"fa-rotate-".concat(e.rotate),null!==e.rotate),Sg(t,"fa-pull-".concat(e.pull),null!==e.pull),Sg(t,"fa-stack-".concat(e.stackItemSize),null!=e.stackItemSize),t);return Object.keys(n).map(function(e){return n[e]?e:null}).filter(function(e){return e})},pae=function(){var e=jg(function e(){Wg(this,e),this.defaultPrefix="fas",this.fallbackIcon=null});return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),gae=function(){var e=function(){function e(){Wg(this,e),this.definitions={}}return jg(e,[{key:"addIcons",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];a.prefix in this.definitions||(this.definitions[a.prefix]={}),this.definitions[a.prefix][a.iconName]=a;var o,s=Hg(a.icon[2]);try{for(s.s();!(o=s.n()).done;){var u=o.value;"string"==typeof u&&(this.definitions[a.prefix][u]=a)}}catch(c){s.e(c)}finally{s.f()}}}},{key:"addIconPacks",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=function(){var t=o[a],n=Object.keys(t).map(function(e){return t[e]});e.addIcons.apply(e,Vg(n))},a=0,o=n;a<o.length;a++)i()}},{key:"getIconDefinition",value:function(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),yae=function(){var e=function(){function e(){Wg(this,e),this.stackItemSize="1x"}return jg(e,[{key:"ngOnChanges",value:function(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ym({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[uk]}),e}(),mae=function(){var e=function(){function e(t,n){Wg(this,e),this.renderer=t,this.elementRef=n}return jg(e,[{key:"ngOnInit",value:function(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}},{key:"ngOnChanges",value:function(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,"fa-".concat(e.size.currentValue)),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,"fa-".concat(e.size.previousValue)))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(hO),QE(uO))},e.\u0275cmp=Gm({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[uk],ngContentSelectors:dae,decls:1,vars:0,template:function(e,t){1&e&&(function(e){var t=Rk()[16][6];if(!t.projection)for(var n=t.projection=nC(1,null),r=n.slice(),i=t.child;null!==i;){r[0]?r[0].projectionNext=i:n[0]=i,r[0]=i,i=i.next}}(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=Rk(),i=Mk(),a=Sb(i,20+e,16,null,n||null);null===a.projection&&(a.projection=t),Vk(),64!=(64&a.flags)&&function(e,t,n){eb(t[11],0,t,n,Lw(e,n,t),Hw(n.parent||t[6],n,t))}(i,r,a)}(0))},encapsulation:2}),e}(),kae=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.sanitizer=t,this.config=n,this.iconLibrary=r,this.stackItem=i,this.classes=[],null!=a&&null==i&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}return jg(e,[{key:"ngOnChanges",value:function(e){var t;if(null==this.icon&&null==this.config.fallbackIcon)return function(){throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")}();var n;if(n=null!==(t=this.icon)&&void 0!==t?t:this.config.fallbackIcon,e){var r=this.findIconDefinition(n);if(null!=r){var i=this.buildParams();this.renderIcon(r,i)}}}},{key:"render",value:function(){this.ngOnChanges({})}},{key:"findIconDefinition",value:function(e){var t,n,r,i,a=(n=e,r=this.config.defaultPrefix,void 0!==(i=n).prefix&&void 0!==i.iconName?n:Array.isArray(n)&&2===n.length?{prefix:n[0],iconName:n[1]}:"string"==typeof n?{prefix:r,iconName:n}:void 0);return"icon"in a?a:null!==(t=this.iconLibrary.getIconDefinition(a.prefix,a.iconName))&&void 0!==t?t:(function(e){throw new Error("Could not find icon with iconName=".concat(e.iconName," and prefix=").concat(e.prefix," in the icon library."))}(a),null)}},{key:"buildParams",value:function(){var e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(this.transform):this.transform;return{title:this.title,transform:t,classes:[].concat(Vg(vae(e)),Vg(this.classes)),mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}},{key:"renderIcon",value:function(e,t){var n=fae(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(_x),QE(pae),QE(gae),QE(yae,8),QE(mae,8))},e.\u0275cmp=Gm({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(HS("innerHTML",t.renderedIconHTML,sw),$E("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[uk],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e}(),_ae=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e}),e.\u0275inj=vm({}),e}();function Cae(e,t){if(1&e){var n=aS();rS(0),eS(1,"div",9),eS(2,"a",10),FS(3),tS(),eS(4,"div",12),eS(5,"a",24),uS("click",function(){return Nk(n),hS().logout()}),WP(6,25),tS(),tS(),tS(),iS()}if(2&e){var r=hS();pb(3),US(r.username)}}var wae=function(){return["/register"]},bae=function(){return["/login"]};function Eae(e,t){1&e&&(eS(0,"div",26),eS(1,"a",27),eS(2,"strong"),WP(3,28),tS(),tS(),eS(4,"a",29),WP(5,30),tS(),tS()),2&e&&(pb(1),XE("routerLink",aT(2,wae)),pb(3),XE("routerLink",aT(3,bae)))}var Sae=function(){return["/"]},Pae=function(){return["/play"]},Oae=function(){return["/lobby"]},Tae=function(){return["/local"]},Iae=function(){return["/tutorial"]},Aae=function(){return["/settings"]},xae=function(){var e=function(){function e(t,n,r){Wg(this,e),this.router=t,this.connectedUserService=n,this.userService=r,this.username="connecting...",this.faCog=qre,this.showMenu=!1}return jg(e,[{key:"ngOnInit",value:function(){var e=this;this.userSub=this.connectedUserService.getUserObs().subscribe(function(t){e.username=t.username.isPresent()?t.username.get():t.email.getOrElse("")})}},{key:"logout",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.connectedUserService.disconnect();case 2:return t.next=4,e.router.navigate(["/"]);case 4:case"end":return t.stop()}},t)}))()}},{key:"ngOnDestroy",value:function(){this.userSub.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL),QE(Sre),QE(G7))},e.\u0275cmp=Gm({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){return[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],$localize(g||(g=wg(["Home"]))),[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],$localize(y||(y=wg(["Play online"]))),[1,"navbar-dropdown"],$localize(m||(m=wg(["Create a game"]))),$localize(k||(k=wg(["Join a game"]))),$localize(_||(_=wg(["Play offline"]))),$localize(C||(C=wg(["Create a game"]))),$localize(w||(w=wg(["Learn the rules"]))),[1,"navbar-end"],["data-tooltip",$localize(b||(b=wg(["Settings"]))),1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["connect",""],["id","logout",1,"navbar-item",3,"click"],$localize(E||(E=wg(["Log out"]))),[1,"buttons"],[1,"button","is-primary",3,"routerLink"],$localize(S||(S=wg(["Register"]))),[1,"button","is-light",3,"routerLink"],$localize(P||(P=wg(["Log in"])))]},template:function(e,t){if(1&e&&(eS(0,"nav",0),eS(1,"div",1),eS(2,"a",2),nS(3,"img",3),tS(),eS(4,"a",4),uS("click",function(){return t.showMenu=!t.showMenu}),nS(5,"span",5),nS(6,"span",5),nS(7,"span",5),tS(),tS(),eS(8,"div",6),uS("click",function(){return t.showMenu=!t.showMenu}),eS(9,"div",7),eS(10,"a",2),WP(11,8),tS(),eS(12,"div",9),eS(13,"a",10),WP(14,11),tS(),eS(15,"div",12),eS(16,"a",2),WP(17,13),tS(),eS(18,"a",2),WP(19,14),tS(),tS(),tS(),eS(20,"div",9),eS(21,"a",10),WP(22,15),tS(),eS(23,"div",12),eS(24,"a",2),WP(25,16),tS(),eS(26,"a",2),WP(27,17),tS(),tS(),tS(),tS(),eS(28,"div",18),eS(29,"a",19),nS(30,"fa-icon",20),tS(),eS(31,"div",21),YE(32,Cae,7,1,"ng-container",22),YE(33,Eae,6,4,"ng-template",null,23,RT),tS(),tS(),tS(),tS()),2&e){var n=KE(34);pb(2),XE("routerLink",aT(12,Sae)),pb(2),XE("ngClass",t.showMenu?"is-active":""),pb(4),XE("ngClass",t.showMenu?"is-active":""),pb(2),XE("routerLink",aT(13,Sae)),pb(6),XE("routerLink",aT(14,Pae)),pb(2),XE("routerLink",aT(15,Oae)),pb(6),XE("routerLink",aT(16,Tae)),pb(2),XE("routerLink",aT(17,Iae)),pb(3),XE("routerLink",aT(18,Aae)),pb(1),XE("icon",t.faCog),pb(2),XE("ngIf",t.username)("ngIfElse",n)}},directives:[KL,NA,kae,UA],encapsulation:2}),e}(),Rae=function(){var e=jg(function e(t,n){Wg(this,e),this._themeService=t,this._errorLoggerService=n});return e.\u0275fac=function(t){return new(t||e)(QE($re),QE(R7))},e.\u0275cmp=Gm({type:e,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container","mt-2"]],template:function(e,t){1&e&&(nS(0,"app-header"),eS(1,"main",0),nS(2,"router-outlet"),tS())},directives:[xae,XL],encapsulation:2}),e}(),Mae=function(){function e(t,n){Wg(this,e),this.x=t,this.y=n}return jg(e,[{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}}]),e}(),Nae=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isDown",value:function(){return 1===this.y}},{key:"isUp",value:function(){return-1===this.y}},{key:"isLeft",value:function(){return-1===this.x}},{key:"isRight",value:function(){return 1===this.x}},{key:"toInt",value:function(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}},{key:"toString",value:function(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}]),n}(Mae),Dae=function(){function e(){Wg(this,e)}return jg(e,[{key:"of",value:function(e,t){var n,r=Hg(this.all);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.x===e&&i.y===t)return S7.success(i)}}catch(a){r.e(a)}finally{r.f()}return S7.failure("Invalid x and y in direction construction")}},{key:"fromDelta",value:function(e,t){return 0===e&&0===t?S7.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):S7.failure(Uae.DIRECTION_MUST_BE_LINEAR())}},{key:"fromMove",value:function(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}},{key:"fromString",value:function(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return S7.failure("Invalid direction string ".concat(e))}}},{key:"fromInt",value:function(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return S7.failure("Invalid int direction: ".concat(e))}}}]),e}(),Lae=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"isDiagonal",value:function(){return 0!==this.x&&0!==this.y}},{key:"getOpposite",value:function(){return n.factory.of(-this.x,-this.y).get()}}]),n}(Nae);Lae.UP=new Lae(0,-1),Lae.UP_RIGHT=new Lae(1,-1),Lae.RIGHT=new Lae(1,0),Lae.DOWN_RIGHT=new Lae(1,1),Lae.DOWN=new Lae(0,1),Lae.DOWN_LEFT=new Lae(-1,1),Lae.LEFT=new Lae(-1,0),Lae.UP_LEFT=new Lae(-1,-1),Lae.factory=new(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).all=[Lae.UP,Lae.UP_RIGHT,Lae.RIGHT,Lae.DOWN_RIGHT,Lae.DOWN,Lae.DOWN_LEFT,Lae.LEFT,Lae.UP_LEFT],e}return jg(n)}(Dae)),Lae.DIRECTIONS=Lae.factory.all,Lae.DIAGONALS=[Lae.UP_RIGHT,Lae.DOWN_RIGHT,Lae.DOWN_LEFT,Lae.UP_LEFT],Lae.ORTHOGONALS=[Lae.UP,Lae.RIGHT,Lae.DOWN,Lae.LEFT],Lae.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return e.toString()}},{key:"decode",value:function(e){return M7("string"==typeof e,"Invalid encoded direction"),Lae.factory.fromString(e).get()}}]),n}(Ire));var Fae=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"getOpposite",value:function(){return n.factory.of(-this.x,-this.y).get()}}]),n}(Nae);Fae.UP=new Fae(0,-1),Fae.RIGHT=new Fae(1,0),Fae.DOWN=new Fae(0,1),Fae.LEFT=new Fae(-1,0),Fae.factory=new(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).all=[Fae.UP,Fae.RIGHT,Fae.DOWN,Fae.LEFT],e}return jg(n,[{key:"of",value:function(e,t){return 0===e&&-1===t?S7.success(Fae.UP):1===e&&0===t?S7.success(Fae.RIGHT):0===e&&1===t?S7.success(Fae.DOWN):-1===e&&0===t?S7.success(Fae.LEFT):S7.failure("Invalid orthogonal from x and y")}}]),n}(Dae)),Fae.ORTHOGONALS=Fae.factory.all,Fae.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return e.toString()}},{key:"decode",value:function(e){return M7("string"==typeof e,"Invalid encoded orthogonal"),Fae.factory.fromString(e).get()}}]),n}(Ire));var Uae=function(){var e=jg(function e(){Wg(this,e)});return e.DIRECTION_MUST_BE_LINEAR=function(){return $localize(O||(O=wg(["You must move in a straight line! You can only move orthogonally or diagonally!"])))},e}(),Bae=function(){function e(t,n){Wg(this,e),this.x=t,this.y=n}return jg(e,[{key:"getNext",value:function(t,n){var r;return new e(this.x+(n=null!==(r=n)&&void 0!==r?r:1)*t.x,this.y+n*t.y)}},{key:"getPrevious",value:function(e,t){var n;return this.getNext(e,-(t=null!==(n=t)&&void 0!==n?n:1))}},{key:"getLeft",value:function(t){return new e(this.x+t.y,this.y+-t.x)}},{key:"getRight",value:function(t){return new e(this.x+-t.y,this.y+t.x)}},{key:"getOpposite",value:function(){return new e(-this.x,-this.y)}},{key:"isInRange",value:function(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}},{key:"isNotInRange",value:function(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}},{key:"getDirectionToward",value:function(e){return Lae.factory.fromMove(this,e)}},{key:"getOrthogonalDistance",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"getDistance",value:function(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}},{key:"isHexagonallyAlignedWith",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}},{key:"isAlignedWith",value:function(e){var t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}},{key:"getVectorToward",value:function(t){return new e(t.x-this.x,t.y-this.y)}},{key:"getMinimalVectorToward",value:function(e){return this.getVectorToward(e).toVector()}},{key:"getCoordsToward",value:function(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];for(var t=this.getDirectionToward(e).get(),n=this.getNext(t,1),r=[];!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}},{key:"toVector",value:function(){for(var t=Math.abs(this.x),n=Math.abs(this.y),r=Math.max(t,n),i=this.x,a=this.y,o=2;o<=r;)i%o==0&&a%o==0?(i/=o,a/=o):o++;return new e(i,a)}},{key:"isBetween",value:function(e,t){var n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}},{key:"getUntil",value:function(e){for(var t=[],n=this.getDirectionToward(e).get(),r=this.getNext(n);!1===r.equals(e);)t.push(r),r=r.getNext(n);return t}},{key:"equals",value:function(e){return this===e||e.x===this.x&&e.y===this.y}},{key:"compareTo",value:function(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}}],[{key:"numberEncoder",value:function(t,n){return xre.tuple([xre.numberEncoder(t),xre.numberEncoder(n)],function(e){return[e.x,e.y]},function(t){return new e(t[0],t[1])})}}]),e}();Bae.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return{x:e.x,y:e.y}}},{key:"decode",value:function(e){var t=e;return M7(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new Bae(t.x,t.y)}}]),n}(Ire));var Vae=function(){var e=function(){function e(t){Wg(this,e),this.messageDisplayer=t,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=lV.empty(),this.imagesLocation="assets/images/"}return jg(e,[{key:"message",value:function(e){this.messageDisplayer.gameMessage(e)}},{key:"cancelMove",value:function(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?T7.SUCCESS:(this.messageDisplayer.gameMessage(e),T7.failure(e))}},{key:"cancelMoveAttempt",value:function(){}},{key:"getPlayerClass",value:function(e){switch(e){case Nre.ZERO:return"player0";case Nre.ONE:return"player1";default:return aV.expectToBe(e,Mre.NONE),""}}},{key:"pass",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",R7.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name}));case 1:case"end":return t.stop()}},t)}))()}},{key:"getTurn",value:function(){return this.rules.node.gameState.turn}},{key:"getCurrentPlayer",value:function(){return this.rules.node.gameState.getCurrentPlayer()}},{key:"getState",value:function(){return this.rules.node.gameState}},{key:"getPreviousState",value:function(){return this.rules.node.mother.get().gameState}},{key:"range",value:function(e){for(var t=[],n=0;n<e;n++)t.push(n);return t}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),zae=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getHexaCoordsBy",value:function(e,t){var n=new Bae(e,t);return this.getHexaCoordsAt(n)}},{key:"getHexaCoordsAt",value:function(e){var t,n="",r=this.hexaLayout.getHexaCoordsAt(e),i=Hg(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;n+=a.x+" "+a.y+" "}}catch(o){i.e(o)}finally{i.f()}return n+=r[0].x+" "+r[0].y}},{key:"getCenterBy",value:function(e,t){var n=new Bae(e,t);return this.getCenterAt(n)}},{key:"getCenterAt",value:function(e){return this.hexaLayout.getCenterAt(e)}}]),n}(Vae);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275cmp=Gm({type:t,selectors:[["ng-component"]],features:[xE],decls:0,vars:0,template:function(e,t){},encapsulation:2}),t}(),Hae=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"equals",value:function(e){return this===e}},{key:"is",value:function(e){return this.value===e.value}},{key:"isPlayer",value:function(){return this===e.ZERO||this===e.ONE}}],[{key:"from",value:function(t){switch(t){case e.ZERO.value:return e.ZERO;case e.ONE.value:return e.ONE;case e.EMPTY.value:return e.EMPTY;case e.UNREACHABLE.value:return e.UNREACHABLE;default:throw new Error("FourStatePiece has no value matching "+t)}}},{key:"ofPlayer",value:function(t){switch(t){case Nre.ZERO:return e.ZERO;default:return aV.expectToBe(t,Nre.ONE),e.ONE}}}]),e}();Hae.ZERO=new Hae(Nre.ZERO.value),Hae.ONE=new Hae(Nre.ONE.value),Hae.EMPTY=new Hae(Mre.NONE.value),Hae.UNREACHABLE=new Hae(3);var Gae=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"getOpposite",value:function(){return n.factory.of(-this.x,-this.y).get()}}],[{key:"getAngle",value:function(e){switch(e){case n.UP:return 0;case n.UP_RIGHT:return 60;case n.RIGHT:return 120;case n.DOWN:return 180;case n.DOWN_LEFT:return 240;default:return aV.expectToBe(e,n.LEFT),300}}}]),n}(Nae);Gae.UP=new Gae(0,-1),Gae.LEFT=new Gae(-1,0),Gae.UP_RIGHT=new Gae(1,-1),Gae.DOWN_LEFT=new Gae(-1,1),Gae.RIGHT=new Gae(1,0),Gae.DOWN=new Gae(0,1),Gae.factory=new(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).all=[Gae.UP,Gae.UP_RIGHT,Gae.RIGHT,Gae.DOWN,Gae.DOWN_LEFT,Gae.LEFT],e}return jg(n)}(Dae)),Gae.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 5}},{key:"encodeNumber",value:function(e){switch(e){case Gae.UP:return 0;case Gae.UP_RIGHT:return 1;case Gae.RIGHT:return 2;case Gae.DOWN:return 3;case Gae.DOWN_LEFT:return 4;default:return 5}}},{key:"decodeNumber",value:function(e){return M7(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),Gae.factory.all[e]}}]),n}(xre));var $ae=function(){function e(t,n,r){Wg(this,e),this.size=t,this.origin=n,this.orientation=r}return jg(e,[{key:"getCenterAt",value:function(e){var t=this.orientation.conversionMatrix;return new Bae(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}},{key:"getCornerOffset",value:function(e){var t=2*Math.PI*(this.orientation.startAngle+e)/6;return new Bae(this.size*Math.cos(t),this.size*Math.sin(t))}},{key:"getHexaCoordsAt",value:function(e){for(var t=this.getCenterAt(e),n=[],r=0;r<6;r+=1){var i=this.getCornerOffset(r);n.push(new Bae(t.x+i.x,t.y+i.y))}return n}}]),e}(),Wae=jg(function e(){Wg(this,e)}),qae=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this)).startAngle=.5,e.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],e.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3],e}return jg(n)}(Wae);qae.INSTANCE=new qae;var jae=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.call(this)).startAngle=0,e.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],e.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3],e}return jg(n,[{key:"isOnBorder",value:function(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}},{key:"isOnTopRightBorder",value:function(e,t){return 0===t.y}},{key:"isOnRightBorder",value:function(e,t){return t.x===e.width-1}},{key:"isOnLeftBorder",value:function(e,t){return 0===t.x}},{key:"isOnBottomLeftBorder",value:function(e,t){return t.y===e.height-1}},{key:"isOnTopLeftBorder",value:function(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}},{key:"isOnBottomRightBorder",value:function(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}},{key:"getAllBorders",value:function(e){var t=this,n=[];return e.forEachCoord(function(r,i){t.isOnBorder(e,r)&&n.push(r)}),n}},{key:"isTopCorner",value:function(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}},{key:"isTopLeftCorner",value:function(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}},{key:"isTopRightCorner",value:function(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}},{key:"isBottomCorner",value:function(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}},{key:"isBottomLeftCorner",value:function(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}},{key:"isBottomRightCorner",value:function(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}]),n}(Wae);jae.INSTANCE=new jae;var Zae=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_CHOOSE_OPPONENT_PIECE=function(){return $localize(T||(T=wg(["You cannot pick a piece of the opponent."])))},e.MUST_CLICK_ON_EMPTY_SPACE=function(){return $localize(I||(I=wg(["You must click on an empty space."])))},e.MUST_CLICK_ON_EMPTY_SQUARE=function(){return $localize(A||(A=wg(["You must click on an empty square."])))},e.CANNOT_SELF_CAPTURE=function(){return $localize(x||(x=wg(["Your landing space should be empty or contain a piece of the opponent."])))},e.MUST_CHOOSE_PLAYER_PIECE=function(){return $localize(R||(R=wg(["You must pick one of your pieces."])))},e.CANNOT_PASS=function(){return $localize(M||(M=wg(["You cannot pass your turn."])))},e.MUST_LAND_ON_EMPTY_SPACE=function(){return $localize(N||(N=wg(["You must drop your piece on an empty space."])))},e.MUST_PASS=function(){return $localize(D||(D=wg(["You must pass your turn."])))},e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=function(){return $localize(L||(L=wg(["You have selected an empty space, you must select one of your own pieces."])))},e.MOVE_CANNOT_BE_STATIC=function(){return $localize(F||(F=wg(["You must choose different starting and ending coordinates."])))},e.SOMETHING_IN_THE_WAY=function(){return $localize(U||(U=wg(["There is a piece between the piece you chose and its landing space."])))},e}(),Yae=function(){function e(t,n){Wg(this,e),this.ruler=t,this.name=n}return jg(e,[{key:"toString",value:function(){return this.name}}]),e}(),Kae=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"toString",value:function(){return""+this.value}}],[{key:"fromWinner",value:function(t){return t.isPlayer()?new e(t.getVictoryValue()):new e(0)}}]),e}(),Qae=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"toComparableObjectSet",value:function(e){var t=[];return e.forEach(function(e){t.some(function(t){return t.equals(e)})||t.push(e)}),t}},{key:"toComparableSet",value:function(e){var t=[];return e.forEach(function(e){t.some(function(t){return cV(t,e)})||t.push(e)}),t}}]),e}(),Xae=function(e){function t(e){Wg(this,t),this.values=void 0===e?[]:Qae.toComparableSet(e)}return jg(t,[{key:"equals",value:function(e){if(e.size()!==this.size())return!1;var t,n=Hg(this);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!1===e.contains(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}},{key:"toString",value:function(){var e,t="",n=Hg(this);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=null==r?"null, ":r.toString()+", "}}catch(i){n.e(i)}finally{n.f()}return"["+t.slice(0,-2)+"]"}},{key:"add",value:function(e){return!this.contains(e)&&(this.values.push(e),!0)}},{key:"union",value:function(e){var t,n=Hg(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.add(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"contains",value:function(e){var t,n=Hg(this.values);try{for(n.s();!(t=n.n()).done;){if(cV(t.value,e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"size",value:function(){return this.values.length}},{key:"toList",value:function(){var e,t=[],n=Hg(this);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r)}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"getAnyElement",value:function(){return this.size()>0?lV.of(this.values[0]):lV.empty()}},{key:Symbol.iterator,value:function(){return this.values.values()}}]),t}(),Jae=function(){function e(t){Wg(this,e),this.turn=t}return jg(e,[{key:"getCurrentPlayer",value:function(){return Nre.fromTurn(this.turn)}},{key:"getCurrentOpponent",value:function(){return this.turn%2==1?Nre.ZERO:Nre.ONE}}]),e}(),eoe=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,r)).board=e,i}return jg(n,[{key:"getPieceAt",value:function(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}},{key:"tryToGetPieceAt",value:function(e){return this.isOnBoard(e)?lV.of(this.board[e.y][e.x]):lV.empty()}},{key:"isOnBoard",value:function(e){return e.isInRange(this.board[0].length,this.board.length)}},{key:"getPieceAtXY",value:function(e,t){return this.getPieceAt(new Bae(e,t))}},{key:"forEachCoord",value:function(e){var t,n=Hg(this.getCoordsAndContents());try{for(n.s();!(t=n.n()).done;){var r=Pg(t.value,2);e(r[0],r[1])}}catch(i){n.e(i)}finally{n.f()}}},{key:"getCoordsAndContents",value:function(){for(var e=[],t=0;t<this.board.length;t++)for(var n=0;n<this.board[t].length;n++){var r=new Bae(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}},{key:"getCopiedBoard",value:function(){return Ure.copyBiArray(this.board)}}]),n}(Jae),toe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isInBoard",value:function(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==Hae.UNREACHABLE}},{key:"isPiece",value:function(e){return this.getPieceAt(e).isPlayer()}},{key:"getScores",value:function(){for(var e=[14,14],t=0;t<9;t++)for(var n=0;n<9;n++)this.getPieceAtXY(n,t)===Hae.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===Hae.ONE&&(e[0]=e[0]-1);return e}}],[{key:"getInitialState",value:function(){var e=Hae.EMPTY,t=Hae.UNREACHABLE,r=Hae.ZERO,i=Hae.ONE;return new n([[t,t,t,t,i,i,i,i,i],[t,t,t,i,i,i,i,i,i],[t,t,e,e,i,i,i,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,r,r,r,e,e,t,t],[r,r,r,r,r,r,t,t,t],[r,r,r,r,r,t,t,t,t]],0)}}]),n}(eoe),noe=jg(function e(){Wg(this,e)}),roe=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).coord=new Bae(e,r),i}return jg(n)}(noe),ioe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;if(Wg(this,n),(a=t.call(this,e.x,e.y)).dir=r,a.lastPiece=i,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!");return Lg(a)}return jg(n,[{key:"toString",value:function(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}},{key:"isSingleCoord",value:function(){return this.lastPiece.isAbsent()}},{key:"equals",value:function(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}],[{key:"fromSingleCoord",value:function(e,t){try{return S7.success(new n(e,t,lV.empty()))}catch(r){return S7.failure(r.message)}}},{key:"fromDoubleCoord",value:function(e,t,r){var i=[e,t];Ure.sortByDescending(i,n.sortCoord);var a=i[1].getDirectionToward(i[0]).get(),o=Gae.factory.fromDelta(a.x,a.y);if(o.isFailure())return S7.failure("Invalid direction");var s=o.get();return i[1].getDistance(i[0])>2?S7.failure("Distance between first coord and last coord is too great"):s.equals(r)?n.fromSingleCoord(i[1],r):s.getOpposite().equals(r)?n.fromSingleCoord(i[0],r):S7.success(new n(i[1],r,lV.of(i[0])))}},{key:"sortCoord",value:function(e){return 9*e.y+e.x}}]),n}(roe);ioe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 104831}},{key:"encodeNumber",value:function(e){var t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;var n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}},{key:"decodeNumber",value:function(e){var t=e%8;e=(e-t)/8;var n=Gae.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;var a=new Bae(i,r);if(0===e)return ioe.fromSingleCoord(a,n).get();var o=(e=(e-1)/2)%9,s=(e=(e-o)/9)%9;e=(e-s)/9;var u=new Bae(s,o);return ioe.fromDoubleCoord(a,u,n).get()}}]),n}(xre));var aoe=(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(aoe||(aoe={})),aoe),ooe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Wg(this,e),this.map=t,this.isImmutable=n}return jg(e,[{key:"makeImmutable",value:function(){this.isImmutable=!0}},{key:"get",value:function(e){var t,n=Hg(this.map);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(cV(r.key,e))return lV.of(r.value)}}catch(i){n.e(i)}finally{n.f()}return lV.empty()}},{key:"forEach",value:function(e){for(var t=0;t<this.map.length;t++)e(this.getByIndex(t))}},{key:"getByIndex",value:function(e){return this.map[e]}},{key:"putAll",value:function(e){this.checkImmutability("putAll");var t,n=Hg(e.map);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.put(r.key,r.value)}}catch(i){n.e(i)}finally{n.f()}}},{key:"checkImmutability",value:function(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}},{key:"put",value:function(e,t){this.checkImmutability("put");var n,r=Hg(this.map);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(cV(i.key,e)){var a=i.value;return i.value=t,lV.of(a)}}}catch(o){r.e(o)}finally{r.f()}return this.map.push({key:e,value:t}),lV.empty()}},{key:"containsKey",value:function(e){return this.map.some(function(t){return cV(t.key,e)})}},{key:"size",value:function(){return this.map.length}},{key:"listKeys",value:function(){return this.map.map(function(e){return e.key})}},{key:"getKeySet",value:function(){return new Xae(this.listKeys())}},{key:"filter",value:function(t){var n,r=new e,i=Hg(this.map);try{for(i.s();!(n=i.n()).done;){var a=n.value;t(a.key,a.value)&&r.set(a.key,a.value)}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"replace",value:function(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}},{key:"set",value:function(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}},{key:"delete",value:function(e){this.checkImmutability("delete");for(var t=0;t<this.map.length;t++)if(cV(this.map[t].key,e)){var n=this.map[t].value,r=this.map.slice(0,t),i=this.map.slice(t+1);return this.map=r.concat(i),n}throw new Error('No Value to delete for key "'+e.toString()+'"!')}},{key:"getCopy",value:function(){var e,t=new this.constructor,n=Hg(this.listKeys());try{for(n.s();!(e=n.n()).done;){var r=e.value;t.set(r,this.get(r).get())}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"equals",value:function(e){var t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;var r,i=Hg(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this.get(a).get(),s=e.get(a);if(M7(s.isPresent(),"value is absent in a map even though its key is present!"),!1===cV(o,s.get()))return!1}}catch(u){i.e(u)}finally{i.f()}return!0}}],[{key:"from",value:function(t){for(var n=Object.keys(t),r=new e,i=0,a=n;i<a.length;i++){var o=a[i];r.set(o,t[o])}return r}}]),e}(),soe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"reverse",value:function(){var e,t=new n,r=Hg(this.listKeys());try{for(r.s();!(e=r.n()).done;){var i=e.value,a=this.get(i).get();if(t.containsKey(a))t.get(a).get().add(i);else{var o=new Xae;o.add(i),t.set(a,o)}}}catch(s){r.e(s)}finally{r.f()}return t}}]),n}(ooe),uoe=function(){var e=jg(function e(){Wg(this,e)});return e.createdNodes=0,e.minimaxTime=0,e}(),coe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lV.empty(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lV.empty(),i=arguments.length>3?arguments[3]:void 0;if(Wg(this,e),this.gameState=t,this.mother=n,this.move=r,this.minimaxCreator=i,this.childs=lV.empty(),this.hopedValue=new ooe,this.ownValue=new ooe,this.possibleMoves=new ooe,this.ownValue=new ooe,null!=i){var a=i.getBoardValue(this);this.ownValue.set(i.name,a),this.hopedValue.set(i.name,a.value)}uoe.createdNodes++,oV(e.VERBOSE||!1,"creating "+this.myToString())}return jg(e,[{key:"findBestMove",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=(new Date).getTime(),a=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);a.gameState.turn>this.gameState.turn+1;)a=a.mother.get(),e--;return uoe.minimaxTime+=(new Date).getTime()-i,a.move.get()}},{key:"alphaBeta",value:function(t,n,r,i,a,o){if(t<1)return oV(e.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+t),this;if(i.ruler.getGameStatus(this).isEndGame)return oV(e.VERBOSE||!1,"isLeaf-EndGame("+e.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+t),this;var s=this.getPossibleMoves(i);M7(s.size()>0,"Minimax "+i.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=lV.of([]));var u=this.getBestChilds(s,t,n,r,i,a,o),c=this.getBestChildAmongst(u,a),l=c.hopedValue.get(i.toString()).get();return this.hopedValue.put(i.toString(),l),c}},{key:"getPossibleMoves",value:function(e){var t=this.possibleMoves.get(e.name);if(t.isAbsent()){var n=e.getListMoves(this);return this.possibleMoves.set(e.name,new Xae(n)),new Xae(n)}return t.get()}},{key:"getBestChilds",value:function(e,t,n,r,i,a,o){var s,u=[],c=this.gameState.getCurrentPlayer(),l=c===Nre.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,h=c===Nre.ZERO?function(e,t){return e<t}:function(e,t){return e>t},f=Hg(e);try{for(f.s();!(s=f.n()).done;){var d=s.value,v=this.getOrCreateChild(d,i).alphaBeta(t-1,n,r,i,a,o),p=v.getHopedValue(i);if(h(p,l)||0===u.length?(l=p,u=[v]):p===l&&u.push(v),o&&h(l,c===Nre.ZERO?n:r))break;c===Nre.ZERO?r=Math.min(l,r):n=Math.max(l,n)}}catch(g){f.e(g)}finally{f.f()}return u}},{key:"getBestChildAmongst",value:function(e,t){return t?e[Math.floor(Math.random()*e.length)]:e[0]}},{key:"getOrCreateChild",value:function(t,n){var r=this.getSonByMove(t);if(r.isAbsent()){var i=n.ruler.isLegal(t,this.gameState),a=t.toString();M7(i.isSuccess(),'The minimax "'+n.name+'" has proposed an illegal move ('+a+"), this should not happen.");var o=n.ruler.applyLegalMove(t,this.gameState,i.get());r=lV.of(new e(o,lV.of(this),lV.of(t),n)),this.childs.get().push(r.get())}return r.get()}},{key:"getSonByMove",value:function(e){M7(this.childs.isPresent(),"Cannot get son of uncalculated node");var t,n=Hg(this.childs.get());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.move.isPresent()&&r.move.equalsValue(e))return lV.of(r)}}catch(i){n.e(i)}finally{n.f()}return lV.empty()}},{key:"getInitialNode",value:function(){for(var e=this;e.mother.isPresent();)e=e.mother.get();return e}},{key:"getHopedValue",value:function(e){return this.hopedValue.get(e.name).get()}},{key:"getOwnValue",value:function(e){var t=this.ownValue.get(e.name);if(t.isAbsent()){var n=e.getBoardValue(this);return this.ownValue.set(e.name,n),n}return t.get()}},{key:"myToString",value:function(){var e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}},{key:"hasMoves",value:function(){return this.childs.isPresent()}},{key:"countDescendants",value:function(){if(this.childs.isAbsent())return 0;var e,t=this.childs.get().length,n=Hg(this.childs.get());try{for(n.s();!(e=n.n()).done;){t+=e.value.countDescendants()}}catch(r){n.e(r)}finally{n.f()}return t}}],[{key:"getScoreStatus",value:function(t){var n=!1;return t===Number.MAX_SAFE_INTEGER||t===Number.MIN_SAFE_INTEGER?(oV(e.VERBOSE||n,"VICTORY"),aoe.VICTORY):t===Number.MIN_SAFE_INTEGER+1?(oV(e.VERBOSE||n,"PRE_VICTORY_MIN"),aoe.PRE_VICTORY):t===Number.MAX_SAFE_INTEGER-1?(oV(e.VERBOSE||n,"PRE_VICTORY_MAX"),aoe.PRE_VICTORY):(oV(e.VERBOSE||n,"DEFAULT"),aoe.DEFAULT)}}]),e}();coe.VERBOSE=!1,coe.minimaxes=new ooe;var loe=function(){function e(t,n){Wg(this,e),this.isEndGame=t,this.winner=n}return jg(e,[{key:"toBoardValue",value:function(){return this.winner.isPlayer()?this.winner.getVictoryValue():0}}],[{key:"getVictory",value:function(t){return t===Nre.ZERO?e.ZERO_WON:e.ONE_WON}},{key:"getDefeat",value:function(t){return t===Nre.ZERO?e.ONE_WON:e.ZERO_WON}}]),e}();loe.ZERO_WON=new loe(!0,Nre.ZERO),loe.ONE_WON=new loe(!0,Nre.ONE),loe.DRAW=new loe(!0,Mre.NONE),loe.ONGOING=new loe(!1,Mre.NONE);var hoe=function(){function e(t){Wg(this,e),this.stateType=t,this.setInitialBoard()}return jg(e,[{key:"choose",value:function(e){var t=!1;oV(t,"Rules.choose: "+e.toString()+" was proposed");var n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){oV(t,"Rules.choose: current node has moves");var r=this.node.getSonByMove(e);if(r.isPresent())return M7(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),oV(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(oV(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return oV(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;oV(t,"Rules.choose: Move is legal, let's apply it");var i=this.applyLegalMove(e,this.node.gameState,n.get()),a=new coe(i,lV.of(this.node),lV.of(e));return this.node=a,!0}},{key:"setInitialBoard",value:function(){if(null==this.node){var e=this.stateType.getInitialState();coe.ruler=this,this.node=new coe(e)}else this.node=this.node.getInitialNode()}},{key:"applyMoves",value:function(e,t,n){var r,i=0,a=Hg(e);try{for(a.s();!(r=a.n()).done;){var o=n(r.value),s=this.isLegal(o,t);M7(s.isSuccess(),"Can't create state from invalid moves ("+i+"): "+s.toString()+"."),t=this.applyLegalMove(o,t,s.get()),i++}}catch(u){a.e(u)}finally{a.f()}return t}}]),e}(),foe=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=function(){return $localize(B||(B=wg(["You cannot move more than 3 of your pieces!"])))},e.NOT_ENOUGH_PIECE_TO_PUSH=function(){return $localize(V||(V=wg(["You don't have enough pieces to push that group!"])))},e.CANNOT_PUSH_YOUR_OWN_PIECES=function(){return $localize(z||(z=wg(["You cannot push this piece because it is blocked by one of yours!"])))},e.MUST_ONLY_TRANSLATE_YOUR_PIECES=function(){return $localize(H||(H=wg(["This line contains pieces of your opponent or empty spaces, which is forbidden."])))},e.TRANSLATION_IMPOSSIBLE=function(){return $localize(G||(G=wg(["This move is impossible, some landing spaces are occupied."])))},e.LINE_AND_COORD_NOT_ALIGNED=function(){return $localize($||($=wg(["This space is not aligned with the current line."])))},e}(),doe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return new toe(n,t.turn+1)}},{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"isLegal",value:function(e,t){var r=this.getFirstPieceValidity(e,t);return r.isFailure()?r.toFailedFallible():e.isSingleCoord()?n.isLegalPush(e,t):n.isLegalSideStep(e,t)}},{key:"getFirstPieceValidity",value:function(e,t){var n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?T7.failure(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===Hae.ofPlayer(t.getCurrentOpponent())?T7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):T7.SUCCESS}},{key:"isLegalPush",value:function(e,t){var r=1,i=e.coord.getNext(e.dir),a=Hae.ofPlayer(t.getCurrentPlayer()),o=Hae.EMPTY,s=t.getCopiedBoard();for(s[e.coord.y][e.coord.x]=o;r<=3&&t.isOnBoard(i)&&t.getPieceAt(i)===a;)r++,i=i.getNext(e.dir);return r>3?S7.failure(foe.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(i)||(s[i.y][i.x]=a,t.getPieceAt(i)===o)?S7.success(s):n.isLegalRealPush(i,e,t,r,s)}},{key:"isLegalRealPush",value:function(e,t,n,r,i){for(var a=0,o=Hae.ofPlayer(n.getCurrentOpponent()),s=Hae.ofPlayer(n.getCurrentPlayer());a<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)a++,e=e.getNext(t.dir);return a>=r?S7.failure(foe.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===Hae.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===s)?S7.failure(foe.CANNOT_PUSH_YOUR_OWN_PIECES()):S7.success(i)}},{key:"isLegalSideStep",value:function(e,t){var n=e.lastPiece.get(),r=e.coord.getDirectionToward(n).get();n=n.getNext(r);for(var i=e.coord,a=Hae.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==a)return S7.failure(foe.MUST_ONLY_TRANSLATE_YOUR_PIECES());var s=i.getNext(e.dir);if(o[i.y][i.x]=Hae.EMPTY,s.isInRange(9,9)){if(t.isPiece(s))return S7.failure(foe.TRANSLATION_IMPOSSIBLE());t.getPieceAt(s)===Hae.EMPTY&&(o[s.y][s.x]=a)}i=i.getNext(r)}return S7.success(o)}},{key:"getGameStatus",value:function(e){var t=e.gameState.getScores();return t[0]>5?loe.ZERO_WON:t[1]>5?loe.ONE_WON:loe.ONGOING}}]),n}(hoe),voe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){for(var t=[],n=e.gameState,r=n.getCurrentPlayer(),i=0;i<9;i++)for(var a=0;a<9;a++){var o=new Bae(a,i);if(!1!==n.getPieceAt(o).is(r)){var s,u=Hg(Gae.factory.all);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=ioe.fromSingleCoord(o,c).get();if(this.isAcceptablePush(l,n)){t.push(l);var h,f=Hg(Gae.factory.all);try{for(f.s();!(h=f.n()).done;)for(var d=h.value,v=1;v<=2&&!d.equals(c);v++){var p=o.getNext(d,v);if(!p.isInRange(9,9))break;var g=ioe.fromDoubleCoord(o,p,c).get();doe.isLegal(g,n).isSuccess()&&t.push(g)}}catch(y){f.e(y)}finally{f.f()}}}}catch(y){u.e(y)}finally{u.f()}}}return new Xae(t).toList()}},{key:"isAcceptablePush",value:function(e,t){var n=t.getScores(),r=doe.isLegal(e,t);if(r.isSuccess()){var i=t.getCurrentOpponent().value;return!(new toe(r.get(),t.turn+1).getScores()[i]>n[i])}return!1}},{key:"getBoardValue",value:function(e){var t=doe.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n=e.gameState.getScores();return new Kae(n[1]-n[0])}}]),n}(Yae),poe=function(){function e(t,n,r){Wg(this,e),this.title=t,this.instruction=n,this.state=r,this.previousMove=lV.empty()}return jg(e,[{key:"isMove",value:function(){return!1}},{key:"isAnyMove",value:function(){return!1}},{key:"isClick",value:function(){return!1}},{key:"isPredicate",value:function(){return!1}},{key:"isInformation",value:function(){return!1}},{key:"hasSolution",value:function(){return!1}},{key:"withPreviousMove",value:function(e){return this.previousMove=lV.of(e),this}}],[{key:"fromMove",value:function(e,t,n,r,i,a){return new yoe(e,t,n,r,i,a)}},{key:"forClick",value:function(e,t,n,r,i,a){return new koe(e,t,n,r,i,a)}},{key:"anyMove",value:function(e,t,n,r,i){return new moe(e,t,n,r,i)}},{key:"fromPredicate",value:function(e,t,n,r,i,a){return new _oe(e,t,n,r,i,a)}},{key:"informational",value:function(e,t,n){return new Coe(e,t,n)}}]),e}(),goe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r,i)).successMessage=a,o}return jg(n,[{key:"hasSolution",value:function(){return!0}},{key:"getSuccessMessage",value:function(){return this.successMessage}}]),n}(poe),yoe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,i,o)).acceptedMoves=a,u.failureMessage=s,M7(a.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational"),u}return jg(n,[{key:"isMove",value:function(){return!0}},{key:"getSolution",value:function(){return this.acceptedMoves[0]}},{key:"getFailureMessage",value:function(){return this.failureMessage}}]),n}(goe),moe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this,e,r,i,o)).solutionMove=a,s}return jg(n,[{key:"getSolution",value:function(){return this.solutionMove}},{key:"isAnyMove",value:function(){return!0}}]),n}(goe),koe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,i,o)).acceptedClicks=a,u.failureMessage=s,u}return jg(n,[{key:"isClick",value:function(){return!0}},{key:"getSolution",value:function(){return this.acceptedClicks[0]}},{key:"getFailureMessage",value:function(){return this.failureMessage}}]),n}(goe),_oe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,i,s)).solutionMove=a,u.predicate=o,u}return jg(n,[{key:"getSolution",value:function(){return this.solutionMove}},{key:"isPredicate",value:function(){return!0}}]),n}(goe),Coe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isInformation",value:function(){return!0}}]),n}(poe),woe=Hae.EMPTY,boe=Hae.UNREACHABLE,Eoe=Hae.ZERO,Soe=Hae.ONE,Poe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(W||(W=wg(["Initial board and goal of the game"]))),$localize(q||(q=wg(["At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!"]))),toe.getInitialState()),poe.anyMove($localize(j||(j=wg(["Moving a piece"]))),$localize(Z||(Z=wg(["At each turn, move one, two, or three pieces either along their line, or on their side.\n        For your moves you can therefore choose between up to 6 directions.\n        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).\n        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>\n        You're playing Dark, make any move!"]))),toe.getInitialState(),ioe.fromSingleCoord(new Bae(2,6),Gae.UP).get(),$localize(Y||(Y=wg(["Congratulations!"])))),poe.fromMove($localize(K||(K=wg(["Pushing"]))),$localize(Q||(Q=wg(["To push one opponent piece, you must move at least two of your pieces.\n        To push two opponent pieces, you must move three of your pieces.\n        If one of your pieces is in the way, it will be impossible to push.\n        You cannot move more than three pieces.<br/><br/>\n        Only one push towards the right is possible here, find it. (You're playing Dark)."]))),new toe([[boe,boe,boe,boe,woe,Eoe,Eoe,Soe,Soe],[boe,boe,boe,woe,woe,woe,woe,woe,woe],[boe,boe,woe,Eoe,Eoe,Eoe,Soe,Eoe,woe],[boe,woe,woe,woe,woe,woe,woe,woe,woe],[woe,woe,woe,woe,Eoe,Eoe,Eoe,Soe,Soe],[woe,woe,woe,woe,woe,woe,woe,woe,boe],[woe,woe,woe,woe,Eoe,Soe,woe,boe,boe],[woe,woe,woe,Eoe,woe,woe,boe,boe,boe],[woe,woe,Eoe,woe,woe,boe,boe,boe,boe]],0),[ioe.fromSingleCoord(new Bae(4,4),Gae.RIGHT).get()],$localize(X||(X=wg(["Congratulations! You know everything you need to start a game!"]))),$localize(J||(J=wg(["Failed!"]))))]});function Ooe(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",6),uS("click",function(){Nk(n);var e=hS(2).index,t=hS().index;return hS().onPieceClick(e,t)}),tS()}if(2&e){var r=hS(2).index,i=hS().index,a=hS();vS("id","piece_",r,"_",i,""),XE("ngClass",a.getPieceClasses(r,i)),$E("cx",a.getCenterBy(r,i).x)("cy",a.getCenterBy(r,i).y)("r",.5*a.SPACE_SIZE)}}function Toe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"polyline",4),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onCaseClick(e,t)}),tS(),YE(2,Ooe,1,6,"circle",5),tS()}if(2&e){var r=hS(),i=r.index,a=r.$implicit,o=hS().index,s=hS();pb(1),vS("id","case_",i,"_",o,""),XE("ngClass",s.getSquareClasses(i,o)),$E("points",s.getHexaCoordsBy(i,o)),pb(1),XE("ngIf",s.isPiece(a))}}function Ioe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Toe,3,5,"g",3),tS()),2&e){var n=t.$implicit,r=hS(2);pb(1),XE("ngIf",r.isBoard(n))}}function Aoe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Ioe,2,1,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function xoe(e,t){1&e&&(c_(),eS(0,"marker",7),nS(1,"polygon",8),tS()),2&e&&dS("id","arrowhead_",t.$implicit.dir.toString(),"")}function Roe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),nS(1,"line",9),eS(2,"line",10),uS("click",function(){var e=Nk(n).$implicit;return hS().chooseDirection(e.dir)}),tS(),eS(3,"polygon",11),uS("click",function(){var e=Nk(n).$implicit;return hS().chooseDirection(e.dir)}),tS(),tS()}if(2&e){var r=t.$implicit;pb(1),dS("id","line_start_",r.dir.toString(),""),$E("x1",r.startCenter.x)("y1",r.startCenter.y)("x2",r.middle.x)("y2",r.middle.y),pb(1),dS("id","line_end_",r.dir.toString(),""),$E("x1",r.middle.x)("y1",r.middle.y)("x2",r.landingCenter.x)("y2",r.landingCenter.y),pb(1),dS("id","direction_",r.dir.toString(),""),$E("transform",r.transformation)}}var Moe=jg(function e(t,n,r,i,a,o){Wg(this,e),this.startCenter=t,this.middle=n,this.landingCenter=r,this.landing=i,this.dir=a,this.transformation=o}),Noe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).moveds=[],r.directions=[],r.selecteds=[],r.rules=new doe(toe),r.availableMinimaxes=[new voe(r.rules,"Dummy")],r.encoder=ioe.encoder,r.tutorial=(new Poe).tutorial,r.scores=lV.of([0,0]),r.SPACE_SIZE=30,r.hexaLayout=new $ae(r.SPACE_SIZE,new Bae(-8*r.SPACE_SIZE,2*r.SPACE_SIZE),qae.INSTANCE),r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=lV.of(this.rules.node.gameState.getScores())}},{key:"hidePreviousMove",value:function(){this.moveds=[]}},{key:"cancelMoveAttempt",value:function(){this.directions=[],this.selecteds=[]}},{key:"showPreviousMove",value:function(){var e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}},{key:"showPushingMove",value:function(e){var t=this.rules.node.mother.get().gameState,n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}},{key:"showSideStepMove",value:function(e){var t=e.lastPiece.get(),n=e.coord.getDirectionToward(t).get();t=t.getNext(n);for(var r=e.coord;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}},{key:"onPieceClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#piece_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return a=n.rules.node.gameState.getCurrentOpponent(),r.abrupt("return",n.hexaBoard[t][e].is(a)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t));case 5:case"end":return r.stop()}},r)}))()}},{key:"opponentClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.tryChoosingDirection(e,t);case 2:if(!r.sent.isSuccess()){r.next=6;break}r.t0=T7.SUCCESS,r.next=7;break;case 6:r.t0=n.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE());case 7:return r.abrupt("return",r.t0);case 8:case"end":return r.stop()}},r)}))()}},{key:"firstClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(n.selecteds=[new Bae(e,t)],n.showPossibleDirections(),T7.SUCCESS));case 1:case"end":return r.stop()}},r)}))()}},{key:"showPossibleDirections",value:function(){this.directions=[],this.showDirection(1===this.selecteds.length)}},{key:"showDirection",value:function(e){var t,n=this.rules.node.gameState,r=Hae.ofPlayer(n.getCurrentPlayer()),i=this.selecteds[0],a=this.selecteds[this.selecteds.length-1],o=Hg(Gae.factory.all);try{for(o.s();!(t=o.n()).done;){var s,u=t.value,c=i.getNext(u,1);if(n.isOnBoard(c)&&n.getPieceAt(c)===r){if(e)continue;if(c=a.getNext(u,1),n.isOnBoard(c)&&n.getPieceAt(c)===r)continue}if(s=e?ioe.fromSingleCoord(i,u).get():ioe.fromDoubleCoord(i,a,u).get(),this.rules.isLegal(s,n).isSuccess()){var l=this.getCenterAt(i),h=this.getCenterAt(c),f=this.getMiddleOfArrow(u,c,h),d=h.x+" "+h.y,v=Gae.getAngle(u)+150,p=new Moe(l,f,h,c,u,"rotate("+v+" "+d+") translate("+d+")");this.directions.push(p)}}}catch(g){o.e(g)}finally{o.f()}}},{key:"getMiddleOfArrow",value:function(e,t,n){var r=t.getPrevious(e),i=this.getCenterAt(r);return new Bae(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}},{key:"isBoard",value:function(e){return e!==Hae.UNREACHABLE}},{key:"isPiece",value:function(e){return e!==Hae.EMPTY}},{key:"secondClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n.selecteds[0],!(a=new Bae(e,t)).equals(i)){r.next=3;break}return r.abrupt("return",(n.cancelMoveAttempt(),T7.SUCCESS));case 3:if(!1!==a.isHexagonallyAlignedWith(i)){r.next=5;break}return r.abrupt("return",(n.cancelMoveAttempt(),n.firstClick(e,t)));case 5:if(!((o=a.getDistance(i))>2)){r.next=8;break}return r.abrupt("return",n.cancelMove(foe.CANNOT_MOVE_MORE_THAN_THREE_PIECES()));case 8:for(s=i.getDirectionToward(a).get(),n.selecteds=[i],u=0;u<o;u++)n.selecteds.push(i.getNext(s,u+1));if(3!==n.selecteds.length){r.next=15;break}if(c=n.selecteds[1],l=n.rules.node.gameState.getCurrentPlayer(),!1!==n.hexaBoard[c.y][c.x].is(l)){r.next=15;break}return r.abrupt("return",(n.cancelMoveAttempt(),n.firstClick(e,t)));case 15:return r.abrupt("return",(n.showPossibleDirections(),T7.SUCCESS));case 16:case"end":return r.stop()}},r)}))()}},{key:"thirdClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new Bae(e,t),a=n.selecteds[0],!i.equals(a)){r.next=3;break}return r.abrupt("return",n.deselectExtremity(!0));case 3:return o=n.selecteds[n.selecteds.length-1],r.abrupt("return",i.equals(o)?n.deselectExtremity(!1):3===n.selecteds.length&&i.equals(n.selecteds[1])?(n.cancelMoveAttempt(),T7.SUCCESS):n.tryExtension(i,a,o));case 5:case"end":return r.stop()}},r)}))()}},{key:"tryExtension",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o,s,u,c;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(a=Lae.factory.fromMove(t,e)).isSuccess()){i.next=6;break}if(o=Lae.factory.fromMove(n,e),!a.equals(o)){i.next=6;break}return s=t.getDistance(e),u=n.getDistance(e),i.abrupt("return",2===Math.max(s,u)?(r.selecteds.push(e),Ure.sortByDescending(r.selecteds,ioe.sortCoord),r.showPossibleDirections(),T7.SUCCESS):r.cancelMove(foe.CANNOT_MOVE_MORE_THAN_THREE_PIECES()));case 6:return c=r.cancelMove(foe.LINE_AND_COORD_NOT_ALIGNED()),i.next=9,r.firstClick(e.x,e.y);case 9:return i.abrupt("return",c);case 10:case"end":return i.stop()}},i)}))()}},{key:"deselectExtremity",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),T7.SUCCESS));case 1:case"end":return n.stop()}},n)}))()}},{key:"chooseDirection",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.canUserPlay("#direction_"+e.toString()),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):t._chooseDirection(e));case 2:case"end":return n.stop()}},n)}))()}},{key:"_chooseDirection",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.rules.node.gameState,a=t.selecteds[0],n.abrupt("return",(i=1===t.selecteds.length?ioe.fromSingleCoord(a,e).get():ioe.fromDoubleCoord(a,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(i,r,t.scores.get())));case 3:case"end":return n.stop()}},n)}))()}},{key:"onCaseClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.canUserPlay("#case_"+e+"_"+t),r.abrupt("return",i.isFailure()?n.cancelMove(i.getReason()):n.tryChoosingDirection(e,t));case 2:case"end":return r.stop()}},r)}))()}},{key:"tryChoosingDirection",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=new Bae(e,t),a=Hg(n.directions),r.prev=2,a.s();case 4:if((o=a.n()).done){r.next=10;break}if(!(s=o.value).landing.equals(i)){r.next=8;break}return r.abrupt("return",n._chooseDirection(s.dir));case 8:r.next=4;break;case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),a.e(r.t0);case 15:return r.prev=15,a.f(),r.finish(15);case 18:return r.abrupt("return",T7.failure("not a direction"));case 19:case"end":return r.stop()}},r,null,[[2,12,15,18]])}))()}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t),r=[];return this.moveds.some(function(e){return e.equals(n)})&&r.push("moved"),r}},{key:"getPieceClasses",value:function(e,t){var n=new Bae(e,t),r=Nre.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(function(e){return e.equals(n)})&&i.push("highlighted"),i}}]),n}(zae);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-abalone"]],features:[xE],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Aoe,2,1,"g",1),eS(2,"defs"),YE(3,xoe,2,1,"marker",2),tS(),YE(4,Roe,4,12,"g",1),tS()),2&e&&(pb(1),XE("ngForOf",t.hexaBoard),pb(2),XE("ngForOf",t.directions),pb(1),XE("ngForOf",t.directions))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Doe=function(){function e(t){Wg(this,e),this.x=t}return jg(e,[{key:"equals",value:function(e){return this.x===e.x}}],[{key:"from",value:function(t){switch(t){case 0:return e.ZERO;case 1:return e.ONE;case 2:return e.TWO;default:return M7(3===t,"Invalid Apagos Coord "+t),e.THREE}}}]),e}();Doe.ZERO=new Doe(0),Doe.ONE=new Doe(1),Doe.TWO=new Doe(2),Doe.THREE=new Doe(3);var Loe=function(){var e=jg(function e(){Wg(this,e)});return e.PIECE_SHOULD_MOVE_DOWNWARD=function(){return $localize(ee||(ee=wg(["Pieces should only move downward!"])))},e.CANNOT_LAND_ON_A_FULL_SQUARE=function(){return $localize(te||(te=wg(["That square is already full, you cannot put a piece in it!"])))},e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=function(){return $localize(ne||(ne=wg(["You have no pieces in that square, select one that contains at least one of your pieces!"])))},e.NO_PIECE_REMAINING_TO_DROP=function(){return $localize(re||(re=wg(["There are no remaining pieces of that color to drop!"])))},e.NO_POSSIBLE_TRANSFER_REMAINS=function(){return $localize(ie||(ie=wg(["There is no possible transfer from that square!"])))},e}(),Foe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).landing=e,a.piece=r,a.starting=i,a}return jg(n,[{key:"isDrop",value:function(){return this.piece.isPresent()}},{key:"toString",value:function(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}},{key:"equals",value:function(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}],[{key:"drop",value:function(e,t){return aV.getNonNullable(n.ALL_MOVES.find(function(n){return n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(lV.empty())}))}},{key:"transfer",value:function(e,t){if(e.x<=t.x)return S7.failure(Loe.PIECE_SHOULD_MOVE_DOWNWARD());var r=aV.getNonNullable(n.ALL_MOVES.find(function(n){return n.landing.equals(t)&&n.piece.equals(lV.empty())&&n.starting.equals(lV.of(e))}));return S7.success(r)}}]),n}(noe);Foe.ALL_MOVES=[new Foe(Doe.ZERO,lV.of(Nre.ZERO),lV.empty()),new Foe(Doe.ONE,lV.of(Nre.ZERO),lV.empty()),new Foe(Doe.TWO,lV.of(Nre.ZERO),lV.empty()),new Foe(Doe.THREE,lV.of(Nre.ZERO),lV.empty()),new Foe(Doe.ZERO,lV.of(Nre.ONE),lV.empty()),new Foe(Doe.ONE,lV.of(Nre.ONE),lV.empty()),new Foe(Doe.TWO,lV.of(Nre.ONE),lV.empty()),new Foe(Doe.THREE,lV.of(Nre.ONE),lV.empty()),new Foe(Doe.TWO,lV.empty(),lV.of(Doe.THREE)),new Foe(Doe.ONE,lV.empty(),lV.of(Doe.THREE)),new Foe(Doe.ZERO,lV.empty(),lV.of(Doe.THREE)),new Foe(Doe.ONE,lV.empty(),lV.of(Doe.TWO)),new Foe(Doe.ZERO,lV.empty(),lV.of(Doe.TWO)),new Foe(Doe.ZERO,lV.empty(),lV.of(Doe.ONE))],Foe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return Foe.ALL_MOVES.length}},{key:"encodeNumber",value:function(e){var t=Foe.ALL_MOVES.findIndex(function(t){return t.equals(e)});return M7(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}},{key:"decodeNumber",value:function(e){return M7(e<Foe.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),Foe.ALL_MOVES[e]}}]),n}(xre));var Uoe=function(){function e(t){Wg(this,e),this.containing=t}return jg(e,[{key:"isFull",value:function(){return this.count(Nre.ZERO)+this.count(Nre.ONE)>=this.count(Mre.NONE)}},{key:"count",value:function(e){return this.containing.get(e).get()}},{key:"addPiece",value:function(t){var n=this.count(Nre.ZERO),r=this.count(Nre.ONE),i=this.count(Mre.NONE);return t===Nre.ZERO?n++:r++,e.from(n,r,i).get()}},{key:"substractPiece",value:function(t){var n=this.count(Nre.ZERO),r=this.count(Nre.ONE),i=this.count(Mre.NONE);return t===Nre.ZERO?n--:r--,e.from(n,r,i).get()}},{key:"getDominatingPlayer",value:function(){var e=this.count(Nre.ZERO),t=this.count(Nre.ONE);return e>t?Nre.ZERO:t>e?Nre.ONE:Mre.NONE}},{key:"equals",value:function(e){return this.containing.equals(e.containing)}}],[{key:"from",value:function(t,n,r){if(t+n>r)return S7.failure("invalid starting space");var i=new ooe([{key:Nre.ZERO,value:t},{key:Nre.ONE,value:n},{key:Mre.NONE,value:r}]);i.makeImmutable();var a=new e(i);return S7.success(a)}}]),e}(),Boe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e)).board=r,a.remaining=i,a.remaining.makeImmutable(),a}return jg(n,[{key:"getPieceAt",value:function(e){return this.board[e.x]}},{key:"updateAt",value:function(e,t){for(var r=[],i=0;i<4;i++)r.push(e.x===i?t:this.board[i]);var a=this.getRemainingCopy();return new n(this.turn,r,a)}},{key:"getRemainingCopy",value:function(){return this.remaining.getCopy()}},{key:"getRemaining",value:function(e){return this.remaining.get(e).get()}},{key:"equals",value:function(e){return this.turn===e.turn&&Ure.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}],[{key:"getInitialState",value:function(){return n.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}},{key:"fromRepresentation",value:function(e,t,r,i){for(var a=[],o=0;o<4;o++){var s=Uoe.from(t[0][o],t[1][o],t[2][o]).get();a.push(s)}var u=new ooe;return u.set(Nre.ZERO,r),u.set(Nre.ONE,i),new n(e,a,u)}}]),n}(Jae);return e.PIECES_PER_PLAYER=10,e}(),Voe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}},{key:"applyLegalDrop",value:function(e,t){var n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);var i=new Boe(t.turn+1,t.board,n),a=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(a);if(e.landing===Doe.THREE)return i.updateAt(e.landing,o);var s=Doe.from(e.landing.x+1),u=i.getPieceAt(s);return i.updateAt(e.landing,u).updateAt(s,o)}},{key:"applyLegalTransfer",value:function(e,t){var n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),a=t.getPieceAt(e.landing).addPiece(n),o=t.updateAt(r,i);return o=o.updateAt(e.landing,a),new Boe(o.turn+1,o.board,o.remaining)}},{key:"isLegal",value:function(e,t){return t.getPieceAt(e.landing).isFull()?S7.failure(Loe.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}},{key:"isLegalDrop",value:function(e,t){return t.getRemaining(e.piece.get())<=0?S7.failure(Loe.NO_PIECE_REMAINING_TO_DROP()):S7.success(void 0)}},{key:"isLegalSlideDown",value:function(e,t){var n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?S7.failure(Loe.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){for(var t=e.gameState,n=0;n<4;n++)if(!1===t.getPieceAt(Doe.from(n)).isFull())return loe.ONGOING;var r=t.getPieceAt(Doe.THREE).getDominatingPlayer();return M7(r.isPlayer(),"winner can only be a player if the game is finished"),loe.getVictory(r)}}],[{key:"get",value:function(){return n.singleton.isAbsent()&&(n.singleton=lV.of(new n(Boe))),this.singleton.get()}}]),n}(hoe);Voe.singleton=lV.empty();var zoe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=e.gameState;return Foe.ALL_MOVES.filter(function(e){return Voe.get().isLegal(e,t).isSuccess()})}},{key:"getBoardValue",value:function(e){var t=Voe.get().getGameStatus(e);if(t.isEndGame)return Kae.fromWinner(t.winner);var n=e.gameState.board[3].getDominatingPlayer();return n.isPlayer()?new Kae(n.getScoreModifier()):new Kae(0)}}]),n}(Yae),Hoe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(ae||(ae=wg(["Initial board and goal of the game"]))),$localize(oe||(oe=wg(["At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!"]))),Boe.getInitialState()),poe.anyMove($localize(se||(se=wg(["Drop"]))),$localize(ue||(ue=wg(["There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You're playing Light.<br/><br/>Drop a piece on one of those three squares."]))),Boe.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),Foe.drop(Doe.ZERO,Nre.ZERO),$localize(ce||(ce=wg(["Congratulations!"])))),poe.fromPredicate($localize(le||(le=wg(["Transfer"]))),$localize(he||(he=wg(["The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!"]))),Boe.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),Foe.transfer(Doe.TWO,Doe.ZERO).get(),function(e,t){return e.isDrop()?T7.failure($localize(fe||(fe=wg(["This move is a drop, please do a transfer!"])))):T7.SUCCESS},$localize(de||(de=wg(["Congratulations!"])))),poe.fromPredicate($localize(ve||(ve=wg(["Victory"]))),$localize(pe||(pe=wg(["When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!"]))),Boe.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),Foe.drop(Doe.TWO,Nre.ONE),function(e,t){return e.isDrop()?e.piece.equalsValue(Nre.ONE)?T7.SUCCESS:T7.failure($localize(ge||(ge=wg(["You actively made your opponent win!"])))):T7.failure($localize(ye||(ye=wg(["Wrong choice, your opponent will win in the next turn no matter which piece is dropped!"]))))},$localize(me||(me=wg(["Congratulations!"]))))]});function Goe(e,t){if(1&e&&(c_(),nS(0,"circle",5)),2&e){var n=t.$implicit,r=hS();$E("cx",(n+1)*r.PIECE_RADIUS)("cy",r.PIECE_RADIUS)("r",r.PIECE_RADIUS-5)}}function $oe(e,t){if(1&e){var n=aS();c_(),eS(0,"polygon",7),uS("click",function(){Nk(n);var e=hS().index,t=hS();return t.onArrowClick(e,t.PlayerOrNone.ZERO)}),tS()}if(2&e){var r=hS().index,i=hS();dS("id","dropArrow_zero_",r,""),XE("ngClass",i.getArrowClasses(r,i.PlayerOrNone.ZERO)),$E("points",i.ARROW_COORD)("transform",i.getArrowTransform(r,i.PlayerOrNone.ZERO))}}function Woe(e,t){if(1&e){var n=aS();c_(),eS(0,"polygon",7),uS("click",function(){Nk(n);var e=hS().index,t=hS();return t.onArrowClick(e,t.PlayerOrNone.ONE)}),tS()}if(2&e){var r=hS().index,i=hS();dS("id","dropArrow_one_",r,""),XE("ngClass",i.getArrowClasses(r,i.PlayerOrNone.ONE)),$E("points",i.ARROW_COORD)("transform",i.getArrowTransform(r,i.PlayerOrNone.ONE))}}function qoe(e,t){if(1&e){var n=aS();c_(),rS(0),eS(1,"circle",8),uS("click",function(){Nk(n);var e=hS().index;return hS().onSquareClick(e)}),tS(),iS()}if(2&e){var r=t.$implicit,i=hS(),a=i.index,o=i.$implicit,s=hS();pb(1),pS("id","square_",a,"_piece_",r,"_out_of_",o.count(s.PlayerOrNone.NONE),""),XE("ngClass",s.getPieceClasses(a,r,o)),$E("cx",s.getCircleCenter(a,r,o).x)("cy",s.getCircleCenter(a,r,o).y)}}function joe(e,t){if(1&e){var n=aS();c_(),rS(0),YE(1,$oe,1,4,"polygon",6),YE(2,Woe,1,4,"polygon",6),eS(3,"rect",7),uS("click",function(){var e=Nk(n).index;return hS().onSquareClick(e)}),tS(),YE(4,qoe,2,6,"ng-container",3),iS()}if(2&e){var r=t.$implicit,i=t.index,a=hS();pb(1),XE("ngIf",a.canDisplayArrow(i,a.PlayerOrNone.ZERO)),pb(1),XE("ngIf",a.canDisplayArrow(i,a.PlayerOrNone.ONE)),pb(1),dS("id","square_",i,""),XE("ngClass",a.getSquareClasses(i)),$E("x",i*a.SPACE_SIZE)("y",(5-i)*a.SPACE_SIZE*.25)("width",a.SPACE_SIZE)("height",a.SPACE_SIZE),pb(1),XE("ngForOf",a.range(r.count(a.PlayerOrNone.NONE)))}}function Zoe(e,t){if(1&e&&(c_(),nS(0,"circle",9)),2&e){var n=t.$implicit,r=hS();$E("cx",4*r.SPACE_SIZE-(n+1)*r.PIECE_RADIUS)("cy",2.25*r.SPACE_SIZE+3*r.PIECE_RADIUS)("r",r.PIECE_RADIUS-5)}}var Yoe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).PlayerOrNone=Mre,r.ARROW_COORD=n.getArrowCoord(),r.PIECES_PER_PLAYER=Boe.PIECES_PER_PLAYER,r.selectedPiece=lV.empty(),r.leftPiece=lV.empty(),r.droppedPiece=lV.empty(),r.displayableArrow=[],r.rules=new Voe(Boe),r.availableMinimaxes=[new zoe(r.rules,"ApagosDummyMinimax")],r.encoder=Foe.encoder,r.tutorial=(new Hoe).tutorial,r.PIECE_RADIUS=200/(r.PIECES_PER_PLAYER+1),r.updateBoard(),r}return jg(n,[{key:"cancelMoveAttempt",value:function(){this.selectedPiece=lV.empty(),this.showPossibleDrops()}},{key:"updateBoard",value:function(){var e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(Nre.ZERO).get(),this.remainingOne=e.remaining.get(Nre.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}},{key:"hideLastMove",value:function(){this.movedSquare=[],this.droppedPiece=lV.empty(),this.leftPiece=lV.empty(),this.selectedPiece=lV.empty()}},{key:"showLastMove",value:function(){var e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}},{key:"showLastDrop",value:function(e){var t=e.piece.get(),n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));var r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=lV.of({square:n,piece:r})}},{key:"getLowestPlayerPiece",value:function(e,t){var n=e.count(t);return t===Nre.ZERO?n-1:e.count(Mre.NONE)-n}},{key:"showLastTransfer",value:function(e){var t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=lV.of({square:r,piece:i});var a=e.landing.x,o=this.getLowestPlayerPiece(this.board[a],n);this.droppedPiece=lV.of({square:a,piece:o})}},{key:"showPossibleDrops",value:function(){this.displayableArrow=[];for(var e=this.rules.node.gameState,t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(Nre.ZERO).get()>0&&this.displayableArrow.push({x:t,player:Nre.ZERO}),e.remaining.get(Nre.ONE).get()>0&&this.displayableArrow.push({x:t,player:Nre.ONE}))}},{key:"getCircleCenter",value:function(e,t,n){var r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(Mre.NONE))return new Bae(r,i);var a=n.count(Mre.NONE),o=2*t*Math.PI/a-Math.PI/2,s=.3*this.SPACE_SIZE,u=s*Math.cos(o),c=s*Math.sin(o);return new Bae(r+u,i+c)}},{key:"canDisplayArrow",value:function(e,t){return this.displayableArrow.some(function(n){return n.x===e&&n.player.equals(t)})}},{key:"getArrowClasses",value:function(e,t){return[this.getPlayerClass(t)]}},{key:"getArrowTransform",value:function(e,t){var n=t===Nre.ZERO?0:.5*this.SPACE_SIZE;return"translate("+(n+=e*this.SPACE_SIZE)+", "+(3-e)*this.SPACE_SIZE*.25+")"}},{key:"getSquareClasses",value:function(e){var t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}},{key:"onArrowClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#dropArrow_"+(t===Nre.ZERO?"zero":"one")+"_"+e)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return a=Doe.from(e),n.selectedPiece.isPresent()?(s=n.selectedPiece.get().square,o=Foe.transfer(Doe.from(s),a).get()):o=Foe.drop(a,t),r.abrupt("return",n.chooseMove(o,n.rules.node.gameState));case 6:case"end":return r.stop()}},r)}))()}},{key:"getPieceClasses",value:function(e,t,n){var r={square:e,piece:t},i=[],a=n.count(Nre.ZERO),o=n.count(Nre.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===Nre.ZERO?a++:o++}var s=n.count(Mre.NONE)-(o+a),u=this.getPieceColor(t,a,s);return""!==u&&i.push(u),i}},{key:"getPieceColor",value:function(e,t,n){return e<t?"player0":e>=t+n?"player1":""}},{key:"onSquareClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#square_"+e)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if(!t.selectedPiece.isPresent()||t.selectedPiece.get().square!==e){n.next=5;break}return n.abrupt("return",(t.cancelMoveAttempt(),T7.SUCCESS));case 5:return i=t.rules.node.gameState.getCurrentPlayer(),a=t.board[e],n.abrupt("return",a.count(i)<=0?t.cancelMove(Loe.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=lV.of({square:e,piece:t.getLowestPlayerPiece(a,i)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(Loe.NO_POSSIBLE_TRANSFER_REMAINS()):T7.SUCCESS));case 7:case"end":return n.stop()}},n)}))()}},{key:"showAndGetPossibleTranfers",value:function(){this.displayableArrow=[];for(var e=this.selectedPiece.get().square-1,t=this.rules.node.gameState.getCurrentPlayer();0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}],[{key:"getArrowCoord",value:function(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}}]),n}(Vae);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-apagos"]],features:[xE],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Goe,1,3,"circle",1),eS(2,"g",2),YE(3,joe,5,9,"ng-container",3),tS(),YE(4,Zoe,1,3,"circle",4),tS()),2&e&&(pb(1),XE("ngForOf",t.range(t.remainingZero)),pb(1),$E("transform","translate(0, "+2*t.PIECE_RADIUS+")"),pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.range(t.remainingOne)))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Koe=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n)}(Vae);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275cmp=Gm({type:t,selectors:[["ng-component"]],features:[xE],decls:0,vars:0,template:function(e,t){},encapsulation:2}),t}(),Qoe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).captured=i,a}return jg(n,[{key:"getCapturedCopy",value:function(){return[this.captured[0],this.captured[1]]}}],[{key:"getInitialState",value:function(){return new n(Ure.createTable(6,2,4),0,[0,0])}}]),n}(eoe),Xoe=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=function(){return $localize(ke||(ke=wg(["You cannot distribute from the opponent's home."])))},e.MUST_CHOOSE_NONEMPTY_HOUSE=function(){return $localize(_e||(_e=wg(["You should choose a non-empty house to distribute."])))},e.SHOULD_DISTRIBUTE=function(){return $localize(Ce||(Ce=wg(["You should distribute but you do not."])))},e}(),Joe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){oV(n.VERBOSE,{called:"AwaleRules.applyLegalMove",move:e,state:t});var i=e.x,a=t.getCurrentPlayer().value,o=t.getCurrentPlayer().getOpponent().value,s=t.getCopiedBoard(),u=n.distribute(i,a,s);if(u.y===a)return new Qoe(s,t.turn+1,t.captured);var c=[0,0],l=Ure.copyBiArray(s);return c[a]=n.capture(u.x,o,a,s),c[a]>0&&n.isStarving(o,s)&&(s=l,c=[0,0]),n.isStarving(a,s)&&!1===n.canDistribute(o,s)&&(c[o]+=n.mansoon(o,s)),c[0]+=t.captured[0],c[1]+=t.captured[1],new Qoe(s,t.turn+1,c)}},{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"mansoon",value:function(e,t){var n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}},{key:"isLegal",value:function(e,t){var r=t.getCurrentPlayer().value,i=t.getCurrentPlayer().getOpponent().value,a=e.x;if(0===t.getPieceAtXY(a,r))return S7.failure(Xoe.MUST_CHOOSE_NONEMPTY_HOUSE());var o=n.isStarving(i,t.board),s=!1===n.doesDistribute(a,r,t.board);return o&&s?S7.failure(Xoe.SHOULD_DISTRIBUTE()):S7.success(void 0)}},{key:"doesDistribute",value:function(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}},{key:"canDistribute",value:function(e,t){for(var r=0;r<6;r++)if(n.doesDistribute(r++,e,t))return!0;return!1}},{key:"isStarving",value:function(e,t){var n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}},{key:"distribute",value:function(e,t,n){var r=e,i=t,a=n[t][e];for(n[t][e]=0;a>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,a--);return new Bae(e,t)}},{key:"capture",value:function(e,t,n,r){M7(t!==n,"AwaleRules.capture called with wrong values of x and player");var i=r[t][e];if(i<2||i>3)return 0;var a=0,o=-1,s=-1;0===n&&(o=1,s=6);do{a+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==s&&(2===i||3===i));return a}},{key:"getGameStatus",value:function(e){var t=e.gameState;return t.captured[0]>24?loe.ZERO_WON:t.captured[1]>24?loe.ONE_WON:24===t.captured[0]&&24===t.captured[1]?loe.DRAW:loe.ONGOING}}]),n}(hoe);return e.VERBOSE=!1,e}(),ese=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).x=e,r}return jg(n,[{key:"equals",value:function(e){return e===this||e.x===this.x}},{key:"toString",value:function(){return"AwaleMove("+this.x+")"}}],[{key:"from",value:function(e){switch(e){case 0:return n.ZERO;case 1:return n.ONE;case 2:return n.TWO;case 3:return n.THREE;case 4:return n.FOUR;default:return M7(5===e,"Invalid x for AwaleMove: "+e),n.FIVE}}}]),n}(noe);ese.ZERO=new ese(0),ese.ONE=new ese(1),ese.TWO=new ese(2),ese.THREE=new ese(3),ese.FOUR=new ese(4),ese.FIVE=new ese(5),ese.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 5}},{key:"encodeNumber",value:function(e){return e.x}},{key:"decodeNumber",value:function(e){return ese.from(e)}}]),n}(xre));var tse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t,n=[],r=e.gameState,i=r.turn%2,a=0;do{0!==r.getPieceAtXY(a,i)&&(t=ese.from(a),Joe.isLegal(t,r).isSuccess()&&(t=ese.from(a),n.push(t))),a++}while(a<6);return this.orderMoves(e,n)}},{key:"orderMoves",value:function(e,t){var n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return Ure.sortByDescending(t,function(t){var i,a=e.gameState.getCopiedBoard(),o=a[n][t.x],s=Joe.distribute(t.x,n,a),u=0;return s.y===n?(i=0,o<=6&&(u=10)):i=Joe.capture(s.x,r,n,a),100*i+u-o}),t}},{key:"getBoardValue",value:function(e){var t=Joe.getGameStatus(e);if(t.isEndGame)return Kae.fromWinner(t.winner);var n=e.gameState.getCapturedCopy();return new Kae(n[1]-n[0])}}]),n}(Yae),nse=jg(function e(){Wg(this,e),this.tutorial=[poe.anyMove($localize(we||(we=wg(["Sowing"]))),$localize(be||(be=wg(["Awal\xe9 is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.\n         Let's see how seeds are sown.\n         As you're playing first, the 6 houses on the top are yours.<br/><br>\n         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house."]))),Qoe.getInitialState(),ese.ZERO,$localize(Ee||(Ee=wg(["Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.\n        This is how seeds are sown:\n        one by one from the house next to the one they come from, clockwise."])))),poe.anyMove($localize(Se||(Se=wg(["Big sowing"]))),$localize(Pe||(Pe=wg(["You are now the second player (on the bottom).\n        When there are enough seeds to make a full turn, something else happens.<br/><br/>\n        Sow the house that contains 12 seeds."]))),new Qoe([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),ese.ONE,$localize(Oe||(Oe=wg(["See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds)."])))),poe.fromMove($localize(Te||(Te=wg(["Simple capture"]))),$localize(Ie||(Ie=wg(["After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.\n         Then, the player looks at the preceding house:\n         if it is still in the opponent's side and contains two or three seeds, they are also captured.\n         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>\n         You are the second player, try to capture some pieces!"]))),new Qoe([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[ese.ZERO],$localize(Ae||(Ae=wg(["Well done! This was a simple capture, now let us see how to make multiple captures."]))),$localize(xe||(xe=wg(["Failed. Try again and sow from the leftmost house."])))),poe.fromMove($localize(Re||(Re=wg(["Multiple captures"]))),$localize(Me||(Me=wg(["By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.\n        As these are consecutive houses, all seeds in them will be captured.<br/><br/>\n        Capture them."]))),new Qoe([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[ese.ZERO],$localize(Ne||(Ne=wg(["Nice, you win 3 points from the first house, and 2 from the second!"]))),$localize(De||(De=wg(["Failed. Try again."])))),poe.fromMove($localize(Le||(Le=wg(["Interrupted capture"]))),$localize(Fe||(Fe=wg(["By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>\n        Do it."]))),new Qoe([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[ese.ZERO],$localize(Ue||(Ue=wg(["Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house."]))),$localize(Be||(Be=wg(["Failed. Try again."])))),poe.fromMove($localize(Ve||(Ve=wg(["Capture on the other side only"]))),$localize(ze||(ze=wg(["Try to capture the two leftmost houses of the opponent."]))),new Qoe([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[ese.ONE],$localize(He||(He=wg(["Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!"]))),$localize(Ge||(Ge=wg(["You have only captured one house, try again!"])))),poe.fromMove($localize($e||($e=wg(["Do not starve"]))),$localize(We||(We=wg(["You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>\n        Try it."]))),new Qoe([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[ese.ZERO],$localize(qe||(qe=wg(["Sadly, you cannot capture here, otherwise the opponent could not play after you.\n        When this happens, the move can be made, but no capture takes place!"]))),$localize(je||(je=wg(["Failed. Try again."])))),poe.anyMove($localize(Ze||(Ze=wg(["Feeding is mandatory"]))),$localize(Ye||(Ye=wg(["You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>\n        Go ahead!"]))),new Qoe([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),ese.THREE,$localize(Ke||(Ke=wg(["Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.\n        It is often a good way to have easy captures!"])))),poe.anyMove($localize(Qe||(Qe=wg(["End of the game"]))),$localize(Xe||(Xe=wg(["A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>\n         Sow the house on the top right."]))),new Qoe([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),ese.FIVE,$localize(Je||(Je=wg(["Also, as soon as on player cannot play, the other player captures all the seeds in its own side.\n         Here, it was the first player's turn, and the second player has taken all the remaining seeds."]))))]});function rse(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",4),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),tS(),eS(2,"text",5),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),FS(3),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","click_",i,"_",a,""),XE("ngClass",o.getSquareClasses(i,a)),$E("cx",50+100*i)("cy",50+120*a),pb(1),$E("x",50+100*i)("y",66+120*a),pb(1),BS(" ",r," ")}}function ise(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,rse,4,8,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var ase=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).last=lV.empty(),r.captured=[],r.moved=[],r.scores=lV.of([0,0]),r.rules=new Joe(Qoe),r.availableMinimaxes=[new tse(r.rules,"AwaleMinimax")],r.encoder=ese.encoder,r.tutorial=(new nse).tutorial,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){var e=this.rules.node.gameState;this.scores=lV.of(e.getCapturedCopy()),this.hidePreviousMove();var t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){var n=e.getCurrentOpponent().value;this.last=lV.of(new Bae(t.get().x,n)),this.showPreviousMove()}else this.last=lV.empty()}},{key:"hidePreviousMove",value:function(){this.captured=[],this.moved=[]}},{key:"showPreviousMove",value:function(){for(var e=this.rules.node.mother.get().gameState,t=0;t<=1;t++)for(var n=0;n<=5;n++){var r=new Bae(n,t),i=this.board[t][n],a=e.getPieceAt(r);this.last.equalsValue(r)||(i<a?this.captured.push(r):i>a&&this.moved.push(r))}}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(t===n.rules.node.gameState.getCurrentPlayer().value){r.next=5;break}return r.abrupt("return",n.cancelMove(Xoe.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME()));case 5:return n.last=lV.empty(),a=ese.from(e),r.abrupt("return",n.chooseMove(a,n.rules.node.gameState,n.scores.get()));case 8:case"end":return r.stop()}},r)}))()}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t);return this.captured.some(function(e){return e.equals(n)})?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(function(e){return e.equals(n)})?["moved"]:[]}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-awale-component"]],features:[xE],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),nS(1,"rect",1),YE(2,ise,2,1,"g",2),nS(3,"line",3),tS()),2&e&&(pb(2),XE("ngForOf",t.board))},directives:[LA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),ose=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;if(Wg(this,n),i=t.call(this,e.x,e.y),e.equals(r))throw new Error(Zae.MOVE_CANNOT_BE_STATIC());return i.end=r,Lg(i)}return jg(n,[{key:"length",value:function(){return this.coord.getDistance(this.end)}},{key:"getDirection",value:function(){return Lae.factory.fromMove(this.coord,this.end)}}],[{key:"getEncoder",value:function(e,t,n){return new(function(r){Mg(a,r);var i=Dg(a);function a(){var n;return Wg(this,a),(n=i.apply(this,arguments)).shiftAX=t,n.shiftDY=n.shiftAX*e,n.shiftDX=n.shiftDY*t,n}return jg(a,[{key:"maxValue",value:function(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}},{key:"encodeNumber",value:function(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}},{key:"decodeNumber",value:function(r){var i=r%t;r/=t;var a=new Bae((r-=r%1)%e,i);r/=e;var o=(r-=r%1)%t;r/=t;var s=new Bae((r-=r%1)%e,o);return n(s,a)}}]),a}(xre))}}]),n}(roe),sse=function(){var e=jg(function e(){Wg(this,e)});return e.LANDING_ON_OCCUPIED_CASE=function(){return $localize(et||(et=wg(["You cannot land on an occupied square."])))},e.THRONE_IS_LEFT_FOR_GOOD=function(){return $localize(tt||(tt=wg(["Once you left the central throne, you cannot return to it."])))},e.SOLDIERS_CANNOT_SIT_ON_THRONE=function(){return $localize(nt||(nt=wg(["Soldiers cannot sit on the throne."])))},e.MOVE_MUST_BE_ORTHOGONAL=function(){return $localize(rt||(rt=wg(["Tafl moves must be orthogonal."])))},e}(),use=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;if(Wg(this,n),i=t.call(this,e,r),e.isNotInRange(i.getMaximalDistance(),i.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(r.isNotInRange(i.getMaximalDistance(),i.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+r.toString()+".");var a=e.getDirectionToward(r);if(a.isFailure()||a.get().isDiagonal())throw new Error(sse.MOVE_MUST_BE_ORTHOGONAL());return Lg(i)}return jg(n,[{key:"equals",value:function(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}},{key:"toString",value:function(){return"TaflMove("+this.coord+"->"+this.end+")"}}]),n}(ose),cse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getMaximalDistance",value:function(){return 7}}],[{key:"of",value:function(e,t){return new n(e,t)}},{key:"from",value:function(e,t){try{var r=new n(e,t);return S7.success(r)}catch(r){return S7.failure(r.message)}}}]),n}(use);cse.encoder=ose.getEncoder(7,7,cse.of);var lse={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:Nre.ZERO},hse=function(){function e(t,n){Wg(this,e),this.owner=t,this.king=n}return jg(e,[{key:"isKing",value:function(){return this.king}},{key:"getOwner",value:function(){return this.owner}}]),e}();hse.UNOCCUPIED=new hse(Mre.NONE,!1),hse.PLAYER_ONE_KING=new hse(Nre.ONE,!0),hse.INVADERS=new hse(Nre.ZERO,!1),hse.DEFENDERS=new hse(Nre.ONE,!1);var fse=jg(function e(t){Wg(this,e),this.value=t});fse.NONE=new fse("NONE"),fse.OPPONENT=new fse("OPPONENT"),fse.PLAYER=new fse("PLAYER");var dse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isCentralThrone",value:function(e){return e.equals(this.getCentralThrone())}},{key:"getCentralThrone",value:function(){var e=(this.board.length-1)/2;return new Bae(e,e)}},{key:"getRelativeOwner",value:function(e,t){var n=this.getAbsoluteOwner(t);return n===Mre.NONE?fse.NONE:e===n?fse.PLAYER:fse.OPPONENT}},{key:"getAbsoluteOwner",value:function(e){return this.getPieceAt(e).getOwner()}}]),n}(eoe),vse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"from",value:function(e,t){return new n(e,t)}}],[{key:"getInitialState",value:function(){var e=hse.UNOCCUPIED,t=hse.INVADERS,r=hse.DEFENDERS;return new n([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,r,e,e,e],[t,t,r,hse.PLAYER_ONE_KING,r,t,t],[e,e,e,r,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}}]),n}(dse),pse=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e)).config=r,a.generateMove=i,a}return jg(n,[{key:"isLegal",value:function(e,t){oV(n.VERBOSE,{tablutRules_isLegal:{move:e,state:t}});var r=t.getCurrentPlayer(),i=this.getMoveValidity(r,e,t);return i.isFailure()?S7.failure(i.getReason()):S7.success(void 0)}},{key:"getMoveValidity",value:function(e,t,n){var r=n.getRelativeOwner(e,t.coord);if(r===fse.NONE)return T7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE());if(r===fse.OPPONENT)return T7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==fse.NONE)return T7.failure(sse.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return T7.failure(sse.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return T7.failure(sse.THRONE_IS_LEFT_FOR_GOOD())}for(var i=t.coord.getDirectionToward(t.end).get(),a=t.coord.getOrthogonalDistance(t.end),o=t.coord.getNext(i),s=1;s<a;s++){if(n.getPieceAt(o)!==hse.UNOCCUPIED)return T7.failure(Zae.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return T7.SUCCESS}},{key:"isThrone",value:function(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}},{key:"isExternalThrone",value:function(e){var t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}},{key:"tryCapture",value:function(e,t,n,r){var i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===fse.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):lV.empty()}},{key:"captureKing",value:function(e,t,n,r){var i=t.getNext(n),a=this.getSurroundings(i,n,e,r),o=a.backCoord,s=a.back,u=a.backInRange,c=a.left,l=a.leftCoord,h=a.right,f=a.rightCoord;return!1===u?this.captureKingAgainstTheWall(c,h,i):s===fse.NONE&&this.isThrone(r,o)?this.captureKingAgainstThrone(o,i,c,h):s===fse.PLAYER?this.captureKingWithAtLeastASandwich(r,i,c,l,h,f):lV.empty()}},{key:"getSurroundings",value:function(e,t,n,r){var i=e.getNext(t),a=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=a?r.getRelativeOwner(n,i):fse.NONE,s=e.getLeft(t),u=s.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,s):fse.NONE,c=e.getRight(t),l=c.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,c):fse.NONE;return{backCoord:i,back:o,backInRange:a,leftCoord:s,left:u,rightCoord:c,right:l}}},{key:"captureKingAgainstTheWall",value:function(e,t,r){var i=e===fse.PLAYER?1:0;return 2===(i+=t===fse.PLAYER?1:0)&&this.config.BORDER_CAN_SURROUND_KING?(oV(n.VERBOSE||!1,"king captured by 3 invaders against 1 border"),lV.of(r)):lV.empty()}},{key:"captureKingAgainstThrone",value:function(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return lV.of(t)}else{var i=r===fse.PLAYER,a=n===fse.PLAYER||i;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&a)return lV.of(t)}return lV.empty()}},{key:"capturePawn",value:function(e,t,r,i){var a=!1,o=t.getNext(r),s=o.getNext(r),u=fse.NONE;return s.isInRange(this.config.WIDTH,this.config.WIDTH)&&(u=i.getRelativeOwner(e,s)),u===fse.NONE?!1===this.isThrone(i,s)?(oV(n.VERBOSE||a,"cannot capture a pawn without an ally; "+o+"threatened by "+e+"'s pawn in  "+t+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),lV.empty()):(oV(n.VERBOSE||a,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+e+"'s pawn in  "+t+" coming from this direction ("+r.x+", "+r.y+")"),lV.of(o)):u===fse.PLAYER?(oV(n.VERBOSE||a,"pawn captured by 2 opponents; "+o+"threatened by "+e+"'s pawn in  "+t+" coming from this direction ("+r.x+", "+r.y+")"),lV.of(o)):(oV(n.VERBOSE||a,"no captures; "+o+"threatened by "+e+"'s pawn in  "+t+" coming from this direction ("+r.x+", "+r.y+")"),lV.empty())}},{key:"captureKingWithAtLeastASandwich",value:function(e,t,r,i,a,o){if(!1===this.kingTouchCentralThrone(e,t)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return lV.of(t);var s=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,u=this.isThrone(e,i),c=r===fse.PLAYER||u&&s,l=this.isThrone(e,o);return c&&(a===fse.PLAYER||l&&s)?(oV(n.VERBOSE||!1,"king captured by 4 invaders"),lV.of(t)):lV.empty()}},{key:"kingTouchCentralThrone",value:function(e,t){var n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}},{key:"applyLegalMove",value:function(e,t){oV(n.VERBOSE,{TablutRules_applyLegalMove:{move:e,state:t}});var r=t.turn,i=t.getCopiedBoard(),a=t.getCurrentPlayer(),o=e.coord,s=e.end;i[s.y][s.x]=i[o.y][o.x],i[o.y][o.x]=hse.UNOCCUPIED;var u,c=Hg(Fae.ORTHOGONALS);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=this.tryCapture(a,e.end,l,t);h.isPresent()&&(i[h.get().y][h.get().x]=hse.UNOCCUPIED)}}catch(f){c.e(f)}finally{c.f()}return t.from(i,r+1)}},{key:"getGameStatus",value:function(e){var t=this.getWinner(e.gameState);return t.isPresent()?loe.getVictory(t.get()):loe.ONGOING}},{key:"getWinner",value:function(e){var t=!1,n=this.getKingCoord(e);if(n.isAbsent())return oV(t,"The king is dead, victory to invader"),lV.of(this.getInvader());var r=n.get();return this.isExternalThrone(r)?(oV(t,"The king escape, victory to defender"),lV.of(this.getDefender())):this.isPlayerImmobilized(Nre.ZERO,e)?(oV(t,"Zero has no move, victory to one"),lV.of(Nre.ONE)):this.isPlayerImmobilized(Nre.ONE,e)?(oV(t,"One has no move, victory to zero"),lV.of(Nre.ZERO)):(oV(t,"no victory"),lV.empty())}},{key:"getKingCoord",value:function(e){oV(n.VERBOSE,{TablutRules_getKingCoord:{state:e,con:this.config}});for(var t=0;t<this.config.WIDTH;t++)for(var r=0;r<this.config.WIDTH;r++)if(e.getPieceAtXY(r,t).isKing())return lV.of(new Bae(r,t));return lV.empty()}},{key:"getInvader",value:function(){return this.config.INVADER}},{key:"getDefender",value:function(){return this.config.INVADER.getOpponent()}},{key:"isPlayerImmobilized",value:function(e,t){return 0===this.getPlayerListMoves(e,t).length}},{key:"getPlayerListMoves",value:function(e,t){var r=[],i=this.getPlayerListPawns(e,t);oV(n.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:e,state:t}});var a,o=Hg(i);try{for(o.s();!(a=o.n()).done;){var s,u=a.value,c=Hg(this.getPossibleDestinations(u,t));try{for(c.s();!(s=c.n()).done;){var l=s.value,h=this.generateMove(u,l);r.push(h)}}catch(f){c.e(f)}finally{c.f()}}}catch(f){o.e(f)}finally{o.f()}return r}},{key:"getPlayerListPawns",value:function(e,t){for(var n=[],r=0;r<this.config.WIDTH;r++)for(var i=0;i<this.config.WIDTH;i++){var a=new Bae(i,r);t.getAbsoluteOwner(a)===e&&n.push(a)}return n}},{key:"getPossibleDestinations",value:function(e,t){var n,r,i=[],a=Hg(Fae.ORTHOGONALS);try{for(a.s();!(r=a.n()).done;){var o=r.value;n=e.getNext(o,1);for(var s=!1;n.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(n)===Mre.NONE?this.isExternalThrone(n)?t.getPieceAt(e).isKing()&&i.push(n):t.isCentralThrone(n)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&i.push(n):i.push(n):s=!0,n=n.getNext(o,1)}}catch(u){a.e(u)}finally{a.f()}return i}}]),n}(hoe);return e.VERBOSE=!1,e}(),gse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,vse,lse,cse.of)}return jg(n,null,[{key:"get",value:function(){return null==n.singleton&&(n.singleton=new n),coe.ruler=this.singleton,n.singleton}}]),n}(pse),yse=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e)).VERBOSE=r,a.generateMove=i,a.viewInfo={pieceClasses:[]},a.EMPTY=hse.UNOCCUPIED,a.captureds=[],a.chosen=new Bae(-1,-1),a.lastMove=lV.empty(),a}return jg(n,[{key:"getViewBox",value:function(){var e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}},{key:"updateBoard",value:function(){oV(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove(),this.updateViewInfo()}},{key:"showPreviousMove",value:function(){var e,t=this.rules.node.mother.get().gameState,n=this.rules.node.gameState.getCurrentOpponent(),r=Hg(Fae.ORTHOGONALS);try{for(r.s();!(e=r.n()).done;){var i=e.value,a=this.lastMove.get().end.getNext(i,1);if(a.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){var o=t.getRelativeOwner(n,a)===fse.OPPONENT,s=this.rules.node.gameState.getPieceAt(a)===hse.UNOCCUPIED;o&&s&&this.captureds.push(a)}}}catch(u){r.e(u)}finally{r.f()}}},{key:"updateViewInfo",value:function(){for(var e=[],t=0;t<this.board.length;t++){for(var n=[],r=0;r<this.board[0].length;r++){var i;i=this.board[t][r].getOwner()===Mre.NONE?[""]:this.getPieceClasses(r,t),n.push(i)}e.push(n)}this.viewInfo={pieceClasses:e}}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return oV(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")"),i=n.canUserPlay("#click_"+e+"_"+t),r.abrupt("return",i.isFailure()?n.cancelMove(i.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t));case 3:case"end":return r.stop()}},r)}))()}},{key:"chooseDestination",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(n.VERBOSE,"TaflComponent.chooseDestination"),i=n.chosen,a=new Bae(e,t),!(o=n.generateMove(i,a)).isSuccess()){r.next=9;break}return n.cancelMove(),r.next=6,n.chooseMove(o.get(),n.rules.node.gameState);case 6:r.t0=r.sent,r.next=10;break;case 9:r.t0=n.cancelMove(o.getReason());case 10:return r.abrupt("return",r.t0);case 11:case"end":return r.stop()}},r)}))()}},{key:"choosePiece",value:function(e,t){return oV(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===hse.UNOCCUPIED?this.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new Bae(e,t),this.updateViewInfo(),oV(this.VERBOSE,"selected piece = ("+e+", "+t+")"),T7.SUCCESS):this.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE())}},{key:"pieceBelongToCurrentPlayer",value:function(e,t){var n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new Bae(e,t);return n.getRelativeOwner(r,i)===fse.PLAYER}},{key:"cancelMoveAttempt",value:function(){this.chosen=new Bae(-1,-1)}},{key:"isThrone",value:function(e,t){return this.rules.isThrone(this.rules.node.gameState,new Bae(e,t))}},{key:"isCentralThrone",value:function(e,t){return!1===this.rules.node.gameState.isCentralThrone(new Bae(e,t))}},{key:"getPieceClasses",value:function(e,t){var n=[],r=new Bae(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}},{key:"getRectClasses",value:function(e,t){var n=[],r=new Bae(e,t);if(this.captureds.some(function(e){return e.equals(r)}))n.push("captured");else if(this.lastMove.isPresent()){var i=this.lastMove.get().coord,a=this.lastMove.get().end;(r.equals(i)||r.equals(a))&&n.push("moved")}return n}},{key:"getClickables",value:function(){for(var e=[],t=0;t<this.board.length;t++)for(var n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new Bae(n,t));return e}},{key:"isClickable",value:function(e,t){return this.pieceBelongToCurrentPlayer(e,t)}},{key:"isInvader",value:function(e,t){return this.board[t][e]===hse.INVADERS}},{key:"isKing",value:function(e,t){return this.board[t][e].isKing()}}]),n}(Koe),mse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){oV(!1,{TaflMinimax_getListMoves:{node:e}});var t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}},{key:"orderMoves",value:function(e,t){var n=this,r=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?Ure.sortByDescending(t,function(e){return-e.end.getOrthogonalDistance(r)}):Ure.sortByDescending(t,function(e){return e.coord.equals(r)?n.ruler.isExternalThrone(e.end)?2:1:0}),t}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new Kae(n.get().getVictoryValue());var r=this.ruler.getPlayerListPawns(Nre.ZERO,t).length,i=this.ruler.getPlayerListPawns(Nre.ONE,t).length,a=[1,2][this.ruler.config.INVADER.value];a*=Nre.ZERO.getScoreModifier();var o=[2,1][this.ruler.config.INVADER.value];return o*=Nre.ONE.getScoreModifier(),new Kae(r*a+i*o)}}]),n}(Yae),kse=function(){function e(t,n){Wg(this,e),this.directThreats=t,this.mover=n}return jg(e,[{key:"equals",value:function(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}]),e}(),_se=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,new Xae([e]),r)).directThreat=e,i.mover=r,i}return jg(n)}(kse),Cse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"toFields",value:function(e){return[[e.y],e.x]}}]),n}(function(e,t){Mg(r,e);var n=Dg(r);function r(e){var t;if(Wg(this,r),(t=n.call(this)).map=[],t.values=[],void 0!==e){var i,a=Hg(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.add(o)}}catch(s){a.e(s)}finally{a.f()}}return Lg(t)}return jg(r,[{key:"add",value:function(e){var t,n=this.toFields(e),r=this.map,i=Hg(n[0]);try{for(i.s();!(t=i.n()).done;){var a=t.value;void 0===r[a]&&(r[a]=[]),r=r[a]}}catch(s){i.e(s)}finally{i.f()}var o=n[1];return void 0===r[o]&&(r[o]=!0,this.values.push(e),!0)}},{key:"contains",value:function(e){var t,n=this.toFields(e),r=this.map,i=Hg(n[0]);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(void 0===r[a])return!1;r=r[a]}}catch(o){i.e(o)}finally{i.f()}return void 0!==r[n[1]]}},{key:t,value:function(){return this.values.values()}}]),r}(Xae,Symbol.iterator)),wse=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).width=i.ruler.config.WIDTH,i.maxInfluence=16*(2*i.width-2),i.scoreByThreatenedPiece=16*i.maxInfluence+1,i.scoreBySafePiece=16*i.scoreByThreatenedPiece+1,i}return jg(n,[{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n,r=e.gameState,i=hse.UNOCCUPIED,a=0,o=this.getPiecesMap(r),s=this.getThreatMap(r,o),u=this.filterThreatMap(s,r),c=Hg(Nre.PLAYERS);try{for(c.s();!(n=c.n()).done;){var l,h=n.value,f=Hg(o.get(h).get());try{for(f.s();!(l=f.n()).done;){var d=l.value;if(u.get(d).isPresent())a+=h.getScoreModifier()*this.scoreByThreatenedPiece;else{a+=h.getScoreModifier()*this.scoreBySafePiece;var v,p=0,g=Hg(Fae.ORTHOGONALS);try{for(g.s();!(v=g.n()).done;)for(var y=v.value,m=d.getNext(y,1);m.isInRange(this.width,this.width)&&r.getPieceAt(m)===i;)p++,m=m.getNext(y,1)}catch(k){g.e(k)}finally{g.f()}a+=p*h.getScoreModifier()}}}catch(k){f.e(k)}finally{f.f()}}}catch(k){c.e(k)}finally{c.f()}return new Kae(a)}},{key:"getPiecesMap",value:function(e){for(var t=hse.UNOCCUPIED,n=[],r=[],i=0;i<this.width;i++)for(var a=0;a<this.width;a++){var o=new Bae(a,i);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===Nre.ZERO?n.push(o):r.push(o))}return new ooe([{key:Nre.ZERO,value:new Cse(n)},{key:Nre.ONE,value:new Cse(r)}])}},{key:"getThreatMap",value:function(e,t){var n,r=new ooe,i=Hg(Nre.PLAYERS);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=Hg(t.get(o).get());try{for(s.s();!(a=s.n()).done;){var u=a.value,c=this.getThreats(u,e);this.isThreatReal(u,e,c)&&r.set(u,new Xae(c))}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}return r}},{key:"getThreats",value:function(e,t){var n=t.getAbsoluteOwner(e);M7(n.isPlayer(),"TaflPieceAndInfluenceMinimax.getThreats should be called with an occupied coordinate");var r,i=n.getOpponent(),a=[],o=Hg(Fae.ORTHOGONALS);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=e.getPrevious(s,1);if(this.isAThreat(u,t,i)){var c,l=[],h=Hg(Fae.ORTHOGONALS);try{for(h.s();!(c=h.n()).done;){var f=c.value;if(f!==s.getOpposite()){for(var d=e.getNext(s,1);d.isInRange(this.width,this.width)&&t.getPieceAt(d)===hse.UNOCCUPIED;)d=d.getNext(f);d.isInRange(this.width,this.width)&&t.getAbsoluteOwner(d)===i&&!1===e.getNext(s,1).equals(d)&&l.push(d)}}}catch(v){h.e(v)}finally{h.f()}a.push(new _se(u,new Cse(l)))}}}catch(v){o.e(v)}finally{o.f()}return a}},{key:"isAThreat",value:function(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==Nre.ONE&&t.getPieceAt(e)!==hse.UNOCCUPIED))}},{key:"isThreatReal",value:function(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;var r,i=Hg(n);try{for(i.s();!(r=i.n()).done;){if(r.value.mover.size()>0)return!0}}catch(a){i.e(a)}finally{i.f()}return!1}},{key:"filterThreatMap",value:function(e,t){var n,r=new ooe,i=e.listKeys(),a=i.filter(function(e){return t.getAbsoluteOwner(e)===t.getCurrentPlayer()}),o=new Cse(i.filter(function(e){return t.getAbsoluteOwner(e)===t.getCurrentOpponent()})),s=Hg(a);try{for(s.s();!(n=s.n()).done;){var u,c=n.value,l=e.get(c).get(),h=[],f=Hg(l);try{for(f.s();!(u=f.n()).done;){var d=u.value;if(!1===o.contains(d.directThreat)){var v,p=[],g=Hg(d.mover);try{for(g.s();!(v=g.n()).done;){var y=v.value;!1===o.contains(y)&&p.push(y)}}catch(w){g.e(w)}finally{g.f()}p.length>0&&h.push(new _se(d.directThreat,new Cse(p)))}}}catch(w){f.e(w)}finally{f.f()}h.length>0&&r.set(c,new Xae(h))}}catch(w){s.e(w)}finally{s.f()}var m,k=Hg(o);try{for(k.s();!(m=k.n()).done;){var _=m.value,C=e.get(_).get();r.set(_,C)}}catch(w){k.e(w)}finally{k.f()}return r}}]),n}(mse),bse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var r,i=e.gameState,a=this.ruler.config.WIDTH,o=hse.UNOCCUPIED,s=0,u=this.getPiecesMap(i),c=this.getThreatMap(i,u),l=this.filterThreatMap(c,i),h=Hg(Nre.PLAYERS);try{for(h.s();!(r=h.n()).done;){var f,d=r.value,v=new Cse,p=Hg(u.get(d).get());try{for(p.s();!(f=p.n()).done;){var g=f.value;if(l.get(g).isPresent())s+=d.getScoreModifier()*n.SCORE_BY_THREATENED_PIECE;else{s+=d.getScoreModifier()*n.SCORE_BY_SAFE_PIECE;var y,m=Hg(Fae.ORTHOGONALS);try{for(m.s();!(y=m.n()).done;)for(var k=y.value,_=g.getNext(k,1);_.isInRange(a,a)&&i.getPieceAt(_)===o;)v.add(_),_=_.getNext(k,1)}catch(S){m.e(S)}finally{m.f()}}}}catch(S){p.e(S)}finally{p.f()}var C,w=Hg(v);try{for(w.s();!(C=w.n()).done;){var b=C.value,E=n.CONTROL_VALUE[b.y][b.x];s+=d.getScoreModifier()*E}}catch(S){w.e(S)}finally{w.f()}}}catch(S){h.e(S)}finally{h.f()}return new Kae(s)}}]),n}(wse);bse.SCORE_BY_THREATENED_PIECE=530,bse.SCORE_BY_SAFE_PIECE=16*bse.SCORE_BY_THREATENED_PIECE+1,bse.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];var Ese=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n,r=e.gameState,i=this.ruler.config.WIDTH,a=hse.UNOCCUPIED,o=0,s=0,u=0,c=this.getPiecesMap(r),l=this.getThreatMap(r,c),h=this.filterThreatMap(l,r),f=Hg(Nre.PLAYERS);try{for(f.s();!(n=f.n()).done;){var d,v=n.value,p=new Cse,g=Hg(c.get(v).get());try{for(g.s();!(d=g.n()).done;){var y=d.value;if(h.get(y).isPresent())s+=v.getScoreModifier();else{o+=v.getScoreModifier();var m,k=Hg(Fae.ORTHOGONALS);try{for(k.s();!(m=k.n()).done;)for(var _=m.value,C=y.getNext(_,1);C.isInRange(i,i)&&r.getPieceAt(C)===a;)p.add(C),C=C.getNext(_,1)}catch(O){k.e(O)}finally{k.f()}}}}catch(O){g.e(O)}finally{g.f()}var w,b=Hg(p);try{for(b.s();!(w=b.n()).done;){var E=w.value,S=bse.CONTROL_VALUE[E.y][E.x];u+=v.getScoreModifier()*S}}catch(O){b.e(O)}finally{b.f()}}}catch(O){f.e(O)}finally{f.f()}var P=this.getStepForEscape(r);return new Kae(531*P*17*17+531*o*17+531*s+u)}},{key:"getStepForEscape",value:function(e){var t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}},{key:"_getStepForEscape",value:function(e,t,n,r){var i=this,a=this.getNextGen(e,n,r);return 0===a.length?lV.empty():a.some(function(e){return i.ruler.isExternalThrone(e)})?lV.of(t):(t++,r.push.apply(r,Vg(a)),this._getStepForEscape(e,t,a,r))}},{key:"getNextGen",value:function(e,t,n){var r,i=this,a=[],o=Hg(t);try{for(o.s();!(r=o.n()).done;){var s,u=r.value,c=Hg(Fae.ORTHOGONALS);try{var l=function(){for(var t=s.value,r=u.getNext(t,1);r.isInRange(i.ruler.config.WIDTH,i.ruler.config.WIDTH)&&e.getPieceAt(r)===hse.UNOCCUPIED;)n.every(function(e){return!1===e.equals(r)})&&a.push(r),r=r.getNext(t,1)};for(c.s();!(s=c.n()).done;)l()}catch(h){c.e(h)}finally{c.f()}}}catch(h){o.e(h)}finally{o.f()}return a}}]),n}(bse);Ese.SCORE_BY_THREATENED_PIECE=530,Ese.SCORE_BY_SAFE_PIECE=16*bse.SCORE_BY_THREATENED_PIECE+1,Ese.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];var Sse=hse.UNOCCUPIED,Pse=hse.INVADERS,Ose=hse.DEFENDERS,Tse=hse.PLAYER_ONE_KING,Ise=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(it||(it=wg(["Goal of the game"]))),$localize(at||(at=wg(["Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne."]))),vse.getInitialState()),poe.anyMove($localize(ot||(ot=wg(["Moving"]))),$localize(st||(st=wg(["All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move."]))),vse.getInitialState(),cse.of(new Bae(3,1),new Bae(1,1)),$localize(ut||(ut=wg(["Congratulations!"])))),poe.fromMove($localize(ct||(ct=wg(["Capturing a soldier (1/2)"]))),$localize(lt||(lt=wg(["All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it."]))),new vse([[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Pse,Sse,Sse,Ose,Sse,Sse,Sse],[Sse,Sse,Ose,Tse,Ose,Pse,Pse],[Sse,Sse,Pse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Ose,Sse,Pse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse]],1),[cse.of(new Bae(3,5),new Bae(2,5))],$localize(ht||(ht=wg(["Congratulations, that will teach him a lesson!"]))),$localize(ft||(ft=wg(["Failed, you missed an opportunity to capture a piece of the opponent."])))),poe.fromMove($localize(dt||(dt=wg(["Capturing a soldier (2/2)"]))),$localize(vt||(vt=wg(["A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it."]))),new vse([[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Sse,Pse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Ose,Sse,Sse,Sse],[Pse,Ose,Sse,Sse,Ose,Pse,Pse],[Sse,Ose,Sse,Sse,Sse,Sse,Sse],[Sse,Pse,Sse,Tse,Sse,Pse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse]],12),[cse.of(new Bae(2,1),new Bae(3,1)),cse.of(new Bae(3,0),new Bae(3,1))],$localize(pt||(pt=wg(["Congratulations, one less defender. But keep an eye on the king, it is the most important."]))),$localize(gt||(gt=wg(["Failed, you did not do the expected move."])))),poe.fromMove($localize(yt||(yt=wg(["Capturing the king on his throne"]))),$localize(mt||(mt=wg(["To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king."]))),new vse([[Sse,Sse,Sse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Ose,Sse,Sse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Pse,Sse,Tse,Pse,Sse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Ose,Sse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Sse,Sse,Sse,Sse]],72),[cse.of(new Bae(1,3),new Bae(2,3))],$localize(kt||(kt=wg(["Congratulations, you won!"]))),$localize(_t||(_t=wg(["Failed, you let the king run away."])))),poe.fromMove($localize(Ct||(Ct=wg(["Capturing the king next to his throne"]))),$localize(wt||(wt=wg(["Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king."]))),new vse([[Sse,Sse,Pse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Sse,Sse,Tse,Pse,Sse,Sse],[Sse,Pse,Ose,Sse,Ose,Sse,Sse],[Sse,Sse,Sse,Pse,Sse,Sse,Sse],[Sse,Sse,Sse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Sse,Sse,Sse,Sse]],72),[cse.of(new Bae(2,0),new Bae(2,2))],$localize(bt||(bt=wg(["The king is dead, long live the king. Congratulations, you won."]))),$localize(Et||(Et=wg(["Failed!"])))),poe.fromMove($localize(St||(St=wg(["Capturing the king far from his throne"]))),$localize(Pt||(Pt=wg(["When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king."]))),new vse([[Sse,Sse,Sse,Sse,Sse,Sse,Sse],[Sse,Sse,Sse,Sse,Sse,Sse,Sse],[Sse,Pse,Sse,Pse,Sse,Sse,Sse],[Pse,Sse,Sse,Sse,Ose,Sse,Sse],[Sse,Sse,Sse,Ose,Sse,Sse,Sse],[Sse,Sse,Sse,Sse,Sse,Sse,Sse],[Sse,Tse,Sse,Pse,Sse,Sse,Sse]],72),[cse.of(new Bae(3,6),new Bae(2,6))],$localize(Ot||(Ot=wg(["The king is dead, long live the king. Congratulations, you won."]))),$localize(Tt||(Tt=wg(["Failed!"]))))]});function Ase(e,t){1&e&&(c_(),nS(0,"polyline",8))}function xse(e,t){1&e&&(c_(),nS(0,"polyline",9))}function Rse(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Ase,1,0,"polyline",6),YE(2,xse,1,0,"ng-template",null,7,RT),tS()),2&e){var n=KE(3),r=hS().index,i=hS().index,a=hS();pb(1),XE("ngIf",a.isCentralThrone(r,i))("ngIfElse",n)}}function Mse(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"line",10),nS(2,"line",10),nS(3,"line",10),nS(4,"line",10),nS(5,"line",10),tS()),2&e){var n=hS(2).index,r=hS().index,i=hS();pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.04*i.SPACE_SIZE)("x2",.5*i.SPACE_SIZE)("y2",.96*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.1*i.SPACE_SIZE)("y2",.6*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.9*i.SPACE_SIZE)("y2",.6*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.4*i.SPACE_SIZE)("x2",.15*i.SPACE_SIZE)("y2",.75*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.4*i.SPACE_SIZE)("x2",.85*i.SPACE_SIZE)("y2",.75*i.SPACE_SIZE)}}function Nse(e,t){if(1&e&&(c_(),nS(0,"polyline",15)),2&e){var n=hS(3).index,r=hS().index;XE("ngClass",hS().viewInfo.pieceClasses[r][n])}}function Dse(e,t){if(1&e&&(c_(),nS(0,"line",10),nS(1,"line",10),nS(2,"line",10),nS(3,"line",10)),2&e){var n=hS(3).index,r=hS().index,i=hS();XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.04*i.SPACE_SIZE)("x2",.5*i.SPACE_SIZE)("y2",.96*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.04*i.SPACE_SIZE)("y1",.5*i.SPACE_SIZE)("x2",.96*i.SPACE_SIZE)("y2",.5*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.2*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.8*i.SPACE_SIZE)("y2",.8*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.8*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.2*i.SPACE_SIZE)("y2",.8*i.SPACE_SIZE)}}function Lse(e,t){if(1&e&&(c_(),YE(0,Nse,1,1,"polyline",13),YE(1,Dse,4,20,"ng-template",null,14,RT)),2&e){var n=KE(2),r=hS(2).index,i=hS().index;XE("ngIf",hS().isKing(r,i))("ngIfElse",n)}}function Fse(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",10),YE(2,Mse,6,25,"g",11),YE(3,Lse,3,2,"ng-template",null,12,RT),tS()),2&e){var n=KE(4),r=hS().index,i=hS().index,a=hS();pb(1),XE("ngClass",a.viewInfo.pieceClasses[i][r]),$E("r",a.SPACE_SIZE/2-a.STROKE_WIDTH)("cx",.5*a.SPACE_SIZE)("cy",.5*a.SPACE_SIZE),pb(1),XE("ngIf",a.isInvader(r,i))("ngIfElse",n)}}function Use(e,t){if(1&e){var n=aS();c_(),eS(0,"g",3),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),nS(1,"rect",4),YE(2,Rse,4,2,"g",5),YE(3,Fse,5,6,"g",5),tS()}if(2&e){var r=t.index,i=hS().index,a=hS();vS("id","click_",r,"_",i,""),$E("transform","translate("+a.SPACE_SIZE*r+", "+a.SPACE_SIZE*i+")"),pb(1),XE("ngClass",a.getRectClasses(r,i)),$E("width",a.SPACE_SIZE)("height",a.SPACE_SIZE),pb(1),XE("ngIf",a.board[i][r]===a.EMPTY&&a.isThrone(r,i)),pb(1),XE("ngIf",a.board[i][r]!==a.EMPTY)}}function Bse(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Use,4,8,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Vse(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",16),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),vS("id","click_",r.x,"_",r.y,""),$E("x",i.SPACE_SIZE*r.x)("y",i.SPACE_SIZE*r.y)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}var zse=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e,!1,cse.from)).rules=gse.get(),r.availableMinimaxes=[new mse(r.rules,"DummyBot"),new wse(r.rules,"Piece > Influence"),new bse(r.rules,"Piece > Control"),new Ese(r.rules,"Escape > Piece > Control")],r.encoder=cse.encoder,r.tutorial=(new Ise).tutorial,r}return jg(n,[{key:"ngOnInit",value:function(){this.updateBoard()}}]),n}(yse);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-brandhub"]],features:[xE],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Bse,2,1,"g",1),YE(2,Vse,2,6,"g",1),tS()),2&e&&($E("viewBox",t.getViewBox()),pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.getClickables()))},directives:[LA,NA,UA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Hse=function(){var e,t=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).SPACE_SIZE=50,e}return jg(n,[{key:"getTriangleCornerCoords",value:function(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}},{key:"getTriangleCoordinate",value:function(e,t){return this.getTriangleCornerCoords(e,t).map(function(e){return e.x+","+e.y}).reduce(function(e,t){return e+","+t})}},{key:"getDownwardCoordinate",value:function(e,t){var n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,a=this.SPACE_SIZE*(t+1),o=new Bae(.5*this.SPACE_SIZE*e,i);return[o,new Bae(n,a),new Bae(r,i),o]}},{key:"getUpwardCoordinate",value:function(e,t){var n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,a=this.SPACE_SIZE*(t+1),o=new Bae(.5*this.SPACE_SIZE*e,a);return[o,new Bae(n,i),new Bae(r,a),o]}},{key:"getPyramidCoordinate",value:function(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}},{key:"getDownwardPyramidCoordinate",value:function(e,t){var n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,a=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),s=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+s+","+i+","+s+","+a+","+i+","+a+","+o+","+s+","+a}},{key:"getUpwardPyramidCoordinate",value:function(e,t){var n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,a=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),s=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+s+","+i+","+s+","+a+","+i+","+a+","+o+","+s+","+a}}]),n}(Vae);return t.\u0275fac=function(n){return(e||(e=$_(t)))(n||t)},t.\u0275cmp=Gm({type:t,selectors:[["ng-component"]],features:[xE],decls:0,vars:0,template:function(e,t){},encapsulation:2}),t}(),Gse=function(){var e=jg(function e(){Wg(this,e)});return e.INVALID_DISTANCE=function(){return $localize(It||(It=wg(["Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is."])))},e.NOT_ENOUGH_TILES_TO_EXCHANGE=function(){return $localize(At||(At=wg(["You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it."])))},e.FIRST_CLICK_SHOULD_NOT_BE_NULL=function(){return $localize(xt||(xt=wg(["Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles."])))},e.CANNOT_CAPTURE_FROM_EMPTY=function(){return $localize(Rt||(Rt=wg(["You cannot capture from an empty space."])))},e.CANNOT_CAPTURE_OWN_PIECES=function(){return $localize(Mt||(Mt=wg(["You cannot capture your own pieces."])))},e}(),$se=function(){function e(t,n){Wg(this,e),this.direction=t,this.str=n}return jg(e,[{key:"toInt",value:function(){var t=this;return e.STEPS.findIndex(function(e){return e.direction.equals(t.direction)})}},{key:"equals",value:function(e){return this===e}},{key:"toString",value:function(){return this.str}}],[{key:"fromCoords",value:function(t,n){var r=t.getVectorToward(n),i=e.STEPS.findIndex(function(e){return e.direction.equals(r)});if(-1===i)throw new Error(Gse.INVALID_DISTANCE());return e.STEPS[i]}}]),e}();$se.LEFT=new $se(new Mae(-2,0),"LEFT"),$se.UP_LEFT=new $se(Lae.UP_LEFT,"UP_LEFT"),$se.UP_RIGHT=new $se(Lae.UP_RIGHT,"UP_RIGHT"),$se.RIGHT=new $se(new Mae(2,0),"RIGHT"),$se.DOWN_LEFT=new $se(Lae.DOWN_LEFT,"DOWN_LEFT"),$se.DOWN_RIGHT=new $se(Lae.DOWN_RIGHT,"DOWN_RIGHT"),$se.STEPS=[$se.LEFT,$se.UP_LEFT,$se.UP_RIGHT,$se.RIGHT,$se.DOWN_LEFT,$se.DOWN_RIGHT];var Wse=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).start=e,o.step=r,o.landingCoord=i,o.capture=a,o}return jg(n,[{key:"isTileExchange",value:function(){return this.capture.isPresent()}},{key:"toString",value:function(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}},{key:"equals",value:function(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}],[{key:"fromMovement",value:function(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");var r=new Bae(e.x+t.direction.x,e.y+t.direction.y);if(r.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new n(lV.of(e),lV.of(t),lV.of(r),lV.empty())}},{key:"fromTilesExchange",value:function(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new n(lV.empty(),lV.empty(),lV.empty(),lV.of(e))}},{key:"fromCoordToCoord",value:function(e,t){var r=$se.fromCoords(e,t);return n.fromMovement(e,r)}}]),n}(noe);Wse.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 1035}},{key:"encodeNumber",value:function(e){if(e.isTileExchange()){var t=e.capture.get().y;return 10*e.capture.get().x+t}var n=e.start.get().y,r=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*r+n}},{key:"decodeNumber",value:function(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");var t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?Wse.fromTilesExchange(new Bae(n,t)):Wse.fromMovement(new Bae(n,t),$se.STEPS[e-1])}}]),n}(xre));var qse=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getNeighbors",value:function(e){var t=new Bae(e.x-1,e.y),n=new Bae(e.x+1,e.y);return(e.x+e.y)%2==1?[t,n,new Bae(e.x,e.y-1)]:[t,n,new Bae(e.x,e.y+1)]}},{key:"getFakeNeighbors",value:function(e){return new Bae(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}},{key:"getCommonNeighbor",value:function(t,n){for(var r=e.getNeighbors(t),i=e.getNeighbors(n),a=0;a<r.length;){for(var o=r[a],s=0;s<i.length;){if(o.equals(i[s]))return lV.of(o);s++}a++}return lV.empty()}}]),e}(),jse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getEmptyNeighboors",value:function(e,t){return n.getEmptyNeighbors(this.board,e,t)}}],[{key:"getEmptyNeighbors",value:function(e,t,n){var r,i=[],a=Hg(qse.getNeighbors(t));try{for(a.s();!(r=a.n()).done;){var o=r.value;o.isInRange(e[0].length,e.length)&&e[o.y][o.x]===n&&i.push(o)}}catch(s){a.e(s)}finally{a.f()}return i}}]),n}(eoe),Zse=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).tiles=i,o.captures=a,o}return jg(n,[{key:"applyLegalMovement",value:function(e){oV(n.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});var t=e.start.get(),r=e.landingCoord.get(),i=this.getCopiedBoard();return i[r.y][r.x]=Hae.ofPlayer(this.getCurrentPlayer()),i[t.y][t.x]=Hae.EMPTY,new n(i,this.turn,this.tiles,this.captures)}},{key:"doMovementCaptures",value:function(e){oV(n.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});var t,r=this,i=Hg(this.getCapturedNeighbors(e.landingCoord.get()));try{for(i.s();!(t=i.n()).done;){var a=t.value;r=r.capture(a)}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"getCapturedNeighbors",value:function(e){var t=this,n=this.getCurrentOpponent();return qse.getNeighbors(e).filter(function(e){return!e.isNotInRange(15,10)&&!!t.getPieceAt(e).is(n)&&t.isSurrounded(e)})}},{key:"isSurrounded",value:function(e){return 0===this.getEmptyNeighboors(e,Hae.EMPTY).length}},{key:"capture",value:function(e){oV(n.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});var t=this.getCopiedBoard(),r=[this.captures[0],this.captures[1]];return oV(n.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=Hae.EMPTY,r[this.getCurrentPlayer().value]+=1,new n(t,this.turn,this.tiles,r)}},{key:"removeTilesIfNeeded",value:function(e,t){oV(n.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});var r=this,i=n.getTilesUpperLeftCoord(e);if(this.isTileEmpty(i)&&this.isDeconnectable(i)){r=this.deconnectTile(i,t);var a,o=Hg(n.getPresentNeighboorEntrances(i));try{for(o.s();!(a=o.n()).done;){var s=a.value,u=r.getPieceAt(s);u===Hae.EMPTY?r=r.removeTilesIfNeeded(s,t):u.is(this.getCurrentOpponent())&&r.isSurrounded(s)&&(r=r.capture(s))}}catch(c){o.e(c)}finally{o.f()}}return r}},{key:"isTileEmpty",value:function(e){M7(this.getPieceAt(e)!==Hae.UNREACHABLE,"Should not call isTileEmpty on removed tile");for(var t=0;t<2;t++)for(var n=0;n<3;n++){var r=e.getNext(new Mae(n,t),1);if(this.getPieceAt(r)!==Hae.EMPTY)return!1}return!0}},{key:"isDeconnectable",value:function(e){var t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;for(var n=0,r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}},{key:"areNeighboor",value:function(e,t){return e+1===t||0===e&&5===t}},{key:"getPresentNeighboorTilesRelativeIndexes",value:function(e){for(var t=[],r=lV.empty(),i=0;i<6;i++){var a=e.getNext(n.NEIGHBOORS_TILES_DIRECTIONS[i],1);a.isInRange(15,10)&&this.getPieceAt(a)!==Hae.UNREACHABLE&&(r.isAbsent()&&(r=lV.of(i)),t.push(i-r.get()))}return t}},{key:"deconnectTile",value:function(e,t){oV(n.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});for(var r=this.getCopiedBoard(),i=e.x,a=e.y,o=0;o<2;o++)for(var s=0;s<3;s++)r[a+o][i+s]=Hae.UNREACHABLE;var u=[this.tiles[0],this.tiles[1]];return t&&(u[this.getCurrentPlayer().value]+=1),new n(r,this.turn,u,this.captures)}},{key:"getLegalLandings",value:function(e){var t,n=[],r=Hg($se.STEPS);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=e.getNext(i.direction,1);this.isOnBoard(a)&&this.getPieceAt(a)===Hae.EMPTY&&n.push(a)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"getPiecesByFreedom",value:function(){for(var e=[[0,0,0,0],[0,0,0,0]],t=0;t<10;t++)for(var n=0;n<15;n++){var r=this.board[t][n];if(r.isPlayer()){var i=this.getEmptyNeighboors(new Bae(n,t),Hae.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}],[{key:"getTilesUpperLeftCoord",value:function(e){var t=e.x-e.x%3,n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new Bae(t,n)}},{key:"getPresentNeighboorEntrances",value:function(e){return[new Bae(e.x+1,e.y-1),new Bae(e.x+3,e.y+0),new Bae(e.x+3,e.y+1),new Bae(e.x+1,e.y+2),new Bae(e.x-1,e.y+1),new Bae(e.x-1,e.y+0)].filter(n.isInRange)}},{key:"getInitialState",value:function(){var e=Hae.EMPTY,t=Hae.UNREACHABLE,r=Hae.ZERO,i=Hae.ONE;return new n([[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[e,i,e,i,e,e,r,e,r,e,e,i,e,i,e],[i,e,e,e,i,e,e,e,e,e,i,e,e,e,i],[e,i,e,i,e,e,e,e,e,e,e,i,e,i,e],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,i,e,i,e,e,r,e,r,e],[t,t,t,e,e,i,e,e,e,i,e,e,t,t,t],[t,t,t,t,t,t,i,e,i,t,t,t,t,t,t]],0,[0,0],[0,0])}}]),n}(jse);Zse.VERBOSE=!1,Zse.NEIGHBOORS_TILES_DIRECTIONS=[new Mae(0,-2),new Mae(3,-1),new Mae(3,1),new Mae(0,2),new Mae(-3,1),new Mae(-3,-1)],Zse.isInRange=function(e){return e.isInRange(15,10)};var Yse=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}},{key:"applyLegalTileExchange",value:function(e,t){var r=t.getCopiedBoard(),i=e.capture.get();r[i.y][i.x]=Hae.EMPTY;var a=[t.captures[0],t.captures[1]];a[t.getCurrentPlayer().value]+=1;var o=[t.tiles[0],t.tiles[1]];o[t.getCurrentPlayer().value]-=2;var s=new Zse(r,t.turn,o,a),u=s.removeTilesIfNeeded(i,!1),c=new Zse(u.getCopiedBoard(),u.turn+1,u.tiles,u.captures);return oV(n.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:t,afterCapture:s,afterTileRemoval:u,resultingState:c}}),c}},{key:"applyLegalMovement",value:function(e,t){var r=t.applyLegalMovement(e),i=r.removeTilesIfNeeded(e.start.get(),!0),a=i.doMovementCaptures(e),o=new Zse(a.board,t.turn+1,a.tiles,a.captures);return oV(n.VERBOSE,{ab_state:t,afterMovement:r,afterTilesRemoved:i,afterCaptures:a,resultingState:o}),o}},{key:"isLegal",value:function(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}},{key:"isLegalTileExchange",value:function(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return S7.failure(Gse.NOT_ENOUGH_TILES_TO_EXCHANGE());var n=t.getPieceAt(e.capture.get());return n===Hae.UNREACHABLE||n===Hae.EMPTY?S7.failure(Gse.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?S7.failure(Gse.CANNOT_CAPTURE_OWN_PIECES()):S7.success(void 0)}},{key:"isLegalMovement",value:function(e,t){if(t.getPieceAt(e.start.get())===Hae.UNREACHABLE){var n="Cannot start with a coord outside the board "+e.start.get().toString()+".";return S7.failure(n)}if(t.getPieceAt(e.landingCoord.get())===Hae.UNREACHABLE){var r="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return S7.failure(r)}var i=t.getPieceAt(e.start.get());return i===Hae.EMPTY?S7.failure(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):i.is(t.getCurrentOpponent())?S7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"getGameStatus",value:function(e){var t=e.gameState;return t.captures[0]>=18?loe.ZERO_WON:t.captures[1]>=18?loe.ONE_WON:loe.ONGOING}}]),n}(hoe);return e.VERBOSE=!1,e}(),Kse=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}},{key:"getListExchanges",value:function(e){var t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=Hae.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(var a=0;a<10;a++)for(var o=0;o<15;o++){var s=new Bae(o,a);if(n.getPieceAt(s)===i){var u=Wse.fromTilesExchange(s);t.push(u)}}return t}},{key:"getListMovement",value:function(e){for(var t=[],n=e.gameState,r=n.getCurrentPlayer(),i=0;i<10;i++)for(var a=0;a<15;a++){var o=new Bae(a,i);if(n.getPieceAt(o).is(r)){var s,u=Hg(n.getLegalLandings(o));try{for(u.s();!(s=u.n()).done;){var c=s.value,l=Wse.fromCoordToCoord(o,c);t.push(l)}}catch(h){u.e(h)}finally{u.f()}}}return t}},{key:"getBoardValue",value:function(e){var t=Yse.getGameStatus(e);if(t.isEndGame)return Kae.fromWinner(t.winner);var n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new Kae(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}},{key:"getPiecesScore",value:function(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}},{key:"getPlayerPiecesScore",value:function(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}},{key:"putCaptureFirst",value:function(e,t){var n=this;return Ure.sortByDescending(t,function(t){return n.moveCapturesList(e,t).length}),t}},{key:"moveCapturesList",value:function(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}]),n}(Yae),Qse=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=Yse.getGameStatus(e);if(t.isEndGame)return Kae.fromWinner(t.winner);var r,i=e.gameState,a=this.getPiecesMap(i),o=this.getThreatMap(i,a),s=this.filterThreatMap(o,i),u=0,c=Hg(Nre.PLAYERS);try{for(c.s();!(r=c.n()).done;){var l,h=r.value,f=Hg(a.get(h).get());try{for(f.s();!(l=f.n()).done;){var d=l.value;s.get(d).isPresent()?u+=h.getScoreModifier()*n.SCORE_BY_THREATENED_PIECE:u+=h.getScoreModifier()*n.SCORE_BY_SAFE_PIECE}}catch(v){f.e(v)}finally{f.f()}}}catch(v){c.e(v)}finally{c.f()}return u+=i.tiles[1]-i.tiles[0],new Kae(u)}},{key:"getPiecesMap",value:function(e){for(var t=new ooe,n=[],r=[],i=0;i<10;i++)for(var a=0;a<15;a++){var o=new Bae(a,i),s=e.getPieceAt(o);s===Hae.ZERO?n.push(o):s===Hae.ONE&&r.push(o)}return t.set(Nre.ZERO,new Cse(n)),t.set(Nre.ONE,new Cse(r)),t}},{key:"getThreatMap",value:function(e,t){var n,r=new ooe,i=Hg(Nre.PLAYERS);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=Hg(t.get(o).get());try{for(s.s();!(a=s.n()).done;){var u=a.value,c=this.getThreat(u,e);c.isPresent()&&r.set(u,c.get())}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}return r}},{key:"getThreat",value:function(e,t){var n,r=Nre.of(t.getPieceAt(e).value).getOpponent(),i=lV.empty(),a=[],o=Hg(qse.getNeighbors(e).filter(function(e){return e.isInRange(15,10)}));try{for(o.s();!(n=o.n()).done;){var s=n.value,u=t.getPieceAt(s);if(u.is(r))a.push(s);else if(u===Hae.EMPTY){if(i.isPresent())return lV.empty();i=lV.of(s)}}}catch(d){o.e(d)}finally{o.f()}if(i.isPresent()){var c,l=[],h=Hg($se.STEPS);try{var f=function(){var e=c.value,n=i.get().getNext(e.direction,1);n.isInRange(15,10)&&t.getPieceAt(n).is(r)&&a.every(function(e){return!1===e.equals(n)})&&l.push(n)};for(h.s();!(c=h.n()).done;)f()}catch(d){h.e(d)}finally{h.f()}if(l.length>0)return lV.of(new kse(new Cse(a),new Cse(l)))}return lV.empty()}},{key:"filterThreatMap",value:function(e,t){var n,r=new ooe,i=e.listKeys(),a=i.filter(function(e){return t.getPieceAt(e).is(t.getCurrentPlayer())}),o=new Cse(i.filter(function(e){return t.getPieceAt(e).is(t.getCurrentOpponent())})),s=Hg(a);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=e.get(u).get();M7(1===c.directThreats.size(),"oldThreat must contain exactly one direct threat");var l=c.directThreats.getAnyElement().get(),h=lV.empty();if(!1===o.contains(l)){var f,d=[],v=Hg(c.mover);try{for(v.s();!(f=v.n()).done;){var p=f.value;!1===o.contains(p)&&d.push(p)}}catch(_){v.e(_)}finally{v.f()}d.length>0&&(h=lV.of(new kse(c.directThreats,new Cse(d))))}h.isPresent()&&r.set(u,h.get())}}catch(_){s.e(_)}finally{s.f()}var g,y=Hg(o);try{for(y.s();!(g=y.n()).done;){var m=g.value,k=e.get(m).get();r.set(m,k)}}catch(_){y.e(_)}finally{y.f()}return r}}]),n}(Kse);return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e}(),Xse=Hae.EMPTY,Jse=Hae.UNREACHABLE,eue=Hae.ZERO,tue=Hae.ONE,nue=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Nt||(Nt=wg(["Board and goal of the game"]))),$localize(Dt||(Dt=wg(["Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.\n         The triangles are the spaces on which pieces move during the game.\n         The tiles can be removed from the board (you will see how later).\n         The dark pieces belong to the first player and can only move on the dark spaces,\n         while the light pieces belong to the second player and can only move on the light spaces.\n         The goal of the game is to capture all of the opponent's pieces."]))),Zse.getInitialState()),poe.anyMove($localize(Lt||(Lt=wg(["Move"]))),$localize(Ft||(Ft=wg(["To move a piece, you need to:\n        <ol>\n          <li>Click on one of your pieces.</li>\n          <li>Click on one of the triangular space highlighted in yellow.</li>\n        </ol>\n        You can pass through the opponent's pieces.\n        You're playing first, hence you're playing Dark.<br/><br/>\n        Perform any move."]))),Zse.getInitialState(),Wse.fromCoordToCoord(new Bae(3,5),new Bae(5,5)),$localize(Ut||(Ut=wg(["Congratulations! Let's see captures now."])))),poe.fromMove($localize(Bt||(Bt=wg(["Capture"]))),$localize(Vt||(Vt=wg(["Every piece has three neighboring triangular spaces (2 on the sides).\n        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!\n        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>\n        You're playing Light, make a capture."]))),new Zse([[Jse,Jse,Jse,Jse,Jse,Jse,eue,Xse,eue,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,eue,Xse,Xse,Xse,Xse,Xse,eue,Xse,Xse,Jse,Jse,Jse],[Xse,tue,Xse,tue,eue,tue,Xse,Xse,eue,Xse,Xse,tue,Xse,tue,Xse],[tue,Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,tue,Xse,Xse,Xse,tue],[Xse,tue,Xse,tue,Xse,Xse,Xse,Xse,Xse,Xse,Xse,tue,Xse,tue,Xse],[Xse,eue,Xse,eue,Xse,Xse,Xse,Xse,Xse,Xse,Xse,eue,Xse,eue,Xse],[eue,Xse,Xse,Xse,eue,Xse,Xse,Xse,Xse,Xse,eue,Xse,Xse,Xse,eue],[Xse,eue,Xse,eue,Xse,Xse,tue,Xse,tue,Xse,Xse,eue,Xse,eue,Xse],[Jse,Jse,Jse,Xse,Xse,tue,Xse,Xse,Xse,tue,Xse,Xse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,tue,Xse,tue,Jse,Jse,Jse,Jse,Jse,Jse]],3,[0,0],[0,0]),[Wse.fromCoordToCoord(new Bae(5,2),new Bae(4,1)),Wse.fromCoordToCoord(new Bae(3,4),new Bae(4,3))],$localize(zt||(zt=wg(["Congratulations!"]))),$localize(Ht||(Ht=wg(["Failed, you have not captured any piece."])))),poe.fromMove($localize(Gt||(Gt=wg(["Gain a tile"]))),$localize($t||($t=wg(["When a tile is empty, it can become removable from the board.\n        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.\n        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.\n        For example, here, the topmost dark piece will not disconnect its tile when leaving it.\n        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>\n        Perform a move that lets you gain two tiles."]))),new Zse([[Jse,Jse,Jse,Jse,Jse,Jse,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,tue,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Xse,Xse,Xse,Jse,Jse,Jse,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Xse,Xse,tue,Xse,Xse,Xse,Xse,eue,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Xse,Xse,Xse,tue,Xse,Xse,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,Xse,eue,Jse,Jse,Jse],[Xse,Xse,eue,Xse,Xse,tue,Xse,Xse,Xse,Xse,eue,Xse,Xse,Xse,eue],[Xse,Xse,Xse,Xse,Xse,Xse,tue,Xse,tue,Xse,Xse,eue,Xse,eue,Xse],[Jse,Jse,Jse,Xse,Xse,tue,Xse,Xse,Xse,tue,Xse,Xse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,tue,Xse,tue,Jse,Jse,Jse,Jse,Jse,Jse]],2,[0,0],[0,0]),[Wse.fromCoordToCoord(new Bae(2,6),new Bae(4,6)),Wse.fromCoordToCoord(new Bae(2,6),new Bae(3,5)),Wse.fromCoordToCoord(new Bae(2,6),new Bae(3,7))],$localize(Wt||(Wt=wg(["Congratulations!"]))),$localize(qt||(qt=wg(["Failed, you have not gained the two tiles that you could, try again!"])))),poe.fromMove($localize(jt||(jt=wg(["Exchanging a tile"]))),$localize(Zt||(Zt=wg(["When you have a tile, you can see it on the left of the board.\n        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.\n        This will cost you two tiles.\n        If any tiles are removed during that turn, nobody will get them.<br/><br/>\n        Gain some time and capture the last piece!"]))),new Zse([[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,eue,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,Xse,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,Xse,tue,Xse,tue,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,tue,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,tue,Xse,tue,Jse,Jse,Jse,Jse,Jse,Jse]],1,[0,2],[0,0]),[Wse.fromTilesExchange(new Bae(5,5))],$localize(Yt||(Yt=wg(["Congratulations!"]))),$localize(Kt||(Kt=wg(["It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!"])))),poe.fromMove($localize(Qt||(Qt=wg(["Special capture"]))),$localize(Xt||(Xt=wg(["When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!\n        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>\n        A move that demonstrate both of these things can be done on this board by Light. Try it!"]))),new Zse([[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Xse,Xse,eue,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,eue,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,eue,tue,Xse,tue,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,tue,eue,Xse,Xse,Xse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Xse,Xse,tue,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse],[Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse,Jse]],1,[0,0],[0,0]),[Wse.fromCoordToCoord(new Bae(7,6),new Bae(6,5)),Wse.fromCoordToCoord(new Bae(7,6),new Bae(8,5))],$localize(Jt||(Jt=wg(["Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.\n        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space."]))),$localize(en||(en=wg(["Failed!"]))))]});function rue(e,t){if(1&e&&(c_(),nS(0,"polygon",13)),2&e){var n=hS().index,r=hS().index,i=hS();XE("ngClass",i.getPyramidClass(n,r)),$E("points",i.getPyramidCoordinate(n,r))}}function iue(e,t){if(1&e&&(c_(),nS(0,"polygon",15)),2&e){var n=hS(2).index,r=hS().index,i=hS();XE("ngClass",i.getEmptyClass(n,r)),$E("points",i.getTriangleCoordinate(n,r))}}function aue(e,t){if(1&e&&(c_(),YE(0,iue,1,2,"polygon",14)),2&e){var n=hS().index,r=hS().index;XE("ngIf",hS().isEmptyCase(n,r))}}function oue(e,t){if(1&e&&(c_(),nS(0,"polygon",16)),2&e){var n=hS().index,r=hS().index,i=hS();vS("id","dark_line_",n,"_",r,""),$E("points",i.getLineCoordinate(n,r))}}function sue(e,t){if(1&e&&(c_(),nS(0,"polygon",17)),2&e){var n=hS().index,r=hS().index,i=hS();vS("id","dark_line_",n,"_",r,""),$E("points",i.getLineCoordinate(n,r))}}function uue(e,t){if(1&e){var n=aS();c_(),eS(0,"g",8),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),YE(1,rue,1,2,"polygon",9),YE(2,aue,1,1,"ng-template",null,10,RT),YE(4,oue,1,3,"polygon",11),YE(5,sue,1,3,"polygon",12),tS()}if(2&e){var r=t.$implicit,i=t.index,a=KE(3),o=hS().index,s=hS();vS("id","click_",i,"_",o,""),pb(1),XE("ngIf",s.isPyramid(i,o))("ngIfElse",a),pb(3),XE("ngIf",r!==s.NONE),pb(1),XE("ngIf",r!==s.NONE)}}function cue(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,uue,6,6,"g",7),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function lue(e,t){if(1&e&&(c_(),nS(0,"polygon",18)),2&e){var n=t.$implicit;$E("points",hS().getTriangleCoordinate(n.x,n.y))}}function hue(e,t){if(1&e&&(c_(),nS(0,"polygon",19)),2&e){var n=hS();$E("points",n.getTriangleCoordinate(n.lastStart.get().x,n.lastStart.get().y))}}function fue(e,t){if(1&e&&(c_(),nS(0,"polygon",19)),2&e){var n=hS();$E("points",n.getTriangleCoordinate(n.lastEnd.get().x,n.lastEnd.get().y))}}function due(e,t){if(1&e&&(c_(),nS(0,"polygon",20)),2&e){var n=hS();$E("points",n.getTriangleCoordinate(n.chosenCoord.get().x,n.chosenCoord.get().y))}}function vue(e,t){if(1&e&&(c_(),eS(0,"g",21),nS(1,"polygon",22),eS(2,"text",23),FS(3),tS(),tS()),2&e){var n=hS();pb(1),$E("points",n.getTilesCountCoordinate(0,0))("stroke",n.lastTurnWasTilesExchange(0)?"yellow":"black"),pb(1),$E("x",n.SPACE_SIZE/2+0*n.SPACE_SIZE)("y",16+n.SPACE_SIZE/2+0*n.SPACE_SIZE)("font-size",n.SPACE_SIZE/2),pb(1),US(n.tiles[0])}}function pue(e,t){if(1&e&&(c_(),eS(0,"g",24),nS(1,"polygon",25),eS(2,"text",26),FS(3),tS(),tS()),2&e){var n=hS();pb(1),$E("points",n.getTilesCountCoordinate(0,9))("stroke",n.lastTurnWasTilesExchange(1)?"yellow":"black"),pb(1),$E("x",n.SPACE_SIZE/2+0*n.SPACE_SIZE)("y",16+n.SPACE_SIZE/2+9*n.SPACE_SIZE)("font-size",n.SPACE_SIZE/2),pb(1),US(n.tiles[1])}}var gue=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).tiles=[0,0],r.NONE=Hae.UNREACHABLE,r.chosenCoord=lV.empty(),r.lastStart=lV.empty(),r.lastEnd=lV.empty(),r.highlights=[],r.scores=lV.of([0,0]),r.rules=new Yse(Zse),r.availableMinimaxes=[new Kse(r.rules,"Normal"),new Qse(r.rules,"Piece > Threat > Tiles")],r.encoder=Wse.encoder,r.tutorial=(new nue).tutorial,r.SPACE_SIZE=70,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.chosenCoord=lV.empty(),this.state=this.rules.node.gameState,this.scores=lV.of(this.state.captures),this.tiles=this.state.tiles;var e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=lV.empty(),this.lastEnd=lV.empty()),this.board=this.rules.node.gameState.board}},{key:"showHighlight",value:function(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}},{key:"cancelMoveAttempt",value:function(){this.chosenCoord=lV.empty(),this.highlights=[]}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return a=new Bae(e,t),r.abrupt("return",n.chosenCoord.isAbsent()?n.firstClick(a):n.secondClick(a));case 5:case"end":return r.stop()}},r)}))()}},{key:"firstClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.state.getPieceAt(e)).is(t.state.getCurrentOpponent())){n.next=4;break}return i=Wse.fromTilesExchange(e),n.abrupt("return",t.chooseMove(i,t.state,t.state.captures));case 4:return n.abrupt("return",r.is(t.state.getCurrentPlayer())?(t.chosenCoord=lV.of(e),t.showHighlight(),T7.SUCCESS):t.cancelMove(Gse.FIRST_CLICK_SHOULD_NOT_BE_NULL()));case 5:case"end":return n.stop()}},n)}))()}},{key:"secondClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.equals(t.chosenCoord.get())){n.next=2;break}return n.abrupt("return",(t.cancelMoveAttempt(),T7.SUCCESS));case 2:if(!t.highlights.some(function(t){return t.equals(e)})){n.next=5;break}return r=Wse.fromCoordToCoord(t.chosenCoord.get(),e),n.abrupt("return",t.chooseMove(r,t.state,t.state.captures));case 5:return n.abrupt("return",t.cancelMove(Gse.INVALID_DISTANCE()));case 6:case"end":return n.stop()}},n)}))()}},{key:"isPyramid",value:function(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}},{key:"wasOpponent",value:function(e,t){var n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}},{key:"getPyramidClass",value:function(e,t){var n=this.board[t][e];return n===Hae.ZERO?this.getPlayerClass(Nre.ZERO):n===Hae.ONE?this.getPlayerClass(Nre.ONE):"captured"}},{key:"isEmptyCase",value:function(e,t){return this.board[t][e]===Hae.EMPTY||this.wasRemoved(e,t)}},{key:"wasRemoved",value:function(e,t){var n=this.rules.node.mother;if(this.board[t][e]===Hae.UNREACHABLE&&n.isPresent()){var r=n.get().gameState.getPieceAtXY(e,t);return r===Hae.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}},{key:"getEmptyClass",value:function(e,t){return this.board[t][e]===Hae.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}},{key:"getTilesCountCoordinate",value:function(e,t){var n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}},{key:"getLineCoordinate",value:function(e,t){var n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}},{key:"mustShowTilesOf",value:function(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}},{key:"lastTurnWasTilesExchange",value:function(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}]),n}(Hse);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-coerceo"]],features:[xE],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,cue,2,1,"g",1),YE(2,lue,1,1,"polygon",2),YE(3,hue,1,1,"polygon",3),YE(4,fue,1,1,"polygon",3),YE(5,due,1,1,"polygon",4),YE(6,vue,4,6,"g",5),YE(7,pue,4,6,"g",6),tS()),2&e&&($E("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.highlights),pb(1),XE("ngIf",t.lastStart.isPresent()),pb(1),XE("ngIf",t.lastEnd.isPresent()),pb(1),XE("ngIf",t.chosenCoord.isPresent()),pb(1),XE("ngIf",t.mustShowTilesOf(0)),pb(1),XE("ngIf",t.mustShowTilesOf(1)))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),yue=function(){var e=jg(function e(){Wg(this,e)});return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=function(){return $localize(tn||(tn=wg(["Your piece should land on a neighboring square."])))},e.CANNOT_DROP_AFTER_TURN_40=function(){return $localize(nn||(nn=wg(["You cannot drop a piece during the moving phase."])))},e.CANNOT_MOVE_BEFORE_TURN_40=function(){return $localize(rn||(rn=wg(["You cannot move a piece before both players have dropped all of their pieces."])))},e.MUST_JUMP_OVER_PIECES=function(){return $localize(an||(an=wg(["A jump must be made over a piece, not over an empty square."])))},e.MUST_DROP_IN_CENTRAL_ZONE=function(){return $localize(on||(on=wg(["A drop must occur in the central zone of the board."])))},e.INVALID_JUMP=function(){return $localize(sn||(sn=wg(["A jump must land two squares from its original position, and be done in a straight line in any direction."])))},e.SAME_LOCATION_VISITED_IN_JUMP=function(){return $localize(un||(un=wg(["You are visiting the same location twice in a move, you are not allowed to do so."])))},e}(),mue=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isShelter",value:function(e){return 0===e.x||e.x===n.WIDTH-1?n.SHELTERS_INDICES.some(function(t){return e.y===t}):(0===e.y||e.y===n.HEIGHT-1)&&n.SHELTERS_INDICES.some(function(t){return e.x===t})}},{key:"isCentralZone",value:function(e){return e.x>=n.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=n.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=n.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=n.CENTRAL_ZONE_BOTTOM_RIGHT.y}},{key:"isDropPhase",value:function(){return this.turn<40}},{key:"getSidePieces",value:function(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}],[{key:"getInitialState",value:function(){return new n(Ure.createTable(n.WIDTH,n.HEIGHT,Mre.NONE),0)}}]),n}(eoe);mue.WIDTH=17,mue.HEIGHT=17,mue.CENTRAL_ZONE_TOP_LEFT=new Bae(4,6),mue.CENTRAL_ZONE_BOTTOM_RIGHT=new Bae(12,10),mue.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],mue.ALL_SHELTERS=new Xae(mue.SHELTERS_INDICES.flatMap(function(e){return[new Bae(e,0),new Bae(e,mue.HEIGHT-1),new Bae(0,e),new Bae(mue.WIDTH-1,e)]})).toList();var kue=function(e){Mg(n,e);var t=Dg(n);function n(e){return Wg(this,n),t.call(this,e.x,e.y)}return jg(n,[{key:"toString",value:function(){return"ConspirateursMoveDrop(".concat(this.coord.toString(),")")}},{key:"equals",value:function(e){return!!e.isDrop()&&this.coord.equals(e.coord)}},{key:"isDrop",value:function(){return!0}},{key:"isSimple",value:function(){return!1}},{key:"isJump",value:function(){return!1}}],[{key:"of",value:function(e){return e.isInRange(mue.WIDTH,mue.HEIGHT)?S7.success(new n(e)):S7.failure("Move out of board")}}]),n}(roe);kue.encoder=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getEncoder",value:function(e,t,n){return new(function(r){Mg(a,r);var i=Dg(a);function a(){var e;return Wg(this,a),(e=i.apply(this,arguments)).shiftX=t,e}return jg(a,[{key:"maxValue",value:function(){return(e-1)*this.shiftX+(t-1)}},{key:"encodeNumber",value:function(e){return e.coord.x*this.shiftX+e.coord.y}},{key:"decodeNumber",value:function(r){var i=r%t;r/=t;var a=new Bae((r-=r%1)%e,i);return n(a)}}]),a}(xre))}}]),e}().getEncoder(mue.WIDTH,mue.HEIGHT,function(e){return kue.of(e).get()});var _ue=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"toString",value:function(){return"ConspirateursMoveSimple(".concat(this.coord.toString()," -> ").concat(this.end.toString(),")")}},{key:"equals",value:function(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}},{key:"isDrop",value:function(){return!1}},{key:"isSimple",value:function(){return!0}},{key:"isJump",value:function(){return!1}}],[{key:"of",value:function(e,t){return e.isInRange(mue.WIDTH,mue.HEIGHT)&&t.isInRange(mue.WIDTH,mue.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?S7.success(new n(e,t)):S7.failure(yue.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):S7.failure("Move out of board")}}]),n}(ose);_ue.encoder=ose.getEncoder(mue.WIDTH,mue.HEIGHT,function(e,t){return _ue.of(e,t).get()});var Cue=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).coords=e,r}return jg(n,[{key:"addJump",value:function(e){var t=Ure.copyImmutableArray(this.coords);return t.push(e),n.of(t)}},{key:"getStartingCoord",value:function(){return this.coords[0]}},{key:"getEndingCoord",value:function(){return this.coords[this.coords.length-1]}},{key:"getLandingCoords",value:function(){return this.coords.slice(1)}},{key:"getJumpedOverCoords",value:function(){for(var e=[],t=1;t<this.coords.length;t++){var n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}},{key:"toString",value:function(){return"ConspirateursMoveJump(".concat(this.coords.map(function(e){return e.toString()}).reduce(function(e,t){return e+" -> "+t}),")")}},{key:"equals",value:function(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}},{key:"isDrop",value:function(){return!1}},{key:"isSimple",value:function(){return!1}},{key:"isJump",value:function(){return!0}}],[{key:"of",value:function(e){if(e.length<2)return S7.failure("ConspirateursMoveJump requires at least one jump, so two coords");var t,r=Hg(e);try{for(r.s();!(t=r.n()).done;){if(t.value.isNotInRange(mue.WIDTH,mue.HEIGHT))return S7.failure("Move out of board")}}catch(a){r.e(a)}finally{r.f()}for(var i=1;i<e.length;i++)if(e[i-1].getDirectionToward(e[i]).isFailure()||2!==e[i-1].getDistance(e[i]))return S7.failure(yue.INVALID_JUMP());return new Cse(e).size()===e.length?S7.success(new n(e)):S7.failure(yue.SAME_LOCATION_VISITED_IN_JUMP())}}]),n}(noe);Cue.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).coordEncoder=Bae.numberEncoder(mue.WIDTH,mue.HEIGHT),e}return jg(n,[{key:"encodeMove",value:function(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}},{key:"decodeMove",value:function(e){M7(null!=aV.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");var t=aV.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return Cue.of(t).get()}}]),n}(Are));var wue=Are.disjunction3(kue.encoder,_ue.encoder,Cue.encoder,function(e){return e.isDrop()},function(e){return e.isSimple()}),bue=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,mue)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){var r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=Mre.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{var i=e.getStartingCoord(),a=e.getEndingCoord();r[i.y][i.x]=Mre.NONE,r[a.y][a.x]=t.getCurrentPlayer()}return new mue(r,t.turn+1)}},{key:"isLegal",value:function(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}},{key:"dropLegality",value:function(e,t){return t.turn>=40?S7.failure(yue.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord).isPlayer()?S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?S7.failure(yue.MUST_DROP_IN_CENTRAL_ZONE()):S7.success(void 0)}},{key:"simpleMoveLegality",value:function(e,t){return t.turn<40?S7.failure(yue.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end).isPlayer()?S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE()):S7.success(void 0)}},{key:"jumpLegality",value:function(e,t){if(t.turn<40)return S7.failure(yue.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE());var n,r=Hg(e.getJumpedOverCoords());try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.getPieceAt(i)===Mre.NONE)return S7.failure(yue.MUST_JUMP_OVER_PIECES())}}catch(u){r.e(u)}finally{r.f()}var a,o=Hg(e.getLandingCoords());try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t.getPieceAt(s).isPlayer())return S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE())}}catch(u){o.e(u)}finally{o.f()}return S7.success(void 0)}},{key:"jumpTargetsFrom",value:function(e){for(var t=[],n=0,r=[new Bae(e.x+2,e.y),new Bae(e.x-2,e.y),new Bae(e.x,e.y+2),new Bae(e.x,e.y-2),new Bae(e.x+2,e.y+2),new Bae(e.x+2,e.y-2),new Bae(e.x-2,e.y+2),new Bae(e.x-2,e.y-2)];n<r.length;n++){var i=r[n];Cue.of([e,i]).isSuccess()&&t.push(i)}return t}},{key:"nextJumps",value:function(e,t){var n,r=e.getEndingCoord(),i=[],a=Hg(this.jumpTargetsFrom(r));try{for(a.s();!(n=a.n()).done;){var o=n.value,s=e.addJump(o);s.isSuccess()&&this.jumpLegality(s.get(),t).isSuccess()&&i.push(s.get())}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"jumpHasPossibleNextTargets",value:function(e,t){return this.nextJumps(e,t).length>0}},{key:"getGameStatus",value:function(e){var t,n=e.gameState,r=[0,0],i=Hg(mue.ALL_SHELTERS);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=n.getPieceAt(a);if(o.isPlayer()&&(r[o.value]+=1,20===r[o.value]))return loe.getVictory(o)}}catch(s){i.e(s)}finally{i.f()}return loe.ONGOING}}],[{key:"get",value:function(){return n.singleton.isAbsent()&&(n.singleton=lV.of(new n)),n.singleton.get()}}]),n}(hoe);bue.singleton=lV.empty();var Eue=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}},{key:"getListMovesDrop",value:function(e){for(var t=[],n=mue.CENTRAL_ZONE_TOP_LEFT,r=mue.CENTRAL_ZONE_BOTTOM_RIGHT,i=n.y;i<=r.y;i++)for(var a=n.x;a<=r.x;a++)e.getPieceAtXY(a,i)===Mre.NONE&&t.push(kue.of(new Bae(a,i)).get());return t}},{key:"getListMovesAfterDrop",value:function(e){for(var t=[],n=e.getCurrentPlayer(),r=0;r<mue.HEIGHT;r++)for(var i=0;i<mue.WIDTH;i++){var a=new Bae(i,r);e.getPieceAt(a)===n&&(t=(t=t.concat(this.getListSimpleMoves(e,a))).concat(this.getListJumps(e,a)))}return t}},{key:"getListSimpleMoves",value:function(e,t){for(var n=[],r=0,i=[new Bae(t.x+1,t.y),new Bae(t.x-1,t.y),new Bae(t.x,t.y+1),new Bae(t.x,t.y-1),new Bae(t.x+1,t.y+1),new Bae(t.x+1,t.y-1),new Bae(t.x-1,t.y+1),new Bae(t.x-1,t.y-1)];r<i.length;r++){var a=i[r],o=_ue.of(t,a);o.isSuccess()&&bue.get().simpleMoveLegality(o.get(),e).isSuccess()&&n.push(o.get())}return n}},{key:"getListJumps",value:function(e,t){var n,r=new Xae,i=Hg(bue.get().jumpTargetsFrom(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=Cue.of([t,a]).get();bue.get().jumpLegality(o,e).isSuccess()&&(r.add(o),r.union(this.getListJumpStartingFrom(e,o)))}}catch(s){i.e(s)}finally{i.f()}return r.toList()}},{key:"getListJumpStartingFrom",value:function(e,t){var n,r=bue.get().nextJumps(t,e),i=new Xae(r),a=Hg(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.union(this.getListJumpStartingFrom(e,o))}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"getBoardValue",value:function(e){for(var t=e.gameState,n=0,r=new ooe([{key:Nre.ZERO,value:0},{key:Nre.ONE,value:0}]),i=0;i<mue.HEIGHT;i++)for(var a=0;a<mue.WIDTH;a++){var o=new Bae(a,i),s=t.getPieceAt(o);if(s.isPlayer())if(t.isShelter(o)){if(n+=20*s.getScoreModifier(),r.replace(s,r.get(s).get()+1),20===r.get(s).get())return new Kae(s.getVictoryValue())}else{var u,c=100,l=Hg(mue.ALL_SHELTERS);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(t.getPieceAt(h)===Mre.NONE){var f=o.getOrthogonalDistance(h);c=Math.min(c,f)}}}catch(d){l.e(d)}finally{l.f()}n-=s.getScoreModifier()*c}}return new Kae(n)}}]),n}(Yae),Sue=Mre.NONE,Pue=Nre.ZERO,Oue=Nre.ONE,Tue=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(cn||(cn=wg(["Board and aim of the game"]))),$localize(ln||(ln=wg(["Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially."]))),mue.getInitialState()),poe.anyMove($localize(hn||(hn=wg(["Initial phase"]))),$localize(fn||(fn=wg(["In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone."]))),mue.getInitialState(),kue.of(new Bae(7,7)).get(),$localize(dn||(dn=wg(["Congratulations!"])))),poe.fromPredicate($localize(vn||(vn=wg(["Simple move"]))),$localize(pn||(pn=wg(["Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move."]))),new mue([[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Pue,Oue,Oue,Pue,Pue,Oue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Oue,Pue,Oue,Pue,Pue,Pue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Oue,Sue,Sue,Sue,Sue,Sue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Pue,Oue,Oue,Oue,Pue,Pue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Oue,Oue,Oue,Oue,Oue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue]],40),_ue.of(new Bae(4,6),new Bae(3,5)).get(),function(e,t){return e.isSimple()?T7.SUCCESS:T7.failure($localize(gn||(gn=wg(["You have made a jump, not a simple move. Try again!"]))))},$localize(yn||(yn=wg(["Congratulations!"])))),poe.fromPredicate($localize(mn||(mn=wg(["Jumps"]))),$localize(kn||(kn=wg(["The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful)."]))),new mue([[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Pue,Oue,Oue,Pue,Pue,Oue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Oue,Pue,Oue,Pue,Pue,Pue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Oue,Sue,Sue,Sue,Sue,Sue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Pue,Oue,Oue,Oue,Pue,Pue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Oue,Oue,Oue,Oue,Oue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue]],40),Cue.of([new Bae(6,7),new Bae(6,5)]).get(),function(e,t){return e.isJump()?T7.SUCCESS:T7.failure($localize(_n||(_n=wg(["You have not performed a jump. Try again!"]))))},$localize(Cn||(Cn=wg(["Congratulations!"])))),poe.fromMove($localize(wn||(wn=wg(["Chaining jumps in a single move"]))),$localize(bn||(bn=wg(["Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it."]))),new mue([[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Oue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Oue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Oue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Pue,Sue,Oue,Pue,Pue,Oue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Sue,Pue,Oue,Pue,Pue,Pue,Pue,Oue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Pue,Oue,Sue,Sue,Sue,Sue,Sue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Pue,Oue,Oue,Oue,Pue,Pue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Oue,Pue,Oue,Oue,Oue,Oue,Oue,Oue,Pue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue],[Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue,Sue]],40),[Cue.of([new Bae(8,6),new Bae(6,4),new Bae(6,2),new Bae(6,0)]).get()],$localize(En||(En=wg(["Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does."]))),$localize(Sn||(Sn=wg(["You have not performed a triple jump. Try again!"]))))]});function Iue(e,t){if(1&e){var n=aS();c_(),eS(0,"rect",9),uS("click",function(){Nk(n);var e=hS().$implicit;return hS(2).onClick(e.coord)}),tS()}if(2&e){var r=hS().$implicit,i=hS(2);$E("x",1.5*i.STROKE_WIDTH+i.SPACE_SIZE*r.coord.x+i.STROKE_WIDTH)("y",1.5*i.STROKE_WIDTH+i.SPACE_SIZE*r.coord.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE-3*i.STROKE_WIDTH)("height",i.SPACE_SIZE-3*i.STROKE_WIDTH)}}function Aue(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",6),uS("click",function(){Nk(n);var e=hS().$implicit;return hS(2).onClick(e.coord)}),tS()}if(2&e){var r=hS(),i=r.index,a=r.$implicit,o=hS().index,s=hS();vS("id","piece_",i,"_",o,""),XE("ngClass",a.pieceClasses),$E("r",s.PIECE_RADIUS)("cx",s.SPACE_SIZE*i+s.STROKE_WIDTH+s.SPACE_SIZE/2)("cy",s.SPACE_SIZE*o+s.STROKE_WIDTH+s.SPACE_SIZE/2)}}function xue(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",6),uS("click",function(){var e=Nk(n).$implicit;return hS(2).onClick(e.coord)}),tS(),YE(2,Iue,1,4,"rect",7),YE(3,Aue,1,6,"circle",8),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","click_",i,"_",a,""),XE("ngClass",r.squareClasses),$E("x",o.SPACE_SIZE*i+o.STROKE_WIDTH)("y",o.SPACE_SIZE*a+o.STROKE_WIDTH)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r.isShelter),pb(1),XE("ngIf",r.hasPiece)}}function Rue(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,xue,4,9,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Mue(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",10),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),XE("ngClass",i.viewInfo.boardInfo[r.y][r.x].shelterClasses),$E("x",i.SPACE_SIZE*r.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}function Nue(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=t.$implicit,r=hS();dS("id","sidePiece_0_",n,""),$E("cx",-r.PIECE_RADIUS)("cy",1670-n*r.PIECE_RADIUS)("r",r.PIECE_RADIUS-5)}}function Due(e,t){if(1&e&&(c_(),nS(0,"circle",12)),2&e){var n=t.$implicit,r=hS();dS("id","sidePiece_1_",n,""),$E("cx",1715+r.PIECE_RADIUS)("cy",1670-n*r.PIECE_RADIUS)("r",r.PIECE_RADIUS-5)}}function Lue(e,t){if(1&e&&(c_(),nS(0,"rect",13)),2&e){var n=hS();$E("x",n.SPACE_SIZE*n.CENTRAL_ZONE_START.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*n.CENTRAL_ZONE_START.y+n.STROKE_WIDTH)("width",n.CENTRAL_ZONE_SIZE.x*n.SPACE_SIZE)("height",n.CENTRAL_ZONE_SIZE.y*n.SPACE_SIZE)}}var Fue=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).ALL_SHELTERS=mue.ALL_SHELTERS,r.CENTRAL_ZONE_START=mue.CENTRAL_ZONE_TOP_LEFT,r.CENTRAL_ZONE_SIZE=new Mae(mue.CENTRAL_ZONE_BOTTOM_RIGHT.x-mue.CENTRAL_ZONE_TOP_LEFT.x+1,mue.CENTRAL_ZONE_BOTTOM_RIGHT.y-mue.CENTRAL_ZONE_TOP_LEFT.y+1),r.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},r.selected=lV.empty(),r.jumpInConstruction=lV.empty(),r.PIECE_RADIUS=r.SPACE_SIZE/2-r.STROKE_WIDTH,r.rules=bue.get(),r.availableMinimaxes=[new Eue(r.rules,"ConspirateursMinimax")],r.encoder=wue,r.tutorial=(new Tue).tutorial,r}return jg(n,[{key:"ngOnInit",value:function(){this.updateBoard()}},{key:"updateBoard",value:function(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}},{key:"updateViewInfo",value:function(){var e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(var t=0;t<mue.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(var n=0;n<mue.WIDTH;n++){var r=new Bae(n,t),i=e.getPieceAt(r),a={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i.isPlayer(),isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(a)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}},{key:"updateOccupiedShelters",value:function(){var e,t=Hg(mue.ALL_SHELTERS);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=this.viewInfo.boardInfo[n.y][n.x];r.isShelter=!0,r.hasPiece&&r.shelterClasses.push("highlighted")}}catch(i){t.e(i)}finally{t.f()}}},{key:"updateSelected",value:function(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){var e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;var r,i=Hg(e.coords);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.viewInfo.boardInfo[a.y][a.x].squareClasses.push("moved")}}catch(s){i.e(s)}finally{i.f()}}else{var o=this.selected.get();this.viewInfo.boardInfo[o.y][o.x].pieceClasses.push("selected")}}},{key:"updateVictory",value:function(){var e=this.getState(),t=bue.get().getGameStatus(this.rules.node);if(!0===t.isEndGame){var n,r=Hg(mue.ALL_SHELTERS);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.getPieceAt(i)===t.winner&&this.viewInfo.boardInfo[i.y][i.x].squareClasses.push("victory")}}catch(a){r.e(a)}finally{r.f()}}}},{key:"showLastMove",value:function(){var e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";var t,n=Hg(e.coords);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=r.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=r.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}catch(i){n.e(i)}finally{n.f()}}}},{key:"cancelMoveAttempt",value:function(){this.jumpInConstruction=lV.empty(),this.selected=lV.empty(),this.updateBoard()}},{key:"onClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#click_"+e.x+"_"+e.y)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if((i=t.getState()).getPieceAt(e)!==t.getCurrentPlayer()){n.next=6;break}return n.abrupt("return",(t.selected=lV.of(e),t.jumpInConstruction=lV.empty(),t.updateViewInfo(),T7.SUCCESS));case 6:if(!t.jumpInConstruction.isPresent()){n.next=8;break}return n.abrupt("return",t.constructJump(e));case 8:if(!t.selected.isPresent()){n.next=10;break}return n.abrupt("return",t.selectNextCoord(e));case 10:if(!i.isDropPhase()){n.next=13;break}return a=kue.of(e),n.abrupt("return",(M7(a.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(a.get(),i)));case 13:return n.abrupt("return",t.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()));case 14:case"end":return n.stop()}},n)}))()}},{key:"constructJump",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.jumpInConstruction.get(),i=t.getState(),!e.equals(r.getEndingCoord())){n.next=3;break}return n.abrupt("return",t.chooseMove(r,i));case 3:if(!(a=r.addJump(e)).isFailure()){n.next=6;break}return n.abrupt("return",t.cancelMove(a.getReason()));case 6:return o=t.rules.jumpLegality(a.get(),i),n.abrupt("return",o.isFailure()?t.cancelMove(o.getReason()):t.updateJump(a.get()));case 8:case"end":return n.stop()}},n)}))()}},{key:"updateJump",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.getState(),n.abrupt("return",t.rules.jumpHasPossibleNextTargets(e,r)?(t.jumpInConstruction=lV.of(e),t.updateViewInfo(),T7.SUCCESS):t.chooseMove(e,r));case 2:case"end":return n.stop()}},n)}))()}},{key:"selectNextCoord",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.selected.get(),!(i=_ue.of(r,e)).isSuccess()){n.next=3;break}return n.abrupt("return",t.chooseMove(i.get(),t.getState()));case 3:return a=Cue.of([r,e]),n.abrupt("return",a.isFailure()?t.cancelMove(a.getReason()):t.updateJump(a.get()));case 5:case"end":return n.stop()}},n)}))()}}]),n}(Vae);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-conspirateurs"]],features:[xE],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Rue,2,1,"g",1),YE(2,Mue,2,5,"g",1),YE(3,Nue,1,4,"circle",2),YE(4,Due,1,4,"circle",3),YE(5,Lue,1,4,"rect",4),nS(6,"polyline",5),tS()),2&e&&(pb(1),XE("ngForOf",t.viewInfo.boardInfo),pb(1),XE("ngForOf",t.ALL_SHELTERS),pb(1),XE("ngForOf",t.range(t.viewInfo.sidePieces[0])),pb(1),XE("ngForOf",t.range(t.viewInfo.sidePieces[1])),pb(1),XE("ngIf",t.viewInfo.dropPhase),pb(1),$E("points",t.viewInfo.lastMoveArrow))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Uue=function(){function e(t,n){Wg(this,e),this.owner=t,this.otherPieceType=n}return jg(e,[{key:"toString",value:function(){return"DiamPiece(".concat(this.owner,", ").concat(this.otherPieceType,")")}}],[{key:"of",value:function(t,n){return t===Nre.ZERO?n?e.ZERO_SECOND:e.ZERO_FIRST:t===Nre.ONE?n?e.ONE_SECOND:e.ONE_FIRST:e.EMPTY}}]),e}();Uue.encoder=xre.tuple([Nre.numberEncoder,xre.booleanEncoder],function(e){return[e.owner,e.otherPieceType]},function(e){return Uue.of(e[0],e[1])}),Uue.EMPTY=new Uue(Mre.NONE,!1),Uue.ZERO_FIRST=new Uue(Nre.ZERO,!1),Uue.ZERO_SECOND=new Uue(Nre.ZERO,!0),Uue.ONE_FIRST=new Uue(Nre.ONE,!1),Uue.ONE_SECOND=new Uue(Nre.ONE,!0),Uue.PLAYER_PIECES=[Uue.ZERO_FIRST,Uue.ZERO_SECOND,Uue.ONE_FIRST,Uue.ONE_SECOND];var Bue=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;if(Wg(this,n),(i=t.call(this)).target=e,i.piece=r,r===Uue.EMPTY)throw new Error("Cannot drop an empty piece");return Lg(i)}return jg(n,[{key:"isDrop",value:function(){return!0}},{key:"getTarget",value:function(){return this.target}},{key:"equals",value:function(e){return!(this.target!==e.target||this.piece!==e.piece)}},{key:"toString",value:function(){return"DiamMoveDrop(".concat(this.target,", ").concat(this.piece,")")}}]),n}(noe);Bue.encoder=xre.tuple([xre.numberEncoder(7),Uue.encoder],function(e){return[e.target,e.piece]},function(e){return new Bue(e[0],e[1])});var Vue=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this)).start=e,i.moveDirection=r,i}return jg(n,[{key:"isDrop",value:function(){return!1}},{key:"getTarget",value:function(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}},{key:"equals",value:function(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}},{key:"toString",value:function(){return"DiamMoveShift(".concat(this.start,", ").concat(this.moveDirection,")")}}],[{key:"fromRepresentation",value:function(e,t){return new n(new Bae(e.x,3-e.y),t)}}]),n}(noe);Vue.encoder=xre.tuple([Bae.numberEncoder(8,4),xre.booleanEncoder],function(e){return[e.start,"clockwise"===e.moveDirection]},function(e){return new Vue(e[0],e[1]?"clockwise":"counterclockwise")});var zue=xre.disjunction(Bue.encoder,Vue.encoder,function(e){return e.isDrop()}),Hue=function(){var e=jg(function e(){Wg(this,e)});return e.NO_MORE_PIECES_OF_THIS_TYPE=function(){return $localize(Pn||(Pn=wg(["You do not have any pieces of this type anymore."])))},e.SPACE_IS_FULL=function(){return $localize(On||(On=wg(["You cannot play here: this space is already full."])))},e.TARGET_STACK_TOO_HIGH=function(){return $localize(Tn||(Tn=wg(["You cannot add more pieces to the target stack, as it will contain more than 4 pieces."])))},e.MUST_SHIFT_TO_NEIGHBOR=function(){return $localize(In||(In=wg(["To perform a shift, you must move the pieces to a neighboring space."])))},e.MUST_SELECT_PIECE_FIRST=function(){return $localize(An||(An=wg(["You must first select either a piece from the side, or a stack of pieces to shift on the board."])))},e}(),Gue=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,i)).remainingPieces=r,a}return jg(n,[{key:"getRemainingPiecesOf",value:function(e){return this.remainingPieces[n.pieceIndex(e)]}},{key:"getStackHeight",value:function(e){for(var t=0,r=0;r<n.HEIGHT&&this.getPieceAtXY(e,r)!==Uue.EMPTY;r++)t++;return t}}],[{key:"getInitialState",value:function(){var e=Uue.EMPTY;return new n([[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e]],[4,4,4,4],0)}},{key:"fromRepresentation",value:function(e,t){for(var r=e.reverse(),i=[4,4,4,4],a=0;a<n.HEIGHT;a++)for(var o=0;o<n.WIDTH;o++){var s=r[a][o];r[a][o]!==Uue.EMPTY&&i[n.pieceIndex(s)]--}return M7(i.every(function(e){return e>=0}),"Invalid DiamState representation uses too many pieces"),new n(r,i,t)}},{key:"pieceIndex",value:function(e){switch(e){case Uue.ZERO_FIRST:return 0;case Uue.ZERO_SECOND:return 1;case Uue.ONE_FIRST:return 2;default:return aV.expectToBe(e,Uue.ONE_SECOND),3}}}]),n}(eoe);return e.WIDTH=8,e.HEIGHT=4,e}(),$ue=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,Gue)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}},{key:"applyLegalDrop",value:function(e,t){var n=Ure.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;var r=Ure.copyImmutableArray(t.remainingPieces);return r[Gue.pieceIndex(e.piece)]-=1,new Gue(n,r,t.turn+1)}},{key:"applyLegalShift",value:function(e,t){for(var n=Ure.copyBiArray(t.board),r=e.getTarget(),i=t.getStackHeight(r),a=e.start.y;a<Gue.HEIGHT&&t.getPieceAtXY(e.start.x,a)!==Uue.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,a),n[a][e.start.x]=Uue.EMPTY,i++,a++;return new Gue(n,t.remainingPieces,t.turn+1)}},{key:"isLegal",value:function(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}},{key:"isDropLegal",value:function(e,t){return e.piece.owner!==t.getCurrentPlayer()?S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?S7.failure(Hue.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}},{key:"dropHeightValidity",value:function(e,t){return t.getStackHeight(e.target)===Gue.HEIGHT?S7.failure(Hue.SPACE_IS_FULL()):S7.success(void 0)}},{key:"isShiftLegal",value:function(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}},{key:"shiftHeightValidity",value:function(e,t){var n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>Gue.HEIGHT?S7.failure(Hue.TARGET_STACK_TOO_HIGH()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){var t=this.findHighestAlignment(e.gameState);if(t.isPresent()){var n=e.gameState.getPieceAt(t.get());return M7(n.owner.isPlayer(),"highest alignment is owned by a player"),loe.getVictory(n.owner)}return loe.ONGOING}},{key:"findHighestAlignment",value:function(e){for(var t=0;t<Gue.WIDTH/2;t++)for(var n=Gue.HEIGHT-1;n>0;n--){var r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+Gue.WIDTH/2,n);if(r!==Uue.EMPTY&&r===i)return lV.of(new Bae(t,n))}return lV.empty()}},{key:"pieceCanMove",value:function(e,t){return!!this.isShiftLegal(new Vue(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new Vue(t,"counterclockwise"),e).isSuccess()}}],[{key:"get",value:function(){return n.singleton.isAbsent()&&(n.singleton=lV.of(new n)),n.singleton.get()}}]),n}(hoe);$ue.singleton=lV.empty();var Wue=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}},{key:"getListShifts",value:function(e){var t,n=[],r=Hg(this.getShiftSources(e));try{for(r.s();!(t=r.n()).done;)for(var i=t.value,a=0,o=[new Vue(i,"clockwise"),new Vue(i,"counterclockwise")];a<o.length;a++){var s=o[a];$ue.get().shiftHeightValidity(s,e).isSuccess()&&n.push(s)}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"getListDrops",value:function(e){for(var t=this.getRemainingPiecesForCurrentPlayer(e),n=[],r=0;r<Gue.WIDTH;r++){var i,a=Hg(t);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=new Bue(r,o);$ue.get().dropHeightValidity(s,e).isSuccess()&&n.push(s)}}catch(u){a.e(u)}finally{a.f()}}return n}},{key:"getRemainingPiecesForCurrentPlayer",value:function(e){var t,n=[],r=Hg(Uue.PLAYER_PIECES);try{for(r.s();!(t=r.n()).done;){var i=t.value;this.currentPlayerCanDropPiece(e,i)&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"currentPlayerCanDropPiece",value:function(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}},{key:"getShiftSources",value:function(e){for(var t=[],n=e.getCurrentPlayer(),r=0;r<Gue.HEIGHT;r++)for(var i=0;i<Gue.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new Bae(i,r));return t}},{key:"getBoardValue",value:function(e){var t=$ue.get().getGameStatus(e);return new Kae(t.isEndGame?t.toBoardValue():0)}}]),n}(Yae),que=Uue.EMPTY,jue=Uue.ZERO_FIRST,Zue=Uue.ZERO_SECOND,Yue=Uue.ONE_FIRST,Kue=Uue.ONE_SECOND,Que=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(xn||(xn=wg(["Initial board and player pieces"]))),$localize(Rn||(Rn=wg(["Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right."]))),Gue.getInitialState()),poe.fromMove($localize(Mn||(Mn=wg(["Goal of the game"]))),$localize(Nn||(Nn=wg(["At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!"]))),Gue.fromRepresentation([[que,que,que,que,que,que,que,que],[que,que,que,que,que,que,que,que],[que,que,que,que,Yue,que,que,que],[jue,que,que,que,jue,que,que,que]],3),[new Bue(0,Uue.ONE_FIRST)],$localize(Dn||(Dn=wg(["Congratulations, you won!"]))),$localize(Ln||(Ln=wg(["Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board."])))),poe.fromMove($localize(Fn||(Fn=wg(["Types of move"]))),$localize(Un||(Un=wg(["You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board."]))),Gue.fromRepresentation([[que,que,que,que,que,que,que,que],[que,que,que,que,Kue,que,que,que],[que,que,que,que,jue,que,que,que],[Yue,que,que,que,Zue,que,que,que]],4),[Vue.fromRepresentation(new Bae(4,3),"counterclockwise"),Vue.fromRepresentation(new Bae(4,3),"clockwise"),Vue.fromRepresentation(new Bae(4,2),"counterclockwise"),Vue.fromRepresentation(new Bae(4,2),"clockwise")],$localize(Bn||(Bn=wg(["Congratulations!"]))),$localize(Vn||(Vn=wg(["Failed, try to move one of your piece that is already on the board."])))),poe.fromMove($localize(zn||(zn=wg(["Special case"]))),$localize(Hn||(Hn=wg(["It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!"]))),Gue.fromRepresentation([[que,que,que,que,jue,que,que,que],[que,que,que,que,Kue,que,que,jue],[que,que,que,que,jue,que,que,Kue],[que,Yue,que,que,Zue,que,que,Yue]],8),[Vue.fromRepresentation(new Bae(4,2),"counterclockwise")],$localize(Gn||(Gn=wg(["Congratulations!"]))),$localize($n||($n=wg(["Failed, try to shift a stack of pieces to the left."]))))]});function Xue(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"path",6),uS("click",function(){var e=Nk(n).$implicit;return hS().onSpaceClick(e)}),tS(),eS(2,"path",7),uS("click",function(){var e=Nk(n).$implicit;return hS().onSpaceClick(e)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),dS("id","click_",r,""),XE("ngClass",i.viewInfo.boardInfo[r].spaceClasses),$E("d",i.BOARD_PATHS[r]),pb(1),XE("ngClass",i.viewInfo.boardInfo[r].spaceClasses),$E("d",i.DECORATION_PATHS[r])}}function Jue(e,t){if(1&e){var n=aS();c_(),eS(0,"g",9),uS("click",function(){var e=Nk(n).$implicit,t=hS().$implicit;return hS().onPieceInGameClick(t,e.y)}),nS(1,"use",10),nS(2,"use",11),tS()}if(2&e){var r=t.$implicit;vS("id","click_",hS().$implicit,"_",r.y,""),XE("ngClass",r.foregroundClasses),pb(1),XE("ngClass",r.backgroundClasses),$E("x",r.drawPosition.x)("y",r.drawPosition.y),pb(1),$E("x",r.drawPosition.x)("y",r.drawPosition.y)}}function ece(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Jue,3,8,"g",8),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",r.viewInfo.boardInfo[n].pieces)}}function tce(e,t){if(1&e){var n=aS();c_(),eS(0,"g",12),uS("click",function(){var e=Nk(n).$implicit;return hS().onRemainingPieceClick(e.actualPiece)}),nS(1,"use",10),nS(2,"use",11),tS()}if(2&e){var r=t.$implicit;vS("id","piece_",r.actualPiece.owner.value,"_",r.actualPiece.otherPieceType?1:0,""),XE("ngClass",r.foregroundClasses),pb(1),XE("ngClass",r.backgroundClasses),$E("x",r.drawPosition.x)("y",r.drawPosition.y),pb(1),$E("x",r.drawPosition.x)("y",r.drawPosition.y)}}var nce=function(){return[0,1,2,3,4,5,6,7]},rce=function(){return[2,1,3,0,4,7,5,6]},ice=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],r.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],r.selected=lV.empty(),r.viewInfo={boardInfo:[],remainingPieces:[]},r.rules=$ue.get(),r.availableMinimaxes=[new Wue(r.rules,"DiamDummyMinimax")],r.encoder=zue,r.tutorial=(new Que).tutorial,r}return jg(n,[{key:"ngOnInit",value:function(){this.updateBoard()}},{key:"onSpaceClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.canUserPlay("#click_"+e),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):t.onSpaceClickAfterCheck(e));case 2:case"end":return n.stop()}},n)}))()}},{key:"onSpaceClickAfterCheck",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.selected.isPresent()){n.next=14;break}if("pieceFromReserve"!==(r=t.selected.get()).type){n.next=6;break}i=new Bue(e,r.piece),n.next=13;break;case 6:if((r.position.x+1)%Gue.WIDTH!==e){n.next=10;break}i=new Vue(r.position,"clockwise"),n.next=13;break;case 10:if((r.position.x+(Gue.WIDTH-1))%Gue.WIDTH===e){n.next=12;break}return n.abrupt("return",t.cancelMove(Hue.MUST_SHIFT_TO_NEIGHBOR()));case 12:i=new Vue(r.position,"counterclockwise");case 13:return n.abrupt("return",t.chooseMove(i,t.getState()));case 14:return n.abrupt("return",t.cancelMove(Hue.MUST_SELECT_PIECE_FIRST()));case 15:case"end":return n.stop()}},n)}))()}},{key:"onPieceInGameClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.canUserPlay("#click_"+e+"_"+t),r.abrupt("return",i.isFailure()?n.cancelMove(i.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=lV.of({type:"pieceFromBoard",position:new Bae(e,t)}),n.updateViewInfo(),T7.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()));case 2:case"end":return r.stop()}},r)}))()}},{key:"onRemainingPieceClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.canUserPlay(t.getPieceId(e)),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=lV.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),T7.SUCCESS):t.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()));case 2:case"end":return n.stop()}},n)}))()}},{key:"getPieceId",value:function(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}},{key:"updateBoard",value:function(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}},{key:"getLastMovedFromDrop",value:function(e,t){var n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),a=this.getDrawPositionOnBoard(r,i),o=new Bae(r,i);return[{start:lV.empty(),end:o,startDrawPosition:n,endDrawPosition:a}]}},{key:"getLastMovedFromShift",value:function(e,t){for(var n=e.start.x,r=e.getTarget(),i=t.getStackHeight(r),a=[],o=e.start.y;o<Gue.HEIGHT&&t.getPieceAtXY(n,o)!==Uue.EMPTY;o++,i++)a.push({start:lV.of(new Bae(n,o)),end:new Bae(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return a}},{key:"updateViewInfo",value:function(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}},{key:"updateBoardInfo",value:function(){for(var e=0;e<Gue.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}},{key:"showLastMove",value:function(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}},{key:"showLastMoveOnSpaces",value:function(){var e=this.rules.node.move;M7(e.isPresent(),"showLastMoveOnSpaces called without a last move");for(var t=e.get(),n=0;n<Gue.WIDTH;n++){var r=[];t.isDrop()?t.getTarget()===n&&r.push("moved"):(t.getTarget()===n||t.start.x===n)&&r.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=r}}},{key:"showLastMoveOnPieces",value:function(){var e=this.rules.node.move;M7(e.isPresent(),"showLastMoveOnPieces called without a last move");var t,n=e.get(),r=this.getPreviousState(),i=Hg(n.isDrop()?this.getLastMovedFromDrop(n,r):this.getLastMovedFromShift(n,r));try{for(i.s();!(t=i.n()).done;){var a=t.value;this.viewInfo.boardInfo[a.end.x].pieces[a.end.y].foregroundClasses.push("last-move")}}catch(o){i.e(o)}finally{i.f()}}},{key:"updateRemainingPiecesInfo",value:function(){var e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];var t,n=this.isPlayerTurn(),r=Hg(Uue.PLAYER_PIECES);try{for(r.s();!(t=r.n()).done;)for(var i=t.value,a=this.getState().getRemainingPiecesOf(i),o=0;o<a;o++){var s=[];this.isTopPieceOfReserveAndSelected(o,a,i)&&s.push("selected"),n&&o===a-1&&i.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+i.owner.value+(i.otherPieceType?"-alternate":"")],foregroundClasses:s,y:o,drawPosition:this.getDrawPositionRemainingPiece(i,o),actualPiece:i})}}catch(u){r.e(u)}finally{r.f()}}},{key:"isTopPieceOfReserveAndSelected",value:function(e,t,n){if(this.selected.isPresent()){var r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}},{key:"getDrawPositionRemainingPiece",value:function(e,t){var r,i;return r=e.owner===Nre.ZERO?-100:600,i=e.otherPieceType?100:450,new Bae(r,i).getNext(new Mae(0,-t*n.PIECE_HEIGHT))}},{key:"getPieces",value:function(e){for(var t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[],i=0;i<Gue.HEIGHT;i++){var a=this.getState().getPieceAtXY(e,i),o=new Bae(e,i);if(a!==Uue.EMPTY){var s=[];this.pieceFromBoardIsSelected(e,i)&&s.push("selected"),this.isVictory(e,i,t)&&s.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&s.push("clickable-hover"),r.push({backgroundClasses:["player"+a.owner.value+(a.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:a})}}return r}},{key:"pieceFromBoardIsSelected",value:function(e,t){if(this.selected.isPresent()){var n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}},{key:"isVictory",value:function(e,t,n){if(n.isPresent()){var r=n.get();return r.x%4==e%4&&r.y===t}return!1}},{key:"getDrawPositionOnBoard",value:function(e,t){return n.CENTER[e].getNext(new Mae(0,-t*n.PIECE_HEIGHT))}},{key:"cancelMoveAttempt",value:function(){this.selected=lV.empty(),this.updateBoard()}}]),n}(Vae);ice.CENTER=[new Bae(40,160),new Bae(100,50),new Bae(255,2),new Bae(400,50),new Bae(460,160),new Bae(400,270),new Bae(255,320),new Bae(100,270)],ice.PIECE_HEIGHT=36,ice.\u0275fac=function(e){return new(e||ice)(QE(x7))},ice.\u0275cmp=Gm({type:ice,selectors:[["app-diam"]],features:[xE],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"defs"),eS(2,"g",1),nS(3,"path",2),nS(4,"ellipse",3),tS(),tS(),YE(5,Xue,3,5,"g",4),YE(6,ece,2,1,"g",4),YE(7,tce,3,8,"g",5),tS()),2&e&&(pb(5),XE("ngForOf",aT(3,nce)),pb(1),XE("ngForOf",aT(4,rce)),pb(1),XE("ngForOf",t.viewInfo.remainingPieces))},directives:[LA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var ace=function(){function e(t,n){Wg(this,e),this.offset=t,this.constant=n}return jg(e,[{key:"toString",value:function(){return"Line(".concat(this.constant,", ").concat(this.offset,")")}},{key:"equals",value:function(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}},{key:"contains",value:function(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}},{key:"getDirection",value:function(){switch(this.constant){case"q":return Gae.DOWN;case"r":return Gae.RIGHT;case"s":return Gae.DOWN_LEFT}}}],[{key:"fromTwoCoords",value:function(t,n){var r=t.x,i=n.x,a=t.y,o=n.y,s=r+a,u=i+o;return r===i&&a!==o&&s!==u?lV.of(e.constantQ(r)):r!==i&&a===o&&s!==u?lV.of(e.constantR(a)):r!==i&&a!==o&&s===u?lV.of(e.constantS(s)):lV.empty()}},{key:"constantQ",value:function(t){return new e(t,"q")}},{key:"constantR",value:function(t){return new e(t,"r")}},{key:"constantS",value:function(t){return new e(t,"s")}},{key:"areOnSameLine",value:function(t){if(t.length<2)return!0;var n=e.fromTwoCoords(t[0],t[1]);if(n.isAbsent())return!1;var r,i=n.get(),a=Hg(t.slice(2));try{for(a.s();!(r=a.n()).done;){var o=r.value;if(!1===i.contains(o))return!1}}catch(s){a.e(s)}finally{a.f()}return!0}}]),e}(),oce=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,r,e)).board=r,u.width=i,u.height=a,u.excludedCases=o,u.empty=s,M7(u.excludedCases.length<u.height/2+1,"Invalid excluded cases specification for HexagonalGameState."),u}return jg(n,[{key:"setAt",value:function(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}},{key:"equalsT",value:function(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(var n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;var r,i=Hg(this.allCoords());try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!1===t(this.getPieceAt(a),e.getPieceAt(a)))return!1}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"allCoords",value:function(){var e=[];return this.forEachCoord(function(t){e.push(t)}),e}},{key:"allLines",value:function(){for(var e=[],t=0;t<this.width;t++)e.push(ace.constantQ(t));for(var n=0;n<this.height;n++)e.push(ace.constantR(n));for(var r=this.excludedCases.length;r<this.height+this.excludedCases.length;r++)e.push(ace.constantS(r));return e}},{key:"getEntranceOnLine",value:function(e){var t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new Bae(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new Bae(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new Bae(e.offset,0):new Bae(this.width-1,e.offset-this.width+1))}}},{key:"findEntranceFrom",value:function(e,t){for(var n=e.getDirection(),r=t,i=0;i<Math.max(this.width,this.height);i++){if(this.isOnBoard(r))return r;r=r.getNext(n)}var a=R7.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(a.getReason())}}],[{key:"neighbors",value:function(e,t){return[new Bae(e.x+t,e.y-t),new Bae(e.x+t,e.y),new Bae(e.x-t,e.y+t),new Bae(e.x-t,e.y),new Bae(e.x,e.y+t),new Bae(e.x,e.y-t)]}}]),n}(eoe),sce=function(){function e(t,n,r){Wg(this,e),this.owner=t,this.size=n,this.source=r}return jg(e,[{key:"getValue",value:function(){return e.encoder.encodeNumber(this)}},{key:"getOwner",value:function(){return this.owner}},{key:"belongsTo",value:function(e){return this.owner===e}},{key:"containsSource",value:function(){return this.source}},{key:"isEmpty",value:function(){return 0===this.size}},{key:"getSize",value:function(){return this.size}},{key:"toString",value:function(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}],[{key:"append",value:function(t,n){return new e(t.owner,t.size+n.size,t.source||n.source)}}]),e}();sce.sizeEncoder=xre.numberEncoder(49),sce.encoder=xre.tuple([xre.booleanEncoder,Nre.numberEncoder,sce.sizeEncoder],function(e){return[e.source,e.owner,e.size]},function(e){return new sce(e[1],e[2],e[0])}),sce.MAX_SIZE=49,sce.EMPTY=new sce(Mre.NONE,0,!1),sce.UNREACHABLE=new sce(Mre.NONE,-1,!1),sce.PLAYER_ZERO=new sce(Nre.ZERO,1,!1),sce.PLAYER_ONE=new sce(Nre.ONE,1,!1),sce.SOURCE=new sce(Mre.NONE,1,!0);var uce=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,r,e,n.WIDTH,n.HEIGHT,n.EXCLUDED_CASES,sce.EMPTY)).alreadyPassed=i,a}return jg(n,[{key:"getAllPieces",value:function(){for(var e=[],t=0;t<n.HEIGHT;t++)for(var r=0;r<n.WIDTH;r++){var i=new Bae(r,t);this.isOnBoard(i)&&!1===this.getPieceAt(i).isEmpty()&&e.push(i)}return e}},{key:"numberOfNeighbors",value:function(e){var t=this;return oce.neighbors(e,1).filter(function(e){return t.isOnBoard(e)&&!1===t.getPieceAt(e).isEmpty()}).length}},{key:"setAtUnsafe",value:function(e,t){var r=Ure.copyBiArray(this.board);return r[e.y][e.x]=t,new n(r,this.turn,this.alreadyPassed)}},{key:"isOnBoard",value:function(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==sce.UNREACHABLE}}],[{key:"balancedBoard",value:function(){var e=sce.UNREACHABLE,t=sce.PLAYER_ZERO,n=sce.PLAYER_ONE,r=sce.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}},{key:"isOnBoard",value:function(e){return!e.isNotInRange(n.WIDTH,n.HEIGHT)&&n.balancedBoard()[e.y][e.x]!==sce.UNREACHABLE}},{key:"getInitialState",value:function(){return new n(n.balancedBoard(),0,!1)}}]),n}(oce);return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e}(),cce=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"toString",value:function(){return this===n.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}},{key:"length",value:function(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}},{key:"equals",value:function(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}],[{key:"of",value:function(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return n.PASS;if(!uce.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!uce.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new n(e,t);if(e.x===t.x)return new n(e,t);if(e.x+e.y===t.x+t.y)return new n(e,t);throw new Error("Invalid move")}}]),n}(ose);cce.PASS=new cce(new Bae(-1,-1),new Bae(-2,-2)),cce.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 42148}},{key:"encodeNumber",value:function(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}},{key:"decodeNumber",value:function(e){if(e<0)return cce.PASS;var t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new cce(new Bae((e=e/16|0)%16,r),new Bae(n,t))}}]),n}(xre));var lce=function(){var e=jg(function e(){Wg(this,e)});return e.NOT_PLAYER_PIECE=function(){return $localize(Wn||(Wn=wg(["You must select a piece or a stack of your color."])))},e.EMPTY_STACK=function(){return $localize(qn||(qn=wg(["You must select a stack."])))},e.TOO_MANY_NEIGHBORS=function(){return $localize(jn||(jn=wg(["This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors."])))},e.CANT_REACH_TARGET=function(){return $localize(Zn||(Zn=wg(["This stack cannot move because it could never land on another piece."])))},e.INVALID_MOVE_LENGTH=function(){return $localize(Yn||(Yn=wg(["A stack must always be moved by as many spaces as there are pieces in the stack."])))},e.EMPTY_TARGET_STACK=function(){return $localize(Kn||(Kn=wg(["The stack must land on an occupied space."])))},e}(),hce=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isMovablePiece",value:function(e,t){M7(e.isOnBoard(t),"piece is not on the board");var r=e.getPieceAt(t);return r.getSize()<1?T7.failure(lce.EMPTY_STACK()):r.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?T7.failure(lce.TOO_MANY_NEIGHBORS()):n.pieceHasTarget(e,t)?T7.SUCCESS:T7.failure(lce.CANT_REACH_TARGET()):T7.failure(lce.NOT_PLAYER_PIECE())}},{key:"canOnlyPass",value:function(e){return 0===n.getMovablePieces(e).length}},{key:"sourceCoords",value:function(e){return e.getAllPieces().filter(function(t){return e.getPieceAt(t).containsSource()})}},{key:"markPiecesConnectedTo",value:function(e,t,n){var r=this;oce.neighbors(t,1).forEach(function(t){e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,r.markPiecesConnectedTo(e,t,n))})}},{key:"removeDisconnectedPieces",value:function(e){var t=this,n=Ure.createTable(uce.WIDTH,uce.HEIGHT,!1);this.sourceCoords(e).forEach(function(r){n[r.y][r.x]=!0,t.markPiecesConnectedTo(e,r,n)});var r=e;return r.getAllPieces().forEach(function(e){n[e.y][e.x]||(r=r.setAt(e,sce.EMPTY))}),r}},{key:"applyLegalMove",value:function(e,t,n){if(e===cce.PASS)return new uce(t.board,t.turn+1,!0);var r=t.getPieceAt(e.coord),i=t.getPieceAt(e.end),a=t.setAt(e.coord,sce.EMPTY).setAt(e.end,sce.append(r,i));return this.removeDisconnectedPieces(new uce(a.board,t.turn+1,!1))}},{key:"isLegal",value:function(e,t){if(0===n.getMovablePieces(t).length)return e!==cce.PASS||t.alreadyPassed?S7.failure(Zae.MUST_PASS()):S7.success(void 0);if(e===cce.PASS)return S7.failure(Zae.CANNOT_PASS());var r=this.isMovablePiece(t,e.coord);if(r.isFailure())return r.toFailedFallible();var i=t.getPieceAt(e.coord);return e.length()!==i.getSize()?S7.failure(lce.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?S7.failure(lce.EMPTY_TARGET_STACK()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"getGameStatus",value:function(e){var t=e.gameState,r=n.getScores(t);return 0===n.getMovablePieces(t).length?r[0]>r[1]?loe.ZERO_WON:r[0]<r[1]?loe.ONE_WON:loe.DRAW:loe.ONGOING}},{key:"getMovablePieces",value:function(e){return n.getFreePieces(e).filter(function(t){return n.pieceHasTarget(e,t)})}},{key:"getFreePieces",value:function(e){return e.getAllPieces().filter(function(t){return e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6})}},{key:"pieceHasTarget",value:function(e,t){var n=e.getPieceAt(t).getSize();return void 0!==oce.neighbors(t,n).find(function(t){return e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty()})}},{key:"pieceTargets",value:function(e,t){var n=e.getPieceAt(t).getSize();return oce.neighbors(t,n).filter(function(t){return e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty()})}},{key:"getScores",value:function(e){var t=0,n=0;return e.getAllPieces().map(function(r){var i=e.getPieceAt(r);i.belongsTo(Nre.ZERO)?t+=i.getSize():i.belongsTo(Nre.ONE)&&(n+=i.getSize())}),[t,n]}}]),n}(hoe),fce=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=e.move,n=e.gameState,r=[];return hce.getMovablePieces(n).forEach(function(e){return hce.pieceTargets(n,e).forEach(function(t){var n=cce.of(e,t);r.push(n)})}),0===r.length&&!1===t.equalsValue(cce.PASS)&&r.push(cce.PASS),r}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=hce.getScores(t);return 0===hce.getMovablePieces(t).length?new Kae(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new Kae(n[0]-n[1])}}]),n}(Yae),dce=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=e.gameState,r=xg(Bg(n.prototype),"getListMoves",this).call(this,e),i=t.getCurrentPlayer().getOpponent();return Ure.sortByDescending(r,function(e){M7(e!==cce.PASS,"Cannot sort with DvonnMove.PASS");var n=t.getPieceAt(e.end);return n.belongsTo(i)?n.getSize():0}),r}},{key:"getBoardValue",value:function(e){var t=hce.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n=e.gameState,r=hce.getScores(n),i=n.getAllPieces(),a=i.length,o=i.filter(function(e){return n.getPieceAt(e).belongsTo(Nre.ZERO)}).length,s=i.filter(function(e){return n.getPieceAt(e).belongsTo(Nre.ONE)}).length;return new Kae((s*r[1]-o*r[0])/a)}}]),n}(fce),vce=sce.EMPTY,pce=sce.UNREACHABLE,gce=sce.SOURCE,yce=sce.PLAYER_ZERO,mce=sce.PLAYER_ONE,kce=new sce(Nre.ZERO,2,!1),_ce=new sce(Nre.ONE,2,!1),Cce=new sce(Nre.ZERO,4,!1),wce=new sce(Nre.ONE,4,!1),bce=jg(function e(){Wg(this,e),this.tutorial=[poe.anyMove($localize(Qn||(Qn=wg(["Moving"]))),$localize(Xn||(Xn=wg(["At Dvonn, each hexagonal space contains a stack of pieces.\n        If no number is indicated on a stack, it means that it only contains one piece.\n        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.\n        The owner of a stack is the one that has a piece at the top of the stack.\n        Only the owner of a stack can move it.\n        A stack cannot be moved if it is surrounded by 6 other stacks.\n        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.\n        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.\n        Therefore, there are six possible directions.\n        The player with dark pieces starts.<br/><br/>\n        You're playing Dark, click on a stack and move it by one space."]))),uce.getInitialState(),cce.of(new Bae(2,0),new Bae(3,0)),$localize(Jn||(Jn=wg(["Congratulations!"])))),poe.fromPredicate($localize(er||(er=wg(["Disconnection"]))),$localize(tr||(tr=wg(['Pieces with a lightning strike are called "sources".\n        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>\n        You\'re playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!']))),new uce([[pce,pce,mce,gce,vce,vce,vce,vce,vce,vce,vce],[pce,vce,yce,vce,vce,vce,vce,vce,vce,vce,vce],[vce,vce,wce,vce,vce,vce,vce,mce,gce,vce,vce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,vce,pce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,pce,pce]],0,!1),cce.of(new Bae(2,1),new Bae(2,0)),function(e,t){return e.end.equals(new Bae(3,0))?T7.failure($localize(nr||(nr=wg(["You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it."])))):(M7(e.end.equals(new Bae(2,0)),"player made an impossible move"),T7.SUCCESS)},$localize(rr||(rr=wg(["Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!\n        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.\n        Disconnected stacks will not be visible at the next turn."])))),poe.fromPredicate($localize(ir||(ir=wg(["Moving on a source"]))),$localize(ar||(ar=wg(["You are allowed to move your stacks on any other stack.\n        This means that you can take control of a source by moving one of your stack on top of it.\n        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>\n        You're playing Dark and you can take control of a source, do it!"]))),new uce([[pce,pce,gce,mce,vce,vce,vce,vce,vce,vce,vce],[pce,yce,yce,vce,vce,vce,vce,vce,vce,vce,vce],[vce,mce,yce,mce,vce,vce,yce,_ce,gce,vce,vce],[vce,vce,mce,vce,vce,vce,vce,vce,vce,vce,pce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,pce,pce]],0,!1),cce.of(new Bae(2,1),new Bae(2,0)),function(e,t){return e.end.equals(new Bae(2,0))?T7.SUCCESS:T7.failure($localize(or||(or=wg(["You have not taken possession of a source, try again."]))))},$localize(sr||(sr=wg(["Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!"])))),poe.informational($localize(ur||(ur=wg(["Passing"]))),$localize(cr||(cr=wg(["It can happen that you have no possible move to make.\n        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>\n        This is a situation that occurs here for Dark."]))),new uce([[pce,pce,gce,vce,vce,vce,vce,vce,vce,vce,vce],[pce,vce,kce,vce,vce,vce,vce,vce,vce,vce,vce],[vce,vce,_ce,vce,vce,vce,vce,_ce,gce,Cce,vce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,vce,pce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,pce,pce]],0,!1)),poe.fromMove($localize(lr||(lr=wg(["End of the game"]))),$localize(hr||(hr=wg(["When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>\n        Make your last move."]))),new uce([[pce,pce,gce,vce,vce,vce,vce,vce,vce,vce,vce],[pce,vce,yce,vce,vce,vce,vce,vce,vce,vce,vce],[vce,vce,vce,vce,vce,vce,vce,vce,gce,Cce,vce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,vce,pce],[vce,vce,vce,vce,vce,vce,vce,vce,vce,pce,pce]],0,!1),[cce.of(new Bae(2,1),new Bae(2,0))],$localize(fr||(fr=wg(["Congratulations, you won 6 - 0!"]))),$localize(dr||(dr=wg(["Bad idea, by moving on the source you would have won a point."]))))]});function Ece(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS().$implicit,r=hS().$implicit,i=hS();XE("ngClass",i.getPieceClasses(n)),$E("cx",i.getCenterAt(r).x)("cy",i.getCenterAt(r).y)("r",i.SPACE_SIZE)}}function Sce(e,t){if(1&e&&(c_(),nS(0,"polygon",11)),2&e){var n=hS().$implicit,r=hS().$implicit,i=hS();$E("transform",1===n.getSize()?"translate("+(i.getCenterAt(r).x-18)+" "+(i.getCenterAt(r).y-16)+") scale(0.10)":"translate("+(i.getCenterAt(r).x-3)+" "+(i.getCenterAt(r).y-12)+") scale(0.07)")}}function Pce(e,t){if(1&e){var n=aS();c_(),eS(0,"text",12),uS("click",function(){Nk(n);var e=hS(2).$implicit;return hS().onClick(e.x,e.y)}),FS(1),tS()}if(2&e){var r=hS().$implicit,i=hS().$implicit,a=hS();$E("x",r.containsSource()?a.getCenterAt(i).x-7:a.getCenterAt(i).x)("y",a.getCenterAt(i).y),pb(1),US(r.getSize())}}function Oce(e,t){if(1&e){var n=aS();c_(),eS(0,"g",5),uS("click",function(){Nk(n);var e=hS().$implicit;return hS().onClick(e.x,e.y)}),nS(1,"polyline",6),YE(2,Ece,1,4,"circle",7),YE(3,Sce,1,1,"polygon",8),YE(4,Pce,2,3,"text",9),tS()}if(2&e){var r=t.$implicit,i=hS().$implicit,a=hS();vS("id","click_",i.x,"_",i.y,""),pb(1),$E("points",a.getHexaCoordsAt(i)),pb(1),XE("ngIf",r.getSize()>0),pb(1),XE("ngIf",r.containsSource()),pb(1),XE("ngIf",r.getSize()>1)}}var Tce=function(e){return[e]};function Ice(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Oce,5,6,"g",4),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",oT(1,Tce,r.state.getPieceAt(n)))}}function Ace(e,t){if(1&e&&(c_(),eS(0,"text",16),FS(1),tS()),2&e){var n=hS().$implicit,r=hS();$E("x",r.getCenterAt(n.coord).x)("y",r.getCenterAt(n.coord).y),pb(1),US(n.caseContent.getSize())}}function xce(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"polyline",13),nS(2,"circle",14),YE(3,Ace,2,3,"text",15),tS()),2&e){var n=t.$implicit,r=hS();pb(1),$E("points",r.getHexaCoordsAt(n.coord)),pb(1),vS("id","captured_",n.coord.x,"_",n.coord.y,""),XE("ngClass",r.getPieceClasses(n.caseContent)),$E("cx",r.getCenterAt(n.coord).x)("cy",r.getCenterAt(n.coord).y)("r",r.SPACE_SIZE),pb(1),XE("ngIf",n.caseContent.getSize()>1)}}function Rce(e,t){if(1&e&&(c_(),rS(0),nS(1,"polyline",17),nS(2,"polyline",17),iS()),2&e){var n=hS();pb(1),$E("points",n.getHexaCoordsAt(n.lastMove.get().coord)),pb(1),$E("points",n.getHexaCoordsAt(n.lastMove.get().end))}}function Mce(e,t){if(1&e&&(c_(),nS(0,"polyline",18)),2&e){var n=hS();$E("points",n.getHexaCoordsAt(n.chosen.get()))}}var Nce=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).lastMove=lV.empty(),r.chosen=lV.empty(),r.disconnecteds=[],r.rules=new hce(uce),r.availableMinimaxes=[new fce(r.rules,"DvonnMinimax"),new dce(r.rules,"DvonnMinimaxMaximizeStacks")],r.encoder=cce.encoder,r.tutorial=(new bce).tutorial,r.SPACE_SIZE=30,r.canPass=!1,r.scores=lV.of(hce.getScores(r.rules.node.gameState)),r.hexaLayout=new $ae(1.5*r.SPACE_SIZE,new Bae(-r.SPACE_SIZE,2*r.SPACE_SIZE),qae.INSTANCE),r.state=r.rules.node.gameState,r.hexaBoard=r.rules.node.gameState.board,r}return jg(n,[{key:"hideLastMove",value:function(){this.lastMove=lV.empty()}},{key:"updateBoard",value:function(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=lV.of(hce.getScores(this.state))}},{key:"calculateDisconnecteds",value:function(){for(var e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState,n=0;n<t.board.length;n++)for(var r=0;r<t.board[n].length;r++){var i=new Bae(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){var a=t.getPieceAt(i),o=e.getPieceAt(i);if(a.isEmpty()&&!o.isEmpty()){var s={coord:new Bae(r,n),caseContent:o};this.disconnecteds.push(s)}}}}},{key:"cancelMoveAttempt",value:function(){this.chosen=lV.empty()}},{key:"pass",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),t.next=3,e.chooseMove(cce.PASS,e.rules.node.gameState);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}))()}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=5;break}r.t0=n.cancelMove(i.getReason()),r.next=18;break;case 5:if(!n.chosen.isAbsent()){r.next=9;break}r.t1=n.choosePiece(e,t),r.next=17;break;case 9:if(!n.chosen.equalsValue(new Bae(e,t))){r.next=13;break}r.t2=(n.cancelMoveAttempt(),T7.SUCCESS),r.next=16;break;case 13:return r.next=15,n.chooseDestination(e,t);case 15:r.t2=r.sent;case 16:r.t1=r.t2;case 17:r.t0=r.t1;case 18:return r.abrupt("return",r.t0);case 19:case"end":return r.stop()}},r)}))()}},{key:"choosePiece",value:function(e,t){var n=new Bae(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=lV.of(n),T7.SUCCESS):this.cancelMove(r.getReason())}},{key:"chooseDestination",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.chosen.get(),a=new Bae(e,t),o=cce.of(i,a),r.abrupt("return",n.chooseMove(o,n.rules.node.gameState));case 2:case"end":return r.stop()}},r)}))()}},{key:"getPieceClasses",value:function(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];var t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}]),n}(zae);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-dvonn"]],features:[xE],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","semi-transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Ice,2,3,"g",1),YE(2,xce,4,8,"g",1),YE(3,Rce,3,2,"ng-container",2),YE(4,Mce,1,1,"polyline",3),tS()),2&e&&(pb(1),XE("ngForOf",t.state.allCoords()),pb(1),XE("ngForOf",t.disconnecteds),pb(1),XE("ngIf",t.lastMove.isPresent()),pb(1),XE("ngIf",t.chosen.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Dce=(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(Dce||(Dce={})),Dce),Lce=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"getPlayer",value:function(){switch(this){case e.SMALL_BLACK:case e.MEDIUM_BLACK:case e.BIG_BLACK:return Nre.ZERO;case e.SMALL_WHITE:case e.MEDIUM_WHITE:case e.BIG_WHITE:return Nre.ONE;default:return Mre.NONE}}},{key:"getSize",value:function(){switch(this){case e.BIG_BLACK:case e.BIG_WHITE:return Dce.BIG;case e.MEDIUM_BLACK:case e.MEDIUM_WHITE:return Dce.MEDIUM;case e.SMALL_BLACK:case e.SMALL_WHITE:return Dce.SMALL;default:return aV.expectToBe(this,e.EMPTY),Dce.NONE}}},{key:"belongsTo",value:function(e){return this.getPlayer()===e}},{key:"equals",value:function(e){return this===e}},{key:"toString",value:function(){switch(this){case e.BIG_BLACK:return"BIG_BLACK";case e.BIG_WHITE:return"BIG_WHITE";case e.MEDIUM_BLACK:return"MEDIUM_BLACK";case e.MEDIUM_WHITE:return"MEDIUM_WHITE";case e.SMALL_BLACK:return"SMALL_BLACK";case e.SMALL_WHITE:return"SMALL_WHITE";default:return aV.expectToBe(this,e.EMPTY),"EMPTY"}}}],[{key:"of",value:function(t){switch(t){case 0:return e.SMALL_BLACK;case 1:return e.SMALL_WHITE;case 2:return e.MEDIUM_BLACK;case 3:return e.MEDIUM_WHITE;case 4:return e.BIG_BLACK;case 5:return e.BIG_WHITE;case 6:return e.EMPTY;default:throw new Error("Invalid value "+t+" for EncapsulePiece")}}},{key:"ofSizeAndPlayer",value:function(t,n){return n===Nre.ZERO&&t===Dce.BIG?e.BIG_BLACK:n===Nre.ZERO&&t===Dce.MEDIUM?e.MEDIUM_BLACK:n===Nre.ZERO&&t===Dce.SMALL?e.SMALL_BLACK:n===Nre.ONE&&t===Dce.BIG?e.BIG_WHITE:n===Nre.ONE&&t===Dce.MEDIUM?e.MEDIUM_WHITE:n===Nre.ONE&&t===Dce.SMALL?e.SMALL_WHITE:e.EMPTY}}]),e}();Lce.SMALL_BLACK=new Lce(0),Lce.SMALL_WHITE=new Lce(1),Lce.MEDIUM_BLACK=new Lce(2),Lce.MEDIUM_WHITE=new Lce(3),Lce.BIG_BLACK=new Lce(4),Lce.BIG_WHITE=new Lce(5),Lce.EMPTY=new Lce(6);var Fce=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).remainingPieces=i,a}return jg(n,[{key:"getRemainingPieces",value:function(){return Ure.copyImmutableArray(this.remainingPieces)}},{key:"getRemainingPiecesOfPlayer",value:function(e){return this.getRemainingPieces().filter(function(t){return t.getPlayer()===e})}},{key:"pieceBelongsToCurrentPlayer",value:function(e){return e.belongsTo(this.getCurrentPlayer())}},{key:"isDroppable",value:function(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}},{key:"isInRemainingPieces",value:function(e){return this.remainingPieces.some(function(t){return t===e})}},{key:"getPlayerRemainingPieces",value:function(){var e=this;return this.remainingPieces.filter(function(t){return e.pieceBelongsToCurrentPlayer(t)})}}],[{key:"getInitialState",value:function(){var e=new Uce(Mre.NONE,Mre.NONE,Mre.NONE).encode(),t=Ure.createTable(3,3,e);return new n(Ure.mapBiArray(t,function(e){return Uce.decode(e)}),0,[Lce.BIG_BLACK,Lce.BIG_BLACK,Lce.BIG_WHITE,Lce.BIG_WHITE,Lce.MEDIUM_BLACK,Lce.MEDIUM_BLACK,Lce.MEDIUM_WHITE,Lce.MEDIUM_WHITE,Lce.SMALL_BLACK,Lce.SMALL_BLACK,Lce.SMALL_WHITE,Lce.SMALL_WHITE])}}]),n}(eoe),Uce=function(){function e(t,n,r){Wg(this,e),this.small=t,this.medium=n,this.big=r}return jg(e,[{key:"isEmpty",value:function(){return this.small===Mre.NONE&&this.medium===Mre.NONE&&this.big===Mre.NONE}},{key:"toList",value:function(){var e=[];return this.small.isPlayer()&&e.push(Lce.ofSizeAndPlayer(Dce.SMALL,this.small)),this.medium.isPlayer()&&e.push(Lce.ofSizeAndPlayer(Dce.MEDIUM,this.medium)),this.big.isPlayer()&&e.push(Lce.ofSizeAndPlayer(Dce.BIG,this.big)),e}},{key:"toOrderedPieceNames",value:function(){var e=Lce.ofSizeAndPlayer(Dce.SMALL,this.small),t=Lce.ofSizeAndPlayer(Dce.MEDIUM,this.medium),n=Lce.ofSizeAndPlayer(Dce.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}},{key:"getBiggest",value:function(){return this.big===Nre.ZERO?Lce.BIG_BLACK:this.big===Nre.ONE?Lce.BIG_WHITE:this.medium===Nre.ZERO?Lce.MEDIUM_BLACK:this.medium===Nre.ONE?Lce.MEDIUM_WHITE:this.small===Nre.ZERO?Lce.SMALL_BLACK:this.small===Nre.ONE?Lce.SMALL_WHITE:Lce.EMPTY}},{key:"tryToSuperposePiece",value:function(e){var t=this.getBiggest().getSize();if(e===Lce.EMPTY)throw new Error("Cannot move EMPTY on a space");return e.getSize()>t?lV.of(this.put(e)):lV.empty()}},{key:"removeBiggest",value:function(){var t,n=this.getBiggest();if(n===Lce.EMPTY)throw new Error("Cannot removed piece from empty space");var r=n.getSize();switch(r){case Dce.BIG:t=new e(this.small,this.medium,Mre.NONE);break;case Dce.MEDIUM:t=new e(this.small,Mre.NONE,Mre.NONE);break;default:aV.expectToBe(r,Dce.SMALL),t=new e(Mre.NONE,Mre.NONE,Mre.NONE)}return{removedCase:t,removedPiece:n}}},{key:"put",value:function(t){if(t===Lce.EMPTY)throw new Error("Cannot put EMPTY on space");var n=t.getPlayer(),r=t.getSize();switch(r){case Dce.BIG:return new e(this.small,this.medium,n);case Dce.MEDIUM:return M7(this.big===Mre.NONE,"Cannot put a piece on top of a bigger one"),new e(this.small,n,this.big);default:return aV.expectToBe(r,Dce.SMALL),M7(this.big===Mre.NONE,"Cannot put a piece on top of a bigger one"),M7(this.medium===Mre.NONE,"Cannot put a piece on top of a bigger one"),new e(n,this.medium,this.big)}}},{key:"encode",value:function(){return this.small.value+3*this.medium.value+9*this.big.value}},{key:"belongsTo",value:function(e){return this.getBiggest().getPlayer()===e}},{key:"toString",value:function(){var e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}],[{key:"decode",value:function(t){M7(t%1==0,"EncapsuleCase must be encoded as integer: "+t),M7(t>=0,"To small representation for EncapsuleCase: "+t),M7(t<=26,"To big representation for EncapsuleCase: "+t);var n=Nre.numberEncoder.decodeNumber(t%3);t-=n.value;var r=Nre.numberEncoder.decodeNumber((t/=3)%3);return t-=r.value,new e(n,r,Nre.numberEncoder.decodeNumber(t/=3))}}]),e}();Uce.EMPTY=new Uce(Mre.NONE,Mre.NONE,Mre.NONE);var Bce=function(){var e=jg(function e(){Wg(this,e)});return e.PIECE_OUT_OF_STOCK=function(){return $localize(vr||(vr=wg(["You do not have pieces of this type anymore."])))},e.INVALID_PLACEMENT=function(){return $localize(pr||(pr=wg(["You must put your piece on an empty square or on a smaller piece."])))},e.NOT_DROPPABLE=function(){return $localize(gr||(gr=wg(["You must pick your piece among the remaining ones."])))},e.INVALID_PIECE_SELECTED=function(){return $localize(yr||(yr=wg(["You must pick one of your remaining pieces or one piece on the board that is the biggest of its square."])))},e.SAME_DEST_AS_ORIGIN=function(){return $localize(mr||(mr=wg(["You must select a different landing square than the square where the move originates from."])))},e.END_YOUR_MOVE=function(){return $localize(kr||(kr=wg(["You are performing a move, you must select a landing square."])))},e}(),Vce=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"applyLegalMove",value:function(e,t,n){var r,i=t.getCopiedBoard(),a=t.getRemainingPieces(),o=t.turn+1;if(i[e.landingCoord.y][e.landingCoord.x]=Uce.decode(n.encode()),e.isDropping()){r=e.piece.get();var s=a.indexOf(r);a=a.slice(0,s).concat(a.slice(s+1))}else{var u=e.startingCoord.get(),c=i[u.y][u.x].encode(),l=Uce.decode(c).removeBiggest();i[u.y][u.x]=Uce.decode(l.removedCase.encode()),r=l.removedPiece}return new Fce(i,o,a)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"isVictory",value:function(e){var t,r=e.getCopiedBoard(),i=Hg(n.LINES);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=n.isVictoriousLine([r[a[0].y][a[0].x],r[a[1].y][a[1].x],r[a[2].y][a[2].x]]);if(o.isPresent())return o}}catch(s){i.e(s)}finally{i.f()}return lV.empty()}},{key:"isVictoriousLine",value:function(e){var t=e.map(function(e){return e.getBiggest()}).map(function(e){return e.getPlayer()});return t[0]===Mre.NONE?lV.empty():t[0]===t[1]&&t[1]===t[2]?lV.of(t[0]):lV.empty()}},{key:"isLegal",value:function(e,t){var n;if(oV(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return S7.failure(Bce.PIECE_OUT_OF_STOCK())}else{var r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE())}var i=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return i.isPresent()?S7.success(i.get()):S7.failure(Bce.INVALID_PLACEMENT())}},{key:"getGameStatus",value:function(e){var t=n.isVictory(e.gameState);return t.isPresent()?loe.getVictory(t.get()):loe.ONGOING}}]),n}(hoe);Vce.LINES=[[new Bae(0,0),new Bae(0,1),new Bae(0,2)],[new Bae(1,0),new Bae(1,1),new Bae(1,2)],[new Bae(2,0),new Bae(2,1),new Bae(2,2)],[new Bae(0,0),new Bae(1,0),new Bae(2,0)],[new Bae(0,1),new Bae(1,1),new Bae(2,1)],[new Bae(0,2),new Bae(1,2),new Bae(2,2)],[new Bae(0,0),new Bae(1,1),new Bae(2,2)],[new Bae(0,2),new Bae(1,1),new Bae(2,0)]];var zce=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).startingCoord=e,a.landingCoord=r,a.piece=i,a}return jg(n,[{key:"isDropping",value:function(){return this.startingCoord.isAbsent()}},{key:"equals",value:function(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}},{key:"toString",value:function(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}],[{key:"fromMove",value:function(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new n(lV.of(e),t,lV.empty())}},{key:"fromDrop",value:function(e,t){return new n(lV.empty(),t,lV.of(e))}}]),n}(noe);zce.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 161}},{key:"encodeNumber",value:function(e){var t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){return 18*e.piece.get().value+6*t+2*n+0}var r=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*r+6*t+2*n+1}},{key:"decodeNumber",value:function(e){var t=e%2;e-=t;var n=(e/=2)%3;e-=n;var r=(e/=3)%3;e-=r,e/=3;var i=new Bae(r,n);if(0===t){var a=Lce.of(e);return zce.fromDrop(a,i)}var o=e%3;e-=o;var s=new Bae((e/=3)%3,o);return zce.fromMove(s,i)}}]),n}(xre));var Hce=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=Vce.getGameStatus(e);return new Kae(t.toBoardValue())}},{key:"getListMoves",value:function(e){for(var t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),a=Qae.toComparableObjectSet(n.getPlayerRemainingPieces()),o=0;o<3;o++)for(var s=0;s<3;s++){var u,c=new Bae(s,o),l=Hg(a);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=zce.fromDrop(h,c);Vce.isLegal(f,n).isSuccess()&&t.push(f)}}catch(y){l.e(y)}finally{l.f()}if(r[o][s].belongsTo(i))for(var d=0;d<3;d++)for(var v=0;v<3;v++){var p=new Bae(v,d);if(!p.equals(c)){var g=zce.fromMove(c,p);Vce.isLegal(g,n).isSuccess()&&t.push(g)}}}return t}}]),n}(Yae),Gce=new Uce(Mre.NONE,Mre.NONE,Mre.NONE),$ce=new Uce(Nre.ZERO,Mre.NONE,Mre.NONE),Wce=new Uce(Mre.NONE,Nre.ZERO,Mre.NONE),qce=new Uce(Mre.NONE,Mre.NONE,Nre.ZERO),jce=new Uce(Nre.ONE,Mre.NONE,Mre.NONE),Zce=new Uce(Mre.NONE,Mre.NONE,Nre.ONE),Yce=new Uce(Nre.ONE,Nre.ZERO,Mre.NONE),Kce=new Uce(Nre.ZERO,Nre.ZERO,Mre.NONE),Qce=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(_r||(_r=wg(["Goal of the game"]))),$localize(Cr||(Cr=wg(["The goal of Encapsule is to align three of your pieces.\n        Here, we have a victory of the dark player."]))),new Fce([[$ce,jce,Zce],[Gce,Wce,Gce],[Gce,Gce,qce]],0,[Lce.SMALL_BLACK,Lce.MEDIUM_BLACK,Lce.BIG_BLACK,Lce.SMALL_WHITE,Lce.MEDIUM_WHITE,Lce.MEDIUM_WHITE,Lce.BIG_WHITE])),poe.anyMove($localize(wr||(wr=wg(["Putting a piece"]))),$localize(br||(br=wg(["This is the initial board. You're playing Dark.<br/><br/>\n        Pick one of your piece on the side of the board and put it on the board."]))),Fce.getInitialState(),zce.fromDrop(Lce.SMALL_BLACK,new Bae(1,1)),$localize(Er||(Er=wg(["Congratulations!"])))),poe.fromMove($localize(Sr||(Sr=wg(["Moving"]))),$localize(Pr||(Pr=wg(["Another possible action is to move one of your pieces that is already on the board.<br/><br/>\n        Click on your dark piece and then on any empty square of the board."]))),new Fce([[$ce,Zce,Gce],[Gce,Gce,Gce],[Gce,Gce,Gce]],0,[]),[zce.fromMove(new Bae(0,0),new Bae(2,0)),zce.fromMove(new Bae(0,0),new Bae(0,1)),zce.fromMove(new Bae(0,0),new Bae(1,1)),zce.fromMove(new Bae(0,0),new Bae(2,1)),zce.fromMove(new Bae(0,0),new Bae(0,2)),zce.fromMove(new Bae(0,0),new Bae(1,2)),zce.fromMove(new Bae(0,0),new Bae(2,2))],$localize(Or||(Or=wg(["Congratulations!"]))),$localize(Tr||(Tr=wg(["Failed. Try again."])))),poe.fromPredicate($localize(Ir||(Ir=wg(["Particularity"]))),$localize(Ar||(Ar=wg(['At Encapsule, pieces encapsulate each other.\n        It is therefore possible to have up to three pieces per square!\n        However, only the biggest piece of each square counts:\n        you cannot win with a piece that is "hidden" by a bigger piece.\n        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.\n        Finally, you cannot encapsulate a piece with a smaller piece.\n        You\'re playing Dark and you can win now in various ways.<br/><br/>\n        Try to win by making a move, and not by putting a new piece on the board.']))),new Fce([[Yce,Gce,jce],[Kce,Zce,Zce],[Gce,Gce,Gce]],0,[Lce.MEDIUM_BLACK,Lce.BIG_BLACK,Lce.MEDIUM_WHITE,Lce.MEDIUM_WHITE]),zce.fromMove(new Bae(0,1),new Bae(0,2)),function(e,t){if(e.landingCoord.equals(new Bae(0,2))){if(e.isDropping())return T7.failure($localize(xr||(xr=wg(["You won, but the exercise is to win while moving a piece!"]))));if(e.startingCoord.equalsValue(new Bae(0,1)))return T7.SUCCESS}return T7.failure($localize(Rr||(Rr=wg(["Failed. Try again."]))))},$localize(Mr||(Mr=wg(["Congratulations!"]))))]});function Xce(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",5),uS("click",function(){var e=Nk(n),t=e.$implicit,r=e.index;return hS().onPieceClick(0,t,r)}),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS();pb(1),dS("id","piece_0_",r.toString(),""),XE("ngClass",a.getSidePieceClasses(r,i)),$E("r",a.getPieceRadius(r))("cx",a.getPieceLeftX(0,i)+a.getPieceRadius(r))("cy",a.SPACE_SIZE/2)}}function Jce(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",8),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onBoardClick(e,t)}),tS()}if(2&e){var r=t.$implicit,i=hS().index,a=hS().index,o=hS();XE("ngClass",o.getPieceClasses(r)),$E("r",o.getPieceRadius(r))("cx",o.SPACE_SIZE*i+o.STROKE_WIDTH+o.SPACE_SIZE/2)("cy",o.SPACE_SIZE*a+o.STROKE_WIDTH+o.SPACE_SIZE/2)}}function ele(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",6),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onBoardClick(e,t)}),tS(),YE(2,Jce,1,4,"circle",7),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","click_",i,"_",a,""),XE("ngClass",o.getRectClasses(i,a)),$E("x",o.SPACE_SIZE*i+o.STROKE_WIDTH)("y",o.SPACE_SIZE*a+o.STROKE_WIDTH)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngForOf",o.getListPieces(r))}}function tle(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,ele,3,8,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function nle(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",9),uS("click",function(){var e=Nk(n).$implicit;return hS().onBoardClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),$E("x",i.SPACE_SIZE*r.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}function rle(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",5),uS("click",function(){var e=Nk(n),t=e.$implicit,r=e.index;return hS().onPieceClick(1,t,r)}),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS();pb(1),dS("id","piece_1_",r.toString(),""),XE("ngClass",a.getSidePieceClasses(r,i)),$E("r",a.getPieceRadius(r))("cx",a.getPieceLeftX(1,i)+a.getPieceRadius(r))("cy",a.SPACE_SIZE/2)}}var ile=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).INTER_PIECE_SPACE=20,r.lastLandingCoord=lV.empty(),r.lastStartingCoord=lV.empty(),r.chosenCoord=lV.empty(),r.chosenPiece=lV.empty(),r.remainingPieceLeftX=[],r.rules=new Vce(Fce),r.availableMinimaxes=[new Hce(r.rules,"EncapsuleMinimax")],r.encoder=zce.encoder,r.tutorial=(new Qce).tutorial,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.board=this.rules.node.gameState.getCopiedBoard();var e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=lV.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=lV.empty(),this.lastStartingCoord=lV.empty())}},{key:"getListPieces",value:function(e){return e.toList()}},{key:"getRemainingPieces",value:function(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(Nre.of(e))}},{key:"onBoardClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(a=new Bae(e,t),o=n.rules.node.gameState,!n.chosenCoord.isAbsent()){r.next=9;break}if(n.chosenCoord=lV.of(a),!n.chosenPiece.isPresent()){r.next=8;break}return s=zce.fromDrop(n.chosenPiece.get(),a),r.abrupt("return",n.chooseMove(s,n.rules.node.gameState));case 8:return r.abrupt("return",!1===o.getPieceAt(a).belongsTo(o.getCurrentPlayer())?n.cancelMove(Bce.INVALID_PIECE_SELECTED()):T7.SUCCESS);case 9:if(!n.chosenCoord.equalsValue(a)){r.next=11;break}return r.abrupt("return",n.cancelMove(Bce.SAME_DEST_AS_ORIGIN()));case 11:return u=zce.fromMove(n.chosenCoord.get(),a),r.abrupt("return",n.chooseMove(u,n.rules.node.gameState));case 13:case"end":return r.stop()}},r)}))()}},{key:"cancelMoveAttempt",value:function(){this.chosenCoord=lV.empty(),this.chosenPiece=lV.empty(),this.chosenPieceIndex=-1}},{key:"onPieceClick",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=r.canUserPlay("#piece_"+e+"_"+t.toString()),i.abrupt("return",a.isFailure()?r.cancelMove(a.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(Bce.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=lV.of(t),r.chosenPieceIndex=n,T7.SUCCESS):r.cancelMove(Bce.END_YOUR_MOVE()));case 2:case"end":return i.stop()}},i)}))()}},{key:"getRectClasses",value:function(e,t){return this.isSelected(e,t)?"moved":""}},{key:"isSelected",value:function(e,t){var n=new Bae(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}},{key:"getPieceClasses",value:function(e){return[this.getPieceStrokeClass(e)]}},{key:"getPieceStrokeClass",value:function(e){var t=e.getPlayer();return M7(t.isPlayer(),"EncapsuleComponent.getPieceStrokeClass should only be called with actual pieces!"),"player"+t.value+"-stroke"}},{key:"getPieceRadius",value:function(e){switch(e.getSize()){case Dce.BIG:return this.SPACE_SIZE/2-1*this.STROKE_WIDTH;case Dce.MEDIUM:return this.SPACE_SIZE/2-2*this.STROKE_WIDTH-3;default:return aV.expectToBe(e.getSize(),Dce.SMALL),this.SPACE_SIZE/2-3*this.STROKE_WIDTH-6}}},{key:"getHighlightedCases",value:function(){var e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}},{key:"getSidePieceClasses",value:function(e,t){var n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}},{key:"isSelectedPiece",value:function(e){return this.chosenPiece.equalsValue(e)}},{key:"calculateLeftX",value:function(){this.remainingPieceLeftX=[];for(var e=0;e<=1;e++){this.remainingPieceLeftX.push([]);for(var t=this.getRemainingPieces(e),n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{var r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}},{key:"getPieceLeftX",value:function(e,t){return this.remainingPieceLeftX[e][t]}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-encapsule"]],features:[xE],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"g",null,1),YE(3,Xce,2,5,"g",2),tS(),eS(4,"g",null,3),YE(6,tle,2,1,"g",2),YE(7,nle,2,4,"g",2),tS(),eS(8,"g",null,4),YE(10,rle,2,5,"g",2),tS(),tS()),2&e&&(pb(1),$E("transform","translate("+t.STROKE_WIDTH+", 0)"),pb(2),XE("ngForOf",t.getRemainingPieces(0)),pb(1),$E("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),pb(2),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.getHighlightedCases()),pb(1),$E("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),pb(2),XE("ngForOf",t.getRemainingPieces(1)))},directives:[LA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),ale=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;if(Wg(this,n),(s=t.call(this,e,r)).movedPieces=i,s.stepSize=a,s.direction=o,s.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+s.coord.toString()+".");if(i<1)throw new Error("Must select minimum one piece (got "+i+").");if(a<1)throw new Error("Step size must be minimum one (got "+a+").");if(a>i)throw new Error("Cannot move a phalanx further than its size (got step size "+a+" for "+i+" pieces).");return Lg(s)}return jg(n,[{key:"toString",value:function(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}},{key:"equals",value:function(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}]),n}(roe);ale.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 122303}},{key:"encodeNumber",value:function(e){var t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}},{key:"decodeNumber",value:function(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");var t=e%8;e-=t;var n=(e/=8)%7;e-=n;var r=(e/=7)%13;e-=r;var i=(e/=13)%12;e-=i;var a=e/=12,o=Lae.factory.fromInt(t);return new ale(a,i,r+1,n+1,o.get())}}]),n}(xre));var ole=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"count",value:function(e,t){for(var n=0,r=0;r<14;r++)this.board[t][r]===e&&n++;return n}},{key:"doesOwnPiece",value:function(e){for(var t=0;t<12;t++)for(var n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}],[{key:"getInitialState",value:function(){var e=Mre.NONE,t=Nre.ONE,r=Nre.ZERO;return new n([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[r,r,r,r,r,r,r,r,r,r,r,r,r,r],[r,r,r,r,r,r,r,r,r,r,r,r,r,r]],0)}}]),n}(eoe),sle=function(){var e=jg(function e(){Wg(this,e)});return e.PHALANX_IS_LEAVING_BOARD=function(){return $localize(Nr||(Nr=wg(["The move distance of your phalanx puts it out of the board."])))},e.SOMETHING_IN_PHALANX_WAY=function(){return $localize(Dr||(Dr=wg(["There is something in the way of your phalanx."])))},e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=function(){return $localize(Lr||(Lr=wg(["Your phalanx must be bigger than the one you are capturing."])))},e.CASE_NOT_ALIGNED_WITH_SELECTED=function(){return $localize(Fr||(Fr=wg(["This square is not aligned with the selected piece."])))},e.SINGLE_PIECE_MUST_MOVE_BY_ONE=function(){return $localize(Ur||(Ur=wg(["A single piece can only move by one square."])))},e.SINGLE_PIECE_CANNOT_CAPTURE=function(){return $localize(Br||(Br=wg(["A single piece cannot make a capture."])))},e.CASE_NOT_ALIGNED_WITH_PHALANX=function(){return $localize(Vr||(Vr=wg(["This square is not aligned with the direction of the phalanx."])))},e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=function(){return $localize(zr||(zr=wg(["A phalanx can't contain pieces outside of the board."])))},e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=function(){return $localize(Hr||(Hr=wg(["A phalanx cannot contain an empty square."])))},e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=function(){return $localize(Gr||(Gr=wg(["A phalanx cannot contain a piece of the opponent."])))},e}(),ule=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"applyLegalMove",value:function(e,t,n){return new ole(n,t.turn+1)}},{key:"getGameStatus",value:function(e){var t=e.gameState,n=t.count(Nre.ZERO,0),r=t.count(Nre.ONE,11);if(t.turn%2==0){if(n>r)return loe.ZERO_WON}else if(r>n)return loe.ONE_WON;return!1===t.doesOwnPiece(Nre.ZERO)?loe.ONE_WON:!1===t.doesOwnPiece(Nre.ONE)?loe.ZERO_WON:loe.ONGOING}}],[{key:"isLegal",value:function(e,t){var r=this.getPhalanxValidity(t,e);if(r.isFailure())return S7.failure(r.getReason());var i=this.getLandingStatus(t,e);if(i.isFailure())return i;var a=Ure.copyBiArray(i.get()),o=t.getCurrentOpponent(),s=n.getCaptureValidity(t,a,e,o);return s.isFailure()?s:S7.success(s.get())}},{key:"getPhalanxValidity",value:function(e,t){for(var n=t.coord,r=0,i=e.getCurrentOpponent();r<t.movedPieces;){if(n.isNotInRange(14,12))return T7.failure(sle.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());var a=e.getPieceAt(n);if(a===Mre.NONE)return T7.failure(sle.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(a===i)return T7.failure(sle.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());n=n.getNext(t.direction,1),r++}return T7.SUCCESS}},{key:"getLandingStatus",value:function(e,t){for(var n=e.getCopiedBoard(),r=e.getCurrentPlayer(),i=t.coord,a=t.coord.getNext(t.direction,t.movedPieces),o=0;o+1<t.stepSize;){if(n[i.y][i.x]=Mre.NONE,n[a.y][a.x]=r,a.isNotInRange(14,12))return S7.failure(sle.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(a).isPlayer())return S7.failure(sle.SOMETHING_IN_PHALANX_WAY());o++,a=a.getNext(t.direction,1),i=i.getNext(t.direction,1)}return a.isNotInRange(14,12)?S7.failure(sle.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(a)===r?S7.failure(Zae.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=Mre.NONE,n[a.y][a.x]=r,S7.success(n))}},{key:"getCaptureValidity",value:function(e,t,n,r){for(var i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1),a=0;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(a>0&&(t[i.y][i.x]=Mre.NONE),++a>=n.movedPieces)return S7.failure(sle.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return S7.success(t)}}]),n}(hoe),cle=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=n.getListMoves(e);return Ure.sortByDescending(t,function(e){return e.stepSize}),t}},{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);return new Kae(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}},{key:"getPieceCountPlusRowDomination",value:function(e){for(var t=0,n=0;n<12;n++){for(var r=0,i=[0,0],a=0;a<14;a++){var o=new Bae(a,n),s=e.getPieceAt(o);if(s.isPlayer()){var u=s.getScoreModifier();t+=2002*u,i[s.value]=u,r+=u;for(var c=0,l=[Lae.UP_LEFT,Lae.UP,Lae.UP_RIGHT];c<l.length;c++)for(var h=l[c],f=o.getNext(h,1);f.isInRange(14,12)&&e.getPieceAt(f)===s;)t+=1*u,f=f.getNext(h,1)}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce(function(e,t){return e+t})}return t}}],[{key:"getListMoves",value:function(e){for(var t,n=e.gameState.getCurrentPlayer(),r=e.gameState.getCurrentOpponent(),i=Mre.NONE,a=[],o=e.gameState,s=0;s<12;s++)for(var u=0;u<14;u++){var c=new Bae(u,s);if(o.getPieceAt(c)===n){var l,h=Hg(Lae.DIRECTIONS);try{for(h.s();!(l=h.n()).done;){for(var f=l.value,d=1,v=c.getNext(f,1);v.isInRange(14,12)&&o.getPieceAt(v)===n;)d+=1,v=v.getNext(f,1);for(var p=1;v.isInRange(14,12)&&p<=d&&o.getPieceAt(v)===i;)t=new ale(u,s,d,p,f),a=this.addMove(a,t,o),p++,v=v.getNext(f,1);v.isInRange(14,12)&&p<=d&&o.getPieceAt(v)===r&&(t=new ale(u,s,d,p,f),a=this.addMove(a,t,o))}}catch(g){h.e(g)}finally{h.f()}}}return a}},{key:"addMove",value:function(e,t,n){return ule.isLegal(t,n).isSuccess()&&e.push(t),e}}]),n}(Yae),lle=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=cle.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}},{key:"orderMovesByPhalanxSizeAndFilter",value:function(e,t){var n=this;return Ure.sortByDescending(e,function(e){return e.movedPieces}),e.length>40?e.filter(function(e){return!!n.moveIsCapture(e,t)||e.movedPieces*Math.random()>1}):e}},{key:"moveIsCapture",value:function(e,t){var n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}},{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);return new Kae(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}},{key:"getPieceCountThenSupportThenAdvancement",value:function(e){for(var t=0,n=0;n<12;n++)for(var r=0;r<14;r++){var i=new Bae(r,n),a=e.getPieceAt(i);if(a.isPlayer()){var o=void 0,s=void 0;a===Nre.ZERO?(o=12-n,s=[Lae.UP_LEFT,Lae.UP,Lae.UP_RIGHT]):(o=n+1,s=[Lae.DOWN_LEFT,Lae.DOWN,Lae.DOWN_RIGHT]);var u=a.getScoreModifier();t+=o*u,t+=149629*u;var c,l=Hg(s);try{for(l.s();!(c=l.n()).done;)for(var h=c.value,f=i.getNext(h,1);f.isInRange(14,12)&&e.getPieceAt(f)===a;)t+=337*u,f=f.getNext(h,1)}catch(d){l.e(d)}finally{l.f()}}}return t}}]),n}(Yae),hle=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).DOMINANCE_FACTOR=20,e.DEFENSE_FACTOR=5,e.TERRITORY_FACTOR=2,e.OFFENSE_FACTOR=10,e.CENTER_FACTOR=5,e.MOBILITY_FACTOR=.12,e}return jg(n,[{key:"getDominance",value:function(e){for(var t=0,n=0;n<12;n++)for(var r=0;r<14;r++){var i=e.getPieceAt(new Bae(r,n));i.isPlayer()&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}},{key:"getDefense",value:function(e){for(var t=0,n=0;n<14;n++)e.getPieceAt(new Bae(n,11))===Nre.ZERO&&(t+=Nre.ZERO.getScoreModifier()),e.getPieceAt(new Bae(n,0))===Nre.ONE&&(t+=Nre.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}},{key:"getTerritory",value:function(e){for(var t=0,n=0;n<12;n++)for(var r=0;r<14;r++){var i=e.getPieceAt(new Bae(r,n));if(i.isPlayer()){for(var a=-1;a<=1;a++)for(var o=-1;o<=1;o++){var s=new Bae(r+a,n+o);if(s.isInRange(14,12)){var u=e.getPieceAt(s);(u===i||u===Mre.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}},{key:"getOffense",value:function(e){for(var t=0,n=0;n<14;n++)e.getPieceAt(new Bae(n,0))===Nre.ZERO&&(t+=Nre.ZERO.getScoreModifier()),e.getPieceAt(new Bae(n,11))===Nre.ONE&&(t+=Nre.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}},{key:"getCenter",value:function(e){for(var t=0,n=0;n<12;n++)for(var r=0;r<14;r++){var i=e.getPieceAt(new Bae(r,n));i.isPlayer()&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}},{key:"getMobility",value:function(e){for(var t=0,n=0,r=0,i=0;i<12;i++)for(var a=0;a<14;a++){var o=new Bae(a,i),s=e.getPieceAt(o);if(s.isPlayer()){var u,c=Hg(Lae.DIRECTIONS);try{for(c.s();!(u=c.n()).done;){for(var l=u.value,h=1,f=o.getNext(l,1);f.isInRange(14,12)&&e.getPieceAt(f)===s;)h+=1,f=f.getNext(l,1);for(var d=1;f.isInRange(14,12)&&d<=h&&e.getPieceAt(f)===Mre.NONE;)d++,f=f.getNext(l,1);t+=d*d*s.getScoreModifier(),s===Nre.ZERO?n=Math.max(n,d):s===Nre.ONE&&(r=Math.max(r,d))}}catch(v){c.e(v)}finally{c.f()}}}return(t+n*Nre.ZERO.getScoreModifier()+r*Nre.ONE.getScoreModifier())*this.MOBILITY_FACTOR}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new Kae(n.toBoardValue());var r=this.getDominance(t),i=this.getDefense(t),a=this.getTerritory(t),o=this.getCenter(t),s=this.getOffense(t),u=this.getMobility(t);return new Kae(r+i+a+o+s+u)}}]),n}(cle),fle=Mre.NONE,dle=Nre.ZERO,vle=Nre.ONE,ple=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize($r||($r=wg(["Initial board"]))),$localize(Wr||(Wr=wg(["This is the initial board of Epaminondas.\n        The top line is the starting line of Light.\n        The bottom line is the starting line of Dark."]))),ole.getInitialState()),poe.informational($localize(qr||(qr=wg(["Goal of the game (1/2)"]))),$localize(jr||(jr=wg(["After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line\n        than the number of pieces the opponent has on the player's starting line, the player wins.\n        Here, it's Dark's turn to play: Dark has therefore won."]))),new ole([[fle,fle,fle,fle,fle,dle,fle,fle,vle,vle,vle,vle,vle,vle],[fle,fle,fle,fle,fle,dle,fle,fle,fle,fle,fle,fle,vle,vle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,vle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,dle,dle,dle,dle,fle,fle,fle]],0)),poe.informational($localize(Zr||(Zr=wg(["Goal of the game (2/2)"]))),$localize(Yr||(Yr=wg(["Here, it is Light's turn.\n        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line."]))),new ole([[fle,fle,fle,fle,fle,dle,fle,fle,fle,fle,vle,vle,vle,vle],[fle,fle,fle,fle,fle,dle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,vle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,vle,vle,fle,fle,fle,dle,dle,fle,dle,dle,dle,dle]],1)),poe.fromPredicate($localize(Kr||(Kr=wg(["Moving a piece"]))),$localize(Qr||(Qr=wg(["Here is the starting board. Dark plays first.\n        Let's start with moving a single piece:\n        <ol>\n            <li>Click on a piece.</li>\n            <li>Click on a empty neighboring square.</li>\n        </ol>"]))),ole.getInitialState(),new ale(0,10,1,1,Lae.UP),function(e,t){return 1===e.movedPieces?T7.SUCCESS:T7.failure($localize(Xr||(Xr=wg(["Congratulations, you are in advance. But this is not the exercise here, try again."]))))},$localize(Jr||(Jr=wg(["This is how you move a single piece."])))),poe.fromPredicate($localize(ei||(ei=wg(["Moving a phalanx"]))),$localize(ti||(ti=wg(["Let us now see how to move multiple pieces along a line, which is called a phalanx:\n        <ol>\n            <li>Click on the first piece of the phalanx.</li>\n            <li>Click on the last piece of the phalanx.</li>\n            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>\n        </ol><br/>\n        Move a phalanx!"]))),ole.getInitialState(),new ale(0,11,2,1,Lae.UP),function(e,t){return e.movedPieces>1?T7.SUCCESS:T7.failure($localize(ni||(ni=wg(["Failed! You moved only one piece."]))))},$localize(ri||(ri=wg(["Congratulations!\n        The moved pieces can be horizontally, vertically, or diagonally aligned.\n        The move should be made along this axis, forward or backwards.\n        There can be no opponent nor holes in the phalanx."])))),poe.fromMove($localize(ii||(ii=wg(["Capture"]))),$localize(ai||(ai=wg(["In order to capture pieces of the opponent:\n        <ol>\n            <li>It must be aligned with the phalanx you are moving.</li>\n            <li>It must be strictly shorter than your phalanx.</li>\n            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>\n        </ol><br/>\n        Capture a phalanx."]))),new ole([[fle,fle,fle,fle,fle,fle,fle,fle,vle,vle,vle,vle,vle,vle],[fle,fle,fle,fle,fle,fle,vle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,vle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,vle,fle,vle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,vle,vle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,vle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,dle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,dle,fle,fle,fle,fle,vle,fle,fle,fle,fle,fle,fle],[fle,fle,dle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,dle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle,fle],[fle,fle,fle,fle,fle,fle,fle,dle,dle,dle,dle,dle,dle,dle]],0),[new ale(2,10,4,2,Lae.UP)],$localize(oi||(oi=wg(["Congratulations, you made it!\n        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment."]))),$localize(si||(si=wg(["Failed, you have not captured the phalanx."]))))]});function gle(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",4),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onClick(e,t)}),tS()}if(2&e){var r=hS().index,i=hS().index,a=hS();XE("ngClass",a.getPieceClasses(r,i)),$E("cx",a.SPACE_SIZE*r+a.STROKE_WIDTH+a.SPACE_SIZE/2)("cy",a.SPACE_SIZE*i+a.STROKE_WIDTH+a.SPACE_SIZE/2)("r",a.SPACE_SIZE/2-a.STROKE_WIDTH)}}function yle(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",2),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),tS(),YE(2,gle,1,4,"circle",3),tS()}if(2&e){var r=t.index,i=hS().index,a=hS();pb(1),vS("id","click_",r,"_",i,""),XE("ngClass",a.getRectClasses(r,i)),$E("x",a.SPACE_SIZE*r+a.STROKE_WIDTH)("y",a.SPACE_SIZE*i+a.STROKE_WIDTH)("width",a.SPACE_SIZE)("height",a.SPACE_SIZE),pb(1),XE("ngIf",a.board[i][r]!==a.NONE)}}function mle(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,yle,3,8,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function kle(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",5),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),$E("x",i.SPACE_SIZE*r.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}var _le=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).NONE=Mre.NONE,r.firstPiece=lV.empty(),r.validExtensions=[],r.phalanxValidLandings=[],r.lastPiece=lV.empty(),r.phalanxDirection=lV.empty(),r.phalanxMiddles=[],r.moveds=[],r.captureds=[],r.rules=new ule(ole),r.availableMinimaxes=[new cle(r.rules,"Normal"),new lle(r.rules,"Positional"),new hle(r.rules,"Attack")],r.encoder=ale.encoder,r.tutorial=(new ple).tutorial,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.firstPiece=lV.empty(),this.lastPiece=lV.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}},{key:"showPreviousMove",value:function(){var e=this.rules.node.move.get(),t=e.coord;this.moveds=[t];for(var n=1;n<e.stepSize+e.movedPieces;n++)t=t.getNext(e.direction,1),this.moveds.push(t);for(var r=this.rules.node.mother.get(),i=r.gameState.getCurrentOpponent();t.isInRange(14,12)&&r.gameState.getPieceAt(t)===i;)this.captureds.push(t),t=t.getNext(e.direction,1)}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.canUserPlay("#click_"+e+"_"+t),r.abrupt("return",i.isFailure()?n.cancelMove(i.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t));case 2:case"end":return r.stop()}},r)}))()}},{key:"firstClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=n.rules.node.gameState.getCurrentOpponent(),a=n.rules.node.gameState.getCurrentPlayer(),r.t0=n.board[t][e],r.next=r.t0===a?4:r.t0===i?5:6;break;case 4:return r.abrupt("return",(n.firstPiece=lV.of(new Bae(e,t)),n.validExtensions=n.getValidExtensions(a),n.phalanxValidLandings=n.getPhalanxValidLandings(),T7.SUCCESS));case 5:return r.abrupt("return",n.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()));case 6:return r.abrupt("return",(aV.expectToBe(n.board[t][e],Mre.NONE),n.cancelMove(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())));case 7:case"end":return r.stop()}},r)}))()}},{key:"hidePreviousMove",value:function(){this.captureds=[],this.moveds=[]}},{key:"getValidExtensions",value:function(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}},{key:"getFirstPieceExtensions",value:function(e){var t,n=[],r=Hg(Lae.DIRECTIONS);try{for(r.s();!(t=r.n()).done;)for(var i=t.value,a=this.firstPiece.get().getNext(i,1);a.isInRange(14,12)&&this.board[a.y][a.x]===e;)n.push(a),a=a.getNext(i,1)}catch(o){r.e(o)}finally{r.f()}return n}},{key:"getPhalanxValidExtensions",value:function(e){var t=Lae.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get(),n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();var i=this.firstPiece.get().getNext(t,1),a=this.getExtensionsToward(i,t,e);return r.concat(a)}},{key:"getExtensionsToward",value:function(e,t,n){for(var r=[];e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}},{key:"getPhalanxValidLandings",value:function(){if(this.lastPiece.isPresent()){var e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1,a=Lae.factory.fromMove(e,t).get(),o=t.getNext(a,1),s=this.getLandingsToward(o,a,i);a=a.getOpposite();var u=e.getNext(a,1);return this.getLandingsToward(u,a,i).concat(s)}return this.getNeighbooringEmptyCases()}},{key:"getNeighbooringEmptyCases",value:function(){var e,t=[],n=Hg(Lae.DIRECTIONS);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.firstPiece.get().getNext(r,1);i.isInRange(14,12)&&this.board[i.y][i.x]===Mre.NONE&&t.push(i)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"getLandingsToward",value:function(e,t,n){for(var r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),a=[];e.isInRange(14,12)&&a.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&a.push(e),a;a.push(e),e=e.getNext(t,1)}return a}},{key:"getPhalanxLength",value:function(e,t,n){for(var r=0;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}},{key:"cancelMoveAttempt",value:function(){this.firstPiece=lV.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=lV.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}},{key:"secondClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new Bae(e,t),a=n.firstPiece.get(),!i.equals(a)){r.next=3;break}return r.abrupt("return",(n.cancelMoveAttempt(),T7.SUCCESS));case 3:if(o=n.rules.node.gameState.getCurrentOpponent(),s=n.rules.node.gameState.getCurrentPlayer(),i.isAlignedWith(a)){r.next=6;break}return r.abrupt("return",n.cancelMove(sle.CASE_NOT_ALIGNED_WITH_SELECTED()));case 6:u=i.getDistance(a),c=a.getDirectionToward(i).get(),r.t0=n.board[t][e],r.next=r.t0===Mre.NONE?10:r.t0===o?11:12;break;case 10:return r.abrupt("return",1===u?n.tryMove(new ale(a.x,a.y,1,1,c)):n.cancelMove(sle.SINGLE_PIECE_MUST_MOVE_BY_ONE()));case 11:return r.abrupt("return",n.cancelMove(sle.SINGLE_PIECE_CANNOT_CAPTURE()));case 12:return aV.expectToBe(n.board[t][e],s),l=new ale(a.x,a.y,u,1,c),h=ule.getPhalanxValidity(n.rules.node.gameState,l),r.abrupt("return",h.isFailure()?n.cancelMove(h.getReason()):(n.lastPiece=lV.of(i),n.validExtensions=n.getValidExtensions(s),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=a.getCoordsToward(i),n.phalanxDirection=lV.of(c),T7.SUCCESS));case 15:case"end":return r.stop()}},r)}))()}},{key:"thirdClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c,l,h,f,d,v,p;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n.rules.node.gameState.getCurrentPlayer(),a=new Bae(e,t),!n.firstPiece.equalsValue(a)){r.next=3;break}return r.abrupt("return",n.moveFirstPiece(i));case 3:if(!n.lastPiece.equalsValue(a)){r.next=5;break}return r.abrupt("return",n.moveLastPiece(i));case 5:if(o=n.firstPiece.get(),s=n.lastPiece.get(),a.isAlignedWith(o)){r.next=8;break}return r.abrupt("return",n.cancelMove(sle.CASE_NOT_ALIGNED_WITH_PHALANX()));case 8:if(u=Lae.factory.fromMove(o,s).get(),c=Lae.factory.fromMove(o,a).get(),u===c.getOpposite()&&(n.firstPiece=lV.of(s),n.lastPiece=lV.of(o),u=c),u===c){r.next=12;break}return r.abrupt("return",n.cancelMove(sle.CASE_NOT_ALIGNED_WITH_PHALANX()));case 12:if(n.board[t][e]!==i){r.next=16;break}return n.lastPiece=lV.of(a),l=n.firstPiece.get().getDistance(a)+1,h=new ale(n.firstPiece.get().x,n.firstPiece.get().y,l,1,u),f=ule.getPhalanxValidity(n.rules.node.gameState,h),r.abrupt("return",f.isFailure()?n.cancelMove(f.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),T7.SUCCESS));case 16:return d=n.firstPiece.get().getDistance(n.lastPiece.get())+1,v=n.lastPiece.get().getDistance(a),p=new ale(n.firstPiece.get().x,n.firstPiece.get().y,d,v,u),r.abrupt("return",n.tryMove(p));case 18:case"end":return r.stop()}},r)}))()}},{key:"moveFirstPiece",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.firstPiece=lV.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),!t.firstPiece.equals(t.lastPiece)){n.next=6;break}return n.next=4,t.moveOnlyPiece(e);case 4:n.next=7;break;case 6:t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e);case 7:return t.phalanxValidLandings=t.getPhalanxValidLandings(),n.abrupt("return",T7.SUCCESS);case 9:case"end":return n.stop()}},n)}))()}},{key:"moveLastPiece",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(t.lastPiece=lV.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),T7.SUCCESS)));case 1:case"end":return n.stop()}},n)}))()}},{key:"moveOnlyPiece",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(t.lastPiece=lV.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=lV.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),T7.SUCCESS));case 1:case"end":return n.stop()}},n)}))()}},{key:"tryMove",value:function(e){var t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}},{key:"getPieceClasses",value:function(e,t){var n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}},{key:"getPieceStrokeClasses",value:function(e,t){var n=new Bae(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(function(e){return e.equals(n)})?["highlighted"]:[]}},{key:"getRectClasses",value:function(e,t){var n=new Bae(e,t);return this.captureds.some(function(e){return e.equals(n)})?["captured"]:this.moveds.some(function(e){return e.equals(n)})?["moved"]:[]}},{key:"getHighlightedCoords",value:function(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}},{key:"getCurrentPlayerPieces",value:function(){for(var e=[],t=this.rules.node.gameState.getCurrentPlayer(),n=0;n<this.board.length;n++)for(var r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new Bae(r,n));return e}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-epaminondas"]],features:[xE],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,mle,2,1,"g",1),YE(2,kle,2,4,"g",1),tS()),2&e&&(pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.getHighlightedCoords()))},directives:[LA,NA,UA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}();function Cle(e){return new(function(t){Mg(r,t);var n=Dg(r);function r(){return Wg(this,r),n.apply(this,arguments)}return jg(r,[{key:"encode",value:function(t){return t.isPresent()?e.encode(t.get()):null}},{key:"decode",value:function(t){return null===t?lV.empty():lV.of(e.decode(t))}}]),r}(Ire))}var wle=function(){function e(t){if(Wg(this,e),t.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===ace.areOnSameLine(t))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=Ure.copyImmutableArray(t).sort(function(e,t){if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});var n,r=lV.empty(),i=Hg(this.capturedSpaces);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(r.isPresent()&&1!==r.get().getDistance(a))throw new Error("Cannot create a GipfCapture with non-consecutive cases");r=lV.of(a)}}catch(o){i.e(o)}finally{i.f()}}return jg(e,[{key:"toString",value:function(){var e,t="",n=Hg(this.capturedSpaces);try{for(n.s();!(e=n.n()).done;){var r=e.value;""!==t&&(t+=","),t+=r.toString()}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"size",value:function(){return this.capturedSpaces.length}},{key:"forEach",value:function(e){this.capturedSpaces.forEach(e)}},{key:"contains",value:function(e){for(var t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}},{key:"intersectsWith",value:function(e){return this.capturedSpaces.some(function(t){return e.contains(t)})}},{key:"getLine",value:function(){return ace.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}},{key:"equals",value:function(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(var t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}]),e}();wle.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return e.capturedSpaces.map(function(e){return Bae.encoder.encode(e)})}},{key:"decode",value:function(e){return new wle(e.map(function(e){return Bae.encoder.decode(e)}))}}]),n}(Ire));var ble=function(){function e(t,n){Wg(this,e),this.coord=t,this.direction=n}return jg(e,[{key:"toString",value:function(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}},{key:"equals",value:function(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}]),e}();ble.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).optionalDirectionEncoder=Cle(Gae.encoder),e}return jg(n,[{key:"encode",value:function(e){return{coord:Bae.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}},{key:"decode",value:function(e){var t=e;return M7(null!=t.coord,"Invalid encoded GipfPlacement"),new ble(Bae.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}}]),n}(Ire));var Ele=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this)).placement=e,a.initialCaptures=r,a.finalCaptures=i,a}return jg(n,[{key:"toString",value:function(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}},{key:"capturesToString",value:function(e){var t,n="",r=Hg(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;""!==n&&(n+=","),n+="["+i.toString()+"]"}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"equals",value:function(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===Ure.compareArray(this.initialCaptures,e.initialCaptures)||!1===Ure.compareArray(this.finalCaptures,e.finalCaptures))}},{key:"encode",value:function(){return n.encoder.encode(this)}},{key:"decode",value:function(e){return n.encoder.decode(e)}}]),n}(noe);Ele.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encodeMove",value:function(e){var t={placement:ble.encoder.encode(e.placement)};return e.initialCaptures.map(function(e,n){t["initialCapture"+n]=wle.encoder.encode(e)}),e.finalCaptures.map(function(e,n){t["finalCapture"+n]=wle.encoder.encode(e)}),t}},{key:"decodeMove",value:function(e){var t=e;return M7(null!=t.placement,"Invalid encoded GipfMove"),new Ele(ble.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",wle.encoder.decode),this.decodeArray(t,"finalCapture",wle.encoder.decode))}},{key:"decodeArray",value:function(e,t,n){for(var r=[],i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}}]),n}(Are));var Sle=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,r,e,7,7,[3,2,1],Hae.EMPTY)).sidePieces=i,o.capturedPieces=a,o}return jg(n,[{key:"equals",value:function(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&Ure.compareTable(this.board,e.board)}},{key:"getNumberOfPiecesToPlace",value:function(e){return this.sidePieces[e.value]}},{key:"getNumberOfPiecesCaptured",value:function(e){return this.capturedPieces[e.value]}},{key:"setAtUnsafe",value:function(e,t){var r=Ure.copyBiArray(this.board);return r[e.y][e.x]=t,new n(r,this.turn,this.sidePieces,this.capturedPieces)}},{key:"isOnBoard",value:function(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==Hae.UNREACHABLE}}],[{key:"getInitialState",value:function(){var e=Hae.EMPTY,t=Hae.UNREACHABLE,r=Hae.ZERO,i=Hae.ONE;return new n([[t,t,t,i,e,e,r],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[r,e,e,e,e,e,i],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[i,e,e,r,t,t,t]],0,[12,12],[0,0])}}]),n}(oce),Ple=function(){var e=jg(function e(){Wg(this,e)});return e.CAPTURE_MUST_BE_ALIGNED=function(){return $localize(ui||(ui=wg(["You can only capture when 4 or more of your pieces are aligned, and it is not the case."])))},e.INVALID_CAPTURED_PIECES=function(){return $localize(ci||(ci=wg(["You must select a valid capture that contains 4 pieces or more."])))},e.MISSING_CAPTURES=function(){return $localize(li||(li=wg(["There are still possible captures to be done."])))},e.PLACEMENT_NOT_ON_BORDER=function(){return $localize(hi||(hi=wg(["Pieces must be inserted in spaces on the edge of the board."])))},e.INVALID_PLACEMENT_DIRECTION=function(){return $localize(fi||(fi=wg(["You must select a valid placement direction."])))},e.PLACEMENT_WITHOUT_DIRECTION=function(){return $localize(di||(di=wg(["You must select a placement with a direction alongside the insertion space."])))},e.PLACEMENT_ON_COMPLETE_LINE=function(){return $localize(vi||(vi=wg(["You cannot place a piece on a complete line."])))},e.AMBIGUOUS_CAPTURE_COORD=function(){return $localize(pi||(pi=wg(["This piece belongs to two captures. Please select another piece in the capture you'd like to make."])))},e.CLICK_FURTHER_THAN_ONE_COORD=function(){return $localize(gi||(gi=wg(["You must click on an arrow to select your destination."])))},e.NO_DIRECTIONS_AVAILABLE=function(){return $localize(yi||(yi=wg(["You cannot insert a piece here, as all lines are full. Select another space."])))},e}(),Ole=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return new Sle(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}},{key:"getPiecesMoved",value:function(e,t,r){var i=n.applyCaptures(e,t);if(r.direction.isAbsent())return[r.coord];var a=r.direction.get(),o=[];o.push(r.coord);for(var s=r.coord.getNext(a);i.isOnBoard(s)&&i.getPieceAt(s)!==Hae.EMPTY;)o.push(s),s=s.getNext(a);return M7(i.isOnBoard(s)&&i.getPieceAt(s)===Hae.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),o.push(s),o}},{key:"isLegal",value:function(e,t){var r=this.capturesValidity(t,e.initialCaptures);if(r.isFailure())return r.toFailedFallible();var i=n.applyCaptures(t,e.initialCaptures),a=this.noMoreCapturesValidity(i);if(a.isFailure())return a.toFailedFallible();var o=this.placementValidity(i,e.placement);if(o.isFailure())return o.toFailedFallible();var s=n.applyPlacement(i,e.placement),u=this.capturesValidity(s,e.finalCaptures);if(u.isFailure())return u.toFailedFallible();var c=n.applyCaptures(s,e.finalCaptures),l=this.noMoreCapturesValidity(c);return l.isFailure()?l.toFailedFallible():S7.success(c)}},{key:"capturesValidity",value:function(e,t){var r,i=e,a=Hg(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=this.captureValidity(i,o);if(s.isFailure())return s;i=n.applyCapture(i,o)}}catch(u){a.e(u)}finally{a.f()}return T7.SUCCESS}},{key:"captureValidity",value:function(e,t){var r=e.getCurrentPlayer(),i=n.getLinePortionWithFourPiecesOfPlayer(e,r,t.getLine());if(i.isAbsent())return T7.failure(Ple.CAPTURE_MUST_BE_ALIGNED());var a=i.get();return n.getCapturable(e,a).equals(t)?T7.SUCCESS:T7.failure(Ple.INVALID_CAPTURED_PIECES())}},{key:"noMoreCapturesValidity",value:function(e){var t=e.getCurrentPlayer();return 0===n.getLinePortionsWithFourPiecesOfPlayer(e,t).length?T7.SUCCESS:T7.failure(Ple.MISSING_CAPTURES())}},{key:"placementValidity",value:function(e,t){var r=this.placementCoordValidity(e,t.coord);if(r.isFailure())return r;if(e.getPieceAt(t.coord)!==Hae.EMPTY){if(t.direction.isAbsent())return T7.failure(Ple.PLACEMENT_WITHOUT_DIRECTION());if(n.isLineComplete(e,t.coord,t.direction.get()))return T7.failure(Ple.PLACEMENT_ON_COMPLETE_LINE());var i,a=Hg(n.getAllDirectionsForEntrance(e,t.coord));try{for(a.s();!(i=a.n()).done;){if(i.value===t.direction.get())return T7.SUCCESS}}catch(o){a.e(o)}finally{a.f()}return T7.failure(Ple.INVALID_PLACEMENT_DIRECTION())}return T7.SUCCESS}},{key:"placementCoordValidity",value:function(e,t){return jae.INSTANCE.isOnBorder(e,t)?T7.SUCCESS:T7.failure(Ple.PLACEMENT_NOT_ON_BORDER())}},{key:"getGameStatus",value:function(e){var t=e.gameState,r=n.getPlayerScore(t,Nre.ZERO),i=n.getPlayerScore(t,Nre.ONE);return r.isAbsent()?loe.ONE_WON:i.isAbsent()?loe.ZERO_WON:loe.ONGOING}}],[{key:"applyCaptures",value:function(e,t){var r=e;return t.forEach(function(e){r=n.applyCapture(r,e)}),r}},{key:"applyCapture",value:function(e,t){var n=e.getCurrentPlayer(),r=e,i=[e.sidePieces[0],e.sidePieces[1]],a=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(function(t){var o=e.getPieceAt(t);r=r.setAt(t,Hae.EMPTY),o.is(n)?i[n.value]+=1:a[n.value]+=1}),new Sle(r.board,e.turn,i,a)}},{key:"getPlacements",value:function(e){var t=[];return jae.INSTANCE.getAllBorders(e).forEach(function(r){e.getPieceAt(r)===Hae.EMPTY?t.push(new ble(r,lV.empty())):n.getAllDirectionsForEntrance(e,r).forEach(function(i){!1===n.isLineComplete(e,r,i)&&t.push(new ble(r,lV.of(i)))})}),t}},{key:"isLineComplete",value:function(e,t,r){return n.nextGapInLine(e,t,r).isAbsent()}},{key:"nextGapInLine",value:function(e,t,n){for(var r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===Hae.EMPTY)return lV.of(r);return lV.empty()}},{key:"applyPlacement",value:function(e,t){var n=e.getCurrentPlayer(),r=e,i=Hae.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){var a=t.coord;if(e.getPieceAt(a)!==Hae.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(a,i)}else for(var o=t.coord;r.isOnBoard(o)&&i!==Hae.EMPTY;o=o.getNext(t.direction.get())){var s=e.getPieceAt(o);r=r.setAt(o,i),i=s}var u=[e.sidePieces[0],e.sidePieces[1]];return u[n.value]-=1,new Sle(r.board,e.turn,u,e.capturedPieces)}},{key:"getAllDirectionsForEntrance",value:function(e,t){if(jae.INSTANCE.isTopLeftCorner(e,t))return[Gae.RIGHT,Gae.DOWN,Gae.UP_RIGHT];if(jae.INSTANCE.isTopCorner(e,t))return[Gae.DOWN,Gae.DOWN_LEFT,Gae.RIGHT];if(jae.INSTANCE.isTopRightCorner(e,t))return[Gae.DOWN_LEFT,Gae.DOWN,Gae.LEFT];if(jae.INSTANCE.isBottomLeftCorner(e,t))return[Gae.UP_RIGHT,Gae.UP,Gae.RIGHT];if(jae.INSTANCE.isBottomCorner(e,t))return[Gae.UP,Gae.LEFT,Gae.UP_RIGHT];if(jae.INSTANCE.isBottomRightCorner(e,t))return[Gae.LEFT,Gae.UP,Gae.DOWN_LEFT];if(jae.INSTANCE.isOnTopLeftBorder(e,t))return[Gae.RIGHT,Gae.DOWN];if(jae.INSTANCE.isOnLeftBorder(e,t))return[Gae.UP_RIGHT,Gae.RIGHT];if(jae.INSTANCE.isOnBottomLeftBorder(e,t))return[Gae.UP,Gae.UP_RIGHT];if(jae.INSTANCE.isOnBottomRightBorder(e,t))return[Gae.LEFT,Gae.UP];if(jae.INSTANCE.isOnRightBorder(e,t))return[Gae.LEFT,Gae.DOWN_LEFT];if(jae.INSTANCE.isOnTopRightBorder(e,t))return[Gae.DOWN_LEFT,Gae.DOWN];throw new Error("not a border")}},{key:"getLinePortionsWithFourPiecesOfPlayer",value:function(e,t){var r=[];return e.allLines().forEach(function(i){var a=n.getLinePortionWithFourPiecesOfPlayer(e,t,i);a.isPresent()&&r.push(a.get())}),r}},{key:"getLinePortionWithFourPiecesOfPlayer",value:function(e,t,n){for(var r=0,i=e.getEntranceOnLine(n),a=n.getDirection(),o=i,s=i;e.isOnBoard(s);s=s.getNext(a))if(e.getPieceAt(s).is(t)?(0===r&&(o=s),r+=1):r=0,4===r)return lV.of({0:o,1:s,2:a});return lV.empty()}},{key:"getCapturable",value:function(e,t){for(var n=[],r=t[0],i=t[1],a=t[2],o=a.getOpposite(),s=r.getNext(o);e.isOnBoard(s)&&e.getPieceAt(s)!==Hae.EMPTY;)n.push(s),s=s.getNext(o);for(var u=r;!u.equals(i);u=u.getNext(a))n.push(u);for(var c=i;e.isOnBoard(c)&&e.getPieceAt(c)!==Hae.EMPTY;c=c.getNext(a))n.push(c);return new wle(n)}},{key:"getPossibleCaptures",value:function(e){var t=e.getCurrentPlayer(),r=[];return n.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(function(t){r.push(n.getCapturable(e,t))}),r}},{key:"getPlayerScore",value:function(e,t){var r=e.getNumberOfPiecesToPlace(t);if(0===r&&0===n.getPossibleCaptures(e).length)return lV.empty();var i=e.getNumberOfPiecesCaptured(t);return lV.of(r+3*i)}},{key:"isGameOver",value:function(e){var t=n.getPlayerScore(e,Nre.ZERO),r=n.getPlayerScore(e,Nre.ONE);return t.isAbsent()||r.isAbsent()}}]),n}(hoe),Tle=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=e.gameState,n=Ole.getPlayerScore(t,Nre.ZERO),r=Ole.getPlayerScore(t,Nre.ONE);return n.isAbsent()?new Kae(Nre.ONE.getVictoryValue()):r.isAbsent()?new Kae(Nre.ZERO.getVictoryValue()):new Kae(n.get()-r.get())}},{key:"getListMoves",value:function(e){return this.getListMoveFromState(e.gameState)}},{key:"getListMoveFromState",value:function(e){var t=this,n=[];return Ole.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(function(r){var i=Ole.applyCaptures(e,r);Ole.getPlacements(i).forEach(function(e){var a=Ole.applyPlacement(i,e);t.getPossibleCaptureCombinations(a).forEach(function(t){var i=new Ele(e,r,t);n.push(i)})})}),n}},{key:"getPossibleCaptureCombinations",value:function(e){var t=Ole.getPossibleCaptures(e);return n.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}],[{key:"getPossibleCaptureCombinationsFromPossibleCaptures",value:function(e){var t=n.computeIntersections(e),r=[[]];return e.forEach(function(e,n){if(0===t[n].length)r.forEach(function(e){e.push(n)});else{var i,a=[],o=t[n].some(function(e){return e>n}),s=Hg(r);try{for(s.s();!(i=s.n()).done;){var u=i.value;!0===u.some(function(e){return t[n].some(function(t){return e===t})})?a.push(Ure.copyImmutableArray(u)):o?(a.push(Ure.copyImmutableArray(u)),u.push(n),a.push(Ure.copyImmutableArray(u))):(u.push(n),a.push(Ure.copyImmutableArray(u)))}}catch(c){s.e(c)}finally{s.f()}r=a}}),r.map(function(t){return t.map(function(t){return e[t]})})}},{key:"computeIntersections",value:function(e){var t=[];return e.forEach(function(n,r){t.push([]),e.forEach(function(e,i){r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}}]),n}(Yae),Ile=jg(function e(t,n,r,i,a,o){Wg(this,e),this.source=t,this.destination=n,this.x1=r,this.y1=i,this.x2=a,this.y2=o}),Ale=Hae.UNREACHABLE,xle=Hae.EMPTY,Rle=Hae.ZERO,Mle=Hae.ONE,Nle=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(mi||(mi=wg(["Goal of the game"]))),$localize(ki||(ki=wg(["The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.\n        This is the initial board.\n        Each player has 12 pieces on the side and 3 pieces on the board.\n        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.\n        The first player plays with the dark pieces, the second player plays with the light pieces."]))),Sle.getInitialState()),poe.anyMove($localize(_i||(_i=wg(["Pushing"]))),$localize(Ci||(Ci=wg(["Pieces can only enter the board through the edges. To insert a new piece:\n        <ol>\n            <li>Click on a space on the edge of the board.</li>\n            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>\n        </ol>\n        You cannot push when a line is full.<br/><br/>\n        You're playing Dark, insert a piece."]))),Sle.getInitialState(),new Ele(new ble(new Bae(3,0),lV.of(Gae.DOWN)),[],[]),$localize(wi||(wi=wg(["Congratulations!"])))),poe.fromMove($localize(bi||(bi=wg(["Capture (1/3)"]))),$localize(Ei||(Ei=wg(["To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.\n        There are multiple important aspects of a capture:\n        <ol>\n            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>\n            <li>As soon as there is an empty space on the line, the capture stops.</li>\n            <li>Your own pieces that are captured go back to your stock.\n                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>\n            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.\n                This means that a turn happens in three phases:\n                <ol type=\"A\">\n                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>\n                    <li>Make your insertion.</li>\n                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>\n                </ol>\n            </li>\n        </ol><br/>\n        You're playing Dark, you can make a capture, do it."]))),new Sle([[Ale,Ale,Ale,Rle,Mle,xle,xle],[Ale,Ale,xle,xle,xle,xle,xle],[Ale,xle,xle,xle,xle,xle,xle],[Rle,Rle,Rle,xle,xle,xle,xle],[Mle,xle,xle,xle,xle,xle,Ale],[xle,xle,xle,Mle,xle,Ale,Ale],[xle,xle,xle,Mle,Ale,Ale,Ale]],42,[8,8],[0,0]),[new Ele(new ble(new Bae(0,3),lV.of(Gae.RIGHT)),[],[new wle([new Bae(0,3),new Bae(1,3),new Bae(2,3),new Bae(3,3)])])],$localize(Si||(Si=wg(["Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.\n        Let's now see how captures can really be useful."]))),$localize(Pi||(Pi=wg(["Failed!"])))),poe.fromMove($localize(Oi||(Oi=wg(["Capture (2/3)"]))),$localize(Ti||(Ti=wg(["Here, there are three different ways of capturing.\n        <ol>\n          <li>One way does not capture any of your opponent's pieces.</li>\n          <li>Another way captures one of your opponent's pieces.</li>\n          <li>The last way captures two of your opponent's pieces.</li>\n        </ol>\n        <br/><br/>\n        Pick the last one."]))),new Sle([[Ale,Ale,Ale,xle,xle,xle,xle],[Ale,Ale,xle,Mle,xle,xle,xle],[Ale,xle,xle,Rle,xle,xle,xle],[Rle,Rle,Rle,Mle,xle,xle,xle],[xle,xle,xle,Rle,xle,xle,Ale],[xle,xle,xle,Rle,xle,Ale,Ale],[xle,xle,xle,Mle,Ale,Ale,Ale]],42,[8,4],[2,3]),[new Ele(new ble(new Bae(0,3),lV.of(Gae.RIGHT)),[],[new wle([new Bae(3,1),new Bae(3,2),new Bae(3,3),new Bae(3,4),new Bae(3,5),new Bae(3,6)])])],$localize(Ii||(Ii=wg(["Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.\n        The most you can get is 3 per capture."]))),$localize(Ai||(Ai=wg(["Failed, the best capture was taking 2 of your opponent's pieces"])))),poe.fromMove($localize(xi||(xi=wg(["Capture (3/3)"]))),$localize(Ri||(Ri=wg(["Here, you must capture at the beginning of your turn.\n        This is due to a move of your opponent at the previous turn\n        (even though this is a fictitious board for pedagogical purpose).\n        After your capture, by performing the right move you can even capture two more of your opponent's pieces!\n        Keep it mind that the most useful in a capture is to take your opponent's pieces."]))),new Sle([[Ale,Ale,Ale,Rle,xle,xle,Rle],[Ale,Ale,xle,Rle,xle,xle,Rle],[Ale,Rle,Rle,xle,Rle,Mle,Rle],[xle,xle,xle,Rle,xle,xle,Rle],[xle,xle,xle,Rle,xle,xle,Ale],[Rle,Rle,Rle,Mle,Mle,Ale,Ale],[xle,xle,xle,Rle,Ale,Ale,Ale]],42,[8,4],[2,3]),[new Ele(new ble(new Bae(3,6),lV.of(Gae.UP)),[new wle([new Bae(6,0),new Bae(6,1),new Bae(6,2),new Bae(6,3)])],[new wle([new Bae(0,5),new Bae(1,5),new Bae(2,5),new Bae(3,5),new Bae(4,5)]),new wle([new Bae(1,2),new Bae(2,2),new Bae(3,2),new Bae(4,2),new Bae(5,2)])]),new Ele(new ble(new Bae(4,6),lV.of(Gae.UP)),[new wle([new Bae(6,0),new Bae(6,1),new Bae(6,2),new Bae(6,3)])],[new wle([new Bae(0,5),new Bae(1,5),new Bae(2,5),new Bae(3,5),new Bae(4,5)]),new wle([new Bae(3,0),new Bae(3,1),new Bae(3,2),new Bae(3,3),new Bae(3,4)])]),new Ele(new ble(new Bae(3,6),lV.of(Gae.UP)),[new wle([new Bae(6,0),new Bae(6,1),new Bae(6,2),new Bae(6,3)])],[new wle([new Bae(1,2),new Bae(2,2),new Bae(3,2),new Bae(4,2),new Bae(5,2)]),new wle([new Bae(0,5),new Bae(1,5),new Bae(2,5),new Bae(3,5),new Bae(4,5)])])],$localize(Mi||(Mi=wg(["Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces."]))),$localize(Ni||(Ni=wg(["Failed, the best capture takes 2 of your opponent's pieces."]))))]});function Dle(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS().$implicit,r=hS();XE("ngClass",r.getPieceClass(n)),$E("cx",r.getCenterAt(n).x)("cy",r.getCenterAt(n).y)("r",r.SPACE_SIZE)}}function Lle(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"g",8),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e)}),nS(2,"polyline",9),YE(3,Dle,1,4,"circle",10),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),vS("id","click_",r.x,"_",r.y,""),pb(1),vS("id","case_",r.x,"_",r.y,""),XE("ngClass",i.getSpaceClass(r)),$E("points",i.getHexaCoordsAt(r)),pb(1),XE("ngIf",i.isPiece(r))}}function Fle(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",14),uS("click",function(){var e=Nk(n).$implicit;return hS(2).onClick(e)}),tS()}if(2&e){var r=t.$implicit;$E("points",hS(2).getHexaCoordsAt(r))}}function Ule(e,t){if(1&e&&(c_(),eS(0,"g",12),YE(1,Fle,1,1,"polyline",13),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n.capturedSpaces)}}function Ble(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"line",15),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.destination)}),tS(),tS()}if(2&e){var r=t.$implicit;pb(1),$E("x1",r.x1)("y1",r.y1)("x2",r.x2)("y2",r.y2)}}function Vle(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",16),tS()),2&e){var n=t.$implicit,r=hS().$implicit,i=hS();pb(1),vS("id","piece_",r,"_",n,""),XE("ngClass",i.getSidePieceClass(r)),$E("cx",10+n*i.SPACE_SIZE*.5)("cy",10+(i.SPACE_SIZE+10)*r)("r",.5*i.SPACE_SIZE)}}function zle(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Vle,2,6,"g",5),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",r.getPlayerSidePieces(n))}}function Hle(e,t){if(1&e&&(c_(),nS(0,"line",17)),2&e){var n=hS();$E("x1",n.inserted.get().x1)("y1",n.inserted.get().y1)("x2",n.inserted.get().x2)("y2",n.inserted.get().y2)}}var Gle=function(){return[0,1]},$le=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).inserted=lV.empty(),r.arrows=[],r.captured=[],r.moved=[],r.movePhase=n.PHASE_PLACEMENT_COORD,r.possibleCaptures=[],r.initialCaptures=[],r.placement=lV.empty(),r.placementEntrance=lV.empty(),r.finalCaptures=[],r.scores=lV.of([0,0]),r.rules=new Ole(Sle),r.availableMinimaxes=[new Tle(r.rules,"GipfMinimax")],r.encoder=Ele.encoder,r.tutorial=(new Nle).tutorial,r.SPACE_SIZE=40,r.constructedState=r.rules.node.gameState,r.hexaLayout=new $ae(1.5*r.SPACE_SIZE,new Bae(2*r.SPACE_SIZE,0),jae.INSTANCE),r}return jg(n,[{key:"updateBoard",value:function(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}},{key:"showLastMove",value:function(){this.inserted=lV.empty();var e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){var t=e.get().placement;this.inserted=lV.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}},{key:"arrowTowards",value:function(e,t){var n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new Ile(n,e,i.x,i.y,r.x,r.y)}},{key:"markCapture",value:function(e){var t=this;e.forEach(function(e){t.captured.push(e)})}},{key:"getAllCoords",value:function(){return this.constructedState.allCoords()}},{key:"getPlayerSidePieces",value:function(e){for(var t=this.constructedState.getNumberOfPiecesToPlace(Nre.of(e)),n=[],r=0;r<t;r+=1)n.push(r);return n}},{key:"isPiece",value:function(e){return this.getPiece(e)!==Hae.EMPTY}},{key:"getPiece",value:function(e){return this.constructedState.getPieceAt(e)}},{key:"onClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=t.canUserPlay("#click_"+e.x+"_"+e.y)).isFailure()){r.next=3;break}return r.abrupt("return",t.cancelMove(i.getReason()));case 3:r.t0=t.movePhase,r.next=r.t0===n.PHASE_INITIAL_CAPTURE||r.t0===n.PHASE_FINAL_CAPTURE?6:r.t0===n.PHASE_PLACEMENT_COORD?7:8;break;case 6:return r.abrupt("return",t.selectCapture(e));case 7:return r.abrupt("return",t.selectPlacementCoord(e));case 8:if(aV.expectToBe(t.movePhase,n.PHASE_PLACEMENT_DIRECTION),!1!==(a=t.placementEntrance.get()).isAlignedWith(e)){r.next=12;break}return r.abrupt("return",t.cancelMove(Ple.INVALID_PLACEMENT_DIRECTION()));case 12:if(1===a.getDistance(e)){r.next=14;break}return r.abrupt("return",t.cancelMove(Ple.CLICK_FURTHER_THAN_ONE_COORD()));case 14:return o=Gae.factory.fromMove(a,e),r.abrupt("return",t.selectPlacementDirection(o.toOptional()));case 16:case"end":return r.stop()}},r)}))()}},{key:"selectCapture",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=[],t.possibleCaptures.forEach(function(t){t.contains(e)&&i.push(t)}),!(i.length>1)){r.next=3;break}return r.abrupt("return",t.cancelMove(Ple.AMBIGUOUS_CAPTURE_COORD()));case 3:if(0!==i.length){r.next=5;break}return r.abrupt("return",t.cancelMove(Ple.MISSING_CAPTURES()));case 5:a=i[0],r.t0=(t.constructedState=Ole.applyCapture(t.constructedState,a),t.markCapture(a),t.possibleCaptures=Ole.getPossibleCaptures(t.constructedState),t.movePhase),r.next=r.t0===n.PHASE_INITIAL_CAPTURE?9:10;break;case 9:return r.abrupt("return",(t.initialCaptures.push(a),0===t.possibleCaptures.length?t.moveToPlacementPhase():T7.SUCCESS));case 10:return r.abrupt("return",(aV.expectToBe(t.movePhase,n.PHASE_FINAL_CAPTURE),t.finalCaptures.push(a),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):T7.SUCCESS));case 11:case"end":return r.stop()}},r)}))()}},{key:"moveToPlacementPhase",value:function(){return this.movePhase=n.PHASE_PLACEMENT_COORD,T7.SUCCESS}},{key:"moveToInitialCaptureOrPlacementPhase",value:function(){return this.possibleCaptures=Ole.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?n.PHASE_PLACEMENT_COORD:n.PHASE_INITIAL_CAPTURE,T7.SUCCESS}},{key:"moveToFinalCapturePhaseOrTryMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(e.possibleCaptures=Ole.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove(e.initialCaptures,e.placement.get(),e.finalCaptures):(e.movePhase=n.PHASE_FINAL_CAPTURE,T7.SUCCESS)));case 1:case"end":return t.stop()}},t)}))()}},{key:"computeArrows",value:function(e){this.arrows=[];var t,n=Hg(Ole.getAllDirectionsForEntrance(this.constructedState,e));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!1===Ole.isLineComplete(this.constructedState,e,r)){var i=e.getNext(r),a=this.getCenterAt(e),o=this.getCenterAt(i);this.arrows.push(new Ile(e,i,a.x,a.y,o.x,o.y))}}}catch(s){n.e(s)}finally{n.f()}}},{key:"selectPlacementCoord",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=t.rules.placementCoordValidity(t.constructedState,e),r.abrupt("return",i.isFailure()?t.cancelMove(i.getReason()):(t.placementEntrance=lV.of(e),t.constructedState.getPieceAt(e)===Hae.EMPTY?t.selectPlacementDirection(lV.empty()):(t.movePhase=n.PHASE_PLACEMENT_DIRECTION,t.computeArrows(e),0===t.arrows.length&&t.cancelMove(Ple.NO_DIRECTIONS_AVAILABLE()),T7.SUCCESS)));case 2:case"end":return r.stop()}},r)}))()}},{key:"selectPlacementDirection",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.placement=lV.of(new ble(t.placementEntrance.get(),e)),r=t.rules.placementValidity(t.constructedState,t.placement.get()),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):(t.arrows=[],t.constructedState=Ole.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove()));case 3:case"end":return n.stop()}},n)}))()}},{key:"tryMove",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=new Ele(t,e,n),i.next=3,r.chooseMove(a,r.rules.node.gameState,r.scores.get());case 3:return i.abrupt("return",i.sent);case 4:case"end":return i.stop()}},i)}))()}},{key:"cancelMoveAttempt",value:function(){var e=this;this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];var t=this.rules.node.move;if(t.isPresent()){var n=t.get(),r=this.rules.node.mother.get().gameState;n.initialCaptures.forEach(function(t){return e.markCapture(t)}),n.finalCaptures.forEach(function(t){return e.markCapture(t)}),this.moved=this.rules.getPiecesMoved(r,n.initialCaptures,n.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=lV.empty(),this.placement=lV.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}},{key:"getSpaceClass",value:function(e){return this.captured.some(function(t){return t.equals(e)})?"captured":this.moved.some(function(t){return t.equals(e)})?"moved":""}},{key:"getPieceClass",value:function(e){var t=this.getPiece(e);return this.getPlayerClass(Nre.of(t.value))}},{key:"getSidePieceClass",value:function(e){return this.getPlayerClass(Nre.of(e))}}]),n}(zae);return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-gipf"]],features:[xE],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"defs"),eS(2,"marker",1),nS(3,"polygon",2),tS(),eS(4,"marker",3),nS(5,"polygon",4),tS(),tS(),YE(6,Lle,4,7,"g",5),YE(7,Ule,2,1,"g",6),YE(8,Ble,2,4,"g",5),YE(9,zle,2,1,"g",5),YE(10,Hle,1,4,"line",7),tS()),2&e&&(pb(6),XE("ngForOf",t.getAllCoords()),pb(1),XE("ngForOf",t.possibleCaptures),pb(1),XE("ngForOf",t.arrows),pb(1),XE("ngForOf",aT(5,Gle)),pb(1),XE("ngIf",t.inserted.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Wle=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"equals",value:function(e){return this===e||this.coord.equals(e.coord)}},{key:"toString",value:function(){return this===n.PASS?"GoMove.PASS":this===n.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}]),n}(roe);Wle.PASS=new Wle(-1,0),Wle.ACCEPT=new Wle(-2,0),Wle.PASS_NUMBER=-1,Wle.ACCEPT_NUMBER=-2,Wle.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 360}},{key:"encodeNumber",value:function(e){return 19*e.coord.y+e.coord.x}},{key:"decodeNumber",value:function(e){if(e===Wle.PASS_NUMBER)return Wle.PASS;var t=e%19;return new Wle(t,(e-t)/19)}}]),n}(xre));var qle=function(){function e(t,n){Wg(this,e),this.player=t,this.type=n}return jg(e,[{key:"equals",value:function(e){return e===this}},{key:"toString",value:function(){switch(this){case e.BLACK:return"GoPiece.BLACK";case e.WHITE:return"GoPiece.WHITE";case e.EMPTY:return"GoPiece.EMPTY";case e.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case e.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case e.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return M7(this===e.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}},{key:"isOccupied",value:function(){return[e.BLACK,e.WHITE,e.DEAD_BLACK,e.DEAD_WHITE].includes(this)}},{key:"isEmpty",value:function(){return[e.BLACK_TERRITORY,e.WHITE_TERRITORY,e.EMPTY].includes(this)}},{key:"isDead",value:function(){return[e.DEAD_BLACK,e.DEAD_WHITE].includes(this)}},{key:"isTerritory",value:function(){return[e.BLACK_TERRITORY,e.WHITE_TERRITORY].includes(this)}},{key:"getOwner",value:function(){return this.player}},{key:"nonTerritory",value:function(){return M7(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),e.EMPTY}}],[{key:"pieceBelongTo",value:function(e,t){return t===e.player&&"territory"!==e.type}},{key:"ofPlayer",value:function(t){return t===Nre.ZERO?e.BLACK:e.WHITE}}]),e}();qle.BLACK=new qle(Nre.ZERO,"alive"),qle.WHITE=new qle(Nre.ONE,"alive"),qle.EMPTY=new qle(Mre.NONE,"empty"),qle.DEAD_BLACK=new qle(Nre.ZERO,"dead"),qle.DEAD_WHITE=new qle(Nre.ONE,"dead"),qle.BLACK_TERRITORY=new qle(Mre.NONE,"territory"),qle.WHITE_TERRITORY=new qle(Mre.NONE,"territory");var jle=(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(jle||(jle={})),jle),Zle=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this,e,i)).captured=r,s.koCoord=a,s.phase=o,s}return jg(n,[{key:"getCapturedCopy",value:function(){return[this.captured[0],this.captured[1]]}},{key:"copy",value:function(){return new n(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}},{key:"isDead",value:function(e){return this.getPieceAt(e).isDead()}},{key:"isTerritory",value:function(e){return this.getPieceAt(e).isTerritory()}}],[{key:"getInitialState",value:function(){var e=n.getStartingBoard();return new n(e,[0,0],0,lV.empty(),jle.PLAYING)}},{key:"getStartingBoard",value:function(){return Ure.createTable(n.WIDTH,n.HEIGHT,qle.EMPTY)}}]),n}(eoe);return e.WIDTH=13,e.HEIGHT=13,e}(),Yle=function(){var e=function(){function e(t){Wg(this,e),this.color=t}return jg(e,[{key:"selfContains",value:function(e){return this.getCoords().some(function(t){return t.equals(e)})}}],[{key:"insertAsEntryPoint",value:function(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}]),e}();return e.VERBOSE=!1,e}(),Kle=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e)).emptyCoords=r,u.blackCoords=i,u.whiteCoords=a,u.deadBlackCoords=o,u.deadWhiteCoords=s,u}return jg(n,[{key:"getCoords",value:function(){return this.color===qle.BLACK?this.blackCoords:this.color===qle.WHITE?this.whiteCoords:this.color===qle.DEAD_BLACK?this.deadBlackCoords:this.color===qle.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}},{key:"contains",value:function(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(function(t){return t.equals(e)})}},{key:"addPawn",value:function(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case qle.BLACK:this.blackCoords=Yle.insertAsEntryPoint(this.blackCoords,e);break;case qle.WHITE:this.whiteCoords=Yle.insertAsEntryPoint(this.whiteCoords,e);break;case qle.DEAD_BLACK:this.deadBlackCoords=Yle.insertAsEntryPoint(this.deadBlackCoords,e);break;case qle.DEAD_WHITE:this.deadWhiteCoords=Yle.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:aV.expectToBeMultiple(t,[qle.EMPTY,qle.BLACK_TERRITORY,qle.WHITE_TERRITORY]),this.emptyCoords=Yle.insertAsEntryPoint(this.emptyCoords,e)}}},{key:"isMonoWrapped",value:function(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}},{key:"getWrapper",value:function(){var e=new ooe([{key:qle.EMPTY,value:this.emptyCoords.length},{key:qle.BLACK,value:this.blackCoords.length+this.deadWhiteCoords.length},{key:qle.WHITE,value:this.whiteCoords.length+this.deadBlackCoords.length}]);e.put(this.color.nonTerritory(),0);var t=e.filter(function(e,t){return t>0});if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}},{key:"getNeighboorsEntryPoint",value:function(){var e=[];return this.color!==qle.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==qle.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==qle.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==qle.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==qle.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}]),n}(Yle),Qle=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getNewInstance",value:function(e){return new Kle(e,[],[],[],[],[])}},{key:"getDirections",value:function(){return Fae.ORTHOGONALS}}]),n}(function(){function e(){Wg(this,e)}return jg(e,[{key:"getGroupDatas",value:function(e,t){oV(Yle.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");var n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}},{key:"_getGroupDatas",value:function(e,t,n){oV(Yle.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});var r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color){var i,a=Hg(this.getDirections());try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e.getNext(o);s.isInRange(t[0].length,t.length)&&(n.contains(s)||(n=this._getGroupDatas(s,t,n)))}}catch(u){a.e(u)}finally{a.f()}}return n}}]),e}()),Xle=function(){var e=jg(function e(){Wg(this,e)});return e.ILLEGAL_KO=function(){return $localize(Di||(Di=wg(["This move is a ko, you must play somewhere else before you can play in this intersection again."])))},e.CANNOT_PASS_AFTER_PASSED_PHASE=function(){return $localize(Li||(Li=wg(["We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn."])))},e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=function(){return $localize(Fi||(Fi=wg(["You cannot accept before the counting phase."])))},e.OCCUPIED_INTERSECTION=function(){return $localize(Ui||(Ui=wg(["This intersection is already occupied."])))},e.CANNOT_COMMIT_SUICIDE=function(){return $localize(Bi||(Bi=wg(["You cannot commit suicide."])))},e}(),Jle=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"applyLegalMove",value:function(e,t,r){return oV(n.VERBOSE,{applyLegalMove:{legalMove:e,state:t,status:r}}),n.isPass(e)?(oV(n.VERBOSE,"GoRules.applyLegalMove: isPass"),n.applyPass(t)):n.isAccept(e)?(oV(n.VERBOSE,"GoRules.applyLegalMove: isAccept"),n.applyLegalAccept(t)):n.isLegalDeadMarking(e,t)?(oV(n.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),n.applyDeadMarkingMove(e,t)):(oV(n.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),n.applyNormalLegalMove(t,e,r))}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"isLegal",value:function(e,t){var r=!1;if(oV(n.VERBOSE||r,{isLegal:{move:e,state:t}}),n.isPass(e)){var i=t.phase===jle.PLAYING,a=t.phase===jle.PASSED;return oV(n.VERBOSE||r,"GoRules.isLegal at "+t.phase+(i||a?" forbid":" allowed")+" passing on "+t.getCopiedBoard()),i||a?S7.success([]):S7.failure(Xle.CANNOT_PASS_AFTER_PASSED_PHASE())}if(n.isAccept(e)){var o=t.phase===jle.ACCEPT;return t.phase===jle.COUNTING||o?S7.success([]):S7.failure(Xle.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return n.isOccupied(e.coord,t.getCopiedBoard())?(oV(n.VERBOSE||r,"GoRules.isLegal: move is marking"),n.isLegalDeadMarking(e,t)?S7.success([]):S7.failure(Xle.OCCUPIED_INTERSECTION())):(oV(n.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+e.toString()),n.isLegalNormalMove(e,t))}},{key:"getNewKo",value:function(e,t,n){if(1===n.length){var r=n[0],i=e.coord,a=t[i.y][i.x],o=(new Qle).getGroupDatas(i,t),s=o.emptyCoords,u=qle.pieceBelongTo(a,Nre.ZERO)?o.blackCoords:o.whiteCoords;if(1===s.length&&s[0].equals(r)&&1===u.length)return lV.of(r)}return lV.empty()}},{key:"markTerritoryAndCount",value:function(e){oV(n.VERBOSE,{markTerritoryAndCount:{state:e}});var t,r=e.getCopiedBoard(),i=n.getTerritoryLikeGroup(e),a=e.getCapturedCopy(),o=Hg(i);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=s.getWrapper();if(u===qle.WHITE){a[1]+=s.emptyCoords.length;var c,l=Hg(s.getCoords());try{for(l.s();!(c=l.n()).done;){var h=c.value;r[h.y][h.x]=qle.WHITE_TERRITORY}}catch(p){l.e(p)}finally{l.f()}}else{M7(u===qle.BLACK,"territory should be wrapped by black or white, not by "+u.toString()),a[0]+=s.emptyCoords.length;var f,d=Hg(s.getCoords());try{for(d.s();!(f=d.n()).done;){var v=f.value;r[v.y][v.x]=qle.BLACK_TERRITORY}}catch(p){d.e(p)}finally{d.f()}}}}catch(p){o.e(p)}finally{o.f()}return new Zle(r,a,e.turn,e.koCoord,e.phase)}},{key:"removeAndSubstractTerritory",value:function(e){for(var t,n=e.getCopiedBoard(),r=e.getCapturedCopy(),i=0;i<e.board.length;i++)for(var a=0;a<e.board[0].length;a++)(t=n[i][a])===qle.BLACK_TERRITORY?(n[i][a]=qle.EMPTY,r[0]=r[0]-1):t===qle.WHITE_TERRITORY&&(n[i][a]=qle.EMPTY,r[1]=r[1]-1);return new Zle(n,r,e.turn,e.koCoord,e.phase)}},{key:"getEmptyZones",value:function(e){return n.getGroupsDatasWhere(e.getCopiedBoard(),function(e){return e.isEmpty()})}},{key:"getGroupsDatasWhere",value:function(e,t){for(var n,r,i=[],a=new Qle,o=0;o<e.length;o++)for(var s=0;s<e[0].length;s++)n=new Bae(s,o),t(e[o][s])&&(i.some(function(e){return e.selfContains(n)})||(r=a.getGroupDatas(n,e),i.push(r)));return i}},{key:"addDeadToScore",value:function(e){for(var t,n=e.getCapturedCopy(),r=n[1],i=n[0],a=0;a<e.board.length;a++)for(var o=0;o<e.board[0].length;o++)(t=e.getPieceAtXY(o,a))===qle.DEAD_BLACK?r++:t===qle.DEAD_WHITE&&i++;return[i,r]}},{key:"switchAliveness",value:function(e,t){var n=t.getCopiedBoard();M7(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");var r=(new Qle).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case qle.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;var a,o=Hg(r.deadBlackCoords);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.y][s.x]=qle.BLACK}}catch(y){o.e(y)}finally{o.f()}break;case qle.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;var u,c=Hg(r.deadWhiteCoords);try{for(c.s();!(u=c.n()).done;){var l=u.value;n[l.y][l.x]=qle.WHITE}}catch(y){c.e(y)}finally{c.f()}break;case qle.WHITE:i[0]+=2*r.whiteCoords.length;var h,f=Hg(r.whiteCoords);try{for(f.s();!(h=f.n()).done;){var d=h.value;n[d.y][d.x]=qle.DEAD_WHITE}}catch(y){f.e(y)}finally{f.f()}break;default:aV.expectToBe(r.color,qle.BLACK),i[1]+=2*r.blackCoords.length;var v,p=Hg(r.blackCoords);try{for(p.s();!(v=p.n()).done;){var g=v.value;n[g.y][g.x]=qle.DEAD_BLACK}}catch(y){p.e(y)}finally{p.f()}}return new Zle(n,i,t.turn,t.koCoord,t.phase)}},{key:"getGameStatus",value:function(e){var t=e.gameState;return t.phase===jle.FINISHED?t.captured[0]>t.captured[1]?loe.ZERO_WON:t.captured[1]>t.captured[0]?loe.ONE_WON:loe.DRAW:loe.ONGOING}},{key:"isPass",value:function(e){return e.equals(Wle.PASS)}},{key:"isAccept",value:function(e){return e.equals(Wle.ACCEPT)}},{key:"isLegalDeadMarking",value:function(e,t){return n.isOccupied(e.coord,t.getCopiedBoard())&&(t.phase===jle.COUNTING||t.phase===jle.ACCEPT)}},{key:"isLegalNormalMove",value:function(e,t){var r=t.getCopiedBoard();if(n.isKo(e,t))return S7.failure(Xle.ILLEGAL_KO());[jle.COUNTING,jle.ACCEPT].includes(t.phase)&&(t=n.resurrectStones(t));var i=n.getCaptureState(e,t);if(ehe.isCapturing(i))return S7.success(i.capturedCoords);r[e.coord.y][e.coord.x]=t.turn%2==0?qle.BLACK:qle.WHITE;var a=0===(new Qle).getGroupDatas(e.coord,r).emptyCoords.length;return r[e.coord.y][e.coord.x]=qle.EMPTY,a?S7.failure(Xle.CANNOT_COMMIT_SUICIDE()):S7.success([])}},{key:"isOccupied",value:function(e,t){return t[e.y][e.x].isOccupied()}},{key:"isKo",value:function(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}},{key:"getCaptureState",value:function(e,t){oV(n.VERBOSE||!1,{getCaptureState:{move:e,state:t}});var r,i,a=new ehe,o=Hg(Fae.ORTHOGONALS);try{for(o.s();!(i=o.n()).done;){var s=i.value;(r=n.getCapturedInDirection(e.coord,s,t)).length>0&&a.capturedCoords.every(function(e){return!r[0].equals(e)})&&(a.capturedCoords=a.capturedCoords.concat(r))}}catch(u){o.e(u)}finally{o.f()}return a}},{key:"getCapturedInDirection",value:function(e,t,r){var i=r.getCopiedBoard(),a=e.getNext(t);if(a.isInRange(r.board[0].length,r.board.length)&&i[a.y][a.x]===(r.turn%2==0?qle.WHITE:qle.BLACK)){oV(n.VERBOSE||!1,"a group could be captured");var o=(new Qle).getGroupDatas(a,i);if(n.isCapturableGroup(o,r.koCoord))return oV(n.VERBOSE||!1,{neightbooringGroupCoord:o.getCoords(),message:"is capturable"}),o.getCoords()}return[]}},{key:"isCapturableGroup",value:function(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}},{key:"getTerritoryLikeGroup",value:function(e){return n.getEmptyZones(e).filter(function(e){return e.isMonoWrapped()})}},{key:"applyPass",value:function(e){var t,r,i=e.getCopiedBoard(),a=e.getCapturedCopy(),o=e.turn;return e.phase===jle.PASSED?(t=jle.COUNTING,r=new Zle(i,a,o+1,lV.empty(),t),r=n.markTerritoryAndCount(r)):(M7(e.phase===jle.PLAYING,"Cannot pass in counting phase!"),t=jle.PASSED,r=new Zle(i,a,o+1,lV.empty(),t)),r}},{key:"applyLegalAccept",value:function(e){var t,n=e.getCopiedBoard();return t=e.phase===jle.COUNTING?jle.ACCEPT:jle.FINISHED,new Zle(n,e.getCapturedCopy(),e.turn+1,lV.empty(),t)}},{key:"applyNormalLegalMove",value:function(e,t,r){var i;oV(n.VERBOSE,{applyNormalLegal:{currentState:e,legalMove:t,status:status}}),i=[jle.COUNTING,jle.ACCEPT].includes(e.phase)?n.resurrectStones(e):e.copy();var a=t.coord.x,o=t.coord.y,s=i.getCopiedBoard(),u=i.turn,c=qle.ofPlayer(i.getCurrentPlayer()),l=u+1;s[o][a]=c;var h,f=Hg(r);try{for(f.s();!(h=f.n()).done;){var d=h.value;s[d.y][d.x]=qle.EMPTY}}catch(g){f.e(g)}finally{f.f()}var v=n.getNewKo(t,s,r),p=i.getCapturedCopy();return p[c.player.value]+=r.length,new Zle(s,p,l,v,jle.PLAYING)}},{key:"resurrectStones",value:function(e){for(var t=0;t<e.board.length;t++)for(var r=0;r<e.board[0].length;r++)e.getPieceAtXY(r,t).isDead()&&(e=n.switchAliveness(new Bae(r,t),e));return n.removeAndSubstractTerritory(e)}},{key:"applyDeadMarkingMove",value:function(e,t){oV(n.VERBOSE,{applyDeadMarkingMove:{legalMove:e,state:t}});var r=n.removeAndSubstractTerritory(t),i=n.switchAliveness(e.coord,r),a=new Zle(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,lV.empty(),jle.COUNTING);return n.markTerritoryAndCount(a)}}]),n}(hoe);return e.VERBOSE=!1,e}(),ehe=function(){function e(){Wg(this,e),this.capturedCoords=[]}return jg(e,null,[{key:"isCapturing",value:function(e){return e.capturedCoords.length>0}}]),e}(),the=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){oV(Jle.VERBOSE||!1,"GoRules.getListMoves");var t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===jle.PLAYING||t.phase===jle.PASSED)return n.push(Wle.PASS),n;oV(Jle.VERBOSE||!1,"GoRules.getListMoves in counting phase");var r=this.getCountingMovesList(t);return 0===r.length?[Wle.ACCEPT]:r}},{key:"getPlayingMovesList",value:function(e){for(var t,n=[],r=0;r<e.board.length;r++)for(var i=0;i<e.board[0].length;i++)t=new Wle(i,r),e.getPieceAt(t.coord)===qle.EMPTY&&Jle.isLegal(t,e).isSuccess()&&n.push(t);return n}},{key:"getCountingMovesList",value:function(e){var t,n=[],r=this.getCorrectBoard(e).getCopiedBoard(),i=Hg(Jle.getGroupsDatasWhere(r,function(e){return e!==qle.EMPTY}));try{for(i.s();!(t=i.n()).done;){var a=t.value.getCoords()[0],o=r[a.y][a.x];if(e.getPieceAt(a)!==o){var s=new Wle(a.x,a.y);return n.push(s),n}}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"getCorrectBoard",value:function(e){var t=this.mapBoard(e.getCopiedBoard(),function(e){return e===qle.BLACK?qle.DEAD_BLACK:e===qle.WHITE?qle.DEAD_WHITE:e.isTerritory()?qle.EMPTY:e}),n=new Zle(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=Jle.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}},{key:"mapBoard",value:function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}},{key:"setAliveUniqueWrapper",value:function(e,t){var n,r=e.copy(),i=Hg(t);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=Hg(o.deadBlackCoords.concat(o.deadWhiteCoords));try{for(s.s();!(a=s.n()).done;){var u=a.value;r.isDead(u)&&(r=Jle.switchAliveness(u,r))}}catch(c){s.e(c)}finally{s.f()}}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=Jle.getGameStatus(e);if(n.isEndGame)return new Kae(n.toBoardValue());oV(Jle.VERBOSE||!1,"GoRules.getBoardValue");var r=Jle.markTerritoryAndCount(t),i=r.getCapturedCopy(),a=this.getDeadStones(r);return new Kae(i[1]+2*a[0]-(i[0]+2*a[1]))}},{key:"getDeadStones",value:function(e){for(var t=[0,0],n=0;n<e.board.length;n++)for(var r=0;r<e.board[0].length;r++){var i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}]),n}(Yae),nhe=qle.WHITE,rhe=qle.BLACK,ihe=qle.DEAD_WHITE,ahe=qle.WHITE_TERRITORY,ohe=qle.BLACK_TERRITORY,she=qle.EMPTY,uhe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Vi||(Vi=wg(["Preliminary information"]))),$localize(zi||(zi=wg(["The game of Go is played on a board called a Goban, and the stones are placed on the intersections.\n        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.\n        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).\n        For this tutorial, we will use a smaller board for pedagogical purposes."]))),Zle.getInitialState()),poe.informational($localize(Hi||(Hi=wg(["Goal of the game"]))),$localize(Gi||(Gi=wg(["The goal of the game is to have the most points at the end of the game.\n        We call \"territories\" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.\n        Here, Dark has 9 territories on the left, and Light has 8 on the right.\n        The top part belongs to no one.\n        Each player's score at the end of the game is the sum of that player's territories and captures."]))),new Zle([[she,rhe,she,she,nhe,nhe],[she,rhe,she,she,nhe,she],[she,rhe,rhe,nhe,nhe,she],[she,she,rhe,nhe,she,she],[she,she,rhe,nhe,she,she],[she,she,rhe,nhe,she,she]],[0,0],0,lV.empty(),jle.PLAYING)),poe.fromMove($localize($i||($i=wg(["Simple capture"]))),$localize(Wi||(Wi=wg(["An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).\n        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.\n        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>\n        The light piece only has one liberty left, play there."]))),new Zle([[she,she,she,she,she],[she,she,rhe,she,she],[she,rhe,nhe,she,she],[she,she,rhe,she,she],[she,she,she,she,she]],[0,0],0,lV.empty(),jle.PLAYING),[new Wle(3,2)],$localize(qi||(qi=wg(["Congratulations, you have earned one point."]))),$localize(ji||(ji=wg(["Failed, try again by playing on one of the intersections directly next to the light stone."])))),poe.fromMove($localize(Zi||(Zi=wg(["Capturing multiple stones"]))),$localize(Yi||(Yi=wg(["Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>\n        The light group here only has one liberty left, capture it."]))),new Zle([[she,rhe,she,she,she],[rhe,nhe,she,she,she],[rhe,nhe,nhe,rhe,she],[she,rhe,rhe,she,she],[she,she,she,she,she]],[0,0],0,lV.empty(),jle.PLAYING),[new Wle(2,1)],$localize(Ki||(Ki=wg(["Congratulations, you have earned three points and formed a territory."]))),$localize(Qi||(Qi=wg(["Failed, you have not captured the group. Play on the last liberty of that group."])))),poe.informational($localize(Xi||(Xi=wg(["Suicide"]))),$localize(Ji||(Ji=wg(["In Go, suicide is forbidden.\n        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.\n        Here, the top left intersection is a suicide for Light.\n        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player."]))),new Zle([[she,rhe,she,she,she],[rhe,she,she,she,she],[rhe,she,she,she,nhe],[nhe,rhe,she,nhe,she],[she,nhe,she,nhe,rhe]],[0,0],0,lV.empty(),jle.PLAYING)),poe.informational($localize(ea||(ea=wg(["Life and death (death)"]))),$localize(ta||(ta=wg(["From the capture rule follows the life and death notion:\n        dead stones are stones that are definitely capturable (without losing anything else).\n        Alive stones are stones that can never be captured.\n        From the capture rule, Dark can play inside Light's territory and make a capture.\n        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).\n        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories."]))),new Zle([[she,she,she,she,she],[rhe,rhe,rhe,she,she],[nhe,nhe,rhe,she,she],[she,nhe,rhe,she,she],[nhe,nhe,rhe,she,she]],[0,0],0,lV.empty(),jle.PLAYING)),poe.informational($localize(na||(na=wg(["Life and death (eyes)"]))),$localize(ra||(ra=wg(["Here, Light cannot play on the top left, nor on the bottom left.\n        Light will never be able to capture Dark.\n        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive."]))),new Zle([[she,rhe,nhe,she,she],[nhe,rhe,nhe,she,she],[rhe,rhe,nhe,she,she],[nhe,rhe,nhe,she,she],[she,rhe,nhe,she,she]],[0,0],0,lV.empty(),jle.PLAYING)),poe.informational($localize(ia||(ia=wg(["Seki"]))),$localize(aa||(aa=wg(["If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.\n        Similarly, if Light plays on the middle line, Dark will capture Light.\n        In other words, there is no point in playing on the middle line.\n        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral."]))),new Zle([[she,nhe,rhe,she,nhe,rhe,she],[she,nhe,rhe,rhe,nhe,rhe,she],[she,nhe,rhe,rhe,nhe,rhe,she],[she,nhe,rhe,rhe,nhe,rhe,she],[she,nhe,rhe,nhe,nhe,rhe,she],[she,nhe,rhe,nhe,nhe,rhe,she],[she,nhe,rhe,she,nhe,rhe,she]],[0,0],0,lV.empty(),jle.PLAYING)),poe.fromMove($localize(oa||(oa=wg(["Ko"]))),$localize(sa||(sa=wg(["A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>\n        Capture the light stone."]))),new Zle([[she,she,she,she,she,she,she],[she,she,she,she,she,she,she],[she,she,she,rhe,nhe,she,she],[she,she,rhe,nhe,she,nhe,she],[she,she,she,rhe,nhe,she,she],[she,she,she,she,she,she,she],[she,she,she,she,she,she,she]],[0,0],0,lV.empty(),jle.PLAYING),[new Wle(4,3)],$localize(ua||(ua=wg(["Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.\n        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.\n        This rule is called the Ko.\n        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after."]))),$localize(ca||(ca=wg(["Failed!"])))),poe.fromMove($localize(la||(la=wg(["End of the game"]))),$localize(ha||(ha=wg(["When a player feels that there is no advantage to putting a new stone, that player can pass a turn.\n        The game phase stops when both players pass consecutively, and we move on to the counting phase.\n        The dead groups are then marked by clicking on them.\n        Every intersection in a player's territory earns that player a point.\n        The winner is the one with most points.<br/><br/>\n        A last stone is dead, mark it."]))),new Zle([[nhe,rhe,rhe,rhe,rhe,rhe,ohe,ohe,ohe],[nhe,nhe,nhe,nhe,rhe,rhe,rhe,ohe,ohe],[nhe,ahe,nhe,nhe,rhe,ihe,ihe,rhe,ohe],[rhe,nhe,nhe,nhe,nhe,rhe,ohe,ohe,ohe],[she,nhe,ahe,nhe,rhe,rhe,ihe,rhe,ohe],[nhe,ahe,nhe,nhe,rhe,rhe,rhe,rhe,rhe],[nhe,nhe,rhe,rhe,rhe,nhe,nhe,rhe,nhe],[rhe,rhe,rhe,nhe,nhe,nhe,ahe,nhe,nhe],[ohe,ohe,rhe,rhe,rhe,nhe,nhe,ahe,ahe]],[0,0],0,lV.empty(),jle.COUNTING),[new Wle(0,3)],$localize(fa||(fa=wg(["Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.\n        The intersections where the prisoners are count as Dark's territory\n        Light has 8 territories and 1 prisoner.\n        The end result is therefore 18 - 9 for Dark."]))),$localize(da||(da=wg(["Failed, try again."]))))]});function che(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS(2).index,r=hS().index;$E("cx",25+50*n)("cy",25+50*r)("r",22)}}function lhe(e,t){if(1&e){var n=aS();c_(),eS(0,"line",11),uS("click",function(){Nk(n);var e=hS(2).index,t=hS().index;return hS().onClick(e,t)}),tS()}if(2&e){var r=hS(2).index,i=hS().index;$E("x1",50*r)("y1",50*i)("x2",50+50*r)("y2",50+50*i)}}function hhe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",7),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onClick(e,t)}),tS(),YE(2,che,1,3,"circle",8),YE(3,lhe,1,4,"line",9),tS()}if(2&e){var r=hS().index,i=hS().index,a=hS();pb(1),XE("ngClass",a.getSpaceClass(r,i)),$E("cx",25+50*r)("cy",25+50*i)("r",22),pb(1),XE("ngIf",a.isLastCase(r,i)),pb(1),XE("ngIf",a.isDead(r,i))}}function fhe(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",15),uS("click",function(){Nk(n);var e=hS(2).index,t=hS().index;return hS().onClick(e,t)}),tS()}if(2&e){var r=hS(2),i=r.index,a=r.$implicit,o=hS().index,s=hS();$E("cx",25+50*i)("cy",25+50*o)("r",10)("class",a===s.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function dhe(e,t){if(1&e){var n=aS();c_(),eS(0,"rect",12),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onClick(e,t)}),tS(),eS(1,"line",13),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onClick(e,t)}),tS(),eS(2,"line",13),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().onClick(e,t)}),tS(),YE(3,fhe,1,4,"circle",14)}if(2&e){var r=hS().index,i=hS().index,a=hS();vS("id","click_",r,"_",i,""),$E("x",50*r)("y",50*i),pb(1),$E("x1",50*r)("y1",25+50*i)("x2",50+50*r)("y2",25+50*i),pb(1),$E("x1",25+50*r)("y1",50*i)("x2",25+50*r)("y2",50+50*i),pb(1),XE("ngIf",a.isTerritory(r,i))}}function vhe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,hhe,4,6,"g",5),YE(2,dhe,4,13,"ng-template",null,6,RT),tS()),2&e){var n=t.index,r=KE(3),i=hS().index,a=hS();pb(1),XE("ngIf",a.caseIsFull(n,i))("ngIfElse",r)}}function phe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,vhe,4,2,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function ghe(e,t){if(1&e&&(c_(),nS(0,"rect",16)),2&e){var n=hS();$E("x",12.5+50*n.ko.get().x)("y",12.5+50*n.ko.get().y)}}function yhe(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",17),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.x,e.y)}),tS()}if(2&e){var r=t.$implicit;$E("cx",25+50*r.x)("cy",25+50*r.y)("r",7)}}var mhe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).ko=lV.empty(),r.last=lV.empty(),r.captures=[],r.GoPiece=qle,r.scores=lV.of([0,0]),r.rules=new Jle(Zle),r.availableMinimaxes=[new the(r.rules,"GoMinimax")],r.encoder=Wle.encoder,r.tutorial=(new uhe).tutorial,r.canPass=!0,r.updateBoard(),r}return jg(n,[{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return n.last=lV.empty(),a=new Wle(e,t),r.abrupt("return",n.chooseMove(a,n.rules.node.gameState,n.scores.get()));case 6:case"end":return r.stop()}},r)}))()}},{key:"updateBoard",value:function(){oV(n.VERBOSE,"updateBoard");var e=this.rules.node.gameState,t=this.rules.node.move,r=e.phase;this.board=e.getCopiedBoard(),this.scores=lV.of(e.getCapturedCopy()),this.ko=e.koCoord,t.isPresent()?this.showCaptures():this.captures=[],this.last=t.map(function(e){return e.coord}),this.canPass=r!==jle.FINISHED}},{key:"showCaptures",value:function(){var e=this.rules.node.mother.get().gameState;this.captures=[];for(var t=0;t<this.board.length;t++)for(var n=0;n<this.board[0].length;n++){var r=new Bae(n,t),i=!1===e.getPieceAt(r).isEmpty(),a=this.board[t][n]===qle.EMPTY,o=!1===this.ko.equalsValue(r);i&&a&&o&&this.captures.push(r)}}},{key:"pass",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.rules.node.gameState.phase,t.abrupt("return",n===jle.PLAYING||n===jle.PASSED?e.onClick(Wle.PASS.coord.x,Wle.PASS.coord.y):(M7(n===jle.COUNTING||n===jle.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(Wle.ACCEPT.coord.x,Wle.ACCEPT.coord.y)));case 2:case"end":return t.stop()}},t)}))()}},{key:"getSpaceClass",value:function(e,t){var n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}},{key:"caseIsFull",value:function(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==qle.EMPTY&&!this.isTerritory(e,t)}},{key:"isLastCase",value:function(e,t){if(this.last.isPresent()){var n=this.last.get();return e===n.x&&t===n.y}return!1}},{key:"isDead",value:function(e,t){return this.rules.node.gameState.isDead(new Bae(e,t))}},{key:"isTerritory",value:function(e,t){return this.rules.node.gameState.isTerritory(new Bae(e,t))}}]),n}(Koe);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-go"]],features:[xE],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),nS(1,"rect",1),YE(2,phe,2,1,"g",2),YE(3,ghe,1,2,"rect",3),YE(4,yhe,1,3,"circle",4),tS()),2&e&&($E("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),pb(1),$E("width",50*t.board.length)("height",50*t.board.length),pb(1),XE("ngForOf",t.board),pb(1),XE("ngIf",t.ko.isPresent()),pb(1),XE("ngForOf",t.captures))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),khe=function(){function e(t,n,r){Wg(this,e),this.value=t,this.name=n,this.rgb=r}return jg(e,null,[{key:"of",value:function(t){switch(t){case 0:return e.ANY;case 1:return e.ORANGE;case 2:return e.BLUE;case 3:return e.PURPLE;case 4:return e.PINK;case 5:return e.YELLOW;case 6:return e.RED;case 7:return e.GREEN;default:return aV.expectToBe(t,8,"Invalid value "+t+" for KamisadoColor"),e.BROWN}}}]),e}();khe.ANY=new khe(0,"any","#000"),khe.ORANGE=new khe(1,"orange","#d67421"),khe.BLUE=new khe(2,"blue","#006bac"),khe.PURPLE=new khe(3,"purple","#6f3787"),khe.PINK=new khe(4,"pink","#d2719e"),khe.YELLOW=new khe(5,"yellow","#e2c200"),khe.RED=new khe(6,"red","#d23339"),khe.GREEN=new khe(7,"green","#009157"),khe.BROWN=new khe(8,"brown","#562500");var _he=function(){function e(t,n){Wg(this,e),this.player=t,this.color=n}return jg(e,[{key:"equals",value:function(e){return e.player===this.player&&e.color===this.color}},{key:"isEmpty",value:function(){return this.player.equals(Mre.NONE)}},{key:"belongsTo",value:function(e){return this.player===e}}],[{key:"of",value:function(t,n){return new e(t,khe.of(n))}},{key:"createPlayerColors",value:function(t){return{ORANGE:new e(t,khe.ORANGE),BLUE:new e(t,khe.BLUE),PURPLE:new e(t,khe.PURPLE),PINK:new e(t,khe.PINK),YELLOW:new e(t,khe.YELLOW),RED:new e(t,khe.RED),GREEN:new e(t,khe.GREEN),BROWN:new e(t,khe.BROWN)}}}]),e}();_he.EMPTY=new _he(Mre.NONE,khe.ANY),_he.ZERO=_he.createPlayerColors(Nre.ZERO),_he.ONE=_he.createPlayerColors(Nre.ONE);var Che=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getColorAt",value:function(t,n){return e.COLORS[n][t]}},{key:"getInitialBoard",value:function(){var e=_he.EMPTY;return[[1,2,3,4,5,6,7,8].map(function(e){return _he.of(Nre.ONE,e)}),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(function(e){return _he.of(Nre.ZERO,e)})]}},{key:"isEmptyAt",value:function(e,t){return e[t.y][t.x].equals(_he.EMPTY)}},{key:"allPieceCoords",value:function(t){for(var n=[],r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++){var a=new Bae(i,r);e.isEmptyAt(t,a)||n.push(a)}return n}}]),e}();Che.INITIAL=Che.getInitialBoard(),Che.SIZE=8,Che.COLORS=Ure.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],khe.of);var whe=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"equals",value:function(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}},{key:"toString",value:function(){return this===n.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}],[{key:"of",value:function(e,t){if(e.isNotInRange(Che.SIZE,Che.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(Che.SIZE,Che.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new n(e,t)}}]),n}(ose);whe.PASS=new whe(new Bae(-2,-2),new Bae(-3,-3)),whe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 34952}},{key:"encodeNumber",value:function(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}},{key:"decodeNumber",value:function(e){if(e<0)return whe.PASS;var t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new whe(new Bae((e=e/16|0)%16,r),new Bae(n,t))}}]),n}(xre));var bhe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o){var s;return Wg(this,n),(s=t.call(this,Ure.copyBiArray(o),e)).colorToPlay=r,s.coordToPlay=i,s.alreadyPassed=a,s}return jg(n,null,[{key:"getInitialState",value:function(){return new n(0,khe.ANY,lV.empty(),!1,Che.INITIAL)}}]),n}(eoe),Ehe=function(){var e=jg(function e(){Wg(this,e)});return e.NOT_RIGHT_COLOR=function(){return $localize(va||(va=wg(["This piece is not of the color you have to play."])))},e.DIRECTION_NOT_ALLOWED=function(){return $localize(pa||(pa=wg(["You can only move forward, orthogonally or diagonally."])))},e.MOVE_BLOCKED=function(){return $localize(ga||(ga=wg(["This move is blocked by another piece."])))},e.PLAY_WITH_SELECTED_PIECE=function(){return $localize(ya||(ya=wg(["You must play with the selected piece."])))},e}(),She=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"nextCoordToPlay",value:function(e,t){return lV.ofNullable(Che.allPieceCoords(e.board).find(function(n){var r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}},{key:"applyLegalMove",value:function(e,t,n){if(e===whe.PASS){var r=this.nextCoordToPlay(t,t.colorToPlay);return new bhe(t.turn+1,t.colorToPlay,r,!0,t.board)}var i=e.coord,a=e.end,o=t.getCopiedBoard();o[a.y][a.x]=o[i.y][i.x],o[i.y][i.x]=_he.EMPTY;var s=Che.getColorAt(a.x,a.y),u=this.nextCoordToPlay(t,s);return new bhe(t.turn+1,s,u,!1,o)}},{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"getGameStatus",value:function(e){var t=e.gameState,r=t.getCurrentPlayer();if(n.mustPass(t)&&t.alreadyPassed)return loe.getDefeat(r);var i=Pg(n.getFurthestPiecePositions(t),2),a=i[0];return 7===i[1]?loe.ONE_WON:0===a?loe.ZERO_WON:loe.ONGOING}}],[{key:"getColorMatchingPiece",value:function(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new Bae(0,7),new Bae(1,7),new Bae(2,7),new Bae(3,7),new Bae(4,7),new Bae(5,7),new Bae(6,7),new Bae(7,7)]}},{key:"getMovablePieces",value:function(e){var t=this;return n.getColorMatchingPiece(e).filter(function(n){var r,i=Hg(t.playerDirections(e.getCurrentPlayer()));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=n.getNext(a);if(e.isOnBoard(o)&&Che.isEmptyAt(e.board,o))return!0}}catch(s){i.e(s)}finally{i.f()}return!1})}},{key:"playerDirections",value:function(e){return e===Nre.ONE?[Lae.DOWN,Lae.DOWN_LEFT,Lae.DOWN_RIGHT]:[Lae.UP,Lae.UP_LEFT,Lae.UP_RIGHT]}},{key:"directionAllowedForPlayer",value:function(e,t){return t===Nre.ZERO?e.y<0:e.y>0}},{key:"getListMovesFromState",value:function(e){var t=n.getMovablePieces(e);return 0===t.length?(M7(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[whe.PASS]):n.getListMovesFromNonBlockedState(e,t)}},{key:"getListMovesFromNonBlockedState",value:function(e,t){var r,i=[],a=e.getCurrentPlayer(),o=Hg(t);try{for(o.s();!(r=o.n()).done;){var s,u=r.value,c=Hg(n.playerDirections(a));try{for(c.s();!(s=c.n()).done;)for(var l=s.value,h=1;h<Che.SIZE;h++){var f=u.getNext(l,h);if(!e.isOnBoard(f)||!Che.isEmptyAt(e.board,f))break;var d=whe.of(u,f);i.push(d)}}catch(v){c.e(v)}finally{c.f()}}}catch(v){o.e(v)}finally{o.f()}return i}},{key:"mustPass",value:function(e){return 0===this.getMovablePieces(e).length}},{key:"getFurthestPiecePositions",value:function(e){var t=7,n=0;return Che.allPieceCoords(e.board).forEach(function(r){var i=e.getPieceAt(r);M7(i!==_he.EMPTY,"allPieceCoords failed to filter KamisadoPiece.EMPTY"),i.player===Nre.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}},{key:"isLegal",value:function(e,t){var r=e.coord,i=e.end,a=t.colorToPlay;if(e===whe.PASS)return this.isLegalPass(t);if(n.isVictory(t))return S7.failure("You should never see this message");var o=t.getPieceAt(r);if(!o.belongsTo(t.getCurrentPlayer()))return S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE());if(a!==khe.ANY&&o.color!==a)return S7.failure(Ehe.NOT_RIGHT_COLOR());if(!t.getPieceAt(i).isEmpty())return S7.failure(Zae.MUST_CLICK_ON_EMPTY_SPACE());var s=Lae.factory.fromMove(r,i);if(s.isFailure())return S7.failure(Ehe.DIRECTION_NOT_ALLOWED());var u=s.get();if(!n.directionAllowedForPlayer(u,t.getCurrentPlayer()))return S7.failure(Ehe.DIRECTION_NOT_ALLOWED());for(var c=r;!c.equals(i);)if(c=c.getNext(u),!t.getPieceAt(c).isEmpty())return S7.failure(Ehe.MOVE_BLOCKED());return S7.success(void 0)}},{key:"isLegalPass",value:function(e){return this.mustPass(e)&&!e.alreadyPassed?S7.success(void 0):S7.failure(Zae.CANNOT_PASS())}},{key:"isVictory",value:function(e){var t=Pg(this.getFurthestPiecePositions(e),2),n=t[0],r=t[1];return 0===n||7===r}}]),n}(hoe),Phe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=She.getListMovesFromState(e.gameState);return Ure.sortByDescending(t,function(e){return e.length()}),t}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=t.getCurrentPlayer();if(She.mustPass(t)&&t.alreadyPassed)return new Kae(n.getDefeatValue());var r=Pg(She.getFurthestPiecePositions(t),2),i=r[0],a=r[1];return new Kae(7===a?Nre.ONE.getVictoryValue():0===i?Nre.ZERO.getVictoryValue():a-(7-i))}}]),n}(Yae),Ohe=_he.EMPTY,The=_he.ZERO.ORANGE,Ihe=_he.ONE.ORANGE,Ahe=_he.ZERO.BLUE,xhe=_he.ONE.BLUE,Rhe=_he.ZERO.PURPLE,Mhe=_he.ONE.PURPLE,Nhe=_he.ZERO.PINK,Dhe=_he.ONE.PINK,Lhe=_he.ZERO.YELLOW,Fhe=_he.ONE.YELLOW,Uhe=_he.ZERO.RED,Bhe=_he.ONE.RED,Vhe=_he.ZERO.GREEN,zhe=_he.ONE.GREEN,Hhe=_he.ZERO.BROWN,Ghe=_he.ONE.BROWN,$he=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(ma||(ma=wg(["Goal of the game"]))),$localize(ka||(ka=wg(["At Kamisado, there are two ways to win the game:\n        either by moving one of your pieces on the opponent's starting line,\n        or by forcing the opponent to make a move that blocks the entire game.\n        Here, Dark wins because its brown piece is on Light's starting line, on the top left."]))),new bhe(5,khe.ORANGE,lV.empty(),!1,[[Hhe,xhe,Mhe,Dhe,Fhe,Bhe,zhe,Ghe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ihe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Vhe,Uhe,Lhe,Nhe,Rhe,Ahe,The]])).withPreviousMove(whe.of(new Bae(0,7),new Bae(0,0))),poe.anyMove($localize(_a||(_a=wg(["Initial board and initial move"]))),$localize(Ca||(Ca=wg(["Here is the initial board.\n        At Kamisado, pieces can only move forward, vertically or diagonally.\n        You're playing first, with dark pieces, you can make your first move.<br/><br/>\n        Click on the piece of your choice and click on the landing square."]))),bhe.getInitialState(),whe.of(new Bae(7,7),new Bae(3,3)),$localize(wa||(wa=wg(["Perfect! Note that each of your piece has a different color."])))),poe.fromMove($localize(ba||(ba=wg(["Moving"]))),$localize(Ea||(Ea=wg(["Let us now consider the move of Light, after the blue piece has been moved by Dark.\n        All moves after the initial move must be made from the piece that corresponds to the color\n        of the square upon which the last move ended.\n        Here, the last move ended on the pink square, hence the pink piece must move.\n        It is already selected, you do not have to click on it.<br/><br/>\n        Move it on a blue square."]))),new bhe(1,khe.PINK,lV.of(new Bae(3,0)),!1,[[Ihe,xhe,Mhe,Dhe,Fhe,Bhe,zhe,Ghe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ahe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Hhe,Vhe,Uhe,Lhe,Nhe,Rhe,Ohe,The]]),[whe.of(new Bae(3,0),new Bae(3,6)),whe.of(new Bae(3,0),new Bae(4,1))],$localize(Sa||(Sa=wg(["Congratulations!"]))),$localize(Pa||(Pa=wg(["You have not moved your pink piece on a blue square!"])))).withPreviousMove(whe.of(new Bae(6,7),new Bae(6,5))),poe.informational($localize(Oa||(Oa=wg(["Stuck situation"]))),$localize(Ta||(Ta=wg(["Dark moved to another pink square, hence you have to move your pink piece again.\n        However, your pink piece is stuck! In this case, you must pass your turn.\n        Dark will now have to play by moving its pink piece."]))),new bhe(1,khe.PINK,lV.of(new Bae(3,6)),!1,[[Ihe,xhe,Mhe,Ohe,Fhe,Bhe,zhe,Ghe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ahe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Dhe,Ohe,Ohe,Ohe,Ohe],[Hhe,Vhe,Uhe,Lhe,Nhe,Rhe,Ohe,The]])).withPreviousMove(whe.of(new Bae(6,5),new Bae(7,4))),poe.fromMove($localize(Ia||(Ia=wg(["Victory by blocking"]))),$localize(Aa||(Aa=wg(["At any time, if a player blocks the entire game, that player loses.\n        In other words, if a player forces its opponent to move a piece that the opponent cannot move,\n        and the player cannot move its own piece of the same color, then that player loses.\n        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>\n        Try to make this move."]))),new bhe(2,khe.RED,lV.of(new Bae(2,4)),!1,[[Ohe,xhe,Mhe,Ohe,Ohe,Bhe,Ohe,Ohe],[Ohe,Ohe,Ohe,Fhe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Dhe,Ohe,Mhe,Ohe,Ohe],[Ohe,Ohe,Ohe,Lhe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Uhe,Ohe,Ohe,Ohe,Ohe,Ohe],[Ohe,Ohe,Ohe,Ohe,Ohe,Ohe,zhe,Ohe],[Ihe,Ohe,Ohe,Ohe,Ohe,Nhe,Ohe,Ghe],[Hhe,Vhe,Ohe,Ohe,Ohe,Ohe,Ahe,The]]),[whe.of(new Bae(2,4),new Bae(0,2))],$localize(xa||(xa=wg(["Perfect!\n         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.\n         Your orange piece will be stuck and you will have to pass your turn.\n         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.\n         In this case, the last player to have moved a piece loses.\n         Here, your opponent will have moved its green piece last, you therefore win!"]))),$localize(Ra||(Ra=wg(["Failed!"])))).withPreviousMove(whe.of(new Bae(4,0),new Bae(3,1)))]});function Whe(e,t){if(1&e&&(c_(),nS(0,"circle",8)),2&e){var n=hS(),r=n.index,i=n.$implicit,a=hS().index,o=hS();$E("cx",o.SPACE_SIZE/2+r*o.SPACE_SIZE)("cy",o.SPACE_SIZE/2+a*o.SPACE_SIZE)("fill",o.pieceColor(i))("r",o.SPACE_SIZE/2-o.STROKE_WIDTH)}}function qhe(e,t){if(1&e&&(c_(),nS(0,"rect",9)),2&e){var n=hS(),r=n.$implicit,i=n.index,a=hS().index,o=hS();XE("ngClass",o.piecePlayerClass(r)),$E("x",o.SPACE_SIZE/2+i*o.SPACE_SIZE-o.SPACE_SIZE/8)("y",o.SPACE_SIZE/2+a*o.SPACE_SIZE-o.SPACE_SIZE/8)("rx",o.isPlayerZero(r)?o.SPACE_SIZE:0)("ry",o.isPlayerZero(r)?o.SPACE_SIZE:0)("width",o.SPACE_SIZE/4)("height",o.SPACE_SIZE/4)}}function jhe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"g",4),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),nS(2,"rect",5),YE(3,Whe,1,4,"circle",6),YE(4,qhe,1,7,"rect",7),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","click_",i,"_",a,""),pb(1),$E("x",i*o.SPACE_SIZE)("y",a*o.SPACE_SIZE)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE)("fill",o.backgroundColor(i,a)),pb(1),XE("ngIf",r!==o.UNOCCUPIED),pb(1),XE("ngIf",r!==o.UNOCCUPIED)}}function Zhe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,jhe,5,9,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Yhe(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"rect",10),nS(2,"rect",10),tS()),2&e){var n=hS();pb(1),$E("x",n.lastMove.get().coord.x*n.SPACE_SIZE)("y",n.lastMove.get().coord.y*n.SPACE_SIZE)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE),pb(1),$E("x",n.lastMove.get().end.x*n.SPACE_SIZE)("y",n.lastMove.get().end.y*n.SPACE_SIZE)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function Khe(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS();$E("cx",n.SPACE_SIZE/2+n.chosen.get().x*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+n.chosen.get().y*n.SPACE_SIZE)}}var Qhe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).UNOCCUPIED=_he.EMPTY,r.lastMove=lV.empty(),r.chosen=lV.empty(),r.chosenAutomatically=!1,r.rules=new She(bhe),r.availableMinimaxes=[new Phe(r.rules,"KamisadoMinimax")],r.encoder=whe.encoder,r.tutorial=(new $he).tutorial,r.canPass=!1,r.updateBoard(),r}return jg(n,[{key:"backgroundColor",value:function(e,t){return Che.getColorAt(e,t).rgb}},{key:"isPlayerZero",value:function(e){return e.player===Nre.ZERO}},{key:"pieceColor",value:function(e){return e.color.rgb}},{key:"piecePlayerClass",value:function(e){return this.getPlayerClass(e.player)}},{key:"updateBoard",value:function(){var e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=She.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=lV.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}},{key:"pass",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(M7(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(whe.PASS,e.rules.node.gameState)));case 1:case"end":return t.stop()}},t)}))()}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(a=new Bae(e,t),!n.canPass){r.next=6;break}return r.abrupt("return",n.cancelMove(Zae.MUST_PASS()));case 6:if(!n.chosen.isAbsent()){r.next=8;break}return r.abrupt("return",n.choosePiece(e,t));case 8:if(!1!==n.chosenAutomatically||!n.chosen.equalsValue(a)){r.next=10;break}return r.abrupt("return",(n.cancelMoveAttempt(),T7.SUCCESS));case 10:if(o=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer(),!o.belongsTo(s)){r.next=15;break}r.t0=n.chosenAutomatically?n.cancelMove(Ehe.PLAY_WITH_SELECTED_PIECE()):(n.chosen=lV.of(a),T7.SUCCESS),r.next=18;break;case 15:return r.next=17,n.chooseDestination(e,t);case 17:r.t0=r.sent;case 18:return r.abrupt("return",r.t0);case 19:case"end":return r.stop()}},r)}))()}},{key:"choosePiece",value:function(e,t){var n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=lV.of(new Bae(e,t)),T7.SUCCESS)}},{key:"chooseDestination",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.chosen.get(),a=new Bae(e,t),o=whe.of(i,a),r.abrupt("return",n.chooseMove(o,n.rules.node.gameState));case 2:case"end":return r.stop()}},r)}))()}},{key:"cancelMoveAttempt",value:function(){this.chosenAutomatically||(this.chosen=lV.empty())}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-kamisado"]],features:[xE],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Zhe,2,1,"g",1),YE(2,Yhe,3,8,"g",2),YE(3,Khe,1,2,"circle",3),tS()),2&e&&($E("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),pb(1),XE("ngForOf",t.board),pb(1),XE("ngIf",t.lastMove.isPresent()),pb(1),XE("ngIf",t.chosen.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Xhe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,null,[{key:"getInitialState",value:function(){var e=Mre.NONE,t=Nre.ZERO,r=Nre.ONE;return new n([[e,t,t,t,t,t,t,e],[r,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,r],[r,e,e,e,e,e,e,r],[e,t,t,t,t,t,t,e]],0)}},{key:"isOnBoard",value:function(e){return e.isInRange(n.SIZE,n.SIZE)}}]),n}(eoe);return e.SIZE=8,e}(),Jhe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).direction=i,a.direction=Lae.factory.fromMove(e,r).get(),a}return jg(n,[{key:"equals",value:function(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}},{key:"toString",value:function(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}},{key:"encode",value:function(){return n.encoder.encode(this)}},{key:"decode",value:function(e){return n.encoder.decode(e)}}],[{key:"of",value:function(e,t){var r=Lae.factory.fromMove(e,t);return r.isFailure()?S7.failure(r.getReason()):e.isNotInRange(Xhe.SIZE,Xhe.SIZE)?S7.failure("start coord is not in range"):t.isNotInRange(Xhe.SIZE,Xhe.SIZE)?S7.failure("end coord is not in range"):S7.success(new n(e,t,r.get()))}}]),n}(ose);Jhe.encoder=ose.getEncoder(Xhe.SIZE,Xhe.SIZE,function(e,t){return Jhe.of(e,t).get()});var efe=function(){var e=jg(function e(){Wg(this,e)});return e.INVALID_MOVE_LENGTH=function(){return $localize(Ma||(Ma=wg(["Your move should have a length equal to the number of pieces that exist on the same line."])))},e.CANNOT_JUMP_OVER_OPPONENT=function(){return $localize(Na||(Na=wg(["You cannot jump over the opponent's pieces."])))},e.PIECE_CANNOT_MOVE=function(){return $localize(Da||(Da=wg(["This piece has no possible move, select another one."])))},e.INVALID_DIRECTION=function(){return $localize(La||(La=wg(["A move must be orthogonal or diagonal."])))},e}(),tfe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){var r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=Mre.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new Xhe(r,t.turn+1)}},{key:"isLegal",value:function(e,t){return n.isLegal(e,t)}},{key:"getGameStatus",value:function(e){var t=e.gameState,r=Pg(n.getNumberOfGroups(t),2),i=r[0],a=r[1];return 1===i&&a>1?loe.ZERO_WON:i>1&&1===a?loe.ONE_WON:loe.ONGOING}}],[{key:"getListMovesFromState",value:function(e){var t=[];if(n.getVictory(e).isPresent())return t;for(var r=0;r<Xhe.SIZE;r++)for(var i=0;i<Xhe.SIZE;i++){var a=new Bae(i,r);if(e.getPieceAt(a).isPlayer()){var o,s=Hg(n.possibleTargets(e,a));try{for(s.s();!(o=s.n()).done;){var u=o.value,c=Jhe.of(a,u).get();t.push(c)}}catch(l){s.e(l)}finally{s.f()}}}return t}},{key:"getNumberOfGroups",value:function(e){for(var t=Ure.createTable(Xhe.SIZE,Xhe.SIZE,-1),r=[0,0],i=0,a=0;a<Xhe.SIZE;a++)for(var o=0;o<Xhe.SIZE;o++)if(-1===t[a][o]){var s=e.getPieceAt(new Bae(o,a));s.isPlayer()&&(i+=1,n.markGroupStartingAt(e,t,new Bae(o,a),i),r[s.value]+=1)}return r}},{key:"markGroupStartingAt",value:function(e,t,n,r){for(var i=[n],a=e.getPieceAt(n);i.length>0;){var o=aV.getNonNullable(i.pop());if(-1===t[o.y][o.x]){var s=e.getPieceAt(o);if(s===a){t[o.y][o.x]=r;var u,c=Hg(Lae.DIRECTIONS);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=o.getNext(l);e.isOnBoard(h)&&i.push(h)}}catch(f){c.e(f)}finally{c.f()}}else s===Mre.NONE&&(t[o.y][o.x]=0)}}}},{key:"isLegal",value:function(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?S7.failure(efe.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(function(e){return t.getPieceAt(e)===t.getCurrentOpponent()})?S7.failure(efe.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?S7.failure(Zae.CANNOT_SELF_CAPTURE()):S7.success(void 0)}},{key:"numberOfPiecesOnLine",value:function(e,t,r){var i,a=0,o=Hg(n.getLineCoords(t,r));try{for(o.s();!(i=o.n()).done;){var s=i.value;e.getPieceAt(s).isPlayer()&&(a+=1)}}catch(u){o.e(u)}finally{o.f()}return a}},{key:"getLineCoords",value:function(e,t){for(var r=n.getEntranceAndForwardDirection(e,t),i=r[0],a=r[1],o=[];Xhe.isOnBoard(i);)o.push(i),i=i.getNext(a);return o}},{key:"getEntranceAndForwardDirection",value:function(e,t){switch(t){case Lae.UP:case Lae.DOWN:return[new Bae(e.x,0),Lae.DOWN];case Lae.LEFT:case Lae.RIGHT:return[new Bae(0,e.y),Lae.RIGHT];case Lae.UP_RIGHT:case Lae.DOWN_LEFT:return[new Bae(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),Lae.UP_RIGHT];default:return aV.expectToBeMultiple(t,[Lae.UP_LEFT,Lae.DOWN_RIGHT]),[new Bae(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),Lae.DOWN_RIGHT]}}},{key:"getVictory",value:function(e){var t=Pg(n.getNumberOfGroups(e),2),r=t[0],i=t[1];return 1===r&&1===i?lV.of(Mre.NONE):1===r?lV.of(Nre.ZERO):1===i?lV.of(Nre.ONE):lV.empty()}},{key:"possibleTargets",value:function(e,t){var r,i=[],a=Hg(Lae.DIRECTIONS);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=n.numberOfPiecesOnLine(e,t,o),u=t.getNext(o,s);if(e.isOnBoard(u)){var c=Jhe.of(t,u).get();n.isLegal(c,e).isSuccess()&&i.push(u)}}}catch(l){a.e(l)}finally{a.f()}return i}}]),n}(hoe),nfe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){return tfe.getListMovesFromState(e.gameState)}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=Pg(tfe.getNumberOfGroups(t),2),r=n[0],i=n[1];return new Kae(1===r&&i>1?Nre.ZERO.getVictoryValue():r>1&&1===i?Nre.ONE.getVictoryValue():100/r*Nre.ZERO.getScoreModifier()+100/i*Nre.ONE.getScoreModifier())}}]),n}(Yae),rfe=Mre.NONE,ife=Nre.ZERO,afe=Nre.ONE,ofe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Fa||(Fa=wg(["Goal of the game"]))),$localize(Ua||(Ua=wg(["At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.\n        Here, Dark wins the game:\n        Dark's pieces are forming a single group, while Light's pieces form three groups."]))),new Xhe([[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[afe,rfe,rfe,rfe,ife,rfe,rfe,afe],[rfe,rfe,ife,ife,afe,rfe,rfe,rfe],[rfe,rfe,rfe,ife,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe]],0)),poe.anyMove($localize(Ba||(Ba=wg(["Initial board and initial move"]))),$localize(Va||(Va=wg(["Here is the initial board.\n         Moves can be made orthogonally or diagonally.\n         The length of a move is equal to the number of pieces that are on the line of the move.\n         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>\n         You're playing Dark, make the first move!"]))),Xhe.getInitialState(),Jhe.of(new Bae(1,7),new Bae(1,5)).get(),$localize(za||(za=wg(["Congratulations!"])))),poe.fromMove($localize(Ha||(Ha=wg(["Jumping"]))),$localize(Ga||(Ga=wg(["During a move, it is possible to jump above your own pieces.\n        But it is forbidden to jump over the opponent's pieces.<br/><br/>\n        You're playing Dark, make a jump over one of your pieces on the following board."]))),new Xhe([[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,afe,ife,ife,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,ife]],0),[Jhe.of(new Bae(3,1),new Bae(6,1)).get()],$localize($a||($a=wg(["Congratulations!"]))),$localize(Wa||(Wa=wg(["Failed. You did not jump over one of your pieces."])))),poe.fromMove($localize(qa||(qa=wg(["Moving"]))),$localize(ja||(ja=wg(["Here is a different board. Pick the dark piece in the middle (line 4, column 4)\n        and observe its possible moves.\n        Horizontally, this piece can move only of one square because it is the only piece on this line.\n        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.\n        But it can only go up, as below it the landing square is occupied by one of your pieces.\n        Diagonally, only one move is possible: on the diagonal that contains three pieces,\n        only in the direction where it does not jump over one of the opponent's pieces.\n        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>\n        Make one of these moves."]))),new Xhe([[rfe,rfe,rfe,rfe,rfe,rfe,afe,rfe],[rfe,rfe,rfe,rfe,rfe,ife,rfe,rfe],[rfe,rfe,rfe,rfe,afe,rfe,rfe,rfe],[rfe,rfe,rfe,ife,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,afe,rfe,afe],[rfe,rfe,rfe,ife,rfe,rfe,afe,afe],[rfe,rfe,rfe,ife,rfe,rfe,rfe,rfe]],0),[Jhe.of(new Bae(3,3),new Bae(3,0)).get(),Jhe.of(new Bae(3,3),new Bae(0,0)).get(),Jhe.of(new Bae(3,3),new Bae(2,3)).get(),Jhe.of(new Bae(3,3),new Bae(4,3)).get()],$localize(Za||(Za=wg(["Congratulations!"]))),$localize(Ya||(Ya=wg(["Failed. This was not one of the expected moves."])))),poe.fromMove($localize(Ka||(Ka=wg(["Capturing"]))),$localize(Qa||(Qa=wg(["If a move ends on an opponent's pieces, this one is captured and removed from the board.\n        However, a move cannot end on one of the player's pieces.\n        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!\n        If a player has only one piece, that player wins the game.<br/><br/>\n        On the following board, try to capture one piece with Dark."]))),new Xhe([[rfe,ife,rfe,ife,ife,ife,ife,rfe],[afe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,ife,rfe,afe,rfe,rfe,rfe],[afe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[afe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[afe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[afe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,ife,ife,ife,ife,ife,ife,rfe]],0),[Jhe.of(new Bae(2,2),new Bae(4,2)).get()],$localize(Xa||(Xa=wg(["Congratulations!"]))),$localize(Ja||(Ja=wg(["Failed!"])))),poe.fromMove($localize(eo||(eo=wg(["Tie"]))),$localize(to||(to=wg(["In the special case where a move ends up connecting all pieces of both player, simultaneously,\n        then the game ends up with a tie.<br/><br/>\n        You're playing Dark, force the tie in one move."]))),new Xhe([[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe],[ife,rfe,rfe,ife,afe,ife,rfe,rfe],[rfe,rfe,rfe,ife,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,afe],[rfe,rfe,rfe,rfe,rfe,rfe,rfe,rfe]],0),[Jhe.of(new Bae(0,2),new Bae(4,2)).get()],$localize(no||(no=wg(["Congratulations!"]))),$localize(ro||(ro=wg(["Failed!"]))))]});function sfe(e,t){if(1&e&&(c_(),nS(0,"circle",3)),2&e){var n=hS().index,r=hS().index,i=hS();XE("ngClass",i.getPieceClasses(n,r)),$E("cx",i.SPACE_SIZE/2+n*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)}}function ufe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"g",2),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),nS(2,"rect",3),YE(3,sfe,1,4,"circle",4),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","click_",i,"_",a,""),pb(1),XE("ngClass",o.getSquareClasses(i,a)),$E("x",i*o.SPACE_SIZE)("y",a*o.SPACE_SIZE)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r!==o.EMPTY)}}function cfe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,ufe,4,8,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function lfe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",5),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),$E("x",r.x*i.SPACE_SIZE+(i.SPACE_SIZE/2-i.INDICATOR_SIZE/2))("y",r.y*i.SPACE_SIZE+(i.SPACE_SIZE/2-i.INDICATOR_SIZE/2))("width",i.INDICATOR_SIZE)("height",i.INDICATOR_SIZE)}}var hfe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).INDICATOR_SIZE=20,r.EMPTY=Mre.NONE,r.targets=[],r.selected=lV.empty(),r.lastMove=lV.empty(),r.captured=lV.empty(),r.rules=new tfe(Xhe),r.availableMinimaxes=[new nfe(r.rules,"LinesOfActionMinimax")],r.encoder=Jhe.encoder,r.tutorial=(new ofe).tutorial,r.updateBoard(),r}return jg(n,[{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(a=new Bae(e,t),!n.selected.isPresent()){r.next=9;break}if(n.getState().getPieceAt(a)!==n.getState().getCurrentPlayer()){r.next=7;break}return r.abrupt("return",n.select(a));case 7:return o=Jhe.of(n.selected.get(),new Bae(e,t)),r.abrupt("return",o.isSuccess()?n.chooseMove(o.get(),n.rules.node.gameState):n.cancelMove(efe.INVALID_DIRECTION()));case 9:return r.abrupt("return",n.select(a));case 10:case"end":return r.stop()}},r)}))()}},{key:"select",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=lV.of(e),t.targets=tfe.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(efe.PIECE_CANNOT_MOVE()):T7.SUCCESS));case 1:case"end":return n.stop()}},n)}))()}},{key:"getState",value:function(){return this.rules.node.gameState}},{key:"getPreviousState",value:function(){return this.rules.node.mother.get().gameState}},{key:"updateBoard",value:function(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){var e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end).isPlayer()?lV.of(e.end):lV.empty()}}},{key:"cancelMoveAttempt",value:function(){this.selected=lV.empty(),this.targets=[]}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t);if(this.lastMove.isPresent()){var r=this.lastMove.get().coord,i=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(r)||n.equals(i))return["moved"]}return[]}},{key:"getPieceClasses",value:function(e,t){var n=this.board[t][e],r=new Bae(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-linesofaction"]],features:[xE],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,cfe,2,1,"g",1),YE(2,lfe,2,4,"g",1),tS()),2&e&&(pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.targets))},directives:[LA,NA,UA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),ffe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{top:0,bottom:0,left:0,right:0};return Wg(this,n),(a=t.call(this,e.x,e.y)).direction=r,a.orientation=i,a.captures=o,a}return jg(n,[{key:"toString",value:function(){return"LodestoneMove(".concat(this.coord.toString(),", ").concat(this.direction,", ").concat(this.orientation,", { top: ").concat(this.captures.top,", bottom: ").concat(this.captures.bottom,", left: ").concat(this.captures.left,", right: ").concat(this.captures.right," })")}},{key:"equals",value:function(e){return this===e||!(!1===this.coord.equals(e.coord)||this.orientation!==e.orientation||this.direction!==e.direction||this.captures.top!==e.captures.top||this.captures.bottom!==e.captures.bottom||this.captures.left!==e.captures.left||this.captures.right!==e.captures.right)}}]),n}(roe);ffe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encodeMove",value:function(e){return{coord:Bae.encoder.encode(e.coord),direction:e.direction,orientation:e.orientation,captures:e.captures}}},{key:"decodeMove",value:function(e){var t=e;return M7(null!=t.coord,"Invalid encoded LodestoneMove"),M7(null!=t.direction,"Invalid encoded LodestoneMove"),M7(null!=t.orientation,"Invalid encoded LodestoneMove"),M7(null!=t.captures,"Invalid encoded LodestoneMove"),new ffe(Bae.encoder.decode(t.coord),t.direction,t.orientation,t.captures)}}]),n}(Are));var dfe=function(){var e=jg(function e(){Wg(this,e)});return e.MUST_FLIP_LODESTONE=function(){return $localize(io||(io=wg(["You must flip your lodestone before putting it back on the board."])))},e.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES=function(){return $localize(ao||(ao=wg(["As long as there are pressure plates, you must place all the pieces that you have captured on them."])))},e.TARGET_IS_CRUMBLED=function(){return $localize(oo||(oo=wg(["You must place your lodestone on a non-crumbled square!"])))},e.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE=function(){return $localize(so||(so=wg(["You placed too many captures on the same pressure plate, which has not enough space left."])))},e.MUST_PLACE_CAPTURES=function(){return $localize(uo||(uo=wg(["You must place your captures on the pressure plates, on the side of the board."])))},e.NO_CAPTURES_TO_PLACE_YET=function(){return $localize(co||(co=wg(["You cannot place any capture now, you must first place your lodestone on the board!"])))},e}(),vfe=function(){function e(t){Wg(this,e),this.unreachable=t}return jg(e,[{key:"isLodestone",value:function(){return!1}},{key:"isPlayerPiece",value:function(){return!1}},{key:"isEmpty",value:function(){return!0}},{key:"isUnreachable",value:function(){return this.unreachable}},{key:"equals",value:function(e){return this===e}}]),e}();vfe.UNREACHABLE=new vfe(!0),vfe.EMPTY=new vfe(!1);var pfe=function(){function e(t){Wg(this,e),this.owner=t}return jg(e,[{key:"isLodestone",value:function(){return!1}},{key:"isPlayerPiece",value:function(){return!0}},{key:"isEmpty",value:function(){return!1}},{key:"isUnreachable",value:function(){return!1}},{key:"equals",value:function(e){return this===e}}],[{key:"of",value:function(t){return t===Nre.ZERO?e.ZERO:e.ONE}}]),e}();pfe.ZERO=new pfe(Nre.ZERO),pfe.ONE=new pfe(Nre.ONE);var gfe=function(){function e(t,n,r){Wg(this,e),this.owner=t,this.direction=n,this.orientation=r}return jg(e,[{key:"isLodestone",value:function(){return!0}},{key:"isPlayerPiece",value:function(){return!1}},{key:"isEmpty",value:function(){return!1}},{key:"isUnreachable",value:function(){return!1}},{key:"equals",value:function(e){return this===e}}],[{key:"of",value:function(t,n){return e.LODESTONES[t.value][n.direction][n.orientation]}}]),e}();gfe.LODESTONES={0:{push:{diagonal:new gfe(Nre.ZERO,"push","diagonal"),orthogonal:new gfe(Nre.ZERO,"push","orthogonal")},pull:{diagonal:new gfe(Nre.ZERO,"pull","diagonal"),orthogonal:new gfe(Nre.ZERO,"pull","orthogonal")}},1:{push:{diagonal:new gfe(Nre.ONE,"push","diagonal"),orthogonal:new gfe(Nre.ONE,"push","orthogonal")},pull:{diagonal:new gfe(Nre.ONE,"pull","diagonal"),orthogonal:new gfe(Nre.ONE,"pull","orthogonal")}}};var yfe=function(){function e(t,n){Wg(this,e),this.width=t,this.pieces=n}return jg(e,[{key:"remainingSpaces",value:function(){return 5===this.width?8-this.pieces.length:3-this.pieces.length}},{key:"addCaptured",value:function(t,n){if(this.pieces.length+n>=this.width)return 5===this.width?e.EMPTY_3.addCaptured(t,n+this.pieces.length-5):(M7(this.pieces.length+n===3,"should never put more pieces than the plate can support"),lV.empty());for(var r=Ure.copyImmutableArray(this.pieces),i=0;i<n;i++)r.push(pfe.of(t));return lV.of(new e(this.width,r))}},{key:"getPieceAt",value:function(e){return e<this.pieces.length?this.pieces[e]:vfe.EMPTY}}]),e}();yfe.POSITIONS=["top","bottom","left","right"],yfe.EMPTY_5=new yfe(5,[]),yfe.EMPTY_3=new yfe(3,[]);var mfe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).lodestones=i,o.pressurePlates=a,o}return jg(n,[{key:"withBoard",value:function(e){return new n(e,this.turn,this.lodestones,this.pressurePlates)}},{key:"remainingSpaces",value:function(){var e=this.remainingSpacesDetails();return e.top+e.bottom+e.left+e.right}},{key:"remainingSpacesDetails",value:function(){var e,t={top:0,bottom:0,left:0,right:0},n=Hg(yfe.POSITIONS);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.pressurePlates[r];i.isPresent()&&(t[r]=i.get().remainingSpaces())}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"numberOfPieces",value:function(){for(var e=[0,0],t=0;t<n.SIZE;t++)for(var r=0;r<n.SIZE;r++){var i=this.getPieceAtXY(r,t);i.isPlayerPiece()&&(e[i.owner.value]+=1)}return e}},{key:"getScores",value:function(){var e=this.numberOfPieces();return[24-e[1],24-e[0]]}},{key:"nextLodestoneDirection",value:function(){var e=this.getCurrentPlayer(),t=this.lodestones.get(e);if(!t.isPresent())return lV.empty();var n=this.getPieceAt(t.get());switch(M7(n.isLodestone(),"Piece must be lodestone (invariant from LodestoneState)"+t.get()),n.direction){case"push":return lV.of("pull");case"pull":return lV.of("push")}}}],[{key:"getInitialState",value:function(){var e=vfe.EMPTY,t=pfe.ZERO,r=pfe.ONE;return new n([[e,e,t,r,t,r,e,e],[e,t,r,t,r,t,r,e],[t,r,t,r,t,r,t,r],[r,t,r,e,e,t,r,t],[t,r,t,e,e,r,t,r],[r,t,r,t,r,t,r,t],[e,r,t,r,t,r,t,e],[e,e,r,t,r,t,e,e]],0,new ooe,{top:lV.of(yfe.EMPTY_5),bottom:lV.of(yfe.EMPTY_5),left:lV.of(yfe.EMPTY_5),right:lV.of(yfe.EMPTY_5)})}}]),n}(eoe);return e.SIZE=8,e}(),kfe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,mfe)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){var r=t.getCurrentPlayer(),i=r.getOpponent(),a=Ure.copyBiArray(n.board),o=t.lodestones.getCopy();o.put(r,e.coord);var s=Eg({},t.pressurePlates);return this.updatePressurePlates(a,s,o,i,e.captures),new mfe(a,t.turn+1,o,s)}},{key:"updatePressurePlates",value:function(e,t,n,r,i){var a,o=Hg(yfe.POSITIONS);try{for(o.s();!(a=o.n()).done;){var s=a.value;t[s]=this.updatePressurePlate(e,s,t[s],n,r,i[s])}}catch(u){o.e(u)}finally{o.f()}}},{key:"updatePressurePlate",value:function(e,t,r,i,a,o){if(r.isPresent()){var s=r.get().addCaptured(a,o),u=n.THREATENED_COORD_RANGE.get(t).get();return s.isAbsent()?(this.removePressurePlate(e,u.startForBigPlate,u.direction,i),this.removePressurePlate(e,u.startForSmallPlate,u.direction,i)):s.get().width<r.get().width&&this.removePressurePlate(e,u.startForBigPlate,u.direction,i),s}return r}},{key:"removePressurePlate",value:function(e,t,n,r){for(var i=t;i.isInRange(mfe.SIZE,mfe.SIZE);i=i.getNext(n)){var a,o=Hg(Nre.PLAYERS);try{for(o.s();!(a=o.n()).done;){var s=a.value;r.get(s).equalsValue(i)&&r.delete(s)}}catch(u){o.e(u)}finally{o.f()}e[i.y][i.x]=vfe.UNREACHABLE}}},{key:"isLegal",value:function(e,t){var n=this.isLegalWithoutCaptures(t,e.coord,e.direction);if(n.isFailure())return S7.failure(n.getReason());var r=this.applyMoveWithoutPlacingCaptures(t,e.coord,e);if(e.captures.top+e.captures.bottom+e.captures.left+e.captures.right!==Math.min(r.captures.length,t.remainingSpaces()))return S7.failure(dfe.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES());var i,a=Hg(yfe.POSITIONS);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=t.pressurePlates[o];if(s.isPresent()&&s.get().remainingSpaces()<e.captures[o])return S7.failure(dfe.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE())}}catch(u){a.e(u)}finally{a.f()}return S7.success(r)}},{key:"applyMoveWithoutPlacingCaptures",value:function(e,t,n){var r,i=Ure.copyBiArray(e.board),a=e.lodestones.get(e.getCurrentPlayer());if(a.isPresent()){var o=a.get();i[o.y][o.x]=vfe.EMPTY}return(r="pull"===n.direction?this.applyPull(e,i,t,n.orientation):this.applyPush(e,i,t,n.orientation)).board[t.y][t.x]=gfe.of(e.getCurrentPlayer(),n),r.moved.push(t),r}},{key:"applyPull",value:function(e,t,n,r){var i,a=e.getCurrentPlayer(),o=a.getOpponent(),s=[],u=[],c=Hg("diagonal"===r?Lae.DIAGONALS:Lae.ORTHOGONALS);try{for(c.s();!(i=c.n()).done;)for(var l=i.value,h=n.getNext(l);e.isOnBoard(h);h=h.getNext(l)){var f=t[h.y][h.x],d=h.getNext(l);if(e.isOnBoard(d)){var v=t[d.y][d.x];v.isPlayerPiece()&&v.owner===a&&(f.isEmpty()?(u.push(h),t[h.y][h.x]=v,u.push(d),t[d.y][d.x]=vfe.EMPTY):f.isPlayerPiece()&&f.owner===o&&(s.push(h),t[h.y][h.x]=v,u.push(d),t[d.y][d.x]=vfe.EMPTY))}}}catch(p){c.e(p)}finally{c.f()}return{board:t,captures:s,moved:u}}},{key:"applyPush",value:function(e,t,n,r){var i,a=e.getCurrentPlayer().getOpponent(),o=[],s=[],u=Hg("diagonal"===r?Lae.DIAGONALS:Lae.ORTHOGONALS);try{for(u.s();!(i=u.n()).done;)for(var c=i.value,l=n.getNext(c,mfe.SIZE);!1===l.equals(n);l=l.getPrevious(c))if(e.isOnBoard(l)){var h=t[l.y][l.x];if(h.isPlayerPiece()&&h.owner===a){var f=l.getNext(c);if(e.isOnBoard(f)){var d=t[f.y][f.x];d.isUnreachable()?(o.push(l),t[l.y][l.x]=vfe.EMPTY):d.isEmpty()&&(s.push(f),t[f.y][f.x]=h,s.push(l),t[l.y][l.x]=vfe.EMPTY)}else o.push(l),t[l.y][l.x]=vfe.EMPTY}}}catch(v){u.e(v)}finally{u.f()}return{board:t,captures:o,moved:s}}},{key:"isLegalWithoutCaptures",value:function(e,t,n){var r=this.isTargetLegal(e,t);if(r.isFailure())return r;var i=e.nextLodestoneDirection();return!1===(i.isAbsent()||i.equalsValue(n))?T7.failure(dfe.MUST_FLIP_LODESTONE()):T7.SUCCESS}},{key:"isTargetLegal",value:function(e,t){var n=e.getPieceAt(t);if(n.isUnreachable())return T7.failure(dfe.TARGET_IS_CRUMBLED());if(n.isPlayerPiece())return T7.failure(Zae.MUST_CLICK_ON_EMPTY_SQUARE());var r=e.getCurrentPlayer();return n.isLodestone()&&n.owner!==r?T7.failure(Zae.MUST_CLICK_ON_EMPTY_SQUARE()):T7.SUCCESS}},{key:"getGameStatus",value:function(e){var t=e.gameState.numberOfPieces();return 0===t[0]&&0===t[1]?loe.DRAW:0===t[0]?loe.ONE_WON:0===t[1]?loe.ZERO_WON:loe.ONGOING}}],[{key:"get",value:function(){return n.singleton.isAbsent()&&(n.singleton=lV.of(new n)),n.singleton.get()}}]),n}(hoe);kfe.THREATENED_COORD_RANGE=ooe.from({top:{startForBigPlate:new Bae(0,0),startForSmallPlate:new Bae(0,1),direction:Lae.RIGHT},bottom:{startForBigPlate:new Bae(0,mfe.SIZE-1),startForSmallPlate:new Bae(0,mfe.SIZE-2),direction:Lae.RIGHT},left:{startForBigPlate:new Bae(0,0),startForSmallPlate:new Bae(1,0),direction:Lae.DOWN},right:{startForBigPlate:new Bae(mfe.SIZE-1,0),startForSmallPlate:new Bae(mfe.SIZE-2,0),direction:Lae.DOWN}}),kfe.singleton=lV.empty();var _fe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=this,n=e.gameState;return this.flatMapEmptyCoords(n,function(e){var r,i=[],a=Hg(t.nextDirection(n));try{for(a.s();!(r=a.n()).done;)for(var o=r.value,s=0,u=["diagonal","orthogonal"];s<u.length;s++){var c,l=u[s],h=kfe.get().applyMoveWithoutPlacingCaptures(n,e,{direction:o,orientation:l}).captures.length,f=Hg(t.captureCombinations(n,h));try{for(f.s();!(c=f.n()).done;){var d=c.value;i.push(new ffe(e,o,l,d))}}catch(v){f.e(v)}finally{f.f()}}}catch(v){a.e(v)}finally{a.f()}return i})}},{key:"captureCombinations",value:function(e,t){if(0===t)return new Xae([{top:0,bottom:0,left:0,right:0}]);var n,r=new Xae,i=e.remainingSpacesDetails(),a=this.captureCombinations(e,t-1),o=Hg(a);try{for(o.s();!(n=o.n()).done;){var s=n.value;s.top+1<=i.top&&r.add(Eg(Eg({},s),{},{top:s.top+1})),s.bottom+1<=i.bottom&&r.add(Eg(Eg({},s),{},{bottom:s.bottom+1})),s.left+1<=i.left&&r.add(Eg(Eg({},s),{},{left:s.left+1})),s.right+1<=i.right&&r.add(Eg(Eg({},s),{},{right:s.right+1}))}}catch(u){o.e(u)}finally{o.f()}return 0===r.size()?a:r}},{key:"flatMapEmptyCoords",value:function(e,t){for(var n=[],r=0;r<mfe.SIZE;r++)for(var i=0;i<mfe.SIZE;i++){var a=new Bae(i,r),o=e.getPieceAt(a);(o.isEmpty()&&!1===o.isUnreachable()||o.isLodestone()&&o.owner===e.getCurrentPlayer())&&(n=n.concat(t(a)))}return n}},{key:"nextDirection",value:function(e){var t=e.nextLodestoneDirection();return t.isPresent()?[t.get()]:["push","pull"]}},{key:"getBoardValue",value:function(e){var t,n=e.gameState.getScores();return t=24===n[0]&&24!==n[1]?Nre.ZERO.getVictoryValue():24!==n[0]&&24===n[1]?Nre.ONE.getVictoryValue():n[0]*Nre.ZERO.getScoreModifier()+n[1]*Nre.ONE.getScoreModifier(),new Kae(t)}}]),n}(Yae),Cfe=vfe.UNREACHABLE,wfe=vfe.EMPTY,bfe=pfe.ZERO,Efe=pfe.ONE,Sfe=gfe.of(Nre.ONE,{direction:"push",orientation:"orthogonal"}),Pfe={top:lV.of(yfe.EMPTY_5),bottom:lV.of(yfe.EMPTY_5),left:lV.of(yfe.EMPTY_5),right:lV.of(yfe.EMPTY_5)},Ofe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(lo||(lo=wg(["Board and aim of the game"]))),$localize(ho||(ho=wg(["Lodestone is played on a 8x8 board, which contains so-called <i>pressure plates</i> along the board, that will contain captured pieces. The initial board is shown here. The aim of the game is to be the only player with pieces remaining on the board. To do so, you will have to either push your opponent's pieces off the board, or to crush them with your pieces. You will do it by using a lodestone."]))),mfe.getInitialState()),poe.forClick($localize(fo||(fo=wg(["Selecting a lodestone"]))),$localize(vo||(vo=wg(["To perform a move, you have to place your lodestone on the board. Your lodestone has two sides: <ul><li>its <i>repelling</i> side with which it will repel the opponent's pieces (indicated by the outward triangles of your opponent's color on the lodestone), and</li><li>its <i>attracting</i> side with which it will attract your pieces (indicated by the inward triangles of your color on the lodestone).</li></ul>Your lodestone can be placed to move pieces orthogonally or diagonally. All available lodestone sides and orientation are shown below the board.<br/><br/>You're playing Dark. Select the lodestone that repels your opponent's pieces diagonally."]))),mfe.getInitialState(),["#lodestone_push_diagonal"],$localize(po||(po=wg(["Congratulations!"]))),$localize(go||(go=wg(["This is not the right lodestone, try again."])))),poe.informational($localize(yo||(yo=wg(["The repelling lodestone"]))),$localize(mo||(mo=wg(["Upon placing a lodestone on the board, it will move all pieces it acts upon (according to its direction and orientation) simultaneously. Let us first see how the repelling lodestone acts on the pieces. All the opponent's pieces aligned with the lodestone, as indicated by the triangles' orientations, will be pushed one square away from the lodestone. An opponent's piece will be blocked in case it encounters on its way either one of your piece, a lodestone, or another blocked piece. Finally, if an opponent's piece falls out of the board, it is captured."]))),mfe.getInitialState()),poe.informational($localize(ko||(ko=wg(["The attracting lodestone"]))),$localize(_o||(_o=wg(["When the lodestone is on its attracting side it will pull your pieces one square towards it. In case one of your pieces encounters a lodestone on its way or another blocked piece, it is blocked. However, if it encounter an opponent's piece, it will capture it."]))),mfe.getInitialState()),poe.informational($localize(Co||(Co=wg(["Flipping the lodestone"]))),$localize(wo||(wo=wg(["Note that, after every move, you must flip your lodestone: if it was on its repelling side, you must use it on its attracting side, and vice versa. Also, you are allowed to place your lodestone on the same location as it was on your previous turn."]))),mfe.getInitialState()),poe.fromPredicate($localize(bo||(bo=wg(["Capturing"]))),$localize(Eo||(Eo=wg(["To summarize, it is possible to capture the opponent's pieces in two ways:<ul><li>with a repelling lodestone, by pushing your opponent's pieces out of the board, or</li><li>with an attracting lodestone, by moving your pieces on your opponent's pieces.</li></ul>Once a lodestone is placed and the pieces have been moved and/or captured, in case any of the opponent's pieces have been captured, you have to place them on the <i>pressure plates</i> that lie around the board. To do so, click on an empty space of the pressure plate of your choice for each capture. You can cancel this by clicking again on a piece you just put on a pressure plate.<br/><br/>You're playing Dark. Try to perform a move that captures at least one of your opponent's piece, and place your capture(s) on pressure plates."]))),mfe.getInitialState(),new ffe(new Bae(0,6),"pull","orthogonal",{top:2,bottom:1,left:1,right:1}),function(e,t){return 32===t.remainingSpaces()?T7.failure($localize(So||(So=wg(["You have not captured any of the opponent's pieces, try again!"])))):T7.SUCCESS},"Congratulations!"),poe.fromPredicate($localize(Po||(Po=wg(["Crumbling a first pressure plate"]))),$localize(Oo||(Oo=wg(["When a pressure plate is full, it will crumble and take a full row or column of the board with it! All pieces that are on the crumbled squares are considered lost, but will not have to be placed on pressure plates. You have here a board with a pressure plate that only requires one more piece to crumble.<br/><br/>You're playing Dark. Perform a move that captures at least one piece, and fill that pressure plate to make it crumble."]))),new mfe([[wfe,wfe,wfe,wfe,Efe,wfe,wfe,wfe],[wfe,wfe,bfe,wfe,wfe,Efe,wfe,wfe],[wfe,wfe,Sfe,wfe,wfe,wfe,wfe,bfe],[wfe,wfe,wfe,wfe,Efe,wfe,wfe,bfe],[wfe,wfe,wfe,wfe,wfe,bfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe]],0,new ooe([{key:Nre.ONE,value:new Bae(2,2)}]),Eg(Eg({},Pfe),{},{top:yfe.EMPTY_5.addCaptured(Nre.ONE,4)})),new ffe(new Bae(6,2),"push","diagonal",{top:1,bottom:0,left:0,right:0}),function(e,t){return 5===t.pressurePlates.top.get().width?T7.failure($localize(To||(To=wg(["You must capture and place your capture on the top pressure plate to make it crumble!"])))):T7.SUCCESS},"Congratulations!"),poe.fromPredicate($localize(Io||(Io=wg(["Crumbling a second pressure plate"]))),$localize(Ao||(Ao=wg(["Once a pressure plate has crumbled, a shorter pressure plate takes it place. It is the case here, where only 3 spots are available on the top pressure plate.<br/><br/>You're playing Dark. Perform a move that captures enough pieces to fill the top pressure plate, and make it crumble."]))),new mfe([[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,bfe],[wfe,wfe,wfe,wfe,wfe,bfe,wfe,bfe],[wfe,Sfe,wfe,wfe,Efe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,Efe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe]],0,new ooe([{key:Nre.ONE,value:new Bae(1,4)}]),Eg(Eg({},Pfe),{},{top:yfe.EMPTY_3.addCaptured(Nre.ONE,2)})),new ffe(new Bae(3,5),"pull","diagonal",{top:1,bottom:0,left:0,right:0}),function(e,t){return t.pressurePlates.top.isPresent()?T7.failure($localize(xo||(xo=wg(["You must capture and place your capture on the top pressure plate to make it crumble a second time!"])))):T7.SUCCESS},"Congratulations!"),poe.informational($localize(Ro||(Ro=wg(["Minimal board"]))),$localize(Mo||(Mo=wg(["After a pressure plate has crumbled for a second time, there is no more pressure plate available on that side. In case all pressure plates have crumbled, the board is reduced to a 4x4 board."]))),new mfe([[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[Cfe,Cfe,bfe,Efe,wfe,wfe,Cfe,Cfe],[Cfe,Cfe,Sfe,Efe,wfe,wfe,Cfe,Cfe],[Cfe,Cfe,wfe,bfe,bfe,wfe,Cfe,Cfe],[Cfe,Cfe,bfe,wfe,wfe,wfe,Cfe,Cfe],[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe]],0,new ooe([{key:Nre.ONE,value:new Bae(2,3)}]),{top:lV.empty(),bottom:lV.empty(),left:lV.empty(),right:lV.empty()})),poe.fromMove($localize(No||(No=wg(["Making the lodestone fall"]))),$localize(Do||(Do=wg(["If, at any point during the game, your lodestone is situated on a square that crumbles with a pressure plate, you will be allowed to select any lodestone side on your next turn.<br/><br/>In this board, playing Dark, you can place your lodestone and make a pressure plate crumble so that your lodestone falls too, allowing to choose more freely its side on your next turn. Do it!"]))),new mfe([[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,Efe,wfe,wfe],[wfe,wfe,wfe,Sfe,wfe,wfe,bfe,wfe],[wfe,wfe,bfe,bfe,Efe,wfe,wfe,bfe],[wfe,wfe,wfe,wfe,wfe,bfe,wfe,wfe],[wfe,wfe,bfe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,Efe,wfe,wfe,wfe,wfe,wfe],[wfe,wfe,wfe,wfe,wfe,wfe,wfe,wfe]],0,new ooe([{key:Nre.ONE,value:new Bae(3,2)}]),Eg(Eg({},Pfe),{},{top:yfe.EMPTY_5.addCaptured(Nre.ONE,4)})),[new ffe(new Bae(4,0),"pull","diagonal",{top:1,bottom:0,left:0,right:0})],$localize(Lo||(Lo=wg(["Congratulations! At your next turn, you will be allowed to place your lodestone on any side."]))),$localize(Fo||(Fo=wg(["Failed, try again."])))),poe.fromMove($localize(Uo||(Uo=wg(["End of the game"]))),$localize(Bo||(Bo=wg(["In order to win, you must take out all of your opponent's pieces.<br/><br/>Here, you can win in a single move, do it!"]))),new mfe([[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe],[Cfe,Efe,bfe,Efe,wfe,wfe,Cfe,Cfe],[Cfe,Efe,Sfe,wfe,Efe,wfe,Cfe,Cfe],[Cfe,wfe,wfe,bfe,bfe,wfe,Cfe,Cfe],[Cfe,Efe,bfe,wfe,Efe,wfe,Cfe,Cfe],[Cfe,wfe,wfe,wfe,bfe,wfe,Cfe,Cfe],[Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe,Cfe]],0,new ooe([{key:Nre.ONE,value:new Bae(2,3)}]),{top:lV.empty(),bottom:yfe.EMPTY_3.addCaptured(Nre.ZERO,2),left:lV.of(yfe.EMPTY_3),right:lV.empty()}),[new ffe(new Bae(4,2),"pull","orthogonal",{top:0,bottom:0,left:3,right:0})],$localize(Vo||(Vo=wg(["Congratulations, you won!"]))),$localize(zo||(zo=wg(["This is not the winning move. Try again."]))))]});function Tfe(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS(2),r=n.index,i=n.$implicit,a=hS().index,o=hS();vS("id","piece_",r,"_",a,""),XE("ngClass",i.pieceClasses),$E("r",o.PIECE_RADIUS)("cx",o.SPACE_SIZE*r+o.STROKE_WIDTH+o.SPACE_SIZE/2)("cy",o.SPACE_SIZE*a+o.STROKE_WIDTH+o.SPACE_SIZE/2)}}function Ife(e,t){if(1&e&&(c_(),nS(0,"polygon",15)),2&e){var n=hS().$implicit,r=hS(3).$implicit,i=hS(2);ZE("transform","rotate(",90*n,")"),XE("ngClass",r.lodestone.movingClass),$E("points",i.TRIANGLE_OUT)}}function Afe(e,t){if(1&e&&(c_(),nS(0,"polygon",15)),2&e){var n=hS().$implicit,r=hS(3).$implicit,i=hS(2);ZE("transform","rotate(",90*n,")"),XE("ngClass",r.lodestone.movingClass),$E("points",i.TRIANGLE_IN)}}function xfe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Ife,1,3,"polygon",14),YE(2,Afe,1,3,"polygon",14),tS()),2&e){var n=hS(3).$implicit;pb(1),XE("ngIf","push"===n.lodestone.direction),pb(1),XE("ngIf","pull"===n.lodestone.direction)}}var Rfe=function(){return[0,1,2,3]};function Mfe(e,t){if(1&e&&(c_(),eS(0,"g",11),nS(1,"circle",12),nS(2,"circle",13),eS(3,"g"),YE(4,xfe,3,2,"g",1),tS(),tS()),2&e){var n=hS(2),r=n.index,i=n.$implicit,a=hS().index,o=hS();$E("transform",o.getSquareTransform(r,a)),pb(1),XE("ngClass",i.lodestone.selectedClass),$E("r",o.PIECE_RADIUS),pb(1),XE("ngClass",i.lodestone.pieceClasses),$E("r",o.PIECE_RADIUS/4),pb(1),ZE("transform","rotate(","diagonal"===i.lodestone.orientation?45:0,")"),pb(1),XE("ngForOf",aT(7,Rfe))}}function Nfe(e,t){if(1&e){var n=aS();c_(),eS(0,"g",6),uS("click",function(){Nk(n);var e=hS().$implicit;return hS(2).selectCoord(e.coord)}),nS(1,"rect",7),YE(2,Tfe,1,6,"circle",8),YE(3,Mfe,5,8,"g",9),tS()}if(2&e){var r=hS(),i=r.index,a=r.$implicit,o=hS().index,s=hS();vS("id","square_",i,"_",o,""),pb(1),XE("ngClass",a.squareClasses),$E("x",s.SPACE_SIZE*i+s.STROKE_WIDTH)("y",s.SPACE_SIZE*o+s.STROKE_WIDTH)("width",s.SPACE_SIZE)("height",s.SPACE_SIZE),pb(1),XE("ngIf",a.hasPiece),pb(1),XE("ngIf",a.lodestone)}}function Dfe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Nfe,4,9,"g",5),tS()),2&e){var n=t.$implicit;pb(1),XE("ngIf",!1===n.crumbled)}}function Lfe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Dfe,2,1,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Ffe(e,t){if(1&e&&(c_(),eS(0,"g",16),nS(1,"circle",17),tS()),2&e){var n=t.$implicit,r=t.index,i=hS();dS("id","capture_",r,""),$E("transform",i.getCaptureTransform(r)),pb(1),XE("ngClass",n.pieceClasses),$E("r",i.PIECE_RADIUS)}}function Ufe(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"polygon",15),tS()),2&e){var n=t.$implicit,r=hS().$implicit,i=hS();pb(1),ZE("transform","rotate(",90*n,")"),XE("ngClass",r.movingClass),$E("points","push"===r.direction?i.TRIANGLE_OUT:i.TRIANGLE_IN)}}function Bfe(e,t){if(1&e){var n=aS();c_(),eS(0,"g",6),uS("click",function(){var e=Nk(n).$implicit;return hS().selectLodestone(e)}),nS(1,"circle",12),nS(2,"circle",13),eS(3,"g"),YE(4,Ufe,2,3,"g",1),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS();vS("id","lodestone_",r.direction,"_",r.orientation,""),$E("transform",a.getAvailableLodestoneTransform(i)),pb(1),XE("ngClass",r.selectedClass),$E("r",a.PIECE_RADIUS),pb(1),XE("ngClass",r.pieceClasses),$E("r",a.PIECE_RADIUS/4),pb(1),ZE("transform","rotate(","diagonal"===r.orientation?45:0,")"),pb(1),XE("ngForOf",aT(9,Rfe))}}function Vfe(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS(),r=n.index,i=n.$implicit,a=hS().$implicit,o=hS();vS("id","platePiece_",a.position,"_",r,""),XE("ngClass",i.pieceClasses),$E("r",o.PIECE_RADIUS)("cx",o.SPACE_SIZE*i.coord.x+o.STROKE_WIDTH+o.SPACE_SIZE/2)("cy",o.SPACE_SIZE*i.coord.y+o.STROKE_WIDTH+o.SPACE_SIZE/2)}}function zfe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"g",6),uS("click",function(){var e=Nk(n),t=e.$implicit,r=e.index,i=hS().$implicit;return hS().onPressurePlateClick(t.temporary,i.position,r)}),nS(2,"rect",18),YE(3,Vfe,1,6,"circle",8),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().$implicit,o=hS();$E("transform",o.getPressurePlateTransform(a.position)),pb(1),vS("id","plate_",a.position,"_",i,""),pb(1),vS("id","plateSquare_",a.position,"_",i,""),XE("ngClass",r.squareClasses),$E("x",o.SPACE_SIZE*r.coord.x+o.STROKE_WIDTH)("y",o.SPACE_SIZE*r.coord.y+o.STROKE_WIDTH)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r.hasPiece)}}function Hfe(e,t){if(1&e&&(c_(),eS(0,"g",16),YE(1,zfe,4,11,"g",1),tS()),2&e){var n=t.$implicit;dS("id","pressurePlate_",n.position,""),pb(1),XE("ngForOf",n.coords)}}function Gfe(e,t){if(1&e&&(c_(),nS(0,"rect",19)),2&e){var n=hS();vS("id","selection_",n.viewInfo.selected.get().x,"_",n.viewInfo.selected.get().y,""),$E("x",n.SPACE_SIZE*n.viewInfo.selected.get().x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*n.viewInfo.selected.get().y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}var $fe=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;Wg(this,n),(r=t.call(this,e)).viewInfo={availableLodestones:[],capturesToPlace:[],boardInfo:[],currentPlayerClass:"",opponentClass:"",pressurePlates:[],selected:lV.empty(),pressurePlateShift:{top:new Mae(0,0),left:new Mae(0,0),right:new Mae(0,0),bottom:new Mae(0,0)}},r.stateAfterPlacingLodestone=lV.empty(),r.lastInfos=lV.empty(),r.capturesToPlace=0,r.selectedCoord=lV.empty(),r.selectedLodestone=lV.empty(),r.captures={top:0,bottom:0,left:0,right:0},r.rules=kfe.get(),r.tutorial=(new Ofe).tutorial,r.availableMinimaxes=[new _fe(r.rules,"LodestoneDummyMinimax")],r.encoder=ffe.encoder,r.PIECE_RADIUS=.5*(r.SPACE_SIZE-2*r.STROKE_WIDTH);var i=.8*r.PIECE_RADIUS,a=.3*r.PIECE_RADIUS,o=.2*r.PIECE_RADIUS;return r.TRIANGLE_OUT="".concat(i,",0 ").concat(a,",").concat(o," ").concat(a,",-").concat(o),r.TRIANGLE_IN="".concat(a,",0 ").concat(i,",").concat(a," ").concat(i,",-").concat(a),r.displayedState=r.rules.node.gameState,r.scores=lV.of([0,0]),r}return jg(n,[{key:"ngOnInit",value:function(){this.updateBoard()}},{key:"selectCoord",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#square_"+e.x+"_"+e.y)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if(!(t.capturesToPlace>0)){n.next=5;break}return n.abrupt("return",t.cancelMove(dfe.MUST_PLACE_CAPTURES()));case 5:return i=kfe.get().isTargetLegal(t.getState(),e),n.abrupt("return",i.isFailure()?t.cancelMove(i.getReason()):t.selectedLodestone.isPresent()?(t.selectedCoord=lV.of(e),t.putLodestone()):(t.selectedCoord=lV.of(e),t.updateViewInfo(),T7.SUCCESS));case 7:case"end":return n.stop()}},n)}))()}},{key:"selectLodestone",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#lodestone_"+e.direction+"_"+e.orientation)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:return M7(0===t.capturesToPlace,"should not be able to click on a lodestone when captures need to be placed"),i=t.getCurrentPlayer(),n.abrupt("return",(t.selectedLodestone=lV.of(gfe.of(i,e)),t.selectedCoord.isPresent()?t.putLodestone():(t.updateViewInfo(),T7.SUCCESS)));case 6:case"end":return n.stop()}},n)}))()}},{key:"putLodestone",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(e.selectedCoord.isPresent(),"coord should have been selected"),M7(e.selectedLodestone.isPresent(),"lodestone should have been selected"),n=e.selectedCoord.get(),r=e.selectedLodestone.get(),i=e.getState(),M7(kfe.get().isLegalWithoutCaptures(i,n,r.direction).isSuccess(),"Lodestone component should only allow creation of legal moves"),a=kfe.get().applyMoveWithoutPlacingCaptures(i,n,r),t.abrupt("return",(e.lastInfos=lV.of(a),e.capturesToPlace=Math.min(a.captures.length,i.remainingSpaces()),0===e.capturesToPlace?e.applyMove():(e.displayedState=e.displayedState.withBoard(a.board),e.stateAfterPlacingLodestone=lV.of(e.displayedState),e.updateViewInfo(),T7.SUCCESS)));case 5:case"end":return t.stop()}},t)}))()}},{key:"applyMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(e.selectedCoord.isPresent(),"coord should have been selected"),M7(e.selectedLodestone.isPresent(),"lodestone should have been selected"),n=e.selectedCoord.get(),r=e.selectedLodestone.get(),i=new ffe(n,r.direction,r.orientation,e.captures),t.abrupt("return",e.chooseMove(i,e.getState()));case 3:case"end":return t.stop()}},t)}))()}},{key:"onPressurePlateClick",value:function(e,t,n){return e?this.deselectPressurePlate(t,n):this.selectPressurePlate(t,n)}},{key:"selectPressurePlate",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#plate_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(0!==n.capturesToPlace){r.next=5;break}return r.abrupt("return",n.cancelMove(dfe.NO_CAPTURES_TO_PLACE_YET()));case 5:return n.capturesToPlace--,n.captures[e]++,a=n.stateAfterPlacingLodestone.get(),o=n.getCurrentPlayer().getOpponent(),s=Ure.copyBiArray(a.board),u=Eg({},a.pressurePlates),c=a.lodestones.getCopy(),r.abrupt("return",(kfe.get().updatePressurePlates(s,u,c,o,n.captures),n.displayedState=new mfe(s,a.turn,c,u),0===n.capturesToPlace?n.applyMove():(n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),T7.SUCCESS)));case 8:case"end":return r.stop()}},r)}))()}},{key:"deselectPressurePlate",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#plate_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return n.capturesToPlace++,n.captures[e]--,a=n.stateAfterPlacingLodestone.get(),o=n.getCurrentPlayer().getOpponent(),s=Ure.copyBiArray(a.board),u=Eg({},a.pressurePlates),c=a.lodestones.getCopy(),r.abrupt("return",(kfe.get().updatePressurePlates(s,u,c,o,n.captures),n.displayedState=new mfe(s,a.turn,c,u),n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),T7.SUCCESS));case 6:case"end":return r.stop()}},r)}))()}},{key:"updateBoard",value:function(){this.cancelMoveAttempt(),this.rules.node.move.isPresent()&&this.showLastMove(),this.scores=lV.of(this.getState().getScores())}},{key:"cancelMoveAttempt",value:function(){this.displayedState=this.getState(),this.stateAfterPlacingLodestone=lV.empty(),this.lastInfos=lV.empty();var e=this.displayedState.lodestones.get(this.getCurrentPlayer());if(e.isPresent()){var t=Ure.copyBiArray(this.displayedState.board);t[e.get().y][e.get().x]=vfe.EMPTY,this.displayedState=this.displayedState.withBoard(t)}this.selectedCoord=lV.empty(),this.selectedLodestone=lV.empty(),this.capturesToPlace=0,this.captures={top:0,bottom:0,left:0,right:0},this.updateViewInfo()}},{key:"updateViewInfo",value:function(){var e=this.getState().getCurrentPlayer();this.viewInfo.currentPlayerClass=this.getPlayerClass(e),this.viewInfo.opponentClass=this.getPlayerClass(e.getOpponent()),this.showBoard(),this.showAvailableLodestones(),this.showCapturesToPlace(),this.showPressurePlates(),this.computePressurePlateShift(),this.lastInfos.isPresent()&&this.showMovedAndCaptured(this.lastInfos.get())}},{key:"showBoard",value:function(){this.viewInfo.boardInfo=[];for(var e=0;e<mfe.SIZE;e++){this.viewInfo.boardInfo.push([]);for(var t=0;t<mfe.SIZE;t++){var n=new Bae(t,e);this.viewInfo.boardInfo[e].push(this.getSquareInfo(n))}}this.viewInfo.selected=this.selectedCoord.isPresent()&&!1===this.displayedState.getPieceAt(this.selectedCoord.get()).isUnreachable()?this.selectedCoord:lV.empty()}},{key:"getSquareInfo",value:function(e){var t=this.displayedState.getPieceAt(e),n={coord:e,squareClasses:[],crumbled:t.isUnreachable(),hasPiece:t.isPlayerPiece(),pieceClasses:[]};return t.isPlayerPiece()&&(n.pieceClasses=[this.getPlayerClass(t.owner)]),t.isLodestone()&&(n.lodestone={direction:t.direction,pieceClasses:[this.getPlayerClass(t.owner)],selectedClass:"",movingClass:"",orientation:t.orientation},n.lodestone.movingClass=this.getPlayerClass("push"===t.direction?t.owner.getOpponent():t.owner)),n}},{key:"showAvailableLodestones",value:function(){if(this.capturesToPlace>0)this.viewInfo.availableLodestones=[];else{var e=this.getState().getCurrentPlayer(),t=this.getState().nextLodestoneDirection();if(t.isPresent()){var n=t.get();this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:n,orientation:"orthogonal"}),this.nextLodestone(e,{direction:n,orientation:"diagonal"})]}else this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:"push",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"push",orientation:"diagonal"}),this.nextLodestone(e,{direction:"pull",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"pull",orientation:"diagonal"})]}}},{key:"showCapturesToPlace",value:function(){var e=this.getCurrentPlayer().getOpponent();this.viewInfo.capturesToPlace=[];for(var t=0;t<this.capturesToPlace;t++)this.viewInfo.capturesToPlace.push({pieceClasses:[this.getPlayerClass(e)]})}},{key:"nextLodestone",value:function(e,t){var n=gfe.of(e,t),r={direction:n.direction,orientation:n.orientation,pieceClasses:[this.getPlayerClass(n.owner)],movingClass:"",selectedClass:""};return r.movingClass=this.getPlayerClass("push"===n.direction?n.owner.getOpponent():n.owner),this.selectedLodestone.equalsValue(n)&&(r.selectedClass="selected"),r}},{key:"showPressurePlates",value:function(){this.viewInfo.pressurePlates=[];var e,t=Hg(yfe.POSITIONS);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=[],a=this.displayedState.pressurePlates[r];if(a.isPresent())for(var o=n.PRESSURE_PLATES_POSITIONS.get(r).get(),s=a.get().width,u=5===s?o.startForBigPlate:o.startForSmallPlate,c=0;c<s;c++){u=u.getNext(o.direction);var l=a.get().getPieceAt(c),h="";l.isPlayerPiece()&&(h=this.getPlayerClass(l.owner)),i.push({coord:u,hasPiece:l.isPlayerPiece(),pieceClasses:[h],squareClasses:[],temporary:!1})}this.viewInfo.pressurePlates.push({position:r,coords:i})}}catch(f){t.e(f)}finally{t.f()}}},{key:"showLastMove",value:function(){var e=this.rules.node.mother.get().gameState,t=this.rules.node.move.get();this.lastInfos=lV.of(kfe.get().applyMoveWithoutPlacingCaptures(e,t.coord,t)),this.updateViewInfo();var n=this.getState();this.showPressurePlateDifferences(e,n,!1)}},{key:"showPressurePlateDifferences",value:function(e,t,n){var r,i=Hg(yfe.POSITIONS);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.showPressurePlateDifference(e.pressurePlates[a],t.pressurePlates[a],a,n)}}catch(o){i.e(o)}finally{i.f()}}},{key:"showPressurePlateDifference",value:function(e,t,n,r){if(e.isPresent()&&t.isPresent()){var i=e.get(),a=t.get(),o=aV.getNonNullable(this.viewInfo.pressurePlates.find(function(e){return e.position===n}));if(i.width===a.width)for(var s=0;s<a.width;s++){var u=i.getPieceAt(s),c=a.getPieceAt(s);!1===u.equals(c)&&(o.coords[s].squareClasses.push("moved"),o.coords[s].temporary=r,r&&o.coords[s].pieceClasses.push("semi-transparent"))}else{var l,h=Hg(o.coords);try{for(h.s();!(l=h.n()).done;){l.value.squareClasses.push("moved")}}catch(f){h.e(f)}finally{h.f()}}}}},{key:"showMovedAndCaptured",value:function(e){var t,n=Hg(e.moved);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}}catch(s){n.e(s)}finally{n.f()}var i,a=Hg(e.captures);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.viewInfo.boardInfo[o.y][o.x].squareClasses.push("captured")}}catch(s){a.e(s)}finally{a.f()}}},{key:"computePressurePlateShift",value:function(){var e=this.displayedState,t=this.getPressurePlateShift(e.pressurePlates.left),n=this.getPressurePlateShift(e.pressurePlates.right),r=this.getPressurePlateShift(e.pressurePlates.top),i=this.getPressurePlateShift(e.pressurePlates.bottom);this.viewInfo.pressurePlateShift.top=new Bae(.5*(t-n),0),this.viewInfo.pressurePlateShift.bottom=new Bae(.5*(t-n),0),this.viewInfo.pressurePlateShift.left=new Bae(0,.5*(r-i)),this.viewInfo.pressurePlateShift.right=new Bae(0,.5*(r-i))}},{key:"getPressurePlateShift",value:function(e){return e.isAbsent()?2:3===e.get().width?1:0}},{key:"getSquareTransform",value:function(e,t){return"translate(".concat(e*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2,", ").concat(t*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2,")")}},{key:"getCaptureTransform",value:function(e){return"translate(".concat((e+(mfe.SIZE/2-this.viewInfo.capturesToPlace.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE,", ").concat(-2*this.SPACE_SIZE-30+this.STROKE_WIDTH+this.SPACE_SIZE/2,")")}},{key:"getAvailableLodestoneTransform",value:function(e){return"translate(".concat((e+(mfe.SIZE/2-this.viewInfo.availableLodestones.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE,", ").concat(30+9*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2,")")}},{key:"getPressurePlateTransform",value:function(e){return"translate(".concat(this.viewInfo.pressurePlateShift[e].x*this.SPACE_SIZE,", ").concat(this.viewInfo.pressurePlateShift[e].y*this.SPACE_SIZE,")")}}]),n}(Vae);$fe.PRESSURE_PLATE_EXTRA_SHIFT=.2,$fe.PRESSURE_PLATES_POSITIONS=ooe.from({top:{startForBigPlate:new Bae(.5,-1-$fe.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new Bae(1.5,0-$fe.PRESSURE_PLATE_EXTRA_SHIFT),direction:Lae.RIGHT},bottom:{startForBigPlate:new Bae(.5,8+$fe.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new Bae(1.5,7+$fe.PRESSURE_PLATE_EXTRA_SHIFT),direction:Lae.RIGHT},left:{startForBigPlate:new Bae(-1-$fe.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new Bae(0-$fe.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:Lae.DOWN},right:{startForBigPlate:new Bae(8+$fe.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new Bae(7+$fe.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:Lae.DOWN}}),$fe.\u0275fac=function(e){return new(e||$fe)(QE(x7))},$fe.\u0275cmp=Gm({type:$fe,selectors:[["app-lodestone"]],features:[xE],decls:6,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 -220 1016 1256","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],["class","base no-fill selected",3,"id",4,"ngIf"],[3,"id","click",4,"ngIf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"id","ngClass",4,"ngIf"],["class","lodestone",4,"ngIf"],[1,"base",3,"id","ngClass"],[1,"lodestone"],["cx","0","cy","0",1,"base","black-fill","outside",3,"ngClass"],["cx","0","cy","0",1,"base","no-stroke",3,"ngClass"],["class","base no-stroke",3,"ngClass",4,"ngIf"],[1,"base","no-stroke",3,"ngClass"],[3,"id"],["cx","0","cy","0",1,"base",3,"ngClass"],["rx","20","ry","20",1,"base",3,"id","ngClass"],[1,"base","no-fill","selected",3,"id"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Lfe,2,1,"g",1),YE(2,Ffe,2,4,"g",2),YE(3,Bfe,5,10,"g",3),YE(4,Hfe,2,2,"g",2),YE(5,Gfe,1,6,"rect",4),tS()),2&e&&(pb(1),XE("ngForOf",t.viewInfo.boardInfo),pb(1),XE("ngForOf",t.viewInfo.capturesToPlace),pb(1),XE("ngForOf",t.viewInfo.availableLodestones),pb(1),XE("ngForOf",t.viewInfo.pressurePlates),pb(1),XE("ngIf",t.viewInfo.selected.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var Wfe=function(){var e=jg(function e(){Wg(this,e)});return e.START_COORD_OUT_OF_RANGE=function(){return $localize(Ho||(Ho=wg(["Start coord cannot be out of range"])))},e.END_COORD_OUT_OF_RANGE=function(){return $localize(Go||(Go=wg(["End coord cannot be out of range"])))},e.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP=function(){return $localize($o||($o=wg(["Pawns must move one step diagonally."])))},e.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS=function(){return $localize(Wo||(Wo=wg(["Drones must move one or two steps in any direction."])))},e}(),qfe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).calledTheClock=i,a}return jg(n,[{key:"toString",value:function(){return"MartianChessMove(("+this.coord.x+", "+this.coord.y+") -> ("+this.end.x+", "+this.end.y+")"+(this.calledTheClock?", CALL_THE_CLOCK":"")+")"}},{key:"equals",value:function(e){return!1!==this.coord.equals(e.coord)&&!1!==this.end.equals(e.end)&&this.calledTheClock===e.calledTheClock}},{key:"isValidForPawn",value:function(){var e=Math.abs(this.coord.x-this.end.x),t=Math.abs(this.coord.y-this.end.y);return 1===e&&1===t}},{key:"isValidForDrone",value:function(){return this.coord.getDistance(this.end)<=2}},{key:"isUndoneBy",value:function(e){if(e.isAbsent())return!1;var t=e.get();return t.end.equals(this.coord)&&t.coord.equals(this.end)}}],[{key:"from",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.isNotInRange(4,8))return S7.failure(Wfe.START_COORD_OUT_OF_RANGE());if(t.isNotInRange(4,8))return S7.failure(Wfe.END_COORD_OUT_OF_RANGE());if(t.equals(e))return S7.failure(Zae.MOVE_CANNOT_BE_STATIC());var i=Lae.factory.fromDelta(t.x-e.x,t.y-e.y);return i.isFailure()?S7.failure(i.getReason()):S7.success(new n(e,t,r))}}]),n}(ose);qfe.encoder=xre.tuple([Bae.numberEncoder(4,8),Bae.numberEncoder(4,8),xre.booleanEncoder],function(e){return[e.coord,e.end,e.calledTheClock]},function(e){return qfe.from(e[0],e[1],e[2]).get()});var jfe=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"getValue",value:function(){return this.value}},{key:"equals",value:function(e){return this.getValue()===e.getValue()}}],[{key:"tryMerge",value:function(t,n){M7(t!==e.EMPTY&&n!==e.EMPTY,"tryMerge cannot be called with empty pieces");var r=t.value+n.value;return 2===r||3===r?lV.of(e.from(r)):lV.empty()}},{key:"from",value:function(t){switch(t){case e.DRONE.value:return e.DRONE;default:return aV.expectToBe(t,e.QUEEN.value),e.QUEEN}}}]),e}();jfe.EMPTY=new jfe(0),jfe.PAWN=new jfe(1),jfe.DRONE=new jfe(2),jfe.QUEEN=new jfe(3);var Zfe=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).ruler=e,i}return jg(n,[{key:"getListMoves",value:function(e){var t,n=e.gameState,r=n.getCurrentPlayer(),i=[],a=Hg(n.getPlayerTerritory(r));try{for(a.s();!(t=a.n()).done;)for(var o=t.value,s=0;s<4;s++)switch(n.getPieceAtXY(s,o)){case jfe.PAWN:i=i.concat(this.getMovesForPawnAt(n,s,o));break;case jfe.DRONE:i=i.concat(this.getMovesForDroneAt(n,s,o));break;case jfe.QUEEN:i=i.concat(this.getMovesForQueenAt(n,s,o))}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"getMovesForPawnAt",value:function(e,t,n){var r,i=new Bae(t,n),a=[],o=Hg(Lae.DIAGONALS);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=i.getNext(s);u.isInRange(4,8)&&a.push(u)}}catch(c){o.e(c)}finally{o.f()}return this.addLegalMoves(e,i,a)}},{key:"addLegalMoves",value:function(e,t,n){var r,i=[],a=e.getPieceAt(t),o=!1===e.isTherePieceOnPlayerSide(jfe.DRONE),s=!1===e.isTherePieceOnPlayerSide(jfe.QUEEN),u=e.lastMove,c=Hg(n);try{for(c.s();!(r=c.n()).done;){var l=r.value,h=e.getPieceAt(l);if(h===jfe.EMPTY)this.add(i,qfe.from(t,l).get(),u);else if(e.isInPlayerTerritory(l)){var f=jfe.tryMerge(h,a);if(f.isPresent()){var d=f.get(),v=qfe.from(t,l).get();(d===jfe.DRONE&&o||d===jfe.QUEEN&&s)&&this.add(i,v,u)}}else this.add(i,qfe.from(t,l).get(),u)}}catch(p){c.e(p)}finally{c.f()}return i}},{key:"add",value:function(e,t,n){!1===t.isUndoneBy(n)&&e.push(t)}},{key:"getMovesForDroneAt",value:function(e,t,n){var r=new Bae(t,n),i=this.getLandingCoordsForLinearMove(r,e,2);return this.addLegalMoves(e,r,i)}},{key:"getLandingCoordsForLinearMove",value:function(e,t,n){var r,i=[],a=Hg(Lae.DIRECTIONS);try{for(a.s();!(r=a.n()).done;){for(var o=r.value,s=1,u=e.getNext(o,s),c=t.tryToGetPieceAt(u),l=c.equalsValue(jfe.EMPTY);l;)i.push(u),s++,u=e.getNext(o,s),l=(c=t.tryToGetPieceAt(u)).equalsValue(jfe.EMPTY)&&s<n;c.isPresent()&&i.push(u)}}catch(h){a.e(h)}finally{a.f()}return i}},{key:"getMovesForQueenAt",value:function(e,t,n){var r=new Bae(t,n),i=this.getLandingCoordsForQueen(r,e);return this.addLegalMoves(e,r,i)}},{key:"getLandingCoordsForQueen",value:function(e,t){return this.getLandingCoordsForLinearMove(e,t,8)}},{key:"getBoardValue",value:function(e){var t,n=this.ruler.getGameStatus(e);if(n.isEndGame)t=n.toBoardValue();else{var r=e.gameState.getScoreOf(Nre.ZERO);t=e.gameState.getScoreOf(Nre.ONE)-r}return new Kae(t)}}]),n}(Yae),Yfe=function(){function e(t){Wg(this,e),this.captures=t,t.makeImmutable()}return jg(e,[{key:"toValue",value:function(){var e=0;return this.captures.forEach(function(t){e+=t.key.getValue()*t.value}),e}},{key:"add",value:function(t){var n=this.captures.getCopy();return e.addToMap(n,t),new e(n)}}],[{key:"from",value:function(t){var n,r=new ooe,i=Hg(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.addToMap(r,a)}}catch(o){i.e(o)}finally{i.f()}return new e(r)}},{key:"addToMap",value:function(e,t){var n=e.get(t);n.isPresent()?e.replace(t,n.get()+1):e.set(t,1)}}]),e}(),Kfe=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lV.empty(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lV.empty(),s=arguments.length>4?arguments[4]:void 0;return Wg(this,n),(i=t.call(this,e,r)).lastMove=a,i.countDown=o,null==s&&(s=new ooe([{key:Nre.ZERO,value:Yfe.from([])},{key:Nre.ONE,value:Yfe.from([])}])),s.makeImmutable(),i.captured=s,i}return jg(n,[{key:"getPlayerTerritory",value:function(e){return e===Nre.ZERO?n.PLAYER_ZERO_TERRITORY:n.PLAYER_ONE_TERRITORY}},{key:"isTherePieceOnPlayerSide",value:function(e){var t,n=this.getCurrentPlayer(),r=Hg(this.getPlayerTerritory(n));try{for(r.s();!(t=r.n()).done;)for(var i=t.value,a=0;a<4;a++)if(this.getPieceAtXY(a,i)===e)return!0}catch(o){r.e(o)}finally{r.f()}return!1}},{key:"getScoreOf",value:function(e){return this.captured.get(e).get().toValue()}},{key:"getEmptyTerritory",value:function(){return this.isTerritoryEmpty(Nre.ZERO)?lV.of(Nre.ZERO):this.isTerritoryEmpty(Nre.ONE)?lV.of(Nre.ONE):lV.empty()}},{key:"isTerritoryEmpty",value:function(e){var t,n=Hg(this.getPlayerTerritory(e));try{for(n.s();!(t=n.n()).done;)for(var r=t.value,i=0;i<4;i++)if(this.getPieceAtXY(i,r)!==jfe.EMPTY)return!1}catch(a){n.e(a)}finally{n.f()}return!0}},{key:"isInOpponentTerritory",value:function(e){var t=this.getCurrentOpponent();return this.getPlayerTerritory(t).contains(e.y)}},{key:"isInPlayerTerritory",value:function(e){var t=this.getCurrentPlayer();return this.getPlayerTerritory(t).contains(e.y)}},{key:"getCapturesOf",value:function(e){var t=this.captured.get(Nre.fromTurn(e)).get();return[t.captures.get(jfe.PAWN).getOrElse(0),t.captures.get(jfe.DRONE).getOrElse(0),t.captures.get(jfe.QUEEN).getOrElse(0)]}}],[{key:"getInitialState",value:function(){var e=jfe.EMPTY,t=jfe.PAWN,r=jfe.DRONE,i=jfe.QUEEN;return new n([[i,i,r,e],[i,r,t,e],[r,t,t,e],[e,e,e,e],[e,e,e,e],[e,t,t,r],[e,t,r,i],[e,r,i,i]],0,lV.empty())}}]),n}(eoe);Kfe.PLAYER_ZERO_TERRITORY=new Xae([0,1,2,3]),Kfe.PLAYER_ONE_TERRITORY=new Xae([4,5,6,7]);var Qfe=function(){var e=jg(function e(){Wg(this,e)});return e.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY=function(){return $localize(qo||(qo=wg(["You must pick a piece from your side of the board in order to move it."])))},e.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT=function(){return $localize(jo||(jo=wg(["This is not a valid promotion nor a valid capture."])))},e.CANNOT_UNDO_LAST_MOVE=function(){return $localize(Zo||(Zo=wg(["You cannot perform a move that is the reverse of the previous one."])))},e}(),Xfe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){var i=t.getCopiedBoard();i[e.coord.y][e.coord.x]=jfe.EMPTY,i[e.end.y][e.end.x]=r.finalPiece;var a=r.score,o=t.countDown;if(o.isPresent())if(this.isCapture(e,t))o=n.STARTING_COUNT_DOWN;else{var s=t.countDown.get();o=lV.of(s-1)}return e.calledTheClock&&(o=n.STARTING_COUNT_DOWN),new Kfe(i,t.turn+1,lV.of(e),o,a)}},{key:"isLegal",value:function(e,t){this.assertNonDoubleClockCall(e,t);var n=this.isLegalMove(e,t);if(n.isFailure())return S7.failure(n.getReason());if(e.isUndoneBy(t.lastMove))return S7.failure(Qfe.CANNOT_UNDO_LAST_MOVE());if(this.isFieldPromotion(e,t))return this.isLegalFieldPromotion(e,t);var r=t.getPieceAt(e.coord),i=t.captured.getCopy();if(this.isCapture(e,t)){var a=t.getCurrentPlayer(),o=i.get(a).get(),s=t.getPieceAt(e.end);o=o.add(s),i.replace(a,o),i.makeImmutable()}return S7.success({finalPiece:r,score:i})}},{key:"assertNonDoubleClockCall",value:function(e,t){M7(!1===(t.countDown.isPresent()&&e.calledTheClock),"Should not call the clock twice")}},{key:"isCapture",value:function(e,t){var n=t.isInOpponentTerritory(e.end),r=t.getPieceAt(e.end)!==jfe.EMPTY;return n&&r}},{key:"isFieldPromotion",value:function(e,t){var n=t.isInPlayerTerritory(e.end),r=t.getPieceAt(e.end)!==jfe.EMPTY;return n&&r}},{key:"isLegalFieldPromotion",value:function(e,t){var n=this.getPromotedPiece(e,t);if(n.isAbsent())return S7.failure(Qfe.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());var r=n.get();if(t.isTherePieceOnPlayerSide(r))return S7.failure(Qfe.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());var i={finalPiece:r,score:t.captured.getCopy()};return S7.success(i)}},{key:"isLegalMove",value:function(e,t){if(!1===t.isInPlayerTerritory(e.coord))return S7.failure(Qfe.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY());var n=t.getPieceAt(e.coord);if(n===jfe.EMPTY)return S7.failure(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(n===jfe.PAWN)return e.isValidForPawn()?S7.success(void 0):S7.failure(Wfe.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP());if(n===jfe.DRONE&&!1===e.isValidForDrone())return S7.failure(Wfe.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS());var r,i=Hg(e.coord.getUntil(e.end));try{for(i.s();!(r=i.n()).done;){var a=r.value;if(t.getPieceAt(a)!==jfe.EMPTY)return S7.failure(Zae.SOMETHING_IN_THE_WAY())}}catch(o){i.e(o)}finally{i.f()}return S7.success(void 0)}},{key:"getPromotedPiece",value:function(e,t){var n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end);return jfe.tryMerge(n,r)}},{key:"getGameStatus",value:function(e){var t=e.gameState;if(t.countDown.equalsValue(0))return this.getGameStatusScoreVictoryOr(t,loe.DRAW);if(t.getEmptyTerritory().isPresent()){var n=t.getCurrentOpponent(),r=loe.getVictory(n);return this.getGameStatusScoreVictoryOr(t,r)}return loe.ONGOING}},{key:"getGameStatusScoreVictoryOr",value:function(e,t){var n=e.getScoreOf(Nre.ZERO),r=e.getScoreOf(Nre.ONE);return n>r?loe.ZERO_WON:r>n?loe.ONE_WON:t}}]),n}(hoe);Xfe.STARTING_COUNT_DOWN=lV.of(7);var Jfe=function(){var e=jg(function e(){Wg(this,e)});return e.YOU_DID_NOT_CAPTURE_ANY_PIECE=function(){return $localize(Yo||(Yo=wg(["Failed, you did not capture any piece."])))},e}(),ede=jfe.EMPTY,tde=jfe.PAWN,nde=jfe.DRONE,rde=jfe.QUEEN,ide=function(){return $localize(Ko||(Ko=wg(["This is not a field promotion!"])))},ade=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Qo||(Qo=wg(["Goal of the game"]))),$localize(Xo||(Xo=wg(["At Martian Chess, the goal is to have the most points at the end of the game. Each piece is assigned a value, you win this value when capturing the piece. The board is divided in two by a line called the canal. There is one side for each player. You do not own pieces, but you control the ones on your side of the canal. Pieces are colored to help you: they will change color when crossing the canal."]))),Kfe.getInitialState()),poe.informational($localize(Jo||(Jo=wg(["The pieces"]))),$localize(es||(es=wg(["The pieces are dark on the side of the first player, the light ones on the side of the second one. There are 3 kind of pieces: <ul><li>The Queens: represented as circles with 3 dots.</li><li>The Drones: represented as circles with 2 dots.</li><li>The Pawns: represented as circles with one dot.</li></ul>"]))),Kfe.getInitialState()),poe.fromPredicate($localize(ts||(ts=wg(["Moving pawns"]))),$localize(ns||(ns=wg(["Pawns are worth one point. They can move one step diagonally.<br/><br/>You're playing Dark, move a pawn."]))),Kfe.getInitialState(),qfe.from(new Bae(1,2),new Bae(2,3)).get(),function(e,t){return t.getPieceAt(e.end)===jfe.PAWN?T7.SUCCESS:T7.failure($localize(rs||(rs=wg(["This is not a pawn!"]))))},$localize(is||(is=wg(["Congratulations!"])))),poe.fromPredicate($localize(as||(as=wg(["Moving drones"]))),$localize(os||(os=wg(["Drones are worth two points. They can move one or two steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a drone."]))),Kfe.getInitialState(),qfe.from(new Bae(2,0),new Bae(3,0)).get(),function(e,t){return t.getPieceAt(e.end)===jfe.DRONE?T7.SUCCESS:T7.failure($localize(ss||(ss=wg(["This is not a drone!"]))))},$localize(us||(us=wg(["Congratulations!"])))),poe.fromPredicate($localize(cs||(cs=wg(["Moving queens"]))),$localize(ls||(ls=wg(["Queens are worth three points. They can move any number of steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a queen."]))),new Kfe([[nde,tde,ede,ede],[rde,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,rde,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[rde,nde,tde,ede]],0),qfe.from(new Bae(2,3),new Bae(2,7)).get(),function(e,t){return t.getPieceAt(e.end)===jfe.QUEEN?T7.SUCCESS:T7.failure($localize(hs||(hs=wg(["This is not a queen!"]))))},$localize(fs||(fs=wg(["Congratulations!"])))),poe.fromMove($localize(ds||(ds=wg(["Capture"]))),$localize(vs||(vs=wg(["When a piece crosses the canal and lands on another piece, you capture it and gain the value of that captured piece. However, you lose control of your piece as it crosses the canal!<br/><br/>A capture is possible for Dark, do it."]))),new Kfe([[nde,tde,tde,ede],[ede,ede,ede,ede],[rde,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,tde,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,nde,tde,ede]],0),[qfe.from(new Bae(0,2),new Bae(2,4)).get()],$localize(ps||(ps=wg(["Congratulations! By capturing that pawn, you won one point."]))),Jfe.YOU_DID_NOT_CAPTURE_ANY_PIECE()),poe.fromMove($localize(gs||(gs=wg(["Field Promotion (1/2)"]))),$localize(ys||(ys=wg(["It is sometimes possible to perform what is called a field promotion. If you are out of one type of piece, you can merge two pieces to add their value and get a new piece. For example, if you have no drones, you can merge two pawns into a drone. To merge two pawns, move one of your pawns on another.<br/><br/>Such a move is possible for Dark. Do it."]))),new Kfe([[ede,ede,ede,rde],[ede,tde,ede,ede],[ede,ede,tde,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,rde],[ede,ede,nde,ede],[ede,tde,ede,ede]],0),[qfe.from(new Bae(1,1),new Bae(2,2)).get(),qfe.from(new Bae(2,2),new Bae(1,1)).get()],$localize(ms||(ms=wg(["Congratulations!"]))),ide()),poe.fromPredicate($localize(ks||(ks=wg(["Field Promotion (2/2)"]))),$localize(_s||(_s=wg(["The other kind of field promotion is to merge a drone and a pawn to obtain a queen.<br/><br/>Such a move is possible for Light. Do it."]))),new Kfe([[tde,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,nde,ede],[ede,tde,ede,ede]],1),qfe.from(new Bae(1,7),new Bae(2,6)).get(),function(e,t){return t.getPieceAt(e.end)===jfe.QUEEN?T7.SUCCESS:T7.failure(ide())},$localize(Cs||(Cs=wg(["Congratulations!"])))),poe.fromPredicate($localize(ws||(ws=wg(["Call the clock"]))),$localize(bs||(bs=wg(['When the game seems to be going nowhere, you can "call the clock" during your turn. To do so, click on the clock symbol on the right, then perform your move. Once the clock is called, seven more turn will be played.<br/><br/>You\'re playing Dark. Call the clock and perform a move.']))),Kfe.getInitialState(),qfe.from(new Bae(2,2),new Bae(3,3),!0).get(),function(e,t){return e.calledTheClock?T7.SUCCESS:T7.failure($localize(Es||(Es=wg(["You did not call the clock!"]))))},$localize(Ss||(Ss=wg(["Congratulations!"])))),poe.fromMove($localize(Ps||(Ps=wg(["Restarting the clock"]))),$localize(Os||(Os=wg(["If the clock has been called, whenever a capture is done the countdown restarts.<br/><br/>You are playing Dark, do a capture to restart the countdown."]))),new Kfe([[ede,ede,ede,ede],[ede,tde,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,tde],[ede,ede,nde,ede],[ede,tde,ede,ede]],14,lV.empty(),lV.of(1)),[qfe.from(new Bae(1,1),new Bae(2,2)).get()],$localize(Ts||(Ts=wg(["Congratulations!"]))),$localize(Is||(Is=wg(["This is not a capture, the game is now over, please retry!"])))),poe.anyMove($localize(As||(As=wg(["End game (by clock)"]))),$localize(xs||(xs=wg(["When seven turns have passed after the clock has been called, the player with the most points win. If both player have the same number of points, it is a tie.<br/><br/>You are playing Dark, do the last move."]))),new Kfe([[ede,ede,ede,rde],[ede,tde,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[nde,ede,ede,ede],[ede,ede,ede,ede],[ede,nde,ede,ede]],14,lV.empty(),lV.of(1)),qfe.from(new Bae(1,1),new Bae(2,2)).get(),$localize(Rs||(Rs=wg(["Congratulations!"])))),poe.fromPredicate($localize(Ms||(Ms=wg(["End by emptyness"]))),$localize(Ns||(Ns=wg(["When a player's last piece is moved into the opponent territory, the game ends. If both players have the same number of points, the last player win!<br/><br/>Light player can win this way, do it!"]))),new Kfe([[ede,ede,ede,rde],[ede,tde,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,tde,ede],[ede,ede,ede,ede],[ede,ede,ede,ede],[ede,ede,ede,ede]],1),qfe.from(new Bae(2,4),new Bae(1,3)).get(),function(e,t){return 3===e.end.y?T7.SUCCESS:T7.failure($localize(Ds||(Ds=wg(["Your piece is still in you territory!"]))))},$localize(Ls||(Ls=wg(["Congratulations!"]))))]});function ode(e,t){if(1&e&&(c_(),nS(0,"g",20)),2&e){var n=hS(2).index,r=hS().index,i=hS();PS(i.style),vS("mainShapeId","pawn_",n,"_",r,""),XE("pieceClasses",i.getPieceClasses(n,r))}}function sde(e,t){if(1&e&&(c_(),nS(0,"g",21)),2&e){var n=hS(2).index,r=hS().index,i=hS();PS(i.style),vS("mainShapeId","drone_",n,"_",r,""),XE("pieceClasses",i.getPieceClasses(n,r))}}function ude(e,t){if(1&e&&(c_(),nS(0,"g",22)),2&e){var n=hS(2).index,r=hS().index,i=hS();PS(i.style),vS("mainShapeId","queen_",n,"_",r,""),XE("pieceClasses",i.getPieceClasses(n,r))}}function cde(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,ode,1,5,"g",17),YE(2,sde,1,5,"g",18),YE(3,ude,1,5,"g",19),tS()),2&e){var n=hS(),r=n.index,i=n.$implicit,a=hS().index,o=hS();$E("transform",o.getPieceLocation(r,a)),pb(1),XE("ngIf",i===o.pieces.PAWN),pb(1),XE("ngIf",i===o.pieces.DRONE),pb(1),XE("ngIf",i===o.pieces.QUEEN)}}function lde(e,t){if(1&e){var n=aS();c_(),eS(0,"g",15),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),nS(1,"rect",16),YE(2,cde,4,4,"g",14),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();vS("id","click_",i,"_",a,""),$E("transform","translate(0,  "+(a<=3?0:2*o.STROKE_WIDTH)+")"),pb(1),vS("id","square_",i,"_",a,""),XE("ngClass",o.getSquareClasses(i,a)),$E("x",i*o.SPACE_SIZE)("y",a*o.SPACE_SIZE)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r!==o.pieces.EMPTY)}}function hde(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",23),uS("click",function(){var e=Nk(n).$implicit;return hS(3).onClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS(3);pb(1),vS("id","indicator_",r.x,"_",r.y,""),$E("transform","translate(0,  "+(r.y<=3?0:2*i.STROKE_WIDTH)+")")("x",r.x*i.SPACE_SIZE+(i.SPACE_SIZE/2-i.INDICATOR_SIZE/2))("y",r.y*i.SPACE_SIZE+(i.SPACE_SIZE/2-i.INDICATOR_SIZE/2))("width",i.INDICATOR_SIZE)("height",i.INDICATOR_SIZE)}}function fde(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,hde,2,7,"g",1),tS()),2&e){var n=hS(2);pb(1),XE("ngForOf",n.selectedPieceInfo.get().legalLandings)}}function dde(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,lde,3,11,"g",13),YE(2,fde,2,1,"g",14),tS()),2&e){var n=t.$implicit,r=hS();$E("transform","translate("+r.SPACE_SIZE+", 0)"),pb(1),XE("ngForOf",n),pb(1),XE("ngIf",r.selectedPieceInfo.isPresent())}}function vde(e,t){if(1&e&&(c_(),eS(0,"text",24),FS(1),tS()),2&e){var n=hS();XE("ngClass","player"+n.getCurrentPlayer().value)("ngClass",n.getClockCircleClasses()),$E("x",.5*n.SPACE_SIZE)("y",.5*n.SPACE_SIZE),pb(1),US(n.countDown.get())}}function pde(e,t){if(1&e&&(c_(),nS(0,"polyline",25)),2&e){var n=hS();XE("ngClass",n.getClockCircleClasses()),$E("points",n.clockNeedlesPoints)}}var gde=function(e){return[e]};function yde(e,t){if(1&e){var n=aS();c_(),rS(0),eS(1,"g",28),uS("click",function(){var e=Nk(n).index;return hS(2).chooseStyle(e)}),tS(),iS()}if(2&e){var r=t.$implicit,i=t.index,a=hS(2);pb(1),PS(r.style),XE("id",r.name)("pieceClasses",oT(5,gde,"player"+a.getCurrentPlayer().value)),$E("transform","translate(0, "+-(i+1)*a.SPACE_SIZE+")")}}function mde(e,t){if(1&e&&(c_(),eS(0,"g",26),nS(1,"rect",27),YE(2,yde,2,7,"ng-container",1),tS()),2&e){var n=hS();pb(1),$E("x",0)("y",-n.listOfStyles.length*n.SPACE_SIZE)("width",1*n.SPACE_SIZE)("height",n.listOfStyles.length*n.SPACE_SIZE),pb(1),XE("ngForOf",n.listOfStyles)}}function kde(e,t){if(1&e&&(c_(),eS(0,"text",34),FS(1),tS()),2&e){var n=hS(2).$implicit,r=hS().$implicit,i=hS();XE("ngClass","player"+(0===r?1:0)),$E("x",i.SPACE_SIZE/2)("y",i.SPACE_SIZE/2),pb(1),US(n+" x ")}}function _de(e,t){if(1&e&&(c_(),nS(0,"g",35)),2&e){var n=hS(3).$implicit;PS(hS().style),XE("pieceClasses",oT(3,gde,"player"+(0===n?1:0)))}}function Cde(e,t){if(1&e&&(c_(),nS(0,"g",36)),2&e){var n=hS(3).$implicit;PS(hS().style),XE("pieceClasses",oT(3,gde,"player"+(0===n?1:0)))}}function wde(e,t){if(1&e&&(c_(),nS(0,"g",37)),2&e){var n=hS(3).$implicit;PS(hS().style),XE("pieceClasses",oT(3,gde,"player"+(0===n?1:0)))}}function bde(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,kde,2,4,"text",30),eS(2,"g",29),YE(3,_de,1,5,"g",31),YE(4,Cde,1,5,"g",32),YE(5,wde,1,5,"g",33),tS(),tS()),2&e){var n=hS(),r=n.index,i=n.$implicit,a=hS().$implicit,o=hS();$E("transform","translate(0, "+2*r*o.SPACE_SIZE+")"),pb(1),XE("ngIf",i>1),pb(1),vS("id","piece_",r,"_player_",a,""),$E("transform","translate("+o.SPACE_SIZE+", 0)"),pb(1),XE("ngIf",0===r),pb(1),XE("ngIf",1===r),pb(1),XE("ngIf",2===r)}}function Ede(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,bde,6,8,"g",14),tS()),2&e){var n=t.$implicit;pb(1),XE("ngIf",n>0)}}function Sde(e,t){if(1&e&&(c_(),eS(0,"g"),eS(1,"g",29),YE(2,Ede,2,1,"g",1),tS(),tS()),2&e){var n=t.$implicit,r=hS();pb(1),dS("id","capture_of_player_",n,""),$E("transform","scale(0.5, 0.5) translate("+-r.SPACE_SIZE/2+", "+(r.SPACE_SIZE/2+n*(10*r.SPACE_SIZE+4*r.STROKE_WIDTH))+")"),pb(1),XE("ngForOf",r.state.getCapturesOf(n))}}var Pde=function(){return[0,1]},Ode=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).INDICATOR_SIZE=20,r.LEFT=n.SPACE_SIZE/-4+n.STROKE_WIDTH/-2,r.UP=-n.STROKE_WIDTH/2,r.WIDTH=6.5*n.SPACE_SIZE+n.STROKE_WIDTH,r.HEIGHT=8*n.SPACE_SIZE+3*n.STROKE_WIDTH,r.MartianChessComponent=n,r.style={shape:"Circle",points:"Horizontal Points"},r.pieces=jfe,r.selectedPieceInfo=lV.empty(),r.countDown=lV.empty(),r.callTheClock=!1,r.displayModePanel=!1,r.listOfStyles=[{name:"Star",style:{shape:"Star",points:"Dots"}},{name:"Polygon",style:{shape:"Polygon",points:"Concentric Circles"}},{name:"Simple",style:{shape:"Circle",points:"Horizontal Points"}},{name:"Circely",style:{shape:"Circle",points:"Concentric Circles"}}],r.rules=new Xfe(Kfe),r.availableMinimaxes=[new Zfe(r.rules,"Martian Chess Dummy Minimax")],r.SPACE_SIZE=n.SPACE_SIZE,r.configCogTransformation=r.getConfigCogTransformation(),r.configViewTranslation=r.getConfigViewTranslation(),r.clockNeedlesPoints=r.getClockNeedlesPoints(),r.encoder=qfe.encoder,r.tutorial=(new ade).tutorial,r.scores=lV.of([0,0]),r.updateBoard(),r}return jg(n,[{key:"getConfigViewTranslation",value:function(){return"translate("+(5.25*this.SPACE_SIZE+0)+", "+(7*this.SPACE_SIZE+0+2*this.STROKE_WIDTH)+")"}},{key:"getConfigCogTransformation",value:function(){var e=this.STROKE_WIDTH,t=(this.SPACE_SIZE-e)/40;return"translate("+1*e+", "+1*e+") scale("+t+" "+t+")"}},{key:"getClockNeedlesPoints",value:function(){var e=.5*this.SPACE_SIZE;return e+" "+.1*this.SPACE_SIZE+", "+e+" "+e+", "+.75*this.SPACE_SIZE+" "+e}},{key:"updateBoard",value:function(){this.state=this.rules.node.gameState,this.board=this.state.board;var e=this.state.getScoreOf(Nre.ZERO),t=this.state.getScoreOf(Nre.ONE);this.countDown=this.state.countDown,this.scores=lV.of([e,t])}},{key:"getPieceLocation",value:function(e,t){return"translate("+this.SPACE_SIZE*e+", "+this.SPACE_SIZE*t+")"}},{key:"getPieceClasses",value:function(e,t){var n=new Bae(e,t),r=[];return r.push(t<=3?"player0":"player1"),this.selectedPieceInfo.isPresent()&&this.selectedPieceInfo.get().selectedPiece.equals(n)&&r.push("highlighted"),this.rules.node.move.isPresent()&&this.rules.node.move.get().end.equals(n)&&this.rules.node.mother.get().gameState.getPieceAt(n)!==jfe.EMPTY&&this.rules.node.gameState.isInOpponentTerritory(new Bae(0,t))&&r.push("highlighted"),r}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.displayModePanel=!1,!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=4;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 4:return a=new Bae(e,t),r.abrupt("return",n.selectedPieceInfo.isPresent()?n.secondClick(a):n.firstClick(a));case 6:case"end":return r.stop()}},r)}))()}},{key:"firstClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.isOneOfUsersPieces(e)?t.selectAsFirstPiece(e):(t.cancelMoveAttempt(),T7.SUCCESS));case 1:case"end":return n.stop()}},n)}))()}},{key:"selectAsFirstPiece",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.getLegalLandings(e),n.abrupt("return",(t.selectedPieceInfo=lV.of({selectedPiece:e,legalLandings:r}),T7.SUCCESS));case 2:case"end":return n.stop()}},n)}))()}},{key:"getLegalLandings",value:function(e){var t=this,n=this.state.getPieceAt(e);return(n===jfe.PAWN?Lae.DIAGONALS.map(function(t){return e.getNext(t)}):this.getValidLinearLandingSquareUntil(e,n===jfe.DRONE?2:8)).filter(function(n){var r=qfe.from(e,n);return!!r.isSuccess()&&t.rules.isLegal(r.get(),t.getState()).isSuccess()})}},{key:"getValidLinearLandingSquareUntil",value:function(e,t){var n=this;return Lae.DIRECTIONS.flatMap(function(r){for(var i=[],a=e.getNext(r),o=1;a.isInRange(4,8)&&o<=t&&(i.push(a),n.getState().getPieceAt(a)===jfe.EMPTY);)a=a.getNext(r),o++;return i})}},{key:"secondClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.selectedPieceInfo.get()).selectedPiece.equals(e)){n.next=3;break}return n.abrupt("return",(t.cancelMoveAttempt(),T7.SUCCESS));case 3:if(!r.legalLandings.some(function(t){return t.equals(e)})){n.next=8;break}return M7((i=qfe.from(r.selectedPiece,e,t.callTheClock)).isSuccess(),"MartianChessComponent or Rules did a mistake thinking this would have been a legal move!"),a=t.rules.node.gameState,n.abrupt("return",t.chooseMove(i.get(),a));case 8:if(!t.isOneOfUsersPieces(e)){n.next=10;break}return n.abrupt("return",t.selectAsFirstPiece(e));case 10:return o=qfe.from(r.selectedPiece,e,t.callTheClock),n.abrupt("return",o.isSuccess()?t.chooseMove(o.get(),t.getState()):t.cancelMove(o.getReason()));case 12:case"end":return n.stop()}},n)}))()}},{key:"isOneOfUsersPieces",value:function(e){return this.state.getPieceAt(e)!==jfe.EMPTY&&this.state.isInPlayerTerritory(e)}},{key:"cancelMoveAttempt",value:function(){this.selectedPieceInfo=lV.empty(),this.callTheClock=!1}},{key:"onClockClick",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.canUserPlay("#clockOrCountDownView"),t.abrupt("return",n.isFailure()?e.cancelMove(n.getReason()):(e.getState().countDown.isAbsent()&&(e.callTheClock=!e.callTheClock),T7.SUCCESS));case 2:case"end":return t.stop()}},t)}))()}},{key:"getClockCircleClasses",value:function(){var e=["base"];return this.callTheClock&&e.push("highlighted"),this.getCurrentPlayer()===Nre.ZERO?e.push("player0-stroke"):e.push("player1-stroke"),e}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t),r=["base"];if(this.rules.node.move.isPresent()){var i=this.rules.node,a=i.move.get();a.coord.equals(n)?r.push("moved"):a.end.equals(n)&&(i.mother.get().gameState.getPieceAt(n)===jfe.EMPTY||i.gameState.isInOpponentTerritory(new Bae(0,t))?r.push("moved"):r.push("captured"))}return r}},{key:"onModeCogClick",value:function(){this.displayModePanel=!this.displayModePanel}},{key:"chooseStyle",value:function(e){this.style=this.listOfStyles[e].style,this.displayModePanel=!1}}],[{key:"getRegularPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=n.getRegularPolygonCoords(e,t);return n.mapCoordsToString(r)}},{key:"getNPointedStar",value:function(e,t){var r=this.getNPointedStarCoords(e,t);return n.mapCoordsToString(r)}},{key:"getNPointedStarCoords",value:function(e,t){var r=[],i=.5*n.SPACE_SIZE,a=.5*n.SPACE_SIZE;e*=2;for(var o=0;o<e;o++){var s=(o*(360/e)+t)/180*Math.PI,u=o%2==0?n.SPACE_SIZE/2:n.SPACE_SIZE/6,c=i+.8*u*Math.cos(s),l=a+.8*u*Math.sin(s);r.push(new Bae(c,l))}return r}},{key:"getRegularPolygonCoords",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],i=.5*n.SPACE_SIZE,a=.5*n.SPACE_SIZE,o=0;o<e;o++){var s=(o*(360/e)-90)/180*Math.PI,u=.5*n.SPACE_SIZE,c=i+.8*u*Math.cos(s),l=a+.8*u*Math.sin(s)+t;r.push(new Bae(c,l))}return r}},{key:"mapCoordsToString",value:function(e){var t,n="",r=Hg(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=i.x+", "+i.y+" "}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"getRadius",value:function(e){return this.SPACE_SIZE*e/10}}]),n}(Koe);return e.SPACE_SIZE=100,e.STROKE_WIDTH=8,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-martian-chess"]],features:[xE],decls:15,vars:25,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["id","clockOrCountDownView",3,"click"],["x","0","y","0",1,"transparent"],["id","clockOrCountDownCircle",3,"ngClass"],["id","countDownText","class","text-giant text-center",3,"ngClass",4,"ngIf"],["class","base","stroke-linecap","round",3,"ngClass",4,"ngIf"],["id","canal",3,"ngClass"],["id","modeCogView"],["id","modeCog",3,"click"],["d","M35.497,15.111h-1.656c-0.282-0.924-0.653-1.807-1.102-2.646l1.176-1.175c1.364-1.366,1.366-3.582,0-4.949l-1.258-1.258 c-0.656-0.656-1.548-1.025-2.476-1.025l0,0c-0.93,0-1.818,0.369-2.477,1.025l-1.176,1.175c-0.838-0.446-1.721-0.817-2.645-1.102 V3.501c0-1.934-1.566-3.5-3.5-3.5h-1.778c-1.934,0-3.5,1.566-3.5,3.5v1.655c-0.923,0.282-1.807,0.653-2.645,1.102l-1.174-1.175 c-1.367-1.367-3.584-1.367-4.951,0L5.081,6.34c-1.367,1.366-1.367,3.583,0,4.949l1.174,1.175c-0.446,0.84-0.818,1.723-1.102,2.646 H3.5c-1.934,0-3.5,1.566-3.5,3.5v1.778c0,1.932,1.566,3.5,3.5,3.5h1.654c0.283,0.922,0.654,1.807,1.102,2.645l-1.175,1.176 c-1.366,1.365-1.366,3.582-0.001,4.949l1.258,1.258c0.656,0.654,1.547,1.023,2.475,1.023h0.001c0.929,0,1.818-0.369,2.475-1.023 l1.176-1.176c0.837,0.447,1.722,0.818,2.644,1.102v1.656c0,1.932,1.566,3.5,3.5,3.5h1.778c1.934,0,3.5-1.568,3.5-3.5v-1.656 c0.924-0.283,1.807-0.654,2.645-1.102l1.177,1.176c0.655,0.656,1.547,1.023,2.476,1.023c0.93,0,1.817-0.369,2.477-1.023 l1.256-1.258c1.366-1.367,1.365-3.582,0-4.949l-1.176-1.174c0.447-0.84,0.818-1.725,1.102-2.646h1.656c1.934,0,3.5-1.568,3.5-3.5 v-1.777C38.997,16.679,37.43,15.111,35.497,15.111z M19.499,27.499c-4.41,0-8-3.588-8-8c0-4.411,3.59-8,8-8c4.412,0,8,3.589,8,8 C27.499,23.911,23.911,27.499,19.499,27.499z",3,"ngClass"],["id","modePanel",4,"ngIf"],["id","captures"],[3,"id","click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"id","click"],[3,"id","ngClass"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId","style",4,"ngIf"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses"],[1,"indicator",3,"id","click"],["id","countDownText",1,"text-giant","text-center",3,"ngClass"],["stroke-linecap","round",1,"base",3,"ngClass"],["id","modePanel"],["stroke-width","8",1,"base"],["app-martian-chess-queen","",3,"id","pieceClasses","click"],[3,"id"],["class","text-giant text-center",3,"ngClass",4,"ngIf"],["app-martian-chess-pawn","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-queen","",3,"pieceClasses","style",4,"ngIf"],[1,"text-giant","text-center",3,"ngClass"],["app-martian-chess-pawn","",3,"pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses"],["app-martian-chess-queen","",3,"pieceClasses"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,dde,3,3,"g",1),eS(2,"g",2),uS("click",function(){return t.onClockClick()}),nS(3,"rect",3),nS(4,"circle",4),YE(5,vde,2,5,"text",5),YE(6,pde,1,2,"polyline",6),tS(),nS(7,"line",7),eS(8,"g",8),eS(9,"g",9),uS("click",function(){return t.onModeCogClick()}),nS(10,"rect",3),nS(11,"path",10),tS(),YE(12,mde,3,5,"g",11),tS(),eS(13,"g",12),YE(14,Sde,3,3,"g",1),tS(),tS()),2&e&&($E("viewBox",t.LEFT+" "+t.UP+" "+t.WIDTH+" "+t.HEIGHT),pb(1),XE("ngForOf",t.board),pb(1),$E("transform","translate("+5.25*t.SPACE_SIZE+", 0)"),pb(1),$E("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),pb(1),XE("ngClass",t.getClockCircleClasses()),$E("cx",.5*t.SPACE_SIZE)("cy",.5*t.SPACE_SIZE)("r",.4*t.SPACE_SIZE),pb(1),XE("ngIf",t.countDown.isPresent()),pb(1),XE("ngIf",t.countDown.isAbsent()),pb(1),XE("ngClass","player"+t.getCurrentPlayer().value),$E("x1",t.SPACE_SIZE)("y1",5*t.SPACE_SIZE+8)("x2",5*t.SPACE_SIZE)("y2",5*t.SPACE_SIZE+8)("stroke-width",2*t.STROKE_WIDTH),pb(1),$E("transform",t.configViewTranslation),pb(2),$E("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),pb(1),XE("ngClass","player"+t.getCurrentPlayer().value),$E("transform",t.configCogTransformation),pb(1),XE("ngIf",t.displayModePanel),pb(2),XE("ngForOf",aT(24,Pde)))},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Tde=Number.MAX_SAFE_INTEGER,Ide=Number.MIN_SAFE_INTEGER,Ade=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,Ure.copyBiArray(n.initialBoard),e)).turn=e,i.location=r,i}return jg(n,null,[{key:"getInitialState",value:function(){return new n(0,new Bae(0,0))}}]),n}(eoe);Ade.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],Ade.BOARD_1=[[0,+Tde,-1,-1],[1,2,+Tde,-1],[+Ide,3,4,-1],[-1,+Ide,+Ide,-1]],Ade.BOARD_2=[[0,+Tde,-1,-1],[+Tde,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],Ade.BOARD_3=[[0,1,+Ide,-1],[1,+Ide,-1,-1],[+Ide,-1,-1,-1],[-1,-1,-1,-1]],Ade.BOARD_4=[[0,1,+Ide,-1],[1,+Ide,-1,-1],[+Ide,-1,-1,-1],[-1,-1,-1,1]],Ade.initialBoard=Ade.BOARD_0;var xde=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){var r=new Bae(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new Ade(t.turn+1,r)}},{key:"isLegal",value:function(e,t){var n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?S7.failure("incorrect move"):S7.success(void 0)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"getGameStatus",value:function(e){var t=e.gameState,n=t.getPieceAt(t.location);return n===Nre.ZERO.getVictoryValue()?loe.ZERO_WON:n===Nre.ONE.getVictoryValue()?loe.ONE_WON:t.location.equals(new Bae(3,3))?0===n?loe.DRAW:n>0?loe.ONE_WON:loe.ZERO_WON:loe.ONGOING}}]),n}(hoe),Rde=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).right=e,r}return jg(n,[{key:"equals",value:function(e){return this===e||this.right===e.right}},{key:"toString",value:function(){return this.right?"Move RIGHT":"Move DOWN"}}]),n}(noe);Rde.RIGHT=new Rde(!0),Rde.DOWN=new Rde(!1),Rde.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 1}},{key:"decodeNumber",value:function(e){return 0===e?Rde.RIGHT:Rde.DOWN}},{key:"encodeNumber",value:function(e){return e.right?0:1}}]),n}(xre));var Mde=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=xde.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n=e.gameState;return new Kae(n.getPieceAt(n.location))}},{key:"getListMoves",value:function(e){var t=[],n=e.gameState;return n.location.x<3&&t.push(Rde.RIGHT),n.location.y<3&&t.push(Rde.DOWN),t}}]),n}(Yae);function Nde(e,t){1&e&&(rS(0),FS(1,"("),iS())}function Dde(e,t){1&e&&(rS(0),FS(1,")"),iS())}function Lde(e,t){if(1&e&&(eS(0,"td"),YE(1,Nde,2,0,"ng-container",3),FS(2),YE(3,Dde,2,0,"ng-container",3),tS()),2&e){var n=t.$implicit,r=t.index,i=hS().index,a=hS();pb(1),XE("ngIf",a.coord.x===r&&a.coord.y===i),pb(1),BS(" ",n," "),pb(1),XE("ngIf",a.coord.x===r&&a.coord.y===i)}}function Fde(e,t){if(1&e&&(eS(0,"tr"),YE(1,Lde,4,3,"td",0),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var Ude=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).coord=new Bae(-1,-1),r.rules=new xde(Ade),r.availableMinimaxes=[new Mde(r.rules,"MinimaxTestingMinimax")],r.encoder=Rde.encoder,r}return jg(n,[{key:"chooseRight",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.canUserPlay("#click_right"),t.abrupt("return",n.isFailure()?e.cancelMove(n.getReason()):e.chooseMove(Rde.RIGHT,e.rules.node.gameState));case 2:case"end":return t.stop()}},t)}))()}},{key:"chooseDown",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.canUserPlay("#click_down"),t.abrupt("return",n.isFailure()?e.cancelMove(n.getReason()):e.chooseMove(Rde.DOWN,e.rules.node.gameState));case 2:case"end":return t.stop()}},t)}))()}},{key:"updateBoard",value:function(){var e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-minimax-testing"]],features:[xE],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(eS(0,"table"),YE(1,Fde,2,1,"tr",0),eS(2,"div",1),uS("click",function(){return t.chooseRight()}),FS(3," goRight "),tS(),eS(4,"div",2),uS("click",function(){return t.chooseDown()}),FS(5," goDown "),tS(),eS(6,"div"),FS(7),tS(),tS()),2&e&&(pb(1),XE("ngForOf",t.board),pb(6),BS(" ",t.coord," "))},directives:[LA,UA],encapsulation:2}),e}(),Bde=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,null,[{key:"getInitialState",value:function(){return new n(Ure.createTable(7,6,Mre.NONE),0)}}]),n}(eoe),Vde=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this)).x=e,r}return jg(n,[{key:"equals",value:function(e){return this===e}},{key:"toString",value:function(){return"P4Move("+this.x+")"}}],[{key:"of",value:function(e){switch(e){case 0:return n.ZERO;case 1:return n.ONE;case 2:return n.TWO;case 3:return n.THREE;case 4:return n.FOUR;case 5:return n.FIVE;case 6:return n.SIX;default:throw new Error("Invalid P4Move")}}}]),n}(noe);Vde.ZERO=new Vde(0),Vde.ONE=new Vde(1),Vde.TWO=new Vde(2),Vde.THREE=new Vde(3),Vde.FOUR=new Vde(4),Vde.FIVE=new Vde(5),Vde.SIX=new Vde(6),Vde.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 6}},{key:"encodeNumber",value:function(e){return e.x}},{key:"decodeNumber",value:function(e){return Vde.of(e)}}]),n}(xre));var zde=function(){var e=jg(function e(){Wg(this,e)});return e.COLUMN_IS_FULL=function(){return $localize(Fs||(Fs=wg(["Please put your piece in an incomplete column."])))},e}(),Hde=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){var i=e.x,a=t.getCopiedBoard(),o=n.getLowestUnoccupiedCase(a,i),s=t.turn;return a[o][i]=t.getCurrentPlayer(),new Bde(a,s+1)}},{key:"isLegal",value:function(e,t){return oV(n.VERBOSE,{context:"P4Rules.isLegal",move:e.toString(),state:t}),t.getPieceAtXY(e.x,0).isPlayer()?S7.failure(zde.COLUMN_IS_FULL()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){for(var t=e.gameState,r=0;r<7;r++)for(var i=5;i>=0&&t.board[i][r].isPlayer();i--){var a=n.getSquareScore(t.board,new Bae(r,i));if(coe.getScoreStatus(a)===aoe.VICTORY)return loe.getVictory(t.getCurrentOpponent())}return 42===t.turn?loe.DRAW:loe.ONGOING}}],[{key:"getVictoriousCoords",value:function(e){for(var t=[],r=0;r<7;r++)for(var i=5;-1!==i&&e.board[i][r].isPlayer();i--){var a=n.getSquareScore(e.board,new Bae(r,i));(a===Nre.ZERO.getVictoryValue()||a===Nre.ONE.getVictoryValue())&&t.push(new Bae(r,i))}return t}},{key:"getBoardValueFromScratch",value:function(e){oV(n.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:e}});for(var t=0,r=0;r<7;r++)for(var i=5;-1!==i&&e.board[i][r].isPlayer();i--){var a=n.getSquareScore(e.board,new Bae(r,i));if(coe.getScoreStatus(a)!==aoe.DEFAULT)return oV(n.VERBOSE,{preVictoryOrVictory:{state:e,tmpScore:a,coord:{x:r,y:i}}}),new Kae(a);t+=a}return new Kae(t)}},{key:"getLowestUnoccupiedCase",value:function(e,t){for(var n=0;n<6&&e[n][t]===Mre.NONE;)n++;return n-1}},{key:"getNumberOfFreeSpacesAndAllies",value:function(e,t,n,r,i){for(var a=0,o=0,s=!0,u=new Bae(t.x+n.x,t.y+n.y);u.isInRange(7,6)&&3!==a;){var c=e[u.y][u.x];if(c===r)return[a,o];c===i&&s?o++:s=!1,c!==r&&c!==i&&a++,u=u.getNext(n)}return[a,o]}},{key:"getOpponent",value:function(e,t){var n=e[t.y][t.x];return M7(n.isPlayer(),"getOpponent should not be called with PlayerOrNone.NONE"),n===Nre.ONE?Nre.ZERO:Nre.ONE}},{key:"getSquareScore",value:function(e,t){oV(n.VERBOSE,"getSquareScore(board, "+t.x+", "+t.y+") called"),oV(n.VERBOSE,e);var r,i=0,a=n.getOpponent(e,t),o=a.getOpponent(),s=new ooe,u=new ooe,c=Hg(Lae.DIRECTIONS);try{for(c.s();!(r=c.n()).done;){var l=r.value,h=n.getNumberOfFreeSpacesAndAllies(e,t,l,a,o);s.set(l,h[0]),u.set(l,h[1])}}catch(y){c.e(y)}finally{c.f()}for(var f=0,d=[Lae.UP,Lae.UP_RIGHT,Lae.RIGHT,Lae.DOWN_RIGHT];f<d.length;f++){var v=d[f],p=u.get(v).get()+u.get(v.getOpposite()).get();if(p>2)return oV(n.VERBOSE,{text:"there is some kind of victory here ("+t.x+", "+t.y+")\nline allies : "+p+"\n",board:e}),o.getVictoryValue();var g=s.get(v).get()+s.get(v.getOpposite()).get();3===g?i+=2:g>3&&(i+=g-2)}return i*o.getScoreModifier()}},{key:"getListMoves",value:function(e){oV(n.VERBOSE,{context:"P4Rules.getListMoves",node:e});for(var t=e.gameState,r=[],i=0;i<7;i++)if(t.getPieceAtXY(i,0)===Mre.NONE){var a=Vde.of(i);r.push(a)}return r}},{key:"getBoardValue",value:function(e){return oV(n.VERBOSE,{text:"P4Rules.getBoardValue called",board:e.getCopiedBoard()}),n.getBoardValueFromScratch(e)}}]),n}(hoe);return e.VERBOSE=!1,e}(),Gde=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){return Hde.getListMoves(e)}},{key:"getBoardValue",value:function(e){var t=e.gameState;return oV(Hde.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),Hde.getBoardValue(t)}}]),n}(Yae),$de=Nre.ZERO,Wde=Nre.ONE,qde=Mre.NONE,jde=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Us||(Us=wg(["Goal of the game"]))),$localize(Bs||(Bs=wg(["The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.\n        The first player plays Dark, the second plays Light.\n        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally)."]))),Bde.getInitialState()),poe.anyMove($localize(Vs||(Vs=wg(["Dropping a piece"]))),$localize(zs||(zs=wg(["Click on any space in any column."]))),Bde.getInitialState(),Vde.THREE,$localize(Hs||(Hs=wg(["As you can see, the piece falls at the bottom of the column."])))),poe.fromMove($localize(Gs||(Gs=wg(["Victory"]))),$localize($s||($s=wg(["You're playing Dark.\n        Place your piece so that you create a horizontal alignment of 4 of your pieces."]))),new Bde([[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,Wde,qde,qde,qde],[qde,qde,qde,Wde,qde,qde,qde],[qde,qde,$de,$de,$de,Wde,qde]],0),[Vde.of(1)],$localize(Ws||(Ws=wg(["You won!"]))),$localize(qs||(qs=wg(["Failed, you have not aligned 4 pieces and missed an opportunity to win."])))),poe.fromMove($localize(js||(js=wg(["Other victory"]))),$localize(Zs||(Zs=wg(["You can also align 4 pieces diagonally or vertically."]))),new Bde([[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,qde,qde,qde,qde],[qde,qde,qde,$de,Wde,qde,qde],[qde,qde,$de,$de,Wde,qde,qde],[qde,$de,Wde,$de,$de,qde,qde]],0),[Vde.of(3),Vde.of(4)],$localize(Ys||(Ys=wg(["You won!"]))),$localize(Ks||(Ks=wg(["Failed, you have not aligned 4 pieces and missed an opportunity to win."]))))]});function Zde(e,t){if(1&e&&(c_(),nS(0,"circle",8)),2&e){var n=hS().index,r=hS().index,i=hS();XE("ngClass",i.getSquareFillClass(n,r)),$E("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)}}function Yde(e,t){if(1&e){var n=aS();c_(),eS(0,"g",5),uS("click",function(){var e=Nk(n).index;return hS(2).onClick(e)}),nS(1,"rect",6),YE(2,Zde,1,4,"circle",7),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();dS("id","click_",i,""),pb(1),$E("x",o.SPACE_SIZE*i)("y",o.SPACE_SIZE*a)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r!==o.EMPTY_CASE)}}function Kde(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Yde,3,6,"g",4),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Qde(e,t){if(1&e&&(c_(),nS(0,"rect",9)),2&e){var n=hS();$E("x",n.SPACE_SIZE*n.last.get().x)("y",n.SPACE_SIZE*n.last.get().y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function Xde(e,t){if(1&e&&(c_(),nS(0,"rect",10)),2&e){var n=t.$implicit,r=hS();vS("id","victory_coord_",n.x,"_",n.y,""),$E("x",r.SPACE_SIZE*n.x)("y",r.SPACE_SIZE*n.y)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE)}}var Jde=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).EMPTY_CASE=Mre.NONE,r.victoryCoords=[],r.rules=new Hde(Bde),r.availableMinimaxes=[new Gde(r.rules,"P4Minimax")],r.encoder=Vde.encoder,r.tutorial=(new jde).tutorial,r.updateBoard(),r}return jg(n,[{key:"onClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#click_"+e)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:return i=Vde.of(e),n.next=6,t.chooseMove(i,t.rules.node.gameState);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n)}))()}},{key:"updateBoard",value:function(){var e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=Hde.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}},{key:"showLastMove",value:function(){var e=this.rules.node.move,t=Hde.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=lV.of(new Bae(e.get().x,t))}},{key:"hideLastMove",value:function(){this.last=lV.empty()}},{key:"getSquareFillClass",value:function(e,t){return[this.getPlayerClass(this.board[t][e])]}}]),n}(Koe);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-p4"]],features:[xE],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Kde,2,1,"g",1),YE(2,Qde,1,4,"rect",2),YE(3,Xde,1,6,"rect",3),tS()),2&e&&(pb(1),XE("ngForOf",t.board),pb(1),XE("ngIf",t.last.isPresent()),pb(1),XE("ngForOf",t.victoryCoords))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),eve=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Wg(this,n),(a=t.call(this,e,r)).blockTurned=i,a.turnedClockwise=o,a.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+a.coord.toString());return Lg(a)}return jg(n,[{key:"toString",value:function(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}},{key:"equals",value:function(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}],[{key:"withRotation",value:function(e,t,r,i){if(r<0||3<r)throw new Error("This block do not exist: "+r);return new n(e,t,lV.of(r),i)}},{key:"rotationless",value:function(e,t){return new n(e,t,lV.empty())}}]),n}(roe);eve.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encodeMove",value:function(e){var t={coord:Bae.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}},{key:"decodeMove",value:function(e){var t=e,n=Bae.encoder.decode(t.coord),r=lV.ofNullable(t.blockTurned);if(r.isPresent()){var i=t.turnedClockwise;return eve.withRotation(n.x,n.y,r.get(),i)}return eve.rotationless(n.x,n.y)}}]),n}(Are));var tve=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_ROTATE_NEUTRAL_BLOCK=function(){return $localize(Qs||(Qs=wg(["If the quadrant to turn is neutral, please just use move without rotation."])))},e.MUST_CHOOSE_BLOCK_TO_ROTATE=function(){return $localize(Xs||(Xs=wg(["No quadrant is neutral, you must pick a quadrant to rotate."])))},e}(),nve=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e,r)).neutralBlocks=i.getBlocksNeutralities(),i}return jg(n,[{key:"getBlocksNeutralities",value:function(){for(var e=[],t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}},{key:"getBlockNeutrality",value:function(e){var t=n.getBlockCenter(e),r=this.getPieceAt(t.getNext(Lae.UP,1)),i=this.getPieceAt(t.getNext(Lae.UP_LEFT,1));return this.getPieceAt(t.getNext(Lae.RIGHT,1))===r&&this.getPieceAt(t.getNext(Lae.DOWN,1))===r&&this.getPieceAt(t.getNext(Lae.LEFT,1))===r&&this.getPieceAt(t.getNext(Lae.UP_RIGHT,1))===i&&this.getPieceAt(t.getNext(Lae.DOWN_RIGHT,1))===i&&this.getPieceAt(t.getNext(Lae.DOWN_LEFT,1))===i}},{key:"applyLegalDrop",value:function(e){var t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new n(t,this.turn)}},{key:"applyLegalMove",value:function(e){var t=this.applyLegalDrop(e),r=t.getCopiedBoard();if(e.blockTurned.isPresent()){var i=n.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise){var a,o=Hg(n.ROTATION_MAP);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=s[0].getNext(i),c=s[1].getNext(i),l=t.getPieceAt(u);r[c.y][c.x]=l}}catch(y){o.e(y)}finally{o.f()}}else{var h,f=Hg(n.ROTATION_MAP);try{for(f.s();!(h=f.n()).done;){var d=h.value,v=d[1].getNext(i),p=d[0].getNext(i),g=t.getPieceAt(v);r[p.y][p.x]=g}}catch(y){f.e(y)}finally{f.f()}}}return new n(r,this.turn+1)}},{key:"blockIsNeutral",value:function(e){return this.neutralBlocks.includes(e)}}],[{key:"getInitialState",value:function(){return new n(Ure.createTable(6,6,Mre.NONE),0)}},{key:"getBlockCenter",value:function(e){return new Bae(1+(e%2==0?0:3),1+(e<2?0:3))}}]),n}(eoe);nve.ROTATION_MAP=[[new Bae(-1,-1),new Bae(1,-1)],[new Bae(0,-1),new Bae(1,0)],[new Bae(1,-1),new Bae(1,1)],[new Bae(1,0),new Bae(0,1)],[new Bae(1,1),new Bae(-1,1)],[new Bae(0,1),new Bae(-1,0)],[new Bae(-1,1),new Bae(-1,-1)],[new Bae(-1,0),new Bae(0,-1)]];var rve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return t.applyLegalMove(e)}},{key:"isLegal",value:function(e,t){if(t.getPieceAt(e.coord).isPlayer())return S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE());var n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return S7.failure(tve.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){var r=e.blockTurned.get();if(n.neutralBlocks.includes(r))return S7.failure(tve.CANNOT_ROTATE_NEUTRAL_BLOCK())}return S7.success(void 0)}},{key:"getVictoryCoords",value:function(e){var t,r=[],i=Hg(n.VICTORY_SOURCE);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=e.getPieceAt(a[0]),s=[a[0]];if(o.isPlayer()){for(var u=a[0].getNext(a[1]),c=!0,l=0;l<3&&c;l++)e.getPieceAt(u)!==o?c=!1:(s.push(u),u=u.getNext(a[1]));if(c&&(e.getPieceAt(u)===o&&(s.push(u),r=r.concat(s)),a[2])){var h=a[0].getPrevious(a[1],1);e.getPieceAt(h)===o&&(s.push(h),r=r.concat(s))}}}}catch(f){i.e(f)}finally{i.f()}return r}},{key:"getGameStatus",value:function(e){for(var t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1],i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?loe.DRAW:loe.ZERO_WON:!0===r[1]?loe.ONE_WON:36===t.turn?loe.DRAW:loe.ONGOING}}],[{key:"get",value:function(){return n.singleton.isAbsent()&&(n.singleton=lV.of(new n(nve))),n.singleton.get()}}]),n}(hoe);rve.singleton=lV.empty(),rve.VICTORY_SOURCE=[[new Bae(1,0),new Mae(1,1),!1],[new Bae(0,1),new Mae(1,1),!1],[new Bae(4,0),new Mae(-1,1),!1],[new Bae(5,1),new Mae(-1,1),!1],[new Bae(1,1),new Mae(1,1),!0],[new Bae(4,1),new Mae(-1,1),!0],[new Bae(0,1),new Mae(0,1),!0],[new Bae(1,1),new Mae(0,1),!0],[new Bae(2,1),new Mae(0,1),!0],[new Bae(3,1),new Mae(0,1),!0],[new Bae(4,1),new Mae(0,1),!0],[new Bae(5,1),new Mae(0,1),!0],[new Bae(1,0),new Mae(1,0),!0],[new Bae(1,1),new Mae(1,0),!0],[new Bae(1,2),new Mae(1,0),!0],[new Bae(1,3),new Mae(1,0),!0],[new Bae(1,4),new Mae(1,0),!0],[new Bae(1,5),new Mae(1,0),!0]];var ive=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=[],r=e.gameState.neutralBlocks;if(0===e.gameState.turn)return n.FIRST_TURN_MOVES;var i,a=Hg(this.getLegalDrops(e.gameState));try{for(a.s();!(i=a.n()).done;){var o,s=i.value,u=eve.rotationless(s.x,s.y),c=e.gameState.applyLegalDrop(u),l=Hg(this.getLegalRotations(c,r));try{for(l.s();!(o=l.n()).done;){var h=o.value;t.push(eve.withRotation(s.x,s.y,h[0],h[1]))}}catch(f){l.e(f)}finally{l.f()}0===c.neutralBlocks.length==0&&t.push(u)}}catch(f){a.e(f)}finally{a.f()}return t}},{key:"getLegalDrops",value:function(e){for(var t=[],n=0;n<6;n++)for(var r=0;r<6;r++){var i=new Bae(r,n);e.getPieceAt(i)===Mre.NONE&&t.push(i)}return t}},{key:"getLegalRotations",value:function(e,t){for(var n=0===e.neutralBlocks.length,r=[],i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}},{key:"getBoardValue",value:function(e){return new Kae(rve.get().getGameStatus(e).toBoardValue())}}]),n}(Yae);ive.FIRST_TURN_MOVES=[eve.rotationless(0,0),eve.rotationless(1,0),eve.rotationless(2,0),eve.rotationless(0,1),eve.rotationless(1,1),eve.rotationless(0,2)];var ave=Mre.NONE,ove=Nre.ONE,sve=Nre.ZERO,uve=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Js||(Js=wg(["Initial board"]))),$localize(eu||(eu=wg(["The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate."]))),nve.getInitialState()),poe.informational($localize(tu||(tu=wg(["Goal of the game"]))),$localize(nu||(nu=wg(["The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins."]))),new nve([[sve,ave,ave,sve,ove,ave],[sve,ove,ave,ave,ave,ave],[sve,ave,ove,ave,ave,ave],[sve,ave,ave,ave,ave,ove],[sve,ave,ave,ave,ove,ave],[ave,ave,ave,ave,ave,ave]],10)).withPreviousMove(eve.withRotation(0,0,0,!1)),poe.fromPredicate($localize(ru||(ru=wg(["Simple move"]))),$localize(iu||(iu=wg(["At their turn, players put a piece on the board and possibly rotate one quadrant.\n        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.\n        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>\n        Do it."]))),new nve([[ave,ave,ave,ave,ave,ave],[ave,sve,ave,ave,ove,ave],[ave,ave,ave,ave,ave,ave],[ave,ave,ave,ave,ave,ave],[ave,ove,ave,ave,sve,ave],[ave,ave,ave,ave,ave,ave]],10),eve.rotationless(2,2),function(e,t){return e.blockTurned.isPresent()?T7.failure($localize(au||(au=wg(["You have made a move with a rotation. This tutorial step is about moves without rotations!"])))):T7.SUCCESS},$localize(ou||(ou=wg(["Congratulations!"])))),poe.fromPredicate($localize(su||(su=wg(["Move with rotation"]))),$localize(uu||(uu=wg(["After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>\n        Click on one of them and see the rotation!"]))),new nve([[ave,ave,ave,ave,ave,ave],[ave,sve,ave,ave,ove,ave],[ave,ave,ave,ave,ave,ave],[ave,ave,ave,ave,ave,ave],[ave,ove,ave,ave,sve,ave],[ave,ave,ave,ave,ave,ave]],10),eve.withRotation(0,0,0,!0),function(e,t){return e.blockTurned.isPresent()?T7.SUCCESS:T7.failure($localize(cu||(cu=wg(["You made a move without rotation, try again!"]))))},$localize(lu||(lu=wg(["Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation."]))))]});function cve(e,t){if(1&e){var n=aS();c_(),rS(0),eS(1,"circle",9),uS("click",function(){var e=Nk(n).$implicit,t=hS().$implicit,r=hS().index,i=hS().index;return hS().onClick(3*r+e,3*i+t)}),tS(),iS()}if(2&e){var r=t.$implicit,i=hS().$implicit,a=hS(),o=a.index,s=a.$implicit,u=hS(),c=u.index,l=u.$implicit,h=hS();pb(1),vS("id","click_",3*o+r,"_",3*c+i,""),XE("ngClass",h.getSquareClasses(3*o+r,3*c+i)),$E("cx",s+2*h.STROKE_WIDTH+(r+.5)*h.SPACE_SIZE)("cy",l+2*h.STROKE_WIDTH+(i+.5)*h.SPACE_SIZE)("r",(h.SPACE_SIZE-h.STROKE_WIDTH)/2)}}var lve=function(){return[0,1,2]};function hve(e,t){1&e&&(c_(),rS(0),YE(1,cve,2,6,"ng-container",3),iS()),2&e&&(pb(1),XE("ngForOf",aT(1,lve)))}function fve(e,t){if(1&e&&(c_(),rS(0),nS(1,"rect",8),YE(2,hve,2,2,"ng-container",3),iS()),2&e){var n=t.$implicit,r=t.index,i=hS(),a=i.index,o=i.$implicit,s=hS();pb(1),XE("ngClass",s.getBlockClasses(r,a)),$E("x",s.STROKE_WIDTH+n)("y",s.STROKE_WIDTH+o)("rx",3*s.STROKE_WIDTH)("ry",3*s.STROKE_WIDTH)("width",s.BLOCK_WIDTH)("height",s.BLOCK_WIDTH),pb(1),XE("ngForOf",aT(8,lve))}}var dve=function(e){return[0,e]};function vve(e,t){if(1&e&&(c_(),rS(0),YE(1,fve,3,9,"ng-container",3),iS()),2&e){var n=hS();pb(1),XE("ngForOf",oT(1,dve,n.BLOCK_SEPARATION))}}function pve(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS();vS("id","currentDrop_",n.currentDrop.get().x,"_",n.currentDrop.get().y,""),XE("ngClass",n.getPlayerClass(n.rules.node.gameState.getCurrentPlayer())),$E("cx",n.getCenter(n.currentDrop.get().x))("cy",n.getCenter(n.currentDrop.get().y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)}}function gve(e,t){if(1&e){var n=aS();c_(),eS(0,"path",11),uS("click",function(){var e=Nk(n).$implicit;return hS().rotate(e)}),tS()}if(2&e){var r=t.$implicit,i=hS();vS("id","rotate_",r[1],"_",r[2]?"clockwise":"counterclockwise",""),$E("d",r[0])("stroke-width",2*i.STROKE_WIDTH)}}function yve(e,t){if(1&e&&(c_(),nS(0,"circle",12)),2&e){var n=t.$implicit,r=hS();vS("id","victoryCoord_",n.x,"_",n.y,""),XE("ngClass",r.getSquareClasses(n.x,n.y)),$E("cx",r.getCenter(n.x))("cy",r.getCenter(n.y))("r",(r.SPACE_SIZE-r.STROKE_WIDTH)/2)("stroke-width",r.STROKE_WIDTH)}}function mve(e,t){if(1&e){var n=aS();c_(),eS(0,"g",13),uS("click",function(){return Nk(n),hS().skipRotation()}),nS(1,"circle",14),nS(2,"line",15),tS()}if(2&e){var r=hS();pb(1),$E("cx",r.BLOCK_SEPARATION)("cy",r.BLOCK_SEPARATION)("r",.75*r.SPACE_SIZE)("stroke-width",2*r.STROKE_WIDTH),pb(1),$E("x1",r.BLOCK_SEPARATION-r.DIAGONAL_BAR_OFFSET)("y1",r.BLOCK_SEPARATION+r.DIAGONAL_BAR_OFFSET)("x2",r.BLOCK_SEPARATION+r.DIAGONAL_BAR_OFFSET)("y2",r.BLOCK_SEPARATION-r.DIAGONAL_BAR_OFFSET)("stroke-width",2*r.STROKE_WIDTH)}}var kve=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).arrows=[],r.victoryCoords=[],r.rules=new rve(nve),r.availableMinimaxes=[new ive(r.rules,"PentagoMinimax")],r.encoder=eve.encoder,r.tutorial=(new uve).tutorial,r.BLOCK_WIDTH=3*r.SPACE_SIZE+2*r.STROKE_WIDTH,r.BLOCK_SEPARATION=r.BLOCK_WIDTH+2*r.STROKE_WIDTH,r.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*r.SPACE_SIZE,r.ARROWS=r.generateArrowsCoord(),r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}},{key:"showLastMove",value:function(){var e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{var t=e.get();this.movedBlock=t.blockTurned;var n=new Bae(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new Bae(0,0))&&this.coordBelongToBlock(t)){var r;r=t.turnedClockwise?aV.getNonNullable(nve.ROTATION_MAP.find(function(e){return e[0].equals(n)}))[1]:aV.getNonNullable(nve.ROTATION_MAP.find(function(e){return e[1].equals(n)}))[0];var i=t.blockTurned.get();r=r.getNext(new Mae(i%2==0?1:4,i<2?1:4),1),this.lastDrop=lV.of(r)}else this.lastDrop=lV.of(t.coord)}}},{key:"coordBelongToBlock",value:function(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}},{key:"hidePreviousMove",value:function(){this.lastDrop=lV.empty(),this.movedBlock=lV.empty(),this.victoryCoords=[]}},{key:"generateArrowsCoord",value:function(){var e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}},{key:"cancelMoveAttempt",value:function(){this.arrows=[],this.currentDrop=lV.empty(),this.canSkipRotation=!1}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(!n.board[t][e].isPlayer()){r.next=5;break}return r.abrupt("return",n.cancelMove(Zae.MUST_LAND_ON_EMPTY_SPACE()));case 5:if(a=eve.rotationless(e,t),o=n.rules.node.gameState,4!==(s=o.applyLegalDrop(a)).neutralBlocks.length){r.next=8;break}return r.abrupt("return",n.chooseMove(a,o));case 8:return u=n.rules.getGameStatus(n.rules.node),r.abrupt("return",(n.canSkipRotation=s.neutralBlocks.length>0&&!1===u.isEndGame,n.currentDrop=lV.of(new Bae(e,t)),n.displayArrows(s.neutralBlocks),T7.SUCCESS));case 10:case"end":return r.stop()}},r)}))()}},{key:"getCenter",value:function(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}},{key:"displayArrows",value:function(e){var t=this;this.arrows=[];for(var n=function(n){if(!1===e.includes(n)){var r=t.ARROWS.filter(function(e){return e[1]===n});t.arrows=t.arrows.concat(r)}},r=0;r<4;r++)n(r)}},{key:"getBlockClasses",value:function(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}},{key:"getSquareClasses",value:function(e,t){var n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new Bae(e,t))&&n.push("last-move"),n}},{key:"rotate",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"))).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:return i=t.currentDrop.get(),a=eve.withRotation(i.x,i.y,e[1],e[2]),n.abrupt("return",t.chooseMove(a,t.rules.node.gameState));case 5:case"end":return n.stop()}},n)}))()}},{key:"skipRotation",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.canUserPlay("#skipRotation")).isFailure()){t.next=3;break}return t.abrupt("return",e.cancelMove(n.getReason()));case 3:return r=e.currentDrop.get(),i=eve.rotationless(r.x,r.y),t.abrupt("return",e.chooseMove(i,e.rules.node.gameState));case 5:case"end":return t.stop()}},t)}))()}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-pentago"]],features:[xE],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"defs"),eS(2,"marker",1),nS(3,"polygon",2),tS(),tS(),YE(4,vve,2,3,"ng-container",3),YE(5,pve,1,6,"circle",4),YE(6,gve,1,4,"path",5),YE(7,yve,1,7,"circle",6),YE(8,mve,3,9,"g",7),tS()),2&e&&(pb(4),XE("ngForOf",oT(5,dve,t.BLOCK_SEPARATION)),pb(1),XE("ngIf",t.currentDrop.isPresent()),pb(1),XE("ngForOf",t.arrows),pb(1),XE("ngForOf",t.victoryCoords),pb(1),XE("ngIf",t.canSkipRotation))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),_ve=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;if(Wg(this,n),(a=t.call(this,e,r)).z=i,e<0||e>3)throw new Error("PylosCoord: Invalid X: ".concat(e,"."));if(r<0||r>3)throw new Error("PylosCoord: Invalid Y: ".concat(r,"."));if(i<0||i>3)throw new Error("PylosCoord: Invalid Z: ".concat(i,"."));var o=4-i;if(a.isNotInRange(o,o))throw new Error(a.toString()+" is not in range.");return Lg(a)}return jg(n,[{key:"toString",value:function(){return"PylosCoord"+this.toShortString()}},{key:"toShortString",value:function(){return"("+this.x+", "+this.y+", "+this.z+")"}},{key:"equals",value:function(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"isUpperThan",value:function(e){return this.z>e.z}},{key:"getLowerPieces",value:function(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");var e=this.z-1;return[new n(this.x,this.y,e),new n(this.x+1,this.y,e),new n(this.x,this.y+1,e),new n(this.x+1,this.y+1,e)]}},{key:"getHigherPieces",value:function(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");var e=this.z+1,t=new Bae(this.x-1,this.y-1),r=new Bae(this.x,this.y-1),i=new Bae(this.x-1,this.y),a=new Bae(this.x,this.y),o=4-e;return[t,r,i,a].filter(function(e){return e.isInRange(o,o)}).map(function(t){return new n(t.x,t.y,e)})}},{key:"getNextValid",value:function(e){var t=new Bae(this.x,this.y).getNext(e),r=4-this.z;return t.isNotInRange(r,r)?lV.empty():lV.of(new n(t.x,t.y,this.z))}}],[{key:"encodeOptional",value:function(e){return e.isPresent()?n.encode(e.get())+1:0}},{key:"encode",value:function(e){return 16*e.x+4*e.y+e.z}},{key:"decodeToOptional",value:function(e){return 0===e?lV.empty():lV.of(n.decode(e-1))}},{key:"decode",value:function(e){var t=e%4;e-=t;var r=(e/=4)%4;return e-=r,new n(e/=4,r,t)}}]),n}(Bae),Cve=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).startingCoord=e,o.landingCoord=r,o.firstCapture=i,o.secondCapture=a,o}return jg(n,[{key:"isClimb",value:function(){return this.startingCoord.isPresent()}},{key:"toString",value:function(){var e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}},{key:"equals",value:function(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}],[{key:"fromClimb",value:function(e,t,r){var i=lV.of(e),a=n.checkCaptures(r),o=new n(i,t,a.firstCapture,a.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return o}},{key:"checkCaptures",value:function(e){var t=lV.empty(),n=lV.empty();if(e.length>0&&(t=lV.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=lV.of(e[1]),e[1].isUpperThan(e[0])&&(t=lV.of(e[1]),n=lV.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}},{key:"fromDrop",value:function(e,t){var r=lV.empty(),i=n.checkCaptures(t);return new n(r,e,i.firstCapture,i.secondCapture)}},{key:"changeCapture",value:function(e,t){var r=n.checkCaptures(t);return new n(e.startingCoord,e.landingCoord,r.firstCapture,r.secondCapture)}}]),n}(noe);Cve.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 17575999}},{key:"encodeNumber",value:function(e){var t=_ve.encode(e.landingCoord),n=_ve.encodeOptional(e.startingCoord),r=_ve.encodeOptional(e.firstCapture);return 270400*_ve.encodeOptional(e.secondCapture)+4160*r+64*n+t}},{key:"decodeNumber",value:function(e){var t=_ve.decode(e%64);e-=e%64;var n=_ve.decodeToOptional((e/=64)%65);e-=e%65;var r=_ve.decodeToOptional((e/=65)%65);e-=e%65;var i=_ve.decodeToOptional(e/=65);return new Cve(n,t,r,i)}}]),n}(xre));var wve=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,r)).boards=e,i}return jg(n,[{key:"getPieceAt",value:function(e){return this.boards[e.z][e.y][e.x]}},{key:"applyLegalMove",value:function(e){var t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:Mre.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:Mre.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:Mre.NONE}),this.setBoardAts(t,this.turn+1)}},{key:"setBoardAts",value:function(e,t){var r,i=[Ure.copyBiArray(this.boards[0]),Ure.copyBiArray(this.boards[1]),Ure.copyBiArray(this.boards[2]),Ure.copyBiArray(this.boards[3])],a=Hg(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.coord;i[s.z][s.y][s.x]=o.value}}catch(u){a.e(u)}finally{a.f()}return new n(i,t)}},{key:"isLandable",value:function(e){if(this.getPieceAt(e).isPlayer())return!1;if(0===e.z)return!0;var t,n=Hg(e.getLowerPieces());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.getPieceAt(r)===Mre.NONE)return!1}}catch(i){n.e(i)}finally{n.f()}return!0}},{key:"isSupporting",value:function(e){if(3===e.z)return!1;var t,n=Hg(e.getHigherPieces());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.getPieceAt(r).isPlayer())return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"getPiecesRepartition",value:function(){var e={};e[Mre.NONE.value]=0,e[Nre.ZERO.value]=0,e[Nre.ONE.value]=0;for(var t=0;t<3;t++)for(var n=0;n<4-t;n++)for(var r=0;r<4-t;r++){var i=new _ve(r,n,t),a=this.getPieceAt(i);e[a.value]=1+e[a.value]}return e}}],[{key:"getInitialState",value:function(){return new n([Ure.createTable(4,4,Mre.NONE),Ure.createTable(3,3,Mre.NONE),Ure.createTable(2,2,Mre.NONE),[[Mre.NONE]]],0)}}]),n}(Jae),bve=function(){var e=jg(function e(){Wg(this,e)});return e.MUST_MOVE_UPWARD=function(){return $localize(hu||(hu=wg(["You must move your pieces upward."])))},e.SHOULD_HAVE_SUPPORTING_PIECES=function(){return $localize(fu||(fu=wg(["Your piece must land on the board or on 4 other pieces."])))},e.CANNOT_LAND=function(){return $localize(du||(du=wg(["You cannot land on this space."])))},e.CANNOT_CAPTURE=function(){return $localize(vu||(vu=wg(["You cannot capture."])))},e.INVALID_FIRST_CAPTURE=function(){return $localize(pu||(pu=wg(["Your first capture is invalid."])))},e.INVALID_SECOND_CAPTURE=function(){return $localize(gu||(gu=wg(["Your second capture is invalid."])))},e}(),Eve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){return n.applyLegalMove(e,t,r)}},{key:"isLegal",value:function(e,t){if(t.getPieceAt(e.landingCoord).isPlayer())return S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE());var r=t.getCurrentOpponent();if(e.startingCoord.isPresent()){var i=e.startingCoord.get(),a=t.getPieceAt(i);if(a===r)return S7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE());if(a===Mre.NONE)return S7.failure(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(i.getHigherPieces().filter(function(n){return t.getPieceAt(n).isPlayer()||n.equals(e.landingCoord)}).length>0)return S7.failure(bve.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return S7.failure(bve.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===n.canCapture(t,e.landingCoord))return S7.failure(bve.CANNOT_CAPTURE());if(!n.isValidCapture(t,e,e.firstCapture.get()))return S7.failure(bve.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!n.isValidCapture(t,e,e.secondCapture.get()))return S7.failure(bve.INVALID_SECOND_CAPTURE())}return S7.success(void 0)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}}],[{key:"getStateInfo",value:function(e){for(var t=[],n=[],r=0;r<3;r++)for(var i=0;i<4-r;i++)for(var a=0;a<4-r;a++){var o=new _ve(a,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}},{key:"getClimbingMoves",value:function(e){var t,n=[],r=Hg(e.freeToMove);try{var i=function(){var r,i=t.value,a=Hg(e.landable);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.isUpperThan(i)&&!1===o.getLowerPieces().some(function(e){return i.equals(e)})){var s=Cve.fromClimb(i,o,[]);n.push(s)}}}catch(u){a.e(u)}finally{a.f()}};for(r.s();!(t=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}return n}},{key:"getDropMoves",value:function(e){var t,n=[],r=Hg(e.landable);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=Cve.fromDrop(i,[]);n.push(a)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"canCapture",value:function(e,t){for(var n=e.getCurrentPlayer(),r=0,i=[Fae.UP,Fae.DOWN];r<i.length;r++){var a=i[r],o=t.getNextValid(a);if(o.isPresent()&&e.getPieceAt(o.get())===n)for(var s=0,u=[Fae.LEFT,Fae.RIGHT];s<u.length;s++){var c=u[s],l=o.get().getNextValid(c);if(l.isPresent()&&e.getPieceAt(l.get())===n){var h=a.getOpposite(),f=l.get().getNextValid(h).get();if(e.getPieceAt(f)===n)return!0}}}return!1}},{key:"getPossibleCaptures",value:function(e,t,n){for(var r=[],i=(e=e.filter(function(e){return!1===t.equalsValue(e)})).concat(n),a=0;a<i.length;a++){var o=i[a];r.push([o]);for(var s=a+1;s<i.length;s++)r.push([i[s],o])}return r}},{key:"applyLegalMove",value:function(e,t,n){return t.applyLegalMove(e)}},{key:"isValidCapture",value:function(e,t,n){var r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(function(n){return e.getPieceAt(n).isPlayer()&&!1===n.equals(t.firstCapture.get())}).length>0)}},{key:"getGameStatus",value:function(e){var t=e.gameState.getPiecesRepartition();return 15===t[Nre.ZERO.value]?loe.ONE_WON:15===t[Nre.ONE.value]?loe.ZERO_WON:loe.ONGOING}}]),n}(hoe),Sve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){return n.getListMoves(e)}},{key:"getBoardValue",value:function(e){var t=Eve.getGameStatus(e);if(t.isEndGame)return new Kae(t.toBoardValue());var n=e.gameState.getPiecesRepartition();return new Kae(n[Nre.ZERO.value]-n[Nre.ONE.value])}}],[{key:"getListMoves",value:function(e){var t,n=e.gameState,r=[],i=Eve.getStateInfo(n),a=Eve.getClimbingMoves(i),o=Eve.getDropMoves(i),s=Hg(a.concat(o));try{for(s.s();!(t=s.n()).done;){var u=t.value,c=[[]];Eve.canCapture(n,u.landingCoord)&&(c=Eve.getPossibleCaptures(i.freeToMove,u.startingCoord,u.landingCoord));var l,h=Hg(c);try{for(h.s();!(l=h.n()).done;){var f=l.value,d=Cve.changeCapture(u,f);r.push(d)}}catch(v){h.e(v)}finally{h.f()}}}catch(v){s.e(v)}finally{s.f()}return r}}]),n}(Yae),Pve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t=Sve.getListMoves(e);return this.orderMoves(t)}},{key:"orderMoves",value:function(e){return e.sort(function(e,t){var r=12*n.countStoneUsed(e),i=12*n.countStoneUsed(t);return r+n.sumMoveEmplacementByValue(e)-(i+n.sumMoveEmplacementByValue(t))})}}],[{key:"countStoneUsed",value:function(e){var t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}},{key:"sumMoveEmplacementByValue",value:function(e){var t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}}]),n}(Sve),Ove=Mre.NONE,Tve=Nre.ZERO,Ive=Nre.ONE,Ave=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(yu||(yu=wg(["Goal of the game"]))),$localize(mu||(mu=wg(["At Pylos, the goal is to be the last to play.\n        To do this, you have to save up your pieces.\n        As soon as a player puts its last piece, that player loses the game immediately.\n        Here is what the initial board looks like, it is a board of 4 x 4 squares.\n        This board will become a pyramid, little by little.\n        It will be filled by the pieces of your stock. Each player has 15 pieces."]))),wve.getInitialState()),poe.anyMove($localize(ku||(ku=wg(["Dropping a piece"]))),$localize(_u||(_u=wg(["When it is your turn, you can always drop one of your piece on an empty square.\n        The gray squares are where you can drop your pieces.<br/><br/>\n        Click on one of the squares to drop a piece there."]))),wve.getInitialState(),Cve.fromDrop(new _ve(1,1,0),[]),$localize(Cu||(Cu=wg(["There you go, as simple as that."])))),poe.fromMove($localize(wu||(wu=wg(["Climbing"]))),$localize(bu||(bu=wg(["When 4 pieces form a square, it is possible to put a fifth piece on top.\n        However, when that happens, you can save a piece by climbing instead of dropping a piece.\n        To climb:\n        <ol>\n            <li>Click on one of your free pieces, which should be lower than the landing square.</li>\n            <li>Click on an empty landing square, higher than your selected piece.</li>\n        </ol><br/>\n        Go ahead, climb!"]))),new wve([[[Tve,Ive,Ove,Ove],[Ive,Tve,Ove,Ove],[Ove,Ove,Ove,Ove],[Ove,Ove,Ove,Tve]],[[Ove,Ove,Ove],[Ove,Ove,Ove],[Ove,Ove,Ove]],[[Ove,Ove],[Ove,Ove]],[[Ove]]],0),[Cve.fromClimb(new _ve(3,3,0),new _ve(0,0,1),[])],$localize(Eu||(Eu=wg(["Congratulations!<br/>\n        Some important notes:\n        <ol>\n            <li>You cannot move a piece that is directly below another one.</li>\n            <li>Of course, you cannot move the opponent's pieces.</li>\n            <li>You can only climb when the landing square is higher than the starting square.</li>\n        </ol>"]))),$localize(Su||(Su=wg(["Failed!"])))),poe.fromMove($localize(Pu||(Pu=wg(["Square (1/2)"]))),$localize(Ou||(Ou=wg(["When the piece you just moved or dropped is the fourth one of a square of your color,\n        you can choose anywhere on the board one or two of your pieces.\n        These pieces will be removed from the board, allowing you to save up one or two pieces.\n        A chosen piece must not be directly below another piece.\n        A chosen piece can be the piece you just placed.\n        You're playing Dark.<br/><br/>\n        Form a square, then click twice on one of the four pieces to remove only that one."]))),new wve([[[Tve,Tve,Ove,Ove],[Ove,Tve,Ove,Ove],[Ove,Ove,Ove,Ove],[Ove,Ove,Ove,Ove]],[[Ove,Ove,Ove],[Ove,Ove,Ove],[Ove,Ove,Ove]],[[Ove,Ove],[Ove,Ove]],[[Ove]]],0),[Cve.fromDrop(new _ve(0,1,0),[new _ve(0,0,0)]),Cve.fromDrop(new _ve(0,1,0),[new _ve(0,1,0)]),Cve.fromDrop(new _ve(0,1,0),[new _ve(1,0,0)]),Cve.fromDrop(new _ve(0,1,0),[new _ve(1,1,0)])],$localize(Tu||(Tu=wg(["Congratulations, you have saved up one piece."]))),$localize(Iu||(Iu=wg(["Failed!"])))),poe.fromPredicate($localize(Au||(Au=wg(["Square (2/2)"]))),$localize(xu||(xu=wg(["You're playing Dark.<br/><br/>\n        Do like in the previous step, but this time click on two different pieces."]))),new wve([[[Tve,Tve,Ove,Ove],[Ove,Tve,Ove,Ove],[Ove,Ove,Ove,Ove],[Ove,Ove,Ove,Ove]],[[Ove,Ove,Ove],[Ove,Ove,Ove],[Ove,Ove,Ove]],[[Ove,Ove],[Ove,Ove]],[[Ove]]],0),Cve.fromDrop(new _ve(0,1,0),[new _ve(0,0,0),new _ve(1,0,0)]),function(e,t){return e.secondCapture.isPresent()?T7.SUCCESS:e.firstCapture.isPresent()?T7.failure($localize(Ru||(Ru=wg(["Failed, you only captured one piece."])))):T7.failure(Jfe.YOU_DID_NOT_CAPTURE_ANY_PIECE())},$localize(Mu||(Mu=wg(["Congratulations, you have saved up two pieces."]))))]});function xve(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",4),tS()),2&e){var n=t.$implicit,r=hS().$implicit,i=hS();pb(1),vS("id","piece_",r,"_",n,""),XE("ngClass",i.getPlayerPieceClass(r)),$E("cx",.5*i.SPACE_SIZE+(800-i.SPACE_SIZE)/14*n)("cy",860+(i.SPACE_SIZE+10)*r)("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)}}function Rve(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,xve,2,6,"g",1),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",r.getPlayerSidePieces(n))}}function Mve(e,t){if(1&e){var n=aS();c_(),eS(0,"circle",8),uS("click",function(){Nk(n);var e=hS(2).$implicit,t=hS().$implicit,r=hS().$implicit;return hS().onPieceClick(e,t,r)}),tS()}if(2&e){var r=hS(2).$implicit,i=hS().$implicit,a=hS().$implicit,o=hS();pS("id","piece_",r,"_",i,"_",a,""),XE("ngClass",o.getPieceClasses(r,i,a)),$E("r",o.getPieceRadius(a)-o.STROKE_WIDTH)("cx",o.getPieceCx(r,i,a))("cy",o.getPieceCy(r,i,a))}}function Nve(e,t){if(1&e){var n=aS();c_(),eS(0,"rect",8),uS("click",function(){Nk(n);var e=hS(2).$implicit,t=hS().$implicit,r=hS().$implicit;return hS().onDrop(e,t,r)}),tS()}if(2&e){var r=hS(2).$implicit,i=hS().$implicit,a=hS().$implicit,o=hS();pS("id","drop_",r,"_",i,"_",a,""),XE("ngClass",o.getSquareClasses(r,i,a)),$E("width",2*o.getPieceRadius(a))("height",2*o.getPieceRadius(a))("x",o.getPieceCx(r,i,a)-o.getPieceRadius(a))("y",o.getPieceCy(r,i,a)-o.getPieceRadius(a))}}function Dve(e,t){if(1&e&&(c_(),rS(0),YE(1,Mve,1,7,"circle",6),YE(2,Nve,1,8,"ng-template",null,7,RT),iS()),2&e){var n=KE(3),r=hS().$implicit,i=hS().$implicit,a=hS().$implicit,o=hS();pb(1),XE("ngIf",o.isOccupied(r,i,a))("ngIfElse",n)}}function Lve(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Dve,4,2,"ng-container",5),tS()),2&e){var n=t.$implicit,r=hS().$implicit,i=hS().$implicit,a=hS();pb(1),XE("ngIf",a.isDrawable(n,r,i))}}function Fve(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Lve,2,1,"g",1),tS()),2&e){var n=hS().$implicit,r=hS();pb(1),XE("ngForOf",r.getLevelRange(n))}}function Uve(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Fve,2,1,"g",1),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",r.getLevelRange(n))}}function Bve(e,t){if(1&e&&(c_(),nS(0,"rect",9)),2&e){var n=hS();pS("id","highCapture_",n.highCapture.get().x,"_",n.highCapture.get().y,"_",n.highCapture.get().z,""),$E("width",2*n.getPieceRadius(n.highCapture.get().z))("height",2*n.getPieceRadius(n.highCapture.get().z))("x",n.getPieceCx(n.highCapture.get().x,n.highCapture.get().y,n.highCapture.get().z)-n.getPieceRadius(n.highCapture.get().z))("y",n.getPieceCy(n.highCapture.get().x,n.highCapture.get().y,n.highCapture.get().z)-n.getPieceRadius(n.highCapture.get().z))}}var Vve=function(){return[0,1]},zve=function(){return[0,1,2]},Hve=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).lastLandingCoord=lV.empty(),r.lastStartingCoord=lV.empty(),r.lastFirstCapture=lV.empty(),r.lastSecondCapture=lV.empty(),r.highCapture=lV.empty(),r.chosenStartingCoord=lV.empty(),r.chosenLandingCoord=lV.empty(),r.chosenFirstCapture=lV.empty(),r.lastMove=lV.empty(),r.remainingPieces={0:15,1:15},r.rules=new Eve(wve),r.availableMinimaxes=[new Sve(r.rules,"PylosMinimax"),new Pve(r.rules,"PylosOrderedMinimax")],r.encoder=Cve.encoder,r.tutorial=(new Ave).tutorial,r.SPACE_SIZE=r.getPieceRadius(0),r.updateBoard(),r}return jg(n,[{key:"getLevelRange",value:function(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return aV.expectToBe(e,2),[0,1]}}},{key:"isDrawable",value:function(e,t,n){var r=new _ve(e,t,n);return this.state.getPieceAt(r)!==Mre.NONE||this.state.isLandable(r)}},{key:"onPieceClick",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(a=r.canUserPlay("#piece_"+e+"_"+t+"_"+n)).isFailure()){i.next=3;break}return i.abrupt("return",r.cancelMove(a.getReason()));case 3:return o=new _ve(e,t,n),i.abrupt("return",r.state.getPieceAt(o)===r.state.getCurrentOpponent()?r.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=lV.of(o),T7.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=lV.of(o),T7.SUCCESS):r.chosenFirstCapture.equalsValue(o)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),o]));case 5:case"end":return i.stop()}},i)}))()}},{key:"concludeMoveWithCapture",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(r=t.chosenStartingCoord.isAbsent()?Cve.fromDrop(t.chosenLandingCoord.get(),e):Cve.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(r,t.state)));case 1:case"end":return n.stop()}},n)}))()}},{key:"tryMove",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(n.cancelMove(),n.chooseMove(e,t)));case 1:case"end":return r.stop()}},r)}))()}},{key:"cancelMoveAttempt",value:function(){this.chosenStartingCoord=lV.empty(),this.chosenLandingCoord=lV.empty(),this.chosenFirstCapture=lV.empty()}},{key:"onDrop",value:function(e,t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(a=r.canUserPlay("#drop_"+e+"_"+t+"_"+n)).isFailure()){i.next=3;break}return i.abrupt("return",r.cancelMove(a.getReason()));case 3:return o=new _ve(e,t,n),i.abrupt("return",Eve.canCapture(r.state,o)?(r.chosenLandingCoord=lV.of(o),T7.SUCCESS):r.isCapturelessMoveFinished(o)?(r.chosenLandingCoord=lV.of(o),r.concludeMoveWithCapture([])):r.cancelMove(bve.MUST_MOVE_UPWARD()));case 5:case"end":return i.stop()}},i)}))()}},{key:"isCapturelessMoveFinished",value:function(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}},{key:"getSquareClasses",value:function(e,t,n){var r=new _ve(e,t,n);if(this.lastMove.isPresent()){var i=this.lastMove.get();if(i.firstCapture.equalsValue(r)||i.secondCapture.equalsValue(r))return["captured"];if(r.equals(i.landingCoord)||i.startingCoord.equalsValue(r))return["moved"]}return[]}},{key:"getPieceRadius",value:function(e){return 90+5*e}},{key:"getPieceCx",value:function(e,t,n){return 100+100*n+200*e}},{key:"getPieceCy",value:function(e,t,n){return 100+100*n+200*t}},{key:"isOccupied",value:function(e,t,n){var r=new _ve(e,t,n),i=this.rules.node.gameState.getPieceAt(r).isPlayer(),a=this.chosenLandingCoord.equalsValue(r);return i||a}},{key:"getPieceClasses",value:function(e,t,n){var r=new _ve(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}},{key:"getPieceFillClass",value:function(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}},{key:"getPlayerPieceClass",value:function(e){return this.getPlayerClass(Nre.of(e))}},{key:"getPlayerSidePieces",value:function(e){for(var t=this.remainingPieces[e],n=[],r=0;r<t;r++)n.push(r);return n}},{key:"updateBoard",value:function(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;var e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=lV.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=lV.empty(),this.lastStartingCoord=lV.empty(),this.lastFirstCapture=lV.empty(),this.lastSecondCapture=lV.empty(),this.chosenFirstCapture=lV.empty(),this.chosenStartingCoord=lV.empty(),this.chosenLandingCoord=lV.empty())}},{key:"showLastMove",value:function(){var e=this.lastMove.get();this.lastLandingCoord=lV.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}},{key:"isDrawableCoord",value:function(e){return this.isDrawable(e.x,e.y,e.z)}}]),n}(Vae);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-pylos"]],features:[xE],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Rve,2,1,"g",1),nS(2,"rect",2),YE(3,Uve,2,1,"g",1),YE(4,Bve,1,7,"rect",3),tS()),2&e&&(pb(1),XE("ngForOf",aT(3,Vve)),pb(2),XE("ngForOf",aT(4,zve)),pb(1),XE("ngIf",t.highCapture.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Gve=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"equals",value:function(e){return this===e}},{key:"toString",value:function(){return"QuartoPiece("+this.value+")"}},{key:"isRectangle",value:function(){return this.value%4<2}}],[{key:"fromInt",value:function(t){if(0<=t&&t<=15)return e.pieces[t];if(16===t)return e.EMPTY;throw new Error("Invalid piece ("+t+")")}}]),e}();Gve.AAAA=new Gve(0),Gve.AAAB=new Gve(1),Gve.AABA=new Gve(2),Gve.AABB=new Gve(3),Gve.ABAA=new Gve(4),Gve.ABAB=new Gve(5),Gve.ABBA=new Gve(6),Gve.ABBB=new Gve(7),Gve.BAAA=new Gve(8),Gve.BAAB=new Gve(9),Gve.BABA=new Gve(10),Gve.BABB=new Gve(11),Gve.BBAA=new Gve(12),Gve.BBAB=new Gve(13),Gve.BBBA=new Gve(14),Gve.BBBB=new Gve(15),Gve.EMPTY=new Gve(16),Gve.pieces=[Gve.AAAA,Gve.AAAB,Gve.AABA,Gve.AABB,Gve.ABAA,Gve.ABAB,Gve.ABBA,Gve.ABBB,Gve.BAAA,Gve.BAAB,Gve.BABA,Gve.BABB,Gve.BBAA,Gve.BBAB,Gve.BBBA,Gve.BBBB];var $ve=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).piece=i,a}return jg(n,[{key:"toString",value:function(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}},{key:"equals",value:function(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}]),n}(roe);$ve.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 496}},{key:"encodeNumber",value:function(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}},{key:"decodeNumber",value:function(e){var t=e%32;e-=t;var n=(e/=32)%4;return e-=n,new $ve(e/=4,n,Gve.fromInt(t))}}]),n}(xre));var Wve=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,e,r)).pieceInHand=i,a}return jg(n,[{key:"getRemainingPieces",value:function(){var e,t=[],r=Hg(Gve.pieces);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.isGivable(i,this.board,this.pieceInHand)&&t.push(i)}}catch(a){r.e(a)}finally{r.f()}return t}}],[{key:"getInitialState",value:function(){return new n(Ure.createTable(4,4,Gve.EMPTY),0,Gve.AAAA)}},{key:"isGivable",value:function(e,t,r){return e!==r&&!1===n.isAlreadyOnBoard(e,t)}},{key:"isAlreadyOnBoard",value:function(e,t){for(var n=0;n<4;n++)for(var r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}}]),n}(eoe),qve=function(){var e=jg(function e(){Wg(this,e)});return e.MUST_GIVE_A_PIECE=function(){return $localize(Nu||(Nu=wg(["You must give a piece."])))},e.PIECE_ALREADY_ON_BOARD=function(){return $localize(Du||(Du=wg(["That piece is already on the board."])))},e.CANNOT_GIVE_PIECE_IN_HAND=function(){return $localize(Lu||(Lu=wg(["You cannot give the piece that was in your hands."])))},e}(),jve=function(){function e(t){Wg(this,e),this.subCriterion=[lV.empty(),lV.empty(),lV.empty(),lV.empty()],this.subCriterion[0]=lV.of(8==(8&t.value)),this.subCriterion[1]=lV.of(4==(4&t.value)),this.subCriterion[2]=lV.of(2==(2&t.value)),this.subCriterion[3]=lV.of(1==(1&t.value))}return jg(e,[{key:"mergeWith",value:function(e){for(var t=4,n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=lV.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}},{key:"mergeWithQuartoPiece",value:function(t){var n=new e(t);return this.mergeWith(n)}},{key:"areAllAbsent",value:function(){for(var e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}},{key:"match",value:function(e){for(var t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}},{key:"matchPiece",value:function(t){return this.match(new e(t))}},{key:"toString",value:function(){return"Criterion{"+this.subCriterion.map(function(e){return e.isPresent()?e.get()?"1":"0":"x"}).join(" ")+"}"}}]),e}(),Zve=function(){function e(t,n){Wg(this,e),this.initialCoord=t,this.direction=n}return jg(e,[{key:"allCoords",value:function(){for(var e=[],t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}]),e}(),Yve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isLegal",value:function(e,t){return n.isLegal(e,t).toFallible(void 0)}},{key:"applyLegalMove",value:function(e,t){var n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new Wve(n,t.turn+1,e.piece)}},{key:"getGameStatus",value:function(e){var t,r=e.gameState,i={score:aoe.DEFAULT,sensitiveSquares:new Cse},a=Hg(n.lines);try{for(a.s();!(t=a.n()).done;){var o=t.value;if((i=n.updateBoardStatus(o,r,i)).score===aoe.VICTORY)return n.scoreToGameStatus(i.score,r.turn)}}catch(s){a.e(s)}finally{a.f()}return n.scoreToGameStatus(i.score,r.turn)}},{key:"getVictoriousCoords",value:function(e){var t,r=Hg(n.lines);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(n.isThereAVictoriousLine(i,e))return i.allCoords()}}catch(a){r.e(a)}finally{r.f()}return[]}}],[{key:"isOccupied",value:function(e){return e!==Gve.EMPTY}},{key:"isLegal",value:function(e,t){var r=e.coord.x,i=e.coord.y,a=e.piece,o=t.getCopiedBoard(),s=t.pieceInHand;return n.isOccupied(o[i][r])?T7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE()):a===Gve.EMPTY?15===t.turn?T7.SUCCESS:T7.failure(qve.MUST_GIVE_A_PIECE()):Wve.isAlreadyOnBoard(a,o)?T7.failure(qve.PIECE_ALREADY_ON_BOARD()):s===a?T7.failure(qve.CANNOT_GIVE_PIECE_IN_HAND()):T7.SUCCESS}},{key:"updateBoardStatus",value:function(e,t,n){return n.score===aoe.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:aoe.VICTORY,sensitiveSquares:new Cse}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}},{key:"isThereAVictoriousLine",value:function(e,t){for(var r=e.initialCoord,i=t.getPieceAt(r),a=new jve(i),o=0;o<3&&!1!==n.isOccupied(i)&&!a.areAllAbsent();o++)r=r.getNext(e.direction,1),i=t.getPieceAt(r),a.mergeWithQuartoPiece(i);return!(!n.isOccupied(i)||a.areAllAbsent())}},{key:"searchForVictoryOrPreVictoryInLine",value:function(e,t,r){var i=n.getLineInfos(e,t,r);if(i.boardStatus.isPresent())return i.boardStatus.get();var a=i.commonCriterion,o=i.sensitiveCoord;if(a.isPresent()&&!1===a.get().areAllAbsent()){if(o.isAbsent())return{score:aoe.VICTORY,sensitiveSquares:new Cse};a.get().matchPiece(t.pieceInHand)&&(r.score=aoe.PRE_VICTORY);var s=o.get();r.sensitiveSquares.add(s)}return r}},{key:"getLineInfos",value:function(e,t,r){for(var i=lV.empty(),a=lV.empty(),o=e.initialCoord,s=0;s<4;s++){var u=t.getPieceAt(o);if(u===Gve.EMPTY){if(!i.isAbsent())return{sensitiveCoord:lV.of(o),commonCriterion:a,boardStatus:lV.of(r)};i=lV.of(o)}else a.isAbsent()?(a=lV.of(new jve(u)),oV(n.VERBOSE,"set commonCrit to "+a.toString())):(a.get().mergeWithQuartoPiece(u),oV(n.VERBOSE,"update commonCrit: "+a.toString()));o=o.getNext(e.direction,1)}return{commonCriterion:a,sensitiveCoord:i,boardStatus:lV.empty()}}},{key:"scoreToGameStatus",value:function(e,t){var n=Nre.of(t%2);return e===aoe.VICTORY?loe.getDefeat(n):16===t?loe.DRAW:loe.ONGOING}}]),n}(hoe);Yve.VERBOSE=!1,Yve.lines=[new Zve(new Bae(0,0),Lae.DOWN),new Zve(new Bae(1,0),Lae.DOWN),new Zve(new Bae(2,0),Lae.DOWN),new Zve(new Bae(3,0),Lae.DOWN),new Zve(new Bae(0,0),Lae.RIGHT),new Zve(new Bae(0,1),Lae.RIGHT),new Zve(new Bae(0,2),Lae.RIGHT),new Zve(new Bae(0,3),Lae.RIGHT),new Zve(new Bae(0,0),Lae.DOWN_RIGHT),new Zve(new Bae(0,3),Lae.UP_RIGHT)];var Kve=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){for(var t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),a=n.pieceInHand,o=0;o<4;o++)for(var s=0;s<4;s++)if(r[o][s]===Gve.EMPTY){if(n.getCopiedBoard()[o][s]=a,15===n.turn){var u=new $ve(s,o,Gve.EMPTY);return t.push(u),t}var c,l=Hg(i);try{for(l.s();!(c=l.n()).done;){var h=c.value,f=new $ve(s,o,h);t.push(f)}}catch(d){l.e(d)}finally{l.f()}}return t}},{key:"getBoardValue",value:function(e){var t,r=e.gameState,i={score:aoe.DEFAULT,sensitiveSquares:new Cse},a=Hg(Yve.lines);try{for(a.s();!(t=a.n()).done;){var o=t.value;if((i=Yve.updateBoardStatus(o,r,i)).score===aoe.VICTORY)break}}catch(s){a.e(s)}finally{a.f()}return n.scoreToBoardValue(i.score,r.turn)}}],[{key:"scoreToBoardValue",value:function(e,t){if(e===aoe.DEFAULT)return new Kae(0);var n=Nre.of(t%2);return new Kae(e===aoe.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}]),n}(Yae),Qve=Gve.AABA,Xve=Gve.AABB,Jve=Gve.ABAA,epe=Gve.ABAB,tpe=Gve.ABBA,npe=Gve.BAAA,rpe=Gve.BAAB,ipe=Gve.BABB,ape=Gve.BBAA,ope=Gve.BBAB,spe=Gve.BBBA,upe=Gve.BBBB,cpe=Gve.EMPTY,lpe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Fu||(Fu=wg(["Goal of the game"]))),$localize(Uu||(Uu=wg(["Quarto is an alignment game.\n        The goal is to align four pieces that have at least one common aspect:\n        <ul>\n          <li>their color (light or dark),</li>\n          <li>their size (big or small),</li>\n          <li>their pattern (empty or dotted),</li>\n          <li>their shape (round or square).</li>\n        </ul>\n        Here, we have a board with a victory by an alignment of dark pieces."]))),new Wve([[spe,ape,Jve,Qve],[cpe,cpe,cpe,cpe],[cpe,cpe,cpe,cpe],[cpe,cpe,cpe,cpe]],7,Gve.ABAB)),poe.anyMove($localize(Bu||(Bu=wg(["Placement"]))),$localize(Vu||(Vu=wg(["Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,\n        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.\n        If you prefer, the order of these two steps can be reversed.\n        Keep in mind that the second click confirms the move.<br/><br/>\n        Make a move."]))),new Wve([[spe,Xve,tpe,cpe],[cpe,cpe,cpe,cpe],[cpe,npe,cpe,cpe],[cpe,cpe,cpe,cpe]],7,Gve.ABAA),new $ve(2,2,Gve.BAAB),$localize(zu||(zu=wg(["Perfect!"])))),poe.fromMove($localize(Hu||(Hu=wg(["Situation"]))),$localize(Gu||(Gu=wg(["We have here a tricky situation.<br/><br/>\n        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move."]))),new Wve([[upe,spe,ope,cpe],[Jve,ipe,ape,cpe],[epe,npe,rpe,cpe],[cpe,cpe,cpe,cpe]],7,Gve.AABA),[new $ve(3,3,Gve.AABB)],$localize($u||($u=wg(["Well done!"]))),$localize(Wu||(Wu=wg(["Failed!"]))))]});function hpe(e,t){if(1&e&&(c_(),nS(0,"rect",11)),2&e){var n=hS(2),r=n.$implicit,i=n.index,a=hS().index,o=hS();XE("ngClass",o.getPieceClasses(r.value)),$E("x",o.SPACE_SIZE*i+(o.SPACE_SIZE/2-o.getPieceSize(r.value)))("y",o.SPACE_SIZE*a+(o.SPACE_SIZE/2-o.getPieceSize(r.value)))("width",2*o.getPieceSize(r.value))("height",2*o.getPieceSize(r.value))}}function fpe(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS(2),r=n.$implicit,i=n.index,a=hS().index,o=hS();XE("ngClass",o.getPieceClasses(r.value)),$E("cx",o.SPACE_SIZE*i+o.SPACE_SIZE/2)("cy",o.SPACE_SIZE*a+o.SPACE_SIZE/2)("r",o.getPieceSize(r.value))}}function dpe(e,t){if(1&e&&(c_(),nS(0,"circle")),2&e){var n=hS(2).index,r=hS().index,i=hS();$E("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",10)}}function vpe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,hpe,1,5,"rect",9),YE(2,fpe,1,4,"ng-template",null,10,RT),YE(4,dpe,1,3,"circle",3),tS()),2&e){var n=KE(3),r=hS().$implicit,i=hS(2);pb(1),XE("ngIf",r.isRectangle())("ngIfElse",n),pb(3),XE("ngIf",i.pieceHasDot(r.value))}}function ppe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",8),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().chooseCoord(e,t)}),tS(),YE(2,vpe,5,3,"g",3),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","chooseCoord_",i,"_",a,""),XE("ngClass",o.getSquareClasses(i,a)),$E("x",o.SPACE_SIZE*i)("y",o.SPACE_SIZE*a)("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r!==o.EMPTY)}}function gpe(e,t){if(1&e&&(c_(),eS(0,"g",null,7),YE(2,ppe,3,8,"g",2),tS()),2&e){var n=t.$implicit;pb(2),XE("ngForOf",n)}}function ype(e,t){if(1&e&&(c_(),nS(0,"rect",15)),2&e){var n=hS(2);XE("ngClass",n.getPieceClasses(n.pieceInHand.value)),$E("x",n.SPACE_SIZE/2-n.getPieceSize(n.pieceInHand.value))("y",n.SPACE_SIZE/2-n.getPieceSize(n.pieceInHand.value))("width",2*n.getPieceSize(n.pieceInHand.value))("height",2*n.getPieceSize(n.pieceInHand.value))}}function mpe(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS(2);XE("ngClass",n.getPieceClasses(n.pieceInHand.value)),$E("cx",n.SPACE_SIZE/2)("cy",n.SPACE_SIZE/2)("r",n.getPieceSize(n.pieceInHand.value))}}function kpe(e,t){if(1&e&&(c_(),nS(0,"circle")),2&e){var n=hS(2);$E("cx",n.SPACE_SIZE/2)("cy",n.SPACE_SIZE/2)("r",10)}}function _pe(e,t){if(1&e&&(c_(),eS(0,"g",null,12),nS(2,"rect",13),YE(3,ype,1,5,"rect",14),YE(4,mpe,1,4,"ng-template",null,10,RT),YE(6,kpe,1,3,"circle",3),tS()),2&e){var n=KE(5),r=hS();$E("transform","translate("+r.chosen.get().x*r.SPACE_SIZE+" "+r.chosen.get().y*r.SPACE_SIZE+")"),pb(2),$E("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),pb(1),XE("ngIf",r.pieceInHand.isRectangle())("ngIfElse",n),pb(3),XE("ngIf",r.pieceHasDot(r.pieceInHand.value))}}function Cpe(e,t){if(1&e&&(c_(),eS(0,"g",null,16),nS(2,"rect",17),tS()),2&e){var n=t.$implicit,r=hS();pb(2),$E("width",r.SPACE_SIZE)("height",r.SPACE_SIZE)("transform","translate("+n.x*r.SPACE_SIZE+" "+n.y*r.SPACE_SIZE+")")}}function wpe(e,t){if(1&e&&(c_(),nS(0,"rect",11)),2&e){var n=hS(2);XE("ngClass",n.getPieceClasses(n.pieceInHand.value)),$E("x",0)("y",.75*n.SPACE_SIZE)("transform","translate("+-n.getPieceSize(n.pieceInHand.value)+", "+-n.getPieceSize(n.pieceInHand.value)+")")("width",2*n.getPieceSize(n.pieceInHand.value))("height",2*n.getPieceSize(n.pieceInHand.value))}}function bpe(e,t){if(1&e&&(c_(),nS(0,"circle",19)),2&e){var n=hS(2);XE("ngClass",n.getPieceClasses(n.pieceInHand.value)),$E("cy",.75*n.SPACE_SIZE)("r",n.getPieceSize(n.pieceInHand.value))}}function Epe(e,t){1&e&&(c_(),nS(0,"circle",20)),2&e&&$E("cy",.75*hS(2).SPACE_SIZE)("r",10)}function Spe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,wpe,1,6,"rect",9),YE(2,bpe,1,3,"ng-template",null,10,RT),YE(4,Epe,1,2,"circle",18),tS()),2&e){var n=KE(3),r=hS();pb(1),XE("ngIf",r.pieceInHand.isRectangle())("ngIfElse",n),pb(3),XE("ngIf",r.pieceHasDot(r.pieceInHand.value))}}function Ppe(e,t){if(1&e&&(c_(),nS(0,"rect",27)),2&e){var n=hS(2).index,r=hS().index,i=hS();$E("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}function Ope(e,t){if(1&e&&(c_(),nS(0,"rect",11)),2&e){var n=hS(2).index,r=hS().index,i=hS();XE("ngClass",i.getPieceClasses(4*r+n)),$E("x",i.SPACE_SIZE*n+i.SPACE_SIZE/2-i.getPieceSize(4*r+n))("y",i.SPACE_SIZE*r+i.SPACE_SIZE/2-i.getPieceSize(4*r+n))("width",2*i.getPieceSize(4*r+n))("height",2*i.getPieceSize(4*r+n))}}function Tpe(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS(2).index,r=hS().index,i=hS();XE("ngClass",i.getPieceClasses(4*r+n)),$E("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(4*r+n))}}function Ipe(e,t){if(1&e&&(c_(),nS(0,"circle")),2&e){var n=hS(2).index,r=hS().index,i=hS();$E("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",10)}}function Ape(e,t){if(1&e){var n=aS();c_(),eS(0,"g",25),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().choosePiece(4*t+e)}),YE(1,Ppe,1,4,"rect",26),YE(2,Ope,1,5,"rect",9),YE(3,Tpe,1,4,"ng-template",null,10,RT),YE(5,Ipe,1,3,"circle",3),tS()}if(2&e){var r=KE(4),i=hS().index,a=hS().index,o=hS();dS("id","choosePiece_",4*a+i,""),pb(1),XE("ngIf",o.pieceToGive.value===4*a+i),pb(1),XE("ngIf",(4*a+i)%4<2)("ngIfElse",r),pb(3),XE("ngIf",o.pieceHasDot(4*a+i))}}function xpe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Ape,6,5,"g",24),tS()),2&e){var n=t.index,r=hS().index,i=hS();pb(1),XE("ngIf",i.isRemaining(4*r+n))}}function Rpe(e,t){if(1&e&&(c_(),eS(0,"g",null,21),nS(2,"rect",22,23),YE(4,xpe,2,1,"g",2),tS()),2&e){var n=t.$implicit,r=hS();$E("transform","translate(0 "+6.5*r.SPACE_SIZE+")"),pb(2),$E("x",-.125*r.SPACE_SIZE)("y",-.125*r.SPACE_SIZE)("width",4.25*r.SPACE_SIZE)("height",4.25*r.SPACE_SIZE),pb(2),XE("ngForOf",n)}}var Mpe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).EMPTY=Gve.EMPTY,r.chosen=lV.empty(),r.lastMove=lV.empty(),r.pieceInHand=Gve.EMPTY,r.pieceToGive=Gve.EMPTY,r.victoriousCoords=[],r.rules=new Yve(Wve),r.availableMinimaxes=[new Kve(r.rules,"QuartoMinimax")],r.encoder=$ve.encoder,r.tutorial=(new lpe).tutorial,r.pieceInHand=r.rules.node.gameState.pieceInHand,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){var e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=lV.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(function(e){return e.coord})}},{key:"chooseCoord",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#chooseCoord_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:if(n.hideLastMove(),n.board[t][e]!==Gve.EMPTY){r.next=11;break}if(n.showPieceInHandOnBoard(e,t),15!==n.rules.node.gameState.turn){r.next=7;break}return a=new $ve(e,t,Gve.EMPTY),r.abrupt("return",n.chooseMove(a,n.rules.node.gameState));case 7:if(n.pieceToGive!==Gve.EMPTY){r.next=9;break}return r.abrupt("return",T7.SUCCESS);case 9:return o=new $ve(e,t,n.pieceToGive),r.abrupt("return",n.chooseMove(o,n.rules.node.gameState));case 11:return r.abrupt("return",n.cancelMove(Zae.MUST_CLICK_ON_EMPTY_SPACE()));case 12:case"end":return r.stop()}},r)}))()}},{key:"choosePiece",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#choosePiece_"+e)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if(t.hideLastMove(),t.pieceToGive=Gve.fromInt(e),!t.chosen.isAbsent()){n.next=5;break}return n.abrupt("return",T7.SUCCESS);case 5:return i=t.chosen.get(),a=new $ve(i.x,i.y,t.pieceToGive),n.abrupt("return",t.chooseMove(a,t.rules.node.gameState));case 7:case"end":return n.stop()}},n)}))()}},{key:"hideLastMove",value:function(){this.lastMove=lV.empty()}},{key:"cancelMoveAttempt",value:function(){this.hideLastMove(),this.pieceToGive=Gve.EMPTY}},{key:"showPieceInHandOnBoard",value:function(e,t){this.chosen=lV.of(new Bae(e,t))}},{key:"isRemaining",value:function(e){return Wve.isGivable(Gve.fromInt(e),this.board,this.pieceInHand)}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}},{key:"getPieceClasses",value:function(e){var t=[];return t.push(e%2==0?"player0":"player1"),t}},{key:"getPieceSize",value:function(e){return e<8?40:25}},{key:"pieceHasDot",value:function(e){return e!==Gve.EMPTY.value&&e%8<4}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-quarto"]],features:[xE],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"g",1),YE(2,gpe,3,1,"g",2),YE(3,_pe,7,6,"g",3),YE(4,Cpe,3,3,"g",2),eS(5,"g",null,4),nS(7,"rect",5,6),YE(9,Spe,5,3,"g",3),tS(),YE(10,Rpe,5,6,"g",2),tS(),tS()),2&e&&($E("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),pb(2),XE("ngForOf",t.board),pb(1),XE("ngIf",t.chosen.isPresent()),pb(1),XE("ngForOf",t.victoriousCoords),pb(1),$E("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),pb(2),$E("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),pb(2),XE("ngIf",t.chosen.isAbsent()),pb(1),XE("ngForOf",t.board))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Npe=function(){var e=jg(function e(){Wg(this,e)});return e.NO_INSIDE_CLICK=function(){return $localize(qu||(qu=wg(["You must pick a space from the edge of the board."])))},e}(),Dpe=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;Wg(this,n),(a=t.call(this,e,r)).direction=i;var o=n.isValidCoord(a.coord);if(o.isFailure())throw new Error(o.getReason());if(0===e&&i===Fae.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&i===Fae.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===r&&i===Fae.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===r&&i===Fae.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.");return a}return jg(n,[{key:"toString",value:function(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}},{key:"equals",value:function(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}],[{key:"isValidCoord",value:function(e){return e.isNotInRange(5,5)?T7.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?T7.failure(Npe.NO_INSIDE_CLICK()):T7.SUCCESS}}]),n}(roe);Dpe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 128}},{key:"encodeNumber",value:function(e){var t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}},{key:"decodeNumber",value:function(e){var t=Fae.factory.fromInt(e%4).get();e-=e%4;var n=(e/=4)%5;return e-=e%5,new Dpe(e/=5,n,t)}}]),n}(xre));var Lpe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e){for(var t=this.getCopiedBoard(),r=this.turn+1,i=e.coord,a=e.coord.getNext(e.direction);a.isInRange(5,5);)t[i.y][i.x]=t[a.y][a.x],i=i.getNext(e.direction),a=a.getNext(e.direction);return t[i.y][i.x]=this.getCurrentPlayer(),new n(t,r)}}],[{key:"getInitialState",value:function(){return new n(Ure.createTable(5,5,Mre.NONE),0)}}]),n}(eoe),Fpe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){return n.applyLegalMove(e,t,r)}},{key:"isLegal",value:function(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?S7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){var t=e.gameState,r=n.getLinesSums(t),i=n.getFullestLine(r[Nre.ZERO.value]),a=n.getFullestLine(r[Nre.ONE.value]),o=t.getCurrentPlayer();return 5===i&&(o===Nre.ZERO||a<5)?loe.ZERO_WON:5===a?loe.ONE_WON:loe.ONGOING}}],[{key:"getVerticalCoords",value:function(e){for(var t=e.gameState.getCurrentOpponent(),n=[],r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new Bae(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new Bae(4,r));return n}},{key:"getHorizontalCenterCoords",value:function(e){for(var t=e.gameState.getCurrentOpponent(),n=[],r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new Bae(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new Bae(r,4));return n}},{key:"getPossibleDirections",value:function(e){var t=[];return 0!==e.x&&t.push(Fae.LEFT),0!==e.y&&t.push(Fae.UP),4!==e.x&&t.push(Fae.RIGHT),4!==e.y&&t.push(Fae.DOWN),t}},{key:"getLinesSums",value:function(e){var t={};t[Nre.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[Nre.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(var n=0;n<5;n++)for(var r=0;r<5;r++){var i=e.getPieceAtXY(r,n);if(i.isPlayer()){var a=i.value;t[a].columns[r]=t[a].columns[r]+1,t[a].rows[n]=t[a].rows[n]+1,r===n&&(t[a].diagonals[0]=t[a].diagonals[0]+1),r+n===4&&(t[a].diagonals[1]=t[a].diagonals[1]+1)}}return t}},{key:"getVictoriousCoords",value:function(e){for(var t=n.getLinesSums(e),r=[],i=0;i<2;i++){for(var a=0;a<5;a++){if(5===t[i].columns[a])for(var o=0;o<5;o++)r.push(new Bae(a,o));if(5===t[i].rows[a])for(var s=0;s<5;s++)r.push(new Bae(s,a))}if(5===t[i].diagonals[0])for(var u=0;u<5;u++)r.push(new Bae(u,u));if(5===t[i].diagonals[1])for(var c=0;c<5;c++)r.push(new Bae(c,4-c))}return r}},{key:"getFullestLine",value:function(e){var t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max.apply(Math,Vg(t))}},{key:"applyLegalMove",value:function(e,t,n){return t.applyLegalMove(e)}}]),n}(hoe),Upe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t,n=[],r=Fpe.getVerticalCoords(e),i=Hg(Fpe.getHorizontalCenterCoords(e).concat(r));try{for(i.s();!(t=i.n()).done;){var a,o=t.value,s=Hg(Fpe.getPossibleDirections(o));try{for(s.s();!(a=s.n()).done;){var u=a.value,c=new Dpe(o.x,o.y,u);n.push(c)}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}return n}},{key:"getBoardValue",value:function(e){var t=e.gameState,n=Fpe.getLinesSums(t),r=Fpe.getFullestLine(n[Nre.ZERO.value]),i=Fpe.getFullestLine(n[Nre.ONE.value]),a=t.getCurrentPlayer();return new Kae(5===r&&(a===Nre.ZERO||i<5)?Nre.ZERO.getVictoryValue():5===i?Nre.ONE.getVictoryValue():i-r)}}]),n}(Yae),Bpe=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getArrowTransform",value:function(e,t,n){var r,i,a;switch(n){case Fae.UP:r=0,i=-1,a=-90;break;case Fae.DOWN:r=0,i=1,a=90;break;case Fae.LEFT:r=-1,i=0,a=180;break;default:aV.expectToBe(n,Fae.RIGHT),r=1,i=0,a=0}return["translate(".concat(t.x*e+e/2+r*e/4," ").concat(t.y*e+e/2+i*e/4,")"),"scale(2.5)","rotate(".concat(a,")")].join(" ")}}]),e}(),Vpe=Mre.NONE,zpe=Nre.ZERO,Hpe=Nre.ONE,Gpe=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(ju||(ju=wg(["Goal of the game."]))),$localize(Zu||(Zu=wg(["At Quixo, the goal is to align 5 of your pieces.\n        The first player plays with dark pieces, the second with light pieces.\n        The board is made of 25 spaces spread over a 5x5 square.\n        Every piece has a neutral side, a light side, and a dark side."]))),Lpe.getInitialState()),poe.fromMove($localize(Yu||(Yu=wg(["What a move looks like (without animation)"]))),$localize(Ku||(Ku=wg(["When it is your turn:\n        <ol>\n            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.\n                You can only choose a piece from the edge of the board.</li>\n            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>\n        </ol>\n        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.\n        Once on the other side, all pieces will move by one space in the opposing direction.\n        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>\n        For example, take the bottom right neutral piece, and move it to the left (you're playing Light)."]))),new Lpe([[Vpe,Vpe,Vpe,Vpe,Vpe],[Vpe,Vpe,Vpe,Vpe,Vpe],[Vpe,Vpe,Vpe,Vpe,Vpe],[Vpe,Vpe,Vpe,Vpe,Vpe],[zpe,zpe,zpe,zpe,Vpe]],1),[new Dpe(4,4,Fae.LEFT)],$localize(Qu||(Qu=wg(["See how the four dark pieces have been moved one space to the right.\n        The neutral piece has been move 4 pieces to the left and has become light."]))),$localize(Xu||(Xu=wg(["Failed!"])))),poe.fromMove($localize(Ju||(Ju=wg(["Victory"]))),$localize(ec||(ec=wg(["You already know everything you need in order to play, but there is one last particularity.\n        If you create a line of 5 of your pieces, you win.\n        If you create a line of 5 of your opponent's pieces, you lose.\n        If you create both, you lose too!<br/><br/>\n        You can win with this board, try it.\n        You're playing Light."]))),new Lpe([[Vpe,Hpe,Vpe,Hpe,Hpe],[Vpe,zpe,zpe,Vpe,zpe],[Hpe,Hpe,Hpe,zpe,Hpe],[zpe,Vpe,zpe,Hpe,Hpe],[Hpe,zpe,Vpe,Hpe,zpe]],31),[new Dpe(3,0,Fae.DOWN)],$localize(tc||(tc=wg(["Congratulations, you won!"]))),$localize(nc||(nc=wg(["Failed!"]))))]});function $pe(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",4),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onBoardClick(e,t)}),tS(),tS()}if(2&e){var r=t.index,i=hS().index,a=hS();pb(1),vS("id","click_",r,"_",i,""),XE("ngClass",a.getPieceClasses(r,i)),$E("cx",50+100*r)("cy",50+100*i)}}function Wpe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,$pe,2,5,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function qpe(e,t){if(1&e){var n=aS();c_(),eS(0,"use",6),uS("click",function(){var e=Nk(n).$implicit;return hS(2).chooseDirection(e)}),tS()}if(2&e){var r=t.$implicit,i=hS(2);dS("id","chooseDirection_",r,""),$E("transform",i.getArrowTransform(i.chosenCoord.get(),r))}}function jpe(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,qpe,1,2,"use",5),tS()),2&e){var n=hS();pb(1),XE("ngForOf",n.getPossiblesDirections())}}var Zpe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).lastMoveCoord=lV.empty(),r.chosenCoord=lV.empty(),r.victoriousCoords=[],r.rules=new Fpe(Lpe),r.availableMinimaxes=[new Upe(r.rules,"QuixoMinimax")],r.encoder=Dpe.encoder,r.tutorial=(new Gpe).tutorial,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(function(e){return e.coord}),this.victoriousCoords=Fpe.getVictoriousCoords(this.state)}},{key:"cancelMoveAttempt",value:function(){this.chosenCoord=lV.empty()}},{key:"getPieceClasses",value:function(e,t){var n=new Bae(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(function(e){return e.equals(n)})&&r.push("victory-stroke"),r}},{key:"onBoardClick",value:function(e,t){var n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());var r=new Bae(e,t),i=Dpe.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=lV.of(r),T7.SUCCESS)}},{key:"getPossiblesDirections",value:function(){var e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}},{key:"chooseDirection",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#chooseDirection_"+e)).isFailure()){n.next=5;break}n.t0=t.cancelMove(r.getReason()),n.next=9;break;case 5:return t.chosenDirection=Fae.factory.fromString(e).get(),n.next=8,t.tryMove();case 8:n.t0=n.sent;case 9:return n.abrupt("return",n.t0);case 10:case"end":return n.stop()}},n)}))()}},{key:"tryMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.chosenCoord.get(),r=new Dpe(n.x,n.y,e.chosenDirection),t.abrupt("return",(e.cancelMove(),e.chooseMove(r,e.rules.node.gameState)));case 2:case"end":return t.stop()}},t)}))()}},{key:"getArrowTransform",value:function(e,t){return Bpe.getArrowTransform(this.SPACE_SIZE,e,Fae.factory.fromString(t).get())}}]),n}(Koe);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-quixo"]],features:[xE],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"defs"),nS(2,"polygon",1),tS(),YE(3,Wpe,2,1,"g",2),YE(4,jpe,2,1,"g",3),tS()),2&e&&(pb(3),XE("ngForOf",t.board),pb(1),XE("ngIf",t.chosenCoord.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Ype=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"countScore",value:function(){for(var e=[0,0],t=0;t<n.BOARD_HEIGHT;t++)for(var r=0;r<n.BOARD_WIDTH;r++){var i=this.board[t][r];i.isPlayer()&&(e[i.value]+=1)}return e}}],[{key:"getInitialState",value:function(){var e=Ure.createTable(n.BOARD_WIDTH,n.BOARD_HEIGHT,Mre.NONE);return e[3][3]=Nre.ZERO,e[4][4]=Nre.ZERO,e[3][4]=Nre.ONE,e[4][3]=Nre.ONE,new n(e,0)}},{key:"getNeighbooringPawnLike",value:function(e,t,n,r){for(var i,a=[],o=-1;o<2;o++)for(var s=-1;s<2;s++)(i=new Bae(n+s,r+o)).isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&a.push(i);return a}}]),n}(eoe);return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e}(),Kpe=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"equals",value:function(e){return e===this||e.coord.equals(this.coord)}},{key:"toString",value:function(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}]),n}(roe);Kpe.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return(Ype.BOARD_HEIGHT-1)*Ype.BOARD_WIDTH+(Ype.BOARD_WIDTH-1)}},{key:"encodeNumber",value:function(e){return e.coord.y*Ype.BOARD_WIDTH+e.coord.x}},{key:"decodeNumber",value:function(e){var t=e%Ype.BOARD_WIDTH;return new Kpe(t,(e-t)/Ype.BOARD_WIDTH)}}]),n}(xre)),Kpe.PASS=new Kpe(-1,-1),Kpe.PASS_NUMBER=Kpe.encoder.encodeNumber(Kpe.PASS);var Qpe=function(){var e=jg(function e(){Wg(this,e)});return e.NO_ELEMENT_SWITCHED=function(){return $localize(rc||(rc=wg(["Your move should switch at least one piece."])))},e}(),Xpe=jg(function e(t,n){Wg(this,e),this.move=t,this.switched=n}),Jpe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){var r=t.turn,i=t.getCurrentPlayer(),a=t.getCopiedBoard();if(e.equals(Kpe.PASS))return new Ype(a,r+1);var o,s=Hg(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;a[u.y][u.x]=i}}catch(c){s.e(c)}finally{s.f()}return a[e.coord.y][e.coord.x]=i,new Ype(a,r+1)}},{key:"getGameStatus",value:function(e){return n.getGameStatus(e)}},{key:"isLegal",value:function(e,t){if(e.equals(Kpe.PASS))return n.playerCanOnlyPass(t)?S7.success([]):S7.failure(Zae.MUST_PASS());if(t.getPieceAt(e.coord).isPlayer())return oV(n.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),S7.failure(Zae.MUST_CLICK_ON_EMPTY_SPACE());var r=t.getCopiedBoard(),i=n.getAllSwitcheds(e,t.getCurrentPlayer(),r);return oV(n.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?S7.failure(Qpe.NO_ELEMENT_SWITCHED()):S7.success(i)}}],[{key:"getGameStatus",value:function(e){var t=e.gameState;if(!1===n.isGameEnded(t))return loe.ONGOING;var r=t.countScore(),i=r[1]-r[0];return i<0?loe.ZERO_WON:i>0?loe.ONE_WON:loe.DRAW}},{key:"getAllSwitcheds",value:function(e,t,r){var i,a=[],o=t.getOpponent(),s=Hg(Lae.DIRECTIONS);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=e.coord.getNext(u);if(c.isInRange(Ype.BOARD_WIDTH,Ype.BOARD_HEIGHT)&&r[c.y][c.x]===o){var l,h=Hg(n.getSandwicheds(t,u,c,r));try{for(h.s();!(l=h.n()).done;){var f=l.value;a.push(f)}}catch(d){h.e(d)}finally{h.f()}}}}catch(d){s.e(d)}finally{s.f()}return a}},{key:"getSandwicheds",value:function(e,t,n,r){for(var i=[n],a=n.getNext(t);a.isInRange(Ype.BOARD_WIDTH,Ype.BOARD_HEIGHT);){var o=r[a.y][a.x];if(o===e)return i;if(o===Mre.NONE)return[];i.push(a),a=a.getNext(t)}return[]}},{key:"isGameEnded",value:function(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}},{key:"playerCanOnlyPass",value:function(e){var t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(Kpe.PASS)}},{key:"nextPlayerCantOnlyPass",value:function(e){var t=e.getCopiedBoard(),n=new Ype(t,e.turn+1);return this.playerCanOnlyPass(n)}},{key:"getListMoves",value:function(e){for(var t,r=[],i=e.getCurrentPlayer(),a=e.getCurrentOpponent(),o=0;o<8;o++)for(var s=0;s<8;s++)if(e.getPieceAtXY(s,o)===Mre.NONE&&(t=e.getCopiedBoard(),Ype.getNeighbooringPawnLike(t,a,s,o).length>0)){var u=new Kpe(s,o),c=n.getAllSwitcheds(u,i,t);if(c.length>0){var l,h=Hg(c);try{for(h.s();!(l=h.n()).done;){var f=l.value;M7(i!==e.getPieceAt(f),f+"was already switched!"),t[f.y][f.x]=i}}catch(d){h.e(d)}finally{h.f()}t[o][s]=i,r.push(new Xpe(u,c.length))}}return 0===r.length&&r.push(new Xpe(Kpe.PASS,0)),r}}]),n}(hoe);return e.VERBOSE=!1,e}(),ege=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=Jpe.getGameStatus(e);if(t.isEndGame)return Kae.fromWinner(t.winner);for(var n=e.gameState.getCopiedBoard(),r=0,i=0,a=0;a<Ype.BOARD_HEIGHT;a++)for(var o=0;o<Ype.BOARD_WIDTH;o++){var s=(0===o||o===Ype.BOARD_WIDTH-1?4:1)*(0===a||a===Ype.BOARD_HEIGHT-1?4:1);n[a][o]===Nre.ZERO&&(r+=s),n[a][o]===Nre.ONE&&(i+=s)}return r*=Nre.ZERO.getScoreModifier(),i*=Nre.ONE.getScoreModifier(),new Kae(i+r)}},{key:"getListMoves",value:function(e){var t=Jpe.getListMoves(e.gameState);return Ure.sortByDescending(t,function(e){return n.bestCoords.some(function(t){return e.move.coord.equals(t)})?100:e.switched}),t.map(function(e){return e.move})}}]),n}(Yae);ege.bestCoords=[new Bae(0,0),new Bae(0,Ype.BOARD_HEIGHT-1),new Bae(Ype.BOARD_WIDTH-1,0),new Bae(Ype.BOARD_WIDTH-1,Ype.BOARD_HEIGHT-1)];var tge=Mre.NONE,nge=Nre.ZERO,rge=Nre.ONE,ige=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(ic||(ic=wg(["Goal of the game"]))),$localize(ac||(ac=wg(["At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.\n        When one piece is flipped, its owner changes.\n        The player owning the most pieces at the end of the game wins.\n        Here, Dark has 28 points and Light has 36, hence Light wins."]))),new Ype([[nge,nge,nge,nge,nge,nge,nge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,nge,nge,nge,nge,nge,nge,nge]],60)),poe.anyMove($localize(oc||(oc=wg(["Capture (1/2)"]))),$localize(sc||(sc=wg(["At the beginning of the game, pieces are placed as shown here.\n        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>\n        Do any move by clicking to put your piece\n        Dark plays first."]))),Ype.getInitialState(),new Kpe(2,4),$localize(uc||(uc=wg(["Congratulations!"])))),poe.fromMove($localize(cc||(cc=wg(["Capture (2/2)"]))),$localize(lc||(lc=wg(["A move can also capture a bigger line, and more than one lines at a time\n        You're playing light here.<br/><br/>\n        Play on the bottom left to see an example."]))),new Ype([[tge,tge,tge,tge,tge,tge,tge,tge],[tge,tge,tge,tge,tge,tge,tge,tge],[tge,tge,tge,tge,tge,tge,tge,tge],[tge,tge,tge,tge,rge,tge,tge,tge],[tge,tge,tge,nge,tge,tge,tge,tge],[tge,tge,nge,tge,tge,tge,tge,tge],[nge,nge,tge,tge,tge,tge,tge,tge],[tge,nge,rge,nge,rge,nge,tge,tge]],1),[new Kpe(0,7)],$localize(hc||(hc=wg(["Congratulations!"]))),$localize(fc||(fc=wg(["Lower and more to the left, please."])))),poe.informational($localize(dc||(dc=wg(["Passing a turn"]))),$localize(vc||(vc=wg(["If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass\n        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way."]))),new Ype([[rge,nge,nge,nge,nge,nge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[nge,rge,rge,rge,rge,rge,rge,nge],[rge,rge,rge,rge,rge,rge,tge,tge],[nge,nge,nge,nge,nge,nge,tge,tge]],60))]});function age(e,t){if(1&e&&(c_(),nS(0,"circle",4)),2&e){var n=hS().index,r=hS().index,i=hS();XE("ngClass",i.getPieceClass(n,r)),$E("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)}}function oge(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",2),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),tS(),YE(2,age,1,4,"circle",3),tS()}if(2&e){var r=t.index,i=hS().index,a=hS();pb(1),vS("id","click_",r,"_",i,""),XE("ngClass",a.getRectClasses(r,i)),$E("x",a.SPACE_SIZE*r)("y",a.SPACE_SIZE*i)("width",a.SPACE_SIZE)("height",a.SPACE_SIZE),pb(1),XE("ngIf",a.board[i][r]!==a.EMPTY)}}function sge(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,oge,3,8,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var uge=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).EMPTY=Mre.NONE,r.lastMove=new Bae(-2,-2),r.captureds=[],r.scores=lV.of([2,2]),r.rules=new Jpe(Ype),r.availableMinimaxes=[new ege(r.rules,"ReversiMinimax")],r.encoder=Kpe.encoder,r.tutorial=(new ige).tutorial,r.canPass=!1,r.updateBoard(),r}return jg(n,[{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=n.canUserPlay("#click_"+e+"_"+t)).isFailure()){r.next=3;break}return r.abrupt("return",n.cancelMove(i.getReason()));case 3:return a=new Kpe(e,t),r.next=6,n.chooseMove(a,n.rules.node.gameState,n.scores.get());case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r)}))()}},{key:"updateBoard",value:function(){var e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new Bae(-2,-2),this.scores=lV.of(e.countScore()),this.canPass=Jpe.playerCanOnlyPass(e)}},{key:"showPreviousMove",value:function(){this.lastMove=this.rules.node.move.get().coord;var e,t=this.rules.node.gameState.getCurrentPlayer(),n=this.rules.node.gameState.getCurrentOpponent(),r=Hg(Lae.DIRECTIONS);try{for(r.s();!(e=r.n()).done;)for(var i=e.value,a=this.lastMove.getNext(i,1);a.isInRange(Ype.BOARD_WIDTH,Ype.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(a)===n&&this.rules.node.mother.get().gameState.getPieceAt(a)===t;)this.captureds.push(a),a=a.getNext(i,1)}catch(o){r.e(o)}finally{r.f()}}},{key:"getRectClasses",value:function(e,t){var n=new Bae(e,t);return this.captureds.some(function(e){return e.equals(n)})?["captured"]:n.equals(this.lastMove)?["moved"]:[]}},{key:"getPieceClass",value:function(e,t){return this.getPlayerClass(this.board[t][e])}},{key:"pass",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(M7(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(Kpe.PASS.coord.x,Kpe.PASS.coord.y)));case 1:case"end":return t.stop()}},t)}))()}}]),n}(Koe);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-reversi"]],features:[xE],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,sge,2,1,"g",1),tS()),2&e&&($E("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),pb(1),XE("ngForOf",t.board))},directives:[LA,NA,UA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),cge=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,null,[{key:"getInitialState",value:function(){var e=Hae.UNREACHABLE,t=Hae.ZERO,r=Hae.ONE,i=Hae.EMPTY;return new n([[e,e,t,r,i,i,i,t,r,e,e],[e,i,i,i,i,i,i,i,i,i,e],[r,i,i,i,i,i,i,i,i,i,t],[t,i,i,i,i,i,i,i,i,i,r],[e,i,i,i,i,i,i,i,i,i,e],[e,e,r,t,i,i,i,r,t,e,e]],0)}}]),n}(jse);return e.HEIGHT=6,e.WIDTH=11,e}(),lge=function(){var e=jg(function e(){Wg(this,e)});return e.CAN_ONLY_REBOUND_ON_BLACK=function(){return $localize(pc||(pc=wg(["You can only rebound on dark spaces."])))},e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=function(){return $localize(gc||(gc=wg(["You can only rebound on empty spaces."])))},e.MUST_CHOOSE_PYRAMID_FIRST=function(){return $localize(yc||(yc=wg(["You must pick one of your pyramids first."])))},e.MUST_CHOOSE_OWN_PYRAMID=function(){return $localize(mc||(mc=wg(["You must pick one of your pyramids."])))},e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=function(){return $localize(kc||(kc=wg(["Those two spaces are not neighbors."])))},e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=function(){return $localize(_c||(_c=wg(["Those two spaces have no intermediary neighbor."])))},e}(),hge=function(e){Mg(n,e);var t=Dg(n);function n(e,r){return Wg(this,n),t.call(this,e,r)}return jg(n,[{key:"isSimpleStep",value:function(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}},{key:"equals",value:function(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}},{key:"toString",value:function(){return"SaharaMove("+this.coord+"->"+this.end+")"}}],[{key:"checkDistanceAndLocation",value:function(e,t){var n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return T7.failure(Zae.MOVE_CANNOT_BE_STATIC());if(1===n){var r=qse.getFakeNeighbors(e);if(t.equals(r))return T7.failure(lge.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return T7.failure($localize(Cc||(Cc=wg(["You can move one or two spaces, not ","."])),n));if((e.x+e.y)%2==0)return T7.failure(lge.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return T7.failure(lge.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return T7.SUCCESS}},{key:"from",value:function(e,t){if(!e.isInRange(cge.WIDTH,cge.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(cge.WIDTH,cge.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");var r=n.checkDistanceAndLocation(e,t);return r.isFailure()?r.toFailedFallible():S7.success(new n(e,t))}}]),n}(ose);hge.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 396*cge.WIDTH+66*cge.HEIGHT+6*cge.WIDTH+cge.HEIGHT}},{key:"encodeNumber",value:function(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}},{key:"decodeNumber",value:function(e){var t=e%6;e-=t;var n=(e/=6)%11;e-=n;var r=(e/=11)%6;return e-=r,hge.from(new Bae(e/=6,r),new Bae(n,t)).get()}}]),n}(xre));var fge=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,r){oV(n.VERBOSE,"Legal move "+e.toString()+" applied");var i=t.getCopiedBoard();return i[e.end.y][e.end.x]=i[e.coord.y][e.coord.x],i[e.coord.y][e.coord.x]=Hae.EMPTY,new cge(i,t.turn+1)}},{key:"isLegal",value:function(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return S7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==Hae.EMPTY)return S7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE());var n=qse.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===Hae.EMPTY?S7.success(void 0):S7.failure(lge.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):S7.success(void 0)}},{key:"getGameStatus",value:function(e){var t=e.gameState.getCopiedBoard(),r=n.getBoardValuesFor(t,Nre.ZERO),i=n.getBoardValuesFor(t,Nre.ONE);return n.getGameStatusFromFreedoms(r,i)}}],[{key:"getStartingCoords",value:function(e,t){for(var n=[],r=0;r<cge.HEIGHT;r++)for(var i=0;i<cge.WIDTH;i++)e[r][i].is(t)&&n.push(new Bae(i,r));return n}},{key:"getBoardValuesFor",value:function(e,t){var r,i=[],a=Hg(n.getStartingCoords(e,t));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=jse.getEmptyNeighbors(e,o,Hae.EMPTY).length;if(0===s)return[0];i.push(s)}}catch(u){a.e(u)}finally{a.f()}return i.sort(function(e,t){return e-t})}},{key:"getGameStatusFromFreedoms",value:function(e,t){return 0===e[0]?loe.ONE_WON:0===t[0]?loe.ZERO_WON:loe.ONGOING}}]),n}(hoe);return e.VERBOSE=!1,e}(),dge=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getListMoves",value:function(e){var t,n=[],r=e.gameState.getCopiedBoard(),i=e.gameState.getCurrentPlayer(),a=Hg(fge.getStartingCoords(r,i));try{for(a.s();!(t=a.n()).done;){var o,s=t.value,u=Hg(jse.getEmptyNeighbors(r,s,Hae.EMPTY));try{for(u.s();!(o=u.n()).done;){var c=o.value,l=hge.from(s,c).get();if(r[c.y][c.x]=r[s.y][s.x],r[s.y][s.x]=Hae.EMPTY,n.push(l),(c.y+c.x)%2==0){var h,f=Hg(jse.getEmptyNeighbors(r,c,Hae.EMPTY));try{for(f.s();!(h=f.n()).done;){var d=h.value;if(!d.equals(s)){var v=hge.from(s,d).get();r[d.y][d.x]=r[c.y][c.x],r[c.y][c.x]=Hae.EMPTY,n.push(v),r[c.y][c.x]=r[d.y][d.x],r[d.y][d.x]=Hae.EMPTY}}}catch(p){f.e(p)}finally{f.f()}}r[s.y][s.x]=r[c.y][c.x],r[c.y][c.x]=Hae.EMPTY}}catch(p){u.e(p)}finally{u.f()}}}catch(p){a.e(p)}finally{a.f()}return n}},{key:"getBoardValue",value:function(e){var t=e.gameState.getCopiedBoard(),n=fge.getBoardValuesFor(t,Nre.ZERO),r=fge.getBoardValuesFor(t,Nre.ONE),i=fge.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return Kae.fromWinner(i.winner);for(var a=0;a<6&&n[a]===r[a];)a++;return new Kae(r[a%6]-n[a%6])}}]),n}(Yae),vge=Hae.UNREACHABLE,pge=Hae.ZERO,gge=Hae.ONE,yge=Hae.EMPTY,mge=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(wc||(wc=wg(["Initial board"]))),$localize(bc||(bc=wg(["S\xe2h\xe2r\xe2 is played on a board where each space is a triangle.\n        Each player has six pyramids."]))),cge.getInitialState()),poe.informational($localize(Ec||(Ec=wg(["Goal of the game"]))),$localize(Sc||(Sc=wg(["At S\xe2h\xe2r\xe2, the goal of the game is to immobilize one of the opponent's pyramids.\n        To do so, you have to occupy all neighboring space of that pyramid.\n        Here, Light has lost because its leftmost pyramid is immobilized."]))),new cge([[vge,vge,yge,yge,gge,yge,yge,pge,gge,vge,vge],[vge,yge,yge,yge,yge,yge,yge,yge,yge,yge,vge],[gge,pge,yge,yge,yge,yge,yge,yge,yge,yge,pge],[pge,yge,yge,yge,yge,yge,yge,yge,yge,yge,gge],[vge,yge,yge,yge,yge,yge,yge,yge,yge,yge,vge],[vge,vge,gge,pge,yge,yge,yge,gge,pge,vge,vge]],3)),poe.fromPredicate($localize(Pc||(Pc=wg(["Simple step"]))),$localize(Oc||(Oc=wg(["To immobilize your opponent, you have to move your pyramids.\n        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).\n        You're the first player, playing with the dark pyramids.\n        <ol>\n            <li>Click on one of your pyramids.</li>\n            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>\n        </ol><br/>\n        Do any simple step."]))),cge.getInitialState(),hge.from(new Bae(2,0),new Bae(2,1)).get(),function(e,t){return e.isSimpleStep()?T7.SUCCESS:T7.failure($localize(Tc||(Tc=wg(["You have made a double step, which is good but it is the next exercise!"]))))},$localize(Ic||(Ic=wg(["Congratulations!"])))),poe.fromPredicate($localize(Ac||(Ac=wg(["Double step"]))),$localize(xc||(xc=wg(["When a pyramid shares its vertices with dark spaces, it can move one or two steps.\n        To do so:\n        <ol>\n            <li>Click on the pyramid to move.</li>\n            <li>Click on one of the 6 destinations that you can reach in two steps:\n                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.\n        </ol>"]))),cge.getInitialState(),hge.from(new Bae(7,0),new Bae(5,0)).get(),function(e,t){return e.isSimpleStep()?T7.failure($localize(Rc||(Rc=wg(["Failed! You have made a single step."])))):T7.SUCCESS},$localize(Mc||(Mc=wg(["Congratulations!"]))))]});function kge(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"polyline",6),tS()),2&e){var n=hS().index,r=hS().index,i=hS();pb(1),XE("ngClass",i.getPlayerClassFor(n,r)),$E("points",i.getPyramidCoordinate(n,r))}}function _ge(e,t){if(1&e&&(c_(),nS(0,"polyline",9)),2&e){var n=hS(2).index,r=hS().index;$E("points",hS().getTriangleCoordinate(n,r))}}function Cge(e,t){if(1&e&&(c_(),nS(0,"polyline",10)),2&e){var n=hS(2).index,r=hS().index;$E("points",hS().getTriangleCoordinate(n,r))}}function wge(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,_ge,1,1,"polyline",7),YE(2,Cge,1,1,"polyline",8),tS()),2&e){var n=hS().index,r=hS().index;pb(1),XE("ngIf",(n+r)%2==1),pb(1),XE("ngIf",(n+r)%2==0)}}function bge(e,t){if(1&e){var n=aS();c_(),eS(0,"g",5),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),YE(1,kge,2,2,"g",2),YE(2,wge,3,2,"g",2),tS()}if(2&e){var r=t.$implicit;vS("id","click_",t.index,"_",hS().index,""),pb(1),XE("ngIf",r.isPlayer()),pb(1),XE("ngIf",2===r.value)}}function Ege(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,bge,3,4,"g",4),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Sge(e,t){if(1&e&&(c_(),rS(0),nS(1,"polyline",11),nS(2,"polyline",11),iS()),2&e){var n=hS();pb(1),$E("points",n.getTriangleCoordinate(n.lastCoord.get().x,n.lastCoord.get().y)),pb(1),$E("points",n.getTriangleCoordinate(n.lastMoved.get().x,n.lastMoved.get().y))}}function Pge(e,t){if(1&e&&(c_(),nS(0,"polyline",12)),2&e){var n=hS();$E("points",n.getTriangleCoordinate(n.chosenCoord.get().x,n.chosenCoord.get().y))}}var Oge=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).lastCoord=lV.empty(),r.lastMoved=lV.empty(),r.chosenCoord=lV.empty(),r.rules=new fge(cge),r.availableMinimaxes=[new dge(r.rules,"SaharaMinimax")],r.encoder=hge.encoder,r.tutorial=(new mge).tutorial,r.updateBoard(),r}return jg(n,[{key:"cancelMoveAttempt",value:function(){this.chosenCoord=lV.empty()}},{key:"onClick",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.canUserPlay("#click_"+e+"_"+t),r.abrupt("return",i.isFailure()?n.cancelMove(i.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t));case 2:case"end":return r.stop()}},r)}))()}},{key:"choosePiece",value:function(e,t){return this.board[t][e]===Hae.EMPTY?this.cancelMove(lge.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=lV.of(new Bae(e,t)),T7.SUCCESS):this.cancelMove(lge.MUST_CHOOSE_OWN_PYRAMID())}},{key:"chooseLandingCoord",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new Bae(e,t),a=n.rules.node.gameState.getCurrentPlayer(),o=Hae.ofPlayer(a),n.board[t][e]!==o){r.next=3;break}return r.abrupt("return",(n.chosenCoord=lV.of(new Bae(e,t)),T7.SUCCESS));case 3:if(!(s=hge.from(n.chosenCoord.get(),i)).isFailure()){r.next=8;break}r.t0=n.cancelMove(s.getReason()),r.next=11;break;case 8:return r.next=10,n.chooseMove(s.get(),n.rules.node.gameState);case 10:r.t0=r.sent;case 11:return r.abrupt("return",r.t0);case 12:case"end":return r.stop()}},r)}))()}},{key:"updateBoard",value:function(){this.chosenCoord=lV.empty();var e=this.rules.node.move;this.lastCoord=e.map(function(e){return e.coord}),this.lastMoved=e.map(function(e){return e.end}),this.board=this.rules.node.gameState.board}},{key:"getPlayerClassFor",value:function(e,t){return this.getPlayerClass(Nre.of(this.board[t][e].value))}}]),n}(Hse);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-sahara"]],features:[xE],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Ege,2,1,"g",1),YE(2,Sge,3,2,"ng-container",2),YE(3,Pge,1,1,"polyline",3),tS()),2&e&&(pb(1),XE("ngForOf",t.board),pb(1),XE("ngIf",t.lastMoved.isPresent()),pb(1),XE("ngIf",t.chosenCoord.isPresent()))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Tge=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this,e,r)).x=e,o.y=r,o.moveDirection=i,o.landingOrientation=a,o.checkValidity(),o}return jg(n,[{key:"checkValidity",value:function(){var e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}},{key:"isRotation",value:function(){return this.moveDirection.isAbsent()}},{key:"equals",value:function(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}},{key:"toString",value:function(){var e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}},{key:"isInsertion",value:function(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}]),n}(roe);Tge.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"maxValue",value:function(){return 2408}},{key:"encodeNumber",value:function(e){var t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}},{key:"decodeNumber",value:function(e){var t=e%7;e-=t;var n=(e/=7)%7;e-=n;var r=(e/=7)%5,i=4===r?lV.empty():Fae.factory.fromInt(r).toOptional();e-=r;var a=Fae.factory.fromInt(e/=5).get();return new Tge(n-1,t-1,i,a)}}]),n}(xre));var Ige=function(){function e(t){Wg(this,e),this.value=t}return jg(e,[{key:"belongTo",value:function(e){return e===Nre.ZERO?1<=this.value&&this.value<=4:5<=this.value&&this.value<=8}},{key:"isEmptyOrMountain",value:function(){return 0===this.value||9===this.value}},{key:"isPiece",value:function(){return!this.isEmptyOrMountain()}},{key:"getOwner",value:function(){return 1<=this.value&&this.value<=4?Nre.ZERO:5<=this.value&&this.value<=8?Nre.ONE:Mre.NONE}},{key:"getOptionalDirection",value:function(){switch(this.value){case 0:return lV.empty();case 1:case 5:return lV.of(Fae.UP);case 2:case 6:return lV.of(Fae.RIGHT);case 3:case 7:return lV.of(Fae.DOWN);case 4:case 8:return lV.of(Fae.LEFT);default:return aV.expectToBe(this.value,9),lV.empty()}}},{key:"getDirection",value:function(){return this.getOptionalDirection().get()}},{key:"toString",value:function(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return aV.expectToBe(this.value,9),"MOUNTAIN"}}}],[{key:"decode",value:function(t){switch(t){case 0:return e.EMPTY;case 1:return e.WHITE_UP;case 2:return e.WHITE_RIGHT;case 3:return e.WHITE_DOWN;case 4:return e.WHITE_LEFT;case 5:return e.BLACK_UP;case 6:return e.BLACK_RIGHT;case 7:return e.BLACK_DOWN;case 8:return e.BLACK_LEFT;case 9:return e.MOUNTAIN}}},{key:"of",value:function(t,n){return n===Nre.ZERO?t===Fae.UP?e.WHITE_UP:t===Fae.RIGHT?e.WHITE_RIGHT:t===Fae.DOWN?e.WHITE_DOWN:e.WHITE_LEFT:t===Fae.UP?e.BLACK_UP:t===Fae.RIGHT?e.BLACK_RIGHT:t===Fae.DOWN?e.BLACK_DOWN:e.BLACK_LEFT}}]),e}();Ige.EMPTY=new Ige(0),Ige.WHITE_UP=new Ige(1),Ige.WHITE_RIGHT=new Ige(2),Ige.WHITE_DOWN=new Ige(3),Ige.WHITE_LEFT=new Ige(4),Ige.BLACK_UP=new Ige(5),Ige.BLACK_RIGHT=new Ige(6),Ige.BLACK_DOWN=new Ige(7),Ige.BLACK_LEFT=new Ige(8),Ige.MOUNTAIN=new Ige(9);var Age=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"countPlayerPawn",value:function(){for(var e=0,t=0;t<5;t++)for(var n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}],[{key:"getInitialState",value:function(){var e=Ure.createTable(5,5,Ige.EMPTY);return e[2][1]=Ige.MOUNTAIN,e[2][2]=Ige.MOUNTAIN,e[2][3]=Ige.MOUNTAIN,new n(e,0)}}]),n}(eoe),xge=function(){var e=jg(function e(){Wg(this,e)});return e.CANNOT_INSERT_WHEN_SELECTED=function(){return $localize(Nc||(Nc=wg(["You cannot insert a piece when you have already selected a piece."])))},e.NO_REMAINING_PIECE_TO_INSERT=function(){return $localize(Dc||(Dc=wg(["You cannot insert a piece, all your pieces are already on the board."])))},e.NOT_ENOUGH_FORCE_TO_PUSH=function(){return $localize(Lc||(Lc=wg(["You do not have enough strength to push."])))},e.ILLEGAL_ROTATION=function(){return $localize(Fc||(Fc=wg(["You cannot push and turn at the same time."])))},e.ILLEGAL_PUSH=function(){return $localize(Uc||(Uc=wg(["Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board."])))},e.MUST_INSERT_OR_CHOOSE_YOUR_PIECE=function(){return $localize(Bc||(Bc=wg(["You should insert or choose one of your pieces!"])))},e}(),Rge=jg(function e(t,n){Wg(this,e),this.resultingBoard=t,this.moved=n}),Mge=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"isLegal",value:function(e,t){if(oV(n.VERBOSE,{SiamRules_isLegal:{move:e,state:t}}),!e.isInsertion()&&!t.getPieceAt(e.coord).belongTo(t.getCurrentPlayer()))return S7.failure(Zae.MUST_CHOOSE_PLAYER_PIECE());if(e.isRotation())return oV(n.VERBOSE,"Move is rotation"),this.isLegalRotation(e,t);var r;if(e.isInsertion()){oV(n.VERBOSE,"Move is insertion");var i=this.isLegalInsertion(e.coord,t);if(i.legal.isFailure())return S7.failure(i.legal.getReason());r=i.insertedPiece}else oV(n.VERBOSE,"Move is forward"),r=t.getPieceAt(e.coord);return n.isLegalForwarding(e,t,r)}},{key:"isLegalInsertion",value:function(e,t){var r=t.countPlayerPawn(),i=t.getCurrentPlayer(),a=r<5?T7.SUCCESS:T7.failure(xge.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:n.getInsertedPiece(e,i),legal:a}}},{key:"isLegalRotation",value:function(e,t){oV(n.VERBOSE,{isLegalRotation:{rotation:e,state:t}});var r=e.coord,i=t.getPieceAt(r),a=t.getCurrentPlayer();if(i.getDirection()===e.landingOrientation)return S7.failure(xge.ILLEGAL_ROTATION());var o=t.getCopiedBoard();return o[r.y][r.x]=Ige.of(e.landingOrientation,a),S7.success(new Rge(o,[r]))}},{key:"applyLegalMove",value:function(e,t,n){var r=Ure.copyBiArray(n.resultingBoard);return new Age(r,t.turn+1)}},{key:"getGameStatus",value:function(e){var t=n.getMountainsRowsAndColumns(e.gameState),r=n.getWinner(e.gameState,e.move,t.nbMountain);return r.isPlayer()?loe.getVictory(r):loe.ONGOING}}],[{key:"getInsertedPiece",value:function(e,t){return Ige.of(-1===e.x?Fae.RIGHT:-1===e.y?Fae.DOWN:5===e.x?Fae.LEFT:Fae.UP,t)}},{key:"isLegalForwarding",value:function(e,t,r){oV(n.VERBOSE,{isLegalForwarding:{move:e.toString(),state:t,firstPiece:r}});var i=[],a=Ige.of(e.landingOrientation,t.getCurrentPlayer()),o=e.moveDirection.get(),s=e.coord.getNext(o);if(s.isInRange(5,5)&&t.getPieceAt(s)!==Ige.EMPTY&&!1===n.isStraight(r,e))return oV(n.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),S7.failure(xge.ILLEGAL_PUSH());var u=lV.of(o),c=o.getOpposite(),l=0,h=t.getCopiedBoard();e.coord.isInRange(5,5)&&(h[e.coord.y][e.coord.x]=Ige.EMPTY,i.push(e.coord));for(var f=s.isInRange(5,5)&&a!==Ige.EMPTY;f;){u.equalsValue(o)?l++:u.equalsValue(c)&&l--,oV(n.VERBOSE,{totalForce:l,movingPiece:a,landingCoord:s});var d=h[s.y][s.x];d===Ige.MOUNTAIN&&(l-=.9),h[s.y][s.x]=a,i.push(s),a=d,s=s.getNext(o),u=a.getOptionalDirection(),f=s.isInRange(5,5)&&a!==Ige.EMPTY&&l>0}return s.isNotInRange(5,5)&&(oV(n.VERBOSE,"This movement would push "+a+" outside the board"),u.equalsValue(o)?l++:u.equalsValue(c)&&l--),l<=0?(oV(n.VERBOSE,"This move is an illegal push: "+h),S7.failure(xge.NOT_ENOUGH_FORCE_TO_PUSH())):(oV(n.VERBOSE,"This move is a legal push: "+h),S7.success(new Rge(h,i)))}},{key:"isStraight",value:function(e,t){var n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}},{key:"getBoardValueInfo",value:function(e,t){var r=n.getMountainsRowsAndColumns(t),i=r.rows,a=r.columns,o=n.getWinner(t,e,r.nbMountain);if(o.isPlayer())return o===Nre.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER};var s,u=n.getPushers(t,a,i),c=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,h=t.getCurrentPlayer(),f=Hg(u);try{for(f.s();!(s=f.n()).done;){var d=s.value;d.coord.isInRange(5,5)?t.getPieceAt(d.coord).belongTo(Nre.ZERO)?c=Math.min(c,d.distance):l=Math.min(l,d.distance):h===Nre.ZERO?c=Math.min(c,d.distance):l=Math.min(l,d.distance)}}catch(v){f.e(v)}finally{f.f()}return{shortestZero:c,shortestOne:l,boardValue:n.getScoreFromShortestDistances(c,l,h)}}},{key:"getScoreFromShortestDistances",value:function(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);var r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}},{key:"getMountainsRowsAndColumns",value:function(e){for(var t=[],n=[],r=0,i=0;i<5;i++)for(var a=0;a<5;a++)e.getPieceAtXY(a,i)===Ige.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(a)||n.push(a),r++);return{rows:t,columns:n,nbMountain:r}}},{key:"getWinner",value:function(e,t,r){return 2===r?n.getPusher(e,t.get()):Mre.NONE}},{key:"getPusher",value:function(e,t){var r=t.coord,i=(r.isInRange(5,5)?e.getPieceAt(r.getNext(t.landingOrientation)):n.getInsertedPiece(r,e.getCurrentOpponent())).getDirection(),a=n.getPusherCoord(e,i,r),o=e.getPieceAt(a).getOwner();return oV(n.VERBOSE,r.toString()+" belong to "+e.getCurrentOpponent().value+", "+a.toString()+" belong to "+o.value+", "+o.value+" win"),o}},{key:"getPusherCoord",value:function(e,t,n){for(var r=n.getNext(t),i=n;r.isInRange(5,5);){n=r,r=r.getNext(t);var a=e.getPieceAt(n);a!==Ige.MOUNTAIN&&a.getDirection()===t&&(i=n)}return i}},{key:"getPushers",value:function(e,t,r){oV(n.VERBOSE,{getPushers:{state:e,mountainsColumn:t,mountainsRow:r}});var i,a=[],o=[],s=Hg(t);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=Fae.DOWN,l=new Bae(u,4);o.push({direction:c,fallingCoord:l}),c=Fae.UP,l=new Bae(u,0),o.push({direction:c,fallingCoord:l})}}catch(k){s.e(k)}finally{s.f()}var h,f=Hg(r);try{for(f.s();!(h=f.n()).done;){var d=h.value,v=Fae.LEFT,p=new Bae(0,d);o.push({direction:v,fallingCoord:p}),v=Fae.RIGHT,p=new Bae(4,d),o.push({direction:v,fallingCoord:p})}}catch(k){f.e(k)}finally{f.f()}for(var g=0,y=o;g<y.length;g++){var m=y[g];a=n.addPotentialDirectionPusher(e,m.fallingCoord,m.direction,a)}return a}},{key:"addPotentialDirectionPusher",value:function(e,t,r,i){var a=n.getLineClosestPusher(e,t,r);if(a.isAbsent())return i;var o=a.get(),s=o.distance;return oV(n.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:s}),i}},{key:"getLineClosestPusher",value:function(e,t,r){oV(n.VERBOSE,{getDirectionClosestPusher:{state:e,fallingCoord:t,direction:r.toString()}});for(var i=r.getOpposite(),a=1,o=e.getPieceAt(t),s=t,u=lV.empty(),c=!1,l=!1,h=0;s.isInRange(5,5)&&!1===c;){var f=e.getPieceAt(s);if(f.isEmptyOrMountain())f===Ige.MOUNTAIN?(h+=.9,l=!0):a++;else{var d=f.getDirection();d===r?l&&((h-=1)<=0&&(c=!0,s=s.getNext(r))):d===i?(h+=1,l||a++):l?(u=lV.of(s),o!==Ige.EMPTY&&a++):a++}o=f,s=s.getPrevious(r)}if(!1===c&&u.isPresent())for(a++,h-=1;!1===s.equals(u.get());)s=s.getNext(r),a--;return s.isNotInRange(5,5)&&(h-=1,5===e.countPlayerPawn())||h>0?lV.empty():lV.of({distance:a,coord:s})}},{key:"getPushingInsertions",value:function(e){for(var t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[],a=0;a<5;a++)r.push(new Tge(-1,a,lV.of(Fae.RIGHT),Fae.RIGHT)),i.push(Ige.of(Fae.RIGHT,n)),r.push(new Tge(5,a,lV.of(Fae.LEFT),Fae.LEFT)),i.push(Ige.of(Fae.LEFT,n)),r.push(new Tge(a,-1,lV.of(Fae.DOWN),Fae.DOWN)),i.push(Ige.of(Fae.DOWN,n)),r.push(new Tge(a,5,lV.of(Fae.UP),Fae.UP)),i.push(Ige.of(Fae.UP,n));for(var o=0;o<r.length;o++)this.isLegalForwarding(r[o],e.gameState,i[o]).isSuccess()&&t.push(r[o]);return t}},{key:"getDerapingInsertions",value:function(e){for(var t,n,r=[],i=e.gameState.getCurrentPlayer(),a=1;a<=3;a++)t=new Tge(-1,a,lV.of(Fae.RIGHT),Fae.UP),n=Ige.of(Fae.UP,i),this.isLegalForwarding(t,e.gameState,n).isSuccess()&&(r.push(t),t=new Tge(-1,a,lV.of(Fae.RIGHT),Fae.DOWN),n=Ige.of(Fae.DOWN,i),this.isLegalForwarding(t,e.gameState,n),r.push(t)),t=new Tge(5,a,lV.of(Fae.LEFT),Fae.UP),n=Ige.of(Fae.UP,i),this.isLegalForwarding(t,e.gameState,n).isSuccess()&&(r.push(t),t=new Tge(5,a,lV.of(Fae.LEFT),Fae.DOWN),n=Ige.of(Fae.DOWN,i),this.isLegalForwarding(t,e.gameState,n),r.push(t));for(var o=1;o<=3;o++)t=new Tge(o,-1,lV.of(Fae.DOWN),Fae.LEFT),n=Ige.of(Fae.LEFT,i),this.isLegalForwarding(t,e.gameState,n).isSuccess()&&(r.push(t),t=new Tge(o,-1,lV.of(Fae.DOWN),Fae.RIGHT),n=Ige.of(Fae.RIGHT,i),this.isLegalForwarding(t,e.gameState,n),r.push(t)),t=new Tge(o,5,lV.of(Fae.UP),Fae.LEFT),n=Ige.of(Fae.LEFT,i),this.isLegalForwarding(t,e.gameState,n).isSuccess()&&(r.push(t),t=new Tge(o,5,lV.of(Fae.UP),Fae.RIGHT),n=Ige.of(Fae.RIGHT,i),this.isLegalForwarding(t,e.gameState,n),r.push(t));return r}},{key:"getCoordDirection",value:function(e,t,n){var r=new Bae(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}}]),n}(hoe);return e.VERBOSE=!1,e}(),Nge=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){return new Kae(Mge.getBoardValueInfo(e.move,e.gameState).boardValue)}},{key:"getListMoves",value:function(e){for(var t,n=[],r=e.gameState.getCurrentPlayer(),i=0;i<5;i++)for(var a=0;a<5;a++)if((t=e.gameState.getPieceAtXY(a,i)).belongTo(r)){var o,s=t.getDirection(),u=Hg(Fae.ORTHOGONALS);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c!==s){var l=e.gameState.getCopiedBoard(),h=new Tge(a,i,lV.empty(),c);l[i][a]=Ige.of(c,r),n.push(h)}var f,d=Hg(new Bae(a+c.x,i+c.y).isInRange(5,5)?Fae.ORTHOGONALS:[c]);try{for(d.s();!(f=d.n()).done;){var v=f.value,p=new Tge(a,i,lV.of(c),v);Mge.isLegalForwarding(p,e.gameState,t).isSuccess()&&n.push(p)}}catch(g){d.e(g)}finally{d.f()}}}catch(g){u.e(g)}finally{u.f()}}return e.gameState.countPlayerPawn()<5&&(n=(n=n.concat(Mge.getPushingInsertions(e))).concat(Mge.getDerapingInsertions(e))),oV(Mge.VERBOSE,{getListMovesResult:n}),n}}]),n}(Yae),Dge=Ige.EMPTY,Lge=Ige.MOUNTAIN,Fge=Ige.WHITE_UP,Uge=Ige.WHITE_LEFT,Bge=Ige.WHITE_RIGHT,Vge=Ige.WHITE_DOWN,zge=Ige.BLACK_UP,Hge=Ige.BLACK_LEFT,Gge=Ige.BLACK_RIGHT,$ge=Ige.BLACK_DOWN,Wge=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(Vc||(Vc=wg(["Goal of the game"]))),$localize(zc||(zc=wg(["The goal at Siam is to be the first to push a mountain out of the board.\n        The initial board contains three mountains, and no pieces are initially on the board.\n        During its turn, a player can do one of the following three actions:\n        <ol>\n            <li>Put a new piece on the board.</li>\n            <li>Change the orientation of one of its piece, and optionally move it.</li>\n            <li>Take one of its pieces out of the board.</li>\n        </ol>"]))),Age.getInitialState()),poe.anyMove($localize(Hc||(Hc=wg(["Inserting a piece"]))),$localize(Gc||(Gc=wg(["Each player has 5 pieces in total.\n        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:\n        <ol>\n            <li>Click on one of the big arrows alongside the board.</li>\n            <li>Click on one of the small arrows that appeared on the landing square of your piece.\n                This is the direction in which your piece will be oriented.</li>\n        </ol><br/>\n        Insert a piece on the board."]))),Age.getInitialState(),new Tge(2,-1,lV.of(Fae.DOWN),Fae.DOWN),$localize($c||($c=wg(["Congratulations!"])))),poe.fromMove($localize(Wc||(Wc=wg(["Moving a piece"]))),$localize(qc||(qc=wg(['We will distinguish here "moving" and "pushing".\n        A move is made from a piece\'s square to an empty neighboring square, horizontally or vertically.\n        During that move, you can also move the piece out of the board.\n        To move a piece:\n        <ol>\n            <li>Click on it.</li>\n            <li>Click on one of the 4 arrows to pick the direction in which it will move.\n                You can also click on the middle dot to change the piece\'s orientation without moving it.</li>\n            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>\n        </ol><br/>\n        Try to move the piece that is on the board one square upwards and to orient it downwards.']))),new Age([[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Dge,Dge,Dge],[Dge,Lge,Lge,Lge,Dge],[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Fge,Dge,Dge]],0),[new Tge(2,4,lV.of(Fae.UP),Fae.DOWN)],$localize(jc||(jc=wg(["Congratulations, you made a side-slip!"]))),$localize(Zc||(Zc=wg(["Failed!"])))),poe.fromMove($localize(Yc||(Yc=wg(["Moving a piece out of the board"]))),$localize(Kc||(Kc=wg(["To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>\n        Get that piece out of the board!"]))),new Age([[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Dge,Dge,Dge],[Dge,Lge,Lge,Lge,Dge],[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Fge,Dge,Dge]],0),[new Tge(2,4,lV.of(Fae.DOWN),Fae.DOWN)],$localize(Qc||(Qc=wg(["Congratulations, even if in this context it was not a useful move."]))),$localize(Xc||(Xc=wg(["Failed, the piece is still on the board."])))),poe.fromMove($localize(Jc||(Jc=wg(["Pushing"]))),$localize(el||(el=wg(['When the landing square of your move is occupied, we use the term "push".\n        In order to push, multiple conditions must hold:\n        <ol>\n            <li>Your piece must already be oriented in the direction of the push.</li>\n            <li>The number of the pieces (opponent\'s or not) that are facing yours (called the resistants)\n                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>\n            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>\n        </ol>\n        Your piece on the top right cannot push because there is one mountain too much.\n        Your piece on the bottom right can push.<br/><br/>\n        Do it.']))),new Age([[Bge,Lge,Lge,Hge,Uge],[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Dge,Lge,Dge],[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Gge,Hge,Uge]],0),[new Tge(4,4,lV.of(Fae.LEFT),Fae.LEFT)],$localize(tl||(tl=wg(["Congratulations!"]))),$localize(nl||(nl=wg(["Failed!"])))),poe.fromMove($localize(rl||(rl=wg(["Victory"]))),$localize(il||(il=wg(["The game ends when a mountain is pushed out of the board.\n        If you pushed it and nobody is in front of you, you're the winner.\n        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.\n        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>\n        You have two ways of ending the game here: you can either win, or lose. Choose correctly!"]))),new Age([[Dge,Dge,Dge,Dge,Dge],[Dge,Dge,Dge,Dge,Dge],[Lge,zge,Uge,Dge,Vge],[Dge,Dge,Dge,Dge,$ge],[Dge,Dge,Dge,Dge,Lge]],0),[new Tge(2,2,lV.of(Fae.LEFT),Fae.LEFT)],$localize(al||(al=wg(["Congratulations, you won!"]))),$localize(ol||(ol=wg(["Failed, you lost."]))))]});function qge(e,t){if(1&e){var n=aS();c_(),eS(0,"use",7),uS("click",function(){var e=Nk(n).$implicit;return hS(3).insertAt(e.x,e.y)}),tS()}if(2&e){var r=t.$implicit,i=hS(3);vS("id","insertAt_",r.x,"_",r.y,""),$E("transform",i.getInsertionArrowTransform(r.x+1,r.y+1,r.dir))}}var jge=function(e,t){return{dir:"DOWN",x:e,y:t}},Zge=function(e){return{dir:"UP",x:e,y:5}},Yge=function(e,t){return{dir:"RIGHT",x:e,y:t}},Kge=function(e){return{dir:"LEFT",x:5,y:e}},Qge=function(e,t,n,r){return[e,t,n,r]};function Xge(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,qge,1,3,"use",6),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",function(e,t,n,r,i,a,o){return function(e,t,n,r,i,a,o,s,u){var c=t+n;return function(e,t,n,r,i,a){var o=GE(e,t,n,r);return GE(e,t+2,i,a)||o}(e,c,i,a,o,s)?zE(e,c+4,u?r.call(u,i,a,o,s):r(i,a,o,s)):uT(e,c+4)}(Rk(),Gk(),e,t,n,r,i,a,o)}(11,Qge,sT(1,jge,n,-1),oT(4,Zge,n),sT(6,Yge,-1,n),oT(9,Kge,n)))}}var Jge=function(){return[0,1,2,3,4]};function eye(e,t){1&e&&(c_(),rS(0),YE(1,Xge,2,16,"g",5),iS()),2&e&&(pb(1),XE("ngForOf",aT(1,Jge)))}function tye(e,t){if(1&e){var n=aS();c_(),eS(0,"use",13),uS("click",function(){var e=Nk(n).$implicit;return hS(5).chooseDirection(e)}),tS()}if(2&e){var r=t.$implicit,i=hS(3).index,a=hS().index,o=hS();dS("id","chooseDirection_",r,""),$E("transform",o.getArrowTransform(i+1,a+1,r))}}var nye=function(){return["RIGHT","DOWN","LEFT","UP"]};function rye(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"circle",11),uS("click",function(){return Nk(n),hS(4).chooseDirection("")}),tS(),YE(2,tye,1,2,"use",12),tS()}if(2&e){var r=hS(2).index,i=hS().index,a=hS();pb(1),$E("cx",(r+1)*a.SPACE_SIZE+a.SPACE_SIZE/2)("cy",(i+1)*a.SPACE_SIZE+a.SPACE_SIZE/2),pb(1),XE("ngForOf",aT(3,nye))}}function iye(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"use",10),uS("click",function(){Nk(n);var e=hS().index,t=hS().index;return hS().clickPiece(e,t)}),tS(),YE(2,rye,3,4,"g",4),tS()}if(2&e){var r=hS(),i=r.index,a=r.$implicit,o=hS().index,s=hS();pb(1),vS("id","clickPiece_",i,"_",o,""),XE("ngClass",s.getPieceClasses(a)),$E("transform",s.getPieceTransform(i,o)),pb(1),XE("ngIf",s.choosingDirection(i,o))}}function aye(e,t){if(1&e&&(c_(),nS(0,"use",14)),2&e){var n=hS().index,r=hS().index,i=hS();$E("transform","translate("+(n+1)*i.SPACE_SIZE+" "+(r+1)*i.SPACE_SIZE+")")}}function oye(e,t){if(1&e){var n=aS();c_(),eS(0,"use",13),uS("click",function(){var e=Nk(n).$implicit;return hS(4).chooseOrientation(e)}),tS()}if(2&e){var r=t.$implicit,i=hS(2).index,a=hS().index,o=hS();dS("id","chooseOrientation_",r,""),$E("transform",o.getArrowTransform(i+1,a+1,r))}}function sye(e,t){1&e&&(c_(),eS(0,"g"),YE(1,oye,1,2,"use",12),tS()),2&e&&(pb(1),XE("ngForOf",aT(1,nye)))}function uye(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",8),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().insertAt(e,t)}),tS(),YE(2,iye,3,5,"g",4),YE(3,aye,1,1,"use",9),YE(4,sye,2,2,"g",4),tS()}if(2&e){var r=t.$implicit,i=t.index,a=hS().index,o=hS();pb(1),vS("id","insertAt_",i,"_",a,""),XE("ngClass",o.getSquareClasses(i,a)),$E("x",o.SPACE_SIZE*(i+1))("y",o.SPACE_SIZE*(a+1))("width",o.SPACE_SIZE)("height",o.SPACE_SIZE),pb(1),XE("ngIf",r.isPiece()),pb(1),XE("ngIf",o.isMountain(r)),pb(1),XE("ngIf",o.choosingOrientation(i,a))}}function cye(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,uye,5,10,"g",5),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var lye=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).lastMove=lV.empty(),r.chosenCoord=lV.empty(),r.landingCoord=lV.empty(),r.chosenDirection=lV.empty(),r.chosenOrientation=lV.empty(),r.movedPieces=[],r.rules=new Mge(Age),r.availableMinimaxes=[new Nge(r.rules,"SiamMinimax")],r.encoder=Tge.encoder,r.tutorial=(new Wge).tutorial,r.updateBoard(),r}return jg(n,[{key:"updateBoard",value:function(){if(oV(n.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){var e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}},{key:"cancelMoveAttempt",value:function(){this.chosenCoord=lV.empty(),this.chosenDirection=lV.empty(),this.landingCoord=lV.empty(),this.chosenOrientation=lV.empty()}},{key:"clickPiece",value:function(e,t){var n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());var r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(Zae.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=lV.of(new Bae(e,t)),T7.SUCCESS)}},{key:"chooseDirection",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(n.VERBOSE,"SiamComponent.chooseDirection("+e+")"),!(i=t.canUserPlay("#chooseDirection_"+e)).isFailure()){r.next=4;break}return r.abrupt("return",t.cancelMove(i.getReason()));case 4:if(""!==e){r.next=8;break}t.chosenDirection=lV.empty(),t.landingCoord=t.chosenCoord,r.next=15;break;case 8:if(a=Fae.factory.fromString(e).get(),t.chosenDirection=lV.of(a),t.landingCoord=lV.of(t.chosenCoord.get().getNext(a)),!t.landingCoord.get().isNotInRange(5,5)){r.next=15;break}return oV(n.VERBOSE,"orientation and direction should be the same: "+a),t.chosenOrientation=lV.of(a),r.next=14,t.tryMove();case 14:return r.abrupt("return",r.sent);case 15:return r.abrupt("return",T7.SUCCESS);case 16:case"end":return r.stop()}},r)}))()}},{key:"chooseOrientation",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(n.VERBOSE,"SiamComponent.chooseOrientation("+e+")"),!(i=t.canUserPlay("#chooseOrientation_"+e)).isFailure()){r.next=6;break}r.t0=t.cancelMove(i.getReason()),r.next=10;break;case 6:return t.chosenOrientation=lV.of(Fae.factory.fromString(e).get()),r.next=9,t.tryMove();case 9:r.t0=r.sent;case 10:return r.abrupt("return",r.t0);case 11:case"end":return r.stop()}},r)}))()}},{key:"insertAt",value:function(e,t){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(oV(n.VERBOSE,"SiamComponent.insertAt("+e+", "+t+")"),!(a=r.canUserPlay("#insertAt_"+e+"_"+t)).isFailure()){i.next=4;break}return i.abrupt("return",r.cancelMove(a.getReason()));case 4:if(!r.chosenCoord.isPresent()){i.next=6;break}return i.abrupt("return",r.cancelMove(xge.CANNOT_INSERT_WHEN_SELECTED()));case 6:if(o=new Bae(e,t),!r.getState().isOnBoard(o)||!r.getState().getPieceAtXY(e,t).isEmptyOrMountain()){i.next=9;break}return i.abrupt("return",r.cancelMove(xge.MUST_INSERT_OR_CHOOSE_YOUR_PIECE()));case 9:return r.chosenCoord=lV.of(o),s=Mge.getCoordDirection(e,t,r.rules.node.gameState),i.abrupt("return",(r.chosenDirection=lV.of(s),r.landingCoord=lV.of(r.chosenCoord.get().getNext(s)),T7.SUCCESS));case 12:case"end":return i.stop()}},i)}))()}},{key:"tryMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.chosenCoord.get(),r=new Tge(n.x,n.y,e.chosenDirection,e.chosenOrientation.get()),e.cancelMove(),t.next=4,e.chooseMove(r,e.rules.node.gameState);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}))()}},{key:"isMountain",value:function(e){return e===Ige.MOUNTAIN}},{key:"choosingOrientation",value:function(e,t){var r=new Bae(e,t);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(oV(n.VERBOSE,"choosing orientation now"),!0)}},{key:"choosingDirection",value:function(e,t){var r=new Bae(e,t);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(oV(n.VERBOSE,"choosing direction now"),!0)}},{key:"getInsertionArrowTransform",value:function(e,t,n){var r="rotate(".concat(90*(Fae.factory.fromString(n).get().toInt()-2)," ").concat(this.SPACE_SIZE/2," ").concat(this.SPACE_SIZE/2,")");return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}},{key:"getPieceTransform",value:function(e,t){var n="rotate(".concat(90*(this.board[t][e].getDirection().toInt()-2)," ").concat(this.SPACE_SIZE/2," ").concat(this.SPACE_SIZE/2,")");return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}},{key:"getArrowTransform",value:function(e,t,n){return Bpe.getArrowTransform(this.SPACE_SIZE,new Bae(e,t),Fae.factory.fromString(n).get())}},{key:"getPieceClasses",value:function(e){return[this.getPlayerClass(e.getOwner())]}},{key:"getSquareClasses",value:function(e,t){var n=new Bae(e,t);return this.movedPieces.some(function(e){return e.equals(n)})?["moved"]:[]}}]),n}(Koe);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-siam"]],features:[xE],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],["class","arrow selected-fill no-stroke",0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),eS(1,"defs"),nS(2,"polygon",1),nS(3,"polygon",2),nS(4,"polygon",3),tS(),YE(5,eye,2,2,"ng-container",4),YE(6,cye,2,1,"g",5),tS()),2&e&&(pb(5),XE("ngIf",t.isPlayerTurn()),pb(1),XE("ngForOf",t.board))},directives:[UA,LA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),hye=function(){var e=jg(function e(){Wg(this,e)});return e.NO_MOVEMENT_BEFORE_TURN_40=function(){return $localize(sl||(sl=wg(["You cannot move yet. Pick a space where you will put a new piece."])))},e.MUST_CUT=function(){return $localize(ul||(ul=wg(["Several groups are of the same size, you must pick the one to keep."])))},e.CANNOT_CHOOSE_TO_KEEP=function(){return $localize(cl||(cl=wg(["You cannot choose which part to keep when one is smaller than the other."])))},e.CAN_NO_LONGER_DROP=function(){return $localize(ll||(ll=wg(["You cannot put new pieces anymore. Pick a piece to move."])))},e.MUST_CAPTURE_BIGGEST_GROUPS=function(){return $localize(hl||(hl=wg(["You must choose one of the biggest groups to keep it."])))},e.CANNOT_KEEP_EMPTY_COORD=function(){return $localize(fl||(fl=wg(["You cannot pick an empty space. Pick one of the biggest groups."])))},e.MUST_DROP_NEXT_TO_OTHER_PIECE=function(){return $localize(dl||(dl=wg(["You must put this piece next to another piece."])))},e}(),fye=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;Wg(this,n),(a=t.call(this,r)).pieces=e;var o=a.getCalculatedScale();return a.pieces=o.pieces,a.width=o.width,a.height=o.height,a.offset=null!=i?i:o.offset,a.pieces.makeImmutable(),a}return jg(n,[{key:"getCalculatedScale",value:function(){var e,t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Hg(this.pieces.listKeys());try{for(a.s();!(e=a.n()).done;){var o=e.value;t=Math.min(o.x,t),n=Math.max(o.x,n),r=Math.min(o.y,r),i=Math.max(o.y,i)}}catch(v){a.e(v)}finally{a.f()}var s=new soe,u=new Mae(-t,-r);if(0!==t||0!==r){var c,l=Hg(this.pieces.listKeys());try{for(l.s();!(c=l.n()).done;){var h=c.value,f=this.pieces.delete(h),d=h.getNext(u);s.set(d,f)}}catch(v){l.e(v)}finally{l.f()}}else s=this.pieces;return{width:n+1-t,height:i+1-r,pieces:s,offset:u}}},{key:"toRepresentation",value:function(){var e,t=Ure.createTable(this.width,this.height,Mre.NONE.value),n=Hg(this.pieces.listKeys());try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.getPieceAt(r).value;t[r.y][r.x]=i}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"isIllegalLandingZone",value:function(e,t){return this.pieces.containsKey(e)?T7.failure(Zae.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?T7.SUCCESS:T7.failure(hye.MUST_DROP_NEXT_TO_OTHER_PIECE())}},{key:"isCoordConnected",value:function(e,t){var n,r=Hg(Gae.factory.all);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e.getNext(i,1);if(this.pieces.containsKey(a)&&!1===t.equalsValue(a))return!0}}catch(o){r.e(o)}finally{r.f()}return!1}},{key:"isOnBoard",value:function(e){return this.pieces.containsKey(e)}},{key:"getPieceAt",value:function(e){return this.isOnBoard(e)?this.pieces.get(e).get():Mre.NONE}},{key:"applyLegalDrop",value:function(e){var t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new n(t,this.turn+1)}},{key:"applyLegalDeplacement",value:function(e,t){var r=n.deplacePiece(this,e),i=new soe;if(t.size()>0){i=new soe;var a,o=Hg(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.set(s,r.get(s).get())}}catch(u){o.e(u)}finally{o.f()}}else i=r.getCopy();return new n(i,this.turn+1)}},{key:"countPieces",value:function(){var e=this.pieces.reverse(),t=e.get(Nre.ZERO).getOrElse(new Cse),n=e.get(Nre.ONE).getOrElse(new Cse);return[t.size(),n.size()]}},{key:"switchPiece",value:function(e){var t=this.pieces.getCopy(),r=this.getPieceAt(e);if(r.isPlayer())return t.replace(e,r.getOpponent()),new n(t,this.turn,this.offset);R7.logErrorAndFail("SixState","Cannot switch piece if there is no piece!",{coord:e.toString()})}},{key:"equals",value:function(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}],[{key:"getInitialState",value:function(){return n.fromRepresentation([[Nre.ZERO.value],[Nre.ONE.value]],0)}},{key:"fromRepresentation",value:function(e,t,r){for(var i=new soe,a=0;a<e.length;a++)for(var o=0;o<e[0].length;o++)e[a][o]!==Mre.NONE.value&&i.set(new Bae(o,a),Nre.of(e[a][o]));return new n(i,t,r)}},{key:"deplacePiece",value:function(e,t){var n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}},{key:"getGroups",value:function(e,t){var r,i=new soe,a=0,o=Hg(Gae.factory.all);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=t.getNext(s,1);i=n.putCoordInGroup(e,u,i,""+a),a++}}catch(f){o.e(f)}finally{o.f()}for(var c=i.reverse(),l=new Xae,h=0;h<c.size();h++)l.add(c.getByIndex(h).value);return l}},{key:"putCoordInGroup",value:function(e,t,r,i){if(e.get(t).isPresent()&&r.get(t).isAbsent()){r.set(t,i);var a,o=Hg(Gae.factory.all);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=t.getNext(s,1);r=n.putCoordInGroup(e,u,r,i)}}catch(c){o.e(c)}finally{o.f()}}return r}}]),n}(Jae),dye=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;if(Wg(this,n),(a=t.call(this)).start=e,a.landing=r,a.keep=i,e.equalsValue(r))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(i))throw new Error("Cannot keep starting coord, since it will always be empty after move!");return Lg(a)}return jg(n,[{key:"isDrop",value:function(){return this.start.isAbsent()}},{key:"isCut",value:function(){return this.keep.isPresent()}},{key:"toString",value:function(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}},{key:"equals",value:function(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}],[{key:"fromDrop",value:function(e){return new n(lV.empty(),e,lV.empty())}},{key:"fromMovement",value:function(e,t){return new n(lV.of(e),t,lV.empty())}},{key:"fromCut",value:function(e,t,r){return new n(lV.of(e),t,lV.of(r))}}]),n}(noe);dye.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encodeMove",value:function(e){return{start:e.start.isPresent()?Bae.encoder.encode(e.start.get()):null,landing:Bae.encoder.encode(e.landing),keep:e.keep.isPresent()?Bae.encoder.encode(e.keep.get()):null}}},{key:"decodeMove",value:function(e){var t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");var n=Bae.encoder.decode(t.landing);if(null==t.start)return dye.fromDrop(n);var r=Bae.encoder.decode(t.start);if(null==t.keep)return dye.fromMovement(r,n);var i=Bae.encoder.decode(t.keep);return dye.fromCut(r,n,i)}}]),n}(Are));var vye=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).VERBOSE=!1,e}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}},{key:"isLegal",value:function(e,t){oV(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});var r=t.isIllegalLandingZone(e.landing,e.start);return r.isFailure()?r.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):n.isLegalPhaseTwoMove(e,t)}},{key:"isLegalDrop",value:function(e,t){return!1===e.isDrop()?S7.failure(hye.NO_MOVEMENT_BEFORE_TURN_40()):S7.success(t.pieces.getKeySet())}},{key:"getGameStatus",value:function(e){var t=e.gameState,n=t.getCurrentOpponent(),r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return loe.getVictory(n);if(t.turn>39){var i=t.countPieces(),a=i[0],o=i[1];return a<6&&o<6?a<o?loe.ONE_WON:o<a?loe.ZERO_WON:loe.DRAW:a<6?loe.getDefeat(Nre.ZERO):o<6?loe.getDefeat(Nre.ONE):loe.ONGOING}return loe.ONGOING}},{key:"startSearchingVictorySources",value:function(){oV(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}},{key:"getShapeVictory",value:function(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();var n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}},{key:"hasNextVictorySource",value:function(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}},{key:"getNextVictorySource",value:function(){if(5===this.currentVictorySource.index){var e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{var t=1;"LINE"===this.currentVictorySource.typeSource&&(t=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+t}}return this.currentVictorySource}},{key:"searchVictoryOnly",value:function(e,t,n){var r=t.landing.getNext(n.offset,1);switch(oV(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}},{key:"searchVictoryOnlyForCircle",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=[t],a=t.getNext(Gae.factory.all[e],1);i.length<6;){if(n.getPieceAt(a)!==r)return[];var o=(e+i.length)%6;i.push(a),a=a.getNext(Gae.factory.all[o],1)}return i}},{key:"searchVictoryOnlyForLine",value:function(e,t,n){for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=t.getNext(i,1),o=[t],s=!1;o.length<6;){if(n.getPieceAt(a)===r)o.push(a);else{if(s)return[];s=!0,i=i.getOpposite(),a=a.getNext(i,o.length)}a=a.getNext(i,1)}return o}},{key:"searchVictoryOnlyForTriangleCorner",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=[t],o=t.getNext(i,1);a.length<6;){if(n.getPieceAt(o)!==r)return[];a.length%2==0&&(i=Gae.factory.all[(e+a.length)%6]),a.push(o),o=o.getNext(i,1)}return a}},{key:"searchVictoryOnlyForTriangleEdge",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=[t],o=t.getNext(i,1);a.length<6;){if(n.getPieceAt(o)!==r)return[];a.push(o),a.length%2==0&&(i=Gae.factory.all[(e+a.length)%6]),o=o.getNext(i,1)}return a}}],[{key:"getLegalLandings",value:function(e){var t,n=new Cse,r=Hg(e.pieces.listKeys());try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=Hg(Gae.factory.all);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=a.getNext(s,1);e.getPieceAt(u)===Mre.NONE&&n.add(u)}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}return n.toList()}},{key:"isLegalPhaseTwoMove",value:function(e,t){if(e.isDrop())return S7.failure(hye.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case Mre.NONE:return S7.failure(Zae.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return S7.failure(Zae.CANNOT_CHOOSE_OPPONENT_PIECE())}var r=fye.deplacePiece(t,e),i=fye.getGroups(r,e.start.get());if(n.isSplit(i)){var a=this.getBiggerGroups(i);return 1===a.size()?e.keep.isPresent()?S7.failure(hye.CANNOT_CHOOSE_TO_KEEP()):S7.success(a.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,a,r)}return S7.success(new Cse)}},{key:"isSplit",value:function(e){return e.size()>1}},{key:"getBiggerGroups",value:function(e){var t,n=0,r=new Xae,i=Hg(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.size();o>n?(n=o,r=new Xae([a])):o===n&&r.add(a)}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"moveKeepBiggerGroup",value:function(e,t,n){if(e.isAbsent())return S7.failure(hye.MUST_CUT());if(n.get(e.get()).isAbsent())return S7.failure(hye.CANNOT_KEEP_EMPTY_COORD());var r,i=e.get(),a=Hg(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.contains(i))return S7.success(o)}}catch(s){a.e(s)}finally{a.f()}return S7.failure(hye.MUST_CAPTURE_BIGGEST_GROUPS())}}]),n}(hoe),pye=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"calculateBoardValue",value:function(e,t){this.startSearchingVictorySources();for(var n={status:aoe.DEFAULT,victory:lV.empty(),preVictory:lV.empty(),sum:0};this.hasNextVictorySource();){var r,i=this.getNextVictorySource();if((r=n.status===aoe.PRE_VICTORY?this.searchVictoryOnly(i,e,t):this.getBoardInfo(i,e,t,n)).status===aoe.VICTORY)return r;n={status:r.status,victory:lV.empty(),preVictory:r.preVictory,sum:n.sum+r.sum}}return n}}]),n}(Yae),gye=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e)).value=e,i.preVictory=r,i}return jg(n)}(Kae),yye=function(e){Mg(n,e);var t=Dg(n);function n(){var e;return Wg(this,n),(e=t.apply(this,arguments)).VERBOSE=!1,e}return jg(n,[{key:"getListMoves",value:function(e){var t=n.get(),r=e.getOwnValue(t);if(r.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(r):this.createForcedDeplacement(e,r);var i=vye.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(i):this.getListDeplacement(e.gameState,i)}},{key:"createForcedDrop",value:function(e){oV(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});var t=[],n=dye.fromDrop(e.preVictory.get());return t.push(n),t}},{key:"createForcedDeplacement",value:function(e,t){oV(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});var n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}},{key:"getDeplacementFrom",value:function(e,t,n){var r,i=[],a=Hg(t);try{for(a.s();!(r=a.n()).done;){var o,s=r.value,u=Hg(n);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=dye.fromMovement(s,c);if(e.isCoordConnected(c,lV.of(s))){var h=fye.deplacePiece(e,l),f=fye.getGroups(h,l.start.get());if(vye.isSplit(f)){var d,v=Hg(f);try{for(v.s();!(d=v.n()).done;){var p=d.value.getAnyElement().get(),g=dye.fromCut(s,c,p);i.push(g)}}catch(y){v.e(y)}finally{v.f()}}else i.push(l)}}}catch(y){u.e(y)}finally{u.f()}}}catch(y){a.e(y)}finally{a.f()}return i}},{key:"getSafelyMovablePieceOrFirstOne",value:function(e){var t,n=e.gameState,r=n.pieces.reverse(),i=n.getCurrentPlayer(),a=r.get(i).get(),o=a.getAnyElement().get(),s=[],u=Hg(a);try{for(u.s();!(t=u.n()).done;){var c=t.value;!1===this.isPieceBlockingAVictory(n,c)&&s.push(c)}}catch(l){u.e(l)}finally{u.f()}return new Cse(0===s.length?[o]:s)}},{key:"isPieceBlockingAVictory",value:function(e,t){var n=e.switchPiece(t),r=dye.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===aoe.VICTORY)return!0;return!1}},{key:"getListDrop",value:function(e){var t,n=[],r=Hg(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=dye.fromDrop(i);n.push(a)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"getListDeplacement",value:function(e,t){var n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}},{key:"getBoardValue",value:function(e){var t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue(),a={status:aoe.DEFAULT,victory:lV.empty(),preVictory:lV.empty(),sum:0};t.isPresent()&&(a=this.calculateBoardValue(t.get(),n));var o=lV.empty();if(a.status===aoe.DEFAULT&&a.preVictory.isPresent()&&(o=lV.of(a.preVictory.get())),a.status===aoe.VICTORY)return new gye(i,lV.empty());if(n.turn>39){var s=n.countPieces(),u=s[0],c=s[1];return u<6&&c<6?new gye(u<c?Nre.ONE.getVictoryValue():c<u?Nre.ZERO.getVictoryValue():0,lV.empty()):u<6?new gye(Nre.ZERO.getDefeatValue(),lV.empty()):c<6?new gye(Nre.ONE.getDefeatValue(),lV.empty()):new gye(u-c,o)}return new gye(a.status===aoe.PRE_VICTORY?r.getPreVictory():a.sum*r.getScoreModifier(),o)}},{key:"startSearchingVictorySources",value:function(){oV(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}},{key:"hasNextVictorySource",value:function(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}},{key:"getNextVictorySource",value:function(){if(5===this.currentVictorySource.index){var e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{var t=1;"LINE"===this.currentVictorySource.typeSource&&(t=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+t}}return this.currentVictorySource}},{key:"searchVictoryOnly",value:function(e,t,n){var r=t.landing.getNext(n.offset,1);switch(oV(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}},{key:"searchVictoryOnlyForCircle",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=[t],a=t.getNext(Gae.factory.all[e],1);i.length<6;){if(n.getPieceAt(a)!==r)return{status:aoe.PRE_VICTORY,victory:lV.empty(),preVictory:lV.empty(),sum:0};var o=(e+i.length)%6;i.push(a),a=a.getNext(Gae.factory.all[o],1)}return{status:aoe.VICTORY,victory:lV.of(i),preVictory:lV.empty(),sum:0}}},{key:"searchVictoryOnlyForLine",value:function(e,t,n){for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=t.getNext(i,1),o=[t],s=!1;o.length<6;){if(n.getPieceAt(a)===r)o.push(a);else{if(s)return{status:aoe.PRE_VICTORY,victory:lV.empty(),preVictory:lV.empty(),sum:0};s=!0,i=i.getOpposite(),a=a.getNext(i,o.length-1)}a=a.getNext(i,1)}return{status:aoe.VICTORY,victory:lV.of(o),preVictory:lV.empty(),sum:0}}},{key:"searchVictoryOnlyForTriangleCorner",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=[t],o=t.getNext(i,1);a.length<6;){if(n.getPieceAt(o)!==r)return{status:aoe.PRE_VICTORY,victory:lV.empty(),preVictory:lV.empty(),sum:0};a.length%2==0&&(i=Gae.factory.all[(e+a.length)%6]),a.push(o),o=o.getNext(i,1)}return{status:aoe.VICTORY,victory:lV.of(a),preVictory:lV.empty(),sum:0}}},{key:"searchVictoryOnlyForTriangleEdge",value:function(e,t,n){oV(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});for(var r=n.getCurrentOpponent(),i=Gae.factory.all[e],a=[t],o=t.getNext(i,1);a.length<6;){if(n.getPieceAt(o)!==r)return{status:aoe.PRE_VICTORY,victory:lV.empty(),preVictory:lV.empty(),sum:0};a.push(o),a.length%2==0&&(i=Gae.factory.all[(e+a.length)%6]),o=o.getNext(i,1)}return{status:aoe.VICTORY,victory:lV.of(a),preVictory:lV.empty(),sum:0}}},{key:"getBoardInfo",value:function(e,t,n,r){oV(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});var i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}},{key:"getBoardInfoForCircle",value:function(e,t,n,r){oV(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});for(var i=n.getCurrentPlayer(),a=[t],o=t.getNext(Gae.factory.all[e],1),s=0,u=lV.empty();a.length<6;){var c=n.getPieceAt(o);if(c===i)return r;var l=(e+a.length)%6;a.push(o);var h=Gae.factory.all[l];c===Mre.NONE?(s+=.16,u=lV.of(o)):s++,o=o.getNext(h,1)}return this.getBoardInfoResult(s,u,a,r)}},{key:"getBoardInfoResult",value:function(e,t,n,r){var i=r.preVictory;if(4.16===e){if(oV(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:aoe.PRE_VICTORY,victory:lV.empty(),preVictory:lV.empty(),sum:0};i=t}else if(5===e)return{status:aoe.VICTORY,victory:lV.of(n),preVictory:lV.empty(),sum:0};return{status:r.status,victory:lV.empty(),preVictory:i,sum:r.sum+e}}},{key:"getBoardInfoForLine",value:function(e,t,n,r){oV(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});for(var i=Gae.factory.all[e],a=t.getPrevious(i,5),o=[],s=[],u=lV.empty(),c=0;c<6;c++){var l=this.updateEncounterAndReturnLastEmpty(n,a,s);l.isPresent()&&(u=l),o.push(a),a=a.getNext(i,1)}for(var h=r.status,f=r.preVictory,d=0,v=0;d<6;){var p=s.reduce(function(e,t){return e+t});if(6===p)return{status:aoe.VICTORY,victory:lV.of(o),preVictory:lV.empty(),sum:0};5.16===p&&h===aoe.DEFAULT&&(f.isPresent()?(M7(!1===f.equals(u),"Impossible to have point aligned with differents line to a same point"),h=aoe.PRE_VICTORY):f=u),v=Math.max(v,p),(o=o.slice(1,6)).push(a),s=s.slice(1,6);var g=this.updateEncounterAndReturnLastEmpty(n,a,s);g.isPresent()&&(u=g),d++,a=a.getNext(i,1)}var y={status:h,victory:lV.of(o),preVictory:f,sum:v};return this.getBoardInfoResult(v,u,o,y)}},{key:"updateEncounterAndReturnLastEmpty",value:function(e,t,n){var r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),lV.empty();case Mre.NONE:return n.push(.16),lV.of(t);default:return n.push(1),lV.empty()}}},{key:"getBoardInfoForTriangleCorner",value:function(e,t,n,r){oV(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});for(var i=n.getCurrentPlayer(),a=Gae.factory.all[e],o=[t],s=t.getNext(a,1),u=0,c=lV.empty();o.length<6;){var l=n.getPieceAt(s);if(l===i)return r;l===Mre.NONE?(u+=.16,c=lV.of(s)):u++,o.length%2==0&&(a=Gae.factory.all[(e+o.length)%6]),o.push(s),s=s.getNext(a,1)}return this.getBoardInfoResult(u,c,o,r)}},{key:"getBoardInfoForTriangleEdge",value:function(e,t,n,r){oV(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});for(var i=n.getCurrentPlayer(),a=Gae.factory.all[e],o=[t],s=t.getNext(a,1),u=0,c=lV.empty();o.length<6;){var l=n.getPieceAt(s);if(l===i)return r;l===Mre.NONE?(u+=.16,c=lV.of(s)):u++,o.push(s),o.length%2==0&&(a=Gae.factory.all[(e+o.length)%6]),s=s.getNext(a,1)}return this.getBoardInfoResult(u,c,o,r)}}],[{key:"get",value:function(){if(null==n.INSTANCE){var e=new vye(fye);n.INSTANCE=new n(e,"SixMinimax")}return n.INSTANCE}}]),n}(pye),mye=Mre.NONE.value,kye=Nre.ZERO.value,_ye=Nre.ONE.value,Cye=function(){var e=jg(function e(){Wg(this,e)});return e.MOVEMENT_NOT_DISCONNECTING=function(){return $localize(vl||(vl=wg(["This move does not disconnect your opponent's pieces. Try again with another piece."])))},e.MOVEMENT_SELF_DISCONNECTING=function(){return $localize(pl||(pl=wg(["You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!"])))},e}(),wye=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(gl||(gl=wg(["Six"]))),$localize(yl||(yl=wg(["Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.\n        Each player has 21 pieces, with one for each player already on the board.\n        The goal of the game is to form one of the three winning shapes with your pieces."]))),fye.getInitialState()),poe.fromMove($localize(ml||(ml=wg(["Victory (line)"]))),$localize(kl||(kl=wg(["On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>\n        Find the victory. You're playing Dark."]))),fye.fromRepresentation([[kye,_ye,_ye,_ye,_ye,kye],[mye,kye,_ye,mye,kye,mye],[_ye,_ye,kye,mye,mye,mye],[mye,mye,kye,mye,mye,mye],[mye,kye,mye,mye,mye,mye],[kye,mye,mye,mye,mye,mye]],0),[dye.fromDrop(new Bae(3,2))],$localize(_l||(_l=wg(["Congratulations!"]))),$localize(Cl||(Cl=wg(["Failed!"])))),poe.fromMove($localize(wl||(wl=wg(["Victory (circle)"]))),$localize(bl||(bl=wg(["On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>\n        Find the victory. You're playing Dark."]))),fye.fromRepresentation([[mye,mye,mye,_ye,mye,mye],[mye,mye,_ye,_ye,kye,kye],[mye,_ye,mye,kye,_ye,mye],[_ye,kye,kye,kye,kye,_ye]],0),[dye.fromDrop(new Bae(5,2))],$localize(El||(El=wg(["Congratulations! Note that if a piece is inside the circle, it does not change anything."]))),$localize(Sl||(Sl=wg(["Failed!"])))),poe.fromMove($localize(Pl||(Pl=wg(["Victory (triangle)"]))),$localize(Ol||(Ol=wg(["On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>\n        Find the victory. You're playing Dark."]))),fye.fromRepresentation([[mye,mye,mye,_ye,mye,mye],[mye,kye,_ye,kye,kye,kye],[mye,kye,mye,kye,kye,mye],[_ye,_ye,_ye,mye,_ye,mye]],0),[dye.fromDrop(new Bae(3,3))],$localize(Tl||(Tl=wg(["Congratulations!"]))),$localize(Il||(Il=wg(["Failed!"])))),poe.fromPredicate($localize(Al||(Al=wg(["Second phase"]))),$localize(xl||(xl=wg(["After 40 turns, your pieces have all been placed and we move on to the second phase of the game.\n        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.\n        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>\n        You're playing Dark. Make a move that disconnects one of your opponent's pieces."]))),fye.fromRepresentation([[mye,mye,mye,mye,mye,mye,mye,_ye,mye],[mye,mye,mye,mye,mye,mye,kye,mye,mye],[mye,mye,mye,mye,kye,kye,kye,mye,mye],[mye,mye,mye,mye,_ye,_ye,mye,_ye,kye],[mye,kye,_ye,_ye,kye,kye,_ye,mye,mye],[kye,kye,kye,kye,_ye,_ye,_ye,kye,mye],[_ye,_ye,kye,mye,_ye,_ye,kye,mye,mye],[mye,kye,mye,kye,kye,mye,mye,mye,mye],[_ye,_ye,_ye,_ye,mye,mye,mye,mye,mye],[mye,kye,mye,_ye,mye,mye,mye,mye,mye]],40),dye.fromMovement(new Bae(6,1),new Bae(5,1)),function(e,t){var n=t.countPieces();return 19===n[0]?18===n[1]?T7.SUCCESS:T7.failure(Cye.MOVEMENT_NOT_DISCONNECTING()):T7.failure(Cye.MOVEMENT_SELF_DISCONNECTING())},$localize(Rl||(Rl=wg(["Congratulations, your opponent now has one piece less and you're closer to victory!"])))),poe.fromPredicate($localize(Ml||(Ml=wg(["Victory by disconnection"]))),$localize(Nl||(Nl=wg(["During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.\n        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.\n        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>\n        Here, you're playing Dark and you can win. Do it!"]))),fye.fromRepresentation([[mye,mye,mye,mye,mye,_ye],[mye,mye,mye,mye,kye,_ye],[mye,mye,mye,_ye,kye,kye],[mye,mye,kye,mye,_ye,kye],[_ye,_ye,mye,mye,mye,kye],[kye,_ye,mye,mye,mye,mye],[kye,mye,mye,mye,mye,mye]],40),dye.fromMovement(new Bae(2,3),new Bae(3,3)),function(e,t){return e.start.equalsValue(new Bae(2,3))?T7.SUCCESS:T7.failure(Cye.MOVEMENT_NOT_DISCONNECTING())},$localize(Dl||(Dl=wg(["Congratulations, you won!"])))),poe.fromPredicate($localize(Ll||(Ll=wg(["Special disconnection"]))),$localize(Fl||(Fl=wg(["During a disconnection, two or more groups could have the same size,\n        in which case you will have to click on the group you wish to keep.<br/><br/>\n        You're playing Dark, play such a move!"]))),fye.fromRepresentation([[mye,mye,mye,mye,mye,_ye],[mye,mye,mye,mye,kye,_ye],[mye,mye,mye,_ye,kye,kye],[kye,mye,kye,mye,mye,_ye],[_ye,_ye,mye,mye,mye,mye],[kye,kye,mye,mye,mye,mye],[kye,mye,mye,mye,mye,mye]],40),dye.fromCut(new Bae(2,3),new Bae(2,5),new Bae(2,5)),function(e,t){return e.keep.isAbsent()?T7.failure($localize(Ul||(Ul=wg(["This move has not cut the board in two equal halves."])))):t.getPieceAt(e.landing.getNext(t.offset))===Mre.NONE?T7.failure($localize(Bl||(Bl=wg(["Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again."])))):T7.SUCCESS},$localize(Vl||(Vl=wg(["Congratulations, you won!"]))))]});function bye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",10),uS("click",function(){var e=Nk(n).$implicit;return hS().onPieceClick(e)}),tS()}if(2&e){var r=t.$implicit,i=hS();vS("id","piece_",r.x,"_",r.y,""),XE("ngClass",i.getPieceClass(r)),$E("points",i.getHexaCoordsAt(r))}}function Eye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",11),uS("click",function(){var e=Nk(n).$implicit;return hS().onNeighborClick(e)}),tS()}if(2&e){var r=t.$implicit,i=hS();vS("id","neighbor_",r.x,"_",r.y,""),$E("points",i.getHexaCoordsAt(r))}}function Sye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",10),uS("click",function(){Nk(n);var e=hS();return e.onPieceClick(e.chosenLanding.get())}),tS()}if(2&e){var r=hS();vS("id","chosenLanding_",r.chosenLanding.get().x,"_",r.chosenLanding.get().y,""),XE("ngClass",r.getPlayerClass(r.state.getCurrentPlayer())),$E("points",r.getHexaCoordsAt(r.chosenLanding.get()))}}function Pye(e,t){if(1&e&&(c_(),nS(0,"polyline",12)),2&e){var n=t.$implicit,r=hS();vS("id","disconnected_",n.x,"_",n.y,""),$E("points",r.getHexaCoordsAt(n))}}function Oye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",13),uS("click",function(){Nk(n);var e=hS();return e.onNeighborClick(e.leftCoord.get())}),tS()}if(2&e){var r=hS();vS("id","leftCoord_",r.leftCoord.get().x,"_",r.leftCoord.get().y,""),$E("points",r.getHexaCoordsAt(r.leftCoord.get()))}}function Tye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",14),uS("click",function(){Nk(n);var e=hS();return e.onPieceClick(e.lastDrop.get())}),tS()}if(2&e){var r=hS();vS("id","lastDrop_",r.lastDrop.get().x,"_",r.lastDrop.get().y,""),$E("points",r.getHexaCoordsAt(r.lastDrop.get()))}}function Iye(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",15),uS("click",function(){Nk(n);var e=hS();return e.onPieceClick(e.selectedPiece.get())}),tS()}if(2&e){var r=hS();vS("id","selectedPiece_",r.selectedPiece.get().x,"_",r.selectedPiece.get().y,""),XE("ngClass",r.getSelectedPieceClass()),$E("points",r.getHexaCoordsAt(r.selectedPiece.get()))}}function Aye(e,t){if(1&e&&(c_(),nS(0,"polyline",16)),2&e){var n=t.$implicit,r=hS();vS("id","victoryCoord_",n.x,"_",n.y,""),$E("points",r.getHexaCoordsAt(n))}}function xye(e,t){if(1&e){var n=aS();c_(),eS(0,"g",19),uS("click",function(){var e=Nk(n).$implicit;return hS(2).onPieceClick(e)}),nS(1,"polyline",20),tS()}if(2&e){var r=t.$implicit,i=hS(2);pb(1),vS("id","cuttable_",r.x,"_",r.y,""),$E("points",i.getHexaCoordsAt(r))}}function Rye(e,t){if(1&e&&(c_(),eS(0,"g",17),YE(1,xye,2,3,"g",18),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var Mye=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).disconnecteds=[],r.cuttableGroups=[],r.leftCoord=lV.empty(),r.lastDrop=lV.empty(),r.selectedPiece=lV.empty(),r.chosenLanding=lV.empty(),r.nextClickShouldSelectGroup=!1,r.rules=new vye(fye),r.availableMinimaxes=[new yye(r.rules,"SixMinimax")],r.encoder=dye.encoder,r.tutorial=(new wye).tutorial,r.SPACE_SIZE=30,r.hexaLayout=new $ae(1.5*r.SPACE_SIZE,new Bae(2*r.SPACE_SIZE,0),jae.INSTANCE),r.updateBoard(),r}return jg(n,[{key:"cancelMoveAttempt",value:function(){this.selectedPiece=lV.empty(),this.chosenLanding=lV.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}},{key:"updateBoard",value:function(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=lV.empty(),this.lastDrop=lV.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}},{key:"getViewBox",value:function(){var e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}},{key:"mapAbstractCoordToCornerCoords",value:function(){var e,t=this,n=[],r=Hg(this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(function(e){return t.hexaLayout.getHexaCoordsAt(e)}));try{for(r.s();!(e=r.n()).done;){var i=e.value;n=n.concat(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"getLimits",value:function(e){var t,n=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,o=Hg(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.x<i&&(i=s.x),s.y<a&&(a=s.y),n=Math.max(n,s.x),r=Math.max(r,s.y)}}catch(u){o.e(u)}finally{o.f()}return{minX:i,minY:a,maxX:n,maxY:r}}},{key:"showLastMove",value:function(){var e=this.rules.node.move.get();this.lastDrop=lV.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?lV.of(e.start.get().getNext(this.state.offset,1)):lV.empty();var t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}},{key:"getDisconnected",value:function(){var e,t=this,n=this.rules.node.mother.get().gameState.pieces.listKeys(),r=this.rules.node.gameState.pieces.listKeys(),i=[],a=Hg(n);try{var o=function(){var n=e.value;!1===t.rules.node.move.get().start.equalsValue(n)&&!1===r.some(function(e){return e.equals(n.getNext(t.state.offset,1))})&&i.push(n.getNext(t.state.offset,1))};for(a.s();!(e=a.n()).done;)o()}catch(u){a.e(u)}finally{a.f()}var s=this.lastDrop.get();return!1===this.pieces.some(function(e){return e.equals(s)})&&!1===r.some(function(e){return e.equals(s)})&&i.push(s),i}},{key:"getEmptyNeighbors",value:function(){var e=vye.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){var t=this.chosenLanding.get();e=e.filter(function(e){return!1===e.equals(t)})}return e}},{key:"getPieceClass",value:function(e){var t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}},{key:"onPieceClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#piece_"+e.x+"_"+e.y)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if(!(t.state.turn<40)){n.next=5;break}return n.abrupt("return",t.cancelMove(hye.NO_MOVEMENT_BEFORE_TURN_40()));case 5:if(!t.chosenLanding.isAbsent()){n.next=7;break}return n.abrupt("return",t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(Zae.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=lV.of(e),T7.SUCCESS));case 7:return i=dye.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e),n.abrupt("return",t.chooseMove(i,t.state));case 9:case"end":return n.stop()}},n)}))()}},{key:"onNeighborClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#neighbor_"+e.x+"_"+e.y)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:if(!t.nextClickShouldSelectGroup){n.next=5;break}return n.abrupt("return",t.cancelMove(hye.MUST_CUT()));case 5:if(!(t.state.turn<40)){n.next=7;break}return n.abrupt("return",t.chooseMove(dye.fromDrop(e),t.state));case 7:if(!t.selectedPiece.isAbsent()){n.next=9;break}return n.abrupt("return",t.cancelMove(hye.CAN_NO_LONGER_DROP()));case 9:return i=dye.fromMovement(t.selectedPiece.get(),e),a=vye.isLegalPhaseTwoMove(i,t.state),n.abrupt("return",t.neededCutting(a)?(t.chosenLanding=lV.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,T7.SUCCESS):t.chooseMove(i,t.state));case 11:case"end":return n.stop()}},n)}))()}},{key:"neededCutting",value:function(e){return e.isFailure()&&e.getReason()===hye.MUST_CUT()}},{key:"moveVirtuallyPiece",value:function(){var e=this.selectedPiece.get();this.pieces=this.pieces.filter(function(t){return!1===t.equals(e)}),this.neighbors=this.getEmptyNeighbors()}},{key:"showCuttable",value:function(){var e=dye.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=fye.deplacePiece(this.state,e),n=fye.getGroups(t,e.start.get()),r=vye.getBiggerGroups(n);this.cuttableGroups=[];var i,a=Hg(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.cuttableGroups.push(o.toList())}}catch(s){a.e(s)}finally{a.f()}}},{key:"getSelectedPieceClass",value:function(){return this.chosenLanding.isPresent()?"moved":"selected"}}]),n}(zae);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-six"]],features:[xE],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,bye,1,4,"polyline",1),YE(2,Eye,1,3,"polyline",2),YE(3,Sye,1,4,"polyline",3),YE(4,Pye,1,3,"polyline",4),YE(5,Oye,1,3,"polyline",5),YE(6,Tye,1,3,"polyline",6),YE(7,Iye,1,4,"polyline",7),YE(8,Aye,1,3,"polyline",8),YE(9,Rye,2,1,"g",9),tS()),2&e&&($E("viewBox",t.viewBox),pb(1),XE("ngForOf",t.pieces),pb(1),XE("ngForOf",t.neighbors),pb(1),XE("ngIf",t.chosenLanding.isPresent()),pb(1),XE("ngForOf",t.disconnecteds),pb(1),XE("ngIf",t.leftCoord.isPresent()),pb(1),XE("ngIf",t.lastDrop.isPresent()),pb(1),XE("ngIf",t.selectedPiece.isPresent()),pb(1),XE("ngForOf",t.victoryCoords),pb(1),XE("ngForOf",t.cuttableGroups))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),Nye=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getMaximalDistance",value:function(){return 9}}],[{key:"of",value:function(e,t){return new n(e,t)}},{key:"from",value:function(e,t){try{var r=new n(e,t);return S7.success(r)}catch(r){return S7.failure(r.message)}}}]),n}(use);Nye.encoder=ose.getEncoder(9,9,Nye.of);var Dye={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:Nre.ZERO},Lye=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"from",value:function(e,t){return new n(e,t)}}],[{key:"getInitialState",value:function(){var e=hse.UNOCCUPIED,t=hse.INVADERS,r=hse.DEFENDERS;return new n([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,r,e,e,e,e],[t,e,e,e,r,e,e,e,t],[t,t,r,r,hse.PLAYER_ONE_KING,r,r,t,t],[t,e,e,e,r,e,e,e,t],[e,e,e,e,r,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}}]),n}(dse),Fye=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.call(this,Lye,Dye,Nye.of)}return jg(n,null,[{key:"get",value:function(){return null==n.singleton&&(n.singleton=new n),coe.ruler=this.singleton,n.singleton}}]),n}(pse),Uye=hse.UNOCCUPIED,Bye=hse.INVADERS,Vye=hse.DEFENDERS,zye=hse.PLAYER_ONE_KING,Hye=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(zl||(zl=wg(["Goal of the game"]))),$localize(Hl||(Hl=wg(["Tablut is a strategy game that was played by the Vikings.\n        The goal of the game is different for each player.\n        The attacker plays first. Its pieces (dark) are close to the edges.\n        Its goal is to capture the king, which is in the center of the board.\n        The defender plays second. Its pieces (light) are in the middle.\n        Its goal is to move the king on one of the 4 thrones in the corners.\n        Note that the square in which the king starts, in the center of the board, is also a throne."]))),Lye.getInitialState()),poe.anyMove($localize(Gl||(Gl=wg(["Moving"]))),$localize($l||($l=wg(["All pieces move the same way.\n        Similarly to a rook in chess, a piece can move:\n        <ol>\n            <li>By as many squares as you want.</li>\n            <li>Without going over another piece or stopping on another piece.</li>\n            <li>Horizontally or vertically.</li>\n            <li>Only the king can land on a throne.</li>\n        </ol>\n        To move a piece, click on it and then on its landing square.<br/><br/>\n        You're playing Dark, do the first move."]))),Lye.getInitialState(),Nye.of(new Bae(4,1),new Bae(1,1)),$localize(Wl||(Wl=wg(["Congratulations!"])))),poe.fromMove($localize(ql||(ql=wg(["Capturing a soldier (1/2)"]))),$localize(jl||(jl=wg(["All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it."]))),new Lye([[Uye,Uye,Uye,Bye,Bye,Bye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Bye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Bye,Vye,Uye,Uye,Uye,Bye],[Bye,Bye,Vye,Vye,zye,Vye,Vye,Bye,Bye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Bye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Bye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Bye,Bye,Bye,Uye,Uye,Uye]],1),[Nye.of(new Bae(2,4),new Bae(2,3)),Nye.of(new Bae(4,2),new Bae(3,2))],$localize(Zl||(Zl=wg(["Congratulations, that will teach him a lesson!"]))),$localize(Yl||(Yl=wg(["Failed, you missed an opportunity to capture a piece of the opponent."])))),poe.fromMove($localize(Kl||(Kl=wg(["Capturing a soldier (2/2)"]))),$localize(Ql||(Ql=wg(["A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it."]))),new Lye([[Uye,Uye,Uye,Bye,Bye,Bye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Bye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Uye],[Uye,Uye,Vye,Uye,zye,Uye,Vye,Uye,Bye],[Bye,Bye,Uye,Vye,Uye,Vye,Vye,Bye,Bye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Bye],[Uye,Uye,Uye,Uye,Vye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Bye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Bye,Bye,Bye,Uye,Uye,Uye]],12),[Nye.of(new Bae(1,4),new Bae(2,4))],$localize(Xl||(Xl=wg(["Congratulations, one less defender. But keep an eye on the king, it is the most important."]))),$localize(Jl||(Jl=wg(["Failed, you did not do the expected move."])))),poe.fromMove($localize(eh||(eh=wg(["Capturing the king (1/2)"]))),$localize(th||(th=wg(["To capture the king, two soldiers are not enough.\n        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.\n        This also works if the king is on the throne.<br/><br/>\n        Capture the king."]))),new Lye([[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Bye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Bye,zye,Uye,Bye,Uye,Uye,Uye,Uye,Uye],[Uye,Bye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye]],72),[Nye.of(new Bae(3,4),new Bae(2,4))],$localize(nh||(nh=wg(["Congratulations, you won!"]))),$localize(rh||(rh=wg(["Failed, you let the king run away."])))),poe.fromMove($localize(ih||(ih=wg(["Capturing the king (2/2)"]))),$localize(ah||(ah=wg(["Another way to capture the king is to immobilize it against an edge of the board.\n        Note that the king cannot be captured next to a throne.<br/><br/>\n        Capture the king."]))),new Lye([[Uye,Uye,Bye,zye,Bye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Bye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye],[Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye,Uye]],72),[Nye.of(new Bae(3,3),new Bae(3,1))],$localize(oh||(oh=wg(["The king is dead, long live the king. Congratulations, you won."]))),$localize(sh||(sh=wg(["Failed!"]))))]});function Gye(e,t){1&e&&(c_(),nS(0,"polyline",8))}function $ye(e,t){1&e&&(c_(),nS(0,"polyline",9))}function Wye(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Gye,1,0,"polyline",6),YE(2,$ye,1,0,"ng-template",null,7,RT),tS()),2&e){var n=KE(3),r=hS().index,i=hS().index,a=hS();pb(1),XE("ngIf",a.isCentralThrone(r,i))("ngIfElse",n)}}function qye(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"line",10),nS(2,"line",10),nS(3,"line",10),nS(4,"line",10),nS(5,"line",10),tS()),2&e){var n=hS(2).index,r=hS().index,i=hS();pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.04*i.SPACE_SIZE)("x2",.5*i.SPACE_SIZE)("y2",.96*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.1*i.SPACE_SIZE)("y2",.6*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.9*i.SPACE_SIZE)("y2",.6*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.4*i.SPACE_SIZE)("x2",.15*i.SPACE_SIZE)("y2",.75*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.4*i.SPACE_SIZE)("x2",.85*i.SPACE_SIZE)("y2",.75*i.SPACE_SIZE)}}function jye(e,t){if(1&e&&(c_(),nS(0,"polyline",15)),2&e){var n=hS(3).index,r=hS().index;XE("ngClass",hS().viewInfo.pieceClasses[r][n])}}function Zye(e,t){if(1&e&&(c_(),nS(0,"line",10),nS(1,"line",10),nS(2,"line",10),nS(3,"line",10)),2&e){var n=hS(3).index,r=hS().index,i=hS();XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.5*i.SPACE_SIZE)("y1",.04*i.SPACE_SIZE)("x2",.5*i.SPACE_SIZE)("y2",.96*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.04*i.SPACE_SIZE)("y1",.5*i.SPACE_SIZE)("x2",.96*i.SPACE_SIZE)("y2",.5*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.2*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.8*i.SPACE_SIZE)("y2",.8*i.SPACE_SIZE),pb(1),XE("ngClass",i.viewInfo.pieceClasses[r][n]),$E("x1",.8*i.SPACE_SIZE)("y1",.2*i.SPACE_SIZE)("x2",.2*i.SPACE_SIZE)("y2",.8*i.SPACE_SIZE)}}function Yye(e,t){if(1&e&&(c_(),YE(0,jye,1,1,"polyline",13),YE(1,Zye,4,20,"ng-template",null,14,RT)),2&e){var n=KE(2),r=hS(2).index,i=hS().index;XE("ngIf",hS().isKing(r,i))("ngIfElse",n)}}function Kye(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",10),YE(2,qye,6,25,"g",11),YE(3,Yye,3,2,"ng-template",null,12,RT),tS()),2&e){var n=KE(4),r=hS().index,i=hS().index,a=hS();pb(1),XE("ngClass",a.viewInfo.pieceClasses[i][r]),$E("r",a.SPACE_SIZE/2-a.STROKE_WIDTH)("cx",.5*a.SPACE_SIZE)("cy",.5*a.SPACE_SIZE),pb(1),XE("ngIf",a.isInvader(r,i))("ngIfElse",n)}}function Qye(e,t){if(1&e){var n=aS();c_(),eS(0,"g",3),uS("click",function(){var e=Nk(n).index,t=hS().index;return hS().onClick(e,t)}),nS(1,"rect",4),YE(2,Wye,4,2,"g",5),YE(3,Kye,5,6,"g",5),tS()}if(2&e){var r=t.index,i=hS().index,a=hS();vS("id","click_",r,"_",i,""),$E("transform","translate("+a.SPACE_SIZE*r+", "+a.SPACE_SIZE*i+")"),pb(1),XE("ngClass",a.getRectClasses(r,i)),$E("width",a.SPACE_SIZE)("height",a.SPACE_SIZE),pb(1),XE("ngIf",a.board[i][r]===a.EMPTY&&a.isThrone(r,i)),pb(1),XE("ngIf",a.board[i][r]!==a.EMPTY)}}function Xye(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Qye,4,8,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function Jye(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",16),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e.x,e.y)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),vS("id","click_",r.x,"_",r.y,""),$E("x",i.SPACE_SIZE*r.x)("y",i.SPACE_SIZE*r.y)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)}}var eme=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e,!1,Nye.from)).rules=Fye.get(),r.availableMinimaxes=[new mse(r.rules,"DummyBot"),new wse(r.rules,"Piece > Influence"),new bse(r.rules,"Piece > Control"),new Ese(r.rules,"Escape > Piece > Control")],r.encoder=Nye.encoder,r.tutorial=(new Hye).tutorial,r.updateBoard(),r}return jg(n)}(yse);return e.\u0275fac=function(t){return new(t||e)(QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["app-tablut"]],features:[xE],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,Xye,2,1,"g",1),YE(2,Jye,2,6,"g",1),tS()),2&e&&($E("viewBox",t.getViewBox()),pb(1),XE("ngForOf",t.board),pb(1),XE("ngForOf",t.getClickables()))},directives:[LA,NA,UA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e}(),tme=jg(function e(){Wg(this,e)});tme.PLACEMENT_AFTER_INITIAL_PHASE=function(){return $localize(uh||(uh=wg(["You cannot put a new ring after the tenth turn."])))},tme.NO_MARKERS_IN_INITIAL_PHASE=function(){return $localize(ch||(ch=wg(["You cannot put a marker in a ring before placing all of your rings."])))},tme.MISSING_CAPTURES=Ple.MISSING_CAPTURES,tme.MOVE_DIRECTION_INVALID=function(){return $localize(lh||(lh=wg(["The direction of your move is invalid: a move is made along a straight line."])))},tme.CAN_ONLY_CAPTURE_YOUR_MARKERS=function(){return $localize(hh||(hh=wg(["You can only capture your own markers."])))},tme.SHOULD_SELECT_PLAYER_RING=function(){return $localize(fh||(fh=wg(["You must pick one of your own rings to move."])))},tme.SHOULD_END_MOVE_ON_EMPTY_SPACE=function(){return $localize(dh||(dh=wg(["Your ring must land on an empty space."])))},tme.MOVE_SHOULD_NOT_PASS_ABOVE_RING=function(){return $localize(vh||(vh=wg(["A ring can only jump over markers or empty spaces, not over another ring."])))},tme.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=function(){return $localize(ph||(ph=wg(["Your ring must land on the first empty space after a group of markers."])))},tme.AMBIGUOUS_CAPTURE_COORD=Ple.AMBIGUOUS_CAPTURE_COORD,tme.CAPTURE_SHOULD_TAKE_RING=function(){return $localize(gh||(gh=wg(["When you capture markers, you must take one of your ring as well by clicking on it."])))};var nme=function(){function e(t,n){Wg(this,e),this.player=t,this.isRing=n}return jg(e,[{key:"equals",value:function(e){return this===e}},{key:"flip",value:function(){return M7(!1===this.isRing,"cannot flip a ring (it should never happen)"),M7(this.player.isPlayer(),"cannot flip a non-player piece"),e.of(this.player.getOpponent(),this.isRing)}},{key:"toString",value:function(){switch(this){case e.UNREACHABLE:return"NONE";case e.EMPTY:return"EMPTY";case e.MARKER_ZERO:return"MARKER_ZERO";case e.MARKER_ONE:return"MARKER_ONE";case e.RING_ZERO:return"RING_ZERO";default:return aV.expectToBe(this,e.RING_ONE),"RING_ONE"}}}],[{key:"of",value:function(t,n){return t===Mre.NONE?e.EMPTY:n?e.RINGS[t.value]:e.MARKERS[t.value]}}]),e}();nme.encoder=xre.tuple([Nre.numberEncoder,xre.booleanEncoder],function(e){return[e.player,e.isRing]},function(e){return nme.of(e[0],e[1])}),nme.UNREACHABLE=new nme(Mre.NONE,!1),nme.EMPTY=new nme(Mre.NONE,!1),nme.MARKER_ZERO=new nme(Nre.ZERO,!1),nme.MARKER_ONE=new nme(Nre.ONE,!1),nme.MARKERS=[nme.MARKER_ZERO,nme.MARKER_ONE],nme.RING_ZERO=new nme(Nre.ZERO,!0),nme.RING_ONE=new nme(Nre.ONE,!0),nme.RINGS=[nme.RING_ZERO,nme.RING_ONE];var rme=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i){var a;return Wg(this,n),(a=t.call(this,i,e,n.SIZE,n.SIZE,[6,4,3,2,1],nme.EMPTY)).sideRings=r,a}return jg(n,[{key:"isInitialPlacementPhase",value:function(){return this.turn<10}},{key:"countScores",value:function(){return this.turn<10?[0,0]:this.sideRings}},{key:"equals",value:function(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&Ure.compareTable(this.board,e.board)}},{key:"getRingCoords",value:function(e){var t=[];return this.forEachCoord(function(n,r){r.isRing&&r.player===e&&t.push(n)}),t}},{key:"isOnBoard",value:function(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==nme.UNREACHABLE}},{key:"setAtUnsafe",value:function(e,t){var r=Ure.copyBiArray(this.board);return r[e.y][e.x]=t,new n(r,this.sideRings,this.turn)}}],[{key:"getInitialState",value:function(){var e=nme.EMPTY,t=nme.UNREACHABLE;return new n([[t,t,t,t,t,t,e,e,e,e,t],[t,t,t,t,e,e,e,e,e,e,e],[t,t,t,e,e,e,e,e,e,e,e],[t,t,e,e,e,e,e,e,e,e,e],[t,e,e,e,e,e,e,e,e,e,e],[t,e,e,e,e,e,e,e,e,e,t],[e,e,e,e,e,e,e,e,e,e,t],[e,e,e,e,e,e,e,e,e,t,t],[e,e,e,e,e,e,e,e,t,t,t],[e,e,e,e,e,e,e,t,t,t,t],[t,e,e,e,e,t,t,t,t,t,t]],[5,5],0)}}]),n}(oce);return e.SIZE=11,e}(),ime=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;if(Wg(this,n),i=t.call(this,e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");return i.ringTaken=lV.ofNullable(r),Lg(i)}return jg(n,[{key:"setRingTaken",value:function(e){return new n(this.capturedSpaces,e)}},{key:"equals",value:function(e){return!(!1===xg(Bg(n.prototype),"equals",this).call(this,e)||!1===this.ringTaken.equals(e.ringTaken))}}],[{key:"of",value:function(e,t,r){for(var i=[],a=Gae.factory.fromMove(e,t).get(),o=e;!1===o.equals(t);o=o.getNext(a))i.push(o);return i.push(t),new n(i,r)}}]),n}(wle);ime.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encode",value:function(e){return{captured:e.capturedSpaces.map(function(e){return Bae.encoder.encode(e)}),ringTaken:Bae.encoder.encode(e.ringTaken.get())}}},{key:"decode",value:function(e){var t=e;return M7(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new ime(t.captured.map(function(e){return Bae.encoder.decode(e)}),Bae.encoder.decode(t.ringTaken))}}]),n}(Ire));var ame=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a){var o;return Wg(this,n),(o=t.call(this)).initialCaptures=e,o.start=r,o.end=i,o.finalCaptures=a,o}return jg(n,[{key:"isInitialPlacement",value:function(){return this.end.isAbsent()}},{key:"equals",value:function(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===Ure.compareArray(this.initialCaptures,e.initialCaptures)||!1===Ure.compareArray(this.finalCaptures,e.finalCaptures))}},{key:"toString",value:function(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}},{key:"capturesToString",value:function(e){var t,n="",r=Hg(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;""!==n&&(n+=","),n+="["+i.toString()+"]"}}catch(a){r.e(a)}finally{r.f()}return n}}]),n}(noe);ame.coordOptionalEncoder=Cle(Bae.encoder),ame.encoder=new(function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"encodeMove",value:function(e){var t={moveStart:Bae.encoder.encode(e.start),moveEnd:ame.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map(function(e,n){t["initialCapture"+n]=ime.encoder.encode(e)}),e.finalCaptures.map(function(e,n){t["finalCapture"+n]=ime.encoder.encode(e)}),t}},{key:"decodeMove",value:function(e){var t=e;return M7(null!=t.moveStart,"Invalid encoded YinshMove"),new ame(this.decodeArray(t,"initialCapture",ime.encoder.decode),Bae.encoder.decode(t.moveStart),ame.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",ime.encoder.decode))}},{key:"decodeArray",value:function(e,t,n){for(var r=[],i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}}]),n}(Are));var ome=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"getBoardValue",value:function(e){var t=this.ruler.getGameStatus(e);return t.isEndGame?Kae.fromWinner(t.winner):new Kae(e.gameState.sideRings[0]*Nre.ZERO.getScoreModifier()+e.gameState.sideRings[1]*Nre.ONE.getScoreModifier())}},{key:"getListMoves",value:function(e){var t=this,n=[],r=e.gameState;if(r.isInitialPlacementPhase()){var i,a=Hg(r.getCoordsAndContents());try{for(a.s();!(i=a.n()).done;){var o=Pg(i.value,2),s=o[0];o[1]===nme.EMPTY&&n.push(new ame([],s,lV.empty(),[]))}}catch(c){a.e(c)}finally{a.f()}}else{var u=this.ruler;this.getPossibleCaptureCombinations(r).forEach(function(e){var i=u.applyCaptures(r,e);t.getRingMoves(i).forEach(function(r){var a=u.applyRingMoveAndFlip(i,r.start,r.end);t.getPossibleCaptureCombinations(a).forEach(function(t){var i=new ame(e,r.start,lV.of(r.end),t);n.push(i)})})})}return n}},{key:"getPossibleCaptureCombinations",value:function(e){var t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return Tle.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(function(e){return function(){function e(){Wg(this,e)}return jg(e,null,[{key:"getCombinations",value:function(e,t){var n=this;return M7(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(function(e){return n.getPermutations(e)}).reduce(function(e,t){return e.concat(t)})}},{key:"getPermutations",value:function(e){for(var t=e.length,n=[e.slice()],r=new Array(t).fill(0),i=1;i<t;)if(r[i]<i){var a=i%2&&r[i],o=e[i];e[i]=e[a],e[a]=o,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}},{key:"getSubsetsOfSize",value:function(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];for(var i=[];r<=e.length-n;){var a,o=e[r],s=Hg(t(n-1,r+1));try{for(s.s();!(a=s.n()).done;){var u=a.value;u.push(o),i.push(u)}}catch(c){s.e(c)}finally{s.f()}++r}return i}(t,0)}}]),e}().getCombinations(n,e.length).map(function(t){return e.map(function(e,n){return new ime(e.capturedSpaces,t[n])})})}).reduce(function(e,t){return e.concat(t)},[])}},{key:"getRingMoves",value:function(e){var t,n=this.ruler,r=[],i=Hg(this.getRingCoords(e));try{for(i.s();!(t=i.n()).done;){var a,o=t.value,s=Hg(n.getRingTargets(e,o));try{for(s.s();!(a=s.n()).done;){var u=a.value;r.push({start:o,end:u})}}catch(c){s.e(c)}finally{s.f()}}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"getRingCoords",value:function(e){var t=e.getCurrentPlayer().value,n=[];return e.forEachCoord(function(e,r){r===nme.RINGS[t]&&n.push(e)}),n}}]),n}(Yae),sme=function(e){Mg(n,e);var t=Dg(n);function n(){return Wg(this,n),t.apply(this,arguments)}return jg(n,[{key:"applyLegalMove",value:function(e,t,n){return new rme(n.board,n.sideRings,n.turn+1)}},{key:"applyCaptures",value:function(e,t){var n=this,r=e;return t.forEach(function(e){r=n.applyCapture(r,e)}),r}},{key:"applyCapture",value:function(e,t){var n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new rme(n,e.sideRings,e.turn),t.ringTaken.get())}},{key:"takeRing",value:function(e,t){var n=e.getCurrentPlayer().value,r=e.setAt(t,nme.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new rme(r,i,e.turn)}},{key:"applyCaptureWithoutTakingRing",value:function(e,t){return t.forEach(function(t){e=e.setAt(t,nme.EMPTY)}),e.board}},{key:"ringSelectionValidity",value:function(e,t){var n=e.getCurrentPlayer().value;return e.getPieceAt(t)===nme.RINGS[n]?T7.SUCCESS:T7.failure(tme.CAPTURE_SHOULD_TAKE_RING())}},{key:"applyRingMoveAndFlip",value:function(e,t,n){var r=e.getCurrentPlayer().value,i=e.setAt(t,nme.MARKERS[r]);i=i.setAt(n,nme.RINGS[r]);for(var a=Gae.factory.fromMove(t,n).get(),o=t.getNext(a);!1===o.equals(n);o=o.getNext(a)){var s=i.getPieceAt(o);s!==nme.EMPTY&&(i=i.setAt(o,s.flip()))}return i}},{key:"isLegal",value:function(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return S7.failure(tme.NO_MARKERS_IN_INITIAL_PHASE());var n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();var r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();var a=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(a,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();var s=this.applyCaptures(a,e.finalCaptures),u=this.noMoreCapturesValidity(s);return u.isFailure()?u.toFailedFallible():S7.success(s)}},{key:"initialPlacementValidity",value:function(e,t){if(!0!==e.isInitialPlacementPhase())return S7.failure(tme.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==nme.EMPTY)return S7.failure(Zae.MUST_CLICK_ON_EMPTY_SPACE());var n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;var i=e.setAt(t,nme.of(n,!0)).board,a=new rme(i,r,e.turn);return S7.success(a)}},{key:"moveStartValidity",value:function(e,t){var n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==nme.RINGS[n]?T7.failure(tme.SHOULD_SELECT_PLAYER_RING()):T7.SUCCESS}},{key:"moveValidity",value:function(e,t,n){var r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==nme.EMPTY)return T7.failure(tme.SHOULD_END_MOVE_ON_EMPTY_SPACE());var i=Gae.factory.fromMove(t,n);if(i.isFailure())return T7.failure(tme.MOVE_DIRECTION_INVALID());for(var a=i.get(),o=!1,s=t.getNext(a);!1===s.equals(n);s=s.getNext(a)){var u=e.getPieceAt(s);if(u===nme.EMPTY){if(o)return T7.failure(tme.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(u.isRing)return T7.failure(tme.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return T7.SUCCESS}},{key:"capturesValidity",value:function(e,t){var n,r=e,i=Hg(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this.captureValidity(r,a);if(o.isFailure())return o;r=this.applyCapture(r,a)}}catch(s){i.e(s)}finally{i.f()}return T7.SUCCESS}},{key:"captureValidity",value:function(e,t){var n,r=e.getCurrentPlayer().value,i=Hg(t.capturedSpaces);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(e.getPieceAt(a)!==nme.MARKERS[r])return T7.failure(tme.CAN_ONLY_CAPTURE_YOUR_MARKERS())}}catch(o){i.e(o)}finally{i.f()}return e.getPieceAt(t.ringTaken.get())!==nme.RINGS[r]?T7.failure(tme.CAPTURE_SHOULD_TAKE_RING()):T7.SUCCESS}},{key:"noMoreCapturesValidity",value:function(e){var t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?T7.SUCCESS:T7.failure(tme.MISSING_CAPTURES())}},{key:"getLinePortionsWithAtLeastFivePiecesOfPlayer",value:function(e,t){var n=this,r=[];return e.allLines().forEach(function(i){var a=n.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,i);a.isPresent()&&r.push(a.get())}),r}},{key:"getLinePortionWithAtLeastFivePiecesOfPlayer",value:function(e,t,n){var r,i=0,a=e.getEntranceOnLine(n),o=n.getDirection(),s=a;for(r=a;e.isOnBoard(r);r=r.getNext(o)){var u=e.getPieceAt(r);if(u.player===t&&!1===u.isRing)0===i&&(s=r),i+=1;else{if(i>=5)break;i=0}}return i>=5?lV.of({start:s,end:r,dir:o}):lV.empty()}},{key:"getPossibleCaptures",value:function(e){var t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(function(e){for(var t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(ime.of(t,t.getNext(e.dir,4)))}),n}},{key:"getRingTargets",value:function(e,t){var n,r=[],i=Hg(Gae.factory.all);try{for(i.s();!(n=i.n()).done;)for(var a=n.value,o=!1,s=t.getNext(a);e.isOnBoard(s);s=s.getNext(a)){var u=e.getPieceAt(s);if(u===nme.EMPTY){if(r.push(s),o)break}else{if(u.isRing)break;o=!0}}}catch(c){i.e(c)}finally{i.f()}return r}},{key:"getGameStatus",value:function(e){return e.gameState.isInitialPlacementPhase()?loe.ONGOING:e.gameState.sideRings[0]>=3?loe.ZERO_WON:e.gameState.sideRings[1]>=3?loe.ONE_WON:loe.ONGOING}}]),n}(hoe),ume=nme.EMPTY,cme=nme.UNREACHABLE,lme=nme.MARKER_ZERO,hme=nme.RING_ZERO,fme=nme.MARKER_ONE,dme=nme.RING_ONE,vme=function(){var e=jg(function e(){Wg(this,e)});return e.MUST_ALIGN_FIVE=function(){return $localize(yh||(yh=wg(["Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time."])))},e.MUST_CAPTURE_TWO=function(){return $localize(mh||(mh=wg(["Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again."])))},e}(),pme=jg(function e(){Wg(this,e),this.tutorial=[poe.informational($localize(kh||(kh=wg(["Goal of the game"]))),$localize(_h||(_h=wg(["The goal at Yinsh is to capture three rings in total.\n        The rings taken are shown on the top left for the dark player,\n        and on the bottom right for the light player. Here, Dark won the game.\n        Note that on the board you have two types of pieces for each player:\n        rings (empty circles) and markers (full circles)."]))),new rme([[cme,cme,cme,cme,cme,cme,ume,ume,ume,ume,cme],[cme,cme,cme,cme,ume,ume,ume,ume,ume,ume,ume],[cme,cme,cme,lme,dme,ume,ume,ume,ume,ume,ume],[cme,cme,ume,lme,ume,dme,ume,fme,ume,ume,ume],[cme,ume,hme,fme,ume,ume,dme,lme,ume,ume,ume],[cme,ume,ume,lme,fme,ume,ume,ume,ume,ume,cme],[ume,ume,ume,lme,ume,ume,ume,dme,ume,ume,cme],[ume,ume,ume,fme,lme,hme,ume,ume,ume,cme,cme],[ume,ume,ume,ume,ume,ume,ume,ume,cme,cme,cme],[ume,ume,ume,ume,ume,ume,ume,cme,cme,cme,cme],[cme,ume,ume,ume,ume,cme,cme,cme,cme,cme,cme]],[3,1],20)),poe.anyMove($localize(Ch||(Ch=wg(["Initial board and placement phase"]))),$localize(wh||(wh=wg(["The initial board is empty.\n        At the beginning of the game, each player puts one of its ring on the board at their turn.\n        This phase stops when all rings have been placed on the board.\n        Put one of your ring on the board by clicking the space where you want to place it."]))),new rme(rme.getInitialState().board,[5,5],0),new ame([],new Bae(5,5),lV.empty(),[]),$localize(bh||(bh=wg(["Congratulations!"])))),poe.anyMove($localize(Eh||(Eh=wg(["Putting a marker"]))),$localize(Sh||(Sh=wg(["Once the initial phase is done and all rings are on the board, you need to place markers on the board.\n        To do so, put a marker in a ring by clicking on that ring.\n        Then, the ring must be moved in a straight line, in any direction.\n        A ring cannot pass through other rings during its move.\n        If it goes over a group of markers, your move must stop at the first empty space after that group.\n        All markers in the group are then flipped and their color change.<br/><br/>\n        You're playing Dark, do a move."]))),new rme([[cme,cme,cme,cme,cme,cme,ume,ume,ume,ume,cme],[cme,cme,cme,cme,ume,ume,ume,ume,ume,ume,ume],[cme,cme,cme,dme,ume,ume,ume,ume,ume,ume,ume],[cme,cme,dme,ume,ume,dme,ume,ume,ume,ume,ume],[cme,ume,hme,fme,ume,ume,dme,ume,ume,ume,ume],[cme,ume,ume,fme,ume,ume,ume,ume,ume,ume,cme],[ume,ume,ume,ume,hme,ume,ume,dme,ume,ume,cme],[ume,ume,ume,ume,ume,hme,ume,ume,ume,cme,cme],[ume,ume,ume,hme,ume,ume,ume,cme,cme,cme,cme],[ume,ume,ume,ume,ume,ume,ume,cme,cme,cme,cme],[cme,ume,ume,ume,ume,cme,cme,cme,cme,cme,cme]],[0,0],20),new ame([],new Bae(2,4),lV.of(new Bae(4,4)),[]),$localize(Ph||(Ph=wg(["Congratulations!"])))),poe.fromPredicate($localize(Oh||(Oh=wg(["Getting a ring by aligning 5 markers"]))),$localize(Th||(Th=wg(["Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.\n        To do so, you need to align 5 markers of your color.\n        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.\n        You will then have one more point.\n        You must capture when you can.<br/><br/>\n        You're playing Dark, perform a capture!"]))),new rme([[cme,cme,cme,cme,cme,cme,ume,ume,ume,ume,cme],[cme,cme,cme,cme,ume,ume,ume,ume,ume,ume,ume],[cme,cme,cme,dme,ume,ume,ume,ume,ume,ume,ume],[cme,cme,dme,ume,ume,dme,ume,ume,ume,ume,ume],[cme,ume,lme,lme,hme,fme,fme,ume,ume,ume,ume],[cme,ume,ume,dme,ume,ume,ume,ume,ume,ume,cme],[ume,ume,ume,ume,hme,ume,ume,dme,ume,ume,cme],[ume,ume,ume,ume,ume,hme,ume,ume,ume,cme,cme],[ume,ume,ume,hme,ume,ume,ume,hme,cme,cme,cme],[ume,ume,ume,ume,ume,ume,ume,cme,cme,cme,cme],[cme,ume,ume,ume,ume,cme,cme,cme,cme,cme,cme]],[0,0],20),new ame([],new Bae(4,4),lV.of(new Bae(7,4)),[ime.of(new Bae(2,4),new Bae(6,4),new Bae(7,4))]),function(e,t){return 1===t.sideRings[Nre.ZERO.value]?T7.SUCCESS:T7.failure(vme.MUST_ALIGN_FIVE())},$localize(Ih||(Ih=wg(["Congratulations!"])))),poe.fromPredicate($localize(Ah||(Ah=wg(["Compound captures"]))),$localize(xh||(xh=wg(["During a turn, you could have to choose between multiple captures,\n        or you could even capture multiple times!\n        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>\n        Here, you can capture two rings, do it!"]))),new rme([[cme,cme,cme,cme,cme,cme,ume,ume,ume,ume,cme],[cme,cme,cme,cme,hme,ume,ume,dme,dme,hme,ume],[cme,cme,cme,hme,ume,ume,fme,dme,ume,hme,ume],[cme,cme,ume,hme,ume,ume,ume,ume,ume,dme,ume],[cme,ume,ume,ume,ume,lme,ume,ume,dme,ume,ume],[cme,ume,ume,ume,lme,lme,ume,fme,ume,ume,cme],[ume,ume,ume,lme,ume,lme,ume,ume,ume,ume,cme],[ume,ume,lme,ume,ume,lme,ume,ume,ume,cme,cme],[ume,lme,ume,ume,ume,lme,ume,ume,cme,cme,cme],[ume,ume,ume,ume,ume,lme,ume,cme,cme,cme,cme],[cme,ume,ume,ume,ume,cme,cme,cme,cme,cme,cme]],[0,0],10),new ame([ime.of(new Bae(5,4),new Bae(1,8),new Bae(3,2)),ime.of(new Bae(5,9),new Bae(5,5),new Bae(3,3))],new Bae(4,1),lV.of(new Bae(4,2)),[]),function(e,t){return 2===t.sideRings[Nre.ZERO.value]?T7.SUCCESS:T7.failure(vme.MUST_CAPTURE_TWO())},$localize(Rh||(Rh=wg(["Congratulations!"]))))]});function gme(e,t){if(1&e&&(c_(),nS(0,"circle",9)),2&e){var n=hS(2).$implicit,r=hS(2);$E("cx",n.center.x)("cy",n.center.y)("r",r.viewInfo.ringOuterSize)}}function yme(e,t){if(1&e&&(c_(),nS(0,"circle",10)),2&e){var n=hS(2),r=n.index,i=n.$implicit,a=hS().index,o=hS();vS("id","ring_",r,"_",a,""),XE("ngClass",i.ringClasses),$E("cx",i.center.x)("cy",i.center.y)("r",o.viewInfo.ringMidSize)}}function mme(e,t){if(1&e&&(c_(),nS(0,"circle",9)),2&e){var n=hS(2).$implicit,r=hS(2);$E("cx",n.center.x)("cy",n.center.y)("r",r.viewInfo.ringInnerSize)}}function kme(e,t){if(1&e&&(c_(),nS(0,"circle",11)),2&e){var n=hS(2),r=n.index,i=n.$implicit,a=hS().index,o=hS();vS("id","marker_",r,"_",a,""),XE("ngClass",i.markerClasses),$E("cx",i.center.x)("cy",i.center.y)("r",o.viewInfo.markerSize)}}function _me(e,t){if(1&e){var n=aS();c_(),eS(0,"g",3),uS("click",function(){Nk(n);var e=hS().$implicit;return hS(2).onClick(e.coord)}),nS(1,"polyline",4),eS(2,"g",5),YE(3,gme,1,3,"circle",6),YE(4,yme,1,6,"circle",7),YE(5,mme,1,3,"circle",6),YE(6,kme,1,6,"circle",8),tS(),tS()}if(2&e){var r=hS(),i=r.index,a=r.$implicit,o=hS().index;vS("id","click_",i,"_",o,""),pb(1),vS("id","space_",i,"_",o,""),XE("ngClass",a.spaceClasses),$E("points",a.coordinates),pb(1),vS("id","pieceGroup_",i,"_",o,""),XE("ngClass",a.removedClass),pb(1),XE("ngIf",a.isRing),pb(1),XE("ngIf",a.isRing),pb(1),XE("ngIf",a.isRing),pb(1),XE("ngIf",a.isMarker)}}function Cme(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,_me,7,13,"g",2),tS()),2&e){var n=t.$implicit;pb(1),XE("ngIf",null!=n)}}function wme(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Cme,2,1,"g",1),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}function bme(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"polyline",12),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),vS("id","selected_",r.x,"_",r.y,""),$E("points",i.viewInfo.spaceInfo[r.y][r.x].coordinates)}}function Eme(e,t){if(1&e){var n=aS();c_(),eS(0,"polyline",14),uS("click",function(){Nk(n);var e=hS().$implicit;return hS().onClick(e)}),tS()}if(2&e){var r=hS().$implicit,i=hS();vS("id","selectable_",r.x,"_",r.y,""),$E("points",i.viewInfo.spaceInfo[r.y][r.x].coordinates)}}function Sme(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Eme,1,3,"polyline",13),tS()),2&e){var n=hS();pb(1),XE("ngIf",n.isPlayerTurn())}}function Pme(e,t){if(1&e){var n=aS();c_(),eS(0,"g"),eS(1,"rect",15),uS("click",function(){var e=Nk(n).$implicit;return hS().onClick(e)}),tS(),tS()}if(2&e){var r=t.$implicit,i=hS();pb(1),$E("x",i.viewInfo.spaceInfo[r.y][r.x].center.x-i.viewInfo.indicatorSize/2)("y",i.viewInfo.spaceInfo[r.y][r.x].center.y-i.viewInfo.indicatorSize/2)("width",i.viewInfo.indicatorSize)("height",i.viewInfo.indicatorSize)}}function Ome(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",16),nS(2,"circle",9),nS(3,"circle",17),tS()),2&e){var n=t.index,r=hS().$implicit,i=hS();pb(1),vS("id","player_",r,"_sideRing_",n+1,""),$E("cx",(0===r?0:1050)+1.2*(0===r?1:-1)*i.viewInfo.ringOuterSize*(n+1))("cy",0===r?300:1260)("r",i.viewInfo.ringOuterSize),pb(1),$E("cx",(0===r?0:1050)+1.2*(0===r?1:-1)*i.viewInfo.ringOuterSize*(n+1))("cy",0===r?300:1260)("r",i.viewInfo.ringInnerSize),pb(1),XE("ngClass",i.viewInfo.sideRingClass[r]),$E("cx",(0===r?0:1050)+1.2*(0===r?1:-1)*i.viewInfo.ringOuterSize*(n+1))("cy",0===r?300:1260)("r",i.viewInfo.ringMidSize)}}var Tme=function(){return[]};function Ime(e,t){if(1&e&&(c_(),eS(0,"g"),YE(1,Ome,4,12,"g",1),tS()),2&e){var n=t.$implicit,r=hS();pb(1),XE("ngForOf",aT(1,Tme).constructor(r.viewInfo.sideRings[n]))}}var Ame=function(){return[0,1]},xme=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,e)).movePhase="MOVE_START",r.moveStart=lV.empty(),r.moveEnd=lV.empty(),r.currentlyMoved=[],r.currentCapture=lV.empty(),r.initialCaptures=[],r.finalCaptures=[],r.possibleCaptures=[],r.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:n.MARKER_SIZE,ringOuterSize:n.RING_OUTER_SIZE,ringMidSize:n.RING_MID_SIZE,ringInnerSize:n.RING_INNER_SIZE,indicatorSize:n.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},r.scores=lV.of([0,0]),r.rules=new sme(rme),r.availableMinimaxes=[new ome(r.rules,"YinshMinimax")],r.encoder=ame.encoder,r.tutorial=(new pme).tutorial,r.hexaLayout=new $ae(1.5*n.RING_OUTER_SIZE,new Bae(2*n.RING_OUTER_SIZE,0),jae.INSTANCE),r.constructedState=r.rules.node.gameState,r.constructedState.allCoords().forEach(function(e){null==r.viewInfo.spaceInfo[e.y]&&(r.viewInfo.spaceInfo[e.y]=[]),r.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:r.getHexaCoordsAt(e),center:r.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}}),r}return jg(n,[{key:"updateBoard",value:function(){this.cancelMoveAttempt(),this.scores=lV.of(this.rules.node.gameState.countScores())}},{key:"updateViewInfo",value:function(){var e=this;this.constructedState.allCoords().forEach(function(t){e.viewInfo.spaceInfo[t.y][t.x].spaceClasses=e.getSpaceClasses(t);var n=e.constructedState.getPieceAt(t);e.viewInfo.spaceInfo[t.y][t.x].removedClass="",e.setRingInfo(t,n),e.setMarkerInfo(t,n)});var t,n=Hg(Nre.PLAYERS);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.viewInfo.sideRings[r.value]=this.constructedState.sideRings[r.value]}}catch(c){n.e(c)}finally{n.f()}switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];var i,a=Hg(this.possibleCaptures);try{for(a.s();!(i=a.n()).done;){var o,s=Hg(i.value.capturedSpaces);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.viewInfo.selectableCoords.push(u)}}catch(c){s.e(c)}finally{s.f()}}}catch(c){a.e(c)}finally{a.f()}break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}},{key:"showCurrentMoveCaptures",value:function(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());var e,t=Hg(this.initialCaptures);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.markCurrentCapture(n)}}catch(o){t.e(o)}finally{t.f()}var r,i=Hg(this.finalCaptures);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.markCurrentCapture(a)}}catch(o){i.e(o)}finally{i.f()}}},{key:"getSpaceClasses",value:function(e){return this.currentlyMoved.some(function(t){return t.equals(e)})?["moved"]:[]}},{key:"setRingInfo",value:function(e,t){if(t.isRing){var n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}},{key:"setMarkerInfo",value:function(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==nme.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){var n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}},{key:"cancelMoveAttempt",value:function(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=lV.empty(),this.moveStart=lV.empty(),this.moveEnd=lV.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}},{key:"showLastMove",value:function(){var e=this,t=this.rules.node.move;if(t.isPresent()){var n=t.get();if(n.isInitialPlacement())this.viewInfo.spaceInfo[n.start.y][n.start.x].spaceClasses=["moved"];else{var r,i=Hg(this.coordsBetween(n.start,n.end.get()));try{for(i.s();!(r=i.n()).done;){var a=r.value;this.viewInfo.spaceInfo[a.y][a.x].spaceClasses=["moved"]}}catch(s){i.e(s)}finally{i.f()}var o=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();n.initialCaptures.forEach(function(t){return e.showLastMoveCapture(t,o)}),n.finalCaptures.forEach(function(t){return e.showLastMoveCapture(t,o)})}}}},{key:"coordsBetween",value:function(e,t){for(var n=[],r=Gae.factory.fromMove(e,t).get(),i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==nme.EMPTY&&n.push(i),n.push(t);return n}},{key:"showLastMoveCapture",value:function(e,t){var n,r=Hg(e.capturedSpaces);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.viewInfo.spaceInfo[i.y][i.x].spaceClasses=["captured"],t&&this.markRemovedMarker(i,this.rules.node.gameState.getCurrentPlayer().getOpponent())}}catch(a){r.e(a)}finally{r.f()}this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}},{key:"moveToInitialCaptureOrMovePhase",value:function(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),T7.SUCCESS}},{key:"onClick",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.canUserPlay("#click_"+e.x+"_"+e.y)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:n.t0=t.movePhase,n.next="INITIAL_CAPTURE_SELECT_FIRST"===n.t0||"FINAL_CAPTURE_SELECT_FIRST"===n.t0?6:"INITIAL_CAPTURE_SELECT_LAST"===n.t0||"FINAL_CAPTURE_SELECT_LAST"===n.t0?7:"INITIAL_CAPTURE_SELECT_RING"===n.t0||"FINAL_CAPTURE_SELECT_RING"===n.t0?8:"MOVE_START"===n.t0?9:"MOVE_END"===n.t0?10:11;break;case 6:return n.abrupt("return",t.selectCaptureFirstCoord(e));case 7:return n.abrupt("return",t.selectCaptureLastCoord(e));case 8:return n.abrupt("return",t.selectRing(e));case 9:return n.abrupt("return",t.selectMoveStart(e));case 10:return n.abrupt("return",t.selectMoveEnd(e));case 11:case"end":return n.stop()}},n)}))()}},{key:"selectCaptureFirstCoord",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=[],t.possibleCaptures.forEach(function(t){t.contains(e)&&r.push(t)}),!(r.length>1)){n.next=5;break}t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(r),n.next=8;break;case 5:if(0!==r.length){n.next=7;break}return n.abrupt("return",t.cancelMove(tme.MISSING_CAPTURES()));case 7:t.selectCapture(r[0]);case 8:return n.abrupt("return",T7.SUCCESS);case 9:case"end":return n.stop()}},n)}))()}},{key:"moveToCaptureSelectLast",value:function(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;var t,n=Hg(e);try{for(n.s();!(t=n.n()).done;){var r,i=Hg(t.value.capturedSpaces);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.viewInfo.selectableCoords.push(a)}}catch(o){i.e(o)}finally{i.f()}}}catch(o){n.e(o)}finally{n.f()}switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}},{key:"selectCaptureLastCoord",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=[],n.abrupt("return",(t.possibleCaptures.forEach(function(t){t.contains(e)&&r.push(t)}),r.length>1?t.cancelMove(tme.AMBIGUOUS_CAPTURE_COORD()):0===r.length?t.cancelMove(tme.MISSING_CAPTURES()):t.selectCapture(r[0])));case 2:case"end":return n.stop()}},n)}))()}},{key:"selectCapture",value:function(e){switch(this.currentCapture=lV.of(e),this.constructedState=new rme(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),T7.SUCCESS}},{key:"markCurrentCapture",value:function(e){var t,n=Hg(e.capturedSpaces);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.viewInfo.selectedCoords.push(r),this.markRemovedMarker(r,this.rules.node.gameState.getCurrentPlayer())}}catch(i){n.e(i)}finally{n.f()}e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}},{key:"markRemovedMarker",value:function(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setMarkerInfo(e,nme.MARKERS[t.value])}},{key:"markRemovedRing",value:function(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setRingInfo(e,nme.RINGS[t.value])}},{key:"selectRing",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=t.rules.ringSelectionValidity(t.constructedState,e)).isFailure()){n.next=3;break}return n.abrupt("return",t.cancelMove(r.getReason()));case 3:t.constructedState=t.rules.takeRing(t.constructedState,e),i=t.currentCapture.get().setRingTaken(e),n.t0=(t.currentCapture=lV.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase),n.next="INITIAL_CAPTURE_SELECT_RING"===n.t0?8:9;break;case 8:return n.abrupt("return",(t.initialCaptures.push(i),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),T7.SUCCESS)));case 9:return n.abrupt("return",(aV.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(i),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),T7.SUCCESS)));case 10:case"end":return n.stop()}},n)}))()}},{key:"moveToMovePhase",value:function(){return this.movePhase="MOVE_START",this.updateViewInfo(),T7.SUCCESS}},{key:"tryMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ame(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures),t.next=3,e.chooseMove(n,e.rules.node.gameState,e.scores.get());case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}))()}},{key:"selectMoveStart",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.constructedState.isInitialPlacementPhase()){n.next=3;break}return r=t.rules.initialPlacementValidity(t.constructedState,e),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):(t.moveStart=lV.of(e),t.tryMove()));case 3:if(!(i=t.rules.moveStartValidity(t.constructedState,e)).isFailure()){n.next=6;break}return n.abrupt("return",t.cancelMove(i.getReason()));case 6:return t.moveStart=lV.of(e),t.movePhase="MOVE_END",t.updateViewInfo(),n.abrupt("return",T7.SUCCESS);case 8:case"end":return n.stop()}},n)}))()}},{key:"selectMoveEnd",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e),n.abrupt("return",r.isFailure()?t.cancelMove(r.getReason()):(t.moveEnd=lV.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove()));case 2:case"end":return n.stop()}},n)}))()}},{key:"moveToFinalCapturePhaseOrTryMove",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),T7.SUCCESS)));case 1:case"end":return t.stop()}},t)}))()}}]),n}(zae);function Rme(e,t){if(1&e&&(eS(0,"option",5),FS(1),tS()),2&e){var n=t.$implicit;XE("value",n.urlName),pb(1),US(n.name)}}xme.RING_OUTER_SIZE=40,xme.RING_MID_SIZE=34,xme.RING_INNER_SIZE=28,xme.MARKER_SIZE=xme.RING_INNER_SIZE,xme.INDICATOR_SIZE=10,xme.\u0275fac=function(e){return new(e||xme)(QE(x7))},xme.\u0275cmp=Gm({type:xme,selectors:[["app-yinsh"]],features:[xE],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(c_(),eS(0,"svg",0),YE(1,wme,2,1,"g",1),YE(2,bme,2,3,"g",1),YE(3,Sme,2,1,"g",1),YE(4,Pme,2,4,"g",1),YE(5,Ime,2,2,"g",1),tS()),2&e&&(pb(1),XE("ngForOf",t.viewInfo.spaceInfo),pb(1),XE("ngForOf",t.viewInfo.selectedCoords),pb(1),XE("ngForOf",t.viewInfo.selectableCoords),pb(1),XE("ngForOf",t.viewInfo.targets),pb(1),XE("ngForOf",aT(5,Ame)))},directives:[LA,UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var Mme=function(){var e=jg(function e(){Wg(this,e)});return e.ABALONE=function(){return $localize(Mh||(Mh=wg(["Use simple mechanics to push 6 of the opponent's pieces out of the board!"])))},e.APAGOS=function(){return $localize(Nh||(Nh=wg(["Very simple game, but, will you be able to win everytime?"])))},e.AWALE=function(){return $localize(Dh||(Dh=wg(["The international version of the famous African strategy game!"])))},e.BRANDHUB=function(){return $localize(Lh||(Lh=wg(["The Irish version of the Tafl game family!"])))},e.COERCEO=function(){return $localize(Fh||(Fh=wg(["Get rid of all of your opponent's pieces on a board that shrinks little by little!"])))},e.CONSPIRATEURS=function(){return $localize(Uh||(Uh=wg(["Hide all of your pieces before your opponent does, or risk to be discovered!"])))},e.DIAM=function(){return $localize(Bh||(Bh=wg(["Drop your pieces and move them around to align two pieces of the same color across the board to win!"])))},e.DVONN=function(){return $localize(Vh||(Vh=wg(["Stack your pieces and control as many stacks as you can to win!"])))},e.ENCAPSULE=function(){return $localize(zh||(zh=wg(["An enhanced tic-tac-toe where piece can encapsule other and prevent them to win."])))},e.EPAMINONDAS=function(){return $localize(Hh||(Hh=wg(["An antiquity-war inspired game. Be the first to pierce your opponent's lines!"])))},e.GIPF=function(){return $localize(Gh||(Gh=wg(["A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!"])))},e.GO=function(){return $localize($h||($h=wg(["The oldest strategy game still practiced widely. A territory control game."])))},e.KAMISADO=function(){return $localize(Wh||(Wh=wg(["Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!"])))},e.LINES_OF_ACTION=function(){return $localize(qh||(qh=wg(["Regroup your pieces to win. But your possible moves will often change!"])))},e.LODESTONE=function(){return $localize(jh||(jh=wg(["Push and crush your opponent's pieces using magnetic forces!"])))},e.MARTIAN_CHESS=function(){return $localize(Zh||(Zh=wg(["Win points by capturing pieces, but you only control pieces on your side of the board!"])))},e.P4=function(){return $localize(Yh||(Yh=wg(["The classical 4 in a row game!"])))},e.PENTAGO=function(){return $localize(Kh||(Kh=wg(["Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!"])))},e.PYLOS=function(){return $localize(Qh||(Qh=wg(["Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!"])))},e.QUARTO=function(){return $localize(Xh||(Xh=wg(["Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!"])))},e.QUIXO=function(){return $localize(Jh||(Jh=wg(["Align 5 of your pieces on a board where pieces slide!"])))},e.REVERSI=function(){return $localize(ef||(ef=wg(["Sandwich your opponent's pieces to dominate the board!"])))},e.SAHARA=function(){return $localize(tf||(tf=wg(["Immobilize one of your opponent's pyramids before your opponent does!"])))},e.SIAM=function(){return $localize(nf||(nf=wg(["Be the first to push a mountain out of the board!"])))},e.SIX=function(){return $localize(rf||(rf=wg(["Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!"])))},e.TABLUT=function(){return $localize(af||(af=wg(["The Viking board game! Invaders must capture the king, defender must make him escape!"])))},e.YINSH=function(){return $localize(of||(of=wg(["Align your pieces to score points, but beware, pieces can flip!"])))},e}(),Nme=function(){var e=jg(function e(t,n,r,i,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Wg(this,e),this.name=t,this.urlName=n,this.component=r,this.creationDate=i,this.description=a,this.display=o});return e.ALL_GAMES=function(){return[new e("MinimaxTesting","MinimaxTesting",Ude,new Date("1970-01-01"),"",!1),new e($localize(sf||(sf=wg(["Four in a Row"]))),"P4",Jde,new Date("2018-08-28"),Mme.P4()),new e($localize(uf||(uf=wg(["Awal\xe9"]))),"Awale",ase,new Date("2018-11-29"),Mme.AWALE()),new e($localize(cf||(cf=wg(["Quarto"]))),"Quarto",Mpe,new Date("2018-12-09"),Mme.QUARTO()),new e($localize(lf||(lf=wg(["Tablut"]))),"Tablut",eme,new Date("2018-12-27"),Mme.TABLUT()),new e($localize(hf||(hf=wg(["Reversi"]))),"Reversi",uge,new Date("2019-01-16"),Mme.REVERSI()),new e($localize(ff||(ff=wg(["Go"]))),"Go",mhe,new Date("2019-12-21"),Mme.GO()),new e($localize(df||(df=wg(["Encapsule"]))),"Encapsule",ile,new Date("2019-12-30"),Mme.ENCAPSULE()),new e($localize(vf||(vf=wg(["Siam"]))),"Siam",lye,new Date("2020-01-11"),Mme.SIAM()),new e($localize(pf||(pf=wg(["Sahara"]))),"Sahara",Oge,new Date("2020-02-29"),Mme.SAHARA()),new e($localize(gf||(gf=wg(["Pylos"]))),"Pylos",Hve,new Date("2020-10-02"),Mme.PYLOS()),new e($localize(yf||(yf=wg(["Kamisado"]))),"Kamisado",Qhe,new Date("2020-10-03"),Mme.KAMISADO()),new e($localize(mf||(mf=wg(["Quixo"]))),"Quixo",Zpe,new Date("2020-10-15"),Mme.QUIXO()),new e($localize(kf||(kf=wg(["Dvonn"]))),"Dvonn",Nce,new Date("2020-10-21"),Mme.DVONN()),new e($localize(_f||(_f=wg(["Epaminondas"]))),"Epaminondas",_le,new Date("2021-01-16"),Mme.EPAMINONDAS()),new e($localize(Cf||(Cf=wg(["Gipf"]))),"Gipf",$le,new Date("2021-02-22"),Mme.GIPF()),new e($localize(wf||(wf=wg(["Coerceo"]))),"Coerceo",gue,new Date("2021-03-21"),Mme.COERCEO()),new e($localize(bf||(bf=wg(["Six"]))),"Six",Mye,new Date("2021-04-08"),Mme.SIX()),new e($localize(Ef||(Ef=wg(["Lines of Action"]))),"LinesOfAction",hfe,new Date("2021-04-28"),Mme.LINES_OF_ACTION()),new e($localize(Sf||(Sf=wg(["Pentago"]))),"Pentago",kve,new Date("2021-05-23"),Mme.PENTAGO()),new e($localize(Pf||(Pf=wg(["Abalone"]))),"Abalone",Noe,new Date("2021-07-13"),Mme.ABALONE()),new e($localize(Of||(Of=wg(["Yinsh"]))),"Yinsh",xme,new Date("2021-07-31"),Mme.YINSH()),new e($localize(Tf||(Tf=wg(["Apagos"]))),"Apagos",Yoe,new Date("2021-11-04"),Mme.APAGOS()),new e($localize(If||(If=wg(["Diam"]))),"Diam",ice,new Date("2021-11-30"),Mme.DIAM()),new e($localize(Af||(Af=wg(["Brandhub"]))),"Brandhub",zse,new Date("2021-12-07"),Mme.BRANDHUB()),new e($localize(xf||(xf=wg(["Conspirateurs"]))),"Conspirateurs",Fue,new Date("2021-12-30"),Mme.CONSPIRATEURS()),new e($localize(Rf||(Rf=wg(["Lodestone"]))),"Lodestone",$fe,new Date("2022-06-24"),Mme.LODESTONE()),new e($localize(Mf||(Mf=wg(["Martian Chess"]))),"MartianChess",Ode,new Date("2022-07-01"),Mme.MARTIAN_CHESS())].sort(function(e,t){return e.name.localeCompare(t.name)})},e}(),Dme=function(){var e=function(){function e(){Wg(this,e),this.games=Nme.ALL_GAMES().filter(function(e){return!0===e.display}),this.pickGame=new gT}return jg(e,[{key:"onChange",value:function(e){this.pickGame.emit(e.target.value)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Gm({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){return[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],$localize(Nf||(Nf=wg(["Pick a game"]))),[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"select",1),uS("change",function(e){return t.onChange(e)}),eS(2,"option",2),WP(3,3),tS(),YE(4,Rme,2,2,"option",4),tS(),tS()),2&e&&(pb(4),XE("ngForOf",t.games))},directives:[aM,cM,LA],encapsulation:2}),e}();function Lme(e,t){if(1&e){var n=aS();eS(0,"div",26),eS(1,"div",27),uS("click",function(){return Nk(n),hS().closeInfo()}),tS(),eS(2,"div",28),eS(3,"header",29),eS(4,"p",30),FS(5),tS(),eS(6,"button",31),uS("click",function(){return Nk(n),hS().closeInfo()}),tS(),tS(),eS(7,"section",32),eS(8,"div",6),eS(9,"div",33),eS(10,"p",34),nS(11,"img",35),tS(),tS(),eS(12,"div",7),eS(13,"div",13),FS(14),tS(),tS(),tS(),eS(15,"div",6),eS(16,"div",33),eS(17,"a",36),uS("click",function(){Nk(n);var e=hS();return e.createGame(e.gameInfoDetails.get().urlName)}),nS(18,"fa-icon",37),FS(19,"\xa0"),eS(20,"span"),WP(21,38),tS(),tS(),tS(),eS(22,"div",33),eS(23,"a",36),uS("click",function(){Nk(n);var e=hS();return e.createLocalGame(e.gameInfoDetails.get().urlName)}),nS(24,"fa-icon",37),FS(25,"\xa0"),eS(26,"span"),WP(27,39),tS(),tS(),tS(),eS(28,"div",33),eS(29,"a",36),uS("click",function(){Nk(n);var e=hS();return e.createTutorial(e.gameInfoDetails.get().urlName)}),nS(30,"fa-icon",37),FS(31,"\xa0"),eS(32,"span"),WP(33,40),tS(),tS(),tS(),tS(),tS(),tS(),tS()}if(2&e){var r=hS();pb(5),US(r.gameInfoDetails.get().name),pb(6),vS("src","assets/images/",r.theme,"/",r.gameInfoDetails.get().urlName,".png",uw),pb(3),BS(" ",r.gameInfoDetails.get().description," "),pb(4),XE("icon",r.iconOnlineGame),pb(6),XE("icon",r.iconLocalGame),pb(6),XE("icon",r.iconTutorial)}}function Fme(e,t){if(1&e){var n=aS();eS(0,"div",8),eS(1,"div",9),eS(2,"p",10),FS(3),tS(),tS(),eS(4,"div",42),eS(5,"figure",34),eS(6,"img",43),uS("click",function(){var e=Nk(n).$implicit;return hS(2).openInfo(e)}),tS(),eS(7,"figcaption",44),uS("click",function(){var e=Nk(n).$implicit;return hS(2).openInfo(e)}),eS(8,"div",45),FS(9,"?"),tS(),tS(),eS(10,"figcaption",46),eS(11,"a",47),uS("click",function(){var e=Nk(n).$implicit;return hS(2).createGame(e.urlName)}),nS(12,"fa-icon",37),tS(),eS(13,"a",48),uS("click",function(){var e=Nk(n).$implicit;return hS(2).createLocalGame(e.urlName)}),nS(14,"fa-icon",37),tS(),eS(15,"a",49),uS("click",function(){var e=Nk(n).$implicit;return hS(2).createTutorial(e.urlName)}),nS(16,"fa-icon",37),tS(),tS(),tS(),tS(),eS(17,"div",50),FS(18),tS(),tS()}if(2&e){var r=t.$implicit,i=hS(2);pb(3),US(r.name),pb(3),dS("id","image_",r.urlName,""),vS("src","assets/images/",i.theme,"/",r.urlName,".png",uw),pb(5),dS("id","playOnline_",r.urlName,""),pb(1),XE("icon",i.iconOnlineGame),pb(1),dS("id","playLocally_",r.urlName,""),pb(1),XE("icon",i.iconLocalGame),pb(1),dS("id","startTutorial_",r.urlName,""),pb(1),XE("icon",i.iconTutorial),pb(2),BS(" ",r.description," ")}}function Ume(e,t){if(1&e&&(eS(0,"div",7),YE(1,Fme,19,11,"div",41),tS()),2&e){var n=t.$implicit;pb(1),XE("ngForOf",n)}}var Bme=function(){var e=function(){function e(t,n){Wg(this,e),this.router=t,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=Yre,this.iconLocalGame=jre,this.iconTutorial=Wre,this.gameInfoDetails=lV.empty(),this.theme=n.getTheme();for(var r=Nme.ALL_GAMES().filter(function(e){return!0===e.display}),i=0,a=0;a<r.length;a++)a<this.numberOfColumns&&this.games.push([]),this.games[i].push(r[a]),i=(i+1)%this.numberOfColumns}return jg(e,[{key:"createGame",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.router.navigate(["/play",e]));case 1:case"end":return n.stop()}},n)}))()}},{key:"createLocalGame",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.router.navigate(["/local",e]));case 1:case"end":return n.stop()}},n)}))()}},{key:"createTutorial",value:function(e){return this.router.navigate(["/tutorial",e])}},{key:"openInfo",value:function(e){this.gameInfoDetails=lV.of(e)}},{key:"closeInfo",value:function(){this.gameInfoDetails=lV.empty()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL),QE($re))},e.\u0275cmp=Gm({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){return[[1,"hero"],[1,"hero-body"],[1,"title"],$localize(Df||(Df=wg(["EveryBoard"]))),[1,"subtitle"],$localize(Lf||(Lf=wg(["EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.",":LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn."])),"\ufffd#6\ufffd\ufffd/#6\ufffd"),[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],$localize(Ff||(Ff=wg(["Play online"]))),[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],$localize(Uf||(Uf=wg(["Create an online game"]))),["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],$localize(Bf||(Bf=wg(["See the game list"]))),$localize(Vf||(Vf=wg(["Play offline"]))),[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],$localize(zf||(zf=wg(["Play"]))),["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],$localize(Hf||(Hf=wg(["Learn"]))),["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],$localize(Gf||(Gf=wg(["Play online"]))),$localize($f||($f=wg(["Play offline"]))),$localize(Wf||(Wf=wg(["Learn the rules"]))),["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",$localize(qf||(qf=wg(["Play online"]))),1,"button",3,"id","click"],["data-tooltip",$localize(jf||(jf=wg(["Play offline"]))),1,"button",3,"id","click"],["data-tooltip",$localize(Zf||(Zf=wg(["Learn the rules"]))),1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(eS(0,"section",0),eS(1,"div",1),eS(2,"p",2),WP(3,3),tS(),eS(4,"p",4),GP(5,5),nS(6,"br"),$P(),tS(),tS(),eS(7,"div",6),eS(8,"div",7),eS(9,"div",8),eS(10,"header",9),eS(11,"p",10),WP(12,11),tS(),tS(),eS(13,"div",12),eS(14,"div",13),eS(15,"button",14),WP(16,15),tS(),eS(17,"button",16),WP(18,17),tS(),tS(),tS(),tS(),tS(),eS(19,"div",7),eS(20,"div",8),eS(21,"header",9),eS(22,"p",10),WP(23,18),tS(),tS(),eS(24,"div",12),eS(25,"div",19),eS(26,"button",20),WP(27,21),tS(),eS(28,"button",22),WP(29,23),tS(),tS(),tS(),tS(),tS(),tS(),YE(30,Lme,34,7,"div",24),eS(31,"div",6),YE(32,Ume,2,1,"div",25),tS(),tS()),2&e&&(pb(30),XE("ngIf",t.gameInfoDetails.isPresent()),pb(2),XE("ngForOf",t.games))},directives:[YL,UA,LA,kae],encapsulation:2}),e}(),Vme=function(){var e=function(){function e(t){Wg(this,e),this.element=t}return jg(e,[{key:"ngAfterViewInit",value:function(){this.element.nativeElement.focus()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(uO))},e.\u0275dir=Ym({type:e,selectors:[["","autofocus",""]]}),e}(),zme=function(){var e=function(){function e(t){var n=this;Wg(this,e),this.shown=!1,this.input=t.nativeElement.parentNode.previousSibling,t.nativeElement.addEventListener("click",function(e){n.toggle()})}return jg(e,[{key:"toggle",value:function(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(uO))},e.\u0275dir=Ym({type:e,selectors:[["","toggleVisibility",""]]}),e}();function Hme(e,t){if(1&e&&(eS(0,"div",29),eS(1,"div",30),WP(2,31),tS(),eS(3,"div",32),FS(4),tS(),tS()),2&e){var n=hS();pb(4),US(n.errorMessage)}}var Gme=function(){return["/register"]},$me=function(){return["/reset-password"]},Wme=function(){var e=function(){function e(t,n){Wg(this,e),this.router=t,this.connectedUserService=n,this.faEye=Zre,this.loginForm=new BR({email:new UR,password:new UR})}return jg(e,[{key:"ngOnInit",value:function(){var e,t=this;this.connectedUserService.getUserObs().subscribe((e=iV(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n!==Ere.NOT_CONNECTED,!e.t0){e.next=4;break}return e.next=4,t.redirect();case 4:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}))}},{key:"loginWithEmail",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.connectedUserService.doEmailLogin(e.email,e.password);case 2:(r=n.sent).isFailure()&&(t.errorMessage=r.getReason());case 4:case"end":return n.stop()}},n)}))()}},{key:"loginWithGoogle",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.connectedUserService.doGoogleLogin();case 2:(n=t.sent).isFailure()&&(e.errorMessage=n.getReason());case 4:case"end":return t.stop()}},t)}))()}},{key:"redirect",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.router.navigate(["/lobby"]));case 1:case"end":return t.stop()}},t)}))()}},{key:"canLogin",value:function(){var e,t;return!(""===(null!==(e=this.loginForm.value.email)&&void 0!==e?e:"")||""===(null!==(t=this.loginForm.value.password)&&void 0!==t?t:""))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL),QE(Sre))},e.\u0275cmp=Gm({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){return[[1,"box"],[1,"title"],$localize(Yf||(Yf=wg(["Log in"]))),[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],$localize(Kf||(Kf=wg(["Email"]))),[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",$localize(Qf||(Qf=wg(["Email"]))),"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],$localize(Xf||(Xf=wg(["Password"]))),[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",$localize(Jf||(Jf=wg(["Password"]))),"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],$localize(ed||(ed=wg(["Log in"]))),["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],$localize(td||(td=wg(["Log in with Google"]))),["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],$localize(nd||(nd=wg(["No account?"]))),[3,"routerLink"],$localize(rd||(rd=wg(["Register"]))),$localize(id||(id=wg(["Forgot your password?"]))),$localize(ad||(ad=wg(["Reset your password"]))),["role","alert",1,"message","is-danger"],[1,"message-header"],$localize(od||(od=wg(["Connection error"]))),["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"p",1),WP(2,2),tS(),eS(3,"form",3),eS(4,"div",4),eS(5,"div",5),eS(6,"label",6),WP(7,7),tS(),tS(),eS(8,"div",8),eS(9,"div",9),eS(10,"div",10),nS(11,"input",11),tS(),tS(),tS(),tS(),eS(12,"div",4),eS(13,"div",5),eS(14,"label",12),WP(15,13),tS(),tS(),eS(16,"div",8),eS(17,"div",9),eS(18,"div",14),nS(19,"input",15),eS(20,"span",16),nS(21,"fa-icon",17),tS(),tS(),tS(),tS(),tS(),eS(22,"div",4),nS(23,"div",5),eS(24,"div",8),eS(25,"div",9),eS(26,"div",10),eS(27,"button",18),uS("click",function(){return t.loginWithEmail(t.loginForm.value)}),WP(28,19),tS(),tS(),tS(),tS(),tS(),eS(29,"div",4),nS(30,"div",5),eS(31,"div",8),eS(32,"div",9),eS(33,"div",10),eS(34,"button",20),uS("click",function(){return t.loginWithGoogle()}),WP(35,21),tS(),tS(),tS(),tS(),tS(),YE(36,Hme,5,1,"div",22),eS(37,"p",23),rS(38),WP(39,24),iS(),FS(40,"\xa0 "),eS(41,"a",25),WP(42,26),tS(),tS(),eS(43,"p",23),rS(44),WP(45,27),iS(),FS(46,"\xa0 "),eS(47,"a",25),WP(48,28),tS(),tS(),tS(),tS()),2&e&&(pb(3),XE("formGroup",t.loginForm),pb(18),XE("icon",t.faEye),pb(6),XE("disabled",!t.canLogin()),pb(9),XE("ngIf",t.errorMessage),pb(5),XE("routerLink",aT(6,Gme)),pb(6),XE("routerLink",aT(7,$me)))},directives:[jR,pR,JR,Ux,vR,tM,Vme,hM,kae,zme,UA,KL],encapsulation:2}),e}(),qme=function(){var e=function(){function e(t){Wg(this,e),this.partDAO=t,this.unsubscribe=lV.empty(),this.activePartsBS=new tN([]),this.activePartsObs=this.activePartsBS.asObservable()}return jg(e,[{key:"getActivePartsObs",value:function(){return this.activePartsObs}},{key:"startObserving",value:function(){var e=this;M7(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");var t=new V7(function(t){var n,r=(n=e.activePartsBS.value).concat.apply(n,Vg(t));e.activePartsBS.next(r)},function(t){var n,r=e.activePartsBS.value,i=Hg(t);try{var a=function(){var e=n.value;r.forEach(function(t){t.id===e.id&&(t.data=e.data)})};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}e.activePartsBS.next(r)},function(t){var n,r=[],i=Hg(e.activePartsBS.value);try{var a=function(){var e=n.value;t.some(function(t){return t.id===e.id})||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}e.activePartsBS.next(r)});this.unsubscribe=lV.of(this.partDAO.observeActiveParts(t))}},{key:"stopObserving",value:function(){M7(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=lV.empty()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(L7))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"any"}),e}(),jme=function(){var e=function(){function e(t){Wg(this,e),this.router=t}return jg(e,[{key:"pickGame",value:function(e){this.selectedGame=e}},{key:"navigateToOnlineGameCreation",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.router.navigate(["/play",e.selectedGame]);case 2:case"end":return t.stop()}},t)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL))},e.\u0275cmp=Gm({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){return[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],$localize(sd||(sd=wg(["Create an online game"])))]},template:function(e,t){1&e&&(eS(0,"app-pick-game",0),uS("pickGame",function(e){return t.pickGame(e)}),tS(),eS(1,"button",1),uS("click",function(){return t.navigateToOnlineGameCreation()}),WP(2,2),tS()),2&e&&(pb(1),XE("disabled",!t.selectedGame))},directives:[Dme],encapsulation:2}),e}(),Zme=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"transform",value:function(e){return pA(1e3*e.seconds,"HH:mm:ss","en-US")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=Km({name:"firebaseDate",type:e,pure:!0}),e}(),Yme=["chatDiv"];function Kme(e,t){1&e&&(rS(0),WP(1,5),iS())}function Qme(e,t){1&e&&WP(0,6),2&e&&(qP(hS().unreadMessagesText),jP(0))}function Xme(e,t){if(1&e){var n=aS();eS(0,"button",11),uS("click",function(){return Nk(n),hS(2).scrollToBottom()}),FS(1),tS()}if(2&e){var r=hS(2);pb(1),BS("",r.unreadMessagesText," \u2193")}}function Jme(e,t){if(1&e&&(eS(0,"p"),FS(1),hT(2,"firebaseDate"),eS(3,"b",12),FS(4),tS(),eS(5,"span",13),FS(6),tS(),tS()),2&e){var n=t.$implicit;pb(1),BS(" [",fT(2,3,n.postedTime),"] "),pb(3),BS("",n.sender.name," : "),pb(2),US(n.content)}}function eke(e,t){if(1&e){var n=aS();eS(0,"div"),YE(1,Xme,2,1,"button",7),eS(2,"div",8,9),uS("scroll",function(){return Nk(n),hS().updateCurrentScrollPosition()}),YE(4,Jme,7,5,"p",10),tS(),tS()}if(2&e){var r=hS();pb(1),XE("ngIf",r.showUnreadMessagesButton),pb(3),XE("ngForOf",r.chat)}}var tke=function(){return{standalone:!0}};function nke(e,t){if(1&e){var n=aS();eS(0,"form",14),uS("onSubmit",function(){return Nk(n),hS().sendMessage()}),eS(1,"div",15),eS(2,"div",16),eS(3,"input",17,18),uS("ngModelChange",function(e){return Nk(n),hS().userMessage=e}),tS(),eS(5,"p",19),FS(6),tS(),tS(),eS(7,"div",20),eS(8,"button",21),uS("click",function(){return Nk(n),hS().sendMessage()}),nS(9,"fa-icon",22),tS(),tS(),tS(),eS(10,"div",23),eS(11,"p"),eS(12,"strong"),WP(13,24),tS(),tS(),tS(),tS()}if(2&e){var r=KE(4),i=hS();pb(3),XE("ngModel",i.userMessage)("ngModelOptions",aT(4,tke)),pb(3),BS("",r.value.length,"/128"),pb(3),XE("icon",i.faReply)}}var rke=function(){var e=function(){function e(t,n){Wg(this,e),this.chatService=t,this.connectedUserService=n,this.userMessage="",this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=Kre,this.isNearBottom=!0,this.notYetScrolled=!0,oV(e.VERBOSE,"ChatComponent constructor")}return jg(e,[{key:"ngOnInit",value:function(){oV(e.VERBOSE,"ChatComponent.ngOnInit for chat ".concat(this.chatId)),M7(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.loadChatContent()}},{key:"ngAfterViewChecked",value:function(){this.scrollToBottomIfNeeded()}},{key:"loadChatContent",value:function(){var e=this,t=function(t){e.updateMessages(t.flatMap(function(e){return null==e.data.postedTime?[]:[e.data]}))},n=new V7(t,t,function(){});this.chatService.startObserving(this.chatId,n)}},{key:"updateMessages",value:function(e){this.chat=this.chat.concat(e);var t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}},{key:"updateUnreadMessagesText",value:function(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize(ud||(ud=wg(["no new message"]))),this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize(cd||(cd=wg(["1 new message"]))):$localize(ld||(ld=wg([""," new messages"])),e)}},{key:"scrollToBottomIfNeeded",value:function(){this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}},{key:"updateCurrentScrollPosition",value:function(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}},{key:"scrollToBottom",value:function(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}},{key:"scrollTo",value:function(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}},{key:"sendMessage",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userMessage,e.userMessage="",r=e.connectedUserService.user.get().toMinimalUser(),t.next=5,e.chatService.sendMessage(r,n,e.turn);case 5:case"end":return t.stop()}},t)}))()}},{key:"ngOnDestroy",value:function(){this.chatService.stopObserving()}},{key:"switchChatVisibility",value:function(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(B7),QE(Sre))},e.\u0275cmp=Gm({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){var n;(1&e&&IT(Yme,5),2&e)&&(TT(n=AT())&&(t.chatDiv=n.first))},inputs:{chatId:"chatId",turn:"turn"},decls:7,vars:4,consts:function(){return[["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],$localize(hd||(hd=wg(["Hide chat"]))),$localize(fd||(fd=wg(["Show chat (",":INTERPOLATION:)"])),"\ufffd0\ufffd"),["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],[1,"chat-sender"],[1,"chat-message"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",$localize(dd||(dd=wg(["Type your message here"]))),"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],[1,"clickable-icon",3,"icon"],[1,"content","is-small"],$localize(vd||(vd=wg(["Be polite"])))]},template:function(e,t){if(1&e&&(eS(0,"div"),eS(1,"button",0),uS("click",function(){return t.switchChatVisibility()}),YE(2,Kme,2,0,"ng-container",1),YE(3,Qme,1,1,"ng-template",null,2,RT),tS(),YE(5,eke,5,2,"div",3),YE(6,nke,14,5,"form",4),tS()),2&e){var n=KE(4);pb(2),XE("ngIf",t.visible)("ngIfElse",n),pb(3),XE("ngIf",t.visible),pb(1),XE("ngIf",t.visible)}},directives:[UA,LA,jR,pR,GR,Ux,dM,vR,qR,kae],pipes:[Zme],encapsulation:2}),e}();function ike(e,t){if(1&e&&(rS(0),FS(1),iS()),2&e){var n=hS().$implicit;pb(1),US(n.data.playerOne)}}function ake(e,t){1&e&&(rS(0),WP(1,26),iS())}function oke(e,t){if(1&e){var n=aS();eS(0,"tr",22),uS("click",function(){var e=Nk(n).$implicit;return hS(2).joinGame(e.id,e.data.typeGame)}),eS(1,"td",23),FS(2),tS(),eS(3,"td",23),FS(4),tS(),eS(5,"td",23),YE(6,ike,2,1,"ng-container",24),YE(7,ake,2,0,"ng-template",null,25,RT),tS(),eS(9,"td",23),FS(10),tS(),tS()}if(2&e){var r=t.$implicit,i=t.index,a=KE(8);dS("id","part_",i,""),pb(2),US(r.data.typeGame),pb(2),US(r.data.playerZero),pb(2),XE("ngIf",r.data.playerOne)("ngIfElse",a),pb(4),US(r.data.turn)}}function ske(e,t){if(1&e&&(eS(0,"div",13),eS(1,"div",14),eS(2,"table",15),eS(3,"thead"),eS(4,"tr"),eS(5,"th",16),WP(6,17),tS(),eS(7,"th",16),WP(8,18),tS(),eS(9,"th",16),WP(10,19),tS(),eS(11,"th",16),WP(12,20),tS(),tS(),tS(),eS(13,"tbody"),YE(14,oke,11,6,"tr",21),tS(),tS(),tS(),tS()),2&e){var n=hS();pb(14),XE("ngForOf",n.activeParts)}}function uke(e,t){1&e&&(eS(0,"div",27),nS(1,"app-online-game-selection",28),tS())}function cke(e,t){if(1&e&&(eS(0,"li",39),FS(1),hT(2,"firebaseDate"),tS()),2&e){var n=hS().$implicit;fS("id",n.data.username),pb(1),VS("",n.data.username,": ",fT(2,3,n.data.last_changed),"")}}function lke(e,t){if(1&e&&(rS(0),YE(1,cke,3,5,"li",38),iS()),2&e){var n=t.$implicit;pb(1),XE("ngIf",n.data.last_changed)}}function hke(e,t){if(1&e&&(eS(0,"div",29),eS(1,"div",30),eS(2,"div",31),nS(3,"app-chat",32),tS(),tS(),eS(4,"div",33),eS(5,"div",34),eS(6,"p"),WP(7,35),tS(),eS(8,"ul",36),YE(9,lke,2,1,"ng-container",37),tS(),tS(),tS(),tS()),2&e){var n=hS();pb(3),XE("turn",-1),pb(6),XE("ngForOf",n.activeUsers)}}var fke=function(){var e=function(){function e(t,n,r){Wg(this,e),this.router=t,this.userService=n,this.activePartsService=r,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}return jg(e,[{key:"ngOnInit",value:function(){var t=this;oV(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(function(e){t.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(function(e){t.activeParts=e})}},{key:"ngOnDestroy",value:function(){oV(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}},{key:"joinGame",value:function(e,t){var n=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.router.navigate(["/play",t,e]);case 2:case"end":return r.stop()}},r)}))()}},{key:"selectTab",value:function(e){this.currentTab=e}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(jL),QE(G7),QE(qme))},e.\u0275cmp=Gm({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){return[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],$localize(pd||(pd=wg(["Games"]))),["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],$localize(gd||(gd=wg(["Create"]))),["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],$localize(yd||(yd=wg(["Chat"]))),["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],$localize(md||(md=wg(["Game"]))),$localize(kd||(kd=wg(["First player"]))),$localize(_d||(_d=wg(["Second player"]))),$localize(Cd||(Cd=wg(["Turn"]))),[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],$localize(wd||(wd=wg(["Waiting for opponent"]))),["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-9"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3"],["id","onlineUsers",1,"box"],$localize(bd||(bd=wg(["Connected users:"]))),["id","activeUsersList"],[4,"ngFor","ngForOf"],[3,"id",4,"ngIf"],[3,"id"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"ul"),eS(2,"li",1),eS(3,"a",2),uS("click",function(){return t.selectTab("games")}),WP(4,3),tS(),tS(),eS(5,"li",4),eS(6,"a",5),uS("click",function(){return t.selectTab("create")}),WP(7,6),tS(),tS(),eS(8,"li",7),eS(9,"a",8),uS("click",function(){return t.selectTab("chat")}),WP(10,9),tS(),tS(),tS(),tS(),YE(11,ske,15,1,"div",10),YE(12,uke,2,0,"div",11),YE(13,hke,10,2,"div",12)),2&e&&(pb(11),XE("ngIf","games"===t.currentTab),pb(1),XE("ngIf","create"===t.currentTab),pb(1),XE("ngIf","chat"===t.currentTab))},directives:[NA,UA,LA,jme,rke],pipes:[Zme],encapsulation:2}),e}(),dke=function(){var e=jg(function e(t){var n;Wg(this,e),this.route=t,this.message=null!==(n=t.snapshot.paramMap.get("message"))&&void 0!==n?n:$localize(Ed||(Ed=wg(["This page does not exist."])))});return e.\u0275fac=function(t){return new(t||e)(QE(PD))},e.\u0275cmp=Gm({type:e,selectors:[["app-not-found"]],decls:5,vars:1,consts:function(){return[[1,"message","is-danger"],[1,"message-header"],$localize(Sd||(Sd=wg(["Not found"]))),[1,"message-body"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"div",1),WP(2,2),tS(),eS(3,"div",3),FS(4),tS(),tS()),2&e&&(pb(4),US(t.message))},encapsulation:2}),e}();function vke(e,t){}var pke=function(){var e=jg(function e(t){Wg(this,e),this.viewContainerRef=t,oV(e.VERBOSE,"GameIncluderComponent constructor")});return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(WO))},e.\u0275cmp=Gm({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&YE(0,vke,0,0,"ng-template")},encapsulation:2}),e}(),gke=function(){var e=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"NO_MATCHING_GAME",value:function(e){return $localize(Pd||(Pd=wg(["This game (",") does not exist."])),e)}}]),e}();return e.NOT_YOUR_TURN=function(){return $localize(Od||(Od=wg(["It is not your turn!"])))},e.NO_CLONING_FEATURE=function(){return $localize(Td||(Td=wg(["You cannot clone a game. This feature might be implemented later."])))},e}(),yke=function(){var e=function(){function e(t,n,r,i,a){Wg(this,e),this.componentFactoryResolver=t,this.actRoute=n,this.connectedUserService=r,this.router=i,this.messageDisplayer=a,this.players=[lV.empty(),lV.empty()],this.endGame=!1,oV(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}return jg(e,[{key:"getMatchingComponent",value:function(t){return oV(e.VERBOSE,"GameWrapper.getMatchingComponent"),lV.ofNullable(Nme.ALL_GAMES().find(function(e){return e.urlName===t})).map(function(e){return e.component})}},{key:"afterGameIncluderViewInit",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return oV(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit"),n.next=3,t.createGameComponent();case 3:return r=n.sent,n.abrupt("return",(r&&t.gameComponent.rules.setInitialBoard(),r));case 5:case"end":return n.stop()}},n)}))()}},{key:"createGameComponent",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(oV(e.VERBOSE,"GameWrapper.createGameComponent"),r=aV.getNonNullable(t.actRoute.snapshot.paramMap.get("compo")),!(i=t.getMatchingComponent(r)).isAbsent()){n.next=6;break}return n.next=5,t.router.navigate(["/notFound",gke.NO_MATCHING_GAME(r)],{skipLocationChange:!0});case 5:return n.abrupt("return",!1);case 6:return M7(null!=t.gameIncluder,"GameIncluder should be present"),a=t.componentFactoryResolver.resolveComponentFactory(i.get()),o=t.gameIncluder.viewContainerRef.createComponent(a),n.abrupt("return",(t.gameComponent=o.instance,t.gameComponent.chooseMove=function(e,n,r){return t.receiveValidMove(e,n,r)},t.gameComponent.canUserPlay=function(e){return t.onUserClick(e)},t.gameComponent.isPlayerTurn=function(){return t.isPlayerTurn()},t.gameComponent.cancelMoveOnWrapper=function(e){t.onCancelMove(e)},t.gameComponent.observerRole=t.observerRole,t.canPass=t.gameComponent.canPass,!0));case 9:case"end":return n.stop()}},n)}))()}},{key:"receiveValidMove",value:function(t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(oV(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),i.isPlayerTurn()){a.next=2;break}return a.abrupt("return",T7.failure(gke.NOT_YOUR_TURN()));case 2:if(!i.endGame){a.next=4;break}return a.abrupt("return",T7.failure($localize(Id||(Id=wg(["The game has ended."])))));case 4:if(!(o=i.gameComponent.rules.isLegal(t,n)).isFailure()){a.next=9;break}a.t0=(i.gameComponent.cancelMove(o.getReason()),T7.ofFallible(o)),a.next=14;break;case 9:return i.gameComponent.cancelMoveAttempt(),a.next=12,i.onLegalUserMove(t,r);case 12:oV(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),a.t0=T7.SUCCESS;case 14:return a.abrupt("return",a.t0);case 15:case"end":return a.stop()}},a)}))()}},{key:"onUserClick",value:function(e){if(this.observerRole===Mre.NONE.value){var t=gke.NO_CLONING_FEATURE();return T7.failure(t)}return this.isPlayerTurn()?T7.SUCCESS:T7.failure(gke.NOT_YOUR_TURN())}},{key:"onCancelMove",value:function(e){}},{key:"isPlayerTurn",value:function(){if(this.observerRole===Mre.NONE.value||null==this.gameComponent)return!1;var t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return oV(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}},{key:"getBoardHighlight",value:function(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}]),e}();return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(iO),QE(PD),QE(Sre),QE(jL),QE(x7))},e.\u0275cmp=Gm({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var n;(1&e&&IT(pke,5),2&e)&&(TT(n=AT())&&(t.gameIncluder=n.first))},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e}(),mke=function(){function e(t,n,r){Wg(this,e),this.added=t,this.modified=n,this.removed=r}return jg(e,[{key:"addNewKeys",value:function(e,t){var n,r=Hg(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;null!=t[i]&&(this.added[i]=t[i])}}catch(a){r.e(a)}finally{r.f()}}},{key:"addCommonKeys",value:function(e,t,n){var r,i=Hg(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.addCommonKey(a,n[a],t[a])}}catch(o){i.e(o)}finally{i.f()}}},{key:"addCommonKey",value:function(t,n,r){if(null==r)null!=n&&(this.removed[t]=n);else if(null==n)this.added[t]=r;else if(["string","boolean","number"].includes(typeof n))n!==r&&(this.modified[t]=r);else if(Array.isArray(n)){if(!Array.isArray(r))throw new Error("Thing should not change type");n.length===r.length?this.addCommonKeyList(t,n,r):this.modified[t]=r}else{M7("object"==typeof n,"ObjectDifference: expected JSON, but got a ".concat(typeof n," in ").concat(t)),M7("object"==typeof r,"ObjectDifference: expected JSON, but got a ".concat(typeof r," in ").concat(t));var i=e.from(n,r);i.countChanges()>0&&(this.modified[t]=i)}}},{key:"addCommonKeyList",value:function(t,n,r){for(var i=!0,a=0;i&&a<n.length;a++)typeof n[a]==typeof r[a]&&"object"==typeof n[a]?e.differs(n[a],r[a])&&(i=!1,this.modified[t]=r):n[a]!==r[a]&&(i=!1,this.modified[t]=r)}},{key:"addRemovedKeys",value:function(e,t){var n,r=Hg(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.removed[i]=t[i]}}catch(a){r.e(a)}finally{r.f()}}},{key:"countChanges",value:function(){var e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}},{key:"isPresent",value:function(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}],[{key:"from",value:function(t,n){var r=new e({},{},{});if(null==t)return r.added=Eg({},n),r;if(null==n)return r.removed=Eg({},t),r;var i=Object.keys(t),a=Object.keys(n),o=i.filter(function(e){return!1===a.includes(e)}),s=i.filter(function(e){return a.includes(e)}),u=a.filter(function(e){return!1===i.includes(e)});return r.addNewKeys(u,n),r.addCommonKeys(s,n,t),r.addRemovedKeys(o,t),r}},{key:"differs",value:function(t,n){return e.from(t,n).countChanges()>0}}]),e}();function kke(e){return 1e3*e.seconds+e.nanoseconds/1e6}function _ke(e,t){return kke(t)-kke(e)}function Cke(e){return by(function(t,n){By(e).subscribe(new Ey(n,function(){return n.complete()},iy)),!n.closed&&t.subscribe(n)})}var wke=function(){var e=function(){function e(){Wg(this,e)}return jg(e,[{key:"transform",value:function(e){var t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize(Ad||(Ad=wg([""," hours"])),r)):1===r&&i.push($localize(xd||(xd=wg(["1 hour"])))),n>1?i.push($localize(Rd||(Rd=wg([""," minutes"])),n)):1===n&&i.push($localize(Md||(Md=wg(["1 minute"])))),t>1?i.push($localize(Nd||(Nd=wg([""," seconds"])),t)):1===t&&i.push($localize(Dd||(Dd=wg(["1 second"])))),0===i.length)return $localize(Ld||(Ld=wg(["0 seconds"])));if(1===i.length)return i[0];var a=i.slice(0,-1).join(", "),o=i.slice(-1)[0];return $localize(Fd||(Fd=wg([""," and ",""])),a,o)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=Km({name:"humanDuration",type:e,pure:!0}),e}();function bke(e,t){if(1&e&&(rS(0),FS(1),iS()),2&e){var n=hS(3);pb(1),US(n.viewInfo.chosenOpponent)}}function Eke(e,t){1&e&&WP(0,44)}function Ske(e,t){if(1&e&&(eS(0,"div",45),eS(1,"div",8),eS(2,"label",46),rS(3),WP(4,47),iS(),eS(5,"output"),FS(6),hT(7,"humanDuration"),tS(),tS(),eS(8,"div",37),nS(9,"input",48),tS(),tS(),eS(10,"div",8),eS(11,"label",49),GP(12,50),nS(13,"output"),hT(14,"humanDuration"),$P(),tS(),eS(15,"div",37),nS(16,"input",51),tS(),tS(),tS()),2&e){var n=hS(3);pb(6),US(fT(7,2,n.viewInfo.maximalMoveDuration||0)),pb(8),qP(fT(14,4,n.viewInfo.totalPartDuration||0)),jP(12)}}function Pke(e,t){1&e&&(eS(0,"div"),GP(1,52),nS(2,"br"),$P(),tS())}function Oke(e,t){1&e&&(eS(0,"button",64),WP(1,65),tS())}function Tke(e,t){if(1&e){var n=aS();eS(0,"tr",60),uS("click",function(){var e=Nk(n).$implicit;return hS(4).selectOpponent(e)}),eS(1,"td",61),FS(2),tS(),eS(3,"td",62),YE(4,Oke,2,0,"button",63),tS(),tS()}if(2&e){var r=t.$implicit,i=hS(4);dS("id","presenceOf_",r,""),XE("ngClass",i.viewInfo.candidateClasses[r]),pb(1),XE("id",i.viewInfo.chosenOpponent===r?"selected_"+r:"candidate_"+r),pb(1),US(r),pb(2),XE("ngIf",i.viewInfo.chosenOpponent!==r)}}function Ike(e,t){if(1&e&&(rS(0),WP(1,53),iS(),eS(2,"div",54),eS(3,"table",55),eS(4,"thead"),eS(5,"tr"),eS(6,"th",56),WP(7,57),tS(),eS(8,"th",56),WP(9,58),tS(),tS(),tS(),eS(10,"tbody"),YE(11,Tke,5,5,"tr",59),tS(),tS(),tS()),2&e){var n=hS(3);pb(11),XE("ngForOf",n.viewInfo.candidates)}}function Ake(e,t){if(1&e){var n=aS();eS(0,"button",66),uS("click",function(){return Nk(n),hS(3).changeConfig()}),WP(1,67),tS()}}function xke(e,t){if(1&e){var n=aS();eS(0,"div"),eS(1,"h1",4),WP(2,5),tS(),eS(3,"form",6),eS(4,"fieldset",7),eS(5,"div",8),eS(6,"label",9),WP(7,10),tS(),eS(8,"div",11),eS(9,"button",12),uS("click",function(){return Nk(n),hS(2).selectFirstPlayer("RANDOM")}),WP(10,13),tS(),eS(11,"button",14),uS("click",function(){return Nk(n),hS(2).selectFirstPlayer("CREATOR")}),WP(12,15),tS(),eS(13,"button",16),uS("click",function(){return Nk(n),hS(2).selectFirstPlayer("CHOSEN_PLAYER")}),YE(14,bke,2,1,"ng-container",17),YE(15,Eke,1,0,"ng-template",null,18,RT),tS(),tS(),tS(),eS(17,"div",8),eS(18,"label",9),WP(19,19),tS(),eS(20,"div",11),eS(21,"div",20),uS("click",function(){return Nk(n),hS(2).selectPartType("STANDARD")}),eS(22,"div",21),eS(23,"span"),WP(24,22),tS(),tS(),eS(25,"div",23),eS(26,"div",24),eS(27,"div",25),eS(28,"p"),rS(29),WP(30,26),iS(),eS(31,"strong"),FS(32),hT(33,"humanDuration"),tS(),nS(34,"br"),rS(35),GP(36,27),nS(37,"strong"),hT(38,"humanDuration"),$P(),iS(),tS(),tS(),tS(),tS(),tS(),eS(39,"div",28),uS("click",function(){return Nk(n),hS(2).selectPartType("BLITZ")}),eS(40,"div",21),eS(41,"span"),WP(42,29),tS(),tS(),eS(43,"div",23),eS(44,"div",24),eS(45,"div",25),eS(46,"p"),rS(47),WP(48,30),iS(),eS(49,"strong"),FS(50),hT(51,"humanDuration"),tS(),nS(52,"br"),rS(53),GP(54,31),nS(55,"strong"),hT(56,"humanDuration"),$P(),iS(),tS(),tS(),tS(),tS(),tS(),eS(57,"button",32),uS("click",function(){return Nk(n),hS(2).selectPartType("CUSTOM")}),WP(58,33),tS(),tS(),tS(),YE(59,Ske,17,6,"div",34),eS(60,"div",8),eS(61,"label",35),WP(62,36),tS(),eS(63,"div",37),YE(64,Pke,3,0,"div",17),YE(65,Ike,12,1,"ng-template",null,38,RT),tS(),tS(),tS(),eS(67,"div",8),eS(68,"div",11),eS(69,"button",39),uS("click",function(){return Nk(n),hS(2).proposeConfig()}),WP(70,40),tS(),YE(71,Ake,2,0,"button",41),eS(72,"button",42),uS("click",function(){return Nk(n),hS(2).cancelGameCreation()}),WP(73,43),tS(),tS(),tS(),tS(),tS()}if(2&e){var r=KE(16),i=KE(66),a=hS(2);pb(3),XE("formGroup",a.configFormGroup),pb(1),XE("disabled",!a.viewInfo.canEditConfig),pb(5),XE("ngClass",a.viewInfo.firstPlayerClasses.RANDOM),pb(2),XE("ngClass",a.viewInfo.firstPlayerClasses.CREATOR),pb(2),XE("ngClass",a.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),pb(1),XE("ngIf",a.viewInfo.chosenOpponent)("ngIfElse",r),pb(7),XE("ngClass",a.viewInfo.partTypeClasses.STANDARD),pb(11),US(fT(33,19,a.partType.NORMAL_MOVE_DURATION)),pb(6),qP(fT(38,21,a.partType.NORMAL_PART_DURATION)),jP(36),pb(1),XE("ngClass",a.viewInfo.partTypeClasses.BLITZ),pb(11),US(fT(51,23,a.partType.BLITZ_MOVE_DURATION)),pb(6),qP(fT(56,25,a.partType.BLITZ_PART_DURATION)),jP(54),pb(1),XE("ngClass",a.viewInfo.partTypeClasses.CUSTOM),pb(2),XE("ngIf",a.viewInfo.showCustomTime),pb(5),XE("ngIf",0===a.viewInfo.candidates.length)("ngIfElse",i),pb(5),XE("disabled",!a.viewInfo.canProposeConfig),pb(2),XE("ngIf",a.viewInfo.canReviewConfig)}}function Rke(e,t){if(1&e&&(eS(0,"div",74),eS(1,"p"),GP(2,75),nS(3,"br"),$P(),tS(),tS()),2&e){var n=hS(3);pb(3),qP(n.viewInfo.creator),jP(2)}}function Mke(e,t){if(1&e&&(eS(0,"span"),WP(1,81),tS()),2&e){var n=hS(4);pb(1),qP(n.viewInfo.creator),jP(1)}}function Nke(e,t){1&e&&(eS(0,"span"),WP(1,82),tS())}function Dke(e,t){1&e&&(eS(0,"span"),WP(1,83),tS())}function Lke(e,t){if(1&e){var n=aS();eS(0,"div",74),eS(1,"p"),WP(2,76),tS(),eS(3,"ul"),eS(4,"li"),YE(5,Mke,2,1,"span",2),YE(6,Nke,2,0,"span",2),YE(7,Dke,2,0,"span",2),tS(),eS(8,"li"),GP(9,77),nS(10,"strong"),hT(11,"humanDuration"),$P(),tS(),eS(12,"li"),GP(13,78),nS(14,"strong"),hT(15,"humanDuration"),$P(),tS(),tS(),eS(16,"button",79),uS("click",function(){return Nk(n),hS(3).acceptConfig()}),WP(17,80),tS(),tS()}if(2&e){var r=hS(3);pb(2),qP(r.viewInfo.creator)(r.viewInfo.partTypeName),jP(2),pb(3),XE("ngIf","CREATOR"===r.viewInfo.firstPlayer),pb(1),XE("ngIf","CHOSEN_PLAYER"===r.viewInfo.firstPlayer),pb(1),XE("ngIf","RANDOM"===r.viewInfo.firstPlayer),pb(4),qP(fT(11,7,r.viewInfo.maximalMoveDuration||0)),jP(9),pb(4),qP(fT(15,9,r.viewInfo.totalPartDuration||0)),jP(13)}}function Fke(e,t){if(1&e&&(eS(0,"div"),eS(1,"div",68),eS(2,"div",69),eS(3,"p"),WP(4,70),tS(),tS(),eS(5,"div",71),YE(6,Rke,4,1,"div",72),YE(7,Lke,18,11,"ng-template",null,73,RT),tS(),tS(),tS()),2&e){var n=KE(8),r=hS(2);pb(6),XE("ngIf",r.viewInfo.creatorIsModifyingConfig)("ngIfElse",n)}}function Uke(e,t){if(1&e&&(rS(0),WP(1,86),iS()),2&e){var n=hS(3);pb(1),qP(n.viewInfo.creator),jP(1)}}function Bke(e,t){if(1&e&&WP(0,87),2&e){var n=hS(3);qP(n.viewInfo.creator)(n.viewInfo.chosenOpponent),jP(0)}}function Vke(e,t){if(1&e&&(eS(0,"div",68),eS(1,"div",69),eS(2,"p"),WP(3,84),tS(),tS(),eS(4,"div",71),eS(5,"p"),YE(6,Uke,2,1,"ng-container",17),YE(7,Bke,1,2,"ng-template",null,85,RT),tS(),tS(),tS()),2&e){var n=KE(8),r=hS(2);pb(6),XE("ngIf",r.viewInfo.creatorIsModifyingConfig)("ngIfElse",n)}}function zke(e,t){if(1&e&&(eS(0,"div",1),YE(1,xke,74,27,"div",2),YE(2,Fke,9,2,"div",2),YE(3,Vke,9,2,"div",3),tS()),2&e){var n=hS();pb(1),XE("ngIf",n.viewInfo.userIsCreator),pb(1),XE("ngIf",n.viewInfo.userIsChosenOpponent),pb(1),XE("ngIf",n.viewInfo.userIsObserver)}}var Hke=function(){function e(t,n,r,i,a,o,s,u){Wg(this,e),this.router=t,this.connectedUserService=n,this.gameService=r,this.joinerService=i,this.chatService=a,this.userService=o,this.formBuilder=s,this.messageDisplayer=u,this.partType=Ore,this.gameStartNotification=new gT,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.ngUnsubscribe=new _y,this.allUserInterval=lV.empty(),this.ownTokenInterval=lV.empty(),this.selfSubscription=function(){},this.allDocDeleted=!1,oV(e.VERBOSE,"PartCreationComponent constructed")}return jg(e,[{key:"ngOnInit",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return oV(e.VERBOSE,"PartCreationComponent.ngOnInit for "+t.connectedUserService.user.get().username.get()),t.checkInputs(),t.createForms(),r=t.connectedUserService.user.get().toMinimalUser(),n.next=4,t.joinerService.joinGame(t.partId,r);case 4:if(!(i=n.sent).isFailure()){n.next=10;break}a=i.getReason(),t.messageDisplayer.criticalMessage(a),n.next=18;break;case 10:return n.next=12,t.updateUserDocWithObservedPart();case 12:return n.next=14,t.startSendingPresenceTokens();case 14:t.gameExists=!0,t.subscribeToJoinerDoc(),t.subscribeToFormElements(),oV(e.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds");case 18:case"end":return n.stop()}},n)}))()}},{key:"checkInputs",value:function(){var e=this.connectedUserService.user;M7(e.isPresent()&&e.get()!==Ere.NOT_CONNECTED,"PartCreationComponent should not be created with an empty userName"),M7(""!==this.partId,"PartCreationComponent should not be created with an empty partId")}},{key:"createForms",value:function(){this.configFormGroup=this.formBuilder.group({firstPlayer:[Pre.RANDOM.value,$x.required],maximalMoveDuration:[Ore.NORMAL_MOVE_DURATION,$x.required],partType:["STANDARD",$x.required],totalPartDuration:[Ore.NORMAL_PART_DURATION,$x.required],chosenOpponent:["",$x.required]})}},{key:"updateUserDocWithObservedPart",value:function(){return oV(e.VERBOSE,"updateUserDocWithObservedPart of '"+this.partId+"'"),this.connectedUserService.updateObservedPart(this.partId)}},{key:"subscribeToJoinerDoc",value:function(){var e,t=this;this.joinerService.subscribeToChanges(this.partId,(e=iV(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onCurrentJoinerUpdate(n);case 2:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}))}},{key:"getForm",value:function(e){return aV.getNonNullable(this.configFormGroup.get(e))}},{key:"subscribeToFormElements",value:function(){var e=this;this.getForm("chosenOpponent").valueChanges.pipe(Cke(this.ngUnsubscribe)).subscribe(function(t){void 0!==e.viewInfo.chosenOpponent&&(e.viewInfo.candidateClasses[e.viewInfo.chosenOpponent]=[]),e.viewInfo.candidateClasses[t]=["is-selected"],e.viewInfo.chosenOpponent=t;var n=aV.getNonNullable(e.currentJoiner).partStatus;e.viewInfo.canProposeConfig=n!==Tre.CONFIG_PROPOSED.value&&""!==t}),this.getForm("partType").valueChanges.pipe(Cke(this.ngUnsubscribe)).subscribe(function(t){e.viewInfo.partTypeClasses[e.viewInfo.partType]=[],e.viewInfo.partTypeClasses[t]=["is-primary","is-selected"],e.viewInfo.partType=t,e.viewInfo.showCustomTime="CUSTOM"===t}),this.getForm("maximalMoveDuration").valueChanges.pipe(Cke(this.ngUnsubscribe)).subscribe(function(t){e.viewInfo.maximalMoveDuration=t}),this.getForm("totalPartDuration").valueChanges.pipe(Cke(this.ngUnsubscribe)).subscribe(function(t){e.viewInfo.totalPartDuration=t}),this.getForm("firstPlayer").valueChanges.pipe(Cke(this.ngUnsubscribe)).subscribe(function(t){e.viewInfo.firstPlayerClasses[e.viewInfo.firstPlayer]=[],e.viewInfo.firstPlayerClasses[t]=["is-primary","is-selected"],e.viewInfo.firstPlayer=t})}},{key:"updateViewInfo",value:function(){var e,t,n=aV.getNonNullable(this.currentJoiner),r=this.connectedUserService.user.get();switch(this.viewInfo.canReviewConfig=n.partStatus===Tre.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=n.partStatus!==Tre.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=r.id===n.creator.id,this.viewInfo.userIsChosenOpponent=r.id===(null===(e=n.chosenOpponent)||void 0===e?void 0:e.id),this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=n.partStatus!==Tre.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=n.creator.name,this.viewInfo.candidates=n.candidates.map(function(e){return e.name}),r.id===n.creator.id?this.setDataForCreator(n):(this.viewInfo.maximalMoveDuration=n.maximalMoveDuration,this.viewInfo.totalPartDuration=n.totalPartDuration,this.viewInfo.partType=n.partType,this.viewInfo.chosenOpponent=null===(t=n.chosenOpponent)||void 0===t?void 0:t.name,this.viewInfo.firstPlayer=n.firstPlayer),n.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize(Ud||(Ud=wg(["custom"])));break;case"BLITZ":this.viewInfo.partTypeName=$localize(Bd||(Bd=wg(["blitz"])));break;case"STANDARD":this.viewInfo.partTypeName=$localize(Vd||(Vd=wg(["standard"])))}}},{key:"setDataForCreator",value:function(e){var t,n,r,i;this.viewInfo.maximalMoveDuration=null!==(t=this.viewInfo.maximalMoveDuration)&&void 0!==t?t:e.maximalMoveDuration,this.viewInfo.totalPartDuration=null!==(n=this.viewInfo.totalPartDuration)&&void 0!==n?n:e.totalPartDuration;var a=this.viewInfo.chosenOpponent;null==a||""===a?a=null!==(r=null===(i=e.chosenOpponent)||void 0===i?void 0:i.name)&&void 0!==r?r:"":!1===e.candidates.some(function(e){return e.name===a})&&(a=""),this.getForm("chosenOpponent").setValue(a)}},{key:"selectFirstPlayer",value:function(e){this.getForm("firstPlayer").setValue(e)}},{key:"selectPartType",value:function(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue(Ore.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue(Ore.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue(Ore.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue(Ore.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}},{key:"selectOpponent",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return oV(e.VERBOSE,"PartCreationComponent.setChosenOpponent("+t+")"),i=n.getUserFromName(t),r.abrupt("return",n.joinerService.setChosenOpponent(i));case 3:case"end":return r.stop()}},r)}))()}},{key:"getUserFromName",value:function(e){var t=aV.getNonNullable(this.currentJoiner).candidates.find(function(t){return t.name===e});return aV.getNonNullable(t)}},{key:"changeConfig",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.joinerService.reviewConfig());case 1:case"end":return t.stop()}},t)}))()}},{key:"proposeConfig",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getForm("chosenOpponent").value,r=e.getForm("partType").value,i=e.getForm("maximalMoveDuration").value,a=e.getForm("firstPlayer").value,o=e.getForm("totalPartDuration").value,s=e.getUserFromName(n),t.abrupt("return",e.joinerService.proposeConfig(s,Ore.of(r),i,Pre.of(a),o));case 2:case"end":return t.stop()}},t)}))()}},{key:"cancelGameCreation",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.allDocDeleted=!0,n.next=3,t.connectedUserService.removeObservedPart();case 3:return oV(e.VERBOSE,"PartCreationComponent.cancelGameCreation"),n.next=6,t.chatService.deleteChat(t.partId);case 6:return oV(e.VERBOSE,"PartCreationComponent.cancelGameCreation: chat deleted"),n.next=9,t.joinerService.deleteJoiner();case 9:return oV(e.VERBOSE,"PartCreationComponent.cancelGameCreation: chat and joiner deleted"),n.next=12,t.gameService.deletePart(t.partId);case 12:oV(e.VERBOSE,"PartCreationComponent.cancelGameCreation: chat, joiner, and part deleted");case 13:case"end":return n.stop()}},n)}))()}},{key:"onCurrentJoinerUpdate",value:function(t){var n=this;return iV(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(e.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(n.currentJoiner),then:JSON.stringify(t)}}),!t.isAbsent()){r.next=2;break}return r.abrupt("return",(oV(e.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),n.onGameCancelled()));case 2:if(n.chosenOpponentJustLeft(t.get())&&(i=aV.getNonNullable(n.currentJoiner),a=aV.getNonNullable(i.chosenOpponent).name,n.messageDisplayer.infoMessage($localize(zd||(zd=wg([""," left the game, please pick another opponent."])),a))),n.currentJoiner=t.get(),r.t0=n.allUserInterval.isAbsent(),!r.t0){r.next=8;break}return r.next=8,n.observeNeededPlayers();case 8:n.updateViewInfo(),n.isGameStarted()&&(oV(e.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),n.onGameStarted());case 10:case"end":return r.stop()}},r)}))()}},{key:"chosenOpponentJustLeft",value:function(e){return null!=this.currentJoiner&&null!=this.currentJoiner.chosenOpponent&&null==e.chosenOpponent}},{key:"onGameCancelled",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return oV(e.VERBOSE,"PartCreationComponent.onGameCancelled"),t.messageDisplayer.infoMessage($localize(Hd||(Hd=wg(["The game has been canceled!"])))),n.next=4,t.router.navigate(["/lobby"]);case 4:case"end":return n.stop()}},n)}))()}},{key:"isGameStarted",value:function(){return aV.getNonNullable(this.currentJoiner).partStatus===Tre.PART_STARTED.value}},{key:"onGameStarted",value:function(){var t=aV.getNonNullable(this.currentJoiner);oV(e.VERBOSE,{partCreationComponent_onGameStarted:{joiner:t}}),this.gameStartNotification.emit(t),this.gameStarted=!0,oV(e.VERBOSE,"PartCreationComponent.onGameStarted finished")}},{key:"observeNeededPlayers",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=aV.getNonNullable(t.currentJoiner),i=t.connectedUserService.user.get().id,oV(e.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:r}}),t.allUserInterval=lV.of(window.setInterval(iV(regeneratorRuntime.mark(function e(){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=aV.getNonNullable(t.currentJoiner),r=t.lastToken,i!==n.creator.id){e.next=6;break}return e.next=4,t.checkCandidatesTokensFreshness(r);case 4:e.next=8;break;case 6:return e.next=8,t.checkCreatorTokenFreshness(r);case 8:case"end":return e.stop()}},e)})),e.TOKEN_INTERVAL));case 2:case"end":return n.stop()}},n)}))()}},{key:"checkCreatorTokenFreshness",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=aV.getNonNullable(t.currentJoiner),n.next=3,t.didUserTimeout(r.creator.id,e);case 3:if(n.t0=n.sent,!n.t0){n.next=7;break}return n.next=7,t.destroyDocIfPartDidNotStart();case 7:case"end":return n.stop()}},n)}))()}},{key:"destroyDocIfPartDidNotStart",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(0==(aV.getNonNullable(e.currentJoiner).partStatus===Tre.PART_STARTED.value),"Should not try to cancelGameCreation when part started!"),M7(!1===e.allDocDeleted,"Should not delete doc twice"),t.next=4,e.cancelGameCreation();case 4:case"end":return t.stop()}},t)}))()}},{key:"checkCandidatesTokensFreshness",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=aV.getNonNullable(t.currentJoiner),i=Hg(r.candidates),n.prev=2,i.s();case 4:if((a=i.n()).done){n.next=14;break}return o=a.value,n.next=8,t.didUserTimeout(o.id,e);case 8:if(n.t0=n.sent,!n.t0){n.next=12;break}return n.next=12,t.removeCandidateFromLobby(o.id);case 12:n.next=4;break;case 14:n.next=19;break;case 16:n.prev=16,n.t1=n.catch(2),i.e(n.t1);case 19:return n.prev=19,i.f(),n.finish(19);case 22:case"end":return n.stop()}},n,null,[[2,16,19,22]])}))()}},{key:"didUserTimeout",value:function(t,n){var r=this;return iV(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.userService.getUserLastChanged(t);case 2:return a=i.sent,i.abrupt("return",a.isAbsent()?(R7.logError("PartCreationComponent","found no user while observing "+t+" !"),!0):_ke(a.get(),n)>e.TOKEN_TIMEOUT);case 4:case"end":return i.stop()}},i)}))()}},{key:"startSendingPresenceTokens",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.connectedUserService.sendPresenceToken();case 2:M7(t.ownTokenInterval.isAbsent(),"should not start sending presence tokens twice"),t.ownTokenInterval=lV.of(window.setInterval(function(){t.connectedUserService.sendPresenceToken()},e.TOKEN_INTERVAL)),r=t.connectedUserService.user.get().id,t.selfSubscription=t.userService.observeUser(r,function(e){M7(e.isPresent(),"connected user should exist");var n=e.get();null!=n.last_changed&&(t.lastToken=n.last_changed)});case 6:case"end":return n.stop()}},n)}))()}},{key:"stopSendingPresenceTokensAndObservingUsersIfNeeded",value:function(){this.ownTokenInterval.isPresent()&&(window.clearInterval(this.ownTokenInterval.get()),this.ownTokenInterval=lV.empty()),this.allUserInterval.isPresent()&&window.clearInterval(this.allUserInterval.get()),this.selfSubscription()}},{key:"removeCandidateFromLobby",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return M7(-1!==(i=aV.getNonNullable(t.currentJoiner)).candidates.findIndex(function(t){return t.id===e}),"PartCreationComponent: attempting to remove a user not in the lobby"),a=i.candidates.filter(function(t){return t.id!==e}),n.abrupt("return",(null===(r=i.chosenOpponent)||void 0===r?void 0:r.id)===e?t.joinerService.reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(a):t.joinerService.updateCandidates(a));case 4:case"end":return n.stop()}},n)}))()}},{key:"acceptConfig",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(oV(e.VERBOSE,"PartCreationComponent.acceptConfig"),t.gameService.acceptConfig(t.partId,aV.getNonNullable(t.currentJoiner))));case 1:case"end":return n.stop()}},n)}))()}},{key:"ngOnDestroy",value:function(){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(oV(e.VERBOSE,"PartCreationComponent.ngOnDestroy"),t.ngUnsubscribe.next(),t.ngUnsubscribe.complete(),t.stopSendingPresenceTokensAndObservingUsersIfNeeded(),t.gameExists&&t.joinerService.unsubscribe(),r=t.connectedUserService.user.get(),!0===t.gameStarted){n.next=18;break}if(null!==t.currentJoiner){n.next=5;break}return n.abrupt("return",void oV(e.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here"));case 5:if(r.id!==t.currentJoiner.creator.id){n.next=11;break}return oV(e.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),n.next=9,t.cancelGameCreation();case 9:n.next=18;break;case 11:if(n.t0=!1===t.allDocDeleted,!n.t0){n.next=18;break}return oV(e.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),n.next=16,t.connectedUserService.removeObservedPart();case 16:return n.next=18,t.joinerService.cancelJoining(r.toMinimalUser());case 18:case"end":return n.stop()}},n)}))()}}]),e}();function Gke(e,t){if(1&e){var n=aS();eS(0,"button",3),uS("click",function(){return Nk(n),hS().addTime()}),WP(1,4),tS()}if(2&e){var r=hS();pb(1),qP(r.timeToAdd),jP(1)}}Hke.VERBOSE=!1,Hke.TOKEN_INTERVAL=5e3,Hke.TOKEN_TIMEOUT=2*Hke.TOKEN_INTERVAL,Hke.\u0275fac=function(e){return new(e||Hke)(QE(jL),QE(Sre),QE(zre),QE(Vre),QE(B7),QE(G7),QE(yM),QE(x7))},Hke.\u0275cmp=Gm({type:Hke,selectors:[["app-part-creation"]],inputs:{partId:"partId"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){return[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],$localize(Gd||(Gd=wg(["Game creation"]))),[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],$localize($d||($d=wg(["First player"]))),[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],$localize(Wd||(Wd=wg(["Random"]))),["id","firstPlayerCreator",1,"button",3,"ngClass","click"],$localize(qd||(qd=wg(["You"]))),["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],$localize(jd||(jd=wg(["Game type"]))),["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],$localize(Zd||(Zd=wg(["Standard"]))),["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],$localize(Yd||(Yd=wg(["Maximal turn duration: "]))),$localize(Kd||(Kd=wg(["Maximal game duration: ",":START_TAG_STRONG:",":INTERPOLATION: per player",":CLOSE_TAG_STRONG:"])),"\ufffd#37\ufffd","\ufffd0\ufffd","\ufffd/#37\ufffd"),["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],$localize(Qd||(Qd=wg(["Blitz"]))),$localize(Xd||(Xd=wg(["Maximal turn duration: "]))),$localize(Jd||(Jd=wg(["Maximal game duration: ",":START_TAG_STRONG:",":INTERPOLATION: per player",":CLOSE_TAG_STRONG:"])),"\ufffd#55\ufffd","\ufffd0\ufffd","\ufffd/#55\ufffd"),["id","partTypeCustom",1,"button",3,"ngClass","click"],$localize(ev||(ev=wg(["Custom"]))),["id","customTime",4,"ngIf"],[1,"label"],$localize(tv||(tv=wg(["Opponents"]))),[1,"control"],["chooseOpponent",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],$localize(nv||(nv=wg(["Propose configuration"]))),["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],$localize(rv||(rv=wg(["Cancel game"]))),$localize(iv||(iv=wg(["The opponent"]))),["id","customTime"],["for","maximalMoveDuration",1,"label"],$localize(av||(av=wg(["Maximal turn duration: "]))),["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],$localize(ov||(ov=wg(["Maximal game duration: ",":START_TAG_OUTPUT:",":INTERPOLATION: per player",":CLOSE_TAG_OUTPUT:"])),"\ufffd#13\ufffd","\ufffd0\ufffd","\ufffd/#13\ufffd"),["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],$localize(sv||(sv=wg(["Potential opponents that join the game will appear here.",":LINE_BREAK:Wait for an opponent to join, so that you can pick one."])),"\ufffd#2\ufffd\ufffd/#2\ufffd"),$localize(uv||(uv=wg(["Click on the opponent against which you would like to play."]))),["id","chooseOpponent",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],$localize(cv||(cv=wg(["Name"]))),$localize(lv||(lv=wg(["Actions"]))),[3,"id","ngClass","click",4,"ngFor","ngForOf"],[3,"id","ngClass","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],$localize(hv||(hv=wg(["Pick"]))),["id","reviewConfig",1,"button",3,"click"],$localize(fv||(fv=wg(["Change configuration"]))),[1,"message","is-primary"],[1,"message-header"],$localize(dv||(dv=wg(["Configuration proposal"]))),[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],$localize(vv||(vv=wg(["You have been selected as the opponent.",":LINE_BREAK: ",":INTERPOLATION: is modifying the configuration."])),"\ufffd#3\ufffd\ufffd/#3\ufffd","\ufffd0\ufffd"),$localize(pv||(pv=wg(["",":INTERPOLATION: proposes to play a ",":INTERPOLATION_1: game"])),"\ufffd0\ufffd","\ufffd1\ufffd"),$localize(gv||(gv=wg(["a turn lasts at most ",":START_TAG_STRONG:",":INTERPOLATION: ",":CLOSE_TAG_STRONG:"])),"\ufffd#10\ufffd","\ufffd0\ufffd","\ufffd/#10\ufffd"),$localize(yv||(yv=wg(["the game lasts at most ",":START_TAG_STRONG:",":INTERPOLATION: per player",":CLOSE_TAG_STRONG:"])),"\ufffd#14\ufffd","\ufffd0\ufffd","\ufffd/#14\ufffd"),["id","acceptConfig",1,"button","is-primary",3,"click"],$localize(mv||(mv=wg(["Accept and start"]))),$localize(kv||(kv=wg(["",":INTERPOLATION: plays first"])),"\ufffd0\ufffd"),$localize(_v||(_v=wg(["you play first"]))),$localize(Cv||(Cv=wg(["the first player is selected randomly"]))),$localize(wv||(wv=wg(["One moment..."]))),["proposalSent",""],$localize(bv||(bv=wg(["",":INTERPOLATION: is configuring the game."])),"\ufffd0\ufffd"),$localize(Ev||(Ev=wg(["",":INTERPOLATION: has proposed a configuration to ",":INTERPOLATION_1:."])),"\ufffd0\ufffd","\ufffd1\ufffd")]},template:function(e,t){1&e&&YE(0,zke,4,3,"div",0),2&e&&XE("ngIf",t.viewInfo)},directives:[UA,jR,pR,JR,NA,Ux,KR,vR,tM,LA],pipes:[wke],encapsulation:2});var $ke=function(){var e=function(){function e(){Wg(this,e),this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new gT,this.addTimeToOpponent=new gT,this.cssClasses=e.SAFE_TIME}return jg(e,[{key:"ngOnInit",value:function(){oV(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}},{key:"setDuration",value:function(t){if(oV(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}},{key:"changeDuration",value:function(e){var t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}},{key:"displayDuration",value:function(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}},{key:"start",value:function(){if(oV(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}},{key:"resume",value:function(){var t=this;if(oV(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();var n=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(function(){t.onEndReached()},n),this.countSeconds()}},{key:"onEndReached",value:function(){oV(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}},{key:"countSeconds",value:function(){var e=this;this.timeoutHandleSec=window.setTimeout(function(){e.updateShownTime()},1e3)}},{key:"isIdle",value:function(){return!1===this.started||this.isPaused}},{key:"pause",value:function(){if(oV(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}},{key:"stop",value:function(){if(oV(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}},{key:"isStarted",value:function(){return this.started}},{key:"getTimeClass",value:function(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}},{key:"updateShownTime",value:function(){var e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}},{key:"clearTimeouts",value:function(){oV(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(window.clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(window.clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}},{key:"addTime",value:function(){this.addTimeToOpponent.emit()}},{key:"ngOnDestroy",value:function(){this.clearTimeouts()}}]),e}();return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Gm({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){return[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],$localize(Sv||(Sv=wg(["Add ",":INTERPOLATION:"])),"\ufffd0\ufffd")]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"p",1),FS(2),hT(3,"number"),tS(),YE(4,Gke,2,1,"button",2),tS()),2&e&&(XE("ngClass",t.getTimeClass()),pb(2),VS("",t.displayedMinute,":",function(e,t,n,r){var i=Rk(),a=bk(i,23);return vT(i,dT(i,23)?lT(i,Gk(),4,a.transform,n,r,a):a.transform(n,r))}(0,0,t.displayedSec,"2.0-0"),""),pb(2),XE("ngIf",t.canAddTime))},directives:[NA,UA],pipes:[zA],encapsulation:2}),e}(),Wke=["partCreation"],qke=["chatComponent"],jke=["chronoZeroGlobal"],Zke=["chronoOneGlobal"],Yke=["chronoZeroTurn"],Kke=["chronoOneTurn"];function Qke(e,t){if(1&e){var n=aS();eS(0,"app-part-creation",5,6),uS("gameStartNotification",function(e){return Nk(n),hS().startGame(e)}),tS()}2&e&&XE("partId",hS().currentPartId)}function Xke(e,t){1&e&&(rS(0),WP(1,40),iS())}function Jke(e,t){if(1&e&&(rS(0),WP(1,41),iS()),2&e){var n=hS(4);pb(1),qP(n.currentPlayer),jP(1)}}function e_e(e,t){if(1&e&&(eS(0,"p",37),YE(1,Xke,2,0,"ng-container",38),YE(2,Jke,2,1,"ng-template",null,39,RT),tS()),2&e){var n=KE(3),r=hS(3);pb(1),XE("ngIf",r.currentPlayer===r.getPlayerName())("ngIfElse",n)}}function t_e(e,t){if(1&e&&(eS(0,"div",33),eS(1,"p",34),WP(2,35),tS(),YE(3,e_e,4,2,"p",36),tS()),2&e){var n=hS(2);pb(2),qP(n.currentPart.getTurn()+1),jP(2),pb(1),XE("ngIf",!1===n.endGame)}}function n_e(e,t){if(1&e&&(eS(0,"p",42),FS(1),tS()),2&e){var n=hS(2);XE("ngClass",n.getPlayerNameClass(0)),pb(1),US(n.players[0].get())}}function r_e(e,t){if(1&e&&(eS(0,"p",43),WP(1,44),tS()),2&e){var n=hS(2);pb(1),qP(n.gameComponent.scores.get()[0]),jP(1)}}function i_e(e,t){if(1&e&&(eS(0,"p",45),FS(1),tS()),2&e){var n=hS(2);XE("ngClass",n.getPlayerNameClass(1)),pb(1),US(n.players[1].get())}}function a_e(e,t){if(1&e&&(eS(0,"p",46),WP(1,47),tS()),2&e){var n=hS(2);pb(1),qP(n.gameComponent.scores.get()[1]),jP(1)}}function o_e(e,t){if(1&e){var n=aS();eS(0,"button",56),uS("click",function(){return Nk(n),hS(3).resign()}),WP(1,57),tS()}}function s_e(e,t){if(1&e){var n=aS();eS(0,"button",58),uS("click",function(){return Nk(n),hS(3).proposeDraw()}),WP(1,59),tS()}}function u_e(e,t){if(1&e){var n=aS();eS(0,"button",60),uS("click",function(){return Nk(n),hS(3).acceptDraw()}),WP(1,61),tS()}}function c_e(e,t){if(1&e){var n=aS();eS(0,"button",62),uS("click",function(){return Nk(n),hS(3).refuseDraw()}),WP(1,63),tS()}}function l_e(e,t){if(1&e){var n=aS();eS(0,"button",64),uS("click",function(){return Nk(n),hS(3).gameComponent.pass()}),WP(1,65),tS()}}function h_e(e,t){if(1&e){var n=aS();eS(0,"button",66),uS("click",function(){return Nk(n),hS(3).acceptTakeBack()}),WP(1,67),tS()}}function f_e(e,t){if(1&e){var n=aS();eS(0,"button",68),uS("click",function(){return Nk(n),hS(3).refuseTakeBack()}),WP(1,69),tS()}}function d_e(e,t){if(1&e){var n=aS();eS(0,"button",70),uS("click",function(){return Nk(n),hS(3).askTakeBack()}),WP(1,71),tS()}}function v_e(e,t){if(1&e&&(rS(0),YE(1,o_e,2,0,"button",48),YE(2,s_e,2,0,"button",49),YE(3,u_e,2,0,"button",50),YE(4,c_e,2,0,"button",51),YE(5,l_e,2,0,"button",52),YE(6,h_e,2,0,"button",53),YE(7,f_e,2,0,"button",54),YE(8,d_e,2,0,"button",55),iS()),2&e){var n=hS(2);pb(1),XE("ngIf",n.canResign()),pb(1),XE("ngIf",n.canProposeDraw()),pb(1),XE("ngIf",!1===n.endGame&&n.isOpponentWaitingForDrawResponse()),pb(1),XE("ngIf",!1===n.endGame&&n.isOpponentWaitingForDrawResponse()),pb(1),XE("ngIf",!1===n.endGame&&n.isPlaying()&&n.gameComponent.canPass&&n.currentPlayer===n.getPlayerName()),pb(1),XE("ngIf",!1===n.endGame&&n.isOpponentWaitingForTakeBackResponse()),pb(1),XE("ngIf",!1===n.endGame&&n.isOpponentWaitingForTakeBackResponse()),pb(1),XE("ngIf",!1===n.endGame&&!1===n.isOpponentWaitingForTakeBackResponse()&&n.canAskTakeBack())}}function p_e(e,t){1&e&&(eS(0,"div"),eS(1,"p",73),WP(2,74),tS(),tS())}function g_e(e,t){1&e&&(eS(0,"p",78),WP(1,79),tS())}function y_e(e,t){1&e&&(eS(0,"p",80),WP(1,81),tS())}function m_e(e,t){1&e&&(eS(0,"p",82),WP(1,83),tS())}function k_e(e,t){if(1&e&&(eS(0,"div"),YE(1,g_e,2,0,"p",75),YE(2,y_e,2,0,"p",76),YE(3,m_e,2,0,"p",77),tS()),2&e){var n=hS(3);pb(1),XE("ngIf",n.currentPart.getDrawAccepter()===n.getPlayerName()),pb(1),XE("ngIf",n.currentPart.getDrawAccepter()!==n.getPlayerName()&&n.isPlaying()),pb(1),XE("ngIf",!1===n.isPlaying())}}function __e(e,t){1&e&&(eS(0,"p",86),WP(1,87),tS())}function C_e(e,t){1&e&&(eS(0,"p",88),WP(1,89),tS())}function w_e(e,t){if(1&e&&(eS(0,"p",88),WP(1,90),tS()),2&e){var n=hS(4);pb(1),qP(n.currentPart.getWinner().get()),jP(1)}}function b_e(e,t){if(1&e&&(eS(0,"div"),YE(1,__e,2,0,"p",84),YE(2,C_e,2,0,"p",85),YE(3,w_e,2,1,"p",85),tS()),2&e){var n=hS(3);pb(1),XE("ngIf",n.currentPart.getWinner().get()===n.getPlayerName()),pb(1),XE("ngIf",n.currentPart.getWinner().get()!==n.getPlayerName()&&n.isPlaying()),pb(1),XE("ngIf",!1===n.isPlaying())}}function E_e(e,t){if(1&e&&(eS(0,"p",86),WP(1,91),tS()),2&e){var n=hS(4);pb(1),qP(n.currentPart.getLoser().get()),jP(1)}}function S_e(e,t){1&e&&(eS(0,"p",88),WP(1,92),tS())}function P_e(e,t){if(1&e&&(eS(0,"p",88),WP(1,93),tS()),2&e){var n=hS(4);pb(1),qP(n.currentPart.getLoser().get()),jP(1)}}function O_e(e,t){if(1&e&&(eS(0,"div"),YE(1,E_e,2,1,"p",84),YE(2,S_e,2,0,"p",85),YE(3,P_e,2,1,"p",85),tS()),2&e){var n=hS(3);pb(1),XE("ngIf",n.currentPart.getWinner().get()===n.getPlayerName()),pb(1),XE("ngIf",n.currentPart.getWinner().get()!==n.getPlayerName()&&n.isPlaying()),pb(1),XE("ngIf",!1===n.isPlaying())}}function T_e(e,t){1&e&&(eS(0,"p",95),WP(1,96),tS())}function I_e(e,t){if(1&e&&(eS(0,"p",95),WP(1,97),tS()),2&e){var n=hS(4);pb(1),qP(n.currentPart.getLoser().get()),jP(1)}}function A_e(e,t){if(1&e&&(eS(0,"div"),YE(1,T_e,2,0,"p",94),YE(2,I_e,2,1,"p",94),tS()),2&e){var n=hS(3);pb(1),XE("ngIf",n.currentPart.getWinner().get()!==n.getPlayerName()&&n.isPlaying()),pb(1),XE("ngIf",!1===n.isPlaying()||n.currentPart.getWinner().get()===n.getPlayerName())}}function x_e(e,t){if(1&e&&(eS(0,"div",72),nS(1,"hr"),YE(2,p_e,3,0,"div",26),YE(3,k_e,4,3,"div",26),YE(4,b_e,4,3,"div",26),YE(5,O_e,4,3,"div",26),YE(6,A_e,3,2,"div",26),tS()),2&e){var n=hS(2);pb(2),XE("ngIf",n.currentPart.isHardDraw()),pb(1),XE("ngIf",n.currentPart.isAgreedDraw()),pb(1),XE("ngIf",n.currentPart.isWin()),pb(1),XE("ngIf",n.currentPart.isTimeout()),pb(1),XE("ngIf",n.currentPart.isResign())}}function R_e(e,t){1&e&&(eS(0,"button",98),WP(1,99),tS())}function M_e(e,t){if(1&e){var n=aS();eS(0,"button",100),uS("click",function(){return Nk(n),hS(2).proposeRematch()}),WP(1,101),tS()}}function N_e(e,t){if(1&e){var n=aS();eS(0,"button",102),uS("click",function(){return Nk(n),hS(2).acceptRematch()}),WP(1,103),tS()}}function D_e(e,t){if(1&e){var n=aS();eS(0,"div",7),eS(1,"div",8),eS(2,"div",9),YE(3,t_e,4,2,"div",10),eS(4,"div",11),YE(5,n_e,2,2,"p",12),YE(6,r_e,2,1,"p",13),eS(7,"app-count-down",14,15),uS("outOfTimeAction",function(){return Nk(n),hS().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Nk(n),hS().addGlobalTime()}),tS(),eS(9,"app-count-down",16,17),uS("outOfTimeAction",function(){return Nk(n),hS().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Nk(n),hS().addTurnTime()}),tS(),tS(),eS(11,"p",18),WP(12,19),tS(),eS(13,"div",11),YE(14,i_e,2,2,"p",20),YE(15,a_e,2,1,"p",21),eS(16,"app-count-down",22,23),uS("outOfTimeAction",function(){return Nk(n),hS().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Nk(n),hS().addGlobalTime()}),tS(),eS(18,"app-count-down",24,25),uS("outOfTimeAction",function(){return Nk(n),hS().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Nk(n),hS().addTurnTime()}),tS(),tS(),nS(20,"hr"),YE(21,v_e,9,8,"ng-container",26),YE(22,x_e,7,5,"div",27),YE(23,R_e,2,0,"button",28),YE(24,M_e,2,0,"button",29),YE(25,N_e,2,0,"button",30),tS(),tS(),eS(26,"div",31),eS(27,"div",32),nS(28,"app-game-includer"),tS(),tS(),tS()}if(2&e){var r=hS();pb(3),XE("ngIf",r.currentPart),pb(2),XE("ngIf",r.players[0].isPresent()),pb(1),XE("ngIf",r.currentPart&&r.gameComponent&&r.gameComponent.scores.isPresent()),pb(1),XE("dangerTimeLimit",6e4)("active",null!=r.currentPart&&r.currentPart.getTurn()%2==0)("canAddTime",1===r.observerRole&&!1===r.endGame)("timeToAdd",r.globalTimeMessage),pb(2),XE("dangerTimeLimit",15e3)("active",null!=r.currentPart&&r.currentPart.getTurn()%2==0)("canAddTime",1===r.observerRole&&!1===r.endGame)("timeToAdd",r.turnTimeMessage),pb(5),XE("ngIf",r.players[1].isPresent()),pb(1),XE("ngIf",r.currentPart&&r.gameComponent&&r.gameComponent.scores.isPresent()),pb(1),XE("dangerTimeLimit",6e4)("active",null!=r.currentPart&&r.currentPart.getTurn()%2==1)("canAddTime",0===r.observerRole&&!1===r.endGame)("timeToAdd",r.globalTimeMessage),pb(2),XE("dangerTimeLimit",15e3)("active",null!=r.currentPart&&r.currentPart.getTurn()%2==1)("canAddTime",0===r.observerRole&&!1===r.endGame)("timeToAdd",r.turnTimeMessage),pb(3),XE("ngIf",r.isPlaying()),pb(1),XE("ngIf",r.endGame),pb(1),XE("ngIf",r.endGame),pb(1),XE("ngIf",r.endGame&&r.isPlaying()&&!1===r.rematchProposed),pb(1),XE("ngIf",r.endGame&&r.isPlaying()&&r.rematchProposed&&r.opponentProposedRematch),pb(1),XE("ngClass",r.getBoardHighlight())}}var L_e=function(){var e=jg(function e(){Wg(this,e)});return e.NO_MATCHING_PART=function(){return $localize(Pv||(Pv=wg(["The game you tried to join does not exist."])))},e}(),F_e=jg(function e(t){Wg(this,e),this.value=t});F_e.PRE_START_DOC=new F_e("PRE_START_DOC"),F_e.STARTING_DOC=new F_e("STARTING_DOC"),F_e.DUPLICATE=new F_e("DUPLICATE"),F_e.MOVE_WITHOUT_TIME=new F_e("MOVE_WITHOUT_TIME"),F_e.MOVE=new F_e("MOVE"),F_e.REQUEST=new F_e("REQUEST"),F_e.END_GAME=new F_e("END_GAME"),F_e.END_GAME_WITHOUT_TIME=new F_e("END_GAME_WITHOUT_TIME"),F_e.ACCEPT_TAKE_BACK_WITHOUT_TIME=new F_e("ACCEPT_TAKE_BACK_WITHOUT_TIME");var U_e=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s,u){var c;return Wg(this,n),(c=t.call(this,e,r,o,i,a)).userService=s,c.gameService=u,c.gameStarted=!1,c.opponent=null,c.rematchProposed=!1,c.opponentProposedRematch=!1,c.hasUserPlayed=[!1,!1],c.msToSubstract=[0,0],c.opponentSubscription=lV.empty(),c.OFFLINE_FONT_COLOR={color:"lightgrey"},c.globalTimeMessage=$localize(Ov||(Ov=wg(["5 minutes"]))),c.turnTimeMessage=$localize(Tv||(Tv=wg(["30 seconds"]))),oV(n.VERBOSE,"OnlineGameWrapperComponent constructed"),c}return jg(n,[{key:"extractPartIdFromURL",value:function(){return aV.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}},{key:"extractGameNameFromURL",value:function(){return aV.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}},{key:"isPlaying",value:function(){return this.observerRole===Nre.ZERO.value||this.observerRole===Nre.ONE.value}},{key:"getPlayer",value:function(){return Nre.of(this.observerRole)}},{key:"getPlayerName",value:function(){return aV.getNonNullable(this.authUser.username.get())}},{key:"isPlayer",value:function(e){return this.observerRole===e.value}},{key:"isOpponent",value:function(e){return this.observerRole!==e.value}},{key:"redirectIfPartOrGameIsInvalid",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.extractGameNameFromURL(),!Nme.ALL_GAMES().some(function(e){return e.urlName===n})){t.next=11;break}return t.next=4,e.gameService.getPartValidity(e.currentPartId,n);case 4:if(!t.sent.isFailure()){t.next=9;break}return e.routerEventsSub.unsubscribe(),r=L_e.NO_MATCHING_PART(),t.next=9,e.router.navigate(["/notFound",r],{skipLocationChange:!0});case 9:t.next=15;break;case 11:return e.routerEventsSub.unsubscribe(),i=gke.NO_MATCHING_GAME(n),t.next=15,e.router.navigate(["/notFound",i],{skipLocationChange:!0});case 15:case"end":return t.stop()}},t)}))()}},{key:"setCurrentPartIdOrRedirect",value:function(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartOrGameIsInvalid()}},{key:"ngOnInit",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return oV(n.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),e.routerEventsSub=e.router.events.subscribe(function(){var t=iV(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n instanceof _N,!t.t0){t.next=4;break}return t.next=4,e.setCurrentPartIdOrRedirect();case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),e.userSub=e.connectedUserService.getUserObs().subscribe(function(t){e.authUser=t}),t.next=5,e.setCurrentPartIdOrRedirect();case 5:case"end":return t.stop()}},t)}))()}},{key:"startGame",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:oV(n.VERBOSE,"OnlineGameWrapperComponent.startGame"),M7(!1===t.gameStarted,"Should not start already started game"),t.joiner=e,t.gameStarted=!0,window.setTimeout(iV(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=M7,e.next=3,t.afterGameIncluderViewInit();case 3:e.t1=e.sent,(0,e.t0)(e.t1,"Game should be created successfully, otherwise part-creation would have redirected"),t.startPart();case 6:case"end":return e.stop()}},e)})),1);case 1:case"end":return r.stop()}},r)}))()}},{key:"startPart",value:function(){var e,t=this;oV(n.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,(e=iV(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return M7(n.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),e.next=3,t.onCurrentPartUpdate(n.get());case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}))}},{key:"onCurrentPartUpdate",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=new D7(t.currentPartId,e),oV(n.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:t.currentPart,then:e.data,before_part_turn:i.data.turn,before_state_turn:t.gameComponent.rules.node.gameState.turn,nbPlayedMoves:i.data.listMoves.length}}),a=t.getUpdateType(i),o=e.turn,oV(n.VERBOSE,a===F_e.REQUEST?"UpdateType: Request("+aV.getNonNullable(i.data.request).code+") ("+o+")":"UpdateType: "+a.value+"("+o+")"),s=t.currentPart,r.t0=(t.currentPart=i,a),r.next=r.t0===F_e.REQUEST?8:r.t0===F_e.ACCEPT_TAKE_BACK_WITHOUT_TIME?11:r.t0===F_e.DUPLICATE?12:r.t0===F_e.END_GAME_WITHOUT_TIME?13:r.t0===F_e.END_GAME?14:r.t0===F_e.MOVE_WITHOUT_TIME?15:r.t0===F_e.MOVE?16:r.t0===F_e.PRE_START_DOC?17:19;break;case 8:return r.next=10,t.onRequest(aV.getNonNullable(i.data.request),s);case 10:return r.abrupt("return",r.sent);case 11:return r.abrupt("return",void(t.currentPart=s));case 12:return r.abrupt("return");case 13:return r.abrupt("return",void(t.currentPart=s));case 14:return r.abrupt("return",t.applyEndGame());case 15:return r.abrupt("return",void(t.currentPart=s));case 16:return r.abrupt("return",(t.msToSubstract=t.getLastUpdateTime(s,i,a),t.doNewMoves(i)));case 17:return u=null==t.currentPart||null!=t.currentPart.data.beginning,r.abrupt("return",void M7(null==s||null==s.data.beginning||u,"old part had no beginning time or new part has, we did not expect this!"));case 19:return r.abrupt("return",(M7(a===F_e.STARTING_DOC,"Unexpected update type "+a),t.setChronos(),t.setPlayersDatas(i),t.startCountDownFor(Nre.ZERO)));case 20:case"end":return r.stop()}},r)}))()}},{key:"getUpdateType",value:function(e){var t=mke.from(null!=this.currentPart?this.currentPart.data:null,e.data);oV(n.VERBOSE,{diff:t});var r=t.countChanges();if(0===r)return F_e.DUPLICATE;if(e.data.request){var i=null!=t.removed.lastUpdateTime;return"TakeBackAccepted"===e.data.request.code&&i?F_e.ACCEPT_TAKE_BACK_WITHOUT_TIME:F_e.REQUEST}if(this.isMove(t,r))return 1===e.data.turn?null==e.data.lastUpdateTime?F_e.MOVE_WITHOUT_TIME:F_e.MOVE:null==t.modified.lastUpdateTime?F_e.MOVE_WITHOUT_TIME:F_e.MOVE;if(null==e.data.beginning)return F_e.PRE_START_DOC;if(e.data.result!==N7.UNACHIEVED.value){var a=null==t.modified.lastUpdateTime;return null!=t.modified.turn&&a?F_e.END_GAME_WITHOUT_TIME:F_e.END_GAME}return M7(null!=e.data.beginning&&0===e.data.listMoves.length,"Unexpected update: "+JSON.stringify(t)),F_e.STARTING_DOC}},{key:"isMove",value:function(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+3}return!1}},{key:"getLastUpdateTime",value:function(e,t,n){var r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);M7(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),M7(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");var a=Nre.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(aV.getNonNullable(r),aV.getNonNullable(i),n,a)}},{key:"getMoreRecentTime",value:function(e){var t;return null!==(t=e.data.lastUpdateTime)&&void 0!==t?t:e.data.beginning}},{key:"getTimeUsedForLastTurn",value:function(e,t,n,r){var i=_ke(e,t),a=[0,0];return a[r.value]=i,a}},{key:"setChronos",value:function(){oV(n.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}},{key:"didUserPlay",value:function(e){return this.hasUserPlayed[e.value]}},{key:"doNewMoves",value:function(e){this.switchPlayer();for(var t=Ure.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;n.node.gameState.turn<t.length;){var r=n.node.gameState.turn,i=this.gameComponent.encoder.decode(t[r]),a=n.isLegal(i,n.node.gameState),o="We received an incorrect db move: "+i.toString()+" in "+t+" at turn "+r+'because "'+a.getReasonOr("")+'"';M7(a.isSuccess(),o),n.choose(i)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}},{key:"switchPlayer",value:function(){oV(n.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");var e=Nre.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();var t=e.getOpponent();this.didUserPlay(t)&&this.pauseCountDownsFor(t),this.didUserPlay(e)?(oV(n.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(e)):this.startCountDownFor(e)}},{key:"resetChronoFor",value:function(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}},{key:"applyEndGame",value:function(){var e=this.currentPart,t=Nre.fromTurn(e.data.turn);this.endGame=!0,[N7.VICTORY,N7.HARD_DRAW].some(function(t){return t.value===e.data.result})?this.doNewMoves(this.currentPart):(M7(!0===[N7.RESIGN,N7.TIMEOUT,N7.HARD_DRAW,N7.AGREED_DRAW_BY_ZERO,N7.AGREED_DRAW_BY_ONE].some(function(t){return t.value===e.data.result}),"Unknown type of end game ("+e.data.result+")"),oV(n.VERBOSE,"endGame est true et winner est "+e.getWinner())),this.stopCountdownsFor(t)}},{key:"notifyDraw",value:function(e,t){this.endGame=!0;var n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}},{key:"notifyTimeoutVictory",value:function(e,t,n,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i.endGame=!0,o=i.currentPart.setWinnerAndLoser(e,r),i.currentPart=o,a.next=5,i.gameService.notifyTimeout(i.currentPartId,t,n,e,r);case 5:case"end":return a.stop()}},a)}))()}},{key:"notifyVictory",value:function(e,t){oV(n.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");var r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===loe.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(M7(r===loe.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;var i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,e,[0,0],t,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}},{key:"canAskTakeBack",value:function(){return M7(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===Mre.NONE}},{key:"isOpponentWaitingForTakeBackResponse",value:function(){var e=this.getTakeBackRequester();return!!e.isPlayer()&&this.isOpponent(e)}},{key:"getTakeBackRequester",value:function(){if(null==this.currentPart)return Mre.NONE;var e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?Dre.getPlayer(e):Mre.NONE}},{key:"canProposeDraw",value:function(){return M7(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&Dre.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===Mre.NONE}},{key:"isOpponentWaitingForDrawResponse",value:function(){var e=this.getDrawRequester();return e!==Mre.NONE&&this.isOpponent(e)}},{key:"getDrawRequester",value:function(){if(null==this.currentPart)return Mre.NONE;var e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?Dre.getPlayer(e):Mre.NONE}},{key:"onRequest",value:function(e,t){var r=this;return iV(regeneratorRuntime.mark(function i(){var a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=(oV(n.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:e,oldPart:t}),e.code),i.next="TakeBackAsked"===i.t0||"TakeBackRefused"===i.t0?3:"TakeBackAccepted"===i.t0?4:"RematchProposed"===i.t0?6:"RematchAccepted"===i.t0?10:"DrawProposed"===i.t0||"DrawRefused"===i.t0?15:"AddTurnTime"===i.t0?16:"AddGlobalTime"===i.t0?19:22;break;case 3:return i.abrupt("break",25);case 4:return r.takeBackTo(r.currentPart.data.turn),i.abrupt("break",25);case 6:return r.rematchProposed=!0,a=Dre.getPlayer(e).getOpponent(),r.isPlayer(a)&&(oV(n.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0),i.abrupt("break",25);case 10:return i.next=12,r.router.navigate(["/nextGameLoading"]);case 12:return i.next=14,r.router.navigate(["/play",Dre.getTypeGame(e),Dre.getPartId(e)]);case 14:case 15:return i.abrupt("break",25);case 16:return 3e4,o=Nre.of(e.data.player),r.addTurnTimeTo(o,3e4),i.abrupt("break",25);case 19:return 3e5,s=Nre.of(e.data.player),r.addGlobalTimeTo(s,3e5),i.abrupt("break",25);case 22:return aV.expectToBe(e.code,"DrawAccepted","Unknown RequestType : "+e.code+" for "+JSON.stringify(e)),i.next=25,r.acceptDraw();case 25:case"end":return i.stop()}},i)}))()}},{key:"takeBackTo",value:function(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();var t=Nre.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}},{key:"setPlayersDatas",value:function(e){var t=this;oV(n.VERBOSE,{OnlineGameWrapper_setPlayersDatas:e}),this.players=[lV.of(e.data.playerZero),lV.ofNullable(e.data.playerOne)],M7(null!=e.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[e.data.turn%2].get();var r=lV.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=Nre.ZERO.value,r=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=Nre.ONE.value,r=this.players[0]):this.observerRole=Mre.NONE.value,r.isPresent()){var i=function(e){t.opponent=e[0].data},a=new V7(i,i,function(e){throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))});this.opponentSubscription=lV.of(this.userService.observeUserByUsername(r.get(),a))}}},{key:"onLegalUserMove",value:function(e,t){var r=this;return iV(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(oV(n.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),r.isOpponentWaitingForTakeBackResponse()){i.next=2;break}return i.abrupt("return",r.updateDBBoard(e,r.msToSubstract,t));case 2:r.gameComponent.message("You must answer to take back request");case 3:case"end":return i.stop()}},i)}))()}},{key:"updateDBBoard",value:function(e,t,r){var i=this;return iV(regeneratorRuntime.mark(function a(){var o,s,u;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o=i.gameComponent.encoder.encodeMove(e),oV(n.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+e.toString()+", "+r+")"),i.gameComponent.rules.choose(e),!(s=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node)).isEndGame){a.next=5;break}return a.abrupt("return",s===loe.DRAW?i.notifyDraw(o,r):i.notifyVictory(o,r));case 5:return u=i.getPlayer(),a.abrupt("return",i.gameService.updateDBBoard(i.currentPartId,u,o,t,r));case 7:case"end":return a.stop()}},a)}))()}},{key:"resign",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getLastIndex(),r=e.getPlayer(),i=e.players[e.observerRole%2].get(),a=e.players[(e.observerRole+1)%2].get(),t.next=3,e.gameService.resign(e.currentPartId,n,r,a,i);case 3:case"end":return t.stop()}},t)}))()}},{key:"getLastIndex",value:function(){return this.currentPart.data.lastUpdate.index}},{key:"reachedOutOfTime",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(oV(n.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+e+")"),i=t.getLastIndex(),a=t.getPlayer(),t.stopCountdownsFor(Nre.of(e)),o=aV.getNonNullable(t.opponent),e!==t.observerRole){r.next=10;break}return s=aV.getNonNullable(o.username),r.next=8,t.notifyTimeoutVictory(s,a,i,t.getPlayerName());case 8:r.next=15;break;case 10:if(M7(!1===t.endGame,"time might be better handled in the future"),!t.opponentIsOffline()){r.next=15;break}return u=aV.getNonNullable(o.username),r.next=14,t.notifyTimeoutVictory(t.getPlayerName(),a,e,u);case 14:t.endGame=!0;case 15:case"end":return r.stop()}},r)}))()}},{key:"acceptRematch",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(e.isPlaying(),"Non playing should not call acceptRematch"),n=new D7(e.currentPartId,e.currentPart.data),t.next=4,e.gameService.acceptRematch(n,e.getLastIndex(),e.getPlayer());case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}},t)}))()}},{key:"proposeRematch",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(e.isPlaying(),"Non playing should not call proposeRematch"),t.next=3,e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer());case 3:return t.abrupt("return",!0);case 4:case"end":return t.stop()}},t)}))()}},{key:"proposeDraw",value:function(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}},{key:"acceptDraw",value:function(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}},{key:"refuseDraw",value:function(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}},{key:"askTakeBack",value:function(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}},{key:"acceptTakeBack",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getPlayer(),t.next=3,e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,n,e.msToSubstract);case 3:e.msToSubstract=[0,0];case 4:case"end":return t.stop()}},t)}))()}},{key:"refuseTakeBack",value:function(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}},{key:"startCountDownFor",value:function(e){oV(n.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+e.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[e.value]=!0,e===Nre.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}},{key:"resumeCountDownFor",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];oV(n.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+e.toString()+") (turn "+this.currentPart.data.turn+")"),e===Nre.ZERO?(this.chronoZeroGlobal.changeDuration(aV.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),t=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(aV.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),t=this.chronoOneTurn),r?(t.setDuration(1e3*this.joiner.maximalMoveDuration),t.start()):t.resume()}},{key:"pauseCountDownsFor",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];oV(n.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+e.value+") (turn "+this.currentPart.data.turn+")"),e===Nre.ZERO?(this.chronoZeroGlobal.pause(),t=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),t=this.chronoOneTurn),r?t.stop():t.pause()}},{key:"stopCountdownsFor",value:function(e){oV(n.VERBOSE,"cdc::stopCountDownsFor("+e.toString()+") (turn "+this.currentPart.data.turn+")"),e===Nre.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}},{key:"getPlayerNameClass",value:function(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}},{key:"opponentIsOffline",value:function(){return!1}},{key:"canResign",value:function(){return M7(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}},{key:"addGlobalTime",value:function(){var e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}},{key:"addTurnTime",value:function(){var e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}},{key:"addTurnTimeTo",value:function(e,t){var n=Nre.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===Nre.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}},{key:"addGlobalTimeTo",value:function(e,t){e===Nre.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}},{key:"ngOnDestroy",value:function(){this.routerEventsSub.unsubscribe(),this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}]),n}(yke);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(iO),QE(PD),QE(jL),QE(x7),QE(Sre),QE(G7),QE(zre))},e.\u0275cmp=Gm({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){var n;(1&e&&(IT(Wke,5),IT(qke,5),IT(jke,5),IT(Zke,5),IT(Yke,5),IT(Kke,5)),2&e)&&(TT(n=AT())&&(t.partCreation=n.first),TT(n=AT())&&(t.chatComponent=n.first),TT(n=AT())&&(t.chronoZeroGlobal=n.first),TT(n=AT())&&(t.chronoOneGlobal=n.first),TT(n=AT())&&(t.chronoZeroTurn=n.first),TT(n=AT())&&(t.chronoOneTurn=n.first))},features:[xE],decls:5,vars:4,consts:function(){return[["id","partCreation",3,"partId","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],$localize(Iv||(Iv=wg(["vs."]))),["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],$localize(Av||(Av=wg(["Turn n\xb0",":INTERPOLATION:"])),"\ufffd0\ufffd"),["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],$localize(xv||(xv=wg(["It is your turn."]))),$localize(Rv||(Rv=wg(["It is ",":INTERPOLATION:'s turn."])),"\ufffd0\ufffd"),["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],$localize(Mv||(Mv=wg(["",":INTERPOLATION: points"])),"\ufffd0\ufffd"),["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],$localize(Nv||(Nv=wg(["",":INTERPOLATION: points"])),"\ufffd0\ufffd"),["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],$localize(Dv||(Dv=wg(["Resign"]))),["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],$localize(Lv||(Lv=wg(["Propose a draw"]))),["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],$localize(Fv||(Fv=wg(["Accept draw"]))),["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],$localize(Uv||(Uv=wg(["Reject draw"]))),["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],$localize(Bv||(Bv=wg(["Pass a turn"]))),["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],$localize(Vv||(Vv=wg(["Accept take back"]))),["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],$localize(zv||(zv=wg(["Reject take back"]))),["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],$localize(Hv||(Hv=wg(["Ask to take back one move"]))),["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],$localize(Gv||(Gv=wg(["Draw"]))),["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],$localize($v||($v=wg(["You agreed to draw."]))),["id","yourOpponentAgreedToDrawIndicator",1,"title"],$localize(Wv||(Wv=wg(["Your draw proposal has been accepted."]))),["id","playersAgreedToDraw",1,"title"],$localize(qv||(qv=wg(["Players agreed to draw."]))),["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],$localize(jv||(jv=wg(["You won."]))),[1,"title"],$localize(Zv||(Zv=wg(["You lost."]))),$localize(Yv||(Yv=wg(["",":INTERPOLATION: won."])),"\ufffd0\ufffd"),$localize(Kv||(Kv=wg(["",":INTERPOLATION: has reached their time limit. You won."])),"\ufffd0\ufffd"),$localize(Qv||(Qv=wg(["You reached your time limit."]))),$localize(Xv||(Xv=wg(["",":INTERPOLATION: has reached their time limit."])),"\ufffd0\ufffd"),["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],$localize(Jv||(Jv=wg(["You resigned."]))),$localize(ep||(ep=wg(["",":INTERPOLATION: has resigned."])),"\ufffd0\ufffd"),["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],$localize(tp||(tp=wg(["Go back to the game list"]))),["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],$localize(np||(np=wg(["Propose to play again"]))),["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],$localize(rp||(rp=wg(["Accept to play again"])))]},template:function(e,t){1&e&&(YE(0,Qke,2,1,"app-part-creation",0),YE(1,D_e,29,27,"div",1),eS(2,"div",2),eS(3,"div",3),nS(4,"app-chat",4),tS(),tS()),2&e&&(XE("ngIf",!1===t.gameStarted),pb(1),XE("ngIf",t.gameStarted),pb(3),XE("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[UA,rke,Hke,$ke,NA,pke,YL],encapsulation:2}),e}();function B_e(e,t){if(1&e&&(eS(0,"option",25),FS(1),tS()),2&e){var n=t.$implicit;XE("value",n.name),pb(1),US(n.name)}}function V_e(e,t){if(1&e&&(eS(0,"option",25),WP(1,29),tS()),2&e){var n=t.$implicit;XE("value",n),pb(1),qP(n),jP(1)}}var z_e=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function H_e(e,t){if(1&e){var n=aS();eS(0,"select",26),uS("ngModelChange",function(e){return Nk(n),hS(2).aiDepths[0]=e})("change",function(){return Nk(n),hS(2).updatePlayer(0)}),eS(1,"option",27),WP(2,28),tS(),YE(3,V_e,2,2,"option",16),tS()}2&e&&(XE("ngModel",hS(2).aiDepths[0]),pb(3),XE("ngForOf",aT(2,z_e)))}function G_e(e,t){if(1&e&&(eS(0,"p",30),WP(1,31),tS()),2&e){var n=hS(2);pb(1),qP(n.gameComponent.scores.get()[0]),jP(1)}}function $_e(e,t){if(1&e&&(eS(0,"option",25),FS(1),tS()),2&e){var n=t.$implicit;XE("value",n.name),pb(1),US(n.name)}}function W_e(e,t){if(1&e&&(eS(0,"option",25),WP(1,34),tS()),2&e){var n=t.$implicit;XE("value",n),pb(1),qP(n),jP(1)}}function q_e(e,t){if(1&e){var n=aS();eS(0,"select",32),uS("ngModelChange",function(e){return Nk(n),hS(2).aiDepths[1]=e})("change",function(){return Nk(n),hS(2).updatePlayer(1)}),eS(1,"option",27),WP(2,33),tS(),YE(3,W_e,2,2,"option",16),tS()}2&e&&(XE("ngModel",hS(2).aiDepths[1]),pb(3),XE("ngForOf",aT(2,z_e)))}function j_e(e,t){if(1&e&&(eS(0,"p",35),WP(1,36),tS()),2&e){var n=hS(2);pb(1),qP(n.gameComponent.scores.get()[1]),jP(1)}}function Z_e(e,t){if(1&e&&(eS(0,"h4"),WP(1,40),tS()),2&e){var n=hS(3);pb(1),qP(n.winner.get()),jP(1)}}function Y_e(e,t){1&e&&(eS(0,"h4",41),WP(1,42),tS())}function K_e(e,t){if(1&e&&(eS(0,"div",37),YE(1,Z_e,2,1,"h4",38),YE(2,Y_e,2,0,"h4",39),tS()),2&e){var n=hS(2);pb(1),XE("ngIf",n.winner.isPresent()),pb(1),XE("ngIf",n.winner.isAbsent())}}function Q_e(e,t){if(1&e){var n=aS();eS(0,"div",6),eS(1,"div",7),eS(2,"p",8),WP(3,9),tS(),tS(),eS(4,"div",10),eS(5,"div",11),eS(6,"div",12),eS(7,"select",13),uS("change",function(){return Nk(n),hS().updatePlayer(0)})("ngModelChange",function(e){return Nk(n),hS().playerSelection[0]=e}),eS(8,"option",14),WP(9,15),tS(),YE(10,B_e,2,2,"option",16),tS(),tS(),eS(11,"div",12),YE(12,H_e,4,3,"select",17),tS(),YE(13,G_e,2,1,"p",18),tS(),eS(14,"div",19),eS(15,"div",12),eS(16,"select",20),uS("change",function(){return Nk(n),hS().updatePlayer(1)})("ngModelChange",function(e){return Nk(n),hS().playerSelection[1]=e}),eS(17,"option",14),WP(18,21),tS(),YE(19,$_e,2,2,"option",16),tS(),tS(),eS(20,"div",12),YE(21,q_e,4,3,"select",22),tS(),YE(22,j_e,2,1,"p",23),tS(),tS(),YE(23,K_e,3,2,"div",24),tS()}if(2&e){var r=hS();pb(3),qP(r.gameComponent.rules.node.gameState.turn+1),jP(3),pb(4),XE("ngModel",r.playerSelection[0]),pb(3),XE("ngForOf",r.gameComponent.availableMinimaxes),pb(2),XE("ngIf",!1===r.players[0].equalsValue("human")),pb(1),XE("ngIf",r.gameComponent.scores.isPresent()),pb(3),XE("ngModel",r.playerSelection[1]),pb(3),XE("ngForOf",r.gameComponent.availableMinimaxes),pb(2),XE("ngIf",!1===r.players[1].equalsValue("human")),pb(1),XE("ngIf",r.gameComponent.scores.isPresent()),pb(1),XE("ngIf",r.endGame)}}function X_e(e,t){if(1&e&&(rS(0),FS(1),nS(2,"br"),iS()),2&e){var n=t.$implicit,r=hS(3);pb(1),BS(" ",n.name+": "+n.getBoardValue(r.gameComponent.rules.node)," ")}}function J_e(e,t){if(1&e&&(rS(0),YE(1,X_e,3,1,"ng-container",48),FS(2),nS(3,"br"),FS(4),nS(5,"br"),iS()),2&e){var n=hS(2);pb(1),XE("ngForOf",n.gameComponent.availableMinimaxes),pb(1),BS(" Created ",n.getCreatedNodes()," nodes."),pb(2),BS(" Minimax time: ",n.getMinimaxTime(),"ms.")}}function eCe(e,t){if(1&e){var n=aS();eS(0,"button",49),uS("click",function(){return Nk(n),hS(2).gameComponent.pass()}),WP(1,50),tS()}}function tCe(e,t){if(1&e){var n=aS();eS(0,"button",51),uS("click",function(){return Nk(n),hS(2).takeBack()}),WP(1,52),tS()}}function nCe(e,t){if(1&e){var n=aS();eS(0,"div",43),YE(1,J_e,6,3,"ng-container",38),YE(2,eCe,2,0,"button",44),YE(3,tCe,2,0,"button",45),eS(4,"button",46),uS("click",function(){return Nk(n),hS().restartGame()}),WP(5,47),tS(),tS()}if(2&e){var r=hS();pb(1),XE("ngIf",r.gameComponent.rules.node.move),pb(1),XE("ngIf",!1===r.endGame&&r.gameComponent.canPass),pb(1),XE("ngIf",r.canTakeBack())}}var rCe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,i,a,o)).cdr=s,u.aiDepths=["0","0"],u.playerSelection=["human","human"],u.winner=lV.empty(),u.botTimeOut=1e3,u.players=[lV.of(u.playerSelection[0]),lV.of(u.playerSelection[1])],oV(n.VERBOSE,"LocalGameWrapper.constructor"),u}return jg(n,[{key:"getCreatedNodes",value:function(){return uoe.createdNodes}},{key:"getMinimaxTime",value:function(){return uoe.minimaxTime}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.afterGameIncluderViewInit();case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}e.restartGame(),e.cdr.detectChanges();case 5:case"end":return t.stop()}},t)})),1)}},{key:"updatePlayer",value:function(e){this.players[e]=lV.of(this.playerSelection[e]),this.proposeAIToPlay()}},{key:"onLegalUserMove",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:oV(n.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),t.gameComponent.rules.choose(e),t.updateBoard(),t.proposeAIToPlay();case 1:case"end":return r.stop()}},r)}))()}},{key:"updateBoard",value:function(){this.gameComponent.updateBoard();var e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner.isPlayer()&&(this.winner=lV.of($localize(ip||(ip=wg(["Player ",""])),e.winner.value+1))))}},{key:"proposeAIToPlay",value:function(){var e=this,t=this.getPlayingAI();t.isPresent()&&window.setTimeout(iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.doAIMove(t.get());case 2:case"end":return n.stop()}},n)})),this.botTimeOut)}},{key:"getPlayingAI",value:function(){var e=this;if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return lV.empty();var t=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[t]?lV.empty():lV.ofNullable(this.gameComponent.availableMinimaxes.find(function(n){return e.players[t].equalsValue(n.name)}))}},{key:"doAIMove",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return M7((r=t.gameComponent.rules).getGameStatus(r.node)===loe.ONGOING,"IA should not try to play when game is over!"),i=Number.parseInt(t.aiDepths[r.node.gameState.turn%2%2]),a=r.node.findBestMove(i,e,!0),n.abrupt("return",r.choose(a)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),T7.SUCCESS):(t.messageDisplayer.criticalMessage($localize(ap||(ap=wg(["The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!"])))),R7.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:a.toString()})));case 4:case"end":return n.stop()}},n)}))()}},{key:"canTakeBack",value:function(){return this.gameComponent.rules.node.gameState.turn>0}},{key:"takeBack",value:function(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}},{key:"isAITurn",value:function(){return this.getPlayingAI().isPresent()}},{key:"restartGame",value:function(){var e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new coe(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=lV.empty(),this.proposeAIToPlay()}},{key:"getPlayerName",value:function(){return"human"}}]),n}(yke);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(iO),QE(PD),QE(Sre),QE(jL),QE(x7),QE(NO))},e.\u0275cmp=Gm({type:e,selectors:[["app-local-game-wrapper"]],features:[xE],decls:7,vars:3,consts:function(){return[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],$localize(op||(op=wg(["Turn n\xb0",":INTERPOLATION:"])),"\ufffd0\ufffd"),["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],$localize(sp||(sp=wg(["Human"]))),[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],$localize(up||(up=wg(["Human"]))),["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],$localize(cp||(cp=wg(["Pick the level"]))),$localize(lp||(lp=wg(["Level ",":INTERPOLATION:"])),"\ufffd0\ufffd"),["id","scoreOne",1,"block"],$localize(hp||(hp=wg(["",":INTERPOLATION: points"])),"\ufffd0\ufffd"),["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],$localize(fp||(fp=wg(["Pick the level"]))),$localize(dp||(dp=wg(["Level ",":INTERPOLATION:"])),"\ufffd0\ufffd"),["id","scoreZero",1,"block"],$localize(vp||(vp=wg(["",":INTERPOLATION: points"])),"\ufffd0\ufffd"),["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],$localize(pp||(pp=wg(["",":INTERPOLATION: won"])),"\ufffd0\ufffd"),["id","draw"],$localize(gp||(gp=wg(["Draw"]))),[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],$localize(yp||(yp=wg(["Start a new game"]))),[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],$localize(mp||(mp=wg(["Pass a turn"]))),["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],$localize(kp||(kp=wg(["Take back move"])))]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"div",1),YE(2,Q_e,24,10,"div",2),YE(3,nCe,6,3,"div",3),tS(),eS(4,"div",4),eS(5,"div",5),nS(6,"app-game-includer"),tS(),tS(),tS()),2&e&&(pb(2),XE("ngIf",t.gameComponent),pb(1),XE("ngIf",t.gameComponent),pb(1),XE("ngClass",t.getBoardHighlight()))},directives:[UA,NA,pke,iM,vR,qR,aM,cM,LA],encapsulation:2,changeDetection:0}),e}(),iCe=function(){var e=jg(function e(){Wg(this,e)});return e.STEP_FINISHED=function(){return $localize(_p||(_p=wg(["Step finished!"])))},e.INFORMATIONAL_STEP=function(){return $localize(Cp||(Cp=wg(["This step is not expecting any move from your part."])))},e}();function aCe(e,t){if(1&e&&(eS(0,"div",20),eS(1,"div",21),WP(2,22),tS(),eS(3,"div",23),FS(4),tS(),tS()),2&e){var n=hS();pb(4),US(n.currentReason.get())}}function oCe(e,t){if(1&e){var n=aS();eS(0,"button",24),uS("click",function(){return Nk(n),hS().retry()}),WP(1,25),tS()}}function sCe(e,t){1&e&&(rS(0),WP(1,30),iS())}function uCe(e,t){1&e&&(rS(0),WP(1,31),iS())}function cCe(e,t){if(1&e&&YE(0,uCe,2,0,"ng-container",27),2&e){hS();var n=KE(5),r=hS();XE("ngIf",r.stepFinished&&r.stepFinished[r.stepIndex])("ngIfElse",n)}}function lCe(e,t){1&e&&(rS(0),WP(1,32),iS())}function hCe(e,t){if(1&e){var n=aS();eS(0,"button",26),uS("click",function(){return Nk(n),hS().next()}),YE(1,sCe,2,0,"ng-container",27),YE(2,cCe,1,2,"ng-template",null,28,RT),YE(4,lCe,2,0,"ng-template",null,29,RT),tS()}if(2&e){var r=KE(3),i=hS();pb(1),XE("ngIf",i.steps[i.stepIndex]&&i.steps[i.stepIndex].isInformation())("ngIfElse",r)}}function fCe(e,t){if(1&e){var n=aS();eS(0,"button",33),uS("click",function(){return Nk(n),hS().start()}),WP(1,34),tS()}}function dCe(e,t){if(1&e){var n=aS();eS(0,"button",35),uS("click",function(){return Nk(n),hS().playLocally()}),WP(1,36),tS()}}function vCe(e,t){if(1&e){var n=aS();eS(0,"button",37),uS("click",function(){return Nk(n),hS().createGame()}),WP(1,38),tS()}}function pCe(e,t){if(1&e){var n=aS();eS(0,"button",39),uS("click",function(){return Nk(n),hS().showSolution()}),WP(1,40),tS()}}function gCe(e,t){if(1&e&&(rS(0),eS(1,"option",42),FS(2),tS(),iS()),2&e){var n=hS(),r=n.index,i=n.$implicit;pb(1),dS("id","step_",r,""),XE("value",r),pb(1),US(i.title)}}function yCe(e,t){1&e&&(rS(0),FS(1,"v "),iS())}function mCe(e,t){1&e&&FS(0,"x ")}function kCe(e,t){if(1&e&&(eS(0,"option",43),YE(1,yCe,2,0,"ng-container",27),YE(2,mCe,1,0,"ng-template",null,44,RT),eS(4,"span",45),FS(5),tS(),tS()),2&e){var n=KE(3),r=hS(),i=r.index,a=r.$implicit,o=hS();XE("value",i),pb(1),XE("ngIf",o.stepFinished[i])("ngIfElse",n),pb(3),dS("id","step_",i,""),pb(1),US(a.title)}}function _Ce(e,t){if(1&e&&(rS(0),YE(1,gCe,3,3,"ng-container",27),YE(2,kCe,6,5,"ng-template",null,41,RT),iS()),2&e){var n=t.index,r=KE(3),i=hS();pb(1),XE("ngIf",n===i.stepIndex)("ngIfElse",r)}}var CCe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r,i,a,o,s){var u;return Wg(this,n),(u=t.call(this,e,r,s,i,a)).cdr=o,u.connectedUserService=s,u.COMPLETED_TUTORIAL_MESSAGE=$localize(wp||(wp=wg(["Congratulations, you completed the tutorial."]))),u.steps=[],u.successfulSteps=0,u.stepIndex=-1,u.currentMessage="",u.currentReason=lV.empty(),u.moveAttemptMade=!1,u.stepFinished=[],u.tutorialOver=!1,oV(n.VERBOSE,"TutorialGameWrapperComponent.constructor"),u}return jg(n,[{key:"getNumberOfSteps",value:function(){return this.steps.length}},{key:"getCurrentStepTitle",value:function(){return this.steps.length>0?this.steps[this.stepIndex].title:""}},{key:"ngAfterViewInit",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return oV(n.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),t.next=3,e.afterGameIncluderViewInit();case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}e.start();case 6:case"end":return t.stop()}},t)}))()}},{key:"start",value:function(){this.startTutorial(this.gameComponent.tutorial)}},{key:"startTutorial",value:function(e){oV(n.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:e}}),this.steps=e,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}},{key:"getCompletionArray",value:function(){return this.steps.map(function(){return!1})}},{key:"changeStep",value:function(e){this.showStep(Number.parseInt(e.target.value,10))}},{key:"showStep",value:function(e){oV(n.VERBOSE,"tutorialGameWrapperComponent.showStep("+e+")"),this.moveAttemptMade=!1,this.stepFinished[e]=!1,this.updateSuccessCount(),this.stepIndex=e;var t=this.steps[this.stepIndex];this.currentMessage=t.instruction,this.currentReason=lV.empty(),this.gameComponent.rules.node=new coe(t.state,lV.empty(),t.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}},{key:"onLegalUserMove",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function r(){var i,a,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:oV(n.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:e}}),i=t.steps[t.stepIndex],M7(t.gameComponent.rules.choose(e),"It should be impossible to call onLegalUserMove with an illegal move"),oV(n.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),t.gameComponent.updateBoard(),t.moveAttemptMade=!0,i.isPredicate()?(a=t.gameComponent.rules.node.gameState,(o=aV.getNonNullable(i.predicate)(e,a)).isSuccess()?t.showStepSuccess(i.getSuccessMessage()):t.currentReason=lV.of(o.getReason())):i.isAnyMove()?(oV(n.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),t.showStepSuccess(i.getSuccessMessage())):(M7(i.isMove(),"cannot reach here with a click step"),(s=i).acceptedMoves.some(function(t){return t.equals(e)})?(oV(n.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),t.showStepSuccess(s.getSuccessMessage())):(oV(n.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),t.currentReason=lV.of(s.getFailureMessage()))),t.cdr.detectChanges();case 4:case"end":return r.stop()}},r)}))()}},{key:"retry",value:function(){oV(n.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}},{key:"onUserClick",value:function(e){var t=this;if(oV(n.VERBOSE,"tutorialGameWrapper.onUserClick("+e+")"),this.currentReason=lV.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return T7.failure(iCe.STEP_FINISHED());var r=this.steps[this.stepIndex];return r.isClick()?(this.gameComponent.updateBoard(),this.moveAttemptMade=!0,aV.getNonNullable(r.acceptedClicks).some(function(t){return t===e})?this.showStepSuccess(r.getSuccessMessage()):this.currentMessage=r.getFailureMessage(),T7.SUCCESS):r.isMove()||r.isPredicate()||r.isAnyMove()?(window.setTimeout(function(){t.cdr.detectChanges()},10),T7.SUCCESS):T7.failure(iCe.INFORMATIONAL_STEP())}},{key:"onCancelMove",value:function(e){oV(n.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+e+")"),void 0!==e&&(this.currentReason=lV.of(e)),this.cdr.detectChanges()}},{key:"showStepSuccess",value:function(e){oV(n.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=e,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}},{key:"updateSuccessCount",value:function(){var e,t=0,n=Hg(this.stepFinished);try{for(n.s();!(e=n.n()).done;){e.value&&t++}}catch(r){n.e(r)}finally{n.f()}this.successfulSteps=t}},{key:"next",value:function(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{for(var e=(this.stepIndex+1)%this.steps.length;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}},{key:"showSolution",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:oV(n.VERBOSE,"tutorialGameWrapper.showSolution()"),M7((r=e.steps[e.stepIndex]).hasSolution(),"step must have solution"),(a=(i=r).getSolution())instanceof noe?(e.showStep(e.stepIndex),e.gameComponent.rules.choose(a),e.gameComponent.updateBoard()):(e.showStep(e.stepIndex),window.document.querySelector(a).dispatchEvent(new Event("click"))),e.currentMessage=i.getSuccessMessage(),e.moveAttemptMade=!0,e.cdr.detectChanges();case 5:case"end":return t.stop()}},t)}))()}},{key:"playLocally",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=aV.getNonNullable(e.actRoute.snapshot.paramMap.get("compo")),t.next=3,e.router.navigate(["/local",n]);case 3:case"end":return t.stop()}},t)}))()}},{key:"createGame",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=aV.getNonNullable(e.actRoute.snapshot.paramMap.get("compo")),t.next=3,e.router.navigate(["/play",n]);case 3:case"end":return t.stop()}},t)}))()}},{key:"getPlayerName",value:function(){return""}}]),n}(yke);return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(QE(iO),QE(PD),QE(jL),QE(x7),QE(NO),QE(Sre))},e.\u0275cmp=Gm({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[xE],decls:22,vars:15,consts:function(){return[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],$localize(bp||(bp=wg(["Failure"]))),["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],$localize(Ep||(Ep=wg(["Try again"]))),["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],$localize(Sp||(Sp=wg(["Ok"]))),$localize(Pp||(Pp=wg(["Continue"]))),$localize(Op||(Op=wg(["Skip"]))),["id","restartButton",1,"button",3,"click"],$localize(Tp||(Tp=wg(["Try again"]))),["id","playLocallyButton",1,"button",3,"click"],$localize(Ip||(Ip=wg(["Play locally"]))),["id","playOnlineButton",1,"button",3,"click"],$localize(Ap||(Ap=wg(["Create an online game"]))),["id","showSolutionButton",1,"button",3,"click"],$localize(xp||(xp=wg(["See solution"]))),["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"div",1),eS(2,"div",2),nS(3,"progress",3),eS(4,"div",4),eS(5,"p",5),FS(6),tS(),nS(7,"p",6),tS(),YE(8,aCe,5,1,"div",7),eS(9,"div",8),YE(10,oCe,2,0,"button",9),YE(11,hCe,6,2,"button",10),YE(12,fCe,2,0,"button",11),YE(13,dCe,2,0,"button",12),YE(14,vCe,2,0,"button",13),YE(15,pCe,2,0,"button",14),eS(16,"div",15),eS(17,"select",16),uS("change",function(e){return t.changeStep(e)}),YE(18,_Ce,4,2,"ng-container",17),tS(),tS(),tS(),tS(),tS(),eS(19,"div",18),eS(20,"div",19),nS(21,"app-game-includer"),tS(),tS(),tS()),2&e&&(pb(3),$E("value",t.successfulSteps)("max",t.getNumberOfSteps()),pb(3),zS("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),pb(1),XE("innerHTML",t.currentMessage,sw),pb(1),XE("ngIf",t.currentReason.isPresent()),pb(2),XE("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),pb(1),XE("ngIf",!1===t.tutorialOver),pb(1),XE("ngIf",t.tutorialOver),pb(1),XE("ngIf",t.tutorialOver),pb(1),XE("ngIf",t.tutorialOver),pb(1),XE("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),pb(3),XE("ngForOf",t.steps),pb(1),XE("ngClass",t.getBoardHighlight()))},directives:[UA,LA,NA,pke,aM,cM],encapsulation:2,changeDetection:0}),e}();function wCe(e,t){if(1&e&&(eS(0,"div",35),eS(1,"div",36),WP(2,37),tS(),eS(3,"div",38),FS(4),tS(),tS()),2&e){var n=hS();pb(4),US(n.errorMessage)}}var bCe=function(){return["/login"]},ECe=function(){var e=function(){function e(t,n){Wg(this,e),this.authService=t,this.router=n,this.faEye=Zre,this.registrationForm=new BR({email:new UR,username:new UR,password:new UR})}return jg(e,[{key:"registerWithEmail",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n,r,i,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.registrationForm.value.username,r=e.registrationForm.value.email,i=e.registrationForm.value.password,null!=n&&null!=r&&null!=i){t.next=5;break}e.errorMessage=$localize(Rp||(Rp=wg(["There are missing fields in the registration form, please check that you filled in all fields."]))),t.next=21;break;case 5:return t.next=7,e.authService.doRegister(n,r,i);case 7:if(!(a=t.sent).isSuccess()){t.next=20;break}return t.next=11,e.authService.sendEmailVerification();case 11:if(!(o=t.sent).isSuccess()){t.next=17;break}return t.next=15,e.router.navigate(["/verify-account"]);case 15:t.next=18;break;case 17:e.errorMessage=o.getReason();case 18:t.next=21;break;case 20:e.errorMessage=a.getReason();case 21:case"end":return t.stop()}},t)}))()}},{key:"registerWithGoogle",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.authService.doGoogleLogin();case 2:if(!(n=t.sent).isSuccess()){t.next=8;break}return t.next=6,e.router.navigate(["/verify-account"]);case 6:t.next=9;break;case 8:e.errorMessage=n.getReason();case 9:case"end":return t.stop()}},t)}))()}},{key:"getPasswordHelpClass",value:function(){var e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}},{key:"canRegister",value:function(){var e,t,n,r=null!==(e=this.registrationForm.value.password)&&void 0!==e?e:"";return!(""===(null!==(t=this.registrationForm.value.email)&&void 0!==t?t:"")||""===(null!==(n=this.registrationForm.value.username)&&void 0!==n?n:"")||""===r||r.length<6)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(Sre),QE(jL))},e.\u0275cmp=Gm({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){return[[1,"box"],[1,"title"],$localize(Mp||(Mp=wg(["Registering"]))),[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],$localize(Np||(Np=wg(["Email"]))),[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",$localize(Dp||(Dp=wg(["Email"]))),"type","email","autofocus","","required","",1,"input"],[1,"help"],$localize(Lp||(Lp=wg(["A confirmation email will be sent to validate your account."]))),["for","username",1,"label"],$localize(Fp||(Fp=wg(["Username"]))),["id","username","formControlName","username","name","username","placeholder",$localize(Up||(Up=wg(["Username"]))),"type","text","required","",1,"input"],["for","password",1,"label"],$localize(Bp||(Bp=wg(["Password"]))),[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",$localize(Vp||(Vp=wg(["Password"]))),"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],$localize(zp||(zp=wg(["The password should be at least 6 characters long"]))),["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],$localize(Hp||(Hp=wg(["Register"]))),[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],$localize(Gp||(Gp=wg(["Register with Google"]))),[1,"help","level-right"],$localize($p||($p=wg(["Have an account?"]))),[3,"routerLink"],$localize(Wp||(Wp=wg(["Log in"]))),["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],$localize(qp||(qp=wg(["Registration error"]))),["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"p",1),WP(2,2),tS(),eS(3,"form",3),eS(4,"div",4),eS(5,"div",5),eS(6,"label",6),WP(7,7),tS(),tS(),eS(8,"div",8),eS(9,"div",9),eS(10,"div",10),nS(11,"input",11),eS(12,"p",12),WP(13,13),tS(),tS(),tS(),tS(),tS(),eS(14,"div",4),eS(15,"div",5),eS(16,"label",14),WP(17,15),tS(),tS(),eS(18,"div",8),eS(19,"div",9),eS(20,"div",10),nS(21,"input",16),tS(),tS(),tS(),tS(),eS(22,"div",4),eS(23,"div",5),eS(24,"label",17),WP(25,18),tS(),tS(),eS(26,"div",8),eS(27,"div",9),eS(28,"div",19),nS(29,"input",20),eS(30,"span",21),nS(31,"fa-icon",22),tS(),eS(32,"p",23),WP(33,24),tS(),tS(),tS(),tS(),tS(),eS(34,"div",4),nS(35,"div",5),eS(36,"div",8),eS(37,"div",9),eS(38,"div",10),eS(39,"button",25),uS("click",function(){return t.registerWithEmail()}),WP(40,26),tS(),tS(),tS(),tS(),tS(),eS(41,"div",4),nS(42,"div",5),eS(43,"div",27),YE(44,wCe,5,1,"div",28),tS(),tS(),eS(45,"div",4),nS(46,"div",5),eS(47,"div",8),eS(48,"button",29),uS("click",function(){return t.registerWithGoogle()}),WP(49,30),tS(),tS(),tS(),eS(50,"p",31),rS(51),WP(52,32),iS(),FS(53,"\xa0 "),eS(54,"a",33),WP(55,34),tS(),tS(),tS(),tS()),2&e&&(pb(3),XE("formGroup",t.registrationForm),pb(28),XE("icon",t.faEye),pb(1),XE("ngClass",t.getPasswordHelpClass()),pb(7),XE("disabled",!t.canRegister()),pb(5),XE("ngIf",t.errorMessage),pb(10),XE("routerLink",aT(6,bCe)))},directives:[jR,pR,JR,Ux,vR,tM,Vme,hM,kae,zme,NA,UA,KL],encapsulation:2}),e}(),SCe=function(){var e=function(){function e(t){Wg(this,e),this.router=t}return jg(e,[{key:"pickGame",value:function(e){this.selectedGame=e}},{key:"playLocally",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.router.navigate(["local/"+e.selectedGame]);case 2:case"end":return t.stop()}},t)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL))},e.\u0275cmp=Gm({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){return[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],$localize(jp||(jp=wg(["Play offline"])))]},template:function(e,t){1&e&&(eS(0,"app-pick-game",0),uS("pickGame",function(e){return t.pickGame(e)}),tS(),eS(1,"button",1),uS("click",function(){return t.playLocally()}),WP(2,2),tS()),2&e&&(pb(1),XE("disabled",!t.selectedGame))},directives:[Dme],encapsulation:2}),e}(),PCe=function(){var e=function(){function e(t){Wg(this,e),this.router=t}return jg(e,[{key:"pickGame",value:function(e){this.selectedGame=e}},{key:"launchTutorial",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.router.navigate(["/tutorial/",e.selectedGame]);case 2:case"end":return t.stop()}},t)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(jL))},e.\u0275cmp=Gm({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){return[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],$localize(Zp||(Zp=wg(["Learn the rules"])))]},template:function(e,t){1&e&&(eS(0,"app-pick-game",0),uS("pickGame",function(e){return t.pickGame(e)}),tS(),eS(1,"button",1),uS("click",function(){return t.launchTutorial()}),WP(2,2),tS()),2&e&&(pb(1),XE("disabled",!t.selectedGame))},directives:[Dme],encapsulation:2}),e}(),OCe=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Gm({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){return[$localize(Yp||(Yp=wg(["The replay game is loading, please wait, it should not take long."])))]},template:function(e,t){1&e&&(eS(0,"p"),WP(1,0),tS())},encapsulation:2}),e}();function TCe(e,t){if(1&e&&(c_(),nS(0,"polygon",4)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessQueenComponent.HEPTAGON)}}function ICe(e,t){if(1&e&&(c_(),nS(0,"polygon",4)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessQueenComponent.EIGHT_POINTED_STAR)}}function ACe(e,t){if(1&e&&(c_(),nS(0,"circle",5)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.5*n.MartianChessComponent.SPACE_SIZE-n.MartianChessComponent.STROKE_WIDTH)}}function xCe(e,t){if(1&e&&(rS(0),c_(),nS(1,"circle",6),nS(2,"circle",6),nS(3,"circle",6),iS()),2&e){var n=hS();pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",n.MartianChessComponent.getRadius(3)),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",n.MartianChessComponent.getRadius(2)),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",n.MartianChessComponent.getRadius(1))}}function RCe(e,t){if(1&e&&(c_(),eS(0,"g"),nS(1,"circle",7),nS(2,"circle",7),nS(3,"circle",7),tS()),2&e){var n=hS();pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.45*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE),pb(1),$E("cx",.45*n.MartianChessComponent.SPACE_SIZE)("cy",.55*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE),pb(1),$E("cx",.55*n.MartianChessComponent.SPACE_SIZE)("cy",.55*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE)}}function MCe(e,t){if(1&e&&(c_(),eS(0,"g",8),nS(1,"circle",9),nS(2,"circle",9),nS(3,"circle",9),tS()),2&e){var n=hS();XE("ngClass",n.pieceClasses),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE-3*n.horizontalDotsRadius)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE+3*n.horizontalDotsRadius)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius)}}var NCe=jg(function e(){Wg(this,e),this.MartianChessQueenComponent=e,this.MartianChessComponent=Ode,this.horizontalDotsRadius=Ode.SPACE_SIZE/15});function DCe(e,t){if(1&e&&(c_(),nS(0,"polygon",4)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessDroneComponent.PENTAGON)}}function LCe(e,t){if(1&e&&(c_(),nS(0,"polygon",4)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessDroneComponent.FOUR_POINTED_STAR_VERTICAL)}}function FCe(e,t){if(1&e&&(c_(),nS(0,"circle",5)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.5*n.MartianChessComponent.SPACE_SIZE-n.MartianChessComponent.STROKE_WIDTH)}}function UCe(e,t){if(1&e&&(rS(0),c_(),nS(1,"circle",6),nS(2,"circle",6),iS()),2&e){var n=hS();pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",n.MartianChessComponent.getRadius(2)),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",n.MartianChessComponent.getRadius(1))}}function BCe(e,t){if(1&e&&(c_(),eS(0,"g",7),nS(1,"circle",8),nS(2,"circle",8),tS()),2&e){var n=hS();XE("ngClass",n.pieceClasses),pb(1),$E("cx",.4*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE),pb(1),$E("cx",.6*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE)}}function VCe(e,t){if(1&e&&(c_(),eS(0,"g",7),nS(1,"circle",9),nS(2,"circle",9),tS()),2&e){var n=hS();XE("ngClass",n.pieceClasses),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE-2*n.horizontalDotsRadius)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE+2*n.horizontalDotsRadius)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius)}}NCe.HEPTAGON=Ode.getRegularPolygon(7),NCe.EIGHT_POINTED_STAR=Ode.getNPointedStar(8,0),NCe.\u0275fac=function(e){return new(e||NCe)},NCe.\u0275cmp=Gm({type:NCe,selectors:[["","app-martian-chess-queen",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-queen",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(YE(0,TCe,1,3,"polygon",0),YE(1,ICe,1,3,"polygon",0),YE(2,ACe,1,5,"circle",1),YE(3,xCe,4,9,"ng-container",2),YE(4,RCe,4,9,"g",2),YE(5,MCe,4,10,"g",3)),2&e&&(XE("ngIf","Polygon"===t.style.shape),pb(1),XE("ngIf","Star"===t.style.shape),pb(1),XE("ngIf","Circle"===t.style.shape),pb(1),XE("ngIf","Concentric Circles"===t.style.points),pb(1),XE("ngIf","Dots"===t.style.points),pb(1),XE("ngIf","Horizontal Points"===t.style.points))},directives:[UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var zCe=jg(function e(){Wg(this,e),this.MartianChessComponent=Ode,this.MartianChessDroneComponent=e,this.horizontalDotsRadius=Ode.SPACE_SIZE/15});function HCe(e,t){if(1&e&&(c_(),nS(0,"polygon",5)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessPawnComponent.TRIANGLE)}}function GCe(e,t){if(1&e&&(c_(),nS(0,"polygon",5)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("points",n.MartianChessPawnComponent.FOUR_POINTED_STAR_DIAGONAL)}}function $Ce(e,t){if(1&e&&(c_(),nS(0,"circle",6)),2&e){var n=hS();XE("id",n.mainShapeId)("ngClass",n.pieceClasses),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.5*n.MartianChessComponent.SPACE_SIZE-n.MartianChessComponent.STROKE_WIDTH)}}function WCe(e,t){if(1&e&&(c_(),nS(0,"circle",7)),2&e){var n=hS();$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE+n.getConcreteTriangleYOffset())("r",n.MartianChessComponent.getRadius(1))}}function qCe(e,t){if(1&e&&(c_(),nS(0,"circle",8)),2&e){var n=hS();$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",.2/3*n.MartianChessComponent.SPACE_SIZE)}}function jCe(e,t){if(1&e&&(c_(),eS(0,"g",9),nS(1,"circle",10),tS()),2&e){var n=hS();XE("ngClass",n.pieceClasses),pb(1),$E("cx",.5*n.MartianChessComponent.SPACE_SIZE)("cy",.5*n.MartianChessComponent.SPACE_SIZE)("r",1.5*n.horizontalDotsRadius)}}zCe.FOUR_POINTED_STAR_VERTICAL=Ode.getNPointedStar(4,0),zCe.PENTAGON=Ode.getRegularPolygon(5),zCe.\u0275fac=function(e){return new(e||zCe)},zCe.\u0275cmp=Gm({type:zCe,selectors:[["","app-martian-chess-drone",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-drone",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[3,"ngClass"],[1,"base","mid-stroke"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(YE(0,DCe,1,3,"polygon",0),YE(1,LCe,1,3,"polygon",0),YE(2,FCe,1,5,"circle",1),YE(3,UCe,3,6,"ng-container",2),YE(4,BCe,3,7,"g",3),YE(5,VCe,3,7,"g",3)),2&e&&(XE("ngIf","Polygon"===t.style.shape),pb(1),XE("ngIf","Star"===t.style.shape),pb(1),XE("ngIf","Circle"===t.style.shape),pb(1),XE("ngIf","Concentric Circles"===t.style.points),pb(1),XE("ngIf","Dots"===t.style.points),pb(1),XE("ngIf","Horizontal Points"===t.style.points))},directives:[UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var ZCe=function(){function e(){Wg(this,e),this.MartianChessComponent=Ode,this.MartianChessPawnComponent=e,this.horizontalDotsRadius=Ode.SPACE_SIZE/15}return jg(e,[{key:"getConcreteTriangleYOffset",value:function(){return"Polygon"===this.style.shape?e.TRIANGLE_Y_OFFSET:0}}],[{key:"getTriangle",value:function(){return Ode.getRegularPolygon(3,e.TRIANGLE_Y_OFFSET)}},{key:"yOffsetForVerticalCentering",value:function(){var e=Ode.getRegularPolygonCoords(3).map(function(e){return e.y});return(e.reduce(function(e,t){return Math.min(e,t)})+(100-e.reduce(function(e,t){return Math.max(e,t)})))/4}}]),e}();ZCe.FOUR_POINTED_STAR_DIAGONAL=Ode.getNPointedStar(4,45),ZCe.TRIANGLE_Y_OFFSET=ZCe.yOffsetForVerticalCentering(),ZCe.TRIANGLE=ZCe.getTriangle(),ZCe.\u0275fac=function(e){return new(e||ZCe)},ZCe.\u0275cmp=Gm({type:ZCe,selectors:[["","app-martian-chess-pawn",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-pawn",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base mid-stroke",4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(YE(0,HCe,1,3,"polygon",0),YE(1,GCe,1,3,"polygon",0),YE(2,$Ce,1,5,"circle",1),YE(3,WCe,1,3,"circle",2),YE(4,qCe,1,3,"circle",3),YE(5,jCe,2,4,"g",4)),2&e&&(XE("ngIf","Polygon"===t.style.shape),pb(1),XE("ngIf","Star"===t.style.shape),pb(1),XE("ngIf","Circle"===t.style.shape),pb(1),XE("ngIf","Concentric Circles"===t.style.points),pb(1),XE("ngIf","Dots"===t.style.points),pb(1),XE("ngIf","Horizontal Points"===t.style.points))},directives:[UA,NA],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});var YCe={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1},KCe=function(){var e=function(){function e(t){Wg(this,e),this.authService=t}return jg(e,[{key:"canActivate",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){var n;e.userSub=e.authService.getUserObs().subscribe((n=iV(regeneratorRuntime.mark(function n(r){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.evaluateUserPermission(r).then(t);case 2:case"end":return n.stop()}},n)})),function(e){return n.apply(this,arguments)}))}));case 1:case"end":return t.stop()}},t)}))()}},{key:"ngOnDestroy",value:function(){this.userSub.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(pC(Sre))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),QCe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e)).router=r,i}return jg(n,[{key:"evaluateUserPermission",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account"));case 1:case"end":return n.stop()}},n)}))()}}]),n}(KCe);return e.\u0275fac=function(t){return new(t||e)(pC(Sre),pC(jL))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();function XCe(e,t){1&e&&(eS(0,"p",20),WP(1,21),tS())}function JCe(e,t){if(1&e){var n=aS();eS(0,"div",7),eS(1,"p",8),WP(2,9),tS(),eS(3,"div",10),eS(4,"p",11),WP(5,12),tS(),eS(6,"button",13),uS("click",function(){return Nk(n),hS().finalizeEmailVerification()}),WP(7,14),tS(),tS(),eS(8,"div",15),eS(9,"p",11),WP(10,16),tS(),eS(11,"button",17),uS("click",function(){return Nk(n),hS().sendEmailVerification()}),WP(12,18),tS(),tS(),YE(13,XCe,2,0,"p",19),tS()}if(2&e){var r=hS();pb(2),qP(r.emailAddress),jP(2),pb(11),XE("ngIf",r.success)}}function ewe(e,t){if(1&e){var n=aS();eS(0,"div",24),eS(1,"div",8),WP(2,25),tS(),eS(3,"form",26),eS(4,"div",27),eS(5,"div",28),nS(6,"input",29),tS(),eS(7,"div",28),eS(8,"button",30),uS("click",function(){Nk(n);var e=hS(2);return e.pickUsername(e.usernameForm.value)}),WP(9,31),tS(),tS(),tS(),tS(),tS()}if(2&e){var r=hS(2);pb(3),XE("formGroup",r.usernameForm)}}var twe=function(){return["/lobby"]};function nwe(e,t){1&e&&(eS(0,"div",32),GP(1,33),nS(2,"a",34),$P(),tS()),2&e&&(pb(2),XE("routerLink",aT(1,twe)))}function rwe(e,t){if(1&e&&(rS(0),YE(1,ewe,10,1,"div",22),YE(2,nwe,3,2,"div",23),iS()),2&e){var n=hS();pb(1),XE("ngIf",!n.success),pb(1),XE("ngIf",n.success)}}function iwe(e,t){if(1&e&&(eS(0,"div",35),eS(1,"div",36),FS(2),tS(),tS()),2&e){var n=hS();pb(2),US(n.errorMessage)}}var awe=function(){var e=function(){function e(t,n){Wg(this,e),this.authService=t,this.router=n,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new BR({username:new UR})}return jg(e,[{key:"ngOnInit",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.userSub=e.authService.getUserObs().subscribe(function(){var t=iV(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emailAddress=n.email.get(),!n.username.isAbsent()){t.next=5;break}e.verificationType="enter-username",t.next=11;break;case 5:if(e.verificationType="send-email",!0===e.triedToFinalize&&!1===n.verified&&(e.errorMessage=$localize(Kp||(Kp=wg(["You have not verified your email! Click on the link in the verification email."])))),t.t0=!0===n.verified,!t.t0){t.next=11;break}return t.next=11,e.router.navigate(["/lobby"]);case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t)}))()}},{key:"pickUsername",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.authService.setUsername(e.username);case 2:(r=n.sent).isSuccess()?t.success=!0:t.errorMessage=r.getReason();case 4:case"end":return n.stop()}},n)}))()}},{key:"sendEmailVerification",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.authService.sendEmailVerification();case 2:(n=t.sent).isSuccess()?e.success=!0:e.errorMessage=n.getReason();case 4:case"end":return t.stop()}},t)}))()}},{key:"finalizeEmailVerification",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.triedToFinalize=!0,t.next=3,e.authService.reloadUser();case 3:window.open(window.location.href,"_self");case 4:case"end":return t.stop()}},t)}))()}},{key:"ngOnDestroy",value:function(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(Sre),QE(jL))},e.\u0275cmp=Gm({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){return[[1,"box"],[1,"message","is-info"],[1,"message-header"],$localize(Qp||(Qp=wg(["Account verification"]))),["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],$localize(Xp||(Xp=wg(["In order to finalize your account, you must click on the link that you should have received on your email address (",":INTERPOLATION:). The email could be in your spam folder."])),"\ufffd0\ufffd"),[1,"block","level-left"],[1,"level-item"],$localize(Jp||(Jp=wg(["Once you have verified your email, click on the following button:"]))),["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],$localize(eg||(eg=wg(["Finalize email verification"]))),[1,"level-left"],$localize(tg||(tg=wg(["If you have not received the verification email, click on the following button:"]))),["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],$localize(ng||(ng=wg(["Send verification email again"]))),["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],$localize(rg||(rg=wg(["The email has been sent"]))),["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],$localize(ig||(ig=wg(["In order to finalize your account, you must choose a username."]))),[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",$localize(ag||(ag=wg(["Username"]))),"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],$localize(og||(og=wg(["Pick username"]))),["id","success",1,"message-body"],$localize(sg||(sg=wg(["Your account has now been finalized, you can go back to the ",":START_LINK:list of games",":CLOSE_LINK:."])),"\ufffd#2\ufffd","\ufffd/#2\ufffd"),[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"div",1),eS(2,"div",2),WP(3,3),tS(),YE(4,JCe,14,2,"div",4),YE(5,rwe,3,2,"ng-container",5),tS(),YE(6,iwe,3,1,"div",6),tS()),2&e&&(pb(4),XE("ngIf","send-email"===t.verificationType),pb(1),XE("ngIf","enter-username"===t.verificationType),pb(1),XE("ngIf",t.errorMessage))},directives:[UA,jR,pR,JR,Ux,hM,vR,tM,KL],encapsulation:2}),e}(),owe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e)).router=r,i}return jg(n,[{key:"evaluateUserPermission",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/"));case 1:case"end":return n.stop()}},n)}))()}}]),n}(KCe);return e.\u0275fac=function(t){return new(t||e)(pC(Sre),pC(jL))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),swe=function(){var e=function(e){Mg(n,e);var t=Dg(n);function n(e,r){var i;return Wg(this,n),(i=t.call(this,e)).router=r,i}return jg(n,[{key:"evaluateUserPermission",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",!1===e.isConnected()||t.router.parseUrl("/"));case 1:case"end":return n.stop()}},n)}))()}}]),n}(KCe);return e.\u0275fac=function(t){return new(t||e)(pC(Sre),pC(jL))},e.\u0275prov=dm({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();function uwe(e,t){1&e&&(eS(0,"p",12),WP(1,13),tS())}function cwe(e,t){if(1&e&&(eS(0,"div",14),eS(1,"div",15),WP(2,16),tS(),eS(3,"div",17),FS(4),tS(),tS()),2&e){var n=hS();pb(4),US(n.errorMessage.get())}}var lwe=function(){return{standalone:!0}},hwe=function(){var e=function(){function e(t){Wg(this,e),this.authService=t,this.success=!1,this.errorMessage=lV.empty(),this.email=""}return jg(e,[{key:"resetPassword",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M7(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=lV.empty(),e.success=!1,t.next=3,e.authService.sendPasswordResetEmail(e.email);case 3:(n=t.sent).isSuccess()?e.success=!0:e.errorMessage=lV.of(n.getReason());case 5:case"end":return t.stop()}},t)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(Sre))},e.\u0275cmp=Gm({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){return[[1,"box"],[1,"title"],$localize(ug||(ug=wg(["Password reset"]))),[1,"field"],[1,"control"],["id","email","name","email","placeholder",$localize(cg||(cg=wg(["Email"]))),"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],$localize(lg||(lg=wg(["An email will be sent with instruction to reset your password."]))),["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],$localize(hg||(hg=wg(["Reset password"]))),["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],$localize(fg||(fg=wg(["The email has been sent, please follow the instructions from that email."]))),["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],$localize(dg||(dg=wg(["Error"]))),["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"p",1),WP(2,2),tS(),eS(3,"div",3),eS(4,"div",4),eS(5,"input",5),uS("ngModelChange",function(e){return t.email=e}),tS(),eS(6,"p",6),WP(7,7),tS(),YE(8,uwe,2,0,"p",8),tS(),tS(),eS(9,"button",9),uS("click",function(){return t.resetPassword()}),WP(10,10),tS(),YE(11,cwe,5,1,"div",11),tS()),2&e&&(pb(5),XE("ngModel",t.email)("ngModelOptions",aT(5,lwe)),pb(3),XE("ngIf",t.success),pb(1),XE("disabled",""===t.email),pb(2),XE("ngIf",t.errorMessage.isPresent()))},directives:[Ux,Vme,hM,vR,qR,UA],encapsulation:2}),e}();function fwe(e,t){if(1&e&&(eS(0,"option",13),FS(1),tS()),2&e){var n=t.$implicit,r=hS();XE("value",n.value)("selected",n.value===r.currentTheme),pb(1),BS(" ",n.name," ")}}function dwe(e,t){if(1&e&&(eS(0,"option",13),FS(1),tS()),2&e){var n=t.$implicit,r=hS();XE("value",n.value)("selected",n.value===r.currentLanguage),pb(1),BS(" ",n.name," ")}}var vwe=function(){var e=function(){function e(t,n){Wg(this,e),this.userSettingsService=t,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize(vg||(vg=wg(["Light"])))},{value:"dark",name:$localize(pg||(pg=wg(["Dark"])))}],this.currentTheme=n.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}return jg(e,[{key:"changeLanguage",value:function(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}},{key:"changeTheme",value:function(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}},{key:"reload",value:function(){window.open(window.location.href,"_self")}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(Gre),QE($re))},e.\u0275cmp=Gm({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){return[[1,"box"],[1,"title"],$localize(gg||(gg=wg(["User settings"]))),[1,"field"],["for","theme",1,"label"],$localize(yg||(yg=wg(["Theme"]))),[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],$localize(mg||(mg=wg(["Language"]))),["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(eS(0,"div",0),eS(1,"p",1),WP(2,2),tS(),eS(3,"div",3),eS(4,"label",4),WP(5,5),tS(),eS(6,"div",6),eS(7,"div",7),eS(8,"select",8),uS("change",function(e){return t.changeTheme(e)}),YE(9,fwe,2,3,"option",9),tS(),tS(),tS(),tS(),eS(10,"div",3),eS(11,"label",10),WP(12,11),tS(),eS(13,"div",6),eS(14,"div",7),eS(15,"select",12),uS("change",function(e){return t.changeLanguage(e)}),YE(16,dwe,2,3,"option",9),tS(),tS(),tS(),tS(),tS()),2&e&&(pb(9),XE("ngForOf",t.availableThemes),pb(7),XE("ngForOf",t.availableLanguages))},directives:[LA,aM,cM],encapsulation:2}),e}(),pwe=function(){var e=jg(function e(){Wg(this,e)});return e.ALREADY_INGAME=function(){return $localize(kg||(kg=wg(["You are already in a game. Finish it or cancel it first."])))},e}(),gwe=function(){var e=function(){function e(t,n,r,i,a,o){Wg(this,e),this.route=t,this.router=n,this.connectedUserService=r,this.messageDisplayer=i,this.partDAO=a,this.gameService=o}return jg(e,[{key:"ngOnInit",value:function(){var e=this;return iV(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createGameAndRedirectOrShowError(e.extractGameFromURL());case 2:case"end":return t.stop()}},t)}))()}},{key:"extractGameFromURL",value:function(){return aV.getNonNullable(this.route.snapshot.paramMap.get("compo"))}},{key:"createGameAndRedirectOrShowError",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){var r,i,a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(M7((r=t.connectedUserService.user.get()).isConnected(),"User must be connected and have a username to reach this page"),i=r.toMinimalUser(),!1!==t.gameExists(e)){n.next=7;break}return n.next=6,t.router.navigate(["/notFound",gke.NO_MATCHING_GAME(e)],{skipLocationChange:!0});case 6:return n.abrupt("return",!1);case 7:return n.next=9,t.canCreateOnlineGame(i.name);case 9:if(!n.sent){n.next=16;break}return n.next=12,t.gameService.createPartJoinerAndChat(i,e);case 12:return a=n.sent,n.next=15,t.router.navigate(["/play",e,a]);case 15:return n.abrupt("return",!0);case 16:return t.messageDisplayer.infoMessage(pwe.ALREADY_INGAME()),n.next=19,t.router.navigate(["/lobby"]);case 19:return n.abrupt("return",!1);case 20:case"end":return n.stop()}},n)}))()}},{key:"gameExists",value:function(e){return lV.ofNullable(Nme.ALL_GAMES().find(function(t){return t.urlName===e})).isPresent()}},{key:"canCreateOnlineGame",value:function(e){var t=this;return iV(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=!1,n.next=3,t.partDAO.userHasActivePart(e);case 3:return n.t1=n.sent,n.abrupt("return",n.t0===n.t1);case 5:case"end":return n.stop()}},n)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(QE(PD),QE(jL),QE(Sre),QE(x7),QE(L7),QE(zre))},e.\u0275cmp=Gm({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){return[$localize(_g||(_g=wg(["Creating online game, please wait, it should not take long."])))]},template:function(e,t){1&e&&(eS(0,"p"),WP(1,0),tS())},encapsulation:2}),e}();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[YS.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),WS[t]=e,n&&(WS[t][YS.ExtraData]=n)}(e,void 0,void 0)}(nV());var ywe=[{path:"login",component:Wme},{path:"lobby",component:fke,canActivate:[QCe]},{path:"settings",component:vwe},{path:"register",component:ECe,canActivate:[swe]},{path:"reset-password",component:hwe,canActivate:[swe]},{path:"notFound/:message",component:dke},{path:"nextGameLoading",component:OCe,canActivate:[QCe]},{path:"verify-account",component:awe,canActivate:[owe]},{path:"play",component:jme,canActivate:[QCe]},{path:"play/:compo",component:gwe,canActivate:[QCe]},{path:"play/:compo/:id",component:U_e,canActivate:[QCe]},{path:"local",component:SCe},{path:"local/:compo",component:rCe},{path:"tutorial",component:PCe},{path:"tutorial/:compo",component:CCe},{path:"",component:Bme},{path:"**",component:dke}],mwe=function(){function e(){Wg(this,e)}return jg(e,null,[{key:"app",value:function(){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{ngModule:XW,providers:[{provide:ZW,useFactory:QW(e),multi:!0,deps:[eI,IE,BW].concat(n)}]}}(function(){return YCe.useEmulators&&(YCe.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),JW(YCe.firebaseConfig)})}},{key:"firestore",value:function(){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{ngModule:u7,providers:[{provide:i7,useFactory:a7(e),multi:!0,deps:[eI,IE,BW,jW,[new bC,jY],[new bC,Rq]].concat(n)}]}}(function(){var e=g7(),t=e.toJSON().settings.host;return YCe.useEmulators&&"localhost:8080"!==t&&h7(e,"localhost",8080),e})}},{key:"database",value:function(){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{ngModule:gre,providers:[{provide:fre,useFactory:dre(e),multi:!0,deps:[eI,IE,BW,jW,[new bC,jY],[new bC,Rq]].concat(n)}]}}(function(){var e=mre();return YCe.useEmulators&&!1===e._instanceStarted&&yre(e,"localhost",9e3),e})}},{key:"auth",value:function(){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return{ngModule:JY,providers:[{provide:ZY,useFactory:YY(e),multi:!0,deps:[eI,IE,BW,jW,[new bC,Rq]].concat(n)}]}}(function(){var e=nK();return YCe.useEmulators&&null==e.config.emulator&&eK(e,"http://localhost:9099",{disableWarnings:!0}),e})}}]),e}(),kwe=function(){var e=jg(function e(){Wg(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=jm({type:e,bootstrap:[Rae]}),e.\u0275inj=vm({providers:[Sre,zre,Vre,G7,B7,L7,$re,{provide:HT,useValue:Hre.getLocale()}],imports:[[mwe.app(),mwe.firestore(),mwe.auth(),mwe.database(),Ex,eN,uF.forRoot(ywe,{useHash:!1}),gM,pM,eV,_ae]]}),e}();!function(e,t,n){var r=e.\u0275cmp;r.directiveDefs=function(){return t.map($m)},r.pipeDefs=function(){return n.map(Wm)}}(Ode,[LA,NA,UA,ZCe,zCe,NCe],[]),"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,"undefined"!=typeof global&&global;var _we=function(){function e(t){Wg(this,e),this.digits=t}return jg(e,[{key:"clone",value:function(){return new e(this.digits.slice())}},{key:"add",value:function(e){var t=this.clone();return t.addToSelf(e),t}},{key:"addToSelf",value:function(e){for(var t=Math.max(this.digits.length,e.digits.length),n=0,r=0;r<t;r++){var i=n;r<this.digits.length&&(i+=this.digits[r]),r<e.digits.length&&(i+=e.digits[r]),i>=10?(this.digits[r]=i-10,n=1):(this.digits[r]=i,n=0)}n>0&&(this.digits[t]=1)}},{key:"toString",value:function(){for(var e="",t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}],[{key:"zero",value:function(){return new e([0])}},{key:"one",value:function(){return new e([1])}}]),e}(),Cwe=function(){function e(t){Wg(this,e),this.powerOfTwos=[t]}return jg(e,[{key:"getValue",value:function(){return this.powerOfTwos[0]}},{key:"multiplyBy",value:function(e){var t=_we.zero();return this.multiplyByAndAddTo(e,t),t}},{key:"multiplyByAndAddTo",value:function(e,t){for(var n=0;0!==e;e>>>=1,n++)if(1&e){var r=this.getMultipliedByPowerOfTwo(n);t.addToSelf(r)}}},{key:"getMultipliedByPowerOfTwo",value:function(e){for(var t=this.powerOfTwos.length;t<=e;t++){var n=this.powerOfTwos[t-1];this.powerOfTwos[t]=n.add(n)}return this.powerOfTwos[e]}}]),e}(),wwe=function(){function e(t){Wg(this,e),this.base=t,this.exponents=[new Cwe(_we.one())]}return jg(e,[{key:"toThePowerOf",value:function(e){for(var t=this.exponents.length;t<=e;t++){var n=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new Cwe(n)}return this.exponents[e]}}]),e}();function bwe(e){var t=function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){var i=e.charCodeAt(n+1);i>=56320&&i<=57343&&(n++,r=(r-55296<<10)+i-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e),n=Ewe(t,0),r=Ewe(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function Ewe(e,t){var n,r=2654435769,i=2654435769,a=e.length;for(n=0;n+12<=a;n+=12){var o=Swe(r=Owe(r,xwe(e,n,Pwe.Little)),i=Owe(i,xwe(e,n+4,Pwe.Little)),t=Owe(t,xwe(e,n+8,Pwe.Little)));r=o[0],i=o[1],t=o[2]}return r=Owe(r,xwe(e,n,Pwe.Little)),i=Owe(i,xwe(e,n+4,Pwe.Little)),t=Owe(t,a),Swe(r,i,t=Owe(t,xwe(e,n+8,Pwe.Little)<<8))[2]}function Swe(e,t,n){return e=Iwe(e,t),e=Iwe(e,n),e^=n>>>13,t=Iwe(t,n),t=Iwe(t,e),t^=e<<8,n=Iwe(n,e),n=Iwe(n,t),n^=t>>>13,e=Iwe(e,t),e=Iwe(e,n),e^=n>>>12,t=Iwe(t,n),t=Iwe(t,e),t^=e<<16,n=Iwe(n,e),n=Iwe(n,t),n^=t>>>5,e=Iwe(e,t),e=Iwe(e,n),e^=n>>>3,t=Iwe(t,n),t=Iwe(t,e),t^=e<<10,n=Iwe(n,e),n=Iwe(n,t),[e,t,n^=t>>>15]}var Pwe=((Pwe=Pwe||{})[Pwe.Little=0]="Little",Pwe[Pwe.Big=1]="Big",Pwe);function Owe(e,t){return Twe(e,t)[1]}function Twe(e,t){var n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function Iwe(e,t){var n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function Awe(e,t){return t>=e.length?0:e[t]}function xwe(e,t,n){var r=0;if(n===Pwe.Big)for(var i=0;i<4;i++)r+=Awe(e,t+i)<<24-8*i;else for(var a=0;a<4;a++)r+=Awe(e,t+a)<<8*a;return r}var Rwe=new wwe(256);function Mwe(e,t){if(":"!==t.charAt(0))return{text:e};var n=function(e,t){for(var n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error('Unterminated $localize metadata block in "'.concat(t,'".'))}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}function Nwe(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});var Dwe=function(e){Mg(n,e);var t=Dg(n);function n(e){var r;return Wg(this,n),(r=t.call(this,"No translation found for ".concat(Fwe(e),"."))).parsedMessage=e,r.type="MissingTranslationError",r}return jg(n)}(Ig(Error));function Lwe(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function Fwe(e){var t=e.meaning&&' - "'.concat(e.meaning,'"'),n=e.legacyIds&&e.legacyIds.length>0?" [".concat(e.legacyIds.map(function(e){return'"'.concat(e,'"')}).join(", "),"]"):"";return'"'.concat(e.id,'"').concat(n,' ("').concat(e.text,'"').concat(t,")")}function Uwe(e,t){try{return function(e,t,n){var r=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a={},o={},s=function(e,t){var n=Mwe(e,t),r=n.text,i=n.block;if(void 0===i)return{text:r};var a=Cg(i.split("\u241f")),o=a[0],s=a.slice(1),u=Pg(o.split("@@",2),2),c=u[0],l=u[1],h=Pg(c.split("|",2),2),f=h[0],d=h[1];return void 0===d&&(d=f,f=void 0),""===d&&(d=void 0),{text:r,meaning:f,description:d,customId:l,legacyIds:s}}(e[0],e.raw[0]),u=[s.text],c=[],l=s.text,h=1;h<e.length;h++){var f=Mwe(e[h],e.raw[h]),d=f.text,v=f.block,p=void 0===v?Nwe(h):v;l+="{$".concat(p,"}").concat(d),void 0!==t&&(a[p]=t[h-1],o[p]=i[h-1]),c.push(p),u.push(d)}var g=s.customId||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=bwe(e);if(t){var r=bwe(t);n=function(e,t){var n=e[0],r=t[0],i=Twe(e[1],t[1]),a=i[0],o=i[1];return[Owe(Owe(n,r),a),o]}(function(e,t){var n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),r)}return function(e,t){var n=Rwe.toThePowerOf(0).multiplyBy(t);return Rwe.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(l,s.meaning||""),y=s.legacyIds?s.legacyIds.filter(function(e){return e!==g}):[];return{id:g,legacyIds:y,substitutions:a,substitutionLocations:o,text:l,customId:s.customId,meaning:s.meaning||"",description:s.description||"",messageParts:u,messagePartLocations:r,placeholderNames:c,location:n}}(t,n),i=e[r.id];if(void 0!==r.legacyIds)for(var a=0;a<r.legacyIds.length&&void 0===i;a++)i=e[r.legacyIds[a]];if(void 0===i)throw new Dwe(r);return[i.messageParts,i.placeholderNames.map(function(e){if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error("There is a placeholder name mismatch with the translation provided for the message ".concat(Fwe(r),".\nThe translation contains a placeholder with name ").concat(e,", which does not exist in the message."))})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function Bwe(){YCe.production&&function(){if(fI)throw new Error("Cannot enable prod mode after platform setup.");hI=!1}(),wx().bootstrapModule(kwe).catch(function(e){return console.error(e)})}var Vwe=Hre.getLocale();"en"!==Vwe?fetch(YCe.root+"assets/"+Vwe+".json").then(function(e){return e.ok?e.json():{locale:"en",translations:{}}}).then(function(e){(function(e){$localize.translate||($localize.translate=Uwe),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(function(t){$localize.TRANSLATIONS[t]=function(e){for(var t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[],i=1;i<t.length-1;i+=2)r.push(t[i]),n.push("".concat(t[i+1]));var a=n.map(function(e){return":"===e.charAt(0)?"\\"+e:e});return{text:e,messageParts:Lwe(n,a),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,Bwe()}).catch(function(e){console.log(e)}):Bwe()}},function(e){e(e.s=4378)}])}();