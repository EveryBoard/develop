(self.webpackChunkEveryBoard=self.webpackChunkEveryBoard||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},2616:function(e,t,n){var r,i,s;!function(o){if("object"==typeof e.exports){var a=o(0,t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0!==(s="function"==typeof(r=o)?r.apply(t,i):r)&&(e.exports=s)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=void 0;t.default=["fr",[["AM","PM"],n,n],n,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],n,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]],n,[["av. J.-C.","ap. J.-C."],n,["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1} '\xe0' {0}",n,n],[",","\u202f",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[n,"\xa5"],COP:["$CO","$"],CYP:["\xa3CY"],EGP:[n,"\xa3E"],FJD:["$FJ","$"],FKP:["\xa3FK","\xa3"],FRF:["F"],GBP:["\xa3GB","\xa3"],GIP:["\xa3GI","\xa3"],HKD:[n,"$"],IEP:["\xa3IE"],ILP:["\xa3IL"],ITL:["\u20a4IT"],JPY:[n,"\xa5"],KMF:[n,"FC"],LBP:["\xa3LB","\xa3L"],MTP:["\xa3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[n,"$C"],NZD:["$NZ","$"],RHD:["$RH"],RON:[n,"L"],RWF:[n,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[n,"$T"],TTD:["$TT","$"],TWD:[n,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[n,"$"],XPF:["FCFP"],ZMW:[n,"Kw"]},"ltr",function(e){var t=Math.floor(Math.abs(e));return 0===t||1===t?1:5}]})},811:function(e,t){!function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n,r=1;r<arguments.length;r++)n=arguments[r]??{},r%2?t(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))});return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){var e;return null!==(e=h)&&void 0!==e?e:document}var l={duration:2e3,position:"top-right",closeOnClick:!0,opacity:1,single:!1,offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,extraClasses:""},c=n({},l),u={},h=null,d=function(e,t,n,r,i){return"top-left"===e?"left:".concat(r,";top:").concat(t,";text-align:left;align-items:flex-start;"):"top-right"===e?"right:".concat(i,";top:").concat(t,";text-align:right;align-items:flex-end;"):"top-center"===e?"top:".concat(t,";left:0;right:0;text-align:center;align-items:center;"):"bottom-left"===e?"left:".concat(r,";bottom:").concat(n,";text-align:left;align-items:flex-start;"):"bottom-right"===e?"right:".concat(i,";bottom:").concat(n,";text-align:right;align-items:flex-end;"):"bottom-center"===e?"bottom:".concat(n,";left:0;right:0;text-align:center;align-items:center;"):"center"===e?"top:0;left:0;right:0;bottom:0;flex-flow:column;justify-content:center;align-items:center;":void 0},p=function(){function e(t){var n=this;r(this,e),this.element=a().createElement("div"),this.opacity=t.opacity,this.type=t.type,this.animate=t.animate,this.dismissible=t.dismissible,this.closeOnClick=t.closeOnClick,this.message=t.message,this.duration=t.duration,this.pauseOnHover=t.pauseOnHover,this.offsetTop=t.offsetTop,this.offsetBottom=t.offsetBottom,this.offsetLeft=t.offsetLeft,this.offsetRight=t.offsetRight,this.extraClasses=t.extraClasses;var i="width:auto;pointer-events:auto;display:inline-flex;white-space:pre-wrap;opacity:".concat(this.opacity,";"),s=["notification",this.extraClasses];if(this.type&&s.push(this.type),this.animate&&this.animate.in){var o="animate__".concat(this.animate.in),l=this.animate.speed?"animate__".concat(this.animate.speed):"animate__faster";s.push("animate__animated ".concat(o," ").concat(l)),this.onAnimationEnd(function(){return n.element.classList.remove(o)})}if(this.element.className=s.join(" "),this.dismissible){var c=a().createElement("button");c.className="delete",c.addEventListener("click",function(){n.destroy()}),this.element.insertAdjacentElement("afterbegin",c)}else i+="padding: 1.25rem 1.5rem";this.closeOnClick&&this.element.addEventListener("click",function(){n.destroy()}),this.element.setAttribute("style",i),"string"==typeof this.message?this.element.insertAdjacentHTML("beforeend",this.message):this.element.appendChild(this.message);var u=new f(function(){n.destroy()},this.duration);this.pauseOnHover&&(this.element.addEventListener("mouseover",function(){u.pause()}),this.element.addEventListener("mouseout",function(){u.resume()}))}return s(e,[{key:"destroy",value:function(){var e=this;this.animate&&this.animate.out?(this.element.classList.add("animate__".concat(this.animate.out)),this.onAnimationEnd(function(){e.removeParent(e.element.parentNode),e.element.remove(),delete u.position})):(this.removeParent(this.element.parentNode),this.element.remove(),delete u.position)}},{key:"removeParent",value:function(e){e&&1>=e.children.length&&e.remove()}},{key:"onAnimationEnd",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==this.element.style[n]){this.element.addEventListener(t[n],function(){return e()});break}}}]),e}(),f=function(){function e(t,n){r(this,e),this.remaining=n,this.callback=t,this.resume()}return s(e,[{key:"pause",value:function(){"undefined"==typeof document||(window.clearTimeout(this.timer),this.remaining-=new Date-this.start)}},{key:"resume",value:function(){"undefined"==typeof document||(this.start=new Date,window.clearTimeout(this.timer),this.timer=window.setTimeout(this.callback,this.remaining))}}]),e}();e.resetDefaults=function(){c=n({},l)},e.setDefaults=function(e){c=n(n({},l),e)},e.setDoc=function(e){for(var t in u)u[t].remove();u={},h=e},e.toast=function(e){if(!e.message)throw new Error("message is required");var t=n(n({},c),e),r=new p(t),i=function(e,t,n,r,i,s){if(u.position)return u.position;var o=a().createElement("div");return o.setAttribute("style","width:100%;z-index:99999;position:fixed;pointer-events:none;display:flex;flex-direction:column;padding:15px;"+d(t,n,r,i,s)),e.appendChild(o),u.position=o,o}(t.appendTo||a().body,t.position||c.position,t.offsetTop||c.offsetTop,t.offsetBottom||c.offsetBottom,t.offsetLeft||c.offsetLeft,t.offsetRight||c.offsetRight);if(t.single)for(var s=i.lastElementChild;s;)i.removeChild(s),s=i.lastElementChild;i.appendChild(r.element)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},6711:function(e,t,n){"use strict";function r(e){return"function"==typeof e}function i(e){const t=e(e=>{Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const s=i(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function o(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class a{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const e of i)e.remove(this);else i.remove(this);const{initialTeardown:o}=this;if(r(o))try{o()}catch(t){e=t instanceof s?t.errors:[t]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const t of a)try{u(t)}catch(n){e=e??[],n instanceof s?e=[...e,...n.errors]:e.push(n)}}if(e)throw new s(e)}}add(e){var t;if(e&&e!==this)if(this.closed)u(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&o(t,e)}remove(e){const{_teardowns:t}=this;t&&o(t,e),e instanceof a&&e._removeParent(this)}}a.EMPTY=(()=>{const e=new a;return e.closed=!0,e})();const l=a.EMPTY;function c(e){return e instanceof a||e&&"closed"in e&&r(e.remove)&&r(e.add)&&r(e.unsubscribe)}function u(e){r(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function p(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function f(){}const g=m("C",void 0,void 0);function m(e,t,n){return{kind:e,value:t,error:n}}let y=null;function v(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!y;if(t&&(y={errorThrown:!1,error:null}),e(),t){const{errorThrown:e,error:t}=y;if(y=null,e)throw t}}else e()}class _ extends a{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,c(e)&&e.add(this)):this.destination=S}static create(e,t,n){return new C(e,t,n)}next(e){this.isStopped?b(m("N",e,void 0),this):this._next(e)}error(e){this.isStopped?b(m("E",void 0,e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?b(g,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class C extends _{constructor(e,t,n){let i;if(super(),r(e))i=e;else if(e){let r;({next:i,error:t,complete:n}=e),this&&h.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe()):r=e,i=null==i?void 0:i.bind(r),t=null==t?void 0:t.bind(r),n=null==n?void 0:n.bind(r)}this.destination={next:i?E(i):f,error:E(t??w),complete:n?E(n):f}}}function E(e,t){return(...t)=>{try{e(...t)}catch(n){h.useDeprecatedSynchronousErrorHandling?function(e){h.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):p(n)}}}function w(e){throw e}function b(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const S={closed:!0,next:f,error:w,complete:f},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function O(e){return e}let T=(()=>{class e{constructor(e){e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const i=function(e){return e&&e instanceof _||function(e){return e&&r(e.next)&&r(e.error)&&r(e.complete)}(e)&&c(e)}(e)?e:new C(e,t,n);return v(()=>{const{operator:e,source:t}=this;i.add(e?e.call(i,t):t?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return new(t=I(t))((t,n)=>{const r=new C({next:t=>{try{e(t)}catch(i){n(i),r.unsubscribe()}},error:n,complete:t});this.subscribe(r)})}_subscribe(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)}[P](){return this}pipe(...e){return function(e){return 0===e.length?O:1===e.length?e[0]:function(t){return e.reduce((e,t)=>t(e),t)}}(e)(this)}toPromise(e){return new(e=I(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function I(e){var t;return null!==(t=e??h.Promise)&&void 0!==t?t:Promise}const k=i(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let A=(()=>{class e extends T{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const t=new M(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new k}next(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){const t=this.observers.slice();for(const n of t)n.next(e)}})}error(e){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){v(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:t,isStopped:n,observers:r}=this;return t||n?l:(r.push(e),new a(()=>o(r,e)))}_checkFinalizedStatuses(e){const{hasError:t,thrownError:n,isStopped:r}=this;t?e.error(n):r&&e.complete()}asObservable(){const e=new T;return e.source=this,e}}return e.create=(e,t)=>new M(e,t),e})();class M extends A{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:l}}function N(e){return r(null==e?void 0:e.lift)}function R(e){return t=>{if(N(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class x extends _{constructor(e,t,n,r,i){super(e),this.onFinalize=i,this._next=t?function(n){try{t(n)}catch(r){e.error(r)}}:super._next,this._error=r?function(t){try{r(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}function D(e,t){return R((n,r)=>{let i=0;n.subscribe(new x(r,n=>{r.next(e.call(t,n,i++))}))})}function L(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function U(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(l,c):u(s[0][2],e)}(i[e](t))}catch(n){u(s[0][3],n)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function B(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}const V=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $(e){return r(null==e?void 0:e.then)}function z(e){return r(e[P])}function H(e){return Symbol.asyncIterator&&r(null==e?void 0:e[Symbol.asyncIterator])}function G(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const W="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function q(e){return r(null==e?void 0:e[W])}function j(e){return U(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:e,done:n}=yield F(t.read());if(n)return yield F(void 0);yield yield F(e)}}finally{t.releaseLock()}})}function Z(e){return r(null==e?void 0:e.getReader)}function Y(e){if(e instanceof T)return e;if(null!=e){if(z(e))return function(e){return new T(t=>{const n=e[P]();if(r(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(V(e))return function(e){return new T(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($(e))return function(e){return new T(t=>{e.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,p)})}(e);if(H(e))return K(e);if(q(e))return function(e){return new T(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Z(e))return function(e){return K(j(e))}(e)}throw G(e)}function K(e){return new T(t=>{(function(e,t){var n,r,i,s;return function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=B(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(e=>t.error(e))})}function Q(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function X(e,t,n=1/0){return r(t)?X((n,r)=>D((e,i)=>t(n,e,r,i))(Y(e(n,r))),n):("number"==typeof t&&(n=t),R((t,r)=>function(e,t,n,r,i,s,o,a){const l=[];let c=0,u=0,h=!1;const d=()=>{h&&!l.length&&!c&&t.complete()},p=e=>c<r?f(e):l.push(e),f=e=>{c++;let i=!1;Y(n(e,u++)).subscribe(new x(t,e=>{t.next(e)},()=>{i=!0},void 0,()=>{if(i)try{for(c--;l.length&&c<r;){const e=l.shift();f(e)}d()}catch(e){t.error(e)}}))};return e.subscribe(new x(t,p,()=>{h=!0,d()})),()=>{}}(t,r,e,n)))}function J(e=1/0){return X(O,e)}const ee=new T(e=>e.complete());function te(e){return e[e.length-1]}function ne(e){return r(te(e))?e.pop():void 0}function re(e){return function(e){return e&&r(e.schedule)}(te(e))?e.pop():void 0}function ie(e,t=0){return R((n,r)=>{n.subscribe(new x(r,n=>Q(r,e,()=>r.next(n),t),()=>Q(r,e,()=>r.complete(),t),n=>Q(r,e,()=>r.error(n),t)))})}function se(e,t=0){return R((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new T(n=>{Q(n,t,()=>{const r=e[Symbol.asyncIterator]();Q(n,t,()=>{r.next().then(e=>{e.done?n.complete():n.next(e.value)})},0,!0)})})}function ae(e,t){return t?function(e,t){if(null!=e){if(z(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(V(e))return function(e,t){return new T(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if($(e))return function(e,t){return Y(e).pipe(se(t),ie(t))}(e,t);if(H(e))return oe(e,t);if(q(e))return function(e,t){return new T(n=>{let i;return Q(n,t,()=>{i=e[W](),Q(n,t,()=>{let e,t;try{({value:e,done:t}=i.next())}catch(r){return void n.error(r)}t?n.complete():n.next(e)},0,!0)}),()=>r(null==i?void 0:i.return)&&i.return()})}(e,t);if(Z(e))return function(e,t){return oe(j(e),t)}(e,t)}throw G(e)}(e,t):Y(e)}function le(e){return e<=0?()=>ee:R((t,n)=>{let r=0;t.subscribe(new x(n,t=>{++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function ce(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(le(1)).subscribe(()=>e())}function ue(e){for(let t in e)if(e[t]===ue)return t;throw Error("Could not find renamed property on target object.")}function he(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function de(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(de).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function pe(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const fe=ue({__forward_ref__:ue});function ge(e){return e.__forward_ref__=ge,e.toString=function(){return de(this())},e}function me(e){return ye(e)?e():e}function ye(e){return"function"==typeof e&&e.hasOwnProperty(fe)&&e.__forward_ref__===ge}class ve extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function _e(e){return"string"==typeof e?e:null==e?"":String(e)}function Ce(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_e(e)}function Ee(e,t){const n=t?` in ${t}`:"";throw new ve("201",`No provider for ${Ce(e)} found${n}`)}function we(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}function be(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Se(e){return{providers:e.providers||[],imports:e.imports||[]}}function Pe(e){return Oe(e,Ie)||Oe(e,Ae)}function Oe(e,t){return e.hasOwnProperty(t)?e[t]:null}function Te(e){return e&&(e.hasOwnProperty(ke)||e.hasOwnProperty(Me))?e[ke]:null}const Ie=ue({"\u0275prov":ue}),ke=ue({"\u0275inj":ue}),Ae=ue({ngInjectableDef:ue}),Me=ue({ngInjectorDef:ue});var Ne=(()=>((Ne=Ne||{})[Ne.Default=0]="Default",Ne[Ne.Host=1]="Host",Ne[Ne.Self=2]="Self",Ne[Ne.SkipSelf=4]="SkipSelf",Ne[Ne.Optional=8]="Optional",Ne))();let Re;function xe(e){const t=Re;return Re=e,t}function De(e,t,n){const r=Pe(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Ne.Optional?null:void 0!==t?t:void Ee(de(e),"Injector")}function Le(e){return{toString:e}.toString()}var Fe=(()=>((Fe=Fe||{})[Fe.OnPush=0]="OnPush",Fe[Fe.Default=1]="Default",Fe))(),Ue=(()=>((Ue=Ue||{})[Ue.Emulated=0]="Emulated",Ue[Ue.None=2]="None",Ue[Ue.ShadowDom=3]="ShadowDom",Ue))();const Be="undefined"!=typeof globalThis&&globalThis,Ve="undefined"!=typeof window&&window,$e="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ze=Be||"undefined"!=typeof global&&global||Ve||$e,He={},Ge=[],We=ue({"\u0275cmp":ue}),qe=ue({"\u0275dir":ue}),je=ue({"\u0275pipe":ue}),Ze=ue({"\u0275mod":ue}),Ye=ue({"\u0275loc":ue}),Ke=ue({"\u0275fac":ue}),Qe=ue({__NG_ELEMENT_ID__:ue});let Xe=0;function Je(e){return Le(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Fe.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Ge,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Ue.Emulated,id:"c",styles:e.styles||Ge,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,s=e.pipes;return n.id+=Xe++,n.inputs=it(e.inputs,t),n.outputs=it(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(et):null,n.pipeDefs=s?()=>("function"==typeof s?s():s).map(tt):null,n})}function et(e){return at(e)||function(e){return e[qe]||null}(e)}function tt(e){return function(e){return e[je]||null}(e)}const nt={};function rt(e){return Le(()=>{const t={type:e.type,bootstrap:e.bootstrap||Ge,declarations:e.declarations||Ge,imports:e.imports||Ge,exports:e.exports||Ge,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(nt[e.id]=e.type),t})}function it(e,t){if(null==e)return He;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}const st=Je;function ot(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function at(e){return e[We]||null}function lt(e,t){const n=e[Ze]||null;if(!n&&!0===t)throw new Error(`Type ${de(e)} does not have '\u0275mod' property.`);return n}function ct(e){return Array.isArray(e)&&"object"==typeof e[1]}function ut(e){return Array.isArray(e)&&!0===e[1]}function ht(e){return 0!=(8&e.flags)}function dt(e){return 2==(2&e.flags)}function pt(e){return 1==(1&e.flags)}function ft(e){return null!==e.template}function gt(e){return 0!=(512&e[2])}function mt(e,t){return e.hasOwnProperty(Ke)?e[Ke]:null}class yt{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function vt(){return _t}function _t(e){return e.type.prototype.ngOnChanges&&(e.setInput=Et),Ct}function Ct(){const e=bt(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===He)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function Et(e,t,n,r){const i=bt(e)||function(e,t){return e[wt]=t}(e,{previous:He,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[n],l=o[a];s[a]=new yt(l&&l.currentValue,t,o===He),e[r]=t}vt.ngInherit=!0;const wt="__ngSimpleChanges__";function bt(e){return e[wt]||null}const St="http://www.w3.org/2000/svg";let Pt;function Ot(){return void 0!==Pt?Pt:"undefined"!=typeof document?document:void 0}function Tt(e){return!!e.listen}const It={createRenderer:(e,t)=>Ot()};function kt(e){for(;Array.isArray(e);)e=e[0];return e}function At(e,t){return kt(t[e])}function Mt(e,t){return kt(t[e.index])}function Nt(e,t){return e.data[t]}function Rt(e,t){return e[t]}function xt(e,t){const n=t[e];return ct(n)?n:n[0]}function Dt(e){return 4==(4&e[2])}function Lt(e){return 128==(128&e[2])}function Ft(e,t){return null==t?null:e[t]}function Ut(e){e[18]=0}function Bt(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Vt={lFrame:pn(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function $t(){return Vt.bindingsEnabled}function zt(){return Vt.lFrame.lView}function Ht(){return Vt.lFrame.tView}function Gt(e){return Vt.lFrame.contextLView=e,e[8]}function Wt(){let e=qt();for(;null!==e&&64===e.type;)e=e.parent;return e}function qt(){return Vt.lFrame.currentTNode}function jt(){const e=Vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Zt(e,t){const n=Vt.lFrame;n.currentTNode=e,n.isParent=t}function Yt(){return Vt.lFrame.isParent}function Kt(){Vt.lFrame.isParent=!1}function Qt(){return Vt.isInCheckNoChangesMode}function Xt(e){Vt.isInCheckNoChangesMode=e}function Jt(){const e=Vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function en(){return Vt.lFrame.bindingIndex}function tn(){return Vt.lFrame.bindingIndex++}function nn(e){const t=Vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function rn(e){Vt.lFrame.inI18n=e}function sn(e,t){const n=Vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,on(t)}function on(e){Vt.lFrame.currentDirectiveIndex=e}function an(){return Vt.lFrame.currentQueryIndex}function ln(e){Vt.lFrame.currentQueryIndex=e}function cn(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function un(e,t,n){if(n&Ne.SkipSelf){let r=t,i=e;for(;!(r=r.parent,null!==r||n&Ne.Host||(r=cn(i),null===r||(i=i[15],10&r.type))););if(null===r)return!1;t=r,e=i}const r=Vt.lFrame=dn();return r.currentTNode=t,r.lView=e,!0}function hn(e){const t=dn(),n=e[1];Vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function dn(){const e=Vt.lFrame,t=null===e?null:e.child;return null===t?pn(e):t}function pn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function fn(){const e=Vt.lFrame;return Vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gn=fn;function mn(){const e=fn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function yn(){return Vt.lFrame.selectedIndex}function vn(e){Vt.lFrame.selectedIndex=e}function _n(){const e=Vt.lFrame;return Nt(e.tView,e.selectedIndex)}function Cn(){Vt.lFrame.currentNamespace=St}function En(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),s&&(e.viewHooks||(e.viewHooks=[])).push(-n,s),o&&((e.viewHooks||(e.viewHooks=[])).push(n,o),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,o)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function wn(e,t,n){Pn(e,t,3,n)}function bn(e,t,n,r){(3&e[2])===n&&Pn(e,t,n,r)}function Sn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Pn(e,t,n,r){const i=r??-1,s=t.length-1;let o=0;for(let a=void 0!==r?65535&e[18]:0;a<s;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(On(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function On(e,t,n,r){const i=n[r]<0,s=n[r+1],o=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}class Tn{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function In(e,t,n){const r=Tt(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const o=n[i++],a=n[i++],l=n[i++];r?e.setAttribute(t,a,l,o):t.setAttributeNS(o,a,l)}else{const o=s,a=n[++i];An(o)?r&&e.setProperty(t,o,a):r?e.setAttribute(t,o,a):t.setAttribute(o,a),i++}}return i}function kn(e){return 3===e||4===e||6===e}function An(e){return 64===e.charCodeAt(0)}function Mn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Nn(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Nn(e,t,n,r,i){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const n=e[s++];if("number"==typeof n){if(n===t){o=-1;break}if(n>t){o=s-1;break}}}for(;s<e.length;){const t=e[s];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function Rn(e){return-1!==e}function xn(e){return 32767&e}function Dn(e,t){let n=function(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ln=!0;function Fn(e){const t=Ln;return Ln=e,t}let Un=0;function Bn(e,t){const n=$n(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Vn(r.data,e),Vn(t,null),Vn(r.blueprint,null));const i=zn(e,t),s=e.injectorIndex;if(Rn(i)){const e=xn(i),n=Dn(i,t),r=n[1].data;for(let i=0;i<8;i++)t[s+i]=n[e+i]|r[e+i]}return t[s+8]=i,s}function Vn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $n(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function zn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Hn(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Qe)&&(r=n[Qe]),null==r&&(r=n[Qe]=Un++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Gn(e,t,n){if(n&Ne.Optional)return e;Ee(t,"NodeInjector")}function Wn(e,t,n,r){if(n&Ne.Optional&&void 0===r&&(r=null),0==(n&(Ne.Self|Ne.Host))){const i=e[9],s=xe(void 0);try{return i?i.get(t,r,n&Ne.Optional):De(t,r,n&Ne.Optional)}finally{xe(s)}}return Gn(r,t,n)}function qn(e,t,n,r=Ne.Default,i){if(null!==e){const s=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Qe)?e[Qe]:void 0;return"number"==typeof t?t>=0?255&t:Zn:t}(n);if("function"==typeof s){if(!un(t,e,r))return r&Ne.Host?Gn(i,n,r):Wn(t,n,r,i);try{const e=s(r);if(null!=e||r&Ne.Optional)return e;Ee(n)}finally{gn()}}else if("number"==typeof s){let i=null,o=$n(e,t),a=-1,l=r&Ne.Host?t[16][6]:null;for((-1===o||r&Ne.SkipSelf)&&(a=-1===o?zn(e,t):t[o+8],-1!==a&&Jn(r,!1)?(i=t[1],o=xn(a),t=Dn(a,t)):o=-1);-1!==o;){const e=t[1];if(Xn(s,o,e.data)){const e=Yn(o,t,n,i,r,l);if(e!==jn)return e}a=t[o+8],-1!==a&&Jn(r,t[1].data[o+8]===l)&&Xn(s,o,t)?(i=e,o=xn(a),t=Dn(a,t)):o=-1}}}return Wn(t,n,r,i)}const jn={};function Zn(){return new er(Wt(),zt())}function Yn(e,t,n,r,i,s){const o=t[1],a=o.data[e+8],l=Kn(a,o,n,null==r?dt(a)&&Ln:r!=o&&0!=(3&a.type),i&Ne.Host&&s===a);return null!==l?Qn(t,o,l,a):jn}function Kn(e,t,n,r,i){const s=e.providerIndexes,o=t.data,a=1048575&s,l=e.directiveStart,c=s>>20,u=i?a+c:e.directiveEnd;for(let h=r?a:a+c;h<u;h++){const e=o[h];if(h<l&&n===e||h>=l&&e.type===n)return h}if(i){const e=o[l];if(e&&ft(e)&&e.type===n)return l}return null}function Qn(e,t,n,r){let i=e[n];const s=t.data;if(function(e){return e instanceof Tn}(i)){const o=i;o.resolving&&function(e,t){throw new ve("200",`Circular dependency in DI detected for ${e}`)}(Ce(s[n]));const a=Fn(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?xe(o.injectImpl):null;un(e,r,Ne.Default);try{i=e[n]=o.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const r=_t(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==l&&xe(l),Fn(a),o.resolving=!1,gn()}}return i}function Xn(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Jn(e,t){return!(e&Ne.Self||e&Ne.Host&&t)}class er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return qn(this._tNode,this._lView,e,n,t)}}function tr(e){return Le(()=>{const t=e.prototype.constructor,n=t[Ke]||nr(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[Ke]||nr(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function nr(e){return ye(e)?()=>{const t=nr(me(e));return t&&t()}:mt(e)}function rr(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(kn(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(Wt(),e)}const ir="__parameters__";function sr(e,t,n){return Le(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(ir)?e[ir]:Object.defineProperty(e,ir,{value:[]})[ir];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class or{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=be({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ar=new or("AnalyzeForEntryComponents"),lr=Function;function cr(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),cr(r,t)):t!==e&&t.push(r)}return t}function ur(e,t){e.forEach(e=>Array.isArray(e)?ur(e,t):t(e))}function hr(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function dr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function pr(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function fr(e,t,n){let r=mr(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function gr(e,t){const n=mr(e,t);if(n>=0)return e[1|n]}function mr(e,t){return function(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const s=r+(i-r>>1),o=e[s<<n];if(t===o)return s<<n;o>t?i=s:r=s+1}return~(i<<n)}(e,t,1)}const yr={},vr="__NG_DI_FLAG__",_r="ngTempTokenPath",Cr=/\n/gm,Er="__source",wr=ue({provide:String,useValue:ue});let br;function Sr(e){const t=br;return br=e,t}function Pr(e,t=Ne.Default){if(void 0===br)throw new Error("inject() must be called from an injection context");return null===br?De(e,void 0,t):br.get(e,t&Ne.Optional?null:void 0,t)}function Or(e,t=Ne.Default){return(Re||Pr)(me(e),t)}function Tr(e){const t=[];for(let n=0;n<e.length;n++){const r=me(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=Ne.Default;for(let t=0;t<r.length;t++){const i=r[t],s=kr(i);"number"==typeof s?-1===s?e=i.token:n|=s:e=i}t.push(Or(e,n))}else t.push(Or(r))}return t}function Ir(e,t){return e[vr]=t,e.prototype[vr]=t,e}function kr(e){return e[vr]}function Ar(e,t,n,r){const i=e[_r];throw t[Er]&&i.unshift(t[Er]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=de(t);if(Array.isArray(t))i=t.map(de).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):de(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Cr,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[_r]=null,e}const Mr=Ir(sr("Inject",e=>({token:e})),-1),Nr=Ir(sr("Optional"),8),Rr=Ir(sr("SkipSelf"),4);let xr,Dr;function Lr(e){var t;return(null===(t=function(){if(void 0===xr&&(xr=null,ze.trustedTypes))try{xr=ze.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return xr}())||void 0===t?void 0:t.createHTML(e))||e}function Fr(e){var t;return(null===(t=function(){if(void 0===Dr&&(Dr=null,ze.trustedTypes))try{Dr=ze.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Dr}())||void 0===t?void 0:t.createHTML(e))||e}class Ur{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Br extends Ur{getTypeName(){return"HTML"}}class Vr extends Ur{getTypeName(){return"Style"}}class $r extends Ur{getTypeName(){return"Script"}}class zr extends Ur{getTypeName(){return"URL"}}class Hr extends Ur{getTypeName(){return"ResourceURL"}}function Gr(e){return e instanceof Ur?e.changingThisBreaksApplicationSecurity:e}function Wr(e,t){const n=qr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function qr(e){return e instanceof Ur&&e.getTypeName()||null}function jr(e){const t=new Yr(e);return function(){try{return!!(new window.DOMParser).parseFromString(Lr(""),"text/html")}catch{return!1}}()?new Zr(t):t}class Zr{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Lr(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class Yr{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Lr(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=Lr(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kr=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Xr(e){return(e=String(e)).match(Kr)||e.match(Qr)?e:"unsafe:"+e}function Jr(e){return(e=String(e)).split(",").map(e=>Xr(e.trim())).join(", ")}function ei(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function ti(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const ni=ei("area,br,col,hr,img,wbr"),ri=ei("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ii=ei("rp,rt"),si=ti(ni,ti(ri,ei("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ti(ii,ei("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ti(ii,ri)),oi=ei("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ai=ei("srcset"),li=ti(oi,ai,ei("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ei("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ci=ei("script,style,template");class ui{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!si.hasOwnProperty(t))return this.sanitizedSomething=!0,!ci.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let r=0;r<n.length;r++){const e=n.item(r),t=e.name,i=t.toLowerCase();if(!li.hasOwnProperty(i)){this.sanitizedSomething=!0;continue}let s=e.value;oi[i]&&(s=Xr(s)),ai[i]&&(s=Jr(s)),this.buf.push(" ",t,'="',pi(s),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();si.hasOwnProperty(t)&&!ni.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(pi(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const hi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,di=/([^\#-~ |!])/g;function pi(e){return e.replace(/&/g,"&amp;").replace(hi,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(di,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let fi;function gi(e,t){let n=null;try{fi=fi||jr(e);let r=t?String(t):"";n=fi.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=fi.getInertBodyElement(r)}while(r!==s);return Lr((new ui).sanitizeChildren(mi(n)||n))}finally{if(n){const e=mi(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function mi(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var yi=(()=>((yi=yi||{})[yi.NONE=0]="NONE",yi[yi.HTML=1]="HTML",yi[yi.STYLE=2]="STYLE",yi[yi.SCRIPT=3]="SCRIPT",yi[yi.URL=4]="URL",yi[yi.RESOURCE_URL=5]="RESOURCE_URL",yi))();function vi(e){const t=Ci();return t?Fr(t.sanitize(yi.HTML,e)||""):Wr(e,"HTML")?Fr(Gr(e)):gi(Ot(),_e(e))}function _i(e){const t=Ci();return t?t.sanitize(yi.URL,e)||"":Wr(e,"URL")?Gr(e):Xr(_e(e))}function Ci(){const e=zt();return e&&e[12]}const Ei="__ngContext__";function wi(e,t){e[Ei]=t}function bi(e){const t=function(e){return e[Ei]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Si(e){return e.ngOriginalError}function Pi(e,...t){e.error(...t)}class Oi{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=(i=e)&&i.ngErrorLogger||Pi;var i;r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?e.ngDebugContext||this._findContext(Si(e)):null}_findOriginalError(e){let t=e&&Si(e);for(;t&&Si(t);)t=Si(t);return t||null}}const Ti=/^>|^->|<!--|-->|--!>|<!-$/g,Ii=/(<|>)/;const ki=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ze))();function Ai(e){return e instanceof Function?e():e}var Mi=(()=>((Mi=Mi||{})[Mi.Important=1]="Important",Mi[Mi.DashCase=2]="DashCase",Mi))();let Ni;function Ri(e,t){return Ni(e,t)}function xi(e){const t=e[3];return ut(t)?t[3]:t}function Di(e){return Fi(e[13])}function Li(e){return Fi(e[4])}function Fi(e){for(;null!==e&&!ut(e);)e=e[4];return e}function Ui(e,t,n,r,i){if(null!=r){let s,o=!1;ut(r)?s=r:ct(r)&&(o=!0,r=r[0]);const a=kt(r);0===e&&null!==n?null==i?Ki(t,n,a):Yi(t,n,a,i||null,!0):1===e&&null!==n?Yi(t,n,a,i||null,!0):2===e?ls(t,a,o):3===e&&t.destroyNode(a),null!=s&&function(e,t,n,r,i){const s=n[7];s!==kt(n)&&Ui(t,e,r,s,i);for(let o=10;o<n.length;o++){const i=n[o];us(i[1],i,e,t,r,s)}}(t,e,s,n,i)}}function Bi(e,t){return Tt(e)?e.createText(t):e.createTextNode(t)}function Vi(e,t,n){Tt(e)?e.setValue(t,n):t.textContent=n}function $i(e,t){return e.createComment(function(e){return e.replace(Ti,e=>e.replace(Ii,"\u200b$1\u200b"))}(t))}function zi(e,t,n){return Tt(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Hi(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Bt(i,-1)),n.splice(r,1)}function Gi(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Hi(i,r),t>0&&(e[n-1][4]=r[4]);const s=dr(e,10+t);!function(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function Wi(e,t){if(!(256&t[2])){const n=t[11];Tt(n)&&n.destroyNode&&us(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return qi(e[1],e);for(;t;){let n=null;if(ct(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)ct(t)&&qi(t[1],t),t=t[3];null===t&&(t=e),ct(t)&&qi(t[1],t),n=t&&t[4]}t=n}}(t)}}function qi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tn)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const e=n[s+1],o="function"==typeof e?e(t):kt(t[e]),a=r[i=n[s+2]],l=n[s+3];"boolean"==typeof l?o.removeEventListener(n[s],a,l):l>=0?r[i=l]():r[i=-l].unsubscribe(),s+=2}else{const e=r[i=n[s+1]];n[s].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)r[e]();t[7]=null}}(e,t),1===t[1].type&&Tt(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ut(t[3])){n!==t[3]&&Hi(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function ji(e,t,n){return Zi(e,t.parent,n)}function Zi(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===Ue.None||t===Ue.Emulated)return null}return Mt(r,n)}function Yi(e,t,n,r,i){Tt(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Ki(e,t,n){Tt(e)?e.appendChild(t,n):t.appendChild(n)}function Qi(e,t,n,r,i){null!==r?Yi(e,t,n,r,i):Ki(e,t,n)}function Xi(e,t){return Tt(e)?e.parentNode(t):t.parentNode}function Ji(e,t,n){return ns(e,t,n)}function es(e,t,n){return 40&e.type?Mt(e,n):null}let ts,ns=es;function rs(e,t){ns=e,ts=t}function is(e,t,n,r){const i=ji(e,r,t),s=t[11],o=Ji(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)Qi(s,i,n[a],o,!1);else Qi(s,i,n,o,!1);void 0!==ts&&ts(s,r,t,n,i)}function ss(e,t){if(null!==t){const n=t.type;if(3&n)return Mt(t,e);if(4&n)return as(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return ss(e,n);{const n=e[t.index];return ut(n)?as(-1,n):kt(n)}}if(32&n)return Ri(t,e)()||kt(e[t.index]);{const n=os(e,t);return null!==n?Array.isArray(n)?n[0]:ss(xi(e[16]),n):ss(e,t.next)}}return null}function os(e,t){return null!==t?e[16][6].projection[t.projection]:null}function as(e,t){const n=10+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return ss(e,r)}return t[7]}function ls(e,t,n){const r=Xi(e,t);r&&function(e,t,n,r){Tt(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}function cs(e,t,n,r,i,s,o){for(;null!=n;){const a=r[n.index],l=n.type;if(o&&0===t&&(a&&wi(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&l)cs(e,t,n.child,r,i,s,!1),Ui(t,e,i,a,s);else if(32&l){const o=Ri(n,r);let l;for(;l=o();)Ui(t,e,i,l,s);Ui(t,e,i,a,s)}else 16&l?hs(e,t,r,n,i,s):Ui(t,e,i,a,s);n=o?n.projectionNext:n.next}}function us(e,t,n,r,i,s){cs(n,r,e.firstChild,t,i,s,!1)}function hs(e,t,n,r,i,s){const o=n[16],a=o[6].projection[r.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)Ui(t,e,i,a[l],s);else cs(e,t,a,o[3],i,s,!0)}function ds(e,t,n){Tt(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function ps(e,t,n){Tt(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function fs(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const gs="ng-template";function ms(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==fs(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ys(e){return 4===e.type&&e.value!==gs}function vs(e,t,n){return t===(4!==e.type||n?e.value:gs)}function _s(e,t,n){let r=4;const i=e.attrs||[],s=function(e){for(let t=0;t<e.length;t++)if(kn(e[t]))return t;return e.length}(i);let o=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!vs(e,l,n)||""===l&&1===t.length){if(Cs(r))return!1;o=!0}}else{const c=8&r?l:t[++a];if(8&r&&null!==e.attrs){if(!ms(e.attrs,c,n)){if(Cs(r))return!1;o=!0}continue}const u=Es(8&r?"class":l,i,ys(e),n);if(-1===u){if(Cs(r))return!1;o=!0;continue}if(""!==c){let e;e=u>s?"":i[u+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==fs(t,c,0)||2&r&&c!==e){if(Cs(r))return!1;o=!0}}}}else{if(!o&&!Cs(r)&&!Cs(l))return!1;if(o&&Cs(l))continue;o=!1,r=l|1&r}}return Cs(r)||o}function Cs(e){return 0==(1&e)}function Es(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ws(e,t,n=!1){for(let r=0;r<t.length;r++)if(_s(e,t[r],n))return!0;return!1}function bs(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function Ss(e,t){return e?":not("+t.trim()+")":t}function Ps(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let o=e[n];if("string"==typeof o)if(2&r){const t=e[++n];i+="["+o+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Cs(o)&&(t+=Ss(s,i),i=""),r=o,s=s||!Cs(r);n++}return""!==i&&(t+=Ss(s,i)),t}const Os={};function Ts(e){Is(Ht(),zt(),yn()+e,Qt())}function Is(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&wn(t,r,n)}else{const r=e.preOrderHooks;null!==r&&bn(t,r,0,n)}vn(n)}function ks(e,t){return e<<17|t<<2}function As(e){return e>>17&32767}function Ms(e){return 2|e}function Ns(e){return(131068&e)>>2}function Rs(e,t){return-131069&e|t<<2}function xs(e){return 1|e}function Ds(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const n=e.data[s];ln(i),n.contentQueries(2,t[s],s)}}}function Ls(e,t,n,r,i,s,o,a,l,c){const u=t.blueprint.slice();return u[0]=i,u[2]=140|r,Ut(u),u[3]=u[15]=e,u[8]=n,u[10]=o||e&&e[10],u[11]=a||e&&e[11],u[12]=l||e&&e[12]||null,u[9]=c||e&&e[9]||null,u[6]=s,u[16]=2==t.type?e[16]:u,u}function Fs(e,t,n,r,i){let s=e.data[t];if(null===s)s=Us(e,t,n,r,i),Vt.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const e=jt();s.injectorIndex=null===e?-1:e.injectorIndex}return Zt(s,!0),s}function Us(e,t,n,r,i){const s=qt(),o=Yt(),a=e.data[t]=function(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}function Bs(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Vs(e,t,n){hn(t);try{const r=e.viewQuery;null!==r&&_o(1,r,n);const i=e.template;null!==i&&Hs(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Ds(e,t),e.staticViewQueries&&_o(2,e.viewQuery,n);const s=e.components;null!==s&&function(e,t){for(let n=0;n<t.length;n++)fo(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,mn()}}function $s(e,t,n,r){const i=t[2];if(256==(256&i))return;hn(t);const s=Qt();try{Ut(t),function(e){Vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Hs(e,t,n,2,r);const o=3==(3&i);if(!s)if(o){const n=e.preOrderCheckHooks;null!==n&&wn(t,n,null)}else{const n=e.preOrderHooks;null!==n&&bn(t,n,0,null),Sn(t,0)}if(function(e){for(let t=Di(e);null!==t;t=Li(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Bt(r,1),n[2]|=1024}}}(t),function(e){for(let t=Di(e);null!==t;t=Li(t))for(let e=10;e<t.length;e++){const n=t[e],r=n[1];Lt(n)&&$s(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Ds(e,t),!s)if(o){const n=e.contentCheckHooks;null!==n&&wn(t,n)}else{const n=e.contentHooks;null!==n&&bn(t,n,1),Sn(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)vn(~r);else{const i=r,s=n[++e],o=n[++e];sn(s,i),o(2,t[i])}}}finally{vn(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)ho(e,t[n])}(t,a);const l=e.viewQuery;if(null!==l&&_o(2,l,r),!s)if(o){const n=e.viewCheckHooks;null!==n&&wn(t,n)}else{const n=e.viewHooks;null!==n&&bn(t,n,2),Sn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Bt(t[3],-1))}finally{mn()}}function zs(e,t,n,r){const i=t[10],s=!Qt(),o=Dt(t);try{s&&!o&&i.begin&&i.begin(),o&&Vs(e,t,r),$s(e,t,n,r)}finally{s&&!o&&i.end&&i.end()}}function Hs(e,t,n,r,i){const s=yn(),o=2&r;try{vn(-1),o&&t.length>20&&Is(e,t,20,Qt()),n(r,i)}finally{vn(s)}}function Gs(e,t,n){if(ht(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function Ws(e,t,n){!$t()||(function(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Bn(n,t),wi(r,t);const o=n.initialInputs;for(let a=i;a<s;a++){const r=e.data[a],s=ft(r);s&&so(t,n,r);const l=Qn(t,e,a,n);wi(l,t),null!==o&&lo(0,a-i,l,r,0,o),s&&(xt(n.index,t)[8]=l)}}(e,t,n,Mt(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,s=n.index,o=Vt.lFrame.currentDirectiveIndex;try{vn(s);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];on(n),(null!==r.hostBindings||0!==r.hostVars||null!==r.hostAttrs)&&eo(r,i)}}finally{vn(-1),on(o)}}(e,t,n))}function qs(e,t,n=Mt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?n(t,e):e[o];e[i++]=a}}}function js(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zs(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zs(e,t,n,r,i,s,o,a,l,c){const u=20+r,h=u+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Os);return n}(u,h),p="function"==typeof c?c():c;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function Ys(e,t,n,r){const i=Eo(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&wo(e).push(r,i.length-1))}function Ks(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Qs(e,t,n,r,i,s,o,a){const l=Mt(t,n);let c,u=t.inputs;!a&&null!=u&&(c=u[r])?(So(e,n,c,r,i),dt(t)&&function(e,t){const n=xt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=o?o(i,t.value||"",r):i,Tt(s)?s.setProperty(l,r,i):An(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function Xs(e,t,n,r){let i=!1;if($t()){const s=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];ws(n,o.selectors,!1)&&(i||(i=[]),Hn(Bn(n,t),e,o.type),ft(o)?(to(e,n),i.unshift(o)):i.push(o))}return i}(e,t,n),o=null===r?null:{"":-1};if(null!==s){i=!0,ro(n,e.data.length,s.length);for(let e=0;e<s.length;e++){const t=s[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,l=Bs(e,t,s.length,null);for(let i=0;i<s.length;i++){const c=s[i];n.mergedAttrs=Mn(n.mergedAttrs,c.hostAttrs),io(e,n,t,l,c),no(l,c,o),null!==c.contentQueries&&(n.flags|=8),(null!==c.hostBindings||null!==c.hostAttrs||0!==c.hostVars)&&(n.flags|=128);const u=c.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),l++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,s=[];let o=null,a=null;for(let l=t.directiveStart;l<n;l++){const e=r[l],n=e.inputs,c=null===i||ys(t)?null:co(n,i);s.push(c),o=Ks(n,l,o),a=Ks(e.outputs,l,a)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=o,t.outputs=a}(e,n)}o&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new ve("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,o)}return n.mergedAttrs=Mn(n.mergedAttrs,n.attrs),i}function Js(e,t,n,r,i,s){const o=s.hostBindings;if(o){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const s=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=s&&n.push(s),n.push(r,i,o)}}function eo(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function to(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function no(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;ft(t)&&(n[""]=e)}}function ro(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function io(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=mt(i.type)),o=new Tn(s,ft(i),null);e.blueprint[r]=o,n[r]=o,Js(e,t,0,r,Bs(e,n,i.hostVars,Os),i)}function so(e,t,n){const r=Mt(t,e),i=js(n),s=e[10],o=go(e,Ls(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=o}function oo(e,t,n,r,i,s){const o=Mt(e,t);ao(t[11],o,s,e.value,n,r,i)}function ao(e,t,n,r,i,s,o){if(null==s)Tt(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==o?_e(s):o(s,r||"",i);Tt(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}function lo(e,t,n,r,i,s){const o=s[t];if(null!==o){const e=r.setInput;for(let t=0;t<o.length;){const i=o[t++],s=o[t++],a=o[t++];null!==e?r.setInput(n,a,i,s):n[s]=a}}}function co(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function uo(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function ho(e,t){const n=xt(t,e);if(Lt(n)){const e=n[1];80&n[2]?$s(e,n,e.template,n[8]):n[5]>0&&po(n)}}function po(e){for(let n=Di(e);null!==n;n=Li(n))for(let e=10;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];$s(e,t,e.template,t[8])}else t[5]>0&&po(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=xt(t[n],e);Lt(r)&&r[5]>0&&po(r)}}function fo(e,t){const n=xt(t,e),r=n[1];(function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),Vs(r,n,n[8])}function go(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function mo(e){for(;e;){e[2]|=64;const t=xi(e);if(gt(e)&&!t)return e;e=t}return null}function yo(e,t,n){const r=t[10];r.begin&&r.begin();try{$s(e,t,e.template,n)}catch(i){throw bo(t,i),i}finally{r.end&&r.end()}}function vo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=bi(n),i=r[1];zs(i,r,i.template,n)}}(e[8])}function _o(e,t,n){ln(0),t(e,n)}const Co=(()=>Promise.resolve(null))();function Eo(e){return e[7]||(e[7]=[])}function wo(e){return e.cleanup||(e.cleanup=[])}function bo(e,t){const n=e[9],r=n?n.get(Oi,null):null;r&&r.handleError(t)}function So(e,t,n,r,i){for(let s=0;s<n.length;){const o=n[s++],a=n[s++],l=t[o],c=e.data[o];null!==c.setInput?c.setInput(l,i,r,a):l[a]=i}}function Po(e,t,n){const r=At(t,e);Vi(e[11],r,n)}function Oo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const e=t[o];"number"==typeof e?s=e:1==s?i=pe(i,e):2==s&&(r=pe(r,e+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const To=new or("INJECTOR",-1);class Io{get(e,t=yr){if(t===yr){const t=new Error(`NullInjectorError: No provider for ${de(e)}!`);throw t.name="NullInjectorError",t}return t}}const ko=new or("Set Injector scope."),Ao={},Mo={};let No;function Ro(){return void 0===No&&(No=new Io),No}function xo(e,t=null,n=null,r){return new Do(e,n,t||Ro(),r)}class Do{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&ur(t,n=>this.processProvider(n,e,t)),ur([e],e=>this.processInjectorType(e,[],i)),this.records.set(To,Uo(void 0,this));const s=this.records.get(ko);this.scope=null!=s?s.value:null,this.source=r||("object"==typeof e?null:de(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=yr,n=Ne.Default){this.assertNotDestroyed();const r=Sr(this),i=xe(void 0);try{if(!(n&Ne.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(s=e)||"object"==typeof s&&s instanceof or)&&Pe(e);t=n&&this.injectableDefInScope(n)?Uo(Lo(e),Ao):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&Ne.Self?Ro():this.parent).get(e,t=n&Ne.Optional&&t===yr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_r]=o[_r]||[]).unshift(de(e)),r)throw o;return Ar(o,e,"R3InjectorError",this.source)}throw o}finally{xe(i),Sr(r)}var s}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(de(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=me(e)))return!1;let r=Te(e);const i=null==r&&e.ngModule||void 0,s=void 0===i?e:i,o=-1!==n.indexOf(s);if(void 0!==i&&(r=Te(i)),null==r)return!1;if(null!=r.imports&&!o){let e;n.push(s);try{ur(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];ur(r,e=>this.processProvider(e,n,r||Ge))}}this.injectorDefTypes.add(s);const a=mt(s)||(()=>new s);this.records.set(s,Uo(a,Ao));const l=r.providers;if(null!=l&&!o){const t=e;ur(l,e=>this.processProvider(e,t,l))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=Vo(e=me(e))?e:me(e&&e.provide);const i=Bo(s=e)?Uo(void 0,s.useValue):Uo(Fo(s),Ao);var s;if(Vo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=Uo(void 0,Ao,!0),t.factory=()=>Tr(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){return t.value===Ao&&(t.value=Mo,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value;var n}injectableDefInScope(e){if(!e.providedIn)return!1;const t=me(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Lo(e){const t=Pe(e),n=null!==t?t.factory:mt(e);if(null!==n)return n;if(e instanceof or)throw new Error(`Token ${de(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=pr(t,"?");throw new Error(`Can't resolve all parameters for ${de(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[Ie]||e[Ae]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Fo(e,t,n){let r;if(Vo(e)){const t=me(e);return mt(t)||Lo(t)}if(Bo(e))r=()=>me(e.useValue);else if(function(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Tr(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>Or(me(e.useExisting));else{const t=me(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return mt(t)||Lo(t);r=()=>new t(...Tr(e.deps))}return r}function Uo(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Bo(e){return null!==e&&"object"==typeof e&&wr in e}function Vo(e){return"function"==typeof e}const $o=function(e,t,n){return function(e,t=null,n=null,r){const i=xo(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let zo=(()=>{class e{static create(e,t){return Array.isArray(e)?$o(e,t,""):$o(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=yr,e.NULL=new Io,e.\u0275prov=be({token:e,providedIn:"any",factory:()=>Or(To)}),e.__NG_ELEMENT_ID__=-1,e})();function Ho(e,t){En(bi(e)[1],Wt())}function Go(e){let t=function(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let i;if(ft(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=Wo(e.inputs),t.declaredInputs=Wo(e.declaredInputs),t.outputs=Wo(e.outputs);const n=i.hostBindings;n&&Zo(e,n);const s=i.viewQuery,o=i.contentQueries;if(s&&qo(e,s),o&&jo(e,o),he(e.inputs,i.inputs),he(e.declaredInputs,i.declaredInputs),he(e.outputs,i.outputs),ft(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Go&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Mn(i.hostAttrs,n=Mn(n,i.hostAttrs))}}(r)}function Wo(e){return e===He?{}:e===Ge?[]:e}function qo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function jo(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function Zo(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Yo=null;function Ko(){if(!Yo){const e=ze.Symbol;if(e&&e.iterator)Yo=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Yo=n)}}}return Yo}class Qo{constructor(e){this.wrapped=e}static wrap(e){return new Qo(e)}static unwrap(e){return Qo.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof Qo}}function Xo(e){return!!Jo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ko()in e)}function Jo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ea(e,t,n){return e[t]=n}function ta(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function na(e,t,n,r){const i=ta(e,t,n);return ta(e,t+1,r)||i}function ra(e,t,n,r){const i=zt();return ta(i,tn(),t)&&(Ht(),oo(_n(),i,e,t,n,r)),ra}function ia(e,t,n,r){return ta(e,tn(),n)?t+_e(n)+r:Os}function sa(e,t,n,r,i,s){const o=na(e,en(),n,i);return nn(2),o?t+_e(n)+r+_e(i)+s:Os}function oa(e,t,n,r,i,s,o,a){const l=function(e,t,n,r,i){const s=na(e,t,n,r);return ta(e,t+2,i)||s}(e,en(),n,i,o);return nn(3),l?t+_e(n)+r+_e(i)+s+_e(o)+a:Os}function aa(e,t,n,r,i,s){const o=zt(),a=ia(o,t,n,r);return a!==Os&&oo(_n(),o,e,a,i,s),aa}function la(e,t,n,r,i,s,o,a){const l=zt(),c=Ht(),u=e+20,h=c.firstCreatePass?function(e,t,n,r,i,s,o,a,l){const c=t.consts,u=Fs(t,e,4,o||null,Ft(c,a));Xs(t,n,u,Ft(c,l)),En(t,u);const h=u.tViews=Zs(2,u,r,i,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,c,l,t,n,r,i,s,o):c.data[u];Zt(h,!1);const d=l[11].createComment("");is(c,l,d,h),wi(d,l),go(l,l[u]=uo(d,l,d,h)),pt(h)&&Ws(c,l,h),null!=o&&qs(l,h,a)}function ca(e){return Rt(Vt.lFrame.contextLView,20+e)}function ua(e,t=Ne.Default){const n=zt();return null===n?Or(e,t):qn(Wt(),n,me(e),t)}function ha(e,t,n){const r=zt();return ta(r,tn(),t)&&Qs(Ht(),_n(),r,e,t,r[11],n,!1),ha}function da(e,t,n,r,i){const s=i?"class":"style";So(e,n,t.inputs[s],s,r)}function pa(e,t,n,r){const i=zt(),s=Ht(),o=20+e,a=i[11],l=i[o]=zi(a,t,Vt.lFrame.currentNamespace),c=s.firstCreatePass?function(e,t,n,r,i,s,o){const a=t.consts,l=Fs(t,e,2,i,Ft(a,s));return Xs(t,n,l,Ft(a,o)),null!==l.attrs&&Oo(l,l.attrs,!1),null!==l.mergedAttrs&&Oo(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(o,s,i,0,t,n,r):s.data[o];Zt(c,!0);const u=c.mergedAttrs;null!==u&&In(a,l,u);const h=c.classes;null!==h&&ps(a,l,h);const d=c.styles;null!==d&&ds(a,l,d),64!=(64&c.flags)&&is(s,i,l,c),0===Vt.lFrame.elementDepthCount&&wi(l,i),Vt.lFrame.elementDepthCount++,pt(c)&&(Ws(s,i,c),Gs(s,c,i)),null!==r&&qs(i,c)}function fa(){let e=Wt();Yt()?Kt():(e=e.parent,Zt(e,!1));const t=e;Vt.lFrame.elementDepthCount--;const n=Ht();n.firstCreatePass&&(En(n,e),ht(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&da(n,t,zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&da(n,t,zt(),t.stylesWithoutHost,!1)}function ga(e,t,n,r){pa(e,t,n,r),fa()}function ma(e,t,n){const r=zt(),i=Ht(),s=e+20,o=i.firstCreatePass?function(e,t,n,r,i){const s=t.consts,o=Ft(s,r),a=Fs(t,e,8,"ng-container",o);return null!==o&&Oo(a,o,!0),Xs(t,n,a,Ft(s,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(s,i,r,t,n):i.data[s];Zt(o,!0);const a=r[s]=r[11].createComment("");is(i,r,a,o),wi(a,r),pt(o)&&(Ws(i,r,o),Gs(i,o,r)),null!=n&&qs(r,o)}function ya(){let e=Wt();const t=Ht();Yt()?Kt():(e=e.parent,Zt(e,!1)),t.firstCreatePass&&(En(t,e),ht(e)&&t.queries.elementEnd(e))}function va(){return zt()}function _a(e){return!!e&&"function"==typeof e.then}const Ca=function(e){return!!e&&"function"==typeof e.subscribe};function Ea(e,t,n,r){const i=zt(),s=Ht(),o=Wt();return function(e,t,n,r,i,s,o,a){const l=pt(r),c=e.firstCreatePass&&wo(e),u=t[8],h=Eo(t);let d=!0;if(3&r.type||a){const p=Mt(r,t),f=a?a(p):p,g=h.length,m=a?e=>a(kt(e[r.index])):r.index;if(Tt(n)){let o=null;if(!a&&l&&(o=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const e=i[s];if(e===n&&i[s+1]===r){const e=t[7],n=i[s+2];return e.length>n?e[n]:null}"string"==typeof e&&(s+=2)}return null}(e,t,i,r.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,d=!1;else{s=ba(r,t,u,s,!1);const e=n.listen(f,i,s);h.push(s,e),c&&c.push(i,m,g,g+1)}}else s=ba(r,t,u,s,!0),f.addEventListener(i,s,o),h.push(s),c&&c.push(i,m,g,o)}else s=ba(r,t,u,s,!1);const p=r.outputs;let f;if(d&&null!==p&&(f=p[i])){const e=f.length;if(e)for(let n=0;n<e;n+=2){const e=t[f[n]][f[n+1]].subscribe(s),o=h.length;h.push(s,e),c&&c.push(i,r.index,o,-(o+1))}}}(s,i,i[11],o,e,t,!!n,r),Ea}function wa(e,t,n,r){try{return!1!==n(r)}catch(i){return bo(e,i),!1}}function ba(e,t,n,r,i){return function n(s){if(s===Function)return r;const o=2&e.flags?xt(e.index,t):t;0==(32&t[2])&&mo(o);let a=wa(t,0,r,s),l=n.__ngNextListenerFn__;for(;l;)a=wa(t,0,l,s)&&a,l=l.__ngNextListenerFn__;return i&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function Sa(e=1){return function(e){return(Vt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Vt.lFrame.contextLView))[8]}(e)}function Pa(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const s=t[i];if("*"!==s){if(null===r?ws(e,s,!0):bs(r,s))return i}else n=i}return n}function Oa(e,t,n){return Ta(e,"",t,"",n),Oa}function Ta(e,t,n,r,i){const s=zt(),o=ia(s,t,n,r);return o!==Os&&Qs(Ht(),_n(),s,e,o,s[11],i,!1),Ta}function Ia(e,t,n,r,i,s,o){const a=zt(),l=sa(a,t,n,r,i,s);return l!==Os&&Qs(Ht(),_n(),a,e,l,a[11],o,!1),Ia}function ka(e,t,n,r,i,s,o,a,l){const c=zt(),u=oa(c,t,n,r,i,s,o,a);return u!==Os&&Qs(Ht(),_n(),c,e,u,c[11],l,!1),ka}function Aa(e,t,n,r,i){const s=e[n+1],o=null===t;let a=r?As(s):Ns(s),l=!1;for(;0!==a&&(!1===l||o);){const n=e[a+1];Ma(e[a],t)&&(l=!0,e[a+1]=r?xs(n):Ms(n)),a=r?As(n):Ns(n)}l&&(e[n+1]=r?Ms(s):xs(s))}function Ma(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&mr(e,t)>=0}const Na={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ra(e){return e.substring(Na.key,Na.keyEnd)}function xa(e){return e.substring(Na.value,Na.valueEnd)}function Da(e,t){const n=Na.textEnd;let r=Na.key=La(e,t,n);return n===r?-1:(r=Na.keyEnd=function(e,t,n){let r;for(;t<n&&(45===(r=e.charCodeAt(t))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)t++;return t}(e,r,n),r=Fa(e,r,n),r=Na.value=La(e,r,n),r=Na.valueEnd=function(e,t,n){let r=-1,i=-1,s=-1,o=t,a=o;for(;o<n;){const l=e.charCodeAt(o++);if(59===l)return a;34===l||39===l?a=o=Ua(e,l,o,n):t===o-4&&85===s&&82===i&&76===r&&40===l?a=o=Ua(e,41,o,n):l>32&&(a=o),s=i,i=r,r=-33&l}return a}(e,r,n),Fa(e,r,n))}function La(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function Fa(e,t,n,r){return(t=La(e,t,n))<n&&t++,t}function Ua(e,t,n,r){let i=-1,s=n;for(;s<r;){const n=e.charCodeAt(s++);if(n==t&&92!==i)return s;i=92==n&&92===i?0:n}throw new Error}function Ba(e,t){return function(e,t,n,r){const i=zt(),s=Ht(),o=nn(2);s.firstUpdatePass&&Ha(s,e,o,r),t!==Os&&ta(i,o,t)&&ja(s,s.data[yn()],i,i[11],e,i[o+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=de(Gr(e)))),e}(t,n),r,o)}(e,t,null,!0),Ba}function Va(e){!function(e,t,n,r){const i=Ht(),s=nn(2);i.firstUpdatePass&&Ha(i,null,s,r);const o=zt();if(n!==Os&&ta(o,s,n)){const a=i.data[yn()];if(Ka(a,r)&&!za(i,s)){let e=r?a.classesWithoutHost:a.stylesWithoutHost;null!==e&&(n=pe(e,n||"")),da(i,a,o,n,r)}else!function(e,t,n,r,i,s,o,a){i===Os&&(i=Ge);let l=0,c=0,u=0<i.length?i[0]:null,h=0<s.length?s[0]:null;for(;null!==u||null!==h;){const d=l<i.length?i[l+1]:void 0,p=c<s.length?s[c+1]:void 0;let f,g=null;u===h?(l+=2,c+=2,d!==p&&(g=h,f=p)):null===h||null!==u&&u<h?(l+=2,g=u):(c+=2,g=h,f=p),null!==g&&ja(e,t,n,r,g,f,o,a),u=l<i.length?i[l]:null,h=c<s.length?s[c]:null}}(i,a,o,o[11],o[s+1],o[s+1]=function(e,t,n){if(null==n||""===n)return Ge;const r=[],i=Gr(n);if(Array.isArray(i))for(let s=0;s<i.length;s++)e(r,i[s],!0);else if("object"==typeof i)for(const s in i)i.hasOwnProperty(s)&&e(r,s,i[s]);else"string"==typeof i&&t(r,i);return r}(e,t,n),r,s)}}(qa,$a,e,!1)}function $a(e,t){for(let n=function(e){return function(e){Na.key=0,Na.keyEnd=0,Na.value=0,Na.valueEnd=0,Na.textEnd=e.length}(e),Da(e,La(e,0,Na.textEnd))}(t);n>=0;n=Da(t,n))qa(e,Ra(t),xa(t))}function za(e,t){return t>=e.expandoStartIndex}function Ha(e,t,n,r){const i=e.data;if(null===i[n+1]){const s=i[yn()],o=za(e,n);Ka(s,r)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Vt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=Wa(n=Ga(null,e,t,n,r),t.attrs,r),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==i)if(n=Ga(i,e,t,n,r),null===s){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Ns(r))return e[As(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=Ga(null,e,t,n[1],r),n=Wa(n,t.attrs,r),function(e,t,n,r){e[As(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else s=function(e,t,n){let r;const i=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<i;s++)r=Wa(r,e[s].hostAttrs,n);return Wa(r,t.attrs,n)}(e,t,r)}return void 0!==s&&(r?t.residualClasses=s:t.residualStyles=s),n}(i,s,t,r),function(e,t,n,r,i,s){let o=s?t.classBindings:t.styleBindings,a=As(o),l=Ns(o);e[r]=n;let c,u=!1;if(Array.isArray(n)){const e=n;c=e[1],(null===c||mr(e,c)>0)&&(u=!0)}else c=n;if(i)if(0!==l){const t=As(e[a+1]);e[r+1]=ks(t,a),0!==t&&(e[t+1]=Rs(e[t+1],r)),e[a+1]=function(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=ks(a,0),0!==a&&(e[a+1]=Rs(e[a+1],r)),a=r;else e[r+1]=ks(l,0),0===a?a=r:e[l+1]=Rs(e[l+1],r),l=r;u&&(e[r+1]=Ms(e[r+1])),Aa(e,c,r,!0),Aa(e,c,r,!1),function(e,t,n,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&mr(s,t)>=0&&(n[r+1]=xs(n[r+1]))}(t,c,e,r,s),o=ks(a,l),s?t.classBindings=o:t.styleBindings=o}(i,s,t,n,o,r)}}function Ga(e,t,n,r,i){let s=null;const o=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<o&&(s=t[a],r=Wa(r,s.hostAttrs,i),s!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function Wa(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?i=o:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),fr(e,o,!!n||t[++s]))}return void 0===e?null:e}function qa(e,t,n){fr(e,t,Gr(n))}function ja(e,t,n,r,i,s,o,a){if(!(3&t.type))return;const l=e.data,c=l[a+1];Ya(function(e){return 1==(1&e)}(c)?Za(l,t,n,i,Ns(c),o):void 0)||(Ya(s)||function(e){return 2==(2&e)}(c)&&(s=Za(l,null,n,i,a,o)),function(e,t,n,r,i){const s=Tt(e);if(t)i?s?e.addClass(n,r):n.classList.add(r):s?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Mi.DashCase;if(null==i)s?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const o="string"==typeof i&&i.endsWith("!important");o&&(i=i.slice(0,-10),t|=Mi.Important),s?e.setStyle(n,r,i,t):n.style.setProperty(r,i,o?"important":"")}}}(r,o,At(yn(),n),i,s))}function Za(e,t,n,r,i,s){const o=null===t;let a;for(;i>0;){const t=e[i],s=Array.isArray(t),l=s?t[1]:t,c=null===l;let u=n[i+1];u===Os&&(u=c?Ge:void 0);let h=c?gr(u,r):l===r?u:void 0;if(s&&!Ya(h)&&(h=gr(t,r)),Ya(h)&&(a=h,o))return a;const d=e[i+1];i=o?As(d):Ns(d)}if(null!==t){let e=s?t.residualClasses:t.residualStyles;null!=e&&(a=gr(e,r))}return a}function Ya(e){return void 0!==e}function Ka(e,t){return 0!=(e.flags&(t?16:32))}function Qa(e,t=""){const n=zt(),r=Ht(),i=e+20,s=r.firstCreatePass?Fs(r,i,1,t,null):r.data[i],o=n[i]=Bi(n[11],t);is(r,n,o,s),Zt(s,!1)}function Xa(e){return Ja("",e,""),Xa}function Ja(e,t,n){const r=zt(),i=ia(r,e,t,n);return i!==Os&&Po(r,yn(),i),Ja}function el(e,t,n,r,i){const s=zt(),o=sa(s,e,t,n,r,i);return o!==Os&&Po(s,yn(),o),el}function tl(e,t,n,r,i,s,o){const a=zt(),l=oa(a,e,t,n,r,i,s,o);return l!==Os&&Po(a,yn(),l),tl}function nl(e,t,n){const r=zt();return ta(r,tn(),t)&&Qs(Ht(),_n(),r,e,t,r[11],n,!0),nl}const rl=void 0;var il=["en",[["a","p"],["AM","PM"],rl],[["AM","PM"],rl,rl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],rl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],rl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",rl,"{1} 'at' {0}",rl],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){const t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let sl={};function ol(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=ll(t);if(n)return n;const r=t.split("-")[0];if(n=ll(r),n)return n;if("en"===r)return il;throw new Error(`Missing locale data for the locale "${e}".`)}function al(e){return ol(e)[cl.PluralCase]}function ll(e){return e in sl||(sl[e]=ze.ng&&ze.ng.common&&ze.ng.common.locales&&ze.ng.common.locales[e]),sl[e]}var cl=(()=>((cl=cl||{})[cl.LocaleId=0]="LocaleId",cl[cl.DayPeriodsFormat=1]="DayPeriodsFormat",cl[cl.DayPeriodsStandalone=2]="DayPeriodsStandalone",cl[cl.DaysFormat=3]="DaysFormat",cl[cl.DaysStandalone=4]="DaysStandalone",cl[cl.MonthsFormat=5]="MonthsFormat",cl[cl.MonthsStandalone=6]="MonthsStandalone",cl[cl.Eras=7]="Eras",cl[cl.FirstDayOfWeek=8]="FirstDayOfWeek",cl[cl.WeekendRange=9]="WeekendRange",cl[cl.DateFormat=10]="DateFormat",cl[cl.TimeFormat=11]="TimeFormat",cl[cl.DateTimeFormat=12]="DateTimeFormat",cl[cl.NumberSymbols=13]="NumberSymbols",cl[cl.NumberFormats=14]="NumberFormats",cl[cl.CurrencyCode=15]="CurrencyCode",cl[cl.CurrencySymbol=16]="CurrencySymbol",cl[cl.CurrencyName=17]="CurrencyName",cl[cl.Currencies=18]="Currencies",cl[cl.Directionality=19]="Directionality",cl[cl.PluralCase=20]="PluralCase",cl[cl.ExtraData=21]="ExtraData",cl))();const ul=["zero","one","two","few","many"],hl="en-US",dl={marker:"element"},pl={marker:"ICU"};var fl=(()=>((fl=fl||{})[fl.SHIFT=2]="SHIFT",fl[fl.APPEND_EAGERLY=1]="APPEND_EAGERLY",fl[fl.COMMENT=2]="COMMENT",fl))();let gl=hl;function ml(e){(function(e,t){null==e&&we(t,e,null,"!=")})(e,"Expected localeId to be defined"),"string"==typeof e&&(gl=e.toLowerCase().replace(/_/g,"-"))}function yl(e,t,n){const r=t.insertBeforeIndex,i=Array.isArray(r)?r[0]:r;return null===i?es(e,0,n):kt(n[i])}function vl(e,t,n,r,i){const s=t.insertBeforeIndex;if(Array.isArray(s)){let o=r,a=null;if(3&t.type||(a=o,o=i),null!==o&&0==(2&t.flags))for(let t=1;t<s.length;t++)Yi(e,o,n[s[t]],a,!1)}}function _l(e,t){if(e.push(t),e.length>1)for(let n=e.length-2;n>=0;n--){const r=e[n];Cl(r)||El(r,t)&&null===wl(r)&&bl(r,t.index)}}function Cl(e){return!(64&e.type)}function El(e,t){return Cl(t)||e.index>t.index}function wl(e){const t=e.insertBeforeIndex;return Array.isArray(t)?t[0]:t}function bl(e,t){const n=e.insertBeforeIndex;Array.isArray(n)?n[0]=t:(rs(yl,vl),e.insertBeforeIndex=t)}function Sl(e,t){const n=e.data[t];return null===n||"string"==typeof n?null:n.hasOwnProperty("currentCaseLViewIndex")?n:n.value}function Pl(e,t,n){const r=Us(e,n,64,null,null);return _l(t,r),r}function Ol(e,t){const n=t[e.currentCaseLViewIndex];return null===n?n:n<0?~n:n}function Tl(e){return e>>>17}function Il(e){return(131070&e)>>>1}let kl=0,Al=0;function Ml(e,t,n,r){const i=n[11];let s,o=null;for(let a=0;a<t.length;a++){const l=t[a];if("string"==typeof l){const e=t[++a];null===n[e]&&(n[e]=Bi(i,l))}else if("number"==typeof l)switch(1&l){case 0:const c=Tl(l);let u,h;if(null===o&&(o=c,s=Xi(i,r)),c===o?(u=r,h=s):(u=null,h=kt(n[c])),null!==h){const t=Il(l);Yi(i,h,n[t],u,!1);const r=Sl(e,t);if(null!==r&&"object"==typeof r){const t=Ol(r,n);null!==t&&Ml(e,r.create[t],n,n[r.anchorIdx])}}break;case 1:const d=t[++a],p=t[++a];ao(i,At(l>>>1,n),null,null,d,p,null);break;default:throw new Error(`Unable to determine the type of mutate operation for "${l}"`)}else switch(l){case pl:const e=t[++a],r=t[++a];null===n[r]&&wi(n[r]=$i(i,e),n);break;case dl:const s=t[++a],o=t[++a];null===n[o]&&wi(n[o]=zi(i,s,null),n)}}}function Nl(e,t,n,r,i){for(let s=0;s<n.length;s++){const o=n[s],a=n[++s];if(o&i){let i="";for(let o=s+1;o<=s+a;o++){const s=n[o];if("string"==typeof s)i+=s;else if("number"==typeof s)if(s<0)i+=_e(t[r-s]);else{const a=s>>>2;switch(3&s){case 1:const s=n[++o],l=n[++o],c=e.data[a];"string"==typeof c?ao(t[11],t[a],null,c,s,i,l):Qs(e,c,t,s,i,t[11],l,!1);break;case 0:const u=t[a];null!==u&&Vi(t[11],u,i);break;case 2:xl(e,Sl(e,a),t,i);break;case 3:Rl(e,Sl(e,a),r,t)}}}}else{const i=n[s+1];if(i>0&&3==(3&i)){const n=Sl(e,i>>>2);t[n.currentCaseLViewIndex]<0&&Rl(e,n,r,t)}}s+=a}}function Rl(e,t,n,r){let i=r[t.currentCaseLViewIndex];if(null!==i){let s=kl;i<0&&(i=r[t.currentCaseLViewIndex]=~i,s=-1),Nl(e,r,t.update[i],n,s)}}function xl(e,t,n,r){const i=function(e,t){let n=e.cases.indexOf(t);if(-1===n)switch(e.type){case 1:{const r=function(e,t){const n=al(t)(parseInt(e,10)),r=ul[n];return void 0!==r?r:"other"}(t,gl);n=e.cases.indexOf(r),-1===n&&"other"!==r&&(n=e.cases.indexOf("other"));break}case 0:n=e.cases.indexOf("other")}return-1===n?null:n}(t,r);if(Ol(t,n)!==i&&(Dl(e,t,n),n[t.currentCaseLViewIndex]=null===i?null:~i,null!==i)){const r=n[t.anchorIdx];r&&Ml(e,t.create[i],n,r)}}function Dl(e,t,n){let r=Ol(t,n);if(null!==r){const i=t.remove[r];for(let t=0;t<i.length;t++){const r=i[t];if(r>0){const e=At(r,n);null!==e&&ls(n[11],e)}else Dl(e,Sl(e,~r),n)}}}function Ll(){const e=[];let t,n,r=-1;function i(e,t){r=0;const i=Ol(e,t);n=null!==i?e.remove[i]:Ge}function s(){if(r<n.length){const o=n[r++];return o>0?t[o]:(e.push(r,n),i(t[1].data[~o],t),s())}return 0===e.length?null:(n=e.pop(),r=e.pop(),s())}return function(n,r){for(t=r;e.length;)e.pop();return i(n.value,r),s}}const Fl=/\ufffd(\d+):?\d*\ufffd/gi,Ul=/\ufffd(\d+)\ufffd/,Bl=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,Vl=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,$l=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,zl=/\uE500/g;function Hl(e,t,n,r,i,s,o){const a=Bs(e,r,1,null);let l=a<<fl.SHIFT,c=jt();t===c&&(c=null),null===c&&(l|=fl.APPEND_EAGERLY),o&&(l|=fl.COMMENT,function(e){void 0===Ni&&(Ni=e())}(Ll)),i.push(l,null===s?"":s);const u=Us(e,a,o?32:1,null===s?"":s,null);_l(n,u);const h=u.index;return Zt(u,!1),null!==c&&t!==c&&function(e,t){let n=e.insertBeforeIndex;null===n?(rs(yl,vl),n=e.insertBeforeIndex=[null,t]):(function(e,t,n){e!=t&&we(n,e,t,"==")}(Array.isArray(n),!0,"Expecting array here"),n.push(t))}(c,h),u}function Gl(e,t,n,r,i,s,o){const a=o.match(Fl),l=Hl(e,t,n,s,r,a?null:o,!1);a&&Wl(i,o,l.index,null,0,null)}function Wl(e,t,n,r,i,s){const o=e.length,a=o+1;e.push(null,null);const l=o+2,c=t.split(Fl);let u=0;for(let h=0;h<c.length;h++){const t=c[h];if(1&h){const n=i+parseInt(t,10);e.push(-1-n),u|=ql(n)}else""!==t&&e.push(t)}return e.push(n<<2|(r?1:0)),r&&e.push(r,s),e[o]=u,e[a]=e.length-l,u}function ql(e){return 1<<Math.min(e,31)}function jl(e){let t,n,r="",i=0,s=!1;for(;null!==(t=Vl.exec(e));)s?t[0]===`\ufffd/*${n}\ufffd`&&(i=t.index,s=!1):(r+=e.substring(i,t.index+t[0].length),n=t[1],s=!0);return r+=e.substr(i),r}function Zl(e,t,n,r,i,s){let o=0;const a={type:i.type,currentCaseLViewIndex:Bs(e,t,1,null),anchorIdx:s,cases:[],create:[],remove:[],update:[]};(function(e,t,n){e.push(ql(t.mainBinding),2,-1-t.mainBinding,n<<2|2)})(n,i,s),function(e,t,n){const r=e.data[t];null===r?e.data[t]=n:r.value=n}(e,s,a);const l=i.values;for(let c=0;c<l.length;c++){const s=l[c],u=[];for(let e=0;e<s.length;e++){const t=s[e];if("string"!=typeof t){const n=u.push(t)-1;s[e]=`\x3c!--\ufffd${n}\ufffd--\x3e`}}o=Ql(e,a,t,n,r,i.cases[c],s.join(""),u)|o}o&&function(e,t,n){e.push(t,1,n<<2|3)}(n,o,s)}function Yl(e){const t=[],n=[];let r=1,i=0;const s=Kl(e=e.replace(Bl,function(e,t,n){return r="select"===n?0:1,i=parseInt(t.substr(1),10),""}));for(let o=0;o<s.length;){let e=s[o++].trim();1===r&&(e=e.replace(/\s*(?:=)?(\w+)\s*/,"$1")),e.length&&t.push(e);const i=Kl(s[o++]);t.length>n.length&&n.push(i)}return{type:r,mainBinding:i,cases:t,values:n}}function Kl(e){if(!e)return[];let t=0;const n=[],r=[],i=/[{}]/g;let s;for(i.lastIndex=0;s=i.exec(e);){const i=s.index;if("}"==s[0]){if(n.pop(),0==n.length){const n=e.substring(t,i);Bl.test(n)?r.push(Yl(n)):r.push(n),t=i+1}}else{if(0==n.length){const n=e.substring(t,i);r.push(n),t=i+1}n.push("{")}}const o=e.substring(t);return r.push(o),r}function Ql(e,t,n,r,i,s,o,a){const l=[],c=[],u=[];t.cases.push(s),t.create.push(l),t.remove.push(c),t.update.push(u);const h=jr(Ot()).getInertBodyElement(o),d=mi(h)||h;return d?Xl(e,t,n,r,l,c,u,d,i,a,0):0}function Xl(e,t,n,r,i,s,o,a,l,c,u){let h=0,d=a.firstChild;for(;d;){const a=Bs(e,n,1,null);switch(d.nodeType){case Node.ELEMENT_NODE:const p=d,f=p.tagName.toLowerCase();if(si.hasOwnProperty(f)){tc(i,dl,f,l,a),e.data[a]=f;const g=p.attributes;for(let e=0;e<g.length;e++){const t=g.item(e),n=t.name.toLowerCase();t.value.match(Fl)?li.hasOwnProperty(n)&&Wl(o,t.value,a,t.name,0,oi[n]?Xr:ai[n]?Jr:null):nc(i,a,t)}h=Xl(e,t,n,r,i,s,o,d,a,c,u+1)|h,Jl(s,a,u)}break;case Node.TEXT_NODE:const g=d.textContent||"",m=g.match(Fl);tc(i,null,m?"":g,l,a),Jl(s,a,u),m&&(h=Wl(o,g,a,null,0,null)|h);break;case Node.COMMENT_NODE:const y=Ul.exec(d.textContent||"");if(y){const t=c[parseInt(y[1],10)];tc(i,pl,"",l,a),Zl(e,n,r,l,t,a),ec(s,a,u)}}d=d.nextSibling}return h}function Jl(e,t,n){0===n&&e.push(t)}function ec(e,t,n){0===n&&(e.push(~t),e.push(t))}function tc(e,t,n,r,i){null!==t&&e.push(t),e.push(n,i,function(e,t,n){return 0|t<<17|n<<1}(0,r,i))}function nc(e,t,n){e.push(t<<1|1,n.name,n.value)}function rc(e,t,n=-1){const r=Ht(),i=zt(),s=20+e,o=Ft(r.consts,t),a=jt();r.firstCreatePass&&function(e,t,n,r,i,s){const o=jt(),a=[],l=[],c=[[]],u=function(e){return e.replace(zl," ")}(i=function(e,t){if(function(e){return-1===e}(t))return jl(e);{const n=e.indexOf(`:${t}\ufffd`)+2+t.toString().length,r=e.search(new RegExp(`\ufffd\\/\\*\\d+:${t}\ufffd`));return jl(e.substring(n,r))}}(i,s)).split($l);for(let h=0;h<u.length;h++){let r=u[h];if(0==(1&h)){const s=Kl(r);for(let r=0;r<s.length;r++){let u=s[r];if(0==(1&r)){const t=u;""!==t&&Gl(e,o,c[0],a,l,n,t)}else{const r=u;if("object"!=typeof r)throw new Error(`Unable to parse ICU expression in "${i}" message.`);Zl(e,n,l,t,r,Hl(e,o,c[0],n,a,"",!0).index)}}}else{const t=47===r.charCodeAt(0),n=(r.charCodeAt(t?1:0),20+Number.parseInt(r.substring(t?2:1)));if(t)c.shift(),Zt(jt(),!1);else{const t=Pl(e,c[0],n);c.unshift([]),Zt(t,!0)}}}e.data[r]={create:a,update:l}}(r,null===a?0:a.index,i,s,o,n);const l=r.data[s],c=Zi(r,a===i[6]?null:a,i);(function(e,t,n,r){const i=e[11];for(let s=0;s<t.length;s++){const o=t[s++],a=t[s],l=(o&fl.COMMENT)===fl.COMMENT,c=(o&fl.APPEND_EAGERLY)===fl.APPEND_EAGERLY,u=o>>>fl.SHIFT;let h=e[u];null===h&&(h=e[u]=l?i.createComment(a):Bi(i,a)),c&&null!==n&&Yi(i,n,h,r,!1)}})(i,l.create,c,a&&8&a.type?i[a.index]:null),rn(!0)}function ic(){rn(!1)}function sc(e,t,n){rc(e,t,n),ic()}function oc(e){return function(e){e&&(kl|=1<<Math.min(Al,31)),Al++}(ta(zt(),tn(),e)),oc}function ac(e){!function(e,t,n){if(Al>0){const r=e.data[n];Nl(e,t,Array.isArray(r)?r:r.update,en()-Al-1,kl)}kl=0,Al=0}(Ht(),zt(),e+20)}function lc(e,t,n,r,i){if(e=me(e),Array.isArray(e))for(let s=0;s<e.length;s++)lc(e[s],t,n,r,i);else{const s=Ht(),o=zt();let a=Vo(e)?e:me(e.provide),l=Fo(e);const c=Wt(),u=1048575&c.providerIndexes,h=c.directiveStart,d=c.providerIndexes>>20;if(Vo(e)||!e.multi){const r=new Tn(l,i,ua),p=hc(a,t,i?u:u+d,h);-1===p?(Hn(Bn(c,o),s,a),cc(s,e,t.length),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(r),o.push(r)):(n[p]=r,o[p]=r)}else{const p=hc(a,t,u+d,h),f=hc(a,t,u,u+d),g=p>=0&&n[p],m=f>=0&&n[f];if(i&&!m||!i&&!g){Hn(Bn(c,o),s,a);const u=function(e,t,n,r,i){const s=new Tn(e,n,ua);return s.multi=[],s.index=t,s.componentProviders=0,uc(s,i,r&&!n),s}(i?pc:dc,n.length,i,r,l);!i&&m&&(n[f].providerFactory=u),cc(s,e,t.length,0),t.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),n.push(u),o.push(u)}else cc(s,e,p>-1?p:f,uc(n[i?f:p],l,!i&&r));!i&&r&&m&&n[f].componentProviders++}}}function cc(e,t,n,r){const i=Vo(t);if(i||function(e){return!!e.useClass}(t)){const s=(t.useClass||t).prototype.ngOnDestroy;if(s){const o=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=o.indexOf(n);-1===e?o.push(n,[r,s]):o[e+1].push(r,s)}else o.push(n,s)}}}function uc(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function hc(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function dc(e,t,n,r){return fc(this.multi,[])}function pc(e,t,n,r){const i=this.multi;let s;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=Qn(n,n[1],this.providerFactory.index,r);s=t.slice(0,e),fc(i,s);for(let n=e;n<t.length;n++)s.push(t[n])}else s=[],fc(i,s);return s}function fc(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function gc(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=Ht();if(r.firstCreatePass){const i=ft(e);lc(n,r.data,r.blueprint,i,!0),lc(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class mc{}const yc="ngComponent";class vc{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${de(e)}. Did you add it to @NgModule.entryComponents?`);return t[yc]=e,t}(e)}}let _c=(()=>{class e{}return e.NULL=new vc,e})();function Cc(...e){}function Ec(e,t){return new bc(Mt(e,t))}const wc=function(){return Ec(Wt(),zt())};let bc=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=wc,e})();function Sc(e){return e instanceof bc?e.nativeElement:e}class Pc{}let Oc=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>Tc(),e})();const Tc=function(){const e=zt(),t=xt(Wt().index,e);return function(e){return e[11]}(ct(t)?t:e)};let Ic=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>null}),e})();class kc{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const Ac=new kc("12.2.16");class Mc{constructor(){}supports(e){return Xo(e)}create(e){return new Rc(e)}}const Nc=(e,t)=>t;class Rc{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||Nc}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const s=!n||t&&t.currentIndex<Fc(n,r,i)?t:n,o=Fc(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(t=t._next,null==s.previousIndex)r++;else{i||(i=[]);const e=o-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;t<=s&&s<e&&(i[n]=r+1)}i[s.previousIndex]=t-e}}o!==a&&e(s,o,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Xo(e))throw new Error(`Error trying to diff '${de(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),s=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Ko()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),s=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new xc(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Lc),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lc),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class xc{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Dc{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class Lc{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new Dc,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Fc(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class Uc{constructor(){}supports(e){return e instanceof Map||Jo(e)}create(){return new Bc}}class Bc{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||Jo(e)))throw new Error(`Error trying to diff '${de(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new Vc(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class Vc{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function $c(){return new zc([new Mc])}let zc=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||$c()),deps:[[e,new Rr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:$c}),e})();function Hc(){return new Gc([new Uc])}let Gc=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Hc()),deps:[[e,new Rr,new Nr]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=be({token:e,providedIn:"root",factory:Hc}),e})();function Wc(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(kt(s)),ut(s))for(let e=10;e<s.length;e++){const t=s[e],n=t[1].firstChild;null!==n&&Wc(t[1],t,n,r)}const o=n.type;if(8&o)Wc(e,t,n.child,r);else if(32&o){const e=Ri(n,t);let i;for(;i=e();)r.push(i)}else if(16&o){const e=os(t,n);if(Array.isArray(e))r.push(...e);else{const n=xi(t[16]);Wc(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class qc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Wc(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ut(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Gi(e,n),dr(t,n))}this._attachedToViewContainer=!1}Wi(this._lView[1],this._lView)}onDestroy(e){Ys(this._lView[1],this._lView,null,e)}markForCheck(){mo(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){yo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Xt(!0);try{yo(e,t,n)}finally{Xt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,us(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class jc extends qc{constructor(e){super(e),this._view=e}detectChanges(){vo(this._view)}checkNoChanges(){!function(e){Xt(!0);try{vo(e)}finally{Xt(!1)}}(this._view)}get context(){return null}}const Zc=function(e){return function(e,t,n){if(dt(e)&&!n){const n=xt(e.index,t);return new qc(n,n)}return 47&e.type?new qc(t[16],t):null}(Wt(),zt(),16==(16&e))};let Yc=(()=>{class e{}return e.__NG_ELEMENT_ID__=Zc,e})();const Kc=[new Uc],Qc=new zc([new Mc]),Xc=new Gc(Kc),Jc=function(){return ru(Wt(),zt())};let eu=(()=>{class e{}return e.__NG_ELEMENT_ID__=Jc,e})();const tu=eu,nu=class extends tu{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ls(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Vs(t,n,e),new qc(n)}};function ru(e,t){return 4&e.type?new nu(t,e,Ec(e,t)):null}class iu{}class su{}const ou=function(){return du(Wt(),zt())};let au=(()=>{class e{}return e.__NG_ELEMENT_ID__=ou,e})();const lu=au,cu=class extends lu{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Ec(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const e=zn(this._hostTNode,this._hostLView);if(Rn(e)){const t=Dn(e,this._hostLView),n=xn(e);return new er(t[1].data[n+8],t)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=uu(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const s=n||this.parentInjector;if(!i&&null==e.ngModule&&s){const e=s.get(iu,null);e&&(i=e)}const o=e.create(s,r,void 0,i);return this.insert(o.hostView,t),o}insert(e,t){const n=e._lView,r=n[1];if(ut(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new cu(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),s=this._lContainer;!function(e,t,n,r){const i=10+r,s=n.length;r>0&&(n[i-1][4]=t),r<s-10?(t[4]=n[i],hr(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const o=t[17];null!==o&&n!==o&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,s,i);const o=as(i,s),a=n[11],l=Xi(a,s[7]);return null!==l&&function(e,t,n,r,i,s){r[0]=i,r[6]=t,us(e,r,n,1,i,s)}(r,s[6],a,n,l,o),e.attachToViewContainerRef(),hr(hu(s),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=uu(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);n&&(dr(hu(this._lContainer),t),Wi(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Gi(this._lContainer,t);return n&&null!=dr(hu(this._lContainer),t)?new qc(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function uu(e){return e[8]}function hu(e){return e[8]||(e[8]=[])}function du(e,t){let n;const r=t[e.index];if(ut(r))n=r;else{let i;if(8&e.type)i=kt(r);else{const n=t[11];i=n.createComment("");const r=Mt(e,t);Yi(n,Xi(n,r),i,function(e,t){return Tt(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=uo(r,t,i,e),go(t,n)}return new cu(n,e,t)}const pu={};class fu extends _c{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=at(e);return new yu(t,this.ngModule)}}function gu(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const mu=new or("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ki});class yu extends mc{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(Ps).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return gu(this.componentDef.inputs)}get outputs(){return gu(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const s=e.get(n,pu,i);return s!==pu||r===pu?s:t.get(n,r,i)}}}(e,r.injector):e,s=i.get(Pc,It),o=i.get(Ic,null),a=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=n?function(e,t,n){if(Tt(e))return e.selectRootElement(t,n===Ue.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):zi(s.createRenderer(null,this.componentDef),l,function(e){const t=e.toLowerCase();return"svg"===t?St:"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),u=this.componentDef.onPush?576:528,h=function(e,t){return{components:[],scheduler:e||ki,clean:Co,playerHandler:t||null,flags:0}}(),d=Zs(0,null,null,1,0,null,null,null,null,null),p=Ls(null,d,h,u,null,null,s,a,o,i);let f,g;hn(p);try{const e=function(e,t,n,r,i,s){const o=n[1];n[20]=e;const a=Fs(o,20,2,"#host",null),l=a.mergedAttrs=t.hostAttrs;null!==l&&(Oo(a,l,!0),null!==e&&(In(i,e,l),null!==a.classes&&ps(i,e,a.classes),null!==a.styles&&ds(i,e,a.styles)));const c=r.createRenderer(e,t),u=Ls(n,js(t),null,t.onPush?64:16,n[20],a,r,c,s||null,null);return o.firstCreatePass&&(Hn(Bn(a,n),o,t.type),to(o,a),ro(a,n.length,1)),go(n,u),n[20]=u}(c,this.componentDef,p,s,a);if(c)if(n)In(a,c,["ng-version",Ac.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!Cs(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&In(a,c,e),t&&t.length>0&&ps(a,c,t.join(" "))}if(g=Nt(d,20),void 0!==t){const e=g.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}f=function(e,t,n,r,i){const s=n[1],o=function(e,t,n){const r=Wt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),io(e,r,t,Bs(e,t,1,null),n));const i=Qn(t,e,r.directiveStart,r);wi(i,t);const s=Mt(r,t);return s&&wi(s,t),i}(s,n,t);if(r.components.push(o),e[8]=o,i&&i.forEach(e=>e(o,t)),t.contentQueries){const e=Wt();t.contentQueries(1,o,e.directiveStart)}const a=Wt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(vn(a.index),Js(n[1],a,0,a.directiveStart,a.directiveEnd,t),eo(t,o)),o}(e,this.componentDef,p,h,[Ho]),Vs(d,p,null)}finally{mn()}return new vu(this.componentType,f,Ec(g,p),p,g)}}class vu extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new jc(r),this.componentType=e}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const _u=new Map;class Cu extends iu{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new fu(this);const n=lt(e),r=e[Ye]||null;r&&ml(r),this._bootstrapComponents=Ai(n.bootstrap),this._r3Injector=xo(e,t,[{provide:iu,useValue:this},{provide:_c,useValue:this.componentFactoryResolver}],de(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=zo.THROW_IF_NOT_FOUND,n=Ne.Default){return e===zo||e===iu||e===To?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Eu extends su{constructor(e){super(),this.moduleType=e,null!==lt(e)&&function(e){const t=new Set;!function e(n){const r=lt(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${de(t)} vs ${de(t.name)}`)}(i,_u.get(i),n),_u.set(i,n));const s=Ai(r.imports);for(const o of s)t.has(o)||(t.add(o),e(o))}(e)}(e)}create(e){return new Cu(this.moduleType,e)}}function wu(e,t,n){const r=Jt()+e,i=zt();return i[r]===Os?ea(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function bu(e,t,n,r){return Tu(zt(),Jt(),e,t,n,r)}function Su(e,t,n,r,i){return Iu(zt(),Jt(),e,t,n,r,i)}function Pu(e,t,n,r,i,s,o){return function(e,t,n,r,i,s,o,a,l){const c=t+n;return function(e,t,n,r,i,s){const o=na(e,t,n,r);return na(e,t+2,i,s)||o}(e,c,i,s,o,a)?ea(e,c+4,l?r.call(l,i,s,o,a):r(i,s,o,a)):Ou(e,c+4)}(zt(),Jt(),e,t,n,r,i,s,o)}function Ou(e,t){const n=e[t];return n===Os?void 0:n}function Tu(e,t,n,r,i,s){const o=t+n;return ta(e,o,i)?ea(e,o+1,s?r.call(s,i):r(i)):Ou(e,o+1)}function Iu(e,t,n,r,i,s,o){const a=t+n;return na(e,a,i,s)?ea(e,a+2,o?r.call(o,i,s):r(i,s)):Ou(e,a+2)}function ku(e,t){const n=Ht();let r;const i=e+20;n.firstCreatePass?(r=function(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}throw new ve("302",`The pipe '${e}' could not be found!`)}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=mt(r.type)),o=xe(ua);try{const e=Fn(!1),t=s();return Fn(e),function(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,zt(),i,t),t}finally{xe(o)}}function Au(e,t,n){const r=e+20,i=zt(),s=Rt(i,r);return Nu(i,Mu(i,r)?Tu(i,Jt(),t,s.transform,n,s):s.transform(n))}function Mu(e,t){return e[1].data[t].pure}function Nu(e,t){return Qo.isWrapped(t)&&(t=Qo.unwrap(t),e[en()]=Os),t}function Ru(e){return t=>{setTimeout(e,void 0,t)}}const xu=class extends A{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,i,s;let o=e,l=t||(()=>null),c=n;if(e&&"object"==typeof e){const t=e;o=null===(r=t.next)||void 0===r?void 0:r.bind(t),l=null===(i=t.error)||void 0===i?void 0:i.bind(t),c=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(l=Ru(l),o&&(o=Ru(o)),c&&(c=Ru(c)));const u=super.subscribe({next:o,error:l,complete:c});return e instanceof a&&e.add(u),u}};function Du(){return this._results[Ko()]()}class Lu{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Ko(),n=Lu.prototype;n[t]||(n[t]=Du)}get changes(){return this._changes||(this._changes=new xu)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=cr(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=t[r];if(n&&(i=n(i),s=n(s)),s!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Fu{constructor(e){this.queryList=e,this.matches=null}clone(){return new Fu(this.queryList)}setDirty(){this.queryList.setDirty()}}class Uu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new Uu(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==Yu(e,t).matches&&this.queries[t].setDirty()}}class Bu{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class Vu{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new Vu(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class $u{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new $u(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,zu(t,i)),this.matchTNodeWithReadOption(e,t,Kn(t,e,i,!1,!1))}else n===eu?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kn(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===bc||r===au||r===eu&&4&t.type)this.addMatch(t.index,-2);else{const n=Kn(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function zu(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function Hu(e,t,n,r){return-1===n?function(e,t){return 11&e.type?Ec(e,t):4&e.type?ru(e,t):null}(t,e):-2===n?function(e,t,n){return n===bc?Ec(t,e):n===eu?ru(t,e):n===au?du(t,e):void 0}(e,t,r):Qn(e,e[1],n,t)}function Gu(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,s=n.matches,o=[];for(let e=0;e<s.length;e+=2){const i=s[e];o.push(i<0?null:Hu(t,r[i],s[e+1],n.metadata.read))}i.matches=o}return i.matches}function Wu(e,t,n,r){const i=e.queries.getByIndex(n),s=i.matches;if(null!==s){const o=Gu(e,t,i,n);for(let e=0;e<s.length;e+=2){const n=s[e];if(n>0)r.push(o[e/2]);else{const i=s[e+1],o=t[-n];for(let e=10;e<o.length;e++){const t=o[e];t[17]===t[3]&&Wu(t[1],t,i,r)}if(null!==o[9]){const e=o[9];for(let t=0;t<e.length;t++){const n=e[t];Wu(n[1],n,i,r)}}}}}return r}function qu(e){const t=zt(),n=Ht(),r=an();ln(r+1);const i=Yu(n,r);if(e.dirty&&Dt(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?Wu(n,t,r,[]):Gu(n,t,i,r);e.reset(s,Sc),e.notifyOnChanges()}return!0}return!1}function ju(e,t,n){const r=Ht();r.firstCreatePass&&(function(e,t,n){null===e.queries&&(e.queries=new Vu),e.queries.track(new $u(t,n))}(r,new Bu(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(e,t,n){const r=new Lu(4==(4&n));Ys(e,t,r,r.destroy),null===t[19]&&(t[19]=new Uu),t[19].queries.push(new Fu(r))}(r,zt(),t)}function Zu(){return e=zt(),t=an(),e[19].queries[t].queryList;var e,t}function Yu(e,t){return e.queries.getByIndex(t)}function Ku(e,t){return ru(e,t)}const Qu=new or("Application Initializer");let Xu=(()=>{class e{constructor(e){this.appInits=e,this.resolve=Cc,this.reject=Cc,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(_a(t))e.push(t);else if(Ca(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(Qu,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const Ju=new or("AppId"),eh={provide:Ju,useFactory:function(){return`${th()}${th()}${th()}`},deps:[]};function th(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const nh=new or("Platform Initializer"),rh=new or("Platform ID"),ih=new or("appBootstrapListener");let sh=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const oh=new or("LocaleId"),ah=new or("DefaultCurrencyCode");class lh{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const ch=function(e){return new Eu(e)},uh=ch,hh=function(e){return Promise.resolve(ch(e))},dh=function(e){const t=ch(e),n=Ai(lt(e).declarations).reduce((e,t)=>{const n=at(t);return n&&e.push(new yu(n)),e},[]);return new lh(t,n)},ph=dh,fh=function(e){return Promise.resolve(dh(e))};let gh=(()=>{class e{constructor(){this.compileModuleSync=uh,this.compileModuleAsync=hh,this.compileModuleAndAllComponentsSync=ph,this.compileModuleAndAllComponentsAsync=fh}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const mh=(()=>Promise.resolve(0))();function yh(e){"undefined"==typeof Zone?mh.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class vh{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new xu(!1),this.onMicrotaskEmpty=new xu(!1),this.onStable=new xu(!1),this.onError=new xu(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ze,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Eh(e),e.isCheckStableRunning=!0,Ch(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Eh(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{try{return wh(e),n.invokeTask(i,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),bh(e)}},onInvoke:(n,r,i,s,o,a,l)=>{try{return wh(e),n.invoke(i,s,o,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),bh(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Eh(e),Ch(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!vh.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(vh.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,e,_h,Cc,Cc);try{return i.runTask(s,t,n)}finally{i.cancelTask(s)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const _h={};function Ch(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Eh(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function wh(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function bh(e){e._nesting--,Ch(e)}class Sh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xu,this.onMicrotaskEmpty=new xu,this.onStable=new xu,this.onError=new xu}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let Ph=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{vh.assertNotInAngularZone(),yh(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())yh(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(Or(vh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Oh=(()=>{class e{constructor(){this._applications=new Map,Ih.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Ih.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class Th{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}let Ih=new Th,kh=!0,Ah=!1;let Mh;const Nh=new or("AllowMultipleToken");class Rh{constructor(e,t){this.name=e,this.token=t}}function xh(e,t,n=[]){const r=`Platform: ${t}`,i=new or(r);return(t=[])=>{let s=Dh();if(!s||s.injector.get(Nh,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:ko,useValue:"platform"});!function(e){if(Mh&&!Mh.destroyed&&!Mh.injector.get(Nh,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Mh=e.get(Lh);const t=e.get(nh,null);t&&t.forEach(e=>e())}(zo.create({providers:e,name:r}))}return function(e){const t=Dh();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function Dh(){return Mh&&!Mh.destroyed?Mh:null}let Lh=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new Sh:("zone.js"===e?void 0:e)||new vh({enableLongStackTrace:(Ah=!0,kh),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:vh,useValue:n}];return n.run(()=>{const i=zo.create({providers:r,parent:this.injector,name:e.moduleType.name}),s=e.create(i),o=s.injector.get(Oi,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});s.onDestroy(()=>{Bh(this._modules,s),e.unsubscribe()})}),function(e,n,r){try{const t=r();return _a(t)?t.catch(t=>{throw n.runOutsideAngular(()=>e.handleError(t)),t}):t}catch(t){throw n.runOutsideAngular(()=>e.handleError(t)),t}}(o,n,()=>{const e=s.injector.get(Xu);return e.runInitializers(),e.donePromise.then(()=>(ml(s.injector.get(oh,hl)||hl),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,t=[]){const n=Fh({},t);return function(e,t,n){const r=new Eu(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(Uh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${de(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Fh(e,t){return Array.isArray(t)?t.reduce(Fh,e):Object.assign(Object.assign({},e),t)}let Uh=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new T(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),o=new T(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{vh.assertNotInAngularZone(),yh(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{vh.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=function(...e){const t=re(e),n=function(e,t){return"number"==typeof te(e)?e.pop():1/0}(e),r=e;return r.length?1===r.length?Y(r[0]):J(n)(ae(r,t)):ee}(s,o.pipe(function(e={}){const{connector:t=(()=>new A),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return e=>{let s=null,o=null,a=null,l=0,c=!1,u=!1;const h=()=>{null==o||o.unsubscribe(),o=null},d=()=>{h(),s=a=null,c=u=!1},p=()=>{const e=s;d(),null==e||e.unsubscribe()};return R((e,f)=>{l++,!u&&!c&&h();const g=a=a??t();f.add(()=>{l--,0===l&&!u&&!c&&(o=ce(p,i))}),g.subscribe(f),s||(s=new C({next:e=>g.next(e),error:e=>{u=!0,h(),o=ce(d,n,e),g.error(e)},complete:()=>{c=!0,h(),o=ce(d,r),g.complete()}}),ae(e).subscribe(s))})(e)}}()))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof mc?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(iu),i=n.create(zo.NULL,[],t||n.selector,r),s=i.location.nativeElement,o=i.injector.get(Ph,null),a=o&&i.injector.get(Oh);return o&&a&&a.registerApplication(s,o),i.onDestroy(()=>{this.detachView(i.hostView),Bh(this.components,i),a&&a.unregisterApplication(s)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;Bh(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ih,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(Or(vh),Or(zo),Or(Oi),Or(_c),Or(Xu))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Bh(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Vh{}class $h{}const zh={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Hh=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||zh}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>Gh(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>Gh(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(Or(gh),Or($h,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Gh(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const Wh=xh(null,"core",[{provide:rh,useValue:"unknown"},{provide:Lh,deps:[zo]},{provide:Oh,deps:[]},{provide:sh,deps:[]}]),qh=[{provide:Uh,useClass:Uh,deps:[vh,zo,Oi,_c,Xu]},{provide:mu,deps:[vh],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Xu,useClass:Xu,deps:[[new Nr,Qu]]},{provide:gh,useClass:gh,deps:[]},eh,{provide:zc,useFactory:function(){return Qc},deps:[]},{provide:Gc,useFactory:function(){return Xc},deps:[]},{provide:oh,useFactory:function(e){return ml(e=e||"undefined"!=typeof $localize&&$localize.locale||hl),e},deps:[[new Mr(oh),new Nr,new Rr]]},{provide:ah,useValue:"USD"}];let jh=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(Or(Uh))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:qh}),e})(),Zh=null;function Yh(){return Zh}const Kh=new or("DocumentToken");let Qh=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:Xh,token:e,providedIn:"platform"}),e})();function Xh(){return Or(ed)}const Jh=new or("Location Initialized");let ed=(()=>{class e extends Qh{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Yh().getBaseHref(this._doc)}onPopState(e){const t=Yh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=Yh().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){td()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){td()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=be({factory:nd,token:e,providedIn:"platform"}),e})();function td(){return!!window.history.pushState}function nd(){return new ed(Or(Kh))}function rd(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function id(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function sd(e){return e&&"?"!==e[0]?"?"+e:e}let od=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:ad,token:e,providedIn:"root"}),e})();function ad(e){const t=Or(Kh).location;return new cd(Or(Qh),t&&t.origin||"")}const ld=new or("appBaseHref");let cd=(()=>{class e extends od{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return rd(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+sd(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+sd(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+sd(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Qh),Or(ld,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),ud=(()=>{class e extends od{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=rd(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+sd(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+sd(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Qh),Or(ld,8))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),hd=(()=>{class e{constructor(e,t){this._subject=new xu,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=id(pd(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+sd(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,pd(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+sd(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+sd(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(Or(od),Or(Qh))},e.normalizeQueryParams=sd,e.joinWithSlash=rd,e.stripTrailingSlash=id,e.\u0275prov=be({factory:dd,token:e,providedIn:"root"}),e})();function dd(){return new hd(Or(od),Or(Qh))}function pd(e){return e.replace(/\/index.html$/,"")}var fd=(()=>((fd=fd||{})[fd.Decimal=0]="Decimal",fd[fd.Percent=1]="Percent",fd[fd.Currency=2]="Currency",fd[fd.Scientific=3]="Scientific",fd))(),gd=(()=>((gd=gd||{})[gd.Zero=0]="Zero",gd[gd.One=1]="One",gd[gd.Two=2]="Two",gd[gd.Few=3]="Few",gd[gd.Many=4]="Many",gd[gd.Other=5]="Other",gd))(),md=(()=>((md=md||{})[md.Format=0]="Format",md[md.Standalone=1]="Standalone",md))(),yd=(()=>((yd=yd||{})[yd.Narrow=0]="Narrow",yd[yd.Abbreviated=1]="Abbreviated",yd[yd.Wide=2]="Wide",yd[yd.Short=3]="Short",yd))(),vd=(()=>((vd=vd||{})[vd.Short=0]="Short",vd[vd.Medium=1]="Medium",vd[vd.Long=2]="Long",vd[vd.Full=3]="Full",vd))(),_d=(()=>((_d=_d||{})[_d.Decimal=0]="Decimal",_d[_d.Group=1]="Group",_d[_d.List=2]="List",_d[_d.PercentSign=3]="PercentSign",_d[_d.PlusSign=4]="PlusSign",_d[_d.MinusSign=5]="MinusSign",_d[_d.Exponential=6]="Exponential",_d[_d.SuperscriptingExponent=7]="SuperscriptingExponent",_d[_d.PerMille=8]="PerMille",_d[_d.Infinity=9]="Infinity",_d[_d.NaN=10]="NaN",_d[_d.TimeSeparator=11]="TimeSeparator",_d[_d.CurrencyDecimal=12]="CurrencyDecimal",_d[_d.CurrencyGroup=13]="CurrencyGroup",_d))();function Cd(e,t){return Od(ol(e)[cl.DateFormat],t)}function Ed(e,t){return Od(ol(e)[cl.TimeFormat],t)}function wd(e,t){return Od(ol(e)[cl.DateTimeFormat],t)}function bd(e,t){const n=ol(e),r=n[cl.NumberSymbols][t];if(void 0===r){if(t===_d.CurrencyDecimal)return n[cl.NumberSymbols][_d.Decimal];if(t===_d.CurrencyGroup)return n[cl.NumberSymbols][_d.Group]}return r}const Sd=al;function Pd(e){if(!e[cl.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[cl.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Od(e,t){for(let n=t;n>-1;n--)if(void 0!==e[n])return e[n];throw new Error("Locale data API: locale data undefined")}function Td(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const Id=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,kd={},Ad=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Md=(()=>((Md=Md||{})[Md.Short=0]="Short",Md[Md.ShortGMT=1]="ShortGMT",Md[Md.Long=2]="Long",Md[Md.Extended=3]="Extended",Md))(),Nd=(()=>((Nd=Nd||{})[Nd.FullYear=0]="FullYear",Nd[Nd.Month=1]="Month",Nd[Nd.Date=2]="Date",Nd[Nd.Hours=3]="Hours",Nd[Nd.Minutes=4]="Minutes",Nd[Nd.Seconds=5]="Seconds",Nd[Nd.FractionalSeconds=6]="FractionalSeconds",Nd[Nd.Day=7]="Day",Nd))(),Rd=(()=>((Rd=Rd||{})[Rd.DayPeriods=0]="DayPeriods",Rd[Rd.Days=1]="Days",Rd[Rd.Months=2]="Months",Rd[Rd.Eras=3]="Eras",Rd))();function xd(e,t,n,r){let i=function(e){if(jd(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[t,n=1,r=1]=e.split("-").map(e=>+e);return Dd(t,n-1,r)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let n;if(n=e.match(Id))return function(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,s=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const o=Number(e[4]||0)-n,a=Number(e[5]||0)-r,l=Number(e[6]||0),c=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return s.call(t,o,a,l,c),t}(n)}const t=new Date(e);if(!jd(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=Ld(n,t)||t;let s,o=[];for(;t;){if(s=Ad.exec(t),!s){o.push(t);break}{o=o.concat(s.slice(1));const e=o.pop();if(!e)break;t=e}}let a=i.getTimezoneOffset();r&&(a=qd(r,a),i=function(e,t,n){const r=e.getTimezoneOffset();return function(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,-1*(qd(t,r)-r))}(i,r));let l="";return o.forEach(e=>{const t=function(e){if(Wd[e])return Wd[e];let t;switch(e){case"G":case"GG":case"GGG":t=Vd(Rd.Eras,yd.Abbreviated);break;case"GGGG":t=Vd(Rd.Eras,yd.Wide);break;case"GGGGG":t=Vd(Rd.Eras,yd.Narrow);break;case"y":t=Bd(Nd.FullYear,1,0,!1,!0);break;case"yy":t=Bd(Nd.FullYear,2,0,!0,!0);break;case"yyy":t=Bd(Nd.FullYear,3,0,!1,!0);break;case"yyyy":t=Bd(Nd.FullYear,4,0,!1,!0);break;case"Y":t=Gd(1);break;case"YY":t=Gd(2,!0);break;case"YYY":t=Gd(3);break;case"YYYY":t=Gd(4);break;case"M":case"L":t=Bd(Nd.Month,1,1);break;case"MM":case"LL":t=Bd(Nd.Month,2,1);break;case"MMM":t=Vd(Rd.Months,yd.Abbreviated);break;case"MMMM":t=Vd(Rd.Months,yd.Wide);break;case"MMMMM":t=Vd(Rd.Months,yd.Narrow);break;case"LLL":t=Vd(Rd.Months,yd.Abbreviated,md.Standalone);break;case"LLLL":t=Vd(Rd.Months,yd.Wide,md.Standalone);break;case"LLLLL":t=Vd(Rd.Months,yd.Narrow,md.Standalone);break;case"w":t=Hd(1);break;case"ww":t=Hd(2);break;case"W":t=Hd(1,!0);break;case"d":t=Bd(Nd.Date,1);break;case"dd":t=Bd(Nd.Date,2);break;case"c":case"cc":t=Bd(Nd.Day,1);break;case"ccc":t=Vd(Rd.Days,yd.Abbreviated,md.Standalone);break;case"cccc":t=Vd(Rd.Days,yd.Wide,md.Standalone);break;case"ccccc":t=Vd(Rd.Days,yd.Narrow,md.Standalone);break;case"cccccc":t=Vd(Rd.Days,yd.Short,md.Standalone);break;case"E":case"EE":case"EEE":t=Vd(Rd.Days,yd.Abbreviated);break;case"EEEE":t=Vd(Rd.Days,yd.Wide);break;case"EEEEE":t=Vd(Rd.Days,yd.Narrow);break;case"EEEEEE":t=Vd(Rd.Days,yd.Short);break;case"a":case"aa":case"aaa":t=Vd(Rd.DayPeriods,yd.Abbreviated);break;case"aaaa":t=Vd(Rd.DayPeriods,yd.Wide);break;case"aaaaa":t=Vd(Rd.DayPeriods,yd.Narrow);break;case"b":case"bb":case"bbb":t=Vd(Rd.DayPeriods,yd.Abbreviated,md.Standalone,!0);break;case"bbbb":t=Vd(Rd.DayPeriods,yd.Wide,md.Standalone,!0);break;case"bbbbb":t=Vd(Rd.DayPeriods,yd.Narrow,md.Standalone,!0);break;case"B":case"BB":case"BBB":t=Vd(Rd.DayPeriods,yd.Abbreviated,md.Format,!0);break;case"BBBB":t=Vd(Rd.DayPeriods,yd.Wide,md.Format,!0);break;case"BBBBB":t=Vd(Rd.DayPeriods,yd.Narrow,md.Format,!0);break;case"h":t=Bd(Nd.Hours,1,-12);break;case"hh":t=Bd(Nd.Hours,2,-12);break;case"H":t=Bd(Nd.Hours,1);break;case"HH":t=Bd(Nd.Hours,2);break;case"m":t=Bd(Nd.Minutes,1);break;case"mm":t=Bd(Nd.Minutes,2);break;case"s":t=Bd(Nd.Seconds,1);break;case"ss":t=Bd(Nd.Seconds,2);break;case"S":t=Bd(Nd.FractionalSeconds,1);break;case"SS":t=Bd(Nd.FractionalSeconds,2);break;case"SSS":t=Bd(Nd.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=$d(Md.Short);break;case"ZZZZZ":t=$d(Md.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=$d(Md.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=$d(Md.Long);break;default:return null}return Wd[e]=t,t}(e);l+=t?t(i,n,a):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function Dd(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function Ld(e,t){const n=function(e){return ol(e)[cl.LocaleId]}(e);if(kd[n]=kd[n]||{},kd[n][t])return kd[n][t];let r="";switch(t){case"shortDate":r=Cd(e,vd.Short);break;case"mediumDate":r=Cd(e,vd.Medium);break;case"longDate":r=Cd(e,vd.Long);break;case"fullDate":r=Cd(e,vd.Full);break;case"shortTime":r=Ed(e,vd.Short);break;case"mediumTime":r=Ed(e,vd.Medium);break;case"longTime":r=Ed(e,vd.Long);break;case"fullTime":r=Ed(e,vd.Full);break;case"short":const t=Ld(e,"shortTime"),n=Ld(e,"shortDate");r=Fd(wd(e,vd.Short),[t,n]);break;case"medium":const i=Ld(e,"mediumTime"),s=Ld(e,"mediumDate");r=Fd(wd(e,vd.Medium),[i,s]);break;case"long":const o=Ld(e,"longTime"),a=Ld(e,"longDate");r=Fd(wd(e,vd.Long),[o,a]);break;case"full":const l=Ld(e,"fullTime"),c=Ld(e,"fullDate");r=Fd(wd(e,vd.Full),[l,c])}return r&&(kd[n][t]=r),r}function Fd(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(e,n){return null!=t&&n in t?t[n]:e})),e}function Ud(e,t,n="-",r,i){let s="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,s=n));let o=String(e);for(;o.length<t;)o="0"+o;return r&&(o=o.substr(o.length-t)),s+o}function Bd(e,t,n=0,r=!1,i=!1){return function(s,o){let a=function(e,t){switch(e){case Nd.FullYear:return t.getFullYear();case Nd.Month:return t.getMonth();case Nd.Date:return t.getDate();case Nd.Hours:return t.getHours();case Nd.Minutes:return t.getMinutes();case Nd.Seconds:return t.getSeconds();case Nd.FractionalSeconds:return t.getMilliseconds();case Nd.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,s);if((n>0||a>-n)&&(a+=n),e===Nd.Hours)0===a&&-12===n&&(a=12);else if(e===Nd.FractionalSeconds)return function(e,t){return Ud(e,3).substr(0,t)}(a,t);const l=bd(o,_d.MinusSign);return Ud(a,t,l,r,i)}}function Vd(e,t,n=md.Format,r=!1){return function(i,s){return function(e,t,n,r,i,s){switch(n){case Rd.Months:return function(e,t,n){const r=ol(e),i=Od([r[cl.MonthsFormat],r[cl.MonthsStandalone]],t);return Od(i,n)}(t,i,r)[e.getMonth()];case Rd.Days:return function(e,t,n){const r=ol(e),i=Od([r[cl.DaysFormat],r[cl.DaysStandalone]],t);return Od(i,n)}(t,i,r)[e.getDay()];case Rd.DayPeriods:const o=e.getHours(),a=e.getMinutes();if(s){const e=function(e){const t=ol(e);return Pd(t),(t[cl.ExtraData][2]||[]).map(e=>"string"==typeof e?Td(e):[Td(e[0]),Td(e[1])])}(t),n=function(e,t,n){const r=ol(e);Pd(r);const i=Od([r[cl.ExtraData][0],r[cl.ExtraData][1]],t)||[];return Od(i,n)||[]}(t,i,r),s=e.findIndex(e=>{if(Array.isArray(e)){const[t,n]=e,r=o>=t.hours&&a>=t.minutes,i=o<n.hours||o===n.hours&&a<n.minutes;if(t.hours<n.hours){if(r&&i)return!0}else if(r||i)return!0}else if(e.hours===o&&e.minutes===a)return!0;return!1});if(-1!==s)return n[s]}return function(e,t,n){const r=ol(e),i=Od([r[cl.DayPeriodsFormat],r[cl.DayPeriodsStandalone]],t);return Od(i,n)}(t,i,r)[o<12?0:1];case Rd.Eras:return function(e,t){return Od(ol(e)[cl.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,s,e,t,n,r)}}function $d(e){return function(t,n,r){const i=-1*r,s=bd(n,_d.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case Md.Short:return(i>=0?"+":"")+Ud(o,2,s)+Ud(Math.abs(i%60),2,s);case Md.ShortGMT:return"GMT"+(i>=0?"+":"")+Ud(o,1,s);case Md.Long:return"GMT"+(i>=0?"+":"")+Ud(o,2,s)+":"+Ud(Math.abs(i%60),2,s);case Md.Extended:return 0===r?"Z":(i>=0?"+":"")+Ud(o,2,s)+":"+Ud(Math.abs(i%60),2,s);default:throw new Error(`Unknown zone width "${e}"`)}}}function zd(e){return Dd(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function Hd(e,t=!1){return function(n,r){let i;if(t){const e=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,t=n.getDate();i=1+Math.floor((t+e)/7)}else{const e=zd(n),t=function(e){const t=Dd(e,0,1).getDay();return Dd(e,0,1+(t<=4?4:11)-t)}(e.getFullYear()),r=e.getTime()-t.getTime();i=1+Math.round(r/6048e5)}return Ud(i,e,bd(r,_d.MinusSign))}}function Gd(e,t=!1){return function(n,r){return Ud(zd(n).getFullYear(),e,bd(r,_d.MinusSign),t)}}const Wd={};function qd(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function jd(e){return e instanceof Date&&!isNaN(e.valueOf())}const Zd=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Yd(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class Kd{}let Qd=(()=>{class e extends Kd{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(Sd(t||this.locale)(e)){case gd.Zero:return"zero";case gd.One:return"one";case gd.Two:return"two";case gd.Few:return"few";case gd.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(Or(oh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Xd(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let Jd=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Xo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${de(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(ua(zc),ua(Gc),ua(bc),ua(Oc))},e.\u0275dir=st({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class ep{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let tp=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch{throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(e){return e.name||typeof e}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new ep(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new np(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new np(e,i);t.push(s)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(au),ua(eu),ua(zc))},e.\u0275dir=st({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class np{constructor(e,t){this.record=e,this.view=t}}let rp=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new ip,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){sp("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){sp("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(ua(au),ua(eu))},e.\u0275dir=st({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class ip{constructor(){this.$implicit=null,this.ngIf=null}}function sp(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${de(t)}'.`)}let op=(()=>{class e{constructor(e){this._locale=e}transform(t,n,r){if(!function(e){return!(null==e||""===e||e!=e)}(t))return null;r=r||this._locale;try{return function(e,t,n){return function(e,t,n,r,i,s,o=!1){let a="",l=!1;if(isFinite(e)){let c=function(e){let t,n,r,i,s,o=Math.abs(e)+"",a=0;for((n=o.indexOf("."))>-1&&(o=o.replace(".","")),(r=o.search(/e/i))>0?(n<0&&(n=r),n+=+o.slice(r+1),o=o.substring(0,r)):n<0&&(n=o.length),r=0;"0"===o.charAt(r);r++);if(r===(s=o.length))t=[0],n=1;else{for(s--;"0"===o.charAt(s);)s--;for(n-=r,t=[],i=0;r<=s;r++,i++)t[i]=Number(o.charAt(r))}return n>22&&(t=t.splice(0,21),a=n-1,n=1),{digits:t,exponent:a,integerLen:n}}(e);o&&(c=function(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(c));let u=t.minInt,h=t.minFrac,d=t.maxFrac;if(s){const e=s.match(Zd);if(null===e)throw new Error(`${s} is not a valid digit info`);const t=e[1],n=e[3],r=e[5];null!=t&&(u=Yd(t)),null!=n&&(h=Yd(n)),null!=r?d=Yd(r):null!=n&&h>d&&(d=h)}!function(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let o=s+e.integerLen,a=r[o];if(o>0){r.splice(Math.max(e.integerLen,o));for(let e=o;e<r.length;e++)r[e]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let e=1;e<o;e++)r[e]=0}if(a>=5)if(o-1<0){for(let t=0;t>o;t--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let l=0!==s;const c=t+e.integerLen,u=r.reduceRight(function(e,t,n,r){return r[n]=(t+=e)<10?t:t-10,l&&(0===r[n]&&n>=c?r.pop():l=!1),t>=10?1:0},0);u&&(r.unshift(u),e.integerLen++)}(c,h,d);let p=c.digits,f=c.integerLen;const g=c.exponent;let m=[];for(l=p.every(e=>!e);f<u;f++)p.unshift(0);for(;f<0;f++)p.unshift(0);f>0?m=p.splice(f,p.length):(m=p,p=[0]);const y=[];for(p.length>=t.lgSize&&y.unshift(p.splice(-t.lgSize,p.length).join(""));p.length>t.gSize;)y.unshift(p.splice(-t.gSize,p.length).join(""));p.length&&y.unshift(p.join("")),a=y.join(bd(n,r)),m.length&&(a+=bd(n,i)+m.join("")),g&&(a+=bd(n,_d.Exponential)+"+"+g)}else a=bd(n,_d.Infinity);return a=e<0&&!l?t.negPre+a+t.negSuf:t.posPre+a+t.posSuf,a}(e,function(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],o=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],a=o[0],l=o[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<l.length;u++){const e=l.charAt(u);"0"===e?n.minFrac=n.maxFrac=u+1:"#"===e?n.maxFrac=u+1:n.posSuf+=e}const c=a.split(",");if(n.gSize=c[1]?c[1].length:0,n.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,s){const e=i.length-n.posPre.length-n.posSuf.length,t=s.indexOf("#");n.negPre=s.substr(0,t).replace(/'/g,""),n.negSuf=s.substr(t+e).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function(e,t){return ol(e)[cl.NumberFormats][t]}(t,fd.Decimal),bd(t,_d.MinusSign)),t,_d.Group,_d.Decimal,n)}(function(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),r,n)}catch(i){throw function(e,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${de(e)}'`)}(e,i.message)}}}return e.\u0275fac=function(t){return new(t||e)(ua(oh,16))},e.\u0275pipe=ot({name:"number",type:e,pure:!0}),e})();let ap=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[{provide:Kd,useClass:Qd}]}),e})();let lp=(()=>{class e{}return e.\u0275prov=be({token:e,providedIn:"root",factory:()=>new cp(Or(Kh),window)}),e})();class cp{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=up(this.window.history)||up(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function up(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class hp{}class dp extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new dp,Zh||(Zh=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(fp=fp||document.querySelector("base"),fp?fp.getAttribute("href"):null);return null==t?null:function(e){pp=pp||document.createElement("a"),pp.setAttribute("href",e);const t=pp.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){fp=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Xd(document.cookie,e)}}let pp,fp=null;const gp=new or("TRANSITION_ID"),mp=[{provide:Qu,useFactory:function(e,t,n){return()=>{n.get(Xu).donePromise.then(()=>{const n=Yh(),r=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let e=0;e<r.length;e++)n.remove(r[e])})}},deps:[gp,Kh,zo],multi:!0}];class yp{static init(){var e;e=new yp,Ih=e}addToWindow(e){ze.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),ze.getAllAngularRootElements=()=>e.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(e=>{const t=ze.getAllAngularTestabilities();let n=t.length,r=!1;const i=function(t){r=r||t,n--,0==n&&e(r)};t.forEach(function(e){e.whenStable(i)})})}findTestabilityInTree(e,t,n){return null==t?null:e.getTestability(t)??(n?Yh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}}let vp=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const _p=new or("EventManagerPlugins");let Cp=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(Or(_p),Or(vh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class Ep{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=Yh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let wp=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),bp=(()=>{class e extends wp{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(Sp),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(Sp))}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function Sp(e){Yh().remove(e)}const Pp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Op=/%COMP%/g;function Tp(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?Tp(e,i,n):(i=i.replace(Op,e),n.push(i))}return n}function Ip(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let kp=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new Ap(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Ue.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new Mp(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case Ue.ShadowDom:return new Np(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=Tp(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(Or(Cp),Or(bp),Or(Ju))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class Ap{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(Pp[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=Pp[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=Pp[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,r){r&(Mi.DashCase|Mi.Important)?e.style.setProperty(t,n,r&Mi.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Mi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Ip(n)):this.eventManager.addEventListener(e,t,Ip(n))}}class Mp extends Ap{constructor(e,t,n,r){super(e),this.component=n;const i=Tp(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(Op,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(Op,r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class Np extends Ap{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=Tp(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const e=document.createElement("style");e.textContent=i[s],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Rp=(()=>{class e extends Ep{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const xp=["alt","control","meta","shift"],Dp={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Lp={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Fp={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Up=(()=>{class e extends Ep{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Yh().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let s="";if(xp.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),s+=e+".")}),s+=i,0!=n.length||0===i.length)return null;const o={};return o.domEventName=r,o.fullKey=s,o}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Lp.hasOwnProperty(t)&&(t=Lp[t]))}return Dp[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),xp.forEach(r=>{r!=n&&Fp[r](e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),Bp=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return Or(Vp)},token:e,providedIn:"root"}),e})(),Vp=(()=>{class e extends Bp{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case yi.NONE:return t;case yi.HTML:return Wr(t,"HTML")?Gr(t):gi(this._doc,String(t)).toString();case yi.STYLE:return Wr(t,"Style")?Gr(t):t;case yi.SCRIPT:if(Wr(t,"Script"))return Gr(t);throw new Error("unsafe value used in a script context");case yi.URL:return qr(t),Wr(t,"URL")?Gr(t):Xr(String(t));case yi.RESOURCE_URL:if(Wr(t,"ResourceURL"))return Gr(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(e){return new Br(e)}(e)}bypassSecurityTrustStyle(e){return function(e){return new Vr(e)}(e)}bypassSecurityTrustScript(e){return function(e){return new $r(e)}(e)}bypassSecurityTrustUrl(e){return function(e){return new zr(e)}(e)}bypassSecurityTrustResourceUrl(e){return function(e){return new Hr(e)}(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh))},e.\u0275prov=be({factory:function(){return function(e){return new Vp(e.get(Kh))}(Or(To))},token:e,providedIn:"root"}),e})();const $p=xh(Wh,"browser",[{provide:rh,useValue:"browser"},{provide:nh,useValue:function(){dp.makeCurrent(),yp.init()},multi:!0},{provide:Kh,useFactory:function(){return e=document,Pt=e,document;var e},deps:[]}]),zp=[[],{provide:ko,useValue:"root"},{provide:Oi,useFactory:function(){return new Oi},deps:[]},{provide:_p,useClass:Rp,multi:!0,deps:[Kh,vh,rh]},{provide:_p,useClass:Up,multi:!0,deps:[Kh]},[],{provide:kp,useClass:kp,deps:[Cp,bp,Ju]},{provide:Pc,useExisting:kp},{provide:wp,useExisting:bp},{provide:bp,useClass:bp,deps:[Kh]},{provide:Ph,useClass:Ph,deps:[vh]},{provide:Cp,useClass:Cp,deps:[_p,vh]},{provide:hp,useClass:vp,deps:[]},[]];let Hp=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:Ju,useValue:t.appId},{provide:gp,useExisting:Ju},mp]}}}return e.\u0275fac=function(t){return new(t||e)(Or(e,12))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:zp,imports:[ap,jh]}),e})();"undefined"!=typeof window&&window;const{isArray:Gp}=Array,{getPrototypeOf:Wp,prototype:qp,keys:jp}=Object;function Zp(e){if(1===e.length){const t=e[0];if(Gp(t))return{args:t,keys:null};if(function(e){return e&&"object"==typeof e&&Wp(e)===qp}(t)){const e=jp(t);return{args:e.map(e=>t[e]),keys:e}}}return{args:e,keys:null}}const{isArray:Yp}=Array;function Kp(e){return D(t=>function(e,t){return Yp(t)?e(...t):e(t)}(e,t))}function Qp(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}let Xp=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(bc))},e.\u0275dir=st({type:e}),e})(),Jp=(()=>{class e extends Xp{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();const ef=new or("NgValueAccessor"),tf={provide:ef,useExisting:ge(()=>rf),multi:!0},nf=new or("CompositionEventMode");let rf=(()=>{class e extends Xp{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=Yh()?Yh().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(bc),ua(nf,8))},e.\u0275dir=st({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&Ea("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[gc([tf]),Go]}),e})();function sf(e){return null==e||0===e.length}function of(e){return null!=e&&"number"==typeof e.length}const af=new or("NgValidators"),lf=new or("NgAsyncValidators"),cf=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class uf{static min(e){return t=e,e=>{if(sf(e.value)||sf(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null};var t}static max(e){return t=e,e=>{if(sf(e.value)||sf(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null};var t}static required(e){return hf(e)}static requiredTrue(e){return!0===e.value?null:{required:!0}}static email(e){return sf((t=e).value)||cf.test(t.value)?null:{email:!0};var t}static minLength(e){return t=e,e=>sf(e.value)||!of(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null;var t}static maxLength(e){return df(e)}static pattern(e){return function(e){if(!e)return pf;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),e=>{if(sf(e.value))return null;const r=e.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return _f(e)}static composeAsync(e){return Ef(e)}}function hf(e){return sf(e.value)?{required:!0}:null}function df(e){return t=>of(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function pf(e){return null}function ff(e){return null!=e}function gf(e){const t=_a(e)?ae(e):e;return Ca(t),t}function mf(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function yf(e,t){return t.map(t=>t(e))}function vf(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function _f(e){if(!e)return null;const t=e.filter(ff);return 0==t.length?null:function(e){return mf(yf(e,t))}}function Cf(e){return null!=e?_f(vf(e)):null}function Ef(e){if(!e)return null;const t=e.filter(ff);return 0==t.length?null:function(e){return function(...e){const t=ne(e),{args:n,keys:r}=Zp(e),i=new T(e=>{const{length:t}=n;if(!t)return void e.complete();const i=new Array(t);let s=t,o=t;for(let a=0;a<t;a++){let t=!1;Y(n[a]).subscribe(new x(e,e=>{t||(t=!0,o--),i[a]=e},()=>s--,void 0,()=>{(!s||!t)&&(o||e.next(r?Qp(r,i):i),e.complete())}))}});return t?i.pipe(Kp(t)):i}(yf(e,t).map(gf)).pipe(D(mf))}}function wf(e){return null!=e?Ef(vf(e)):null}function bf(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function Sf(e){return e._rawValidators}function Pf(e){return e._rawAsyncValidators}function Of(e){return e?Array.isArray(e)?e:[e]:[]}function Tf(e,t){return Array.isArray(e)?e.includes(t):e===t}function If(e,t){const n=Of(t);return Of(e).forEach(e=>{Tf(n,e)||n.push(e)}),n}function kf(e,t){return Of(t).filter(t=>!Tf(e,t))}let Af=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Cf(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=wf(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e}),e})(),Mf=(()=>{class e extends Af{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,features:[Go]}),e})();class Nf extends Af{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Rf{constructor(e){this._cd=e}is(e){var t,n,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===r?void 0:r[e])}}let xf=(()=>{class e extends Rf{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Nf,2))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Ba("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[Go]}),e})(),Df=(()=>{class e extends Rf{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,t){2&e&&Ba("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))("ng-submitted",t.is("submitted"))},features:[Go]}),e})();function Lf(e,t){return[...t.path,e]}function Ff(e,t){Vf(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&zf(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&zf(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Uf(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),$f(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Bf(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Vf(e,t){const n=Sf(e);null!==t.validator?e.setValidators(bf(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=Pf(e);null!==t.asyncValidator?e.setAsyncValidators(bf(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();Bf(t._rawValidators,i),Bf(t._rawAsyncValidators,i)}function $f(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=Sf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=Pf(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return Bf(t._rawValidators,r),Bf(t._rawAsyncValidators,r),n}function zf(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Hf(e,t){Vf(e,t)}function Gf(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}function Wf(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function qf(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===rf?n=e:function(e){return Object.getPrototypeOf(e.constructor)===Jp}(e)?r=e:i=e}),i||r||n||null}function jf(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Zf="VALID",Yf="INVALID",Kf="PENDING",Qf="DISABLED";function Xf(e){return(ng(e)?e.validators:e)||null}function Jf(e){return Array.isArray(e)?Cf(e):e||null}function eg(e,t){return(ng(t)?t.asyncValidators:e)||null}function tg(e){return Array.isArray(e)?wf(e):e||null}function ng(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class rg{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Jf(this._rawValidators),this._composedAsyncValidatorFn=tg(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Zf}get invalid(){return this.status===Yf}get pending(){return this.status==Kf}get disabled(){return this.status===Qf}get enabled(){return this.status!==Qf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Jf(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=tg(e)}addValidators(e){this.setValidators(If(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(If(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(kf(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(kf(e,this._rawAsyncValidators))}hasValidator(e){return Tf(this._rawValidators,e)}hasAsyncValidator(e){return Tf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Kf,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Qf,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Zf,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Zf||this.status===Kf)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Qf:Zf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Kf,this._hasOwnPendingAsyncValidator=!0;const t=gf(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length))return null;let r=e;return t.forEach(e=>{r=r instanceof sg?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof og&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new xu,this.statusChanges=new xu}_calculateStatus(){return this._allControlsDisabled()?Qf:this.errors?Yf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Kf)?Kf:this._anyControlsHaveStatus(Yf)?Yf:Zf}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ng(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class ig extends rg{constructor(e=null,t,n){super(Xf(t),eg(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){jf(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){jf(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class sg extends rg{constructor(e,t,n){super(Xf(t),eg(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof ig?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class og extends rg{constructor(e,t,n){super(Xf(t),eg(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof ig?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const ag={provide:Mf,useExisting:ge(()=>cg)},lg=(()=>Promise.resolve(null))();let cg=(()=>{class e extends Mf{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new xu,this.form=new sg({},Cf(e),wf(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){lg.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Ff(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){lg.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),jf(this._directives,e)})}addFormGroup(e){lg.then(()=>{const t=this._findContainer(e.path),n=new sg({});Hf(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){lg.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){lg.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,Wf(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(ua(af,10),ua(lf,10))},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gc([ag]),Go]}),e})();const ug={provide:Nf,useExisting:ge(()=>dg)},hg=(()=>Promise.resolve(null))();let dg=(()=>{class e extends Nf{constructor(e,t,n,r){super(),this.control=new ig,this._registered=!1,this.update=new xu,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=qf(0,r)}ngOnChanges(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),Gf(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?Lf(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ff(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){hg.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1})})}_updateDisabled(e){const t=e.isDisabled.currentValue,n=""===t||t&&"false"!==t;hg.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,9),ua(af,10),ua(lf,10),ua(ef,10))},e.\u0275dir=st({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[gc([ug]),Go,vt]}),e})(),pg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),fg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();const gg={provide:ef,useExisting:ge(()=>mg),multi:!0};let mg=(()=>{class e extends Jp{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=t=>{e(""==t?null:parseFloat(t))}}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("input",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},features:[gc([gg]),Go]}),e})();const yg=new or("NgModelWithFormControlWarning"),vg={provide:Mf,useExisting:ge(()=>_g)};let _g=(()=>{class e extends Mf{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new xu,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&($f(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Ff(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){Uf(e.control||null,e,!1),jf(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,Wf(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(Uf(t||null,e),n instanceof ig&&(Ff(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);Hf(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return $f(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Vf(this.form,this),this._oldForm&&$f(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(ua(af,10),ua(lf,10))},e.\u0275dir=st({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&Ea("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gc([vg]),Go,vt]}),e})();const Cg={provide:Nf,useExisting:ge(()=>Eg)};let Eg=(()=>{class e extends Nf{constructor(e,t,n,r,i){super(),this._ngModelWarningConfig=i,this._added=!1,this.update=new xu,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=qf(0,r)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),Gf(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Lf(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(ua(Mf,13),ua(af,10),ua(lf,10),ua(ef,10),ua(yg,8))},e.\u0275dir=st({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[gc([Cg]),Go,vt]}),e._ngModelWarningSentOnce=!1,e})();const wg={provide:ef,useExisting:ge(()=>Sg),multi:!0};function bg(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let Sg=(()=>{class e extends Jp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);const n=bg(t,e);this.setProperty("value",n)}registerOnChange(e){this.onChange=t=>{this.value=this._getOptionValue(t),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t),e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gc([wg]),Go]}),e})(),Pg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(bg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(bc),ua(Oc),ua(Sg,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const Og={provide:ef,useExisting:ge(()=>Ig),multi:!0};function Tg(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let Ig=(()=>{class e extends Jp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let t;if(this.value=e,Array.isArray(e)){const n=e.map(e=>this._getOptionId(e));t=(e,t)=>{e._setSelected(n.indexOf(t.toString())>-1)}}else t=(e,t)=>{e._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(e){this.onChange=t=>{const n=[];if(void 0!==t.selectedOptions){const e=t.selectedOptions;for(let t=0;t<e.length;t++){const r=e.item(t),i=this._getOptionValue(r.value);n.push(i)}}else{const e=t.options;for(let t=0;t<e.length;t++){const r=e.item(t);if(r.selected){const e=this._getOptionValue(r.value);n.push(e)}}}this.value=n,e(n)}}_registerOption(e){const t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}_getOptionId(e){for(const t of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(t)._value,e))return t;return null}_getOptionValue(e){const t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275dir=st({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&Ea("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[gc([Og]),Go]}),e})(),kg=(()=>{class e{constructor(e,t,n){this._element=e,this._renderer=t,this._select=n,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(Tg(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Tg(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(t){return new(t||e)(ua(bc),ua(Oc),ua(Ig,9))},e.\u0275dir=st({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const Ag={provide:af,useExisting:ge(()=>Mg),multi:!0};let Mg=(()=>{class e{constructor(){this._required=!1}get required(){return this._required}set required(e){this._required=null!=e&&!1!==e&&"false"!=`${e}`,this._onChange&&this._onChange()}validate(e){return this.required?hf(e):null}registerOnValidatorChange(e){this._onChange=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,t){2&e&&ra("required",t.required?"":null)},inputs:{required:"required"},features:[gc([Ag])]}),e})();const Ng={provide:af,useExisting:ge(()=>Rg),multi:!0};let Rg=(()=>{class e{constructor(){this._validator=pf}ngOnChanges(e){"maxlength"in e&&(this._createValidator(),this._onChange&&this._onChange())}validate(e){return this.enabled()?this._validator(e):null}registerOnValidatorChange(e){this._onChange=e}_createValidator(){this._validator=this.enabled()?df(function(e){return"number"==typeof e?e:parseInt(e,10)}(this.maxlength)):pf}enabled(){return null!=this.maxlength}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(e,t){2&e&&ra("maxlength",t.enabled()?t.maxlength:null)},inputs:{maxlength:"maxlength"},features:[gc([Ng]),vt]}),e})(),xg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[[fg]]}),e})(),Dg=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[xg]}),e})(),Lg=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:yg,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({imports:[xg]}),e})(),Fg=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,s=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,s=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,s=null!=t.asyncValidator?t.asyncValidator:null)),new sg(n,{asyncValidators:s,updateOn:r,validators:i})}control(e,t,n){return new ig(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new og(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof ig||e instanceof sg||e instanceof og?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({factory:function(){return new e},token:e,providedIn:Lg}),e})();function Ug(...e){return ae(e,re(e))}function Bg(e,t){return r(t)?X(e,t,1):X(e,1)}function Vg(e,t){return R((n,r)=>{let i=0;n.subscribe(new x(r,n=>e.call(t,n,i++)&&r.next(n)))})}class $g{}class zg{}class Hg{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Hg?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Hg;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Hg?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class Gg{encodeKey(e){return jg(e)}encodeValue(e){return jg(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const Wg=/%(\d[a-f0-9])/gi,qg={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function jg(e){return encodeURIComponent(e).replace(Wg,(e,t)=>{var n;return null!==(n=qg[t])&&void 0!==n?n:e})}function Zg(e){return`${e}`}class Yg{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Gg,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,s]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new Yg({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(Zg(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(Zg(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Kg{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Qg(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Xg(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Jg(e){return"undefined"!=typeof FormData&&e instanceof FormData}class em{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Hg),this.context||(this.context=new Kg),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new Yg,this.urlWithParams=t}serializeBody(){return null===this.body?null:Qg(this.body)||Xg(this.body)||Jg(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Yg?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Jg(this.body)?null:Xg(this.body)?this.body.type||null:Qg(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Yg?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let l=e.headers||this.headers,c=e.params||this.params;const u=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(l=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),l)),e.setParams&&(c=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),c)),new em(n,r,s,{params:c,headers:l,context:u,reportProgress:a,responseType:i,withCredentials:o})}}var tm=(()=>((tm=tm||{})[tm.Sent=0]="Sent",tm[tm.UploadProgress=1]="UploadProgress",tm[tm.ResponseHeader=2]="ResponseHeader",tm[tm.DownloadProgress=3]="DownloadProgress",tm[tm.Response=4]="Response",tm[tm.User=5]="User",tm))();class nm{constructor(e,t=200,n="OK"){this.headers=e.headers||new Hg,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class rm extends nm{constructor(e={}){super(e),this.type=tm.ResponseHeader}clone(e={}){return new rm({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class im extends nm{constructor(e={}){super(e),this.type=tm.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new im({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class sm extends nm{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function om(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let am=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof em)r=e;else{let i,s;i=n.headers instanceof Hg?n.headers:new Hg(n.headers),n.params&&(s=n.params instanceof Yg?n.params:new Yg({fromObject:n.params})),r=new em(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=Ug(r).pipe(Bg(e=>this.handler.handle(e)));if(e instanceof em||"events"===n.observe)return i;const s=i.pipe(Vg(e=>e instanceof im));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return s.pipe(D(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return s.pipe(D(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return s.pipe(D(e=>e.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new Yg).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,om(n,t))}post(e,t,n={}){return this.request("POST",e,om(n,t))}put(e,t,n={}){return this.request("PUT",e,om(n,t))}}return e.\u0275fac=function(t){return new(t||e)(Or($g))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class lm{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const cm=new or("HTTP_INTERCEPTORS");let um=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const hm=/^\)\]\}',?\n/;let dm=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new T(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const s=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",s=new Hg(n.getAllResponseHeaders()),o=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new rm({headers:s,status:t,statusText:r,url:o}),i},o=()=>{let{headers:r,status:i,statusText:o,url:a}=s(),l=null;204!==i&&(l=void 0===n.response?n.responseText:n.response),0===i&&(i=l?200:0);let c=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof l){const e=l;l=l.replace(hm,"");try{l=""!==l?JSON.parse(l):null}catch(u){l=e,c&&(c=!1,l={error:u,text:l})}}c?(t.next(new im({body:l,headers:r,status:i,statusText:o,url:a||void 0})),t.complete()):t.error(new sm({error:l,headers:r,status:i,statusText:o,url:a||void 0}))},a=e=>{const{url:r}=s(),i=new sm({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let l=!1;const c=r=>{l||(t.next(s()),l=!0);let i={type:tm.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&!!n.responseText&&(i.partialText=n.responseText),t.next(i)},u=e=>{let n={type:tm.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",o),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",c),null!==r&&n.upload&&n.upload.addEventListener("progress",u)),n.send(r),t.next({type:tm.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",o),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",c),null!==r&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(Or(hp))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const pm=new or("XSRF_COOKIE_NAME"),fm=new or("XSRF_HEADER_NAME");class gm{}let mm=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Xd(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(rh),Or(pm))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),ym=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null!==r&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(gm),Or(fm))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),vm=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(cm,[]);this.chain=e.reduceRight((e,t)=>new lm(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(Or(zg),Or(zo))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),_m=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:ym,useClass:um}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:pm,useValue:t.cookieName}:[],t.headerName?{provide:fm,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[ym,{provide:cm,useExisting:ym,multi:!0},{provide:gm,useClass:mm},{provide:pm,useValue:"XSRF-TOKEN"},{provide:fm,useValue:"X-XSRF-TOKEN"}]}),e})(),Cm=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[am,{provide:$g,useClass:vm},dm,{provide:zg,useExisting:dm}],imports:[[_m.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class Em extends A{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function wm(e,t,n){e?Q(n,e,t):t()}const bm=i(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Sm(...e){return J(1)(ae(e,re(e)))}function Pm(e){return new T(t=>{Y(e()).subscribe(t)})}function Om(){return R((e,t)=>{let n=null;e._refCount++;const r=new x(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,i=n;n=null,r&&(!i||r===i)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class Tm extends T{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,N(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new a;const t=this.getSubject();e.add(this.source.subscribe(new x(t,void 0,()=>{this._teardown(),t.complete()},e=>{this._teardown(),t.error(e)},()=>this._teardown()))),e.closed&&(this._connection=null,e=a.EMPTY)}return e}refCount(){return Om()(this)}}function Im(e,t){return R((n,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();n.subscribe(new x(r,n=>{null==i||i.unsubscribe();let o=0;const l=s++;Y(e(n,l)).subscribe(i=new x(r,e=>r.next(t?t(n,e,l,o++):e),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function km(e,t,n,r,i){return(s,o)=>{let a=n,l=t,c=0;s.subscribe(new x(o,t=>{const n=c++;l=a?e(l,t,n):(a=!0,t),r&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}function Am(e,t){return R(km(e,t,arguments.length>=2,!0))}function Mm(e){return R((t,n)=>{let r,i=null,s=!1;i=t.subscribe(new x(n,void 0,void 0,o=>{r=Y(e(o,Mm(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(n))})}function Nm(e){return e<=0?()=>ee:R((t,n)=>{let r=[];t.subscribe(new x(n,t=>{r.push(t),e<r.length&&r.shift()},()=>{for(const e of r)n.next(e);n.complete()},void 0,()=>{r=null}))})}function Rm(e=xm){return R((t,n)=>{let r=!1;t.subscribe(new x(n,e=>{r=!0,n.next(e)},()=>r?n.complete():n.error(e())))})}function xm(){return new bm}function Dm(e){return R((t,n)=>{let r=!1;t.subscribe(new x(n,e=>{r=!0,n.next(e)},()=>{r||n.next(e),n.complete()}))})}function Lm(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Vg((t,n)=>e(t,n,r)):O,le(1),n?Dm(t):Rm(()=>new bm))}function Fm(e,t,n){const i=r(e)||t||n?{next:e,error:t,complete:n}:e;return i?R((e,t)=>{var n;null===(n=i.subscribe)||void 0===n||n.call(i);let r=!0;e.subscribe(new x(t,e=>{var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},()=>{var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},e=>{var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},()=>{var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):O}class Um{constructor(e,t){this.id=e,this.url=t}}class Bm extends Um{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Vm extends Um{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class $m extends Um{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class zm extends Um{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Hm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wm extends Um{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class qm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jm extends Um{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Zm{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ym{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Km{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qm{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Xm{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Jm{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ey{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ty="primary";class ny{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function ry(e){return new ny(e)}const iy="ngNavigationCancelingError";function sy(e){const t=Error("NavigationCancelingError: "+e);return t[iy]=!0,t}function oy(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const t=r[s],n=e[s];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function ay(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!ly(e[i],t[i]))return!1;return!0}function ly(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function cy(e){return Array.prototype.concat.apply([],e)}function uy(e){return e.length>0?e[e.length-1]:null}function hy(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function dy(e){return Ca(e)?e:_a(e)?ae(Promise.resolve(e)):Ug(e)}const py={exact:function e(t,n,r){if(!wy(t.segments,n.segments)||!vy(t.segments,n.segments,r)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!e(t.children[i],n.children[i],r))return!1;return!0},subset:my},fy={exact:function(e,t){return ay(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>ly(e[n],t[n]))},ignored:()=>!0};function gy(e,t,n){return py[n.paths](e.root,t.root,n.matrixParams)&&fy[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function my(e,t,n){return yy(e,t,t.segments,n)}function yy(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!wy(i,n)||t.hasChildren()||!vy(i,n,r))}if(e.segments.length===n.length){if(!wy(e.segments,n)||!vy(e.segments,n,r))return!1;for(const n in t.children)if(!e.children[n]||!my(e.children[n],t.children[n],r))return!1;return!0}{const i=n.slice(0,e.segments.length),s=n.slice(e.segments.length);return!!(wy(e.segments,i)&&vy(e.segments,i,r)&&e.children[ty])&&yy(e.children[ty],t,s,r)}}function vy(e,t,n){return t.every((t,r)=>fy[n](e[r].parameters,t.parameters))}class _y{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ry(this.queryParams)),this._queryParamMap}toString(){return Py.serialize(this)}}class Cy{constructor(e,t){this.segments=e,this.children=t,this.parent=null,hy(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Oy(this)}}class Ey{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=ry(this.parameters)),this._parameterMap}toString(){return Ry(this)}}function wy(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class by{}class Sy{parse(e){const t=new Uy(e);return new _y(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`${`/${Ty(e.root,!0)}`}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${ky(t)}=${ky(e)}`).join("&"):`${ky(t)}=${ky(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const Py=new Sy;function Oy(e){return e.segments.map(e=>Ry(e)).join("/")}function Ty(e,t){if(!e.hasChildren())return Oy(e);if(t){const t=e.children[ty]?Ty(e.children[ty],!1):"",n=[];return hy(e.children,(e,t)=>{t!==ty&&n.push(`${t}:${Ty(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return hy(e.children,(e,r)=>{r===ty&&(n=n.concat(t(e,r)))}),hy(e.children,(e,r)=>{r!==ty&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===ty?[Ty(e.children[ty],!1)]:[`${n}:${Ty(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[ty]?`${Oy(e)}/${t[0]}`:`${Oy(e)}/(${t.join("//")})`}}function Iy(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ky(e){return Iy(e).replace(/%3B/gi,";")}function Ay(e){return Iy(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function My(e){return decodeURIComponent(e)}function Ny(e){return My(e.replace(/\+/g,"%20"))}function Ry(e){return`${Ay(e.path)}${function(e){return Object.keys(e).map(t=>`;${Ay(t)}=${Ay(e[t])}`).join("")}(e.parameters)}`}const xy=/^[^\/()?;=#]+/;function Dy(e){const t=e.match(xy);return t?t[0]:""}const Ly=/^[^=?&#]+/,Fy=/^[^?&#]+/;class Uy{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Cy([],{}):new Cy([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[ty]=new Cy(e,t)),n}parseSegment(){const e=Dy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Ey(My(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Dy(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=Dy(this.remaining);e&&(n=e,this.capture(n))}e[My(t)]=My(n)}parseQueryParam(e){const t=function(e){const t=e.match(Ly);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(Fy);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=Ny(t),i=Ny(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=Dy(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=ty);const s=this.parseChildren();t[i]=1===Object.keys(s).length?s[ty]:new Cy([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class By{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Vy(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=Vy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=$y(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return $y(e,this._root).map(e=>e.value)}}function Vy(e,t){if(e===t.value)return t;for(const n of t.children){const t=Vy(e,n);if(t)return t}return null}function $y(e,t){if(e===t.value)return[t];for(const n of t.children){const r=$y(e,n);if(r.length)return r.unshift(t),r}return[]}class zy{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Hy(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class Gy extends By{constructor(e,t){super(e),this.snapshot=t,Ky(this,e)}toString(){return this.snapshot.toString()}}function Wy(e,t){const n=function(e,t){const n=new Zy([],{},{},"",{},ty,t,null,e.root,-1,{});return new Yy("",new zy(n,[]))}(e,t),r=new Em([new Ey("",{})]),i=new Em({}),s=new Em({}),o=new Em({}),a=new Em(""),l=new qy(r,i,o,a,s,ty,t,n.root);return l.snapshot=n.root,new Gy(new zy(l,[]),n)}class qy{constructor(e,t,n,r,i,s,o,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(D(e=>ry(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(D(e=>ry(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function jy(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Zy{constructor(e,t,n,r,i,s,o,a,l,c,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ry(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ry(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Yy extends By{constructor(e,t){super(t),this.url=e,Ky(this,t)}toString(){return Qy(this._root)}}function Ky(e,t){t.value._routerState=e,t.children.forEach(t=>Ky(e,t))}function Qy(e){const t=e.children.length>0?` { ${e.children.map(Qy).join(", ")} } `:"";return`${e.value}${t}`}function Xy(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,ay(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),ay(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ay(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),ay(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Jy(e,t){return ay(e.params,t.params)&&function(e,t){return wy(e,t)&&e.every((e,n)=>ay(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Jy(e.parent,t.parent))}function ev(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return ev(e,t,r);return ev(e,t)})}(e,t,n);return new zy(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return tv(t,e),e}}const n=function(e){return new qy(new Em(e.url),new Em(e.params),new Em(e.queryParams),new Em(e.fragment),new Em(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(t=>ev(e,t));return new zy(n,r)}}function tv(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)tv(e.children[n],t.children[n])}function nv(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function rv(e){return"object"==typeof e&&null!=e&&e.outlets}function iv(e,t,n,r,i){let s={};return r&&hy(r,(e,t)=>{s[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new _y(n.root===e?t:sv(n.root,e,t),s,i)}function sv(e,t,n){const r={};return hy(e.children,(e,i)=>{r[i]=e===t?n:sv(e,t,n)}),new Cy(e.segments,r)}class ov{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&nv(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(rv);if(r&&r!==uy(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class av{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function lv(e,t,n){if(e||(e=new Cy([],{})),0===e.segments.length&&e.hasChildren())return cv(e,t,n);const r=function(e,t,n){let r=0,i=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return s;const t=e.segments[i],o=n[r];if(rv(o))break;const a=`${o}`,l=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&l&&"object"==typeof l&&void 0===l.outlets){if(!pv(a,l,t))return s;r+=2}else{if(!pv(a,{},t))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new Cy(e.segments.slice(0,r.pathIndex),{});return t.children[ty]=new Cy(e.segments.slice(r.pathIndex),e.children),cv(t,0,i)}return r.match&&0===i.length?new Cy(e.segments,{}):r.match&&!e.hasChildren()?uv(e,t,n):r.match?cv(e,0,i):uv(e,t,n)}function cv(e,t,n){if(0===n.length)return new Cy(e.segments,{});{const r=function(e){return rv(e[0])?e[0].outlets:{[ty]:e}}(n),i={};return hy(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=lv(e.children[r],t,n))}),hy(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new Cy(e.segments,i)}}function uv(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const s=n[i];if(rv(s)){const e=hv(s.outlets);return new Cy(r,e)}if(0===i&&nv(n[0])){r.push(new Ey(e.segments[t].path,dv(n[0]))),i++;continue}const o=rv(s)?s.outlets[ty]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&nv(a)?(r.push(new Ey(o,dv(a))),i+=2):(r.push(new Ey(o,{})),i++)}return new Cy(r,{})}function hv(e){const t={};return hy(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=uv(new Cy([],{}),0,e))}),t}function dv(e){const t={};return hy(e,(e,n)=>t[n]=`${e}`),t}function pv(e,t,n){return e==n.path&&ay(t,n.parameters)}class fv{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Xy(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=Hy(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),hy(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=Hy(e);for(const s of Object.keys(i))this.deactivateRouteAndItsChildren(i[s],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=Hy(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new Jm(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Qm(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Xy(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),gv(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function gv(e){Xy(e.value),e.children.forEach(gv)}class mv{constructor(e,t){this.routes=e,this.module=t}}function yv(e){return"function"==typeof e}function vv(e){return e instanceof _y}const _v=Symbol("INITIAL_VALUE");function Cv(){return Im(e=>function(...e){const t=re(e),n=ne(e),{args:r,keys:i}=Zp(e);if(0===r.length)return ae([],t);const s=new T(function(e,t,n=O){return r=>{wm(t,()=>{const{length:i}=e,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)wm(t,()=>{const i=ae(e[l],t);let c=!1;i.subscribe(new x(r,e=>{s[l]=e,c||(c=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,t,i?e=>Qp(i,e):O));return n?s.pipe(Kp(n)):s}(e.map(e=>e.pipe(le(1),function(...e){const t=re(e);return R((n,r)=>{(t?Sm(e,n,t):Sm(e,n)).subscribe(r)})}(_v)))).pipe(Am((e,t)=>{let n=!1;return t.reduce((e,r,i)=>e!==_v?e:(r===_v&&(n=!0),n||!1!==r&&i!==t.length-1&&!vv(r)?e:r),e)},_v),Vg(e=>e!==_v),D(e=>vv(e)?e:!0===e),le(1)))}let Ev=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&ga(0,"router-outlet")},directives:function(){return[__]},encapsulation:2}),e})();function wv(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];bv(r,Sv(t,r))}}function bv(e,t){e.children&&wv(e.children,t)}function Sv(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function Pv(e){const t=e.children&&e.children.map(Pv),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==ty&&(n.component=Ev),n}function Ov(e){return e.outlet||ty}function Tv(e,t){const n=e.filter(e=>Ov(e)===t);return n.push(...e.filter(e=>Ov(e)!==t)),n}const Iv={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function kv(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},Iv):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||oy)(n,e,t);if(!i)return Object.assign({},Iv);const s={};hy(i.posParams,(e,t)=>{s[t]=e.path});const o=i.consumed.length>0?Object.assign(Object.assign({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:o,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function Av(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>Mv(e,t,n)&&Ov(n)!==ty)}(e,n,r)){const i=new Cy(t,function(e,t,n,r){const i={};i[ty]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const s of n)if(""===s.path&&Ov(s)!==ty){const n=new Cy([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[Ov(s)]=n}return i}(e,t,r,new Cy(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>Mv(e,t,n))}(e,n,r)){const s=new Cy(e.segments,function(e,t,n,r,i,s){const o={};for(const a of r)if(Mv(e,n,a)&&!i[Ov(a)]){const n=new Cy([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===s?e.segments.length:t.length,o[Ov(a)]=n}return Object.assign(Object.assign({},i),o)}(e,t,n,r,e.children,i));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}const s=new Cy(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Mv(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function Nv(e,t,n,r){return!!(Ov(e)===r||r!==ty&&Mv(t,n,e))&&("**"===e.path||kv(t,e,n).matched)}function Rv(e,t,n){return 0===t.length&&!e.children[n]}class xv{constructor(e){this.segmentGroup=e||null}}class Dv{constructor(e){this.urlTree=e}}function Lv(e){return new T(t=>t.error(new xv(e)))}function Fv(e){return new T(t=>t.error(new Dv(e)))}function Uv(e){return new T(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class Bv{constructor(e,t,n,r,i){this.configLoader=t,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=e.get(iu)}apply(){const e=Av(this.urlTree.root,[],[],this.config).segmentGroup,t=new Cy(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,ty).pipe(D(e=>this.createUrlTree(Vv(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Mm(e=>{if(e instanceof Dv)return this.allowRedirects=!1,this.match(e.urlTree);throw e instanceof xv?this.noMatchError(e):e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,ty).pipe(D(t=>this.createUrlTree(Vv(t),e.queryParams,e.fragment))).pipe(Mm(e=>{throw e instanceof xv?this.noMatchError(e):e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new Cy([],{[ty]:e}):e;return new _y(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(D(e=>new Cy([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return ae(r).pipe(Bg(r=>{const i=n.children[r],s=Tv(t,r);return this.expandSegmentGroup(e,s,i,r).pipe(D(e=>({segment:e,outlet:r})))}),Am((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Vg((t,n)=>e(t,n,r)):O,Nm(1),n?Dm(t):Rm(()=>new bm))}())}expandSegment(e,t,n,r,i,s){return ae(n).pipe(Bg(o=>this.expandSegmentAgainstRoute(e,t,n,o,r,i,s).pipe(Mm(e=>{if(e instanceof xv)return Ug(null);throw e}))),Lm(e=>!!e),Mm((e,n)=>{if(e instanceof bm||"EmptyError"===e.name){if(Rv(t,r,i))return Ug(new Cy([],{}));throw new xv(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,s,o){return Nv(r,t,i,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,s):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s):Lv(t):Lv(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Fv(i):this.lineralizeSegments(n,i).pipe(X(n=>{const i=new Cy(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:l,positionalParamSegments:c}=kv(t,r,i);if(!o)return Lv(t);const u=this.applyRedirectCommands(a,r.redirectTo,c);return r.redirectTo.startsWith("/")?Fv(u):this.lineralizeSegments(r,u).pipe(X(r=>this.expandSegment(e,t,n,r.concat(i.slice(l)),s,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?Ug(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe(D(e=>(n._loadedConfig=e,new Cy(r,{})))):Ug(new Cy(r,{}));const{matched:s,consumedSegments:o,lastChild:a}=kv(t,n,r);if(!s)return Lv(t);const l=r.slice(a);return this.getChildConfig(e,n,r).pipe(X(e=>{const r=e.module,s=e.routes,{segmentGroup:a,slicedSegments:c}=Av(t,o,l,s),u=new Cy(a.segments,a.children);if(0===c.length&&u.hasChildren())return this.expandChildren(r,s,u).pipe(D(e=>new Cy(o,e)));if(0===s.length&&0===c.length)return Ug(new Cy(o,{}));const h=Ov(n)===i;return this.expandSegment(r,u,s,c,h?ty:i,!0).pipe(D(e=>new Cy(o.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?Ug(new mv(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Ug(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe(X(n=>{return n?this.configLoader.load(e.injector,t).pipe(D(e=>(t._loadedConfig=e,e))):(r=t,new T(e=>e.error(sy(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))));var r})):Ug(new mv([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;return r&&0!==r.length?Ug(r.map(r=>{const i=e.get(r);let s;if((o=i)&&yv(o.canLoad))s=i.canLoad(t,n);else{if(!yv(i))throw new Error("Invalid CanLoad guard");s=i(t,n)}var o;return dy(s)})).pipe(Cv(),Fm(e=>{if(!vv(e))return;const t=sy(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),D(e=>!0===e)):Ug(!0)}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Ug(n);if(r.numberOfChildren>1||!r.children[ty])return Uv(e.redirectTo);r=r.children[ty]}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new _y(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return hy(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let s={};return hy(t.children,(t,i)=>{s[i]=this.createSegmentGroup(e,t,n,r)}),new Cy(i,s)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function Vv(e){const t={};for(const n of Object.keys(e.children)){const r=Vv(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children[ty]){const t=e.children[ty];return new Cy(e.segments.concat(t.segments),t.children)}return e}(new Cy(e.segments,t))}class $v{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class zv{constructor(e,t){this.component=e,this.route=t}}function Hv(e,t,n){const r=e._root;return Wv(r,t?t._root:null,n,[r.value])}function Gv(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Wv(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Hy(t);return e.children.forEach(e=>{(function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!wy(e.url,t.url);case"pathParamsOrQueryParamsChange":return!wy(e.url,t.url)||!ay(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Jy(e,t)||!ay(e.queryParams,t.queryParams);case"paramsChange":default:return!Jy(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new $v(r)):(s.data=o.data,s._resolvedData=o._resolvedData),Wv(e,t,s.component?a?a.children:null:n,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new zv(a.outlet.component,o))}else o&&qv(t,a,i),i.canActivateChecks.push(new $v(r)),Wv(e,null,s.component?a?a.children:null:n,r,i)})(e,s[e.value.outlet],n,r.concat([e.value]),i),delete s[e.value.outlet]}),hy(s,(e,t)=>qv(e,n.getContext(t),i)),i}function qv(e,t,n){const r=Hy(e),i=e.value;hy(r,(e,r)=>{qv(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new zv(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class jv{}function Zv(e){return new T(t=>t.error(e))}class Yv{constructor(e,t,n,r,i,s){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){const e=Av(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,ty);if(null===t)return null;const n=new Zy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},ty,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new zy(n,t),i=new Yy(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=jy(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],s=Tv(e,i),o=this.processSegmentGroup(s,r,i);if(null===o)return null;n.push(...o)}const r=Qv(n);return r.sort((e,t)=>e.value.outlet===ty?-1:t.value.outlet===ty?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return Rv(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!Nv(e,t,n,r))return null;let i,s=[],o=[];if("**"===e.path){const r=n.length>0?uy(n).parameters:{};i=new Zy(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,e_(e),Ov(e),e.component,e,Xv(t),Jv(t)+n.length,t_(e))}else{const r=kv(t,e,n);if(!r.matched)return null;s=r.consumedSegments,o=n.slice(r.lastChild),i=new Zy(s,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,e_(e),Ov(e),e.component,e,Xv(t),Jv(t)+s.length,t_(e))}const a=(u=e).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:l,slicedSegments:c}=Av(t,s,o,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);var u;if(0===c.length&&l.hasChildren()){const e=this.processChildren(a,l);return null===e?null:[new zy(i,e)]}if(0===a.length&&0===c.length)return[new zy(i,[])];const h=Ov(e)===r,d=this.processSegment(a,l,c,h?ty:r);return null===d?null:[new zy(i,d)]}}function Kv(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function Qv(e){const t=[],n=new Set;for(const r of e){if(!Kv(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=Qv(r.children);t.push(new zy(r.value,e))}return t.filter(e=>!n.has(e))}function Xv(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Jv(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function e_(e){return e.data||{}}function t_(e){return e.resolve||{}}function n_(e){return Im(t=>{const n=e(t);return n?ae(n).pipe(D(()=>t)):Ug(t)})}class r_ extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const i_=new or("ROUTES");class s_{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe(D(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const r=n.create(e);return new mv(cy(r.injector.get(i_,void 0,Ne.Self|Ne.Optional)).map(Pv),r)}),Mm(e=>{throw t._loader$=void 0,e}));return t._loader$=new Tm(n,()=>new A).pipe(Om()),t._loader$}loadModuleFactory(e){return"string"==typeof e?ae(this.loader.load(e)):dy(e()).pipe(X(e=>e instanceof su?Ug(e):ae(this.compiler.compileModuleAsync(e))))}}class o_{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new a_,this.attachRef=null}}class a_{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new o_,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class l_{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function c_(e){throw e}function u_(e,t,n){return t.parse("/")}function h_(e,t){return Ug(null)}const d_={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},p_={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let f_=(()=>{class e{constructor(e,t,n,r,i,s,o,a){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=c_,this.malformedUriErrorHandler=u_,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:h_,afterPreactivation:h_},this.urlHandlingStrategy=new l_,this.routeReuseStrategy=new r_,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=i.get(iu),this.console=i.get(sh);const l=i.get(vh);this.isNgZoneEnabled=l instanceof vh&&vh.isInAngularZone(),this.resetConfig(a),this.currentUrlTree=new _y(new Cy([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new s_(s,o,e=>this.triggerEvent(new Zm(e)),e=>this.triggerEvent(new Ym(e))),this.routerState=Wy(this.currentUrlTree,this.rootComponentType),this.transitions=new Em({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const t=this.events;return e.pipe(Vg(e=>0!==e.id),D(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Im(e=>{let n=!1,r=!1;return Ug(e).pipe(Fm(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Im(e=>{const n=this.browserUrlTree.toString(),i=!this.navigated||e.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||i)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return g_(e.source)&&(this.browserUrlTree=e.extractedUrl),Ug(e).pipe(Im(e=>{const n=this.transitions.getValue();return t.next(new Bm(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?ee:Promise.resolve(e)}),function(e,t,n,r){return Im(i=>function(e,t,n,r,i){return new Bv(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(D(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Fm(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,i,s){return X(o=>function(e,t,n,i,s="emptyOnly",o="legacy"){try{const r=new Yv(e,t,n,i,s,o).recognize();return null===r?Zv(new jv):Ug(r)}catch(r){return Zv(r)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),i,s).pipe(D(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),Fm(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new Hm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(i&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=e,a=new Bm(n,this.serializeUrl(r),i,s);t.next(a);const l=Wy(r,this.rootComponentType).snapshot;return Ug(Object.assign(Object.assign({},e),{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign(Object.assign({},o),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ee}),n_(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),Fm(e=>{const t=new Gm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),D(e=>Object.assign(Object.assign({},e),{guards:Hv(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return X(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?Ug(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return ae(e).pipe(X(e=>function(e,t,n,r,i){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Ug(s.map(s=>{const o=Gv(s,t,i);let a;if(function(e){return e&&yv(e.canDeactivate)}(o))a=dy(o.canDeactivate(e,t,n,r));else{if(!yv(o))throw new Error("Invalid CanDeactivate guard");a=dy(o(e,t,n,r))}return a.pipe(Lm())})).pipe(Cv()):Ug(!0)}(e.component,e.route,n,t,r)),Lm(e=>!0!==e,!0))}(o,r,i,e).pipe(X(n=>n&&function(e){return"boolean"==typeof e}(n)?function(e,t,n,r){return ae(t).pipe(Bg(t=>Sm(function(e,t){return null!==e&&t&&t(new Km(e)),Ug(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new Xm(e)),Ug(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>Pm(()=>Ug(t.guards.map(i=>{const s=Gv(i,t.node,n);let o;if(function(e){return e&&yv(e.canActivateChild)}(s))o=dy(s.canActivateChild(r,e));else{if(!yv(s))throw new Error("Invalid CanActivateChild guard");o=dy(s(r,e))}return o.pipe(Lm())})).pipe(Cv())));return Ug(i).pipe(Cv())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Ug(r.map(r=>Pm(()=>{const i=Gv(r,t,n);let s;if(function(e){return e&&yv(e.canActivate)}(i))s=dy(i.canActivate(t,e));else{if(!yv(i))throw new Error("Invalid CanActivate guard");s=dy(i(t,e))}return s.pipe(Lm())}))).pipe(Cv()):Ug(!0)}(e,t.route,n))),Lm(e=>!0!==e,!0))}(r,s,e,t):Ug(n)),D(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),Fm(e=>{if(vv(e.guardsResult)){const t=sy(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new Wm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Vg(e=>!!e.guardsResult||(this.restoreHistory(e),this.cancelNavigationTransition(e,""),!1)),n_(e=>{if(e.guards.canActivateChecks.length)return Ug(e).pipe(Fm(e=>{const t=new qm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Im(e=>{let t=!1;return Ug(e).pipe(function(e,t){return X(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return Ug(n);let s=0;return ae(i).pipe(Bg(n=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return Ug({});const s={};return ae(i).pipe(X(i=>function(e,t,n,r){const i=Gv(e,t,r);return dy(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe(Fm(e=>{s[i]=e}))),Nm(1),X(()=>Object.keys(s).length===i.length?Ug(s):ee))}(e._resolve,e,t,r).pipe(D(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),jy(e,n).resolve),null)))}(n.route,r,e,t)),Fm(()=>s++),Nm(1),X(e=>s===i.length?Ug(n):ee))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Fm({next:()=>t=!0,complete:()=>{t||(this.restoreHistory(e),this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value."))}}))}),Fm(e=>{const t=new jm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),n_(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),D(e=>{const t=function(e,t,n){const r=ev(e,t._root,n?n._root:void 0);return new Gy(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),Fm(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(e.urlAfterRedirects,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),((e,t,n)=>D(r=>(new fv(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,e=>this.triggerEvent(e)),Fm({next(){n=!0},complete(){n=!0}}),function(e){return R((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var t;if(!n&&!r){const t=`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(e),this.cancelNavigationTransition(e,t)):this.cancelNavigationTransition(e,t)}(null===(t=this.currentNavigation)||void 0===t?void 0:t.id)===e.id&&(this.currentNavigation=null)}),Mm(n=>{if(r=!0,function(e){return e&&e[iy]}(n)){const r=vv(n.url);r||(this.navigated=!0,this.restoreHistory(e,!0));const i=new $m(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),r={skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||g_(e.source)};this.scheduleNavigation(t,"imperative",null,r,{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.restoreHistory(e,!0);const r=new zm(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(i){e.reject(i)}}return ee}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return t.transitionId!==e.transitionId||!n||!("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){wv(e),this.config=e.map(Pv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:s,preserveFragment:o}=t,a=n||this.routerState.root,l=o?this.currentUrlTree.fragment:i;let c=null;switch(s){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}return null!==c&&(c=this.removeEmptyProps(c)),function(e,t,n,r,i){if(0===n.length)return iv(t.root,t.root,t,r,i);const s=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new ov(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return hy(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new ov(n,t,r)}(n);if(s.toRoot())return iv(t.root,new Cy([],{}),t,r,i);const o=function(e,t,n){if(e.isAbsolute)return new av(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new av(e,e===t.root,0)}const r=nv(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new av(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(s,t,e),a=o.processChildren?cv(o.segmentGroup,o.index,s.commands):lv(o.segmentGroup,o.index,s.commands);return iv(o.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,c,l??null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=vv(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},d_):!1===t?Object.assign({},p_):t,vv(e))return gy(this.currentUrlTree,e,n);const r=this.parseUrl(e);return gy(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Vm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,t,n,r,i){var s,o;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),l=g_(t)&&a&&!g_(a.source),c=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===e.toString();if(l&&c)return Promise.resolve(!0);let u,h,d;i?(u=i.resolve,h=i.reject,d=i.promise):d=new Promise((e,t)=>{u=e,h=t});const p=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),f=n&&n.\u0275routerPageId?n.\u0275routerPageId:r.replaceUrl||r.skipLocationChange?null!==(s=this.browserPageId)&&void 0!==s?s:0:(null!==(o=this.browserPageId)&&void 0!==o?o:0)+1):f=0,this.setTransition({id:p,targetPageId:f,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}restoreHistory(e,t=!1){var n,r;if("computed"===this.canceledNavigationResolution){const t=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===t?this.currentUrlTree===(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)&&0===t&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(t)}else"replace"===this.canceledNavigationResolution&&(t&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){const n=new $m(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(Or(lr),Or(by),Or(a_),Or(hd),Or(zo),Or(Vh),Or(gh),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function g_(e){return"imperative"!==e}let m_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.route=t,this.commands=[],this.onChanges=new A,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}onClick(){const e={skipLocationChange:v_(this.skipLocationChange),replaceUrl:v_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:v_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(qy),rr("tabindex"),ua(Oc),ua(bc))},e.\u0275dir=st({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,t){1&e&&Ea("click",function(){return t.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})(),y_=(()=>{class e{constructor(e,t,n){this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.onChanges=new A,this.subscription=e.events.subscribe(e=>{e instanceof Vm&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,t,n,r,i){if(0!==e||t||n||r||i||"string"==typeof this.target&&"_self"!=this.target)return!0;const s={skipLocationChange:v_(this.skipLocationChange),replaceUrl:v_(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,s),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:v_(this.preserveFragment)})}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(qy),ua(od))},e.\u0275dir=st({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,t){1&e&&Ea("click",function(e){return t.onClick(e.button,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey)}),2&e&&(nl("href",t.href,_i),ra("target",t.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[vt]}),e})();function v_(e){return""===e||!!e}let __=(()=>{class e{constructor(e,t,n,r,i){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new xu,this.deactivateEvents=new xu,this.name=r||ty,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new C_(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(ua(a_),ua(au),ua(_c),rr("name"),ua(Yc))},e.\u0275dir=st({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class C_{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===qy?this.route:e===a_?this.childContexts:this.parent.get(e,t)}}class E_{}class w_{preload(e,t){return Ug(null)}}let b_=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new s_(t,n,t=>e.triggerEvent(new Zm(t)),t=>e.triggerEvent(new Ym(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Vg(e=>e instanceof Vm),Bg(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(iu);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return ae(n).pipe(J(),D(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?Ug(t._loadedConfig):this.loader.load(e.injector,t)).pipe(X(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(Or(f_),Or(Vh),Or(gh),Or(zo),Or(E_))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),S_=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Bm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Vm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof ey&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new ey(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(f_),Or(lp),Or(void 0))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const P_=new or("ROUTER_CONFIGURATION"),O_=new or("ROUTER_FORROOT_GUARD"),T_=[hd,{provide:by,useClass:Sy},{provide:f_,useFactory:function(e,t,n,r,i,s,o,a={},l,c){const u=new f_(null,e,t,n,r,i,s,cy(o));return l&&(u.urlHandlingStrategy=l),c&&(u.routeReuseStrategy=c),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[by,a_,hd,zo,Vh,gh,i_,P_,[class{},new Nr],[class{},new Nr]]},a_,{provide:qy,useFactory:function(e){return e.routerState.root},deps:[f_]},{provide:Vh,useClass:Hh},b_,w_,class{preload(e,t){return t().pipe(Mm(()=>Ug(null)))}},{provide:P_,useValue:{enableTracing:!1}}];function I_(){return new Rh("Router",f_)}let k_=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[T_,R_(t),{provide:O_,useFactory:N_,deps:[[f_,new Nr,new Rr]]},{provide:P_,useValue:n||{}},{provide:od,useFactory:M_,deps:[Qh,[new Mr(ld),new Nr],P_]},{provide:S_,useFactory:A_,deps:[f_,lp,P_]},{provide:E_,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:w_},{provide:Rh,multi:!0,useFactory:I_},[x_,{provide:Qu,multi:!0,useFactory:D_,deps:[x_]},{provide:F_,useFactory:L_,deps:[x_]},{provide:ih,multi:!0,useExisting:F_}]]}}static forChild(t){return{ngModule:e,providers:[R_(t)]}}}return e.\u0275fac=function(t){return new(t||e)(Or(O_,8),Or(f_,8))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function A_(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new S_(e,t,n)}function M_(e,t,n={}){return n.useHash?new ud(e,t):new cd(e,t)}function N_(e){return"guarded"}function R_(e){return[{provide:ar,multi:!0,useValue:e},{provide:i_,multi:!0,useValue:e}]}let x_=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(Jh,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let e=null;const t=new Promise(t=>e=t),n=this.injector.get(f_),r=this.injector.get(P_);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?Ug(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(P_),n=this.injector.get(b_),r=this.injector.get(S_),i=this.injector.get(f_),s=this.injector.get(Uh);e===s.components[0]&&(("enabledNonBlocking"===t.initialNavigation||void 0===t.initialNavigation)&&i.initialNavigation(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(t){return new(t||e)(Or(zo))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();function D_(e){return e.appInitializer.bind(e)}function L_(e){return e.bootstrapListener.bind(e)}const F_=new or("Router Initializer");class U_{}const B_="*";function V_(e,t=null){return{type:2,steps:e,options:t}}function $_(e){return{type:6,styles:e,offset:null}}function z_(e){Promise.resolve(null).then(e)}class H_{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){z_(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class G_{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?z_(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function W_(){return"undefined"!=typeof window&&void 0!==window.document}function q_(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function j_(e){switch(e.length){case 0:return new H_;case 1:return e[0];default:return new G_(e)}}function Z_(e,t,n,r,i={},s={}){const o=[],a=[];let l=-1,c=null;if(r.forEach(e=>{const n=e.offset,r=n==l,u=r&&c||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),a){case"!":a=i[n];break;case B_:a=s[n];break;default:a=t.normalizeStyleValue(n,r,a,o)}u[r]=a}),r||a.push(u),c=u,l=n}),o.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${o.join(e)}`)}return a}function Y_(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&K_(n,"start",e)));break;case"done":e.onDone(()=>r(n&&K_(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&K_(n,"destroy",e)))}}function K_(e,t,n){const r=Q_(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),i=e._data;return null!=i&&(r._data=i),r}function Q_(e,t,n,r,i="",s=0,o){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function X_(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function J_(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let eC=(e,t)=>!1,tC=(e,t)=>!1,nC=(e,t,n)=>[];const rC=q_();(rC||"undefined"!=typeof Element)&&(eC=W_()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),tC=(()=>{if(rC||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):tC}})(),nC=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let iC=null,sC=!1;function oC(e){iC||(iC=("undefined"!=typeof document?document.body:null)||{},sC=!!iC.style&&"WebkitAppearance"in iC.style);let t=!0;return iC.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in iC.style,!t&&sC&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in iC.style)),t}const aC=tC,lC=eC,cC=nC;function uC(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let hC=(()=>{class e{validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,s=[],o){return new H_(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})(),dC=(()=>{class e{}return e.NOOP=new hC,e})();const pC="ng-enter",fC="ng-leave",gC="ng-trigger",mC=".ng-trigger",yC="ng-animating",vC=".ng-animating";function _C(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:CC(parseFloat(t[1]),t[2])}function CC(e,t){switch(t){case"s":return 1e3*e;default:return e}}function EC(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,s="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=CC(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=CC(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=e;if(!n){let n=!1,s=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(s,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:s}}(e,t,n)}function wC(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function bC(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else wC(e,n);return n}function SC(e,t,n){return n?t+":"+n+";":""}function PC(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=SC(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=SC(0,DC(n),e.style[n]));e.setAttribute("style",t)}function OC(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=xC(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),q_()&&PC(e))}function TC(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=xC(t);e.style[n]=""}),q_()&&PC(e))}function IC(e){return Array.isArray(e)?1==e.length?e[0]:V_(e):e}const kC=new RegExp("{{\\s*(.+?)\\s*}}","g");function AC(e){let t=[];if("string"==typeof e){let n;for(;n=kC.exec(e);)t.push(n[1]);kC.lastIndex=0}return t}function MC(e,t,n){const r=e.toString(),i=r.replace(kC,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function NC(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const RC=/-+([a-z0-9])/g;function xC(e){return e.replace(RC,(...e)=>e[1].toUpperCase())}function DC(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function LC(e,t){return 0===e||0===t}function FC(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let s=t[0],o=[];if(r.forEach(e=>{s.hasOwnProperty(e)||o.push(e),s[e]=n[e]}),o.length)for(var i=1;i<t.length;i++){let n=t[i];o.forEach(function(t){n[t]=BC(e,t)})}}return t}function UC(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function BC(e,t){return window.getComputedStyle(e)[t]}function VC(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],s=r[2],o=r[3];t.push(HC(i,o));"<"==s[0]&&!("*"==i&&"*"==o)&&t.push(HC(o,i))}(e,n,t)):n.push(e),n}const $C=new Set(["true","1"]),zC=new Set(["false","0"]);function HC(e,t){const n=$C.has(e)||zC.has(e),r=$C.has(t)||zC.has(t);return(i,s)=>{let o="*"==e||e==i,a="*"==t||t==s;return!o&&n&&"boolean"==typeof i&&(o=i?$C.has(e):zC.has(e)),!a&&r&&"boolean"==typeof s&&(a=s?$C.has(t):zC.has(t)),o&&a}}const GC=new RegExp("s*:selfs*,?","g");function WC(e,t,n){return new qC(e).build(t,n)}class qC{constructor(e){this._driver=e}build(e,t){const n=new jC(t);return this._resetContextStyleTimingState(n),UC(this,IC(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],s=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,s.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(e=>{if(ZC(e)){const t=e;Object.keys(t).forEach(e=>{AC(t[e]).forEach(e=>{s.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=NC(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=UC(this,IC(e.animation),t);return{type:1,matchers:VC(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:YC(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>UC(this,e,t)),options:YC(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=UC(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:YC(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return KC(EC(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=KC(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||EC(r,t),KC(n.duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=n;let r,i=e.styles?e.styles:$_({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,s=!1;if(!i){s=!0;const e={};n.easing&&(e.easing=n.easing),i=$_(e)}t.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,t);o.isEmptyStep=s,r=o}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==B_?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(ZC(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=t.collectedStyles[t.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=AC(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const l=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let l=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(ZC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(ZC(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),c=0;return null!=l&&(r++,c=n.offset=l),o=o||c<0||c>1,s=s||c<a,a=c,i.push(c),n});o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&t.errors.push("Please ensure that all keyframe offsets are in order");const c=e.steps.length;let u=0;r>0&&r<c?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(u=1/(c-1));const h=c-1,d=t.currentTime,p=t.currentAnimateTimings,f=p.duration;return l.forEach((e,r)=>{const s=u>0?r==h?1:u*r:i[r],o=s*f;t.currentTime=d+p.delay+o,p.duration=o,this._validateStyleAst(e,t),e.offset=s,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:UC(this,IC(e.animation),t),options:YC(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:YC(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:YC(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,s]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(GC,"")),[e=e.replace(/@\*/g,mC).replace(/@\w+/g,e=>mC+"-"+e.substr(1)).replace(/:animating/g,vC),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,X_(t.collectedStyles,t.currentQuerySelector,{});const o=UC(this,IC(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:e.selector,options:YC(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:EC(e.timings,t.errors,!0);return{type:12,animation:UC(this,IC(e.animation),t),timings:n,options:null}}}class jC{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function ZC(e){return!Array.isArray(e)&&"object"==typeof e}function YC(e){return e?(e=wC(e)).params&&(e.params=function(e){return e?wC(e):null}(e.params)):e={},e}function KC(e,t,n){return{duration:e,delay:t,easing:n}}function QC(e,t,n,r,i,s,o=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class XC{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const JC=new RegExp(":enter","g"),eE=new RegExp(":leave","g");function tE(e,t,n,r,i,s={},o={},a,l,c=[]){return(new nE).buildKeyframes(e,t,n,r,i,s,o,a,l,c)}class nE{buildKeyframes(e,t,n,r,i,s,o,a,l,c=[]){l=l||new XC;const u=new iE(e,t,l,r,i,c,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),UC(this,n,u);const h=u.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(o).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([o],null,u.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[QC(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&t.transformIntoNewTimeline(s)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?_C(n.duration):null,s=null!=n.delay?_C(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),UC(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=rE);const e=_C(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>UC(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?_C(e.options.delay):0;e.steps.forEach(s=>{const o=t.createSubContext(e.options);i&&o.delayNextStep(i),UC(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return EC(t.params?MC(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,s=t.createSubContext().currentTimeline;s.easing=n.easing,e.styles.forEach(e=>{s.forwardTime((e.offset||0)*i),s.setStyles(e.styles,e.easing,t.errors,t.options),s.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(s),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?_C(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=rE);let s=n;const o=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{t.currentQueryIndex=r;const o=t.createSubContext(e.options,n);i&&o.delayNextStep(i),n===t.element&&(a=o.currentTimeline),UC(this,e.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(s),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,s=Math.abs(i.duration),o=s*(t.currentQueryTotal-1);let a=s*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const l=t.currentTimeline;a&&l.delayNextStep(a);const c=l.currentTime;UC(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}const rE={};class iE{constructor(e,t,n,r,i,s,o,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=rE,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new sE(this._driver,t,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=_C(n.duration)),null!=n.delay&&(r.delay=_C(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{(!t||!e.hasOwnProperty(n))&&(e[n]=MC(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new iE(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=rE,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},i=new oE(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,s){let o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(JC,"."+this._enterClassName)).replace(eE,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),o.push(...t)}return!i&&0==o.length&&s.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),o}}class sE{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new sE(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||B_,this._currentKeyframe[e]=B_}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},s=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=B_})):bC(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(s).forEach(e=>{const t=MC(s[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:B_),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=bC(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?e.add(n):r==B_&&t.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=e.size?NC(e.values()):[],s=t.size?NC(t.values()):[];if(n){const e=r[0],t=wC(e);e.offset=0,t.offset=1,r=[e,t]}return QC(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class oE extends sE{constructor(e,t,n,r,i,s,o=!1){super(e,t,s.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],s=n+t,o=t/s,a=bC(e[0],!1);a.offset=0,i.push(a);const l=bC(e[0],!1);l.offset=aE(o),i.push(l);const c=e.length-1;for(let r=1;r<=c;r++){let o=bC(e[r],!1);o.offset=aE((t+o.offset*n)/s),i.push(o)}n=s,t=0,r="",e=i}return QC(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function aE(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class lE{}class cE extends lE{normalizePropertyName(e,t){return xC(e)}normalizeStyleValue(e,t,n,r){let i="";const s=n.toString().trim();if(uE[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return s+i}}const uE=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function hE(e,t,n,r,i,s,o,a,l,c,u,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}const dE={};class pE{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],s=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):s}build(e,t,n,r,i,s,o,a,l,c){const u=[],h=this.ast.options&&this.ast.options.params||dE,d=this.buildStyles(n,o&&o.params||dE,u),p=a&&a.params||dE,f=this.buildStyles(r,p,u),g=new Set,m=new Map,y=new Map,v="void"===r,_={params:Object.assign(Object.assign({},h),p)},C=c?[]:tE(e,t,this.ast.animation,i,s,d,f,_,l,u);let E=0;if(C.forEach(e=>{E=Math.max(e.duration+e.delay,E)}),u.length)return hE(t,this._triggerName,n,r,v,d,f,[],[],m,y,E,u);C.forEach(e=>{const n=e.element,r=X_(m,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=X_(y,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&g.add(n)});const w=NC(g.values());return hE(t,this._triggerName,n,r,v,d,f,C,w,m,y,E)}}class fE{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){const n={},r=wC(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let s=i[e];s.length>1&&(s=MC(s,r,t));const o=this.normalizer.normalizePropertyName(e,t);s=this.normalizer.normalizeStyleValue(e,o,s,t),n[o]=s})}}),n}}class gE{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new fE(e.style,e.options&&e.options.params||{},n)}),mE(this.states,"true","1"),mE(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new pE(e,t,this.states))}),this.fallbackTransition=function(e,t,n){return new pE(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},t)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function mE(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const yE=new XC;class vE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=WC(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=Z_(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let s;const o=new Map;if(i?(s=tE(this._driver,t,i,pC,fC,{},{},n,yE,r),s.forEach(e=>{const t=X_(o,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);o.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,B_)})});const a=j_(s.map(e=>{const t=o.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=Q_(t,"","","");return Y_(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const _E="ng-animate-queued",CE="ng-animate-disabled",EE=".ng-animate-disabled",wE=[],bE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},SE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},PE="__ng_removed";class OE{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=(n?e.value:e)??null,n){const t=wC(e);delete t.value,this.options=t}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const TE="void",IE=new OE(TE);class kE{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,FE(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const s=X_(this._elementListeners,e,[]),o={name:t,phase:n,callback:r};s.push(o);const a=X_(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(FE(e,gC),FE(e,gC+"-"+t),a[t]=IE),()=>{this._engine.afterFlush(()=>{const e=s.indexOf(o);e>=0&&s.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),s=new ME(this.id,t,e);let o=this._engine.statesByElement.get(e);o||(FE(e,gC),FE(e,gC+"-"+t),this._engine.statesByElement.set(e,o={}));let a=o[t];const l=new OE(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&l.absorbOptions(a.options),o[t]=l,a||(a=IE),l.value!==TE&&a.value===l.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,l.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(l.value,l.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{TC(e,n),OC(e,r)})}return}const c=X_(this._engine.playersByElement,e,[]);c.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let u=i.matchTransition(a.value,l.value,e,l.params),h=!1;if(!u){if(!r)return;u=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:u,fromState:a,toState:l,player:s,isFallbackTransition:h}),h||(FE(e,_E),s.onStart(()=>{UE(e,_E)})),s.onDone(()=>{let t=this.players.indexOf(s);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(s);e>=0&&n.splice(e,1)}}),this.players.push(s),c.push(s),s}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,mC,!0);n.forEach(e=>{if(e[PE])return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const s=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,TE,r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&j_(s).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const s=this._triggers[i].fallbackTransition,o=n[i]||IE,a=new OE(TE),l=new ME(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:s,fromState:o,toState:a,player:l,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e[PE];(!r||r===bE)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){FE(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(t=>{if(t.name==n.triggerName){const r=Q_(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,Y_(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class AE{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new kE(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(NE(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!NE(t))return;const i=t[PE];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),FE(e,CE)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),UE(e,CE))}removeNode(e,t,n,r){if(NE(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t[PE]={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return NE(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,mC,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,vC,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return j_(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[PE];if(t&&t.setForRemoval){if(e[PE]=bE,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,EE)&&this.markElementAsDisabled(e,!1),this.driver.query(e,EE,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)FE(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?j_(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new XC,r=[],i=new Map,s=[],o=new Map,a=new Map,l=new Map,c=new Set;this.disabledNodes.forEach(e=>{c.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)c.add(t[n])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=DE(h,this.collectedEnterElements),p=new Map;let f=0;d.forEach((e,t)=>{const n=pC+f++;p.set(t,n),e.forEach(e=>FE(e,n))});const g=[],m=new Set,y=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const e=this.collectedLeaveElements[A],t=e[PE];t&&t.setForRemoval&&(g.push(e),m.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>m.add(e)):y.add(e))}const v=new Map,_=DE(h,Array.from(m));_.forEach((e,t)=>{const n=fC+f++;v.set(t,n),e.forEach(e=>FE(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=p.get(t);e.forEach(e=>UE(e,n))}),_.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>UE(e,n))}),g.forEach(e=>{this.processLeaveNode(e)})});const C=[],E=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(C.push(t),this.collectedEnterElements.length){const e=i[PE];if(e&&e.setForMove)return void t.destroy()}const c=!u||!this.driver.containsElement(u,i),h=v.get(i),d=p.get(i),f=this._buildInstruction(e,n,d,h,c);if(f.errors&&f.errors.length)E.push(f);else{if(c)return t.onStart(()=>TC(i,f.fromStyles)),t.onDestroy(()=>OC(i,f.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>TC(i,f.fromStyles)),t.onDestroy(()=>OC(i,f.toStyles)),void r.push(t);f.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,f.timelines),s.push({instruction:f,player:t,element:i}),f.queriedElements.forEach(e=>X_(o,e,[]).push(t)),f.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),f.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=l.get(t);r||l.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(E.length){const e=[];E.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),C.forEach(e=>e.destroy()),this.reportError(e)}const w=new Map,b=new Map;s.forEach(e=>{const t=e.element;n.has(t)&&(b.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,w))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{X_(w,t,[]).push(e),e.destroy()})});const S=g.filter(e=>$E(e,a,l)),P=new Map;xE(P,this.driver,y,l,B_).forEach(e=>{$E(e,a,l)&&S.push(e)});const O=new Map;d.forEach((e,t)=>{xE(O,this.driver,new Set(e),a,"!")}),S.forEach(e=>{const t=P.get(e),n=O.get(e);P.set(e,Object.assign(Object.assign({},t),n))});const T=[],I=[],k={};s.forEach(e=>{const{element:t,player:s,instruction:o}=e;if(n.has(t)){if(c.has(t))return s.onDestroy(()=>OC(t,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let e=k;if(b.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=b.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>b.set(t,e))}const n=this._buildAnimation(s.namespaceId,o,w,i,O,P);if(s.setRealPlayer(n),e===k)T.push(s);else{const t=this.playersByElement.get(e);t&&t.length&&(s.parentPlayer=j_(t)),r.push(s)}}else TC(t,o.fromStyles),s.onDestroy(()=>OC(t,o.toStyles)),I.push(s),c.has(t)&&r.push(s)}),I.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=j_(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let A=0;A<g.length;A++){const e=g[A],t=e[PE];if(UE(e,fC),t&&t.hasAnimation)continue;let n=[];if(o.size){let t=o.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,vC,!0);for(let e=0;e<r.length;e++){let t=o.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?BE(this,e,r):this.processLeaveNode(e)}return g.length=0,T.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),T}elementContainsData(e,t){let n=!1;const r=t[PE];return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let s=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(s=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==TE;t.forEach(t=>{t.queued||!e&&t.triggerName!=r||s.push(t)})}}return(n||r)&&(s=s.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),s}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName;for(const o of t.timelines){const e=o.element,a=e!==r,l=X_(n,e,[]);this._getPreviousPlayers(e,a,i,s,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),l.push(e)})}TC(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,s){const o=t.triggerName,a=t.element,l=[],c=new Set,u=new Set,h=t.timelines.map(t=>{const h=t.element;c.add(h);const d=h[PE];if(d&&d.removedBeforeQueried)return new H_(t.duration,t.delay);const p=h!==a,f=function(e){const t=[];return VE(e,t),t}((n.get(h)||wE).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),g=i.get(h),m=s.get(h),y=Z_(0,this._normalizer,0,t.keyframes,g,m),v=this._buildPlayer(t,y,f);if(t.subTimeline&&r&&u.add(h),p){const t=new ME(e,o,h);t.setRealPlayer(v),l.push(t)}return v});l.forEach(e=>{X_(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),c.forEach(e=>FE(e,yC));const d=j_(h);return d.onDestroy(()=>{c.forEach(e=>UE(e,yC)),OC(a,t.toStyles)}),u.forEach(e=>{X_(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new H_(e.duration,e.delay)}}class ME{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new H_,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>Y_(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){X_(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function NE(e){return e&&1===e.nodeType}function RE(e,t){const n=e.style.display;return e.style.display=t??"none",n}function xE(e,t,n,r,i){const s=[];n.forEach(e=>s.push(RE(e)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(e=>{const n=s[e]=t.computeStyle(r,e,i);(!n||0==n.length)&&(r[PE]=SE,o.push(r))}),e.set(r,s)});let a=0;return n.forEach(e=>RE(e,s[a++])),o}function DE(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function s(e){if(!e)return 1;let t=i.get(e);if(t)return t;const o=e.parentNode;return t=n.has(o)?o:r.has(o)?1:s(o),i.set(e,t),t}return t.forEach(e=>{const t=s(e);1!==t&&n.get(t).push(e)}),n}const LE="$$classes";function FE(e,t){if(e.classList)e.classList.add(t);else{let n=e[LE];n||(n=e[LE]={}),n[t]=!0}}function UE(e,t){if(e.classList)e.classList.remove(t);else{let n=e[LE];n&&delete n[t]}}function BE(e,t,n){j_(n).onDone(()=>e.processLeaveNode(t))}function VE(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof G_?VE(r.players,t):t.push(r)}}function $E(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class zE{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new AE(e,t,n),this._timelineEngine=new vE(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const s=e+"-"+r;let o=this._triggerCache[s];if(!o){const e=[],t=WC(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);o=function(e,t,n){return new gE(e,t,n)}(r,t,this._normalizer),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(t,r,o)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=J_(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=J_(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function HE(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=WE(t[0]),t.length>1&&(r=WE(t[t.length-1]))):t&&(n=WE(t)),n||r?new GE(e,n,r):null}let GE=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&OC(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(OC(this._element,this._initialStyles),this._endStyles&&(OC(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(TC(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(TC(this._element,this._endStyles),this._endStyles=null),OC(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function WE(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];qE(i)&&(t=t||{},t[i]=e[i])}return t}function qE(e){return"display"===e||"position"===e}const jE="animation",ZE="animationend";class YE{constructor(e,t,n,r,i,s,o){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){(function(e,t){const n=tw(e,"").trim();let r=0;n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++;return n}(n)+1,t=`${n}, ${t}`),ew(e,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),JE(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){KE(this._element,this._name,"paused")}resume(){KE(this._element,this._name,"running")}setPosition(e){const t=QE(this._element,this._name);this._position=e*this._duration,ew(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),JE(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=tw(e,"").split(","),r=XE(n,t);r>=0&&(n.splice(r,1),ew(e,"",n.join(",")))}(this._element,this._name))}}function KE(e,t,n){ew(e,"PlayState",n,QE(e,t))}function QE(e,t){const n=tw(e,"");return n.indexOf(",")>0?XE(n.split(","),t):XE([n],t)}function XE(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function JE(e,t,n){n?e.removeEventListener(ZE,t):e.addEventListener(ZE,t)}function ew(e,t,n,r){const i=jE+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function tw(e,t){return e.style[jE+t]||""}class nw{constructor(e,t,n,r,i,s,o,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new YE(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:BC(this.element,n))})}this.currentSnapshot=e}}class rw extends H_{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=uC(t)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class iw{constructor(){this._count=0}validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>uC(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const s=document.createElement("style");return s.textContent=r,s}animate(e,t,n,r,i,s=[],o){const a=s.filter(e=>e instanceof nw),l={};LC(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const c=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"==n||"easing"==n||(t[n]=e[n])})}),t}(t=FC(e,t,l));if(0==n)return new rw(e,c);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,u,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=HE(e,t),p=new nw(e,t,u,n,r,i,c,d);return p.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),p}}class sw{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:BC(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class ow{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(aw().toString()),this._cssKeyframesDriver=new iw}validateStyleProperty(e){return oC(e)}matchesElement(e,t){return aC(e,t)}containsElement(e,t){return lC(e,t)}query(e,t,n){return cC(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const l={},c=s.filter(e=>e instanceof sw);LC(n,r)&&c.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>l[e]=t[e])});const u=HE(e,t=FC(e,t=t.map(e=>bC(e,!1)),l));return new sw(e,t,a,u)}}function aw(){return W_()&&Element.prototype.animate||{}}let lw=(()=>{class e extends U_{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:Ue.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?V_(e):e;return hw(this._renderer,null,t,"register",[n]),new cw(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(Or(Pc),Or(Kh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class cw extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new uw(this._id,e,t||{},this._renderer)}}class uw{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return hw(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function hw(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const dw="@.disabled";let pw=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new fw("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const s=t=>{Array.isArray(t)?t.forEach(s):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(s),new gw(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(Or(Pc),Or(zE),Or(vh))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();class fw{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){"@"==t.charAt(0)&&t==dw?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class gw extends fw{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&t==dw?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if("@"==t.charAt(0)){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let mw=(()=>{class e extends zE{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(dC),Or(lE))},e.\u0275prov=be({token:e,factory:e.\u0275fac}),e})();const yw=new or("AnimationModuleType"),vw=[{provide:U_,useClass:lw},{provide:lE,useFactory:function(){return new cE}},{provide:zE,useClass:mw},{provide:Pc,useFactory:function(e,t,n){return new pw(e,t,n)},deps:[kp,zE,vh]}],_w=[{provide:dC,useFactory:function(){return"function"==typeof aw()?new ow:new iw}},{provide:yw,useValue:"BrowserAnimations"},...vw],Cw=[{provide:dC,useClass:hC},{provide:yw,useValue:"NoopAnimations"},...vw];let Ew=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?Cw:_w}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:_w,imports:[Hp]}),e})();var ww=n(2616),bw=n.n(ww);function Sw(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function Pw(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function o(e){Sw(s,r,i,o,a,"next",e)}function a(e){Sw(s,r,i,o,a,"throw",e)}o(void 0)})}}class Ow{static expectToBe(e,t,n){if(e!==t)throw void 0!==n?new Error(n):new Error(`A default switch case did not observe the correct value, expected ${t}, but got ${e} instead.`)}static expectToBeMultiple(e,t){let n=!1;for(const r of t)if(e===r){n=!0;break}if(!1===n)throw new Error(`A default switch case did not observe the correct value, expected a value among ${t}, but got ${e} instead.`)}static getNonNullable(e){if(null==e)throw new Error("Expected value not to be null or undefined, but it was.");return e}}function Tw(e,t){e&&console.log(t)}function Iw(e,t){if(null!=e&&null!=t&&"object"==typeof e){if(null!=e.equals)return e.equals(t);{const n=e,r=t;for(const e of Object.keys(n)){if(!(e in r))return!1;if(!1===Iw(n[e],r[e]))return!1}return!0}}return e===t}function kw(e){return null==e||function(e){return"object"==typeof e&&null!=e&&null!=e.equals}(e)||function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(e)||function(e){if("object"==typeof e){for(const t in e)if(null!=e[t]&&!1===kw(e[t]))return!1;return null!=e&&e.constructor.prototype===Object.prototype}return!1}(e)}function Aw(e,t){if(kw(e)&&kw(t))return Iw(e,t);throw new Error(`Comparing non comparable objects: ${e.constructor.name} and ${t.constructor.name}`)}class Mw{constructor(e){this.value=e}static of(e){return new Mw(e)}static ofNullable(e){return null==e?Mw.empty():Mw.of(e)}static empty(){return new Mw(null)}isPresent(){return null!=this.value}isAbsent(){return null==this.value}get(){if(this.isPresent())return this.value;throw new Error("Value is absent")}getOrElse(e){return this.isPresent()?this.value:e}equals(e){return this.isAbsent()?e.isAbsent():!e.isAbsent()&&Aw(this.value,e.value)}equalsValue(e){return this.equals(Mw.of(e))}toString(){return this.isAbsent()?"MGPOptional.empty()":`MGPOptional.of(${this.value})`}map(e){return this.isPresent()?Mw.of(e(this.get())):Mw.empty()}}const Nw=function(e,t){if(!e)throw Rw(t)},Rw=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},xw=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Dw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0;let c=(15&o)<<2|l>>6,u=63&l;a||(u=64,s||(c=64)),r.push(n[t>>2],n[(3&t)<<4|o>>4],n[c],n[u])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(xw(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();r.push(t<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Lw=function(e){const t=xw(e);return Dw.encodeByteArray(t,!0)},Fw=function(e){return Lw(e).replace(/\./g,"")},Uw=function(e){try{return Dw.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Bw(e){return Vw(void 0,e)}function Vw(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)!t.hasOwnProperty(n)||!$w(n)||(e[n]=Vw(e[n],t[n]));return e}function $w(e){return"__proto__"!==e}class zw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Hw(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Fw(JSON.stringify({alg:"none",type:"JWT"})),Fw(JSON.stringify(s)),""].join(".")}function Gw(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ww(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Gw())}function qw(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function jw(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Zw(){const e=Gw();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Yw(){return"object"==typeof indexedDB}function Kw(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function Qw(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Xw extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Xw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jw.prototype.create)}}class Jw{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(eb,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error";return new Xw(r,`${this.serviceName}: ${s} (${r}).`,n)}}const eb=/\{\$([^}]+)}/g;function tb(e){return JSON.parse(e)}function nb(e){return JSON.stringify(e)}const rb=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=tb(Uw(s[0])||""),n=tb(Uw(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}};function ib(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function sb(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function ob(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ab(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function lb(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(cb(n)&&cb(s)){if(!lb(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function cb(e){return null!==e&&"object"==typeof e}function ub(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function hb(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function db(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class pb{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=l^o&(a^l),i=1518500249):(r=o^a^l,i=1859775393):u<60?(r=o&a|l&(o|a),i=2400959708):(r=o^a^l,i=3395469782);const e=(s<<5|s>>>27)+r+c+i+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class fb{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of["next","error","complete"])if(n in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=gb),void 0===r.error&&(r.error=gb),void 0===r.complete&&(r.complete=gb);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){void 0===this.observers||void 0===this.observers[e]||(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gb(){}function mb(e,t){return`${e} failed: ${t} argument `}const yb=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function vb(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function _b(e){return e&&e._delegate?e._delegate:e}class Cb{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Eb="[DEFAULT]";class wb{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new zw;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Eb})}catch{}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=Eb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return Pw(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=Eb){return this.instances.has(e)}getOptions(e=Eb){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(i)&&s.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===Eb?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=Eb){return this.component?this.component.multipleInstances?e:Eb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class bb{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wb(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Sb=[];var Pb=(()=>{return(e=Pb||(Pb={}))[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",Pb;var e})();const Ob={debug:Pb.DEBUG,verbose:Pb.VERBOSE,info:Pb.INFO,warn:Pb.WARN,error:Pb.ERROR,silent:Pb.SILENT},Tb=Pb.INFO,Ib={[Pb.DEBUG]:"log",[Pb.VERBOSE]:"log",[Pb.INFO]:"info",[Pb.WARN]:"warn",[Pb.ERROR]:"error"},kb=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=Ib[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class Ab{constructor(e){this.name=e,this._logLevel=Tb,this._logHandler=kb,this._userLogHandler=null,Sb.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Pb))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Ob[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Pb.DEBUG,...e),this._logHandler(this,Pb.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Pb.VERBOSE,...e),this._logHandler(this,Pb.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Pb.INFO,...e),this._logHandler(this,Pb.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Pb.WARN,...e),this._logHandler(this,Pb.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Pb.ERROR,...e),this._logHandler(this,Pb.ERROR,...e)}}let Mb,Nb;const Rb=new WeakMap,xb=new WeakMap,Db=new WeakMap,Lb=new WeakMap,Fb=new WeakMap;let Ub={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return xb.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Db.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Vb(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Bb(e){return"function"==typeof e?function(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Nb||(Nb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply($b(this),t),Vb(Rb.get(this))}:function(...t){return Vb(e.apply($b(this),t))}:function(t,...n){const r=e.call($b(this),t,...n);return Db.set(r,t.sort?t.sort():[t]),Vb(r)}}(e):(e instanceof IDBTransaction&&function(e){if(xb.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});xb.set(e,t)}(e),((e,t)=>t.some(t=>e instanceof t))(e,Mb||(Mb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Ub):e)}function Vb(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Vb(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&Rb.set(t,e)}).catch(()=>{}),Fb.set(t,e),t}(e);if(Lb.has(e))return Lb.get(e);const t=Bb(e);return t!==e&&(Lb.set(e,t),Fb.set(t,e)),t}const $b=e=>Fb.get(e);function zb(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Vb(o);return r&&o.addEventListener("upgradeneeded",e=>{r(Vb(o.result),e.oldVersion,e.newVersion,Vb(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}function Hb(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Vb(n).then(()=>{})}const Gb=["get","getKey","getAll","getAllKeys","count"],Wb=["put","add","delete","clear"],qb=new Map;function jb(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(qb.get(t))return qb.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Wb.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Gb.includes(n))return;const s=function(){var e=Pw(function*(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(yield Promise.all([o[n](...t),i&&s.done]))[0]});return function(t){return e.apply(this,arguments)}}();return qb.set(t,s),s}var Zb;Zb=Ub,Ub={...Zb,get:(e,t,n)=>jb(e,t)||Zb.get(e,t,n),has:(e,t)=>!!jb(e,t)||Zb.has(e,t)};class Yb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Kb="@firebase/app",Qb=new Ab("@firebase/app"),Xb="[DEFAULT]",Jb={[Kb]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},eS=new Map,tS=new Map;function nS(e,t){try{e.container.addComponent(t)}catch(n){Qb.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function rS(e){const t=e.name;if(tS.has(t))return Qb.debug(`There were multiple attempts to register component ${t}.`),!1;tS.set(t,e);for(const n of eS.values())nS(n,e);return!0}function iS(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const sS=new Jw("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class oS{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Cb("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sS.create("app-deleted",{appName:this._name})}}const aS="9.9.0";function lS(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:Xb,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw sS.create("bad-app-name",{appName:String(r)});const i=eS.get(r);if(i){if(lb(e,i.options)&&lb(n,i.config))return i;throw sS.create("duplicate-app",{appName:r})}const s=new bb(r);for(const a of tS.values())s.addComponent(a);const o=new oS(e,n,s);return eS.set(r,o),o}function cS(e=Xb){const t=eS.get(e);if(!t)throw sS.create("no-app",{appName:e});return t}function uS(){return Array.from(eS.values())}function hS(e,t,n){var r;let i=null!==(r=Jb[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Qb.warn(e.join(" "))}rS(new Cb(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const dS="firebase-heartbeat-store";let pS=null;function fS(){return pS||(pS=zb("firebase-heartbeat-database",1,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(dS)}}}).catch(e=>{throw sS.create("storage-open",{originalErrorMessage:e.message})})),pS}function gS(){return(gS=Pw(function*(e){var t;try{return(yield fS()).transaction(dS).objectStore(dS).get(vS(e))}catch(n){throw sS.create("storage-get",{originalErrorMessage:null===(t=n)||void 0===t?void 0:t.message})}})).apply(this,arguments)}function mS(e,t){return yS.apply(this,arguments)}function yS(){return(yS=Pw(function*(e,t){var n;try{const n=(yield fS()).transaction(dS,"readwrite");return yield n.objectStore(dS).put(t,vS(e)),n.done}catch(r){throw sS.create("storage-set",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message})}})).apply(this,arguments)}function vS(e){return`${e.name}!${e.options.appId}`}class _S{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ES(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){var e=this;return Pw(function*(){const t=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=CS();if(null===e._heartbeatsCache&&(e._heartbeatsCache=yield e._heartbeatsCachePromise),e._heartbeatsCache.lastSentHeartbeatDate!==n&&!e._heartbeatsCache.heartbeats.some(e=>e.date===n))return e._heartbeatsCache.heartbeats.push({date:n,agent:t}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return Pw(function*(){if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null===e._heartbeatsCache||0===e._heartbeatsCache.heartbeats.length)return"";const t=CS(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),wS(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),wS(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(e._heartbeatsCache.heartbeats),i=Fw(JSON.stringify({version:2,heartbeats:n}));return e._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(e._heartbeatsCache.heartbeats=r,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),i})()}}function CS(){return(new Date).toISOString().substring(0,10)}class ES{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return Pw(function*(){return!!Yw()&&Kw().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return Pw(function*(){return(yield e._canUseIndexedDBPromise)&&(yield function(e){return gS.apply(this,arguments)}(e.app))||{heartbeats:[]}})()}overwrite(e){var t=this;return Pw(function*(){var n;if(yield t._canUseIndexedDBPromise){const r=yield t.read();return mS(t.app,{lastSentHeartbeatDate:null!==(n=e.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return Pw(function*(){var n;if(yield t._canUseIndexedDBPromise){const r=yield t.read();return mS(t.app,{lastSentHeartbeatDate:null!==(n=e.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}})()}}function wS(e){return Fw(JSON.stringify({version:2,heartbeats:e})).length}rS(new Cb("platform-logger",e=>new Yb(e),"PRIVATE")),rS(new Cb("heartbeat",e=>new _S(e),"PRIVATE")),hS(Kb,"0.7.28",""),hS(Kb,"0.7.28","esm2017"),hS("fire-js",""),hS("firebase","9.9.0","app");const bS="@firebase/installations",SS="0.5.12",PS=`w:${SS}`,OS="FIS_v2",TS=new Jw("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function IS(e){return e instanceof Xw&&e.code.includes("request-failed")}function kS({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function AS(e){return{token:e.token,requestStatus:2,expiresIn:FS(e.expiresIn),creationTime:Date.now()}}function MS(e,t){return NS.apply(this,arguments)}function NS(){return(NS=Pw(function*(e,t){const n=(yield t.json()).error;return TS.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})})).apply(this,arguments)}function RS({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function xS(e,{refreshToken:t}){const n=RS(e);return n.append("Authorization",function(e){return`${OS} ${e}`}(t)),n}function DS(e){return LS.apply(this,arguments)}function LS(){return(LS=Pw(function*(e){const t=yield e();return t.status>=500&&t.status<600?e():t})).apply(this,arguments)}function FS(e){return Number(e.replace("s","000"))}function US(e,t){return BS.apply(this,arguments)}function BS(){return(BS=Pw(function*({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=kS(e),i=RS(e),s=t.getImmediate({optional:!0});if(s){const e=yield s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={method:"POST",headers:i,body:JSON.stringify({fid:n,authVersion:OS,appId:e.appId,sdkVersion:PS})},a=yield DS(()=>fetch(r,o));if(a.ok){const e=yield a.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:AS(e.authToken)}}throw yield MS("Create Installation",a)})).apply(this,arguments)}function VS(e){return new Promise(t=>{setTimeout(t,e)})}const $S=/^[cdef][\w-]{21}$/;function zS(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return function(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}(e).substr(0,22)}(e);return $S.test(t)?t:""}catch{return""}}function HS(e){return`${e.appName}!${e.appId}`}const GS=new Map;function WS(e,t){const n=HS(e);qS(n,t),function(e,t){const n=(!jS&&"BroadcastChannel"in self&&(jS=new BroadcastChannel("[Firebase] FID Change"),jS.onmessage=e=>{qS(e.data.key,e.data.fid)}),jS);n&&n.postMessage({key:e,fid:t}),0===GS.size&&jS&&(jS.close(),jS=null)}(n,t)}function qS(e,t){const n=GS.get(e);if(n)for(const r of n)r(t)}let jS=null;const ZS="firebase-installations-store";let YS=null;function KS(){return YS||(YS=zb("firebase-installations-database",1,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(ZS)}}})),YS}function QS(e,t){return XS.apply(this,arguments)}function XS(){return(XS=Pw(function*(e,t){const n=HS(e),r=(yield KS()).transaction(ZS,"readwrite"),i=r.objectStore(ZS),s=yield i.get(n);return yield i.put(t,n),yield r.done,(!s||s.fid!==t.fid)&&WS(e,t.fid),t})).apply(this,arguments)}function JS(e){return eP.apply(this,arguments)}function eP(){return(eP=Pw(function*(e){const t=HS(e),n=(yield KS()).transaction(ZS,"readwrite");yield n.objectStore(ZS).delete(t),yield n.done})).apply(this,arguments)}function tP(e,t){return nP.apply(this,arguments)}function nP(){return(nP=Pw(function*(e,t){const n=HS(e),r=(yield KS()).transaction(ZS,"readwrite"),i=r.objectStore(ZS),s=yield i.get(n),o=t(s);return void 0===o?yield i.delete(n):yield i.put(o,n),yield r.done,o&&(!s||s.fid!==o.fid)&&WS(e,o.fid),o})).apply(this,arguments)}function rP(e){return iP.apply(this,arguments)}function iP(){return(iP=Pw(function*(e){let t;const n=yield tP(e.appConfig,n=>{const r=sP(n),i=oP(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:yield t}:{installationEntry:n,registrationPromise:t}})).apply(this,arguments)}function sP(e){return hP(e||{fid:zS(),registrationStatus:0})}function oP(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(TS.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return aP.apply(this,arguments)}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:lP(e)}:{installationEntry:t}}function aP(){return(aP=Pw(function*(e,t){try{const n=yield US(e,t);return QS(e.appConfig,n)}catch(n){throw IS(n)&&409===n.customData.serverCode?yield JS(e.appConfig):yield QS(e.appConfig,{fid:t.fid,registrationStatus:0}),n}})).apply(this,arguments)}function lP(e){return cP.apply(this,arguments)}function cP(){return(cP=Pw(function*(e){let t=yield uP(e.appConfig);for(;1===t.registrationStatus;)yield VS(100),t=yield uP(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=yield rP(e);return n||t}return t})).apply(this,arguments)}function uP(e){return tP(e,e=>{if(!e)throw TS.create("installation-not-found");return hP(e)})}function hP(e){return function(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()}(e)?{fid:e.fid,registrationStatus:0}:e}function dP(e,t){return pP.apply(this,arguments)}function pP(){return(pP=Pw(function*({appConfig:e,heartbeatServiceProvider:t},n){const r=fP(e,n),i=xS(e,n),s=t.getImmediate({optional:!0});if(s){const e=yield s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:PS,appId:e.appId}})},a=yield DS(()=>fetch(r,o));if(a.ok)return AS(yield a.json());throw yield MS("Generate Auth Token",a)})).apply(this,arguments)}function fP(e,{fid:t}){return`${kS(e)}/${t}/authTokens:generate`}function gP(e){return mP.apply(this,arguments)}function mP(){return(mP=Pw(function*(e,t=!1){let n;const r=yield tP(e.appConfig,r=>{if(!wP(r))throw TS.create("not-registered");const i=r.authToken;if(!t&&bP(i))return r;if(1===i.requestStatus)return n=yP(e,t),r;{if(!navigator.onLine)throw TS.create("app-offline");const t=SP(r);return n=CP(e,t),t}});return n?yield n:r.authToken})).apply(this,arguments)}function yP(e,t){return vP.apply(this,arguments)}function vP(){return(vP=Pw(function*(e,t){let n=yield _P(e.appConfig);for(;1===n.authToken.requestStatus;)yield VS(100),n=yield _P(e.appConfig);const r=n.authToken;return 0===r.requestStatus?gP(e,t):r})).apply(this,arguments)}function _P(e){return tP(e,e=>{if(!wP(e))throw TS.create("not-registered");return function(e){return 1===e.requestStatus&&e.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function CP(e,t){return EP.apply(this,arguments)}function EP(){return(EP=Pw(function*(e,t){try{const n=yield dP(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return yield QS(e.appConfig,r),n}catch(n){if(!IS(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield QS(e.appConfig,n)}else yield JS(e.appConfig);throw n}})).apply(this,arguments)}function wP(e){return void 0!==e&&2===e.registrationStatus}function bP(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}function SP(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function PP(){return(PP=Pw(function*(e){const t=e,{installationEntry:n,registrationPromise:r}=yield rP(t);return r?r.catch(console.error):gP(t).catch(console.error),n.fid})).apply(this,arguments)}function OP(){return(OP=Pw(function*(e,t=!1){const n=e;return yield TP(n),(yield gP(n,t)).token})).apply(this,arguments)}function TP(e){return IP.apply(this,arguments)}function IP(){return(IP=Pw(function*(e){const{registrationPromise:t}=yield rP(e);t&&(yield t)})).apply(this,arguments)}function kP(e){return TS.create("missing-app-config-values",{valueName:e})}const AP="installations";rS(new Cb(AP,e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw kP("App Configuration");if(!e.name)throw kP("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw kP(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:iS(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),rS(new Cb("installations-internal",e=>{const t=iS(e.getProvider("app").getImmediate(),AP).getImmediate();return{getId:()=>function(e){return PP.apply(this,arguments)}(t),getToken:e=>function(e){return OP.apply(this,arguments)}(t,e)}},"PRIVATE")),hS(bS,SS),hS(bS,SS,"esm2017");const MP="@firebase/remote-config",NP=new Jw("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});class RP{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}fetch(e){var t=this;return Pw(function*(){const[n,r]=yield Promise.all([t.storage.getLastSuccessfulFetchTimestampMillis(),t.storage.getLastSuccessfulFetchResponse()]);if(r&&t.isCachedDataFresh(e.cacheMaxAgeMillis,n))return r;e.eTag=r&&r.eTag;const i=yield t.client.fetch(e),s=[t.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===i.status&&s.push(t.storage.setLastSuccessfulFetchResponse(i)),yield Promise.all(s),i})()}}function xP(e=navigator){return e.languages&&e.languages[0]||e.language}class DP{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}fetch(e){var t=this;return Pw(function*(){var n,r,i;const[s,o]=yield Promise.all([t.firebaseInstallations.getId(),t.firebaseInstallations.getToken()]),a=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${t.projectId}/namespaces/${t.namespace}:fetch?key=${t.apiKey}`,l={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},c={sdk_version:t.sdkVersion,app_instance_id:s,app_instance_id_token:o,app_id:t.appId,language_code:xP()},u={method:"POST",headers:l,body:JSON.stringify(c)},h=fetch(a,u),d=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let p;try{yield Promise.race([h,d]),p=yield h}catch(v){let e="fetch-client-network";throw"AbortError"===(null===(n=v)||void 0===n?void 0:n.name)&&(e="fetch-timeout"),NP.create(e,{originalErrorMessage:null===(r=v)||void 0===r?void 0:r.message})}let f=p.status;const g=p.headers.get("ETag")||void 0;let m,y;if(200===p.status){let e;try{e=yield p.json()}catch(_){throw NP.create("fetch-client-parse",{originalErrorMessage:null===(i=_)||void 0===i?void 0:i.message})}m=e.entries,y=e.state}if("INSTANCE_STATE_UNSPECIFIED"===y?f=500:"NO_CHANGE"===y?f=304:("NO_TEMPLATE"===y||"EMPTY_CONFIG"===y)&&(m={}),304!==f&&200!==f)throw NP.create("fetch-status",{httpStatus:f});return{status:f,eTag:g,config:m}})()}}class LP{constructor(e,t){this.client=e,this.storage=t}fetch(e){var t=this;return Pw(function*(){const n=(yield t.storage.getThrottleMetadata())||{backoffCount:0,throttleEndTimeMillis:Date.now()};return t.attemptFetch(e,n)})()}attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var r=this;return Pw(function*(){yield function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(NP.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(e.signal,t);try{const t=yield r.client.fetch(e);return yield r.storage.deleteThrottleMetadata(),t}catch(i){if(!function(e){if(!(e instanceof Xw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(i))throw i;const t={throttleEndTimeMillis:Date.now()+vb(n),backoffCount:n+1};return yield r.storage.setThrottleMetadata(t),r.attemptFetch(e,t)}})()}}class FP{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function UP(e,t){var n;const r=e.target.error||void 0;return NP.create(t,{originalErrorMessage:r&&(null===(n=r)||void 0===n?void 0:n.message)})}const BP="app_namespace_store";class VP{constructor(e,t,n,r=function(){return new Promise((e,t)=>{var r;try{const n=indexedDB.open("firebase_remote_config",1);n.onerror=e=>{t(UP(e,"storage-open"))},n.onsuccess=t=>{e(t.target.result)},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(BP,{keyPath:"compositeKey"})}}}catch(n){t(NP.create("storage-open",{originalErrorMessage:null===(r=n)||void 0===r?void 0:r.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}get(e){var t=this;return Pw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{var s;const o=n.transaction([BP],"readonly").objectStore(BP),a=t.createCompositeKey(e);try{const e=o.get(a);e.onerror=e=>{i(UP(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;r(t?t.value:void 0)}}catch(l){i(NP.create("storage-get",{originalErrorMessage:null===(s=l)||void 0===s?void 0:s.message}))}})})()}set(e,t){var n=this;return Pw(function*(){const r=yield n.openDbPromise;return new Promise((i,s)=>{var o;const a=r.transaction([BP],"readwrite").objectStore(BP),l=n.createCompositeKey(e);try{const e=a.put({compositeKey:l,value:t});e.onerror=e=>{s(UP(e,"storage-set"))},e.onsuccess=()=>{i()}}catch(c){s(NP.create("storage-set",{originalErrorMessage:null===(o=c)||void 0===o?void 0:o.message}))}})})()}delete(e){var t=this;return Pw(function*(){const n=yield t.openDbPromise;return new Promise((r,i)=>{var s;const o=n.transaction([BP],"readwrite").objectStore(BP),a=t.createCompositeKey(e);try{const e=o.delete(a);e.onerror=e=>{i(UP(e,"storage-delete"))},e.onsuccess=()=>{r()}}catch(l){i(NP.create("storage-delete",{originalErrorMessage:null===(s=l)||void 0===s?void 0:s.message}))}})})()}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class $P{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}loadFromStorage(){var e=this;return Pw(function*(){const t=e.storage.getLastFetchStatus(),n=e.storage.getLastSuccessfulFetchTimestampMillis(),r=e.storage.getActiveConfig(),i=yield t;i&&(e.lastFetchStatus=i);const s=yield n;s&&(e.lastSuccessfulFetchTimestampMillis=s);const o=yield r;o&&(e.activeConfig=o)})()}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function zP(){return HP.apply(this,arguments)}function HP(){return(HP=Pw(function*(){if(!Yw())return!1;try{return yield Kw()}catch{return!1}})).apply(this,arguments)}rS(new Cb("remote-config",function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw NP.create("registration-window");if(!Yw())throw NP.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:o}=n.options;if(!i)throw NP.create("registration-project-id");if(!s)throw NP.create("registration-api-key");if(!o)throw NP.create("registration-app-id");const a=new VP(o,n.name,t=t||"firebase"),l=new $P(a),c=new Ab(MP);c.logLevel=Pb.ERROR;const u=new DP(r,aS,t,i,s,o),h=new LP(u,a),d=new RP(h,a,l,c),p=new FP(n,d,l,a,c);return function(e){const t=_b(e);t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0}))}(p),p},"PUBLIC").setMultipleInstances(!0)),hS(MP,"0.3.11"),hS(MP,"0.3.11","esm2017");const GP="/firebase-messaging-sw.js",WP="/firebase-cloud-messaging-push-scope",qP="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",jP="google.c.a.c_id",ZP="google.c.a.c_l",YP="google.c.a.ts",KP="google.c.a.e";var QP=(()=>(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(QP||(QP={})),QP))();function XP(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function JP(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}const eO="fcm_token_details_db",tO="fcm_token_object_Store";function nO(e){return rO.apply(this,arguments)}function rO(){return(rO=Pw(function*(e){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(e=>e.name).includes(eO))return null;let t=null;return(yield zb(eO,5,{upgrade:(n=Pw(function*(n,r,i,s){var o;if(r<2||!n.objectStoreNames.contains(tO))return;const a=s.objectStore(tO),l=yield a.index("fcmSenderId").get(e);if(yield a.clear(),l)if(2===r){const e=l;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:XP(e.vapidKey)}}}else if(3===r){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:XP(e.auth),p256dh:XP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:XP(e.vapidKey)}}}else if(4===r){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:XP(e.auth),p256dh:XP(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:XP(e.vapidKey)}}}}),function(e,t,r,i){return n.apply(this,arguments)})})).close(),yield Hb(eO),yield Hb("fcm_vapid_details_db"),yield Hb("undefined"),iO(t)?t:null;var n})).apply(this,arguments)}function iO(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}const sO="firebase-messaging-store";let oO=null;function aO(){return oO||(oO=zb("firebase-messaging-database",1,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(sO)}}})),oO}function lO(e){return cO.apply(this,arguments)}function cO(){return(cO=Pw(function*(e){const t=fO(e),n=yield(yield aO()).transaction(sO).objectStore(sO).get(t);if(n)return n;{const t=yield nO(e.appConfig.senderId);if(t)return yield uO(e,t),t}})).apply(this,arguments)}function uO(e,t){return hO.apply(this,arguments)}function hO(){return(hO=Pw(function*(e,t){const n=fO(e),r=(yield aO()).transaction(sO,"readwrite");return yield r.objectStore(sO).put(t,n),yield r.done,t})).apply(this,arguments)}function dO(e){return pO.apply(this,arguments)}function pO(){return(pO=Pw(function*(e){const t=fO(e),n=(yield aO()).transaction(sO,"readwrite");yield n.objectStore(sO).delete(t),yield n.done})).apply(this,arguments)}function fO({appConfig:e}){return e.appId}const gO=new Jw("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function mO(e,t){return yO.apply(this,arguments)}function yO(){return(yO=Pw(function*(e,t){var n;const r=yield bO(e),i=PO(t),s={method:"POST",headers:r,body:JSON.stringify(i)};let o;try{o=yield(yield fetch(wO(e.appConfig),s)).json()}catch(a){throw gO.create("token-subscribe-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error)throw gO.create("token-subscribe-failed",{errorInfo:o.error.message});if(!o.token)throw gO.create("token-subscribe-no-token");return o.token})).apply(this,arguments)}function vO(e,t){return _O.apply(this,arguments)}function _O(){return(_O=Pw(function*(e,t){var n;const r=yield bO(e),i=PO(t.subscriptionOptions),s={method:"PATCH",headers:r,body:JSON.stringify(i)};let o;try{o=yield(yield fetch(`${wO(e.appConfig)}/${t.token}`,s)).json()}catch(a){throw gO.create("token-update-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error)throw gO.create("token-update-failed",{errorInfo:o.error.message});if(!o.token)throw gO.create("token-update-no-token");return o.token})).apply(this,arguments)}function CO(e,t){return EO.apply(this,arguments)}function EO(){return(EO=Pw(function*(e,t){var n;const r={method:"DELETE",headers:yield bO(e)};try{const n=yield(yield fetch(`${wO(e.appConfig)}/${t}`,r)).json();if(n.error)throw gO.create("token-unsubscribe-failed",{errorInfo:n.error.message})}catch(i){throw gO.create("token-unsubscribe-failed",{errorInfo:null===(n=i)||void 0===n?void 0:n.toString()})}})).apply(this,arguments)}function wO({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}function bO(e){return SO.apply(this,arguments)}function SO(){return(SO=Pw(function*({appConfig:e,installations:t}){const n=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})})).apply(this,arguments)}function PO({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==qP&&(i.web.applicationPubKey=r),i}function OO(e){return TO.apply(this,arguments)}function TO(){return(TO=Pw(function*(e){const t=yield xO(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:XP(t.getKey("auth")),p256dh:XP(t.getKey("p256dh"))},r=yield lO(e.firebaseDependencies);if(r){if(LO(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?AO(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{yield CO(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return NO(e.firebaseDependencies,n)}return NO(e.firebaseDependencies,n)})).apply(this,arguments)}function IO(e){return kO.apply(this,arguments)}function kO(){return(kO=Pw(function*(e){const t=yield lO(e.firebaseDependencies);t&&(yield CO(e.firebaseDependencies,t.token),yield dO(e.firebaseDependencies));const n=yield e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()})).apply(this,arguments)}function AO(e,t){return MO.apply(this,arguments)}function MO(){return(MO=Pw(function*(e,t){try{const n=yield vO(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return yield uO(e.firebaseDependencies,r),n}catch(n){throw yield IO(e),n}})).apply(this,arguments)}function NO(e,t){return RO.apply(this,arguments)}function RO(){return(RO=Pw(function*(e,t){const n={token:yield mO(e,t),createTime:Date.now(),subscriptionOptions:t};return yield uO(e,n),n.token})).apply(this,arguments)}function xO(e,t){return DO.apply(this,arguments)}function DO(){return(DO=Pw(function*(e,t){return(yield e.pushManager.getSubscription())||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:JP(t)})})).apply(this,arguments)}function LO(e,t){return t.vapidKey===e.vapidKey&&t.endpoint===e.endpoint&&t.auth===e.auth&&t.p256dh===e.p256dh}function FO(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i)}(t,e),function(e,t){!t.data||(e.data=t.data)}(t,e),function(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const l=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;l&&(e.fcmOptions.analyticsLabel=l)}(t,e),t}function UO(e){return"object"==typeof e&&!!e&&jP in e}function BO(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function VO(e){return gO.create("missing-app-config-values",{valueName:e})}BO("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),BO("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class $O{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw VO("App Configuration Object");if(!e.name)throw VO("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw VO(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function zO(e){return HO.apply(this,arguments)}function HO(){return(HO=Pw(function*(e){var t;try{e.swRegistration=yield navigator.serviceWorker.register(GP,{scope:WP}),e.swRegistration.update().catch(()=>{})}catch(n){throw gO.create("failed-service-worker-registration",{browserErrorMessage:null===(t=n)||void 0===t?void 0:t.message})}})).apply(this,arguments)}function GO(e,t){return WO.apply(this,arguments)}function WO(){return(WO=Pw(function*(e,t){if(!t&&!e.swRegistration&&(yield zO(e)),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw gO.create("invalid-sw-registration");e.swRegistration=t}})).apply(this,arguments)}function qO(e,t){return jO.apply(this,arguments)}function jO(){return(jO=Pw(function*(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=qP)})).apply(this,arguments)}function ZO(){return(ZO=Pw(function*(e,t){if(!navigator)throw gO.create("only-available-in-window");if("default"===Notification.permission&&(yield Notification.requestPermission()),"granted"!==Notification.permission)throw gO.create("permission-blocked");return yield qO(e,null==t?void 0:t.vapidKey),yield GO(e,null==t?void 0:t.serviceWorkerRegistration),OO(e)})).apply(this,arguments)}function YO(e,t,n){return KO.apply(this,arguments)}function KO(){return(KO=Pw(function*(e,t,n){const r=QO(t);(yield e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[jP],message_name:n[ZP],message_time:n[YP],message_device_time:Math.floor(Date.now()/1e3)})})).apply(this,arguments)}function QO(e){switch(e){case QP.NOTIFICATION_CLICKED:return"notification_open";case QP.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function XO(){return(XO=Pw(function*(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===QP.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(FO(n)):e.onMessageHandler.next(FO(n)));const r=n.data;UO(r)&&"1"===r[KP]&&(yield YO(e,n.messageType,r))})).apply(this,arguments)}const JO="@firebase/messaging";function eT(){return tT.apply(this,arguments)}function tT(){return(tT=Pw(function*(){try{yield Kw()}catch{return!1}return"undefined"!=typeof window&&Yw()&&Qw()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})).apply(this,arguments)}rS(new Cb("messaging",e=>{const t=new $O(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>function(e,t){return XO.apply(this,arguments)}(t,e)),t},"PUBLIC")),rS(new Cb("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>function(e,t){return ZO.apply(this,arguments)}(t,e)}},"PRIVATE")),hS(JO,"0.9.16"),hS(JO,"0.9.16","esm2017");const nT="analytics",rT="firebase_id",iT="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",sT="https://www.googletagmanager.com/gtag/js",oT=new Ab("@firebase/analytics");function aT(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function lT(e,t){const n=document.createElement("script");n.src=`${sT}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function cT(e,t,n,r,i,s){return uT.apply(this,arguments)}function uT(){return(uT=Pw(function*(e,t,n,r,i,s){const o=r[i];try{if(o)yield t[o];else{const e=(yield aT(n)).find(e=>e.measurementId===i);e&&(yield t[e.appId])}}catch(a){oT.error(a)}e("config",i,s)})).apply(this,arguments)}function hT(e,t,n,r,i){return dT.apply(this,arguments)}function dT(){return(dT=Pw(function*(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=yield aT(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),yield Promise.all(s),e("event",r,i||{})}catch(s){oT.error(s)}})).apply(this,arguments)}function pT(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(sT))return t;return null}const fT=new Jw("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),gT=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function mT(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function yT(e){return vT.apply(this,arguments)}function vT(){return(vT=Pw(function*(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:mT(r)},s=iT.replace("{app-id}",n),o=yield fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=yield o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch{}throw fT.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()})).apply(this,arguments)}function _T(e){return CT.apply(this,arguments)}function CT(){return(CT=Pw(function*(e,t=gT,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw fT.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw fT.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new PT;return setTimeout(Pw(function*(){a.abort()}),void 0!==n?n:6e4),ET({appId:r,apiKey:i,measurementId:s},o,a,t)})).apply(this,arguments)}function ET(e,t,n){return wT.apply(this,arguments)}function wT(){return(wT=Pw(function*(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=gT){var s,o;const{appId:a,measurementId:l}=e;try{yield bT(r,t)}catch(c){if(l)return oT.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${l} provided in the "measurementId" field in the local Firebase config. [${null===(s=c)||void 0===s?void 0:s.message}]`),{appId:a,measurementId:l};throw c}try{const t=yield yT(e);return i.deleteThrottleMetadata(a),t}catch(c){const t=c;if(!ST(t)){if(i.deleteThrottleMetadata(a),l)return oT.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${l} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:a,measurementId:l};throw c}const s=503===Number(null===(o=null==t?void 0:t.customData)||void 0===o?void 0:o.httpStatus)?vb(n,i.intervalMillis,30):vb(n,i.intervalMillis),u={throttleEndTimeMillis:Date.now()+s,backoffCount:n+1};return i.setThrottleMetadata(a,u),oT.debug(`Calling attemptFetch again in ${s} millis`),ET(e,u,r,i)}})).apply(this,arguments)}function bT(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(fT.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function ST(e){if(!(e instanceof Xw&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class PT{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let OT,TT;function IT(){return(IT=Pw(function*(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=yield t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}})).apply(this,arguments)}function kT(e){TT=e}function AT(e){OT=e}function MT(){return NT.apply(this,arguments)}function NT(){return(NT=Pw(function*(){var e;if(!Yw())return oT.warn(fT.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield Kw()}catch(t){return oT.warn(fT.create("indexeddb-unavailable",{errorInfo:null===(e=t)||void 0===e?void 0:e.toString()}).message),!1}return!0})).apply(this,arguments)}function RT(){return(RT=Pw(function*(e,t,n,r,i,s,o){var a;const l=_T(e);l.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&oT.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>oT.error(e)),t.push(l);const c=MT().then(e=>{if(e)return r.getId()}),[u,h]=yield Promise.all([l,c]);pT()||lT(s,u.measurementId),TT&&(i("consent","default",TT),kT(void 0)),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d[rT]=h),i("config",u.measurementId,d),OT&&(i("set",OT),AT(void 0)),u.measurementId})).apply(this,arguments)}class xT{constructor(e){this.app=e}_delete(){return delete DT[this.app.options.appId],Promise.resolve()}}let DT={},LT=[];const FT={};let UT,BT,VT="dataLayer",$T=!1;function zT(e,t,n){!function(){const e=[];if(qw()&&e.push("This is a browser extension environment."),Qw()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=fT.create("invalid-analytics-context",{errorInfo:t});oT.warn(n.message)}}();const r=e.options.appId;if(!r)throw fT.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw fT.create("no-api-key");oT.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=DT[r])throw fT.create("already-exists",{id:r});if(!$T){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(VT);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){function i(){return(i=Pw(function*(i,s,o){try{"event"===i?yield hT(e,t,n,s,o):"config"===i?yield cT(e,t,n,r,s,o):"consent"===i?e("consent","update",o):e("set",s)}catch(a){oT.error(a)}})).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(DT,LT,FT,VT,"gtag");BT=e,UT=t,$T=!0}return DT[r]=function(e,t,n,r,i,s,o){return RT.apply(this,arguments)}(e,LT,FT,t,UT,VT,n),new xT(e)}function HT(){return GT.apply(this,arguments)}function GT(){return(GT=Pw(function*(){if(qw()||!Qw()||!Yw())return!1;try{return yield Kw()}catch{return!1}})).apply(this,arguments)}const WT="@firebase/analytics";rS(new Cb(nT,(e,{options:t})=>zT(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),rS(new Cb("analytics-internal",function(e){try{const t=e.getProvider(nT).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=_b(e),function(e,t,n,r,i){return IT.apply(this,arguments)}(BT,DT[e.app.options.appId],t,n,r).catch(e=>oT.error(e))}(t,e,n,r)}}catch(t){throw fT.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),hS(WT,"0.8.0"),hS(WT,"0.8.0","esm2017");class qT extends a{constructor(e,t){super()}schedule(e,t=0){return this}}const jT={setInterval(...e){const{delegate:t}=jT;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=jT;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0};class ZT extends qT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return jT.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;jT.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,o(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const YT={now:()=>(YT.delegate||Date).now(),delegate:void 0};class KT{constructor(e,t=KT.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}KT.now=YT.now;class QT extends KT{constructor(e,t=KT.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}const XT=new class extends QT{}(class extends ZT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!=n&&n>0||null==n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}),JT=new QT(ZT),eI=new kc("7.4.1"),tI="__angularfire_symbol__analyticsIsSupportedValue",nI="__angularfire_symbol__analyticsIsSupported",rI="__angularfire_symbol__remoteConfigIsSupportedValue",iI="__angularfire_symbol__remoteConfigIsSupported",sI="__angularfire_symbol__messagingIsSupportedValue",oI="__angularfire_symbol__messagingIsSupported";function aI(e,t,n){if(t){if(1===t.length)return t[0];const e=t.filter(e=>e.app===n);if(1===e.length)return e[0]}return n.container.getProvider(e).getImmediate({optional:!0})}globalThis[nI]||(globalThis[nI]=HT().then(e=>globalThis[tI]=e).catch(()=>globalThis[tI]=!1)),globalThis[oI]||(globalThis[oI]=eT().then(e=>globalThis[sI]=e).catch(()=>globalThis[sI]=!1)),globalThis[iI]||(globalThis[iI]=zP().then(e=>globalThis[rI]=e).catch(()=>globalThis[rI]=!1));const lI=(e,t)=>{const n=t?[t]:uS(),r=[];return n.forEach(t=>{t.container.getProvider(e).instances.forEach(e=>{r.includes(e)||r.push(e)})}),r};function cI(){}class uI{constructor(e,t=XT){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class hI{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",cI,{},cI,cI)),t.pipe(Fm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let dI=(()=>{class e{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new uI(Zone.current)),this.insideAngular=e.run(()=>new uI(Zone.current,JT)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return e.\u0275fac=function(t){return new(t||e)(Or(vh))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function pI(){const e=globalThis.\u0275AngularFireScheduler;if(!e)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return e}function fI(e){return pI().ngZone.runOutsideAngular(()=>e())}function gI(e){return pI().ngZone.run(()=>e())}function mI(e){return pI(),function(e){return function(t){return(t=t.lift(new hI(e.ngZone))).pipe(se(e.outsideAngular),ie(e.insideAngular))}}(pI())(e)}const yI=(e,t)=>{const n=void 0;return function(){const r=arguments;return t&&setTimeout(()=>{"scheduled"===t.state&&t.invoke()},10),gI(()=>e.apply(n,r))}},vI=(e,t)=>function(){let n;const r=arguments;for(let e=0;e<arguments.length;e++)"function"==typeof r[e]&&(t&&(n||(n=gI(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",cI,{},cI,cI)))),r[e]=yI(r[e],n));const i=fI(()=>e.apply(this,r));if(!t){if(i instanceof T){const e=pI();return i.pipe(se(e.outsideAngular),ie(e.insideAngular))}return gI(()=>i)}return i instanceof T?i.pipe(mI):i instanceof Promise?gI(()=>new Promise((e,t)=>i.then(t=>gI(()=>e(t)),e=>gI(()=>t(e))))):"function"==typeof i&&n?function(){return setTimeout(()=>{n&&"scheduled"===n.state&&n.invoke()},10),i.apply(this,arguments)}:gI(()=>i)};class _I{constructor(e){return e}}class CI{constructor(){return uS()}}const EI=new or("angularfire2._apps"),wI={provide:_I,useFactory:function(e){return e&&1===e.length?e[0]:new _I(cS())},deps:[[new Nr,EI]]},bI={provide:CI,deps:[[new Nr,EI]]};function SI(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new _I(r)}}let PI=(()=>{class e{constructor(e){hS("angularfire",eI.full,"core"),hS("angularfire",eI.full,"app"),hS("angular",Ac.full,e.toString())}}return e.\u0275fac=function(t){return new(t||e)(Or(rh))},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[wI,bI]}),e})();const OI=vI(lS,!0),TI=new Map,II={activated:!1,tokenObservers:[]},kI={initialized:!1,enabled:!1};function AI(e){return TI.get(e)||II}function MI(e,t){TI.set(e,t)}function NI(){return kI}class RI{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return Pw(function*(){t.stop();try{t.pending=new zw,yield function(e){return new Promise(t=>{setTimeout(t,e)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new zw,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(n){t.retryPolicy(n)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const xI=new Jw("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function DI(e){if(!AI(e).activated)throw xI.create("use-before-activation",{appName:e.name})}function LI(e,t){return FI.apply(this,arguments)}function FI(){return(FI=Pw(function*({url:e,body:t},n){var r,i;const s={"Content-Type":"application/json"},o=n.getImmediate({optional:!0});if(o){const e=yield o.getHeartbeatsHeader();e&&(s["X-Firebase-Client"]=e)}const a={method:"POST",body:JSON.stringify(t),headers:s};let l,c;try{l=yield fetch(e,a)}catch(p){throw xI.create("fetch-network-error",{originalErrorMessage:null===(r=p)||void 0===r?void 0:r.message})}if(200!==l.status)throw xI.create("fetch-status-error",{httpStatus:l.status});try{c=yield l.json()}catch(p){throw xI.create("fetch-parse-error",{originalErrorMessage:null===(i=p)||void 0===i?void 0:i.message})}const u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw xI.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});const h=1e3*Number(u[1]),d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})).apply(this,arguments)}function UI(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${n}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:t}}}const BI="firebase-app-check-store";let VI=null;function $I(){return VI||(VI=new Promise((e,t)=>{var n;try{const n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(xI.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(BI,{keyPath:"compositeKey"})}}}catch(r){t(xI.create("storage-open",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message}))}}),VI)}function zI(){return(zI=Pw(function*(e,t){const n=(yield $I()).transaction(BI,"readwrite"),r=n.objectStore(BI).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(xI.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})})).apply(this,arguments)}const HI=new Ab("@firebase/app-check");function GI(e,t){return Yw()?function(e,t){return function(e,t){return zI.apply(this,arguments)}(function(e){return`${e.options.appId}-${e.name}`}(e),t)}(e,t).catch(e=>{HI.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function WI(){return NI().enabled}function qI(){return jI.apply(this,arguments)}function jI(){return(jI=Pw(function*(){const e=NI();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const ZI={error:"UNKNOWN_ERROR"};function YI(e){return Dw.encodeString(JSON.stringify(e),!1)}function KI(e){return QI.apply(this,arguments)}function QI(){return(QI=Pw(function*(e,t=!1){const n=e.app;DI(n);const r=AI(n);let i,s=r.token;if(!s){const e=yield r.cachedTokenPromise;e&&tk(e)&&(s=e)}if(!t&&s&&tk(s))return{token:s.token};let o,a=!1;if(WI()){r.exchangeTokenPromise||(r.exchangeTokenPromise=LI(UI(n,yield qI()),e.heartbeatServiceProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);const t=yield r.exchangeTokenPromise;return yield GI(n,t),MI(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),s=yield r.exchangeTokenPromise}catch(l){"appCheck/throttled"===l.code?HI.warn(l.message):HI.error(l),i=l}return s?(o={token:s.token},MI(n,Object.assign(Object.assign({},r),{token:s})),yield GI(n,s)):o=nk(i),a&&ek(n,o),o})).apply(this,arguments)}function XI(e,t){const n=AI(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),MI(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function JI(e){const{app:t}=e,n=AI(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new RI(Pw(function*(){let n;if(n=AI(t).token?yield KI(e,!0):yield KI(e),n.error)throw n.error}),()=>!0,()=>{const e=AI(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return t=Math.min(t,e.token.expireTimeMillis-3e5),Math.max(0,t-Date.now())}return 0},3e4,96e4)}(e),MI(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function ek(e,t){const n=AI(e).tokenObservers;for(const r of n)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch{}}function tk(e){return e.expireTimeMillis-Date.now()>0}function nk(e){return{token:YI(ZI),error:e}}class rk{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=AI(this.app);for(const t of e)XI(this.app,t.next);return Promise.resolve()}}const ik="app-check-internal";rS(new Cb("app-check",e=>function(e,t){return new rk(e,t)}(e.getProvider("app").getImmediate(),e.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(ik).initialize()})),rS(new Cb(ik,e=>function(e){return{getToken:t=>KI(e,t),addTokenListener:t=>function(e,t,n,r){const{app:i}=e,s=AI(i),o={next:n,error:r,type:t};if(MI(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&tk(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),JI(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>JI(e))}(e,"INTERNAL",t),removeTokenListener:t=>XI(e.app,t)}}(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),hS("@firebase/app-check","0.5.11");class sk{constructor(){return lI("app-check")}}"undefined"!=typeof window&&window;const ok=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ak=new Jw("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),lk=new Ab("@firebase/auth");function ck(e,...t){lk.logLevel<=Pb.ERROR&&lk.error(`Auth (9.9.0): ${e}`,...t)}function uk(e,...t){throw fk(e,...t)}function hk(e,...t){return fk(e,...t)}function dk(e,t,n){const r=Object.assign(Object.assign({},ok()),{[t]:n});return new Jw("auth","Firebase",r).create(t,{appName:e.name})}function pk(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&uk(e,"argument-error"),dk(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fk(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return ak.create(e,...t)}function gk(e,t,...n){if(!e)throw fk(t,...n)}function mk(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ck(t),new Error(t)}function yk(e,t){e||mk(t)}const vk=new Map;function _k(e){yk(e instanceof Function,"Expected a class definition");let t=vk.get(e);return t?(yk(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,vk.set(e,t),t)}function Ck(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ek(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class wk{constructor(e,t){this.shortDelay=e,this.longDelay=t,yk(t>e,"Short delay should be less than long delay!"),this.isMobile=Ww()||jw()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ek()||"https:"===Ek()||qw()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function bk(e,t){yk(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Sk{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void mk("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void mk("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void mk("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Pk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ok=new wk(3e4,6e4);function Tk(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function Ik(e,t,n,r){return kk.apply(this,arguments)}function kk(){return(kk=Pw(function*(e,t,n,r,i={}){return Ak(e,i,Pw(function*(){let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=ub(Object.assign({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Sk.fetch()(xk(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))})).apply(this,arguments)}function Ak(e,t,n){return Mk.apply(this,arguments)}function Mk(){return(Mk=Pw(function*(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Pk),t);try{const t=new Dk(e),i=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield i.json();if("needConfirmation"in s)throw Lk(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Lk(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Lk(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Lk(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw dk(e,a,o);uk(e,a)}}catch(i){if(i instanceof Xw)throw i;uk(e,"network-request-failed")}})).apply(this,arguments)}function Nk(e,t,n,r){return Rk.apply(this,arguments)}function Rk(){return(Rk=Pw(function*(e,t,n,r,i={}){const s=yield Ik(e,t,n,r,i);return"mfaPendingCredential"in s&&uk(e,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function xk(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?bk(e.config,i):`${e.config.apiScheme}://${i}`}class Dk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(hk(this.auth,"network-request-failed")),Ok.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Lk(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=hk(e,t,r);return i.customData._tokenResponse=n,i}function Fk(){return(Fk=Pw(function*(e,t){return Ik(e,"POST","/v1/accounts:delete",t)})).apply(this,arguments)}function Uk(e,t){return Bk.apply(this,arguments)}function Bk(){return(Bk=Pw(function*(e,t){return Ik(e,"POST","/v1/accounts:lookup",t)})).apply(this,arguments)}function Vk(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function $k(){return($k=Pw(function*(e,t=!1){const n=_b(e),r=yield n.getIdToken(t),i=Hk(r);gk(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Vk(zk(i.auth_time)),issuedAtTime:Vk(zk(i.iat)),expirationTime:Vk(zk(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function zk(e){return 1e3*Number(e)}function Hk(e){var t;const[n,r,i]=e.split(".");if(void 0===n||void 0===r||void 0===i)return ck("JWT malformed, contained fewer than 3 sections"),null;try{const e=Uw(r);return e?JSON.parse(e):(ck("Failed to decode base64 JWT payload"),null)}catch(s){return ck("Caught error parsing JWT payload as JSON",null===(t=s)||void 0===t?void 0:t.toString()),null}}function Gk(e,t){return Wk.apply(this,arguments)}function Wk(){return(Wk=Pw(function*(e,t,n=!1){if(n)return t;try{return yield t}catch(r){throw r instanceof Xw&&qk(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})).apply(this,arguments)}function qk({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class jk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(Pw(function*(){yield t.iteration()}),n)}iteration(){var e=this;return Pw(function*(){var t;try{yield e.user.getIdToken(!0)}catch(n){return void("auth/network-request-failed"===(null===(t=n)||void 0===t?void 0:t.code)&&e.schedule(!0))}e.schedule()})()}}class Zk{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vk(this.lastLoginAt),this.creationTime=Vk(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Yk(e){return Kk.apply(this,arguments)}function Kk(){return(Kk=Pw(function*(e){var t;const n=e.auth,r=yield e.getIdToken(),i=yield Gk(e,Uk(n,{idToken:r}));gk(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?Jk(s.providerUserInfo):[],a=Xk(e.providerData,o),l=!!e.isAnonymous&&!(e.email&&s.passwordHash||(null==a?void 0:a.length)),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Zk(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,c)})).apply(this,arguments)}function Qk(){return(Qk=Pw(function*(e){const t=_b(e);yield Yk(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})).apply(this,arguments)}function Xk(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function Jk(e){return e.map(e=>{var{providerId:t}=e,n=L(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}function eA(){return(eA=Pw(function*(e,t){const n=yield Ak(e,{},Pw(function*(){const n=ub({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=xk(e,r,"/v1/token",`key=${i}`),o=yield e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Sk.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})).apply(this,arguments)}class tA{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){gk(e.idToken,"internal-error"),gk(void 0!==e.idToken,"internal-error"),gk(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Hk(e);return gk(t,"internal-error"),gk(void 0!==t.exp,"internal-error"),gk(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return Pw(function*(){return gk(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return Pw(function*(){const{accessToken:r,refreshToken:i,expiresIn:s}=yield function(e,t){return eA.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(r,i,Number(s))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new tA;return n&&(gk("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(gk("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(gk("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tA,this.toJSON())}_performRefresh(){return mk("not implemented")}}function nA(e,t){gk("string"==typeof e||void 0===e,"internal-error",{appName:t})}class rA{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=L(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new jk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Zk(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){var t=this;return Pw(function*(){const n=yield Gk(t,t.stsTokenManager.getToken(t.auth,e));return gk(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function(e){return $k.apply(this,arguments)}(this,e)}reload(){return function(e){return Qk.apply(this,arguments)}(this)}_assign(e){this!==e&&(gk(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new rA(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){gk(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return Pw(function*(){let r=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Yk(n)),yield n.auth._persistUserIfCurrent(n),r&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return Pw(function*(){const t=yield e.getIdToken();return yield Gk(e,function(e,t){return Fk.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:_,isAnonymous:C,providerData:E,stsTokenManager:w}=t;gk(v&&w,e,"internal-error");const b=tA.fromJSON(this.name,w);gk("string"==typeof v,e,"internal-error"),nA(u,e.name),nA(h,e.name),gk("boolean"==typeof _,e,"internal-error"),gk("boolean"==typeof C,e,"internal-error"),nA(d,e.name),nA(p,e.name),nA(f,e.name),nA(g,e.name),nA(m,e.name),nA(y,e.name);const S=new rA({uid:v,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:C,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:b,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(S.providerData=E.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static _fromIdTokenResponse(e,t,n=!1){return Pw(function*(){const r=new tA;r.updateFromServerResponse(t);const i=new rA({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return yield Yk(i),i})()}}const iA=(()=>{class e{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return Pw(function*(){return!0})()}_set(e,t){var n=this;return Pw(function*(){n.storage[e]=t})()}_get(e){var t=this;return Pw(function*(){const n=t.storage[e];return void 0===n?null:n})()}_remove(e){var t=this;return Pw(function*(){delete t.storage[e]})()}_addListener(e,t){}_removeListener(e,t){}}return e.type="NONE",e})();function sA(e,t,n){return`firebase:${e}:${t}:${n}`}class oA{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=sA(this.userKey,r.apiKey,i),this.fullPersistenceKey=sA("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return Pw(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?rA._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return Pw(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return Pw(function*(){if(!t.length)return new oA(_k(iA),e,n);const r=(yield Promise.all(t.map(function(){var e=Pw(function*(e){if(yield e._isAvailable())return e});return function(t){return e.apply(this,arguments)}}()))).filter(e=>e);let i=r[0]||_k(iA);const s=sA(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){const r=rA._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&(yield i._set(s,o.toJSON())),yield Promise.all(t.map(function(){var e=Pw(function*(e){if(e!==i)try{yield e._remove(s)}catch{}});return function(t){return e.apply(this,arguments)}}())),new oA(i,e,n)):new oA(i,e,n)})()}}function aA(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(hA(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(lA(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(pA(t))return"Blackberry";if(fA(t))return"Webos";if(cA(t))return"Safari";if((t.includes("chrome/")||uA(t))&&!t.includes("edge/"))return"Chrome";if(dA(t))return"Android";{const t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==t?void 0:t.length))return t[1]}return"Other"}function lA(e=Gw()){return/firefox\//i.test(e)}function cA(e=Gw()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function uA(e=Gw()){return/crios\//i.test(e)}function hA(e=Gw()){return/iemobile/i.test(e)}function dA(e=Gw()){return/android/i.test(e)}function pA(e=Gw()){return/blackberry/i.test(e)}function fA(e=Gw()){return/webos/i.test(e)}function gA(e=Gw()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function mA(e=Gw()){return gA(e)||dA(e)||fA(e)||pA(e)||/windows phone/i.test(e)||hA(e)}function yA(e,t=[]){let n;switch(e){case"Browser":n=aA(Gw());break;case"Worker":n=`${aA(Gw())}-${e}`;break;default:n=e}return`${n}/JsCore/9.9.0/${t.length?t.join(","):"FirebaseCore-web"}`}class vA{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return Pw(function*(){var n;if(t.auth.currentUser===e)return;const r=[];try{for(const n of t.queue)yield n(e),n.onAbort&&r.push(n.onAbort)}catch(i){r.reverse();for(const e of r)try{e()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:null===(n=i)||void 0===n?void 0:n.message})}})()}}class _A{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new EA(this),this.idTokenSubscription=new EA(this),this.beforeStateQueue=new vA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ak,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=_k(t)),this._initializationPromise=this.queue(Pw(function*(){var r,i;if(!n._deleted&&(n.persistenceManager=yield oA.create(n,e),!n._deleted)){if(null===(r=n._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(i=n.currentUser)||void 0===i?void 0:i.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return Pw(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUser(e){var t=this;return Pw(function*(){var n;const r=yield t.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const r=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,o=null==i?void 0:i._redirectEventId,a=yield t.tryRedirectSignIn(e);(!r||r===o)&&(null==a?void 0:a.user)&&(i=a.user,s=!0)}if(!i)return t.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield t.beforeStateQueue.runMiddleware(i)}catch(o){i=r,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(o))}return i?t.reloadAndSetCurrentUserOrClear(i):t.directlySetCurrentUser(null)}return gk(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===i._redirectEventId?t.directlySetCurrentUser(i):t.reloadAndSetCurrentUserOrClear(i)})()}tryRedirectSignIn(e){var t=this;return Pw(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return Pw(function*(){var n;try{yield Yk(e)}catch(r){if("auth/network-request-failed"!==(null===(n=r)||void 0===n?void 0:n.code))return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){var e=this;return Pw(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return Pw(function*(){const n=e?_b(e):null;return n&&gk(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e,t=!1){var n=this;return Pw(function*(){if(!n._deleted)return e&&gk(n.tenantId===e.tenantId,n,"tenant-id-mismatch"),t||(yield n.beforeStateQueue.runMiddleware(e)),n.queue(Pw(function*(){yield n.directlySetCurrentUser(e),n.notifyAuthListeners()}))})()}signOut(){var e=this;return Pw(function*(){return yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0)})()}setPersistence(e){var t=this;return this.queue(Pw(function*(){yield t.assertedPersistence.setPersistence(_k(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Jw("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return Pw(function*(){const r=yield n.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return Pw(function*(){if(!t.redirectPersistenceManager){const n=e&&_k(e)||t._popupRedirectResolver;gk(n,t,"argument-error"),t.redirectPersistenceManager=yield oA.create(t,[_k(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return Pw(function*(){var n,r;return t._isInitialized&&(yield t.queue(Pw(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return Pw(function*(){if(e===t.currentUser)return t.queue(Pw(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return gk(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return Pw(function*(){t.currentUser&&t.currentUser!==e&&(t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh()),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return gk(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return Pw(function*(){var t;const n={"X-Client-Version":e.clientVersion};e.app.options.appId&&(n["X-Firebase-gmpid"]=e.app.options.appId);const r=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();return r&&(n["X-Firebase-Client"]=r),n})()}}function CA(e){return _b(e)}class EA{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new fb(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return gk(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function wA(e,t,n){const r=CA(e);gk(r._canInitEmulator,r,"emulator-config-failed"),gk(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=bA(t),{host:o,port:a}=function(e){const t=bA(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:SA(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:SA(t)}}}(t);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function bA(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function SA(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class PA{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mk("not implemented")}_getIdTokenResponse(e){return mk("not implemented")}_linkToIdToken(e,t){return mk("not implemented")}_getReauthenticationResolver(e){return mk("not implemented")}}function OA(){return(OA=Pw(function*(e,t){return Ik(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function TA(){return(TA=Pw(function*(e,t){return Nk(e,"POST","/v1/accounts:signInWithPassword",Tk(e,t))})).apply(this,arguments)}function IA(e,t){return kA.apply(this,arguments)}function kA(){return(kA=Pw(function*(e,t){return Ik(e,"POST","/v1/accounts:sendOobCode",Tk(e,t))})).apply(this,arguments)}function AA(e,t){return MA.apply(this,arguments)}function MA(){return(MA=Pw(function*(e,t){return IA(e,t)})).apply(this,arguments)}function NA(e,t){return RA.apply(this,arguments)}function RA(){return(RA=Pw(function*(e,t){return IA(e,t)})).apply(this,arguments)}function xA(){return(xA=Pw(function*(e,t){return Nk(e,"POST","/v1/accounts:signInWithEmailLink",Tk(e,t))})).apply(this,arguments)}function DA(){return(DA=Pw(function*(e,t){return Nk(e,"POST","/v1/accounts:signInWithEmailLink",Tk(e,t))})).apply(this,arguments)}class LA extends PA{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new LA(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new LA(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return Pw(function*(){switch(t.signInMethod){case"password":return function(e,t){return TA.apply(this,arguments)}(e,{returnSecureToken:!0,email:t._email,password:t._password});case"emailLink":return function(e,t){return xA.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:uk(e,"internal-error")}})()}_linkToIdToken(e,t){var n=this;return Pw(function*(){switch(n.signInMethod){case"password":return function(e,t){return OA.apply(this,arguments)}(e,{idToken:t,returnSecureToken:!0,email:n._email,password:n._password});case"emailLink":return function(e,t){return DA.apply(this,arguments)}(e,{idToken:t,email:n._email,oobCode:n._password});default:uk(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function FA(e,t){return UA.apply(this,arguments)}function UA(){return(UA=Pw(function*(e,t){return Nk(e,"POST","/v1/accounts:signInWithIdp",Tk(e,t))})).apply(this,arguments)}class BA extends PA{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new BA(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):uk("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=L(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new BA(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return FA(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,FA(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,FA(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ub(t)}return e}}class VA{constructor(e){var t,n,r,i,s,o;const a=hb(db(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);gk(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=hb(db(e)).link,n=t?hb(db(t)).deep_link_id:null,r=hb(db(e)).deep_link_id;return(r?hb(db(r)).link:null)||r||n||t||e}(e);try{return new VA(t)}catch{return null}}}let $A=(()=>{class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return LA._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=VA.parseLink(t);return gk(n,"argument-error"),LA._fromEmailAndCode(e,n.code,n.tenantId)}}return e.PROVIDER_ID="password",e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e.EMAIL_LINK_SIGN_IN_METHOD="emailLink",e})();class zA{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class HA extends zA{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}let GA=(()=>{class e extends HA{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return BA._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}}return e.GOOGLE_SIGN_IN_METHOD="google.com",e.PROVIDER_ID="google.com",e})();function WA(e,t){return qA.apply(this,arguments)}function qA(){return(qA=Pw(function*(e,t){return Nk(e,"POST","/v1/accounts:signUp",Tk(e,t))})).apply(this,arguments)}class jA{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,r=!1){return Pw(function*(){const i=yield rA._fromIdTokenResponse(e,n,r),s=ZA(n);return new jA({user:i,providerId:s,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return Pw(function*(){yield e._updateTokensIfNecessary(n,!0);const r=ZA(n);return new jA({user:e,providerId:r,_tokenResponse:n,operationType:t})})()}}function ZA(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class YA extends Xw{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,YA.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new YA(e,t,n,r)}}function KA(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw"auth/multi-factor-auth-required"===n.code?YA._fromErrorAndOperation(e,n,t,r):n})}function QA(e,t){return XA.apply(this,arguments)}function XA(){return(XA=Pw(function*(e,t,n=!1){const r=yield Gk(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return jA._forOperation(e,"link",r)})).apply(this,arguments)}function JA(){return(JA=Pw(function*(e,t,n=!1){var r;const{auth:i}=e,s="reauthenticate";try{const r=yield Gk(e,KA(i,s,t,e),n);gk(r.idToken,i,"internal-error");const o=Hk(r.idToken);gk(o,i,"internal-error");const{sub:a}=o;return gk(e.uid===a,i,"user-mismatch"),jA._forOperation(e,s,r)}catch(o){throw"auth/user-not-found"===(null===(r=o)||void 0===r?void 0:r.code)&&uk(i,"user-mismatch"),o}})).apply(this,arguments)}function eM(e,t){return tM.apply(this,arguments)}function tM(){return(tM=Pw(function*(e,t,n=!1){const r="signIn",i=yield KA(e,r,t),s=yield jA._fromIdTokenResponse(e,r,i);return n||(yield e._updateCurrentUser(s.user)),s})).apply(this,arguments)}function nM(){return(nM=Pw(function*(e,t){return eM(CA(e),t)})).apply(this,arguments)}function rM(e,t,n){var r;gk((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),gk(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(gk(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(gk(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}function iM(e,t,n){return sM.apply(this,arguments)}function sM(){return(sM=Pw(function*(e,t,n){const r=_b(e),i={requestType:"PASSWORD_RESET",email:t};n&&rM(r,i,n),yield NA(r,i)})).apply(this,arguments)}function oM(e,t,n){return aM.apply(this,arguments)}function aM(){return(aM=Pw(function*(e,t,n){const r=CA(e),i=yield WA(r,{returnSecureToken:!0,email:t,password:n}),s=yield jA._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(s.user),s})).apply(this,arguments)}function lM(e,t,n){return function(e,t){return nM.apply(this,arguments)}(_b(e),$A.credential(t,n))}function cM(e,t){return uM.apply(this,arguments)}function uM(){return(uM=Pw(function*(e,t){const n=_b(e),r={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&rM(n.auth,r,t);const{email:i}=yield AA(n.auth,r);i!==e.email&&(yield e.reload())})).apply(this,arguments)}function hM(e,t){return dM.apply(this,arguments)}function dM(){return(dM=Pw(function*(e,t){return Ik(e,"POST","/v1/accounts:update",t)})).apply(this,arguments)}function pM(e,t){return fM.apply(this,arguments)}function fM(){return(fM=Pw(function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=_b(e),i={idToken:yield r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield Gk(r,hM(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),yield r._updateTokensIfNecessary(s)})).apply(this,arguments)}function gM(e,t,n,r){return _b(e).onAuthStateChanged(t,n,r)}new WeakMap;const mM="__sak";class yM{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(mM,"1"),this.storage.removeItem(mM),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const vM=(()=>{class e extends yM{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Gw();return cA(e)||gA(e)}()&&function(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=mA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Zw()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){var n=()=>super._set,r=this;return Pw(function*(){yield n().call(r,e,t),r.localCache[e]=JSON.stringify(t)})()}_get(e){var t=()=>super._get,n=this;return Pw(function*(){const r=yield t().call(n,e);return n.localCache[e]=JSON.stringify(r),r})()}_remove(e){var t=()=>super._remove,n=this;return Pw(function*(){yield t().call(n,e),delete n.localCache[e]})()}}return e.type="LOCAL",e})(),_M=(()=>{class e extends yM{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}return e.type="SESSION",e})();let CM=(()=>{class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;const r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){var t=this;return Pw(function*(){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=t.handlersMap[i];if(!(null==o?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(function(){var e=Pw(function*(e){return e(n.origin,s)});return function(t){return e.apply(this,arguments)}}()),l=yield function(e){return Promise.all(e.map(function(){var e=Pw(function*(e){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}});return function(t){return e.apply(this,arguments)}}()))}(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})})()}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||0===this.handlersMap[e].size)&&delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return e.receivers=[],e})();function EM(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}class wM{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){var r=this;return Pw(function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=EM("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(t.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"))}}},r.handlers.add(o),i.port1.addEventListener("message",o.onMessage),r.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&r.removeMessageHandler(o)})})()}}function bM(){return window}function SM(){return void 0!==bM().WorkerGlobalScope&&"function"==typeof bM().importScripts}function PM(){return(PM=Pw(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const OM="firebaseLocalStorageDb",TM="firebaseLocalStorage",IM="fbase_key";class kM{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function AM(e,t){return e.transaction([TM],t?"readwrite":"readonly").objectStore(TM)}function MM(){const e=indexedDB.open(OM,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(TM,{keyPath:IM})}catch(r){n(r)}}),e.addEventListener("success",Pw(function*(){const n=e.result;n.objectStoreNames.contains(TM)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(OM);return new kM(e).toPromise()}(),t(yield MM()))}))})}function NM(e,t,n){return RM.apply(this,arguments)}function RM(){return(RM=Pw(function*(e,t,n){const r=AM(e,!0).put({[IM]:t,value:n});return new kM(r).toPromise()})).apply(this,arguments)}function xM(){return(xM=Pw(function*(e,t){const n=AM(e,!1).get(t),r=yield new kM(n).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function DM(e,t){const n=AM(e,!0).delete(t);return new kM(n).toPromise()}const LM=(()=>{class e{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var e=this;return Pw(function*(){return e.db||(e.db=yield MM()),e.db})()}_withRetries(e){var t=this;return Pw(function*(){let n=0;for(;;)try{const n=yield t._openDb();return yield e(n)}catch(r){if(n++>3)throw r;t.db&&(t.db.close(),t.db=void 0)}})()}initializeServiceWorkerMessaging(){var e=this;return Pw(function*(){return SM()?e.initializeReceiver():e.initializeSender()})()}initializeReceiver(){var e=this;return Pw(function*(){e.receiver=CM._getInstance(SM()?self:null),e.receiver._subscribe("keyChanged",function(){var t=Pw(function*(t,n){return{keyProcessed:(yield e._poll()).includes(n.key)}});return function(e,n){return t.apply(this,arguments)}}()),e.receiver._subscribe("ping",function(){var e=Pw(function*(e,t){return["keyChanged"]});return function(t,n){return e.apply(this,arguments)}}())})()}initializeSender(){var e=this;return Pw(function*(){var t,n;if(e.activeServiceWorker=yield function(){return PM.apply(this,arguments)}(),!e.activeServiceWorker)return;e.sender=new wM(e.activeServiceWorker);const r=yield e.sender._send("ping",{},800);!r||(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(e.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(e){var t=this;return Pw(function*(){if(t.sender&&t.activeServiceWorker&&function(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===t.activeServiceWorker)try{yield t.sender._send("keyChanged",{key:e},t.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return Pw(function*(){try{if(!indexedDB)return!1;const e=yield MM();return yield NM(e,mM,"1"),yield DM(e,mM),!0}catch{}return!1})()}_withPendingWrite(e){var t=this;return Pw(function*(){t.pendingWrites++;try{yield e()}finally{t.pendingWrites--}})()}_set(e,t){var n=this;return Pw(function*(){return n._withPendingWrite(Pw(function*(){return yield n._withRetries(n=>NM(n,e,t)),n.localCache[e]=t,n.notifyServiceWorker(e)}))})()}_get(e){var t=this;return Pw(function*(){const n=yield t._withRetries(t=>function(e,t){return xM.apply(this,arguments)}(t,e));return t.localCache[e]=n,n})()}_remove(e){var t=this;return Pw(function*(){return t._withPendingWrite(Pw(function*(){return yield t._withRetries(t=>DM(t,e)),delete t.localCache[e],t.notifyServiceWorker(e)}))})()}_poll(){var e=this;return Pw(function*(){const t=yield e._withRetries(e=>{const t=AM(e,!1).getAll();return new kM(t).toPromise()});if(!t)return[];if(0!==e.pendingWrites)return[];const n=[],r=new Set;for(const{fbase_key:i,value:s}of t)r.add(i),JSON.stringify(e.localCache[i])!==JSON.stringify(s)&&(e.notifyListeners(i,s),n.push(i));for(const i of Object.keys(e.localCache))e.localCache[i]&&!r.has(i)&&(e.notifyListeners(i,null),n.push(i));return n})()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){var e=this;this.stopPolling(),this.pollTimer=setInterval(Pw(function*(){return e._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return e.type="LOCAL",e})();function FM(e){return`__${e}${Math.floor(1e6*Math.random())}`}function UM(e,t){return t?_k(t):(gk(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}FM("rcb"),new wk(3e4,6e4);class BM extends PA{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return FA(e,this._buildIdpRequest())}_linkToIdToken(e,t){return FA(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return FA(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function VM(e){return eM(e.auth,new BM(e),e.bypassAuthState)}function $M(e){const{auth:t,user:n}=e;return gk(n,t,"internal-error"),function(e,t){return JA.apply(this,arguments)}(n,new BM(e),e.bypassAuthState)}function zM(e){return HM.apply(this,arguments)}function HM(){return(HM=Pw(function*(e){const{auth:t,user:n}=e;return gk(n,t,"internal-error"),QA(n,new BM(e),e.bypassAuthState)})).apply(this,arguments)}class GM{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=Pw(function*(t,n){e.pendingPromise={resolve:t,reject:n};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(r){e.reject(r)}});return function(e,n){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return Pw(function*(){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o)return void t.reject(o);const l={auth:t.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(a)(l))}catch(c){t.reject(c)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return VM;case"linkViaPopup":case"linkViaRedirect":return zM;case"reauthViaPopup":case"reauthViaRedirect":return $M;default:uk(this.auth,"internal-error")}}resolve(e){yk(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yk(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const WM=new wk(2e3,1e4);function qM(e,t,n){return jM.apply(this,arguments)}function jM(){return(jM=Pw(function*(e,t,n){const r=CA(e);pk(e,t,zA);const i=UM(r,n);return new ZM(r,"signInViaPopup",t,i).executeNotNull()})).apply(this,arguments)}let ZM=(()=>{class e extends GM{constructor(t,n,r,i,s){super(t,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}executeNotNull(){var e=this;return Pw(function*(){const t=yield e.execute();return gk(t,e.auth,"internal-error"),t})()}onExecution(){var e=this;return Pw(function*(){yk(1===e.filter.length,"Popup operations only handle one event");const t=EM();e.authWindow=yield e.resolver._openPopup(e.auth,e.provider,e.filter[0],t),e.authWindow.associatedEvent=t,e.resolver._originValidation(e.auth).catch(t=>{e.reject(t)}),e.resolver._isIframeWebStorageSupported(e.auth,t=>{t||e.reject(hk(e.auth,"web-storage-unsupported"))}),e.pollUserCancellation()})()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(hk(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;this.pollId=(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(hk(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(e,WM.get())};e()}}return e.currentPopupAction=null,e})();const YM=new Map;class KM extends GM{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){var e=()=>super.execute,t=this;return Pw(function*(){let n=YM.get(t.auth._key());if(!n){try{const r=(yield function(e,t){return QM.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;n=()=>Promise.resolve(r)}catch(r){n=()=>Promise.reject(r)}YM.set(t.auth._key(),n)}return t.bypassAuthState||YM.set(t.auth._key(),()=>Promise.resolve(null)),n()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,n=this;return Pw(function*(){if("signInViaRedirect"===e.type)return t().call(n,e);if("unknown"!==e.type){if(e.eventId){const r=yield n.auth._redirectUserForId(e.eventId);if(r)return n.user=r,t().call(n,e);n.resolve(null)}}else n.resolve(null)})()}onExecution(){return Pw(function*(){})()}cleanUp(){}}function QM(){return(QM=Pw(function*(e,t){const n=eN(t),r=JM(e);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(n));return yield r._remove(n),i})).apply(this,arguments)}function XM(e,t){YM.set(e._key(),t)}function JM(e){return _k(e._redirectPersistence)}function eN(e){return sA("pendingRedirect",e.config.apiKey,e.name)}function tN(e,t){return nN.apply(this,arguments)}function nN(){return(nN=Pw(function*(e,t,n=!1){const r=CA(e),i=UM(r,t),s=yield new KM(r,i,n).execute();return s&&!n&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})).apply(this,arguments)}class rN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sN(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!sN(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(hk(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(iN(e))}saveEventToCache(e){this.cachedEventUids.add(iN(e)),this.lastProcessedEventTime=Date.now()}}function iN(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function sN({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}function oN(e){return aN.apply(this,arguments)}function aN(){return(aN=Pw(function*(e,t={}){return Ik(e,"GET","/v1/projects",t)})).apply(this,arguments)}const lN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cN=/^https?/;function uN(){return(uN=Pw(function*(e){if(e.config.emulator)return;const{authorizedDomains:t}=yield oN(e);for(const n of t)try{if(hN(n))return}catch{}uk(e,"unauthorized-domain")})).apply(this,arguments)}function hN(e){const t=Ck(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!cN.test(n))return!1;if(lN.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const dN=new wk(3e4,6e4);function pN(){const e=bM().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let fN=null;function gN(e){return fN=fN||function(e){return new Promise((t,n)=>{var r,i,s;function o(){pN(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{pN(),n(hk(e,"network-request-failed"))},timeout:dN.get()})}if(null===(i=null===(r=bM().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=bM().gapi)||void 0===s?void 0:s.load)){const t=FM("iframefcb");return bM()[t]=()=>{gapi.load?o():n(hk(e,"network-request-failed"))},function(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=hk("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})}(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw fN=null,e})}(e),fN}const mN=new wk(5e3,15e3),yN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _N(e){const t=e.config;gk(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?bk(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:aS},i=vN.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${ub(r).slice(1)}`}function CN(){return(CN=Pw(function*(e){const t=yield gN(e),n=bM().gapi;return gk(n,e,"internal-error"),t.open({where:document.body,url:_N(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yN,dontclear:!0},t=>new Promise(function(){var n=Pw(function*(n,r){yield t.restyle({setHideOnLeave:!1});const i=hk(e,"network-request-failed"),s=bM().setTimeout(()=>{r(i)},mN.get());function o(){bM().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})});return function(e,t){return n.apply(this,arguments)}}()))})).apply(this,arguments)}const EN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class wN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function bN(e,t,n,r,i,s){gk(e.config.authDomain,e,"auth-domain-config-required"),gk(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:aS,eventId:i};if(t instanceof zA){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",ob(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof HA){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];return`${function({config:e}){return e.emulator?bk(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${ub(a).slice(1)}`}const SN="webStorageSupport",PN=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_M,this._completeRedirectFn=tN,this._overrideRedirectResult=XM}_openPopup(e,t,n,r){var i=this;return Pw(function*(){var s;yk(null===(s=i.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");const o=bN(e,t,n,Ck(),r);return function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},EN),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Gw().toLowerCase();n&&(a=uA(c)?"_blank":n),lA(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=Gw()){var t;return gA(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new wN(null);const h=window.open(t||"",a,u);gk(h,e,"popup-blocked");try{h.focus()}catch{}return new wN(h)}(e,o,EM())})()}_openRedirect(e,t,n,r){var i=this;return Pw(function*(){return yield i._originValidation(e),function(e){bM().location.href=e}(bN(e,t,n,Ck(),r)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(yk(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){var t=this;return Pw(function*(){const n=yield function(e){return CN.apply(this,arguments)}(e),r=new rN(e);return n.register("authEvent",t=>(gk(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:r},t.iframes[e._key()]=n,r})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(SN,{type:SN},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[SN];void 0!==i&&t(!!i),uk(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return uN.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return mA()||cA()||gA()}};var ON="@firebase/auth";class TN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return Pw(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){gk(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function IN(e=cS()){const t=iS(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=iS(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(lb(n.getOptions(),t??{}))return e;uk(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:PN,persistence:[LM,vM,_M]})}!function(e){rS(new Cb("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),{apiKey:s,authDomain:o}=r.options;return((t,r)=>{gk(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),gk(!(null==o?void 0:o.includes(":")),"argument-error",{appName:t.name});const i={apiKey:s,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yA(e)},a=new _A(t,r,i);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(_k);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(a,n),a})(r,i)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),rS(new Cb("auth-internal",e=>{const t=CA(e.getProvider("auth").getImmediate());return new TN(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),hS(ON,"0.20.5",void 0),hS(ON,"0.20.5","esm2017")}("Browser");class kN{constructor(e){return e}}class AN{constructor(){return lI("auth")}}const MN=new or("angularfire2.auth-instances");function NN(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new kN(r)}}const RN={provide:AN,deps:[[new Nr,MN]]},xN={provide:kN,useFactory:function(e,t){const n=aI("auth",e,t);return n&&new kN(n)},deps:[[new Nr,MN],_I]};let DN=(()=>{class e{constructor(){hS("angularfire",eI.full,"auth")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[xN,RN]}),e})();const LN=vI(wA,!0),FN=vI(oM,!0),UN=vI(IN,!0),BN=vI(gM,!0),VN=vI(cM,!0),$N=vI(iM,!0),zN=vI(lM,!0),HN=vI(qM,!0),GN=vI(pM,!0);var WN,qN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jN={},ZN=ZN||{},YN=qN||self;function KN(){}function QN(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function XN(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var JN="closure_uid_"+(1e9*Math.random()>>>0),eR=0;function tR(e,t,n){return e.call.apply(e.bind,arguments)}function nR(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function rR(e,t,n){return(rR=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?tR:nR).apply(null,arguments)}function iR(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function sR(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function oR(){this.s=this.s,this.o=this.o}var aR={};oR.prototype.s=!1,oR.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,JN)&&e[JN]||(e[JN]=++eR)}(this);delete aR[e]}},oR.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const lR=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},cR=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function uR(e){return Array.prototype.concat.apply([],arguments)}function hR(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function dR(e){return/^[\s\xa0]*$/.test(e)}var pR,fR=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function gR(e,t){return-1!=e.indexOf(t)}function mR(e,t){return e<t?-1:e>t?1:0}e:{var yR=YN.navigator;if(yR){var vR=yR.userAgent;if(vR){pR=vR;break e}}pR=""}function _R(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function CR(e){const t={};for(const n in e)t[n]=e[n];return t}var ER="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wR(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<ER.length;t++)n=ER[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function bR(e){return bR[" "](e),e}bR[" "]=KN;var SR,PR=gR(pR,"Opera"),OR=gR(pR,"Trident")||gR(pR,"MSIE"),TR=gR(pR,"Edge"),IR=TR||OR,kR=gR(pR,"Gecko")&&!(gR(pR.toLowerCase(),"webkit")&&!gR(pR,"Edge"))&&!(gR(pR,"Trident")||gR(pR,"MSIE"))&&!gR(pR,"Edge"),AR=gR(pR.toLowerCase(),"webkit")&&!gR(pR,"Edge");function MR(){var e=YN.document;return e?e.documentMode:void 0}e:{var NR="",RR=function(){var e=pR;return kR?/rv:([^\);]+)(\)|;)/.exec(e):TR?/Edge\/([\d\.]+)/.exec(e):OR?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):AR?/WebKit\/(\S+)/.exec(e):PR?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(RR&&(NR=RR?RR[1]:""),OR){var xR=MR();if(null!=xR&&xR>parseFloat(NR)){SR=String(xR);break e}}SR=NR}var DR={};function LR(){return e=DR,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=fR(String(SR)).split("."),n=fR("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=mR(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||mR(0==i[2].length,0==s[2].length)||mR(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}var FR=YN.document&&OR&&(MR()||parseInt(SR,10))||void 0,UR=function(){if(!YN.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{YN.addEventListener("test",KN,t),YN.removeEventListener("test",KN,t)}catch{}return e}();function BR(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function VR(e,t){if(BR.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(kR){e:{try{bR(t.nodeName);var i=!0;break e}catch{}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$R[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&VR.Z.h.call(this)}}BR.prototype.h=function(){this.defaultPrevented=!0},sR(VR,BR);var $R={2:"touch",3:"pen",4:"mouse"};VR.prototype.h=function(){VR.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var zR="closure_listenable_"+(1e6*Math.random()|0),HR=0;function GR(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++HR,this.ca=this.fa=!1}function WR(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function qR(e){this.src=e,this.g={},this.h=0}function jR(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=lR(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(WR(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ZR(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}qR.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ZR(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new GR(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var YR="closure_lm_"+(1e6*Math.random()|0),KR={};function QR(e,t,n,r,i){if(r&&r.once)return JR(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)QR(e,t[s],n,r,i);return null}return n=ox(n),e&&e[zR]?e.N(t,n,XN(r)?!!r.capture:!!r,i):XR(e,t,n,!1,r,i)}function XR(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=XN(i)?!!i.capture:!!i,a=ix(e);if(a||(e[YR]=a=new qR(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=rx;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)UR||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(nx(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function JR(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)JR(e,t[s],n,r,i);return null}return n=ox(n),e&&e[zR]?e.O(t,n,XN(r)?!!r.capture:!!r,i):XR(e,t,n,!0,r,i)}function ex(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ex(e,t[s],n,r,i);else r=XN(r)?!!r.capture:!!r,n=ox(n),e&&e[zR]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=ZR(s=e.g[t],n,r,i))&&(WR(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ix(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ZR(t,n,r,i)),(n=-1<e?t[e]:null)&&tx(n))}function tx(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[zR])jR(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(nx(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ix(t))?(jR(n,e),0==n.h&&(n.src=null,t[YR]=null)):WR(e)}}}function nx(e){return e in KR?KR[e]:KR[e]="on"+e}function rx(e,t){if(e.ca)e=!0;else{t=new VR(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&tx(e),e=n.call(r,t)}return e}function ix(e){return(e=e[YR])instanceof qR?e:null}var sx="__closure_events_fn_"+(1e9*Math.random()>>>0);function ox(e){return"function"==typeof e?e:(e[sx]||(e[sx]=function(t){return e.handleEvent(t)}),e[sx])}function ax(){oR.call(this),this.i=new qR(this),this.P=this,this.I=null}function lx(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new BR(t,e);else if(t instanceof BR)t.target=t.target||e;else{var i=t;wR(t=new BR(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=cx(o,r,!0,t)&&i}if(i=cx(o=t.g=e,r,!0,t)&&i,i=cx(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=cx(o=t.g=n[s],r,!1,t)&&i}function cx(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,l=o.ia||o.src;o.fa&&jR(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}sR(ax,oR),ax.prototype[zR]=!0,ax.prototype.removeEventListener=function(e,t,n,r){ex(this,e,t,n,r)},ax.prototype.M=function(){if(ax.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)WR(n[r]);delete t.g[e],t.h--}}this.I=null},ax.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ax.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ux=YN.JSON.stringify;function hx(){var e=vx;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var dx,px=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new fx,e=>e.reset());class fx{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function gx(e){YN.setTimeout(()=>{throw e},0)}function mx(e,t){dx||function(){var e=YN.Promise.resolve(void 0);dx=function(){e.then(_x)}}(),yx||(dx(),yx=!0),vx.add(e,t)}var yx=!1,vx=new class{constructor(){this.h=this.g=null}add(e,t){const n=px.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function _x(){for(var e;e=hx();){try{e.h.call(e.g)}catch(n){gx(n)}var t=px;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}yx=!1}function Cx(e,t){ax.call(this),this.h=e||1,this.g=t||YN,this.j=rR(this.kb,this),this.l=Date.now()}function Ex(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function wx(e,t,n){if("function"==typeof e)n&&(e=rR(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=rR(e.handleEvent,e)}return 2147483647<Number(t)?-1:YN.setTimeout(e,t||0)}function bx(e){e.g=wx(()=>{e.g=null,e.i&&(e.i=!1,bx(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}sR(Cx,ax),(WN=Cx.prototype).da=!1,WN.S=null,WN.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),lx(this,"tick"),this.da&&(Ex(this),this.start()))}},WN.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},WN.M=function(){Cx.Z.M.call(this),Ex(this),delete this.g};class Sx extends oR{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:bx(this)}M(){super.M(),this.g&&(YN.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Px(e){oR.call(this),this.h=e,this.g={}}sR(Px,oR);var Ox=[];function Tx(e,t,n,r){Array.isArray(n)||(n&&(Ox[0]=n.toString()),n=Ox);for(var i=0;i<n.length;i++){var s=QR(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ix(e){_R(e.g,function(e,t){this.g.hasOwnProperty(t)&&tx(e)},e),e.g={}}function kx(){this.g=!0}function Ax(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ux(n)}catch{return t}}(e,n)+(r?" "+r:"")})}Px.prototype.M=function(){Px.Z.M.call(this),Ix(this)},Px.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},kx.prototype.Aa=function(){this.g=!1},kx.prototype.info=function(){};var Mx={},Nx=null;function Rx(){return Nx=Nx||new ax}function xx(e){BR.call(this,Mx.Ma,e)}function Dx(e){const t=Rx();lx(t,new xx(t,e))}function Lx(e,t){BR.call(this,Mx.STAT_EVENT,e),this.stat=t}function Fx(e){const t=Rx();lx(t,new Lx(t,e))}function Ux(e,t){BR.call(this,Mx.Na,e),this.size=t}function Bx(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return YN.setTimeout(function(){e()},t)}Mx.Ma="serverreachability",sR(xx,BR),Mx.STAT_EVENT="statevent",sR(Lx,BR),Mx.Na="timingevent",sR(Ux,BR);var Vx={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$x={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function zx(){}function Hx(){}zx.prototype.h=null;var Gx,Wx={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function qx(){BR.call(this,"d")}function jx(){BR.call(this,"c")}function Zx(){}function Yx(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Px(this),this.P=Qx,this.W=new Cx(e=IR?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Kx}function Kx(){this.i=null,this.g="",this.h=!1}sR(qx,BR),sR(jx,BR),sR(Zx,zx),Zx.prototype.g=function(){return new XMLHttpRequest},Zx.prototype.i=function(){return{}},Gx=new Zx;var Qx=45e3,Xx={},Jx={};function eD(e,t,n){e.K=1,e.v=bD(yD(t)),e.s=n,e.U=!0,tD(e,null)}function tD(e,t){e.F=Date.now(),sD(e),e.A=yD(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),LD(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Kx,e.g=LL(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Sx(rR(e.Ia,e,e.g),e.O)),Tx(e.V,e.g,"readystatechange",e.gb),t=e.H?CR(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Dx(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.X,e.s)}function nD(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function rD(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=iD(e,n),r==Jx){4==t&&(e.o=4,Fx(14),i=!1),Ax(e.j,e.m,null,"[Incomplete Response]");break}if(r==Xx){e.o=4,Fx(15),Ax(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ax(e.j,e.m,r,null),uD(e,r)}nD(e)&&r!=Jx&&r!=Xx&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Fx(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),IL(t),t.L=!0,Fx(11))):(Ax(e.j,e.m,n,"[Invalid Chunked Response]"),cD(e),lD(e))}function iD(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Jx:(n=Number(t.substring(n,r)),isNaN(n)?Xx:(r+=1)+n>t.length?Jx:(t=t.substr(r,n),e.C=r+n,t))}function sD(e){e.Y=Date.now()+e.P,oD(e,e.P)}function oD(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Bx(rR(e.eb,e),t)}function aD(e){e.B&&(YN.clearTimeout(e.B),e.B=null)}function lD(e){0==e.l.G||e.I||ML(e.l,e)}function cD(e){aD(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ex(e.W),Ix(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function uD(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||zD(n.i,e)))if(n.I=e.N,!e.J&&zD(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(n.u)n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Bx(rR(n.ab,n),6e3));else{if(n.g){if(!(n.g.F+3e3<e.F))break e;AL(n),_L(n)}TL(n),Fx(18)}if(1>=$D(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else RL(n,11)}else if((e.J||n.g==e)&&AL(n),!dR(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.U=c[0],c=c[1],2==n.G)if("c"==c[0]){n.J=c[1],n.la=c[2];const t=c[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=c[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(gR(e,"spdy")||gR(e,"quic")||gR(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(HD(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,wD(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=DL(r,r.H?r.la:null,r.W),o.J){GD(r.i,o);var a=o,l=r.K;l&&a.setTimeout(l),a.B&&(aD(a),sD(a)),r.g=o}else OL(r);0<n.l.length&&wL(n)}else"stop"!=c[0]&&"close"!=c[0]||RL(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?RL(n,7):vL(n):"noop"!=c[0]&&n.j&&n.j.wa(c),n.A=0)}Dx(4)}catch{}}function hD(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(QN(e)||"string"==typeof e)cR(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(QN(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(QN(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function dD(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof dD)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function pD(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];fD(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)fD(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function fD(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(WN=Yx.prototype).setTimeout=function(e){this.P=e},WN.gb=function(e){e=e.target;const t=this.L;t&&3==pL(e)?t.l():this.Ia(e)},WN.Ia=function(e){try{if(e==this.g)e:{const u=pL(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>u)&&(3!=u||IR||this.g&&(this.h.h||this.g.ga()||fL(this.g)))){this.I||4!=u||7==t||Dx(8==t||0>=h?3:2),aD(this);var n=this.g.ba();this.N=n;t:if(nD(this)){var r=fL(this.g);e="";var i=r.length,s=4==pL(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){cD(this),lD(this);var o="";break t}this.h.i=new YN.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dR(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,Fx(12),cD(this),lD(this);break e}Ax(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,uD(this,n)}this.U?(rD(this,u,o),IR&&this.i&&3==u&&(Tx(this.V,this.W,"tick",this.fb),this.W.start())):(Ax(this.j,this.m,o,null),uD(this,o)),4==u&&cD(this),this.i&&!this.I&&(4==u?ML(this.l,this):(this.i=!1,sD(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Fx(12)):(this.o=0,Fx(13)),cD(this),lD(this)}}}catch{}},WN.fb=function(){if(this.g){var e=pL(this.g),t=this.g.ga();this.C<t.length&&(aD(this),rD(this,e,t),this.i&&4!=e&&sD(this))}},WN.cancel=function(){this.I=!0,cD(this)},WN.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(Dx(3),Fx(17)),cD(this),this.o=2,lD(this)):oD(this,this.Y-e)},(WN=dD.prototype).R=function(){pD(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},WN.T=function(){return pD(this),this.g.concat()},WN.get=function(e,t){return fD(this.h,e)?this.h[e]:t},WN.set=function(e,t){fD(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},WN.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var gD=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function mD(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof mD){this.g=void 0!==t?t:e.g,vD(this,e.j),this.s=e.s,_D(this,e.i),CD(this,e.m),this.l=e.l,t=e.h;var n=new ND;n.i=t.i,t.g&&(n.g=new dD(t.g),n.h=t.h),ED(this,n),this.o=e.o}else e&&(n=String(e).match(gD))?(this.g=!!t,vD(this,n[1]||"",!0),this.s=SD(n[2]||""),_D(this,n[3]||"",!0),CD(this,n[4]),this.l=SD(n[5]||"",!0),ED(this,n[6]||"",!0),this.o=SD(n[7]||"")):(this.g=!!t,this.h=new ND(null,this.g))}function yD(e){return new mD(e)}function vD(e,t,n){e.j=n?SD(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function _D(e,t,n){e.i=n?SD(t,!0):t}function CD(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ED(e,t,n){t instanceof ND?(e.h=t,function(e,t){t&&!e.j&&(RD(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(xD(this,t),LD(this,n,e))},e)),e.j=t}(e.h,e.g)):(n||(t=PD(t,AD)),e.h=new ND(t,e.g))}function wD(e,t,n){e.h.set(t,n)}function bD(e){return wD(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function SD(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function PD(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,OD),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function OD(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mD.prototype.toString=function(){var e=[],t=this.j;t&&e.push(PD(t,TD,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(PD(t,TD,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(PD(n,"/"==n.charAt(0)?kD:ID,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",PD(n,MD)),e.join("")};var TD=/[#\/\?@]/g,ID=/[#\?:]/g,kD=/[#\?]/g,AD=/[#\?@]/g,MD=/#/g;function ND(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function RD(e){e.g||(e.g=new dD,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function xD(e,t){RD(e),t=FD(e,t),fD(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,fD((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&pD(e)))}function DD(e,t){return RD(e),t=FD(e,t),fD(e.g.h,t)}function LD(e,t,n){xD(e,t),0<n.length&&(e.i=null,e.g.set(FD(e,t),hR(n)),e.h+=n.length)}function FD(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function UD(e){this.l=e||BD,e=YN.PerformanceNavigationTiming?0<(e=YN.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(YN.g&&YN.g.Ea&&YN.g.Ea()&&YN.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(WN=ND.prototype).add=function(e,t){RD(this),this.i=null,e=FD(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},WN.forEach=function(e,t){RD(this),this.g.forEach(function(n,r){cR(n,function(n){e.call(t,n,r,this)},this)},this)},WN.T=function(){RD(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},WN.R=function(e){RD(this);var t=[];if("string"==typeof e)DD(this,e)&&(t=uR(t,this.g.get(FD(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=uR(t,e[n])}return t},WN.set=function(e,t){return RD(this),this.i=null,DD(this,e=FD(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},WN.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},WN.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var BD=10;function VD(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $D(e){return e.h?1:e.g?e.g.size:0}function zD(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function HD(e,t){e.g?e.g.add(t):e.h=t}function GD(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function WD(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return hR(e.i)}function qD(){}function jD(){this.g=new qD}function ZD(e,t,n){const r=n||"";try{hD(e,function(e,n){let i=e;XN(e)&&(i=ux(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function YD(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function KD(e){this.l=e.$b||null,this.j=e.ib||!1}function QD(e,t){ax.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=XD,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}UD.prototype.cancel=function(){if(this.i=WD(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},qD.prototype.stringify=function(e){return YN.JSON.stringify(e,void 0)},qD.prototype.parse=function(e){return YN.JSON.parse(e,void 0)},sR(KD,zx),KD.prototype.g=function(){return new QD(this.l,this.j)},KD.prototype.i=function(e){return function(){return e}}({}),sR(QD,ax);var XD=0;function JD(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function eL(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tL(e)}function tL(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(WN=QD.prototype).open=function(e,t){if(this.readyState!=XD)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tL(this)},WN.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||YN).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},WN.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,eL(this)),this.readyState=XD},WN.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tL(this)),this.g&&(this.readyState=3,tL(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==YN.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;JD(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},WN.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?eL(this):tL(this),3==this.readyState&&JD(this)}},WN.Ua=function(e){this.g&&(this.response=this.responseText=e,eL(this))},WN.Ta=function(e){this.g&&(this.response=e,eL(this))},WN.ha=function(){this.g&&eL(this)},WN.setRequestHeader=function(e,t){this.v.append(e,t)},WN.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},WN.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(QD.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var nL=YN.JSON.parse;function rL(e){ax.call(this),this.headers=new dD,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=iL,this.K=this.L=!1}sR(rL,ax);var iL="",sL=/^https?$/i,oL=["POST","PUT"];function aL(e){return"content-type"==e.toLowerCase()}function lL(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,cL(e),hL(e)}function cL(e){e.D||(e.D=!0,lx(e,"complete"),lx(e,"error"))}function uL(e){if(e.h&&void 0!==ZN&&(!e.C[1]||4!=pL(e)||2!=e.ba()))if(e.v&&4==pL(e))wx(e.Fa,0,e);else if(lx(e,"readystatechange"),4==pL(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(gD)[1]||null;if(!i&&YN.self&&YN.self.location){var s=YN.self.location.protocol;i=s.substr(0,s.length-1)}r=!sL.test(i?i.toLowerCase():"")}n=r}if(n)lx(e,"complete"),lx(e,"success");else{e.m=6;try{var o=2<pL(e)?e.g.statusText:""}catch{o=""}e.j=o+" ["+e.ba()+"]",cL(e)}}finally{hL(e)}}}function hL(e,t){if(e.g){dL(e);const n=e.g,r=e.C[0]?KN:null;e.g=null,e.C=null,t||lx(e,"ready");try{n.onreadystatechange=r}catch{}}}function dL(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(YN.clearTimeout(e.A),e.A=null)}function pL(e){return e.g?e.g.readyState:0}function fL(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case iL:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function gL(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return _R(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):wD(e,t,n))}function mL(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function yL(e){this.za=0,this.l=[],this.h=new kx,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=mL("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=mL("baseRetryDelayMs",5e3,e),this.$a=mL("retryDelaySeedMs",1e4,e),this.Ya=mL("forwardChannelMaxRetries",2,e),this.ra=mL("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new UD(e&&e.concurrentRequestLimit),this.Ca=new jD,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function vL(e){if(CL(e),3==e.G){var t=e.V++,n=yD(e.F);wD(n,"SID",e.J),wD(n,"RID",t),wD(n,"TYPE","terminate"),SL(e,n),(t=new Yx(e,e.h,t,void 0)).K=2,t.v=bD(yD(n)),n=!1,YN.navigator&&YN.navigator.sendBeacon&&(n=YN.navigator.sendBeacon(t.v.toString(),"")),!n&&YN.Image&&((new Image).src=t.v,n=!0),n||(t.g=LL(t.l,null),t.g.ea(t.v)),t.F=Date.now(),sD(t)}xL(e)}function _L(e){e.g&&(IL(e),e.g.cancel(),e.g=null)}function CL(e){_L(e),e.u&&(YN.clearTimeout(e.u),e.u=null),AL(e),e.i.cancel(),e.m&&("number"==typeof e.m&&YN.clearTimeout(e.m),e.m=null)}function EL(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&wL(e)}function wL(e){VD(e.i)||e.m||(e.m=!0,mx(e.Ha,e),e.C=0)}function bL(e,t){var n;n=t?t.m:e.V++;const r=yD(e.F);wD(r,"SID",e.J),wD(r,"RID",n),wD(r,"AID",e.U),SL(e,r),e.o&&e.s&&gL(r,e.o,e.s),n=new Yx(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=PL(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),HD(e.i,n),eD(n,r,t)}function SL(e,t){e.j&&hD({},function(e,n){wD(t,n,e)})}function PL(e,t,n){n=Math.min(e.l.length,n);var r=e.j?rR(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{ZD(a,e,"req"+n+"_")}catch{r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function OL(e){e.g||e.u||(e.Y=1,mx(e.Ga,e),e.A=0)}function TL(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=Bx(rR(e.Ga,e),NL(e,e.A)),e.A++,0))}function IL(e){null!=e.B&&(YN.clearTimeout(e.B),e.B=null)}function kL(e){e.g=new Yx(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=yD(e.oa);wD(t,"RID","rpc"),wD(t,"SID",e.J),wD(t,"CI",e.N?"0":"1"),wD(t,"AID",e.U),SL(e,t),wD(t,"TYPE","xmlhttp"),e.o&&e.s&&gL(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=bD(yD(t)),n.s=null,n.U=!0,tD(n,e)}function AL(e){null!=e.v&&(YN.clearTimeout(e.v),e.v=null)}function ML(e,t){var n=null;if(e.g==t){AL(e),IL(e),e.g=null;var r=2}else{if(!zD(e.i,t))return;n=t.D,GD(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;lx(r=Rx(),new Ux(r,n,t,i)),wL(e)}else OL(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!($D(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Bx(rR(e.Ha,e,t),NL(e,e.C)),e.C++,0)))}(e,t)||2==r&&TL(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:RL(e,5);break;case 4:RL(e,10);break;case 3:RL(e,6);break;default:RL(e,2)}}function NL(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function RL(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=rR(e.jb,e);n||(n=new mD("//www.google.com/images/cleardot.gif"),YN.location&&"http"==YN.location.protocol||vD(n,"https"),bD(n)),function(e,t){const n=new kx;if(YN.Image){const r=new Image;r.onload=iR(YD,n,r,"TestLoadImage: loaded",!0,t),r.onerror=iR(YD,n,r,"TestLoadImage: error",!1,t),r.onabort=iR(YD,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=iR(YD,n,r,"TestLoadImage: timeout",!1,t),YN.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else Fx(2);e.G=0,e.j&&e.j.va(t),xL(e),CL(e)}function xL(e){e.G=0,e.I=-1,e.j&&((0!=WD(e.i).length||0!=e.l.length)&&(e.i.i.length=0,hR(e.l),e.l.length=0),e.j.ua())}function DL(e,t,n){let r=function(e){return e instanceof mD?yD(e):new mD(e,void 0)}(n);if(""!=r.i)t&&_D(r,t+"."+r.i),CD(r,r.m);else{const e=YN.location;r=function(e,t,n,r){var i=new mD(null,void 0);return e&&vD(i,e),t&&_D(i,t),n&&CD(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&_R(e.aa,function(e,t){wD(r,t,e)}),n=e.sa,(t=e.D)&&n&&wD(r,t,n),wD(r,"VER",e.ma),SL(e,r),r}function LL(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new rL(n&&e.Ba&&!e.qa?new KD({ib:!0}):e.qa)).L=e.H,t}function FL(){}function UL(){if(OR&&!(10<=Number(FR)))throw Error("Environmental error: no available transport.")}function BL(e,t){ax.call(this),this.g=new yL(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!dR(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!dR(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new zL(this)}function VL(e){qx.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function $L(){jx.call(this),this.status=1}function zL(e){this.g=e}(WN=rL.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Gx.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:Gx),this.g.onreadystatechange=rR(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void lL(this,s)}e=n||"";const i=new dD(this.headers);r&&hD(r,function(e,t){i.set(t,e)}),r=function(e){e:{var t=aL;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=YN.FormData&&e instanceof YN.FormData,!(0<=lR(oL,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{dL(this),0<this.B&&((this.K=function(e){return OR&&LR()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=rR(this.pa,this)):this.A=wx(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){lL(this,s)}},WN.pa=function(){void 0!==ZN&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,lx(this,"timeout"),this.abort(8))},WN.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,lx(this,"complete"),lx(this,"abort"),hL(this))},WN.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),hL(this,!0)),rL.Z.M.call(this)},WN.Fa=function(){this.s||(this.F||this.v||this.l?uL(this):this.cb())},WN.cb=function(){uL(this)},WN.ba=function(){try{return 2<pL(this)?this.g.status:-1}catch{return-1}},WN.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}},WN.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),nL(t)}},WN.Da=function(){return this.m},WN.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(WN=yL.prototype).ma=8,WN.G=1,WN.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}},WN.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Yx(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=CR(s),wR(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=PL(this,i,t),wD(n=yD(this.F),"RID",e),wD(n,"CVER",22),this.D&&wD(n,"X-HTTP-Session-Id",this.D),SL(this,n),this.o&&s&&gL(n,this.o,s),HD(this.i,i),this.Ra&&wD(n,"TYPE","init"),this.ja?(wD(n,"$req",t),wD(n,"SID","null"),i.$=!0,eD(i,n,null)):eD(i,n,t),this.G=2}}else 3==this.G&&(e?bL(this,e):0==this.l.length||VD(this.i)||bL(this))},WN.Ga=function(){if(this.u=null,kL(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Bx(rR(this.bb,this),e)}},WN.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Fx(10),_L(this),kL(this))},WN.ab=function(){null!=this.v&&(this.v=null,_L(this),TL(this),Fx(19))},WN.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Fx(2)):(this.h.info("Failed to ping google.com"),Fx(1))},(WN=FL.prototype).xa=function(){},WN.wa=function(){},WN.va=function(){},WN.ua=function(){},WN.Oa=function(){},UL.prototype.g=function(e,t){return new BL(e,t)},sR(BL,ax),BL.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),mx(rR(e.hb,e,t))),Fx(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=DL(e,null,e.W),wL(e)},BL.prototype.close=function(){vL(this.g)},BL.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,EL(this.g,t)}else this.v?((t={}).__data__=ux(e),EL(this.g,t)):EL(this.g,e)},BL.prototype.M=function(){this.g.j=null,delete this.j,vL(this.g),delete this.g,BL.Z.M.call(this)},sR(VL,qx),sR($L,jx),sR(zL,FL),zL.prototype.xa=function(){lx(this.g,"a")},zL.prototype.wa=function(e){lx(this.g,new VL(e))},zL.prototype.va=function(e){lx(this.g,new $L(e))},zL.prototype.ua=function(){lx(this.g,"b")},UL.prototype.createWebChannel=UL.prototype.g,BL.prototype.send=BL.prototype.u,BL.prototype.open=BL.prototype.m,BL.prototype.close=BL.prototype.close,Vx.NO_ERROR=0,Vx.TIMEOUT=8,Vx.HTTP_ERROR=6,$x.COMPLETE="complete",Hx.EventType=Wx,Wx.OPEN="a",Wx.CLOSE="b",Wx.ERROR="c",Wx.MESSAGE="d",ax.prototype.listen=ax.prototype.N,rL.prototype.listenOnce=rL.prototype.O,rL.prototype.getLastError=rL.prototype.La,rL.prototype.getLastErrorCode=rL.prototype.Da,rL.prototype.getStatus=rL.prototype.ba,rL.prototype.getResponseJson=rL.prototype.Qa,rL.prototype.getResponseText=rL.prototype.ga,rL.prototype.send=rL.prototype.ea;var HL=jN.createWebChannelTransport=function(){return new UL},GL=jN.getStatEventTarget=function(){return Rx()},WL=jN.ErrorCode=Vx,qL=jN.EventType=$x,jL=jN.Event=Mx,ZL=jN.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},YL=jN.FetchXmlHttpFactory=KD,KL=jN.WebChannel=Hx,QL=jN.XhrIo=rL;const XL="@firebase/firestore";class JL{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}JL.UNAUTHENTICATED=new JL(null),JL.GOOGLE_CREDENTIALS=new JL("google-credentials-uid"),JL.FIRST_PARTY=new JL("first-party-uid"),JL.MOCK_USER=new JL("mock-user");let eF="9.9.0";const tF=new Ab("@firebase/firestore");function nF(){return tF.logLevel}function rF(e,...t){if(tF.logLevel<=Pb.DEBUG){const n=t.map(oF);tF.debug(`Firestore (${eF}): ${e}`,...n)}}function iF(e,...t){if(tF.logLevel<=Pb.ERROR){const n=t.map(oF);tF.error(`Firestore (${eF}): ${e}`,...n)}}function sF(e,...t){if(tF.logLevel<=Pb.WARN){const n=t.map(oF);tF.warn(`Firestore (${eF}): ${e}`,...n)}}function oF(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return e}}function aF(e="Unexpected state"){const t=`FIRESTORE (${eF}) INTERNAL ASSERTION FAILED: `+e;throw iF(t),new Error(t)}function lF(e,t){e||aF()}function cF(e,t){return e}const uF={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class hF extends Xw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class dF{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class pF{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fF{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(JL.UNAUTHENTICATED))}shutdown(){}}class gF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class mF{constructor(e){this.t=e,this.currentUser=JL.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let r=this.i;const i=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new dF;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new dF,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=s;e.enqueueRetryable(Pw(function*(){yield t.promise,yield i(n.currentUser)}))},a=e=>{rF("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(rF("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new dF)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rF("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lF("string"==typeof t.accessToken),new pF(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return lF(null===e||"string"==typeof e),new JL(e)}}class yF{constructor(e,t,n){this.type="FirstParty",this.user=JL.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class vF{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new yF(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(JL.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class _F{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CF{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&rF("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,rF("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{rF("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?r(e):rF("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lF("string"==typeof e.token),this.p=e.token,new _F(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function EF(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class wF{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=EF(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function bF(e,t){return e<t?-1:e>t?1:0}function SF(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class PF{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new hF(uF.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new hF(uF.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new hF(uF.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new hF(uF.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return PF.fromMillis(Date.now())}static fromDate(e){return PF.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new PF(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?bF(this.nanoseconds,e.nanoseconds):bF(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class OF{constructor(e){this.timestamp=e}static fromTimestamp(e){return new OF(e)}static min(){return new OF(new PF(0,0))}static max(){return new OF(new PF(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class TF{constructor(e,t,n){void 0===t?t=0:t>e.length&&aF(),void 0===n?n=e.length-t:n>e.length-t&&aF(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===TF.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof TF?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class IF extends TF{construct(e,t,n){return new IF(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new hF(uF.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new IF(t)}static emptyPath(){return new IF([])}}const kF=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class AF extends TF{construct(e,t,n){return new AF(e,t,n)}static isValidIdentifier(e){return kF.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),AF.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new AF(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new hF(uF.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new hF(uF.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new hF(uF.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new hF(uF.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new AF(t)}static emptyPath(){return new AF([])}}class MF{constructor(e){this.path=e}static fromPath(e){return new MF(IF.fromString(e))}static fromName(e){return new MF(IF.fromString(e).popFirst(5))}static empty(){return new MF(IF.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===IF.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return IF.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new MF(new IF(e.slice()))}}function NF(e){return new RF(e.readTime,e.key,-1)}class RF{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new RF(OF.min(),MF.empty(),-1)}static max(){return new RF(OF.max(),MF.empty(),-1)}}function xF(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=MF.comparator(e.documentKey,t.documentKey),0!==n?n:bF(e.largestBatchId,t.largestBatchId))}const DF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";function LF(e){return FF.apply(this,arguments)}function FF(){return(FF=Pw(function*(e){if(e.code!==uF.FAILED_PRECONDITION||e.message!==DF)throw e;rF("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class UF{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&aF(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new UF((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof UF?t:UF.resolve(t)}catch(t){return UF.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):UF.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):UF.reject(t)}static resolve(e){return new UF((t,n)=>{t(e)})}static reject(e){return new UF((t,n)=>{n(e)})}static waitFor(e){return new UF((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=UF.resolve(!1);for(const n of e)t=t.next(e=>e?UF.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new UF((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const l=a;t(e[l]).next(e=>{s[l]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new UF((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function BF(e){return"IndexedDbTransactionError"===e.name}class VF{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.it(e),this.rt=e=>t.writeSequenceNumber(e))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.rt&&this.rt(e),e}}function $F(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function zF(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function HF(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}VF.ot=-1;class GF{constructor(e,t){this.comparator=e,this.root=t||qF.EMPTY}insert(e,t){return new GF(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qF.BLACK,null,null))}remove(e){return new GF(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qF.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new WF(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new WF(this.root,e,this.comparator,!1)}getReverseIterator(){return new WF(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new WF(this.root,e,this.comparator,!0)}}class WF{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qF{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??qF.RED,this.left=r??qF.EMPTY,this.right=i??qF.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new qF(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return qF.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return qF.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qF.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qF.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw aF();const e=this.left.check();if(e!==this.right.check())throw aF();return e+(this.isRed()?0:1)}}qF.EMPTY=null,qF.RED=!0,qF.BLACK=!1,qF.EMPTY=new class{constructor(){this.size=0}get key(){throw aF()}get value(){throw aF()}get color(){throw aF()}get left(){throw aF()}get right(){throw aF()}copy(e,t,n,r,i){return this}insert(e,t,n){return new qF(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class jF{constructor(e){this.comparator=e,this.data=new GF(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ZF(this.data.getIterator())}getIteratorFrom(e){return new ZF(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof jF)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new jF(this.comparator);return t.data=e,t}}class ZF{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class YF{constructor(e){this.fields=e,e.sort(AF.comparator)}static empty(){return new YF([])}unionWith(e){let t=new jF(AF.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new YF(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return SF(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class KF{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new KF(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new KF(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return bF(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}KF.EMPTY_BYTE_STRING=new KF("");const QF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function XF(e){if(lF(!!e),"string"==typeof e){let t=0;const n=QF.exec(e);if(lF(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:JF(e.seconds),nanos:JF(e.nanos)}}function JF(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function eU(e){return"string"==typeof e?KF.fromBase64String(e):KF.fromUint8Array(e)}function tU(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function nU(e){const t=e.mapValue.fields.__previous_value__;return tU(t)?nU(t):t}function rU(e){const t=XF(e.mapValue.fields.__local_write_time__.timestampValue);return new PF(t.seconds,t.nanos)}class iU{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class sU{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sU("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof sU&&e.projectId===this.projectId&&e.database===this.database}}function oU(e){return null==e}function aU(e){return 0===e&&1/e==-1/0}const lU={fields:{__type__:{stringValue:"__max__"}}};function cU(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?tU(e)?4:bU(e)?9007199254740991:10:aF()}function uU(e,t){if(e===t)return!0;const n=cU(e);if(n!==cU(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rU(e).isEqual(rU(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=XF(e.timestampValue),r=XF(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,eU(e.bytesValue).isEqual(eU(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return JF(e.geoPointValue.latitude)===JF(t.geoPointValue.latitude)&&JF(e.geoPointValue.longitude)===JF(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return JF(e.integerValue)===JF(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=JF(e.doubleValue),r=JF(t.doubleValue);return n===r?aU(n)===aU(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return SF(e.arrayValue.values||[],t.arrayValue.values||[],uU);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if($F(n)!==$F(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!uU(n[i],r[i])))return!1;return!0}(e,t);default:return aF()}var r}function hU(e,t){return void 0!==(e.values||[]).find(e=>uU(e,t))}function dU(e,t){if(e===t)return 0;const n=cU(e),r=cU(t);if(n!==r)return bF(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return bF(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=JF(e.integerValue||e.doubleValue),r=JF(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return pU(e.timestampValue,t.timestampValue);case 4:return pU(rU(e),rU(t));case 5:return bF(e.stringValue,t.stringValue);case 6:return function(e,t){const n=eU(e),r=eU(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=bF(n[i],r[i]);if(0!==e)return e}return bF(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=bF(JF(e.latitude),JF(t.latitude));return 0!==n?n:bF(JF(e.longitude),JF(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=dU(n[i],r[i]);if(e)return e}return bF(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===lU&&t===lU)return 0;if(e===lU)return 1;if(t===lU)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=bF(r[o],s[o]);if(0!==e)return e;const t=dU(n[r[o]],i[s[o]]);if(0!==t)return t}return bF(r.length,s.length)}(e.mapValue,t.mapValue);default:throw aF()}}function pU(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return bF(e,t);const n=XF(e),r=XF(t),i=bF(n.seconds,r.seconds);return 0!==i?i:bF(n.nanos,r.nanos)}function fU(e){return gU(e)}function gU(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=XF(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?eU(e.bytesValue).toBase64():"referenceValue"in e?MF.fromName(e.referenceValue).toString():"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=gU(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${gU(e.fields[i])}`;return n+"}"}(e.mapValue):aF();var t}function mU(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function yU(e){return!!e&&"integerValue"in e}function vU(e){return!!e&&"arrayValue"in e}function _U(e){return!!e&&"nullValue"in e}function CU(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function EU(e){return!!e&&"mapValue"in e}function wU(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return zF(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=wU(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=wU(e.arrayValue.values[n]);return t}return Object.assign({},e)}function bU(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class SU{constructor(e){this.value=e}static empty(){return new SU({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!EU(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wU(t)}setAll(e){let t=AF.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=wU(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());EU(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return uU(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];EU(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){zF(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new SU(wU(this.value))}}function PU(e){const t=[];return zF(e.fields,(e,n)=>{const r=new AF([e]);if(EU(n)){const e=PU(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new YF(t)}class OU{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new OU(e,0,OF.min(),OF.min(),SU.empty(),0)}static newFoundDocument(e,t,n){return new OU(e,1,t,OF.min(),n,0)}static newNoDocument(e,t){return new OU(e,2,t,OF.min(),SU.empty(),0)}static newUnknownDocument(e,t){return new OU(e,3,t,OF.min(),SU.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=SU.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=SU.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=OF.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof OU&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new OU(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class TU{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ut=null}}function IU(e,t=null,n=[],r=[],i=null,s=null,o=null){return new TU(e,t,n,r,i,s,o)}function kU(e){const t=cF(e);if(null===t.ut){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(t=e).field.canonicalString()+t.op.toString()+fU(t.value);var t}).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),oU(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>fU(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>fU(e)).join(",")),t.ut=e}return t.ut}function AU(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!HU(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if((n=e.filters[i]).op!==(r=t.filters[i]).op||!n.field.isEqual(r.field)||!uU(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!WU(e.startAt,t.startAt)&&WU(e.endAt,t.endAt)}function MU(e){return MF.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class NU extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,n):new RU(e,t,n):"array-contains"===t?new FU(e,n):"in"===t?new UU(e,n):"not-in"===t?new BU(e,n):"array-contains-any"===t?new VU(e,n):new NU(e,t,n)}static ct(e,t,n){return"in"===t?new xU(e,n):new DU(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(dU(t,this.value)):null!==t&&cU(this.value)===cU(t)&&this.at(dU(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return aF()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class RU extends NU{constructor(e,t,n){super(e,t,n),this.key=MF.fromName(n.referenceValue)}matches(e){const t=MF.comparator(e.key,this.key);return this.at(t)}}class xU extends NU{constructor(e,t){super(e,"in",t),this.keys=LU(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class DU extends NU{constructor(e,t){super(e,"not-in",t),this.keys=LU(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function LU(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>MF.fromName(e.referenceValue))}class FU extends NU{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vU(t)&&hU(t.arrayValue,this.value)}}class UU extends NU{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&hU(this.value.arrayValue,t)}}class BU extends NU{constructor(e,t){super(e,"not-in",t)}matches(e){if(hU(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!hU(this.value.arrayValue,t)}}class VU extends NU{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vU(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>hU(this.value.arrayValue,e))}}class $U{constructor(e,t){this.position=e,this.inclusive=t}}class zU{constructor(e,t="asc"){this.field=e,this.dir=t}}function HU(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function GU(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?MF.comparator(MF.fromName(o.referenceValue),n.key):dU(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function WU(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!uU(e.position[n],t.position[n]))return!1;return!0}class qU{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null}}function jU(e){return new qU(e)}function ZU(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function YU(e){for(const t of e.filters)if(t.ht())return t.field;return null}function KU(e){return null!==e.collectionGroup}function QU(e){const t=cF(e);if(null===t.lt){t.lt=[];const e=YU(t),n=ZU(t);if(null!==e&&null===n)e.isKeyField()||t.lt.push(new zU(e)),t.lt.push(new zU(AF.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.lt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new zU(AF.keyField(),e))}}}return t.lt}function XU(e){const t=cF(e);if(!t.ft)if("F"===t.limitType)t.ft=IU(t.path,t.collectionGroup,QU(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of QU(t))e.push(new zU(i.field,"desc"===i.dir?"asc":"desc"));const n=t.endAt?new $U(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new $U(t.startAt.position,t.startAt.inclusive):null;t.ft=IU(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.ft}function JU(e,t,n){return new qU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function eB(e,t){return AU(XU(e),XU(t))&&e.limitType===t.limitType}function tB(e){return`${kU(XU(e))}|lt:${e.limitType}`}function nB(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${fU(t.value)}`;var t}).join(", ")}]`),oU(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>fU(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>fU(e)).join(",")),`Target(${t})`}(XU(e))}; limitType=${e.limitType})`}function rB(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):MF.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!function(e,t,n){const r=GU(e,t,n);return e.inclusive?r<=0:r<0}(n.startAt,QU(n),r)||n.endAt&&!function(e,t,n){const r=GU(e,t,n);return e.inclusive?r>=0:r>0}(n.endAt,QU(n),r)));var n,r}function iB(e){return(t,n)=>{let r=!1;for(const i of QU(e)){const e=sB(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function sB(e,t,n){const r=e.field.isKeyField()?MF.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?dU(r,i):aF()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return aF()}}function oB(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:aU(t)?"-0":t}}function aB(e){return{integerValue:""+e}}function lB(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!aU(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?aB(t):oB(e,t)}class cB{constructor(){this._=void 0}}function uB(e,t,n){return e instanceof pB?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof fB?gB(e,t):e instanceof mB?yB(e,t):function(e,t){const n=dB(e,t),r=_B(n)+_B(e._t);return yU(n)&&yU(e._t)?aB(r):oB(e.wt,r)}(e,t)}function hB(e,t,n){return e instanceof fB?gB(e,t):e instanceof mB?yB(e,t):n}function dB(e,t){return e instanceof vB?yU(r=t)||(n=r)&&"doubleValue"in n?t:{integerValue:0}:null;var n,r}class pB extends cB{}class fB extends cB{constructor(e){super(),this.elements=e}}function gB(e,t){const n=CB(t);for(const r of e.elements)n.some(e=>uU(e,r))||n.push(r);return{arrayValue:{values:n}}}class mB extends cB{constructor(e){super(),this.elements=e}}function yB(e,t){let n=CB(t);for(const r of e.elements)n=n.filter(e=>!uU(e,r));return{arrayValue:{values:n}}}class vB extends cB{constructor(e,t){super(),this.wt=e,this._t=t}}function _B(e){return JF(e.integerValue||e.doubleValue)}function CB(e){return vU(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class EB{constructor(e,t){this.field=e,this.transform=t}}class wB{constructor(e,t){this.version=e,this.transformResults=t}}class bB{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new bB}static exists(e){return new bB(void 0,e)}static updateTime(e){return new bB(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function SB(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class PB{}function OB(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new LB(e.key,bB.none()):new MB(e.key,e.data,bB.none());{const n=e.data,r=SU.empty();let i=new jF(AF.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new NB(e.key,r,new YF(i.toArray()),bB.none())}}function TB(e,t,n){e instanceof MB?function(e,t,n){const r=e.value.clone(),i=xB(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof NB?function(e,t,n){if(!SB(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=xB(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(RB(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function IB(e,t,n,r){return e instanceof MB?function(e,t,n,r){if(!SB(e.precondition,t))return n;const i=e.value.clone(),s=DB(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof NB?function(e,t,n,r){if(!SB(e.precondition,t))return n;const i=DB(e.fieldTransforms,r,t),s=t.data;return s.setAll(RB(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(s=n,SB(e.precondition,i=t)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):s);var i,s}function kB(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=dB(r.transform,e||null);null!=i&&(null===n&&(n=SU.empty()),n.set(r.field,i))}return n||null}function AB(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=t.fieldTransforms,!!(void 0===(n=e.fieldTransforms)&&void 0===r||n&&r&&SF(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(r=t.transform,(n=e.transform)instanceof fB&&r instanceof fB||n instanceof mB&&r instanceof mB?SF(n.elements,r.elements,uU):n instanceof vB&&r instanceof vB?uU(n._t,r._t):n instanceof pB&&r instanceof pB);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var n,r}class MB extends PB{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class NB extends PB{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function RB(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function xB(e,t,n){const r=new Map;lF(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,hB(o,a,n[i]))}return r}function DB(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,uB(e,s,t))}return r}class LB extends PB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FB extends PB{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class UB{constructor(e){this.count=e}}var BB,VB;function $B(e){switch(e){default:return aF();case uF.CANCELLED:case uF.UNKNOWN:case uF.DEADLINE_EXCEEDED:case uF.RESOURCE_EXHAUSTED:case uF.INTERNAL:case uF.UNAVAILABLE:case uF.UNAUTHENTICATED:return!1;case uF.INVALID_ARGUMENT:case uF.NOT_FOUND:case uF.ALREADY_EXISTS:case uF.PERMISSION_DENIED:case uF.FAILED_PRECONDITION:case uF.ABORTED:case uF.OUT_OF_RANGE:case uF.UNIMPLEMENTED:case uF.DATA_LOSS:return!0}}function zB(e){if(void 0===e)return iF("GRPC error has no .code"),uF.UNKNOWN;switch(e){case BB.OK:return uF.OK;case BB.CANCELLED:return uF.CANCELLED;case BB.UNKNOWN:return uF.UNKNOWN;case BB.DEADLINE_EXCEEDED:return uF.DEADLINE_EXCEEDED;case BB.RESOURCE_EXHAUSTED:return uF.RESOURCE_EXHAUSTED;case BB.INTERNAL:return uF.INTERNAL;case BB.UNAVAILABLE:return uF.UNAVAILABLE;case BB.UNAUTHENTICATED:return uF.UNAUTHENTICATED;case BB.INVALID_ARGUMENT:return uF.INVALID_ARGUMENT;case BB.NOT_FOUND:return uF.NOT_FOUND;case BB.ALREADY_EXISTS:return uF.ALREADY_EXISTS;case BB.PERMISSION_DENIED:return uF.PERMISSION_DENIED;case BB.FAILED_PRECONDITION:return uF.FAILED_PRECONDITION;case BB.ABORTED:return uF.ABORTED;case BB.OUT_OF_RANGE:return uF.OUT_OF_RANGE;case BB.UNIMPLEMENTED:return uF.UNIMPLEMENTED;case BB.DATA_LOSS:return uF.DATA_LOSS;default:return aF()}}(VB=BB||(BB={}))[VB.OK=0]="OK",VB[VB.CANCELLED=1]="CANCELLED",VB[VB.UNKNOWN=2]="UNKNOWN",VB[VB.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",VB[VB.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",VB[VB.NOT_FOUND=5]="NOT_FOUND",VB[VB.ALREADY_EXISTS=6]="ALREADY_EXISTS",VB[VB.PERMISSION_DENIED=7]="PERMISSION_DENIED",VB[VB.UNAUTHENTICATED=16]="UNAUTHENTICATED",VB[VB.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",VB[VB.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",VB[VB.ABORTED=10]="ABORTED",VB[VB.OUT_OF_RANGE=11]="OUT_OF_RANGE",VB[VB.UNIMPLEMENTED=12]="UNIMPLEMENTED",VB[VB.INTERNAL=13]="INTERNAL",VB[VB.UNAVAILABLE=14]="UNAVAILABLE",VB[VB.DATA_LOSS=15]="DATA_LOSS";class HB{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){zF(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return HF(this.inner)}size(){return this.innerSize}}const GB=new GF(MF.comparator);function WB(){return GB}const qB=new GF(MF.comparator);function jB(...e){let t=qB;for(const n of e)t=t.insert(n.key,n);return t}function ZB(e){let t=qB;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function YB(){return QB()}function KB(){return QB()}function QB(){return new HB(e=>e.toString(),(e,t)=>e.isEqual(t))}const XB=new GF(MF.comparator),JB=new jF(MF.comparator);function eV(...e){let t=JB;for(const n of e)t=t.add(n);return t}const tV=new jF(bF);function nV(){return tV}class rV{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,iV.createSynthesizedTargetChangeForCurrentChange(e,t)),new rV(OF.min(),n,nV(),WB(),eV())}}class iV{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new iV(KF.EMPTY_BYTE_STRING,t,eV(),eV(),eV())}}class sV{constructor(e,t,n,r){this.gt=e,this.removedTargetIds=t,this.key=n,this.yt=r}}class oV{constructor(e,t){this.targetId=e,this.It=t}}class aV{constructor(e,t,n=KF.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class lV{constructor(){this.Tt=0,this.Et=hV(),this.At=KF.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}St(){let e=eV(),t=eV(),n=eV();return this.Et.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:aF()}}),new iV(this.At,this.Rt,e,t,n)}Dt(){this.bt=!1,this.Et=hV()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class cV{constructor(e){this.Mt=e,this.Ft=new Map,this.$t=WB(),this.Bt=uV(),this.Lt=new jF(bF)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const t of e.removedTargetIds)this.Kt(t,e.key,e.yt)}Gt(e){this.forEachTarget(e,t=>{const n=this.Qt(t);switch(e.state){case 0:this.jt(t)&&n.Vt(e.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(e.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(t);break;case 3:this.jt(t)&&(n.Ot(),n.Vt(e.resumeToken));break;case 4:this.jt(t)&&(this.Wt(t),n.Vt(e.resumeToken));break;default:aF()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach((e,n)=>{this.jt(n)&&t(n)})}zt(e){const t=e.targetId,n=e.It.count,r=this.Ht(t);if(r){const e=r.target;if(MU(e))if(0===n){const n=new MF(e.path);this.Kt(t,n,OU.newNoDocument(n,OF.min()))}else lF(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(e){const t=new Map;this.Ft.forEach((n,r)=>{const i=this.Ht(r);if(i){if(n.current&&MU(i.target)){const t=new MF(i.target.path);null!==this.$t.get(t)||this.Xt(r,t)||this.Kt(r,t,OU.newNoDocument(t,e))}n.vt&&(t.set(r,n.St()),n.Dt())}});let n=eV();this.Bt.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.Ht(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.$t.forEach((t,n)=>n.setReadTime(e));const r=new rV(e,t,this.Lt,this.$t,n);return this.$t=WB(),this.Bt=uV(),this.Lt=new jF(bF),r}qt(e,t){if(!this.jt(e))return;const n=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}Kt(e,t,n){if(!this.jt(e))return;const r=this.Qt(e);this.Xt(e,t)?r.Ct(t,1):r.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}removeTarget(e){this.Ft.delete(e)}Jt(e){const t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new lV,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new jF(bF),this.Bt=this.Bt.insert(e,t)),t}jt(e){const t=null!==this.Ht(e);return t||rF("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){const t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}Wt(e){this.Ft.set(e,new lV),this.Mt.getRemoteKeysForTarget(e).forEach(t=>{this.Kt(e,t,null)})}Xt(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}function uV(){return new GF(MF.comparator)}function hV(){return new GF(MF.comparator)}const dV={asc:"ASCENDING",desc:"DESCENDING"},pV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class fV{constructor(e,t){this.databaseId=e,this.dt=t}}function gV(e,t){return e.dt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mV(e,t){return e.dt?t.toBase64():t.toUint8Array()}function yV(e,t){return gV(e,t.toTimestamp())}function vV(e){return lF(!!e),OF.fromTimestamp(function(e){const t=XF(e);return new PF(t.seconds,t.nanos)}(e))}function _V(e,t){return(n=e,new IF(["projects",n.projectId,"databases",n.database])).child("documents").child(t).canonicalString();var n}function CV(e){const t=IF.fromString(e);return lF(UV(t)),t}function EV(e,t){return _V(e.databaseId,t.path)}function wV(e,t){const n=CV(t);if(n.get(1)!==e.databaseId.projectId)throw new hF(uF.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new hF(uF.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new MF(PV(n))}function bV(e,t){return _V(e.databaseId,t)}function SV(e){return new IF(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function PV(e){return lF(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function OV(e,t,n){return{name:EV(e,t),fields:n.value.mapValue.fields}}function TV(e,t){return{documents:[bV(e,t.path)]}}function IV(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=bV(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=bV(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(CU(e.value))return{unaryFilter:{field:RV(e.field),op:"IS_NAN"}};if(_U(e.value))return{unaryFilter:{field:RV(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(CU(e.value))return{unaryFilter:{field:RV(e.field),op:"IS_NOT_NAN"}};if(_U(e.value))return{unaryFilter:{field:RV(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:RV(e.field),op:NV(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>{return{field:RV((t=e).field),direction:MV(t.dir)};var t})}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=(a=t.limit,e.dt||oU(a)?a:{value:a});var a,l,c;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(l=t.startAt).inclusive,values:l.position}),t.endAt&&(n.structuredQuery.endAt={before:!(c=t.endAt).inclusive,values:c.position}),n}function kV(e){let t=function(e){const t=CV(e);return 4===t.length?IF.emptyPath():PV(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){lF(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=AV(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new zU(xV((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,oU(t)?null:t}(n.limit));let l=null;var c;n.startAt&&(l=new $U((c=n.startAt).values||[],!!c.before));let u=null;return n.endAt&&(u=function(e){return new $U(e.values||[],!e.before)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new qU(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",l,u)}function AV(e){return e?void 0!==e.unaryFilter?[LV(e)]:void 0!==e.fieldFilter?[DV(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>AV(e)).reduce((e,t)=>e.concat(t)):aF():[]}function MV(e){return dV[e]}function NV(e){return pV[e]}function RV(e){return{fieldPath:e.canonicalString()}}function xV(e){return AF.fromServerFormat(e.fieldPath)}function DV(e){return NU.create(xV(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return aF()}}(e.fieldFilter.op),e.fieldFilter.value)}function LV(e){switch(e.unaryFilter.op){case"IS_NAN":const t=xV(e.unaryFilter.field);return NU.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=xV(e.unaryFilter.field);return NU.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=xV(e.unaryFilter.field);return NU.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=xV(e.unaryFilter.field);return NU.create(i,"!=",{nullValue:"NULL_VALUE"});default:return aF()}}function FV(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function UV(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class BV{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&TB(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=IB(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=IB(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=KB();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=OB(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(OF.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),eV())}isEqual(e){return this.batchId===e.batchId&&SF(this.mutations,e.mutations,(e,t)=>AB(e,t))&&SF(this.baseMutations,e.baseMutations,(e,t)=>AB(e,t))}}class VV{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){lF(e.mutations.length===n.length);let r=XB;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new VV(e,t,n,r)}}class $V{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class zV{constructor(e,t,n,r,i=OF.min(),s=OF.min(),o=KF.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new zV(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new zV(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new zV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class HV{constructor(e){this.ne=e}}function GV(e){const t=kV({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?JU(t,t.limit,"L"):t}class WV{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(JF(e.integerValue));else if("doubleValue"in e){const n=JF(e.doubleValue);isNaN(n)?this.ce(t,13):(this.ce(t,15),aU(n)?t.ae(0):t.ae(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ce(t,20),"string"==typeof n?t.he(n):(t.he(`${n.seconds||""}`),t.ae(n.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(eU(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ce(t,45),t.ae(n.latitude||0),t.ae(n.longitude||0)}else"mapValue"in e?bU(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):aF()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){const n=e.fields||{};this.ce(t,55);for(const r of Object.keys(n))this.le(r,t),this.oe(n[r],t)}me(e,t){const n=e.values||[];this.ce(t,50);for(const r of n)this.oe(r,t)}_e(e,t){this.ce(t,37),MF.fromName(e).path.forEach(e=>{this.ce(t,60),this.ge(e,t)})}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}WV.ye=new WV;class qV{constructor(){this.ze=new jV}addToCollectionParentIndex(e,t){return this.ze.add(t),UF.resolve()}getCollectionParents(e,t){return UF.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return UF.resolve()}deleteFieldIndex(e,t){return UF.resolve()}getDocumentsMatchingTarget(e,t){return UF.resolve(null)}getIndexType(e,t){return UF.resolve(0)}getFieldIndexes(e,t){return UF.resolve([])}getNextCollectionGroupToUpdate(e){return UF.resolve(null)}getMinOffset(e,t){return UF.resolve(RF.min())}getMinOffsetFromCollectionGroup(e,t){return UF.resolve(RF.min())}updateCollectionGroup(e,t,n){return UF.resolve()}updateIndexEntries(e,t){return UF.resolve()}}class jV{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new jF(IF.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new jF(IF.comparator)).toArray()}}new Uint8Array(0);class ZV{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ZV(e,ZV.DEFAULT_COLLECTION_PERCENTILE,ZV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ZV.DEFAULT_COLLECTION_PERCENTILE=10,ZV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ZV.DEFAULT=new ZV(41943040,ZV.DEFAULT_COLLECTION_PERCENTILE,ZV.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ZV.DISABLED=new ZV(-1,0,0);class YV{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new YV(0)}static Rn(){return new YV(-1)}}class KV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class QV{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.getBaseDocument(e,t,n))).next(e=>(null!==n&&IB(n.mutation,e,YF.empty(),PF.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,eV()).next(()=>t))}getLocalViewOfDocuments(e,t,n=eV()){const r=YB();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=jB();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=YB();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,eV()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=WB();const s=QB(),o=QB();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof NB)?i=i.insert(t.key,t):void 0!==o&&(s.set(t.key,o.mutation.getFieldMask()),IB(o.mutation,t,o.mutation.getFieldMask(),PF.now()))}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new KV(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=QB();let r=new GF((e,t)=>e-t),i=eV();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||YF.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||eV()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,l=r.value,c=KB();l.forEach(e=>{if(!i.has(e)){const r=OB(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return UF.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return MF.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):KU(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):UF.resolve(YB());let o=-1,a=i;return s.next(t=>UF.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?UF.resolve():this.getBaseDocument(e,t,n).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,eV())).next(e=>({batchId:o,changes:ZB(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new MF(t)).next(e=>{let t=jB();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=jB();return this.indexManager.getCollectionParents(e,r).next(s=>UF.forEach(s,s=>{const o=(a=t,l=s.child(r),new qU(l,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,l;return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next(i=>(r=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId))).next(e=>{e.forEach((e,t)=>{const n=t.getKey();null===r.get(n)&&(r=r.insert(n,OU.newInvalidDocument(n)))});let n=jB();return r.forEach((r,i)=>{const s=e.get(r);void 0!==s&&IB(s.mutation,i,YF.empty(),PF.now()),rB(t,i)&&(n=n.insert(r,i))}),n})}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):UF.resolve(OU.newInvalidDocument(t))}}class XV{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return UF.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){var n;return this.Jn.set(t.id,{id:(n=t).id,version:n.version,createTime:vV(n.createTime)}),UF.resolve()}getNamedQuery(e,t){return UF.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,{name:(n=t).name,query:GV(n.bundledQuery),readTime:vV(n.readTime)}),UF.resolve();var n}}class JV{constructor(){this.overlays=new GF(MF.comparator),this.Xn=new Map}getOverlay(e,t){return UF.resolve(this.overlays.get(t))}getOverlays(e,t){const n=YB();return UF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ie(e,t,r)}),UF.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Xn.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Xn.delete(n)),UF.resolve()}getOverlaysForCollection(e,t,n){const r=YB(),i=t.length+1,s=new MF(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return UF.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new GF((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=YB(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=YB(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return UF.resolve(o)}ie(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new $V(t,n));let i=this.Xn.get(t);void 0===i&&(i=eV(),this.Xn.set(t,i)),this.Xn.set(t,i.add(n.key))}}class e${constructor(){this.Zn=new jF(t$.ts),this.es=new jF(t$.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const n=new t$(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new t$(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}us(e){const t=new MF(new IF([])),n=new t$(t,e),r=new t$(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}cs(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new MF(new IF([])),n=new t$(t,e),r=new t$(t,e+1);let i=eV();return this.es.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new t$(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class t${constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return MF.comparator(e.key,t.key)||bF(e.ls,t.ls)}static ns(e,t){return bF(e.ls,t.ls)||MF.comparator(e.key,t.key)}}class n${constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new jF(t$.ts)}checkEmpty(e){return UF.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.fs;this.fs++;const s=new BV(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.ds=this.ds.add(new t$(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return UF.resolve(s)}lookupMutationBatch(e,t){return UF.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=this.ws(t+1),r=n<0?0:n;return UF.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return UF.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(e){return UF.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new t$(t,0),r=new t$(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{const t=this._s(e.ls);i.push(t)}),UF.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new jF(bF);return t.forEach(e=>{const t=new t$(e,0),r=new t$(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,r],e=>{n=n.add(e.ls)})}),UF.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;MF.isDocumentKey(i)||(i=i.child(""));const s=new t$(new MF(i),0);let o=new jF(bF);return this.ds.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ls)),!0)},s),UF.resolve(this.gs(o))}gs(e){const t=[];return e.forEach(e=>{const n=this._s(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lF(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return UF.forEach(t.mutations,r=>{const i=new t$(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ds=n})}In(e){}containsKey(e,t){const n=new t$(t,0),r=this.ds.firstAfterOrEqual(n);return UF.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return UF.resolve()}ys(e,t){return this.ws(e)}ws(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}_s(e){const t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class r${constructor(e){this.ps=e,this.docs=new GF(MF.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return UF.resolve(n?n.document.mutableCopy():OU.newInvalidDocument(t))}getEntries(e,t){let n=WB();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():OU.newInvalidDocument(e))}),UF.resolve(n)}getAllFromCollection(e,t,n){let r=WB();const i=new MF(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||xF(NF(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return UF.resolve(r)}getAllFromCollectionGroup(e,t,n,r){aF()}Is(e,t){return UF.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new i$(this)}getSize(e){return UF.resolve(this.size)}}class i$ extends class{constructor(){this.changes=new HB(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,OU.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?UF.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}{constructor(e){super(),this.zn=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.zn.addEntry(e,r)):this.zn.removeEntry(n)}),UF.waitFor(t)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}class s${constructor(e){this.persistence=e,this.Ts=new HB(e=>kU(e),AU),this.lastRemoteSnapshotVersion=OF.min(),this.highestTargetId=0,this.Es=0,this.As=new e$,this.targetCount=0,this.Rs=YV.An()}forEachTarget(e,t){return this.Ts.forEach((e,n)=>t(n)),UF.resolve()}getLastRemoteSnapshotVersion(e){return UF.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return UF.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),UF.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),UF.resolve()}vn(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new YV(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,UF.resolve()}updateTargetData(e,t){return this.vn(t),UF.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,UF.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Ts.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Ts.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),UF.waitFor(i).next(()=>r)}getTargetCount(e){return UF.resolve(this.targetCount)}getTargetData(e,t){const n=this.Ts.get(t)||null;return UF.resolve(n)}addMatchingKeys(e,t,n){return this.As.ss(t,n),UF.resolve()}removeMatchingKeys(e,t,n){this.As.os(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),UF.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),UF.resolve()}getMatchingKeysForTargetId(e,t){const n=this.As.hs(t);return UF.resolve(n)}containsKey(e,t){return UF.resolve(this.As.containsKey(t))}}class o${constructor(e,t){this.bs={},this.overlays={},this.Ps=new VF(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new s$(this),this.indexManager=new qV,this.remoteDocumentCache=new r$(e=>this.referenceDelegate.Ss(e)),this.wt=new HV(t),this.Ds=new XV(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new JV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.bs[e.toKey()];return n||(n=new n$(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,n){rF("MemoryPersistence","Starting transaction:",e);const r=new a$(this.Ps.next());return this.referenceDelegate.Cs(),n(r).next(e=>this.referenceDelegate.xs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ns(e,t){return UF.or(Object.values(this.bs).map(n=>()=>n.containsKey(e,t)))}}class a$ extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}{constructor(e){super(),this.currentSequenceNumber=e}}class l${constructor(e){this.persistence=e,this.ks=new e$,this.Os=null}static Ms(e){return new l$(e)}get Fs(){if(this.Os)return this.Os;throw aF()}addReference(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),UF.resolve()}removeReference(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),UF.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),UF.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach(e=>this.Fs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Fs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Cs(){this.Os=new Set}xs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return UF.forEach(this.Fs,n=>{const r=MF.fromPath(n);return this.$s(e,r).next(e=>{e||t.removeEntry(r,OF.min())})}).next(()=>(this.Os=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(e=>{e?this.Fs.delete(t.toString()):this.Fs.add(t.toString())})}Ss(e){return 0}$s(e,t){return UF.or([()=>UF.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}class c${constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Pi=n,this.vi=r}static Vi(e,t){let n=eV(),r=eV();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new c$(e,t.fromCache,n,r)}}class u${constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ci(e,t).next(i=>i||this.xi(e,t,r,n)).next(n=>n||this.Ni(e,t))}Ci(e,t){return UF.resolve(null)}xi(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||r.isEqual(OF.min())?this.Ni(e,t):this.Di.getDocuments(e,n).next(i=>{const s=this.ki(t,i);return this.Oi(t,s,n,r)?this.Ni(e,t):(nF()<=Pb.DEBUG&&rF("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nB(t)),this.Mi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=OF.fromTimestamp(1e9===r?new PF(n+1,0):new PF(n,r));return new RF(i,MF.empty(),t)}(r,-1)))})}ki(e,t){let n=new jF(iB(e));return t.forEach((t,r)=>{rB(e,r)&&(n=n.add(r))}),n}Oi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ni(e,t){return nF()<=Pb.DEBUG&&rF("QueryEngine","Using full collection scan to execute query:",nB(t)),this.Di.getDocumentsMatchingQuery(e,t,RF.min())}Mi(e,t,n,r){return this.Di.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class h${constructor(e,t,n,r){this.persistence=e,this.Fi=t,this.wt=r,this.$i=new GF(bF),this.Bi=new HB(e=>kU(e),AU),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(n)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new QV(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.$i))}}function d$(e,t){return p$.apply(this,arguments)}function p$(){return(p$=Pw(function*(e,t){const n=cF(e);return yield n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.qi(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=eV();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ki:e,removedBatchIds:i,addedBatchIds:s}))})})})).apply(this,arguments)}function f$(e,t){const n=cF(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=UF.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);lF(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=eV();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function g$(e){const t=cF(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Vs.getLastRemoteSnapshotVersion(e))}function m$(e,t){const n=cF(e),r=t.snapshotVersion;let i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;const o=[];t.targetChanges.forEach((s,a)=>{const l=i.get(a);if(!l)return;o.push(n.Vs.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Vs.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);var u,h,d;t.targetMismatches.has(a)?c=c.withResumeToken(KF.EMPTY_BYTE_STRING,OF.min()).withLastLimboFreeSnapshotVersion(OF.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),h=c,d=s,(0===(u=l).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Vs.updateTargetData(e,c))});let a=WB(),l=eV();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=eV(),i=eV();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=WB();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(OF.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):rF("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Gi:r,Qi:i}})}(e,s,t.documentUpdates).next(e=>{a=e.Gi,l=e.Qi})),!r.isEqual(OF.min())){const t=n.Vs.getLastRemoteSnapshotVersion(e).next(t=>n.Vs.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return UF.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.$i=i,e))}function y$(e,t){const n=cF(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function v$(e,t){const n=cF(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Vs.getTargetData(e,t).next(i=>i?(r=i,UF.resolve(r)):n.Vs.allocateTargetId(e).next(i=>(r=new zV(t,i,0,e.currentSequenceNumber),n.Vs.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.$i.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(e.targetId,e),n.Bi.set(t,e.targetId)),e})}function _$(e,t,n){return C$.apply(this,arguments)}function C$(){return(C$=Pw(function*(e,t,n){const r=cF(e),i=r.$i.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!BF(o))throw o;rF("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.$i=r.$i.remove(t),r.Bi.delete(i.target)})).apply(this,arguments)}function E$(e,t,n){const r=cF(e);let i=OF.min(),s=eV();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=cF(e),i=r.Bi.get(n);return void 0!==i?UF.resolve(r.$i.get(i)):r.Vs.getTargetData(t,n)}(r,e,XU(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Fi.getDocumentsMatchingQuery(e,t,n?i:OF.min(),n?s:eV())).next(e=>(function(e,t,n){let r=OF.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Li.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ji:s})))}class w${constructor(){this.activeTargetIds=nV()}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class b${constructor(){this.Fr=new w$,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,n){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new w$,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class S${Br(e){}shutdown(){}}class P${constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){rF("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){rF("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const O$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class T${constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}class I$ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.so=(e.ssl?"https":"http")+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(e,t,n,r,i){const s=this.oo(e,t);rF("RestConnection","Sending: ",s,n);const o={};return this.uo(o,r,i),this.co(e,s,o,n).then(e=>(rF("RestConnection","Received: ",e),e),t=>{throw sF("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}ao(e,t,n,r,i,s){return this.ro(e,t,n,r,i)}uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+eF,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}oo(e,t){return`${this.so}/v1/${t}:${O$[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,n,r){return new Promise((i,s)=>{const o=new QL;o.listenOnce(qL.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case WL.NO_ERROR:const t=o.getResponseJson();rF("Connection","XHR received:",JSON.stringify(t)),i(t);break;case WL.TIMEOUT:rF("Connection",'RPC "'+e+'" timed out'),s(new hF(uF.DEADLINE_EXCEEDED,"Request time out"));break;case WL.HTTP_ERROR:const n=o.getStatus();if(rF("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(uF).indexOf(t)>=0?t:uF.UNKNOWN}(e.status);s(new hF(t,e.message))}else s(new hF(uF.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new hF(uF.UNAVAILABLE,"Connection failed."));break;default:aF()}}finally{rF("Connection",'RPC "'+e+'" completed.')}});const a=JSON.stringify(r);o.send(t,"POST",a,n,15)})}ho(e,t,n){const r=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=HL(),s=GL(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new YL({})),this.uo(o.initMessageHeaders,t,n),Ww()||jw()||Gw().indexOf("Electron/")>=0||Zw()||Gw().indexOf("MSAppHost/")>=0||qw()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");rF("Connection","Creating WebChannel: "+a,o);const l=i.createWebChannel(a,o);let c=!1,u=!1;const h=new T$({jr:e=>{u?rF("Connection","Not sending because WebChannel is closed:",e):(c||(rF("Connection","Opening WebChannel transport."),l.open(),c=!0),rF("Connection","WebChannel sending:",e),l.send(e))},Wr:()=>l.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return d(l,KL.EventType.OPEN,()=>{u||rF("Connection","WebChannel transport opened.")}),d(l,KL.EventType.CLOSE,()=>{u||(u=!0,rF("Connection","WebChannel transport closed"),h.eo())}),d(l,KL.EventType.ERROR,e=>{u||(u=!0,sF("Connection","WebChannel transport errored:",e),h.eo(new hF(uF.UNAVAILABLE,"The operation could not be completed")))}),d(l,KL.EventType.MESSAGE,e=>{var t;if(!u){const n=e.data[0];lF(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){rF("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=BB[e];if(void 0!==t)return zB(t)}(e),n=i.message;void 0===t&&(t=uF.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),u=!0,h.eo(new hF(t,n)),l.close()}else rF("Connection","WebChannel received:",n),h.no(n)}}),d(s,jL.STAT_EVENT,e=>{e.stat===ZL.PROXY?rF("Connection","Detected buffering proxy"):e.stat===ZL.NOPROXY&&rF("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.Zr()},0),h}}function k$(){return"undefined"!=typeof document?document:null}function A$(e){return new fV(e,!0)}class M${constructor(e,t,n=1e3,r=1.5,i=6e4){this.js=e,this.timerId=t,this.lo=n,this.fo=r,this._o=i,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();const t=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),r=Math.max(0,t-n);r>0&&rF("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,r,()=>(this.yo=Date.now(),e())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class N${constructor(e,t,n,r,i,s,o,a){this.js=e,this.Ao=n,this.Ro=r,this.bo=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new M$(e,t)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}stop(){var e=this;return Pw(function*(){e.Do()&&(yield e.close(0))})()}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Oo()))}Mo(e){this.Fo(),this.stream.send(e)}Oo(){var e=this;return Pw(function*(){if(e.Co())return e.close(0)})()}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}close(e,t){var n=this;return Pw(function*(){n.Fo(),n.$o(),n.So.cancel(),n.Po++,4!==e?n.So.reset():t&&t.code===uF.RESOURCE_EXHAUSTED?(iF(t.toString()),iF("Using maximum backoff delay to prevent overloading the backend."),n.So.po()):t&&t.code===uF.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Bo(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.Jr(t)})()}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),t=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Po===t&&this.Uo(e,n)},t=>{e(()=>{const e=new hF(uF.UNKNOWN,"Fetching auth token failed: "+t.message);return this.qo(e)})})}Uo(e,t){const n=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(()=>{n(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(e=>{n(()=>this.qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}xo(){var e=this;this.state=5,this.So.Io(Pw(function*(){e.state=0,e.start()}))}qo(e){return rF("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(e){return t=>{this.js.enqueueAndForget(()=>this.Po===e?t():(rF("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class R$ extends N${constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.wt=i}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();const t=function(e,t){let n;if("targetChange"in t){const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:aF(),s=t.targetChange.targetIds||[],o=function(e,t){return e.dt?(lF(void 0===t||"string"==typeof t),KF.fromBase64String(t||"")):(lF(void 0===t||t instanceof Uint8Array),KF.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(e){const t=void 0===e.code?uF.UNKNOWN:zB(e.code);return new hF(t,e.message||"")}(a);n=new aV(i,s,o,l||null)}else if("documentChange"in t){const r=t.documentChange,i=wV(e,r.document.name),s=vV(r.document.updateTime),o=new SU({mapValue:{fields:r.document.fields}}),a=OU.newFoundDocument(i,s,o);n=new sV(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in t){const r=t.documentDelete,i=wV(e,r.document),s=r.readTime?vV(r.readTime):OF.min(),o=OU.newNoDocument(i,s);n=new sV([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){const r=t.documentRemove,i=wV(e,r.document);n=new sV([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return aF();{const e=t.filter,r=new UB(e.count||0);n=new oV(e.targetId,r)}}var r;return n}(this.wt,e),n=function(e){if(!("targetChange"in e))return OF.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?OF.min():t.readTime?vV(t.readTime):OF.min()}(e);return this.listener.Go(t,n)}Qo(e){const t={};t.database=SV(this.wt),t.addTarget=function(e,t){let n;const r=t.target;return n=MU(r)?{documents:TV(e,r)}:{query:IV(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=mV(e,t.resumeToken):t.snapshotVersion.compareTo(OF.min())>0&&(n.readTime=gV(e,t.snapshotVersion.toTimestamp())),n}(this.wt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return aF()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.Mo(t)}jo(e){const t={};t.database=SV(this.wt),t.removeTarget=e,this.Mo(t)}}class x$ extends N${constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.wt=i,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(lF(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();const t=function(e,t){return e&&e.length>0?(lF(void 0!==t),e.map(e=>function(e,t){let n=vV(e.updateTime?e.updateTime:t);return n.isEqual(OF.min())&&(n=vV(t)),new wB(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=vV(e.commitTime);return this.listener.Jo(n,t)}return lF(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=SV(this.wt),this.Mo(e)}Ho(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof MB)n={update:OV(e,t.key,t.value)};else if(t instanceof LB)n={delete:EV(e,t.key)};else if(t instanceof NB)n={update:OV(e,t.key,t.data),updateMask:FV(t.fieldMask)};else{if(!(t instanceof FB))return aF();n={verify:EV(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof pB)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof fB)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof mB)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof vB)return{fieldPath:t.field.canonicalString(),increment:n._t};throw aF()}(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:yV(e,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:aF()),n;var r}(this.wt,e))};this.Mo(t)}}class D$ extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=n,this.wt=r,this.Zo=!1}tu(){if(this.Zo)throw new hF(uF.FAILED_PRECONDITION,"The client has already been terminated.")}ro(e,t,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.bo.ro(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uF.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hF(uF.UNKNOWN,e.toString())})}ao(e,t,n,r){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.bo.ao(e,t,n,i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uF.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hF(uF.UNKNOWN,e.toString())})}terminate(){this.Zo=!0}}class L${constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(iF(t),this.su=!1):rF("OnlineStateTracker",t)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class F${constructor(e,t,n,r,i){var s=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=i,this.du.Br(e=>{n.enqueueAndForget(Pw(function*(){var e;Z$(s)&&(rF("RemoteStore","Restarting streams for network reachability change."),yield(e=Pw(function*(e){const t=cF(e);t.lu.add(4),yield V$(t),t._u.set("Unknown"),t.lu.delete(4),yield U$(t)}),function(t){return e.apply(this,arguments)})(s))}))}),this._u=new L$(n,r)}}function U$(e){return B$.apply(this,arguments)}function B$(){return(B$=Pw(function*(e){if(Z$(e))for(const t of e.fu)yield t(!0)})).apply(this,arguments)}function V$(e){return $$.apply(this,arguments)}function $$(){return($$=Pw(function*(e){for(const t of e.fu)yield t(!1)})).apply(this,arguments)}function z$(e,t){const n=cF(e);n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),j$(n)?q$(n):wz(n).Co()&&G$(n,t))}function H$(e,t){const n=cF(e),r=wz(n);n.hu.delete(t),r.Co()&&W$(n,t),0===n.hu.size&&(r.Co()?r.ko():Z$(n)&&n._u.set("Unknown"))}function G$(e,t){e.wu.Nt(t.targetId),wz(e).Qo(t)}function W$(e,t){e.wu.Nt(t),wz(e).jo(t)}function q$(e){e.wu=new cV({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),te:t=>e.hu.get(t)||null}),wz(e).start(),e._u.iu()}function j$(e){return Z$(e)&&!wz(e).Do()&&e.hu.size>0}function Z$(e){return 0===cF(e).lu.size}function Y$(e){e.wu=void 0}function K$(e){return Q$.apply(this,arguments)}function Q$(){return(Q$=Pw(function*(e){e.hu.forEach((t,n)=>{G$(e,t)})})).apply(this,arguments)}function X$(e,t){return J$.apply(this,arguments)}function J$(){return(J$=Pw(function*(e,t){Y$(e),j$(e)?(e._u.uu(t),q$(e)):e._u.set("Unknown")})).apply(this,arguments)}function ez(e,t,n){return tz.apply(this,arguments)}function tz(){return(tz=Pw(function*(e,t,n){if(e._u.set("Online"),t instanceof aV&&2===t.state&&t.cause)try{yield(r=Pw(function*(e,t){const n=t.cause;for(const r of t.targetIds)e.hu.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e.hu.delete(r),e.wu.removeTarget(r))}),function(e,t){return r.apply(this,arguments)})(e,t)}catch(r){rF("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield nz(e,r)}else if(t instanceof sV?e.wu.Ut(t):t instanceof oV?e.wu.zt(t):e.wu.Gt(t),!n.isEqual(OF.min()))try{const t=yield g$(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.wu.Yt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.hu.get(r);i&&e.hu.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.hu.get(t);if(!n)return;e.hu.set(t,n.withResumeToken(KF.EMPTY_BYTE_STRING,n.snapshotVersion)),W$(e,t);const r=new zV(n.target,t,1,n.sequenceNumber);G$(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){rF("RemoteStore","Failed to raise snapshot:",r),yield nz(e,r)}var r})).apply(this,arguments)}function nz(e,t,n){return rz.apply(this,arguments)}function rz(){return(rz=Pw(function*(e,t,n){if(!BF(t))throw t;e.lu.add(1),yield V$(e),e._u.set("Offline"),n||(n=()=>g$(e.localStore)),e.asyncQueue.enqueueRetryable(Pw(function*(){rF("RemoteStore","Retrying IndexedDB access"),yield n(),e.lu.delete(1),yield U$(e)}))})).apply(this,arguments)}function iz(e,t){return t().catch(n=>nz(e,n,t))}function sz(e){return oz.apply(this,arguments)}function oz(){return(oz=Pw(function*(e){const t=cF(e),n=bz(t);let r=t.au.length>0?t.au[t.au.length-1].batchId:-1;for(;az(t);)try{const e=yield y$(t.localStore,r);if(null===e){0===t.au.length&&n.ko();break}r=e.batchId,lz(t,e)}catch(i){yield nz(t,i)}cz(t)&&uz(t)})).apply(this,arguments)}function az(e){return Z$(e)&&e.au.length<10}function lz(e,t){e.au.push(t);const n=bz(e);n.Co()&&n.zo&&n.Ho(t.mutations)}function cz(e){return Z$(e)&&!bz(e).Do()&&e.au.length>0}function uz(e){bz(e).start()}function hz(e){return dz.apply(this,arguments)}function dz(){return(dz=Pw(function*(e){bz(e).Xo()})).apply(this,arguments)}function pz(e){return fz.apply(this,arguments)}function fz(){return(fz=Pw(function*(e){const t=bz(e);for(const n of e.au)t.Ho(n.mutations)})).apply(this,arguments)}function gz(e,t,n){return mz.apply(this,arguments)}function mz(){return(mz=Pw(function*(e,t,n){const r=e.au.shift(),i=VV.from(r,t,n);yield iz(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield sz(e)})).apply(this,arguments)}function yz(e,t){return vz.apply(this,arguments)}function vz(){return(vz=Pw(function*(e,t){var n;t&&bz(e).zo&&(yield(n=Pw(function*(e,t){if($B(n=t.code)&&n!==uF.ABORTED){const n=e.au.shift();bz(e).No(),yield iz(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield sz(e)}var n}),function(e,t){return n.apply(this,arguments)})(e,t)),cz(e)&&uz(e)})).apply(this,arguments)}function _z(e,t){return Cz.apply(this,arguments)}function Cz(){return(Cz=Pw(function*(e,t){const n=cF(e);n.asyncQueue.verifyOperationInProgress(),rF("RemoteStore","RemoteStore received new credentials");const r=Z$(n);n.lu.add(3),yield V$(n),r&&n._u.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.lu.delete(3),yield U$(n)})).apply(this,arguments)}function Ez(){return(Ez=Pw(function*(e,t){const n=cF(e);t?(n.lu.delete(2),yield U$(n)):t||(n.lu.add(2),yield V$(n),n._u.set("Unknown"))})).apply(this,arguments)}function wz(e){return e.mu||(e.mu=function(e,t,n){const r=cF(e);return r.tu(),new R$(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:K$.bind(null,e),Jr:X$.bind(null,e),Go:ez.bind(null,e)}),e.fu.push(function(){var t=Pw(function*(t){t?(e.mu.No(),j$(e)?q$(e):e._u.set("Unknown")):(yield e.mu.stop(),Y$(e))});return function(e){return t.apply(this,arguments)}}())),e.mu}function bz(e){return e.gu||(e.gu=function(e,t,n){const r=cF(e);return r.tu(),new x$(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:hz.bind(null,e),Jr:yz.bind(null,e),Yo:pz.bind(null,e),Jo:gz.bind(null,e)}),e.fu.push(function(){var t=Pw(function*(t){t?(e.gu.No(),yield sz(e)):(yield e.gu.stop(),e.au.length>0&&(rF("RemoteStore",`Stopping write stream with ${e.au.length} pending writes`),e.au=[]))});return function(e){return t.apply(this,arguments)}}())),e.gu}class Sz{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new dF,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sz(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new hF(uF.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pz(e,t){if(iF("AsyncQueue",`${t}: ${e}`),BF(e))return new hF(uF.UNAVAILABLE,`${t}: ${e}`);throw e}class Oz{constructor(e){this.comparator=e?(t,n)=>e(t,n)||MF.comparator(t.key,n.key):(e,t)=>MF.comparator(e.key,t.key),this.keyedMap=jB(),this.sortedSet=new GF(this.comparator)}static emptySet(e){return new Oz(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Oz)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Oz;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Tz{constructor(){this.yu=new GF(MF.comparator)}track(e){const t=e.doc.key,n=this.yu.get(t);n?0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):aF():this.yu=this.yu.insert(t,e)}pu(){const e=[];return this.yu.inorderTraversal((t,n)=>{e.push(n)}),e}}class Iz{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Iz(e,t,Oz.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&eB(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class kz{constructor(){this.Iu=void 0,this.listeners=[]}}class Az{constructor(){this.queries=new HB(e=>tB(e),eB),this.onlineState="Unknown",this.Tu=new Set}}function Mz(e,t){return Nz.apply(this,arguments)}function Nz(){return(Nz=Pw(function*(e,t){const n=cF(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new kz),i)try{s.Iu=yield n.onListen(r)}catch(o){const e=Pz(o,`Initialization of query '${nB(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.listeners.push(t),t.Eu(n.onlineState),s.Iu&&t.Au(s.Iu)&&Fz(n)})).apply(this,arguments)}function Rz(e,t){return xz.apply(this,arguments)}function xz(){return(xz=Pw(function*(e,t){const n=cF(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)})).apply(this,arguments)}function Dz(e,t){const n=cF(e);let r=!1;for(const i of t){const e=n.queries.get(i.query);if(e){for(const t of e.listeners)t.Au(i)&&(r=!0);e.Iu=i}}r&&Fz(n)}function Lz(e,t,n){const r=cF(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function Fz(e){e.Tu.forEach(e=>{e.next()})}class Uz{constructor(e,t,n){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Iz(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){return!e.fromCache||!(this.options.Du&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}vu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Su(e){e=Iz.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}class Bz{constructor(e){this.key=e}}class Vz{constructor(e){this.key=e}}class $z{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=eV(),this.mutatedKeys=eV(),this.Lu=iB(e),this.Uu=new Oz(this.Lu)}get qu(){return this.Fu}Ku(e,t){const n=t?t.Gu:new Tz,r=t?t.Uu:this.Uu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=rB(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.Qu(c,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.Lu(u,a)>0||l&&this.Lu(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Uu:s,Gu:n,Oi:o,mutatedKeys:i}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const i=e.Gu.pu();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return aF()}};return n(e)-n(t)}(e.type,t.type)||this.Lu(e.doc,t.doc)),this.ju(n);const s=t?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==i.length||a?{snapshot:new Iz(this.query,e.Uu,r,i,e.mutatedKeys,0===o,a,!1),zu:s}:{zu:s}}Eu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new Tz,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach(e=>this.Fu=this.Fu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Fu=this.Fu.delete(e)),this.current=e.current)}Wu(){if(!this.current)return[];const e=this.Bu;this.Bu=eV(),this.Uu.forEach(e=>{this.Hu(e.key)&&(this.Bu=this.Bu.add(e.key))});const t=[];return e.forEach(e=>{this.Bu.has(e)||t.push(new Vz(e))}),this.Bu.forEach(n=>{e.has(n)||t.push(new Bz(n))}),t}Ju(e){this.Fu=e.ji,this.Bu=eV();const t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return Iz.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class zz{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Hz{constructor(e){this.key=e,this.Xu=!1}}class Gz{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Zu={},this.tc=new HB(e=>tB(e),eB),this.ec=new Map,this.nc=new Set,this.sc=new GF(MF.comparator),this.ic=new Map,this.rc=new e$,this.oc={},this.uc=new Map,this.cc=YV.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}function Wz(e,t){return qz.apply(this,arguments)}function qz(){return(qz=Pw(function*(e,t){const n=_H(e);let r,i;const s=n.tc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Yu();else{const e=yield v$(n.localStore,XU(t));n.isPrimaryClient&&z$(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=yield jz(n,t,r,"current"===s)}return i})).apply(this,arguments)}function jz(e,t,n,r){return Zz.apply(this,arguments)}function Zz(){return(Zz=Pw(function*(e,t,n,r){e.hc=(t,n,r)=>{return(i=Pw(function*(e,t,n,r){let i=t.view.Ku(n);i.Oi&&(i=yield E$(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ku(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return hH(e,t.targetId,o.zu),o.snapshot}),function(e,t,n,r){return i.apply(this,arguments)})(e,t,n,r);var i};const i=yield E$(e.localStore,t,!0),s=new $z(t,i.ji),o=s.Ku(i.documents),a=iV.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),l=s.applyChanges(o,e.isPrimaryClient,a);hH(e,n,l.zu);const c=new zz(t,n,s);return e.tc.set(t,c),e.ec.has(n)?e.ec.get(n).push(t):e.ec.set(n,[t]),l.snapshot})).apply(this,arguments)}function Yz(e,t){return Kz.apply(this,arguments)}function Kz(){return(Kz=Pw(function*(e,t){const n=cF(e),r=n.tc.get(t),i=n.ec.get(r.targetId);if(i.length>1)return n.ec.set(r.targetId,i.filter(e=>!eB(e,t))),void n.tc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield _$(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),H$(n.remoteStore,r.targetId),cH(n,r.targetId)}).catch(LF))):(cH(n,r.targetId),yield _$(n.localStore,r.targetId,!0))})).apply(this,arguments)}function Qz(){return(Qz=Pw(function*(e,t,n){const r=CH(e);try{const e=yield function(e,t){const n=cF(e),r=PF.now(),i=t.reduce((e,t)=>e.add(t.key),eV());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=WB(),l=eV();return n.Ui.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=kB(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new NB(e.key,t,PU(t.value.mapValue),bB.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:ZB(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.oc[e.currentUser.toKey()];r||(r=new GF(bF)),r=r.insert(t,n),e.oc[e.currentUser.toKey()]=r}(r,e.batchId,n),yield fH(r,e.changes),yield sz(r.remoteStore)}catch(i){const e=Pz(i,"Failed to persist write");n.reject(e)}})).apply(this,arguments)}function Xz(e,t){return Jz.apply(this,arguments)}function Jz(){return(Jz=Pw(function*(e,t){const n=cF(e);try{const e=yield m$(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.ic.get(t);r&&(lF(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Xu=!0:e.modifiedDocuments.size>0?lF(r.Xu):e.removedDocuments.size>0&&(lF(r.Xu),r.Xu=!1))}),yield fH(n,e,t)}catch(r){yield LF(r)}})).apply(this,arguments)}function eH(e,t,n){const r=cF(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.tc.forEach((n,r)=>{const i=r.view.Eu(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=cF(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.Eu(t)&&(r=!0)}),r&&Fz(n)}(r.eventManager,t),e.length&&r.Zu.Go(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function tH(e,t,n){return nH.apply(this,arguments)}function nH(){return(nH=Pw(function*(e,t,n){const r=cF(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.ic.get(t),s=i&&i.key;if(s){let e=new GF(MF.comparator);e=e.insert(s,OU.newNoDocument(s,OF.min()));const n=eV().add(s),i=new rV(OF.min(),new Map,new jF(bF),e,n);yield Xz(r,i),r.sc=r.sc.remove(s),r.ic.delete(t),pH(r)}else yield _$(r.localStore,t,!1).then(()=>cH(r,t,n)).catch(LF)})).apply(this,arguments)}function rH(e,t){return iH.apply(this,arguments)}function iH(){return(iH=Pw(function*(e,t){const n=cF(e),r=t.batch.batchId;try{const e=yield f$(n.localStore,t);lH(n,r,null),aH(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield fH(n,e)}catch(i){yield LF(i)}})).apply(this,arguments)}function sH(e,t,n){return oH.apply(this,arguments)}function oH(){return(oH=Pw(function*(e,t,n){const r=cF(e);try{const e=yield function(e,t){const n=cF(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(lF(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);lH(r,t,n),aH(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield fH(r,e)}catch(i){yield LF(i)}})).apply(this,arguments)}function aH(e,t){(e.uc.get(t)||[]).forEach(e=>{e.resolve()}),e.uc.delete(t)}function lH(e,t,n){const r=cF(e);let i=r.oc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.oc[r.currentUser.toKey()]=i}}function cH(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.ec.get(t))e.tc.delete(r),n&&e.Zu.lc(r,n);e.ec.delete(t),e.isPrimaryClient&&e.rc.us(t).forEach(t=>{e.rc.containsKey(t)||uH(e,t)})}function uH(e,t){e.nc.delete(t.path.canonicalString());const n=e.sc.get(t);null!==n&&(H$(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),pH(e))}function hH(e,t,n){for(const r of n)r instanceof Bz?(e.rc.addReference(r.key,t),dH(e,r)):r instanceof Vz?(rF("SyncEngine","Document no longer in limbo: "+r.key),e.rc.removeReference(r.key,t),e.rc.containsKey(r.key)||uH(e,r.key)):aF()}function dH(e,t){const n=t.key,r=n.path.canonicalString();e.sc.get(n)||e.nc.has(r)||(rF("SyncEngine","New document in limbo: "+n),e.nc.add(r),pH(e))}function pH(e){for(;e.nc.size>0&&e.sc.size<e.maxConcurrentLimboResolutions;){const t=e.nc.values().next().value;e.nc.delete(t);const n=new MF(IF.fromString(t)),r=e.cc.next();e.ic.set(r,new Hz(n)),e.sc=e.sc.insert(n,r),z$(e.remoteStore,new zV(XU(jU(n.path)),r,2,VF.ot))}}function fH(e,t,n){return gH.apply(this,arguments)}function gH(){return(gH=Pw(function*(e,t,n){const r=cF(e),i=[],s=[],o=[];var a;r.tc.isEmpty()||(r.tc.forEach((e,a)=>{o.push(r.hc(a,t,n).then(e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=c$.Vi(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),r.Zu.Go(i),yield(a=Pw(function*(e,t){const n=cF(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>UF.forEach(t,t=>UF.forEach(t.Pi,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>UF.forEach(t.vi,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!BF(r))throw r;rF("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.$i.get(e),r=t.withLastLimboFreeSnapshotVersion(t.snapshotVersion);n.$i=n.$i.insert(e,r)}}}),function(e,t){return a.apply(this,arguments)})(r.localStore,s))})).apply(this,arguments)}function mH(e,t){return yH.apply(this,arguments)}function yH(){return(yH=Pw(function*(e,t){const n=cF(e);if(!n.currentUser.isEqual(t)){rF("SyncEngine","User change. New user:",t.toKey());const e=yield d$(n.localStore,t);n.currentUser=t,(r=n).uc.forEach(e=>{e.forEach(e=>{e.reject(new hF(uF.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.uc.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield fH(n,e.Ki)}var r})).apply(this,arguments)}function vH(e,t){const n=cF(e),r=n.ic.get(t);if(r&&r.Xu)return eV().add(r.key);{let e=eV();const r=n.ec.get(t);if(!r)return e;for(const t of r){const r=n.tc.get(t);e=e.unionWith(r.view.qu)}return e}}function _H(e){const t=cF(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xz.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=vH.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=tH.bind(null,t),t.Zu.Go=Dz.bind(null,t.eventManager),t.Zu.lc=Lz.bind(null,t.eventManager),t}function CH(e){const t=cF(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=rH.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=sH.bind(null,t),t}class EH{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return Pw(function*(){t.wt=A$(e.databaseInfo.databaseId),t.sharedClientState=t.dc(e),t.persistence=t._c(e),yield t.persistence.start(),t.localStore=t.wc(e),t.gcScheduler=t.mc(e,t.localStore),t.indexBackfillerScheduler=t.gc(e,t.localStore)})()}mc(e,t){return null}gc(e,t){return null}wc(e){return function(e,t,n,r){return new h$(e,t,n,r)}(this.persistence,new u$,e.initialUser,this.wt)}_c(e){return new o$(l$.Ms,this.wt)}dc(e){return new b$}terminate(){var e=this;return Pw(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class wH{initialize(e,t){var n=this;return Pw(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=e=>eH(n.syncEngine,e,1),n.remoteStore.remoteSyncer.handleCredentialChange=mH.bind(null,n.syncEngine),yield function(e,t){return Ez.apply(this,arguments)}(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Az}createDatastore(e){const t=A$(e.databaseInfo.databaseId),n=new I$(e.databaseInfo);return new D$(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>eH(this.syncEngine,e,0),s=P$.V()?new P$:new S$,new F$(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Gz(e,t,n,r,i,s);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=Pw(function*(e){const t=cF(e);rF("RemoteStore","RemoteStore shutting down."),t.lu.add(5),yield V$(t),t.du.shutdown(),t._u.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class bH{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class SH{constructor(e,t,n,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=JL.UNAUTHENTICATED,this.clientId=wF.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var e=Pw(function*(e){rF("FirestoreClient","Received user=",e.uid),yield i.authCredentialListener(e),i.user=e});return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(n,e=>(rF("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}getConfiguration(){var e=this;return Pw(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new hF(uF.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new dF;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Pw(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const e=Pz(n,"Failed to shutdown persistence");t.reject(e)}})),t.promise}}function PH(e,t){return OH.apply(this,arguments)}function OH(){return(OH=Pw(function*(e,t){e.asyncQueue.verifyOperationInProgress(),rF("FirestoreClient","Initializing OfflineComponentProvider");const n=yield e.getConfiguration();yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(function(){var e=Pw(function*(e){r.isEqual(e)||(yield d$(t.localStore,e),r=e)});return function(t){return e.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t})).apply(this,arguments)}function TH(e,t){return IH.apply(this,arguments)}function IH(){return(IH=Pw(function*(e,t){e.asyncQueue.verifyOperationInProgress();const n=yield kH(e);rF("FirestoreClient","Initializing OnlineComponentProvider");const r=yield e.getConfiguration();yield t.initialize(n,r),e.setCredentialChangeListener(e=>_z(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>_z(t.remoteStore,n)),e.onlineComponents=t})).apply(this,arguments)}function kH(e){return AH.apply(this,arguments)}function AH(){return(AH=Pw(function*(e){return e.offlineComponents||(rF("FirestoreClient","Using default OfflineComponentProvider"),yield PH(e,new EH)),e.offlineComponents})).apply(this,arguments)}function MH(e){return NH.apply(this,arguments)}function NH(){return(NH=Pw(function*(e){return e.onlineComponents||(rF("FirestoreClient","Using default OnlineComponentProvider"),yield TH(e,new wH)),e.onlineComponents})).apply(this,arguments)}function RH(e){return xH.apply(this,arguments)}function xH(){return(xH=Pw(function*(e){const t=yield MH(e),n=t.eventManager;return n.onListen=Wz.bind(null,t.syncEngine),n.onUnlisten=Yz.bind(null,t.syncEngine),n})).apply(this,arguments)}const DH=new Map;function LH(e,t,n){if(!n)throw new hF(uF.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function FH(e){if(!MF.isDocumentKey(e))throw new hF(uF.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function UH(e){if(MF.isDocumentKey(e))throw new hF(uF.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function BH(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":aF()}function VH(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new hF(uF.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=BH(e);throw new hF(uF.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class $H{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new hF(uF.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new hF(uF.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new hF(uF.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zH{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $H({}),this._settingsFrozen=!1,e instanceof sU?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new hF(uF.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sU(e.options.projectId)}(e))}get app(){if(!this._app)throw new hF(uF.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new hF(uF.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $H(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new fF;switch(e.type){case"gapi":const t=e.client;return lF(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new vF(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new hF(uF.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=DH.get(e);t&&(rF("ComponentProvider","Removing Datastore"),DH.delete(e),t.terminate())}(this),Promise.resolve()}}function HH(e,t,n,r={}){var i;const s=(e=VH(e,zH))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&sF("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=JL.MOCK_USER;else{t=Hw(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new hF(uF.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new JL(s)}e._authCredentials=new gF(new pF(t,n))}}class GH{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qH(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new GH(this.firestore,e,this._key)}}class WH{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new WH(this.firestore,e,this._query)}}class qH extends WH{constructor(e,t,n){super(e,t,jU(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new GH(this.firestore,null,new MF(e))}withConverter(e){return new qH(this.firestore,e,this._path)}}function jH(e,t,...n){if(e=_b(e),LH("collection","path",t),e instanceof zH){const r=IF.fromString(t,...n);return UH(r),new qH(e,null,r)}{if(!(e instanceof GH||e instanceof qH))throw new hF(uF.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(IF.fromString(t,...n));return UH(r),new qH(e.firestore,null,r)}}function ZH(e,t,...n){if(e=_b(e),1===arguments.length&&(t=wF.I()),LH("doc","path",t),e instanceof zH){const r=IF.fromString(t,...n);return FH(r),new GH(e,null,new MF(r))}{if(!(e instanceof GH||e instanceof qH))throw new hF(uF.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(IF.fromString(t,...n));return FH(r),new GH(e.firestore,e instanceof qH?e.converter:null,new MF(r))}}class YH{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new M$(this,"async_queue_retry"),this.Kc=()=>{const e=k$();e&&rF("AsyncQueue","Visibility state changed to "+e.visibilityState),this.So.Eo()};const e=k$();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=k$();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise(()=>{});const t=new dF;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Mc.push(e),this.jc()))}jc(){var e=this;return Pw(function*(){if(0!==e.Mc.length){try{yield e.Mc[0](),e.Mc.shift(),e.So.reset()}catch(t){if(!BF(t))throw t;rF("AsyncQueue","Operation failed with retryable error: "+t)}e.Mc.length>0&&e.So.Io(()=>e.jc())}})()}Qc(e){const t=this.Oc.then(()=>(this.Lc=!0,e().catch(e=>{throw this.Bc=e,this.Lc=!1,iF("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Lc=!1,e))));return this.Oc=t,t}enqueueAfterDelay(e,t,n){this.Gc(),this.qc.indexOf(e)>-1&&(t=0);const r=Sz.createAndSchedule(this,e,t,n,e=>this.Wc(e));return this.$c.push(r),r}Gc(){this.Bc&&aF()}verifyOperationInProgress(){}zc(){var e=this;return Pw(function*(){let t;do{t=e.Oc,yield t}while(t!==e.Oc)})()}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(e){return this.zc().then(()=>{this.$c.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.$c)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.zc()})}Yc(e){this.qc.push(e)}Wc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function KH(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class QH extends zH{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new YH,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||eG(this),this._firestoreClient.terminate()}}function XH(e=cS()){return iS(e,"firestore").getImmediate()}function JH(e){return e._firestoreClient||eG(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function eG(e){var t;const n=e._freezeSettings(),r=(i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new iU(e._databaseId,i,e._persistenceKey,(s=n).host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));var i,s;e._firestoreClient=new SH(e._authCredentials,e._appCheckCredentials,e._queue,r)}class tG{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new hF(uF.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new AF(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class nG{constructor(e){this._byteString=e}static fromBase64String(e){try{return new nG(KF.fromBase64String(e))}catch(t){throw new hF(uF.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new nG(KF.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class rG{constructor(e){this._methodName=e}}class iG{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new hF(uF.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new hF(uF.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return bF(this._lat,e._lat)||bF(this._long,e._long)}}const sG=/^__.*__$/;class oG{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new NB(e,this.data,this.fieldMask,t,this.fieldTransforms):new MB(e,this.data,t,this.fieldTransforms)}}class aG{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new NB(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lG(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw aF()}}class cG{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.wt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new cG(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.sa(e),r}ia(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.Xc(),r}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return wG(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(lG(this.Zc)&&sG.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class uG{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=n||A$(e)}aa(e,t,n,r=!1){return new cG({Zc:e,methodName:t,ca:n,path:AF.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function hG(e){const t=e._freezeSettings(),n=A$(e._databaseId);return new uG(e._databaseId,!!t.ignoreUndefinedProperties,n)}function dG(e,t,n,r,i,s={}){const o=e.aa(s.merge||s.mergeFields?2:0,t,n,i);vG("Data must be an object, but it was:",o,r);const a=mG(r,o);let l,c;if(s.merge)l=new YF(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=_G(t,r,n);if(!o.contains(i))throw new hF(uF.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);bG(e,i)||e.push(i)}l=new YF(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new oG(new SU(a),l,c)}class pG extends rG{_toFieldTransform(e){if(2!==e.Zc)throw e.oa(1===e.Zc?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof pG}}class fG extends rG{_toFieldTransform(e){return new EB(e.path,new pB)}isEqual(e){return e instanceof fG}}function gG(e,t){if(yG(e=_b(e)))return vG("Unsupported field value:",t,e),mG(e,t);if(e instanceof rG)return function(e,t){if(!lG(t.Zc))throw t.oa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.oa(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=gG(i,t.ra(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=_b(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return lB(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=PF.fromDate(e);return{timestampValue:gV(t.wt,n)}}if(e instanceof PF){const n=new PF(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:gV(t.wt,n)}}if(e instanceof iG)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof nG)return{bytesValue:mV(t.wt,e._byteString)};if(e instanceof GH){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.oa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:_V(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa(`Unsupported field value: ${BH(e)}`)}(e,t)}function mG(e,t){const n={};return HF(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):zF(e,(e,r)=>{const i=gG(r,t.ea(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function yG(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof PF||e instanceof iG||e instanceof nG||e instanceof GH||e instanceof rG)}function vG(e,t,n){if(!yG(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=BH(n);throw t.oa("an object"===r?e+" a custom object":e+" "+r)}var r}function _G(e,t,n){if((t=_b(t))instanceof tG)return t._internalPath;if("string"==typeof t)return EG(e,t);throw wG("Field path arguments must be of type string or ",e,!1,void 0,n)}const CG=new RegExp("[~\\*/\\[\\]]");function EG(e,t,n){if(t.search(CG)>=0)throw wG(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new tG(...t.split("."))._internalPath}catch{throw wG(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function wG(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new hF(uF.INVALID_ARGUMENT,a+e+l)}function bG(e,t){return e.some(e=>e.isEqual(t))}class SG{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new GH(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new PG(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(OG("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class PG extends SG{data(){return super.data()}}function OG(e,t){return"string"==typeof t?EG(e,t):t instanceof tG?t._internalPath:t._delegate._internalPath}class TG{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class IG extends SG{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new kG(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(OG("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class kG extends IG{data(e={}){return super.data(e)}}class AG{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new TG(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new kG(this._firestore,this._userDataWriter,n.key,n,new TG(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new hF(uF.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>({type:"added",doc:new kG(e._firestore,e._userDataWriter,n.doc.key,n.doc,new TG(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new kG(e._firestore,e._userDataWriter,t.doc.key,t.doc,new TG(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:MG(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function MG(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return aF()}}function NG(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new hF(uF.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class RG{}function xG(e,...t){for(const n of t)e=n._apply(e);return e}class DG extends RG{constructor(e,t,n){super(),this.fa=e,this.da=t,this._a=n,this.type="where"}_apply(e){const t=hG(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new hF(uF.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){zG(o,s);const t=[];for(const n of o)t.push($G(r,e,n));a={arrayValue:{values:t}}}else a=$G(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||zG(o,s),a=function(e,t,n,r=!1){return gG(n,e.aa(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);const l=NU.create(i,s,a);return function(e,t){if(t.ht()){const n=YU(e);if(null!==n&&!n.isEqual(t.field))throw new hF(uF.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=ZU(e);null!==r&&HG(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw new hF(uF.INVALID_ARGUMENT,n===t.op?`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`:`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,l),l}(e._query,0,t,e.firestore._databaseId,this.fa,this.da,this._a);return new WH(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new qU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function LG(e,t,n){const r=t,i=OG("where",e);return new DG(i,r,n)}class FG extends RG{constructor(e,t){super(),this.fa=e,this.wa=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new hF(uF.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new hF(uF.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new zU(t,n);return function(e,t){if(null===ZU(e)){const n=YU(e);null!==n&&HG(0,n,t.field)}}(e,r),r}(e._query,this.fa,this.wa);return new WH(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new qU(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function UG(e,t="asc"){const n=t,r=OG("orderBy",e);return new FG(r,n)}class BG extends RG{constructor(e,t,n){super(),this.type=e,this.ma=t,this.ga=n}_apply(e){return new WH(e.firestore,e.converter,JU(e._query,this.ma,this.ga))}}function VG(e){return function(e,t){if(t<=0)throw new hF(uF.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),new BG("limit",e,"F")}function $G(e,t,n){if("string"==typeof(n=_b(n))){if(""===n)throw new hF(uF.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!KU(t)&&-1!==n.indexOf("/"))throw new hF(uF.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(IF.fromString(n));if(!MF.isDocumentKey(r))throw new hF(uF.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mU(e,new MF(r))}if(n instanceof GH)return mU(e,n._key);throw new hF(uF.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${BH(n)}.`)}function zG(e,t){if(!Array.isArray(e)||0===e.length)throw new hF(uF.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new hF(uF.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function HG(e,t,n){if(!n.isEqual(t))throw new hF(uF.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function GG(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function WG(e){e=VH(e,GH);const t=VH(e.firestore,QH);return function(e,t,n={}){const r=new dF;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n,r,i){const s=new bH({next:s=>{t.enqueueAndForget(()=>Rz(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new hF(uF.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new hF(uF.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Uz(jU(n.path),s,{includeMetadataChanges:!0,Du:!0});return Mz(e,o)}(yield RH(e),e.asyncQueue,t,n,r)})),r.promise}(JH(t),e._key).then(n=>eW(t,e,n))}class qG extends class{convertValue(e,t="none"){switch(cU(e)){case 0:return null;case 1:return e.booleanValue;case 2:return JF(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(eU(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw aF()}}convertObject(e,t){const n={};return zF(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new iG(JF(e.latitude),JF(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=nU(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(rU(e));default:return null}}convertTimestamp(e){const t=XF(e);return new PF(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=IF.fromString(e);lF(UV(n));const r=new sU(n.get(1),n.get(3)),i=new MF(n.popFirst(5));return r.isEqual(t)||iF(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new nG(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new GH(this.firestore,null,t)}}function jG(e){e=VH(e,WH);const t=VH(e.firestore,QH),n=JH(t),r=new qG(t);return NG(e._query),function(e,t,n={}){const r=new dF;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n,r,i){const s=new bH({next:n=>{t.enqueueAndForget(()=>Rz(e,o)),n.fromCache&&"server"===r.source?i.reject(new hF(uF.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Uz(n,s,{includeMetadataChanges:!0,Du:!0});return Mz(e,o)}(yield RH(e),e.asyncQueue,t,n,r)})),r.promise}(n,e._query).then(n=>new AG(t,r,e,n))}function ZG(e,t,n){e=VH(e,GH);const r=VH(e.firestore,QH),i=GG(e.converter,t,n);return JG(r,[dG(hG(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,bB.none())])}function YG(e,t,n,...r){e=VH(e,GH);const i=VH(e.firestore,QH),s=hG(i);let o;return o="string"==typeof(t=_b(t))||t instanceof tG?function(e,t,n,r,i,s){const o=e.aa(1,t,n),a=[_G(t,r,n)],l=[i];if(s.length%2!=0)throw new hF(uF.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(_G(t,s[d])),l.push(s[d+1]);const c=[],u=SU.empty();for(let d=a.length-1;d>=0;--d)if(!bG(c,a[d])){const e=a[d];let t=l[d];t=_b(t);const n=o.ia(e);if(t instanceof pG)c.push(e);else{const r=gG(t,n);null!=r&&(c.push(e),u.set(e,r))}}const h=new YF(c);return new aG(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.aa(1,t,n);vG("Data must be an object, but it was:",i,r);const s=[],o=SU.empty();zF(r,(e,r)=>{const a=EG(t,e,n);r=_b(r);const l=i.ia(a);if(r instanceof pG)s.push(a);else{const e=gG(r,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new YF(s);return new aG(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),JG(i,[o.toMutation(e._key,bB.exists(!0))])}function KG(e){return JG(VH(e.firestore,QH),[new LB(e._key,bB.none())])}function QG(e,t){const n=VH(e.firestore,QH),r=ZH(e),i=GG(e.converter,t);return JG(n,[dG(hG(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,bB.exists(!1))]).then(()=>r)}function XG(e,...t){var n,r,i;e=_b(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||KH(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(KH(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let l,c,u;if(e instanceof GH)c=VH(e.firestore,QH),u=jU(e._key.path),l={next:n=>{t[o]&&t[o](eW(c,e,n))},error:t[o+1],complete:t[o+2]};else{const n=VH(e,WH);c=VH(n.firestore,QH),u=n._query;const r=new qG(c);l={next:e=>{t[o]&&t[o](new AG(c,r,n,e))},error:t[o+1],complete:t[o+2]},NG(e._query)}return function(e,t,n,r){const i=new bH(r),s=new Uz(t,i,n);return e.asyncQueue.enqueueAndForget(Pw(function*(){return Mz(yield RH(e),s)})),()=>{i.Tc(),e.asyncQueue.enqueueAndForget(Pw(function*(){return Rz(yield RH(e),s)}))}}(JH(c),u,a,l)}function JG(e,t){return function(e,t){const n=new dF;return e.asyncQueue.enqueueAndForget(Pw(function*(){return function(e,t,n){return Qz.apply(this,arguments)}(yield function(e){return MH(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(JH(e),t)}function eW(e,t,n){const r=n.docs.get(t._key),i=new qG(e);return new IG(e,i,t._key,r,new TG(n.hasPendingWrites,n.fromCache),t.converter)}function tW(){return new fG("serverTimestamp")}!function(e,t=!0){eF="9.9.0",rS(new Cb("firestore",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new QH(r,new mF(e.getProvider("auth-internal")),new CF(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC")),hS(XL,"3.4.12",e),hS(XL,"3.4.12","esm2017")}();class nW{constructor(e){return e}}const rW=new or("angularfire2.firestore-instances");function iW(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new nW(r)}}const sW={provide:class{constructor(){return lI("firestore")}},deps:[[new Nr,rW]]},oW={provide:nW,useFactory:function(e,t){const n=aI("firestore",e,t);return n&&new nW(n)},deps:[[new Nr,rW],_I]};let aW=(()=>{class e{constructor(){hS("angularfire",eI.full,"fst")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[oW,sW]}),e})();const lW=vI(QG,!0),cW=vI(jH,!0),uW=vI(HH,!0),hW=vI(KG,!0),dW=vI(ZH,!0),pW=vI(WG,!0),fW=vI(jG,!0),gW=vI(XH,!0),mW=vI(VG,!0),yW=vI(XG,!0),vW=vI(UG,!0),_W=vI(xG,!0),CW=vI(ZG,!0),EW=vI(YG,!0),wW=vI(LG,!0);let bW=(()=>{class e{constructor(e,t){this.collectionName=e,this.firestore=t,this.subDAOs={};this.collection=cW(t,this.collectionName).withConverter({fromFirestore:e=>e.data(),toFirestore:e=>e})}create(e){var t=this;return Pw(function*(){return(yield lW(t.collection,e)).id})()}read(e){var t=this;return Pw(function*(){const n=yield pW(dW(t.collection,e));return n.exists()?Mw.of(Ow.getNonNullable(n.data())):Mw.empty()})()}exists(e){var t=this;return Pw(function*(){return(yield t.read(e)).isPresent()})()}update(e,t){var n=this;return Pw(function*(){return EW(dW(n.collection,e),t)})()}delete(e){return hW(dW(this.collection,e))}set(t,n){return Tw(e.VERBOSE,{called:this.collectionName+".set",id:t,element:n}),CW(dW(this.collection,t),n)}subscribeToChanges(e,t){return yW(dW(this.collection,e),e=>{t(Mw.ofNullable(e.data()))})}findWhere(e,t,n){var r=this;return Pw(function*(){const i=r.constructQuery(e,t,n);return(yield fW(i)).docs.map(e=>({id:e.id,data:e.data()}))})()}observingWhere(t,n,r){const i=this.constructQuery(t,r);return yW(i,t=>{const r=[],i=[],s=[];t.docChanges().forEach(e=>{const t={id:e.doc.id,data:e.doc.data()};switch(e.type){case"added":r.push(t);break;case"modified":i.push(t);break;case"removed":s.push(t)}}),r.length>0&&(Tw(e.VERBOSE,"firebase gave us "+r.length+" NEW "+this.collectionName),n.onDocumentCreated(r)),i.length>0&&(Tw(e.VERBOSE,"firebase gave us "+i.length+" MODIFIED "+this.collectionName),n.onDocumentModified(i)),s.length>0&&(Tw(e.VERBOSE,"firebase gave us "+s.length+" DELETED "+this.collectionName),n.onDocumentDeleted(s))})}constructQuery(e,t,n){let r=_W(this.collection);null!=t&&(r=_W(r,vW(t))),null!=n&&(r=_W(r,mW(n)));for(const i of e)r=_W(r,wW(i[0],i[1],i[2]));return r}subCollectionDAO(t,n){const r=`${this.collection.path}/${t}/${n}`;if(r in this.subDAOs)return this.subDAOs[r];{const t=new class extends e{constructor(e){super(r,e)}}(this.firestore);return this.subDAOs[r]=t,t}}}return e.VERBOSE=!1,e})();class SW{static success(e){return new PW(e)}static failure(e){return new OW(e)}constructor(){}equals(e){return this.isFailure()?e.isFailure()&&this.getReason()===e.getReason():!e.isFailure()&&Aw(this.get(),e.get())}}class PW extends SW{constructor(e){super(),this.value=e}isSuccess(){return!0}isFailure(){return!1}get(){return this.value}getReason(){throw new Error("Cannot get failure reason from a success")}getReasonOr(e){return e}toOptional(){return Mw.of(this.value)}toString(){return`MGPFallible.success(${this.value})`}}class OW extends SW{constructor(e){super(),this.reason=e}isSuccess(){return!1}isFailure(){return!0}get(){throw new Error("Value is absent from failure, with the following reason: "+this.reason)}getReason(){return this.reason}getReasonOr(e){return this.getReason()}toOptional(){return Mw.empty()}toString(){return`MGPFallible.failure(${this.reason})`}}class TW{constructor(e){this.reason=e}static ofFallible(e){return e.isSuccess()?TW.SUCCESS:TW.failure(e.getReason())}static failure(e){return new TW(e)}isFailure(){return!1===this.isSuccess()}isSuccess(){return null==this.reason}getReason(){if(this.isSuccess())throw new Error("MGPValidation: Cannot extract failure reason from success.");return this.reason}toFallible(e){return this.isSuccess()?SW.success(e):SW.failure(this.getReason())}toFailedFallible(){if(this.isSuccess())throw new Error("MGPValidation: cannot convert into failed fallible.");return SW.failure(this.getReason())}}TW.SUCCESS=new TW(null);let IW=(()=>{class e extends bW{constructor(e){super("errors",e)}findErrors(e,t,n,r){return this.findWhere(void 0===r?[["component","==",e],["route","==",t],["message","==",n]]:[["component","==",e],["route","==",t],["message","==",n],["data","==",r]])}}return e.\u0275fac=function(t){return new(t||e)(Or(nW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var kW=n(811);let AW=(()=>{class e{infoMessage(e){this.message(e,"is-info")}gameMessage(e){this.message(e,"is-warning")}criticalMessage(e){this.message(e,"is-danger")}message(e,t){(0,kW.toast)({message:e,duration:3e3,position:"top-center",closeOnClick:!0,type:t,dismissible:!0})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class MW{constructor(e,t,n){this.errorDAO=e,this.router=t,this.messageDisplayer=n,MW.setSingletonInstance(this)}static setSingletonInstance(e){MW.singleton=Mw.of(e)}static logErrorAndFail(e,t,n){throw MW.logError(e,t,n),new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`)}static logError(e,t,n){if(this.singleton.isAbsent())throw new Error(`${e}: ${t} (extra data: ${JSON.stringify(n)})`);return this.singleton.get().logError(e,t,n),TW.failure(e+": "+t)}logError(e,t,n){var r=this;return Pw(function*(){r.messageDisplayer.criticalMessage($localize`An unexpected error was encountered. We have logged it and will try to fix its cause as soon as possible.`);const i=r.router.url,s=yield r.errorDAO.findErrors(e,i,t,n);if(0===s.length){const s={component:e,route:i,message:t,firstEncounter:tW(),lastEncounter:tW(),occurences:1};null!=n&&(s.data=n),yield r.errorDAO.create(s)}else{const e=s[0].id,t=s[0].data;yield r.errorDAO.update(e,{lastEncounter:tW(),occurences:t.occurences+1})}})()}}function NW(e,t){if(!1===e)throw MW.logError("Assertion failure",t),new Error(`Assertion failure: ${t}`)}MW.singleton=Mw.empty(),MW.\u0275fac=function(e){return new(e||MW)(Or(IW),Or(f_),Or(AW))},MW.\u0275prov=be({token:MW,factory:MW.\u0275fac,providedIn:"root"});class RW{constructor(e){this.value=e}}RW.HARD_DRAW=new RW(0),RW.RESIGN=new RW(1),RW.ESCAPE=new RW(2),RW.VICTORY=new RW(3),RW.TIMEOUT=new RW(4),RW.UNACHIEVED=new RW(5),RW.AGREED_DRAW_BY_ZERO=new RW(6),RW.AGREED_DRAW_BY_ONE=new RW(7);class xW{constructor(e,t){this.id=e,this.data=t}getTurn(){return this.data.turn}isHardDraw(){return this.data.result===RW.HARD_DRAW.value}isAgreedDraw(){return this.data.result===RW.AGREED_DRAW_BY_ZERO.value||this.data.result===RW.AGREED_DRAW_BY_ONE.value}getDrawAccepter(){return this.data.result===RW.AGREED_DRAW_BY_ZERO.value?this.data.playerZero:(NW(this.data.result===RW.AGREED_DRAW_BY_ONE.value,"should not access getDrawAccepter when no draw accepted!"),Ow.getNonNullable(this.data.playerOne))}isWin(){return this.data.result===RW.VICTORY.value}isTimeout(){return this.data.result===RW.TIMEOUT.value}isResign(){return this.data.result===RW.RESIGN.value}getWinner(){return Mw.ofNullable(this.data.winner)}getLoser(){return Mw.ofNullable(this.data.loser)}setWinnerAndLoser(e,t){return new xW(this.id,{...this.data,winner:e,loser:t})}}let DW=(()=>{class e extends bW{constructor(t){super("parties",t),Tw(e.VERBOSE,"PartDAO.constructor")}updateAndBumpIndex(e,t,n,r){var i=this;return Pw(function*(){return r={...r,lastUpdate:{index:n+1,player:t.value}},i.update(e,r)})()}observeActiveParts(e){return this.observingWhere([["result","==",RW.UNACHIEVED.value]],e)}userHasActivePart(e){var t=this;return Pw(function*(){const n=yield t.findWhere([["playerZero","==",e],["result","==",RW.UNACHIEVED.value]]),r=yield t.findWhere([["playerOne","==",e],["result","==",RW.UNACHIEVED.value]]);return n.length>0||r.length>0})()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(nW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),LW=(()=>{class e extends bW{constructor(t){super("chats",t),Tw(e.VERBOSE,"ChatDAO.constructor")}addMessage(e,t){var n=this;return Pw(function*(){return n.subCollectionDAO(e,"messages").create(t)})()}getLastMessages(e,t){var n=this;return Pw(function*(){return n.subCollectionDAO(e,"messages").findWhere([],"postedTime",t)})()}subscribeToMessages(e,t){return this.subCollectionDAO(e,"messages").observingWhere([],t,"postedTime")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(nW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),FW=(()=>{class e{}return e.CANNOT_SEND_MESSAGE=()=>$localize`You're not allowed to send a message here.`,e.FORBIDDEN_MESSAGE=()=>$localize`This message is forbidden.`,e})(),UW=(()=>{class e{constructor(t){this.chatDAO=t,this.followedChatId=Mw.empty(),Tw(e.VERBOSE,"ChatService.constructor")}startObserving(t,n){Tw(e.VERBOSE,"ChatService.startObserving "+t),this.followedChatId.isAbsent()?(Tw(e.VERBOSE,"[start watching chat "+t),this.followedChatId=Mw.of(t),this.followedChatUnsubscribe=this.chatDAO.subscribeToMessages(t,n)):this.followedChatId.equalsValue(t)?MW.logErrorAndFail("ChatService","Already observing same chat",{chatId:t}):MW.logErrorAndFail("ChatService","Already observing another chat",{chatId:t,followedChatId:this.followedChatId.get()})}stopObserving(){if(!this.isObserving())throw new Error("ChatService.stopObserving should not be called if not observing");Tw(e.VERBOSE,"stopped watching chat "+this.followedChatId+"]"),this.followedChatId=Mw.empty(),this.followedChatUnsubscribe()}isObserving(){return this.followedChatId.isPresent()}deleteChat(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"ChatService.deleteChat "+t),n.chatDAO.delete(t)})()}createNewChat(e){var t=this;return Pw(function*(){return t.chatDAO.set(e,{})})()}sendMessage(e,t,n){var r=this;return Pw(function*(){if(r.followedChatId.isAbsent())return TW.failure("Cannot send message if not observing chat");const i=r.followedChatId.get();if(!1===r.userCanSendMessage(e.name,i))return TW.failure(FW.CANNOT_SEND_MESSAGE());if(r.isForbiddenMessage(t))return TW.failure(FW.FORBIDDEN_MESSAGE());const s={content:t,sender:e,postedTime:tW(),currentTurn:n};return yield r.chatDAO.addMessage(i,s),TW.SUCCESS})()}userCanSendMessage(e,t){return""!==e}isForbiddenMessage(e){return""===e}ngOnDestroy(){this.isObserving()&&this.stopObserving()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(LW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class BW{constructor(e,t,n){this.onDocumentCreated=e,this.onDocumentModified=t,this.onDocumentDeleted=n}}let VW=(()=>{class e extends bW{constructor(t){super(e.COLLECTION_NAME,t),Tw(e.VERBOSE,"UserDAO.constructor")}usernameIsAvailable(e){var t=this;return Pw(function*(){return 0===(yield t.findWhere([["username","==",e]])).length})()}setUsername(e,t){var n=this;return Pw(function*(){yield n.update(e,{username:t})})()}markVerified(e){var t=this;return Pw(function*(){yield t.update(e,{verified:!0})})()}observeUserByUsername(e,t){return this.observingWhere([["username","==",e]],t)}observeActiveUsers(e){return this.observingWhere([["state","==","online"],["verified","==",!0]],e)}updatePresenceToken(e){return this.update(e,{last_changed:tW()})}}return e.VERBOSE=!1,e.COLLECTION_NAME="joueurs",e.\u0275fac=function(t){return new(t||e)(Or(nW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),$W=(()=>{class e{constructor(e){this.userDAO=e,this.activeUsersBS=new Em([]),this.activeUsersObs=this.activeUsersBS.asObservable()}startObserving(){Tw(e.VERBOSE,"ActiveUsersService.startObservingActiveUsers");const t=new BW(t=>{Tw(e.VERBOSE,"our DAO gave us "+t.length+" new user(s)");const n=this.activeUsersBS.value.concat(...t);this.activeUsersBS.next(this.sort(n))},t=>{let n=this.activeUsersBS.value;Tw(e.VERBOSE,"our DAO updated "+t.length+" user(s)");for(const e of t)n.forEach(t=>{t.id===e.id&&(t.data=e.data)}),n=this.sort(n);this.activeUsersBS.next(n)},e=>{const t=this.activeUsersBS.value.filter(t=>!e.some(e=>e.id===t.id));this.activeUsersBS.next(this.sort(t))});this.unsubscribe=this.userDAO.observeActiveUsers(t)}stopObserving(){this.unsubscribe(),this.activeUsersBS.next([])}sort(e){return e.sort((e,t)=>{const n=Ow.getNonNullable(e.data).last_changed,r=Ow.getNonNullable(n).seconds,i=Ow.getNonNullable(t.data).last_changed;return r-Ow.getNonNullable(i).seconds})}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(VW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),zW=(()=>{class e{constructor(e,t){this.activeUsersService=e,this.userDAO=t}getActiveUsersObs(){return this.activeUsersService.startObserving(),this.activeUsersService.activeUsersObs}unSubFromActiveUsersObs(){this.activeUsersService.stopObserving()}observeUserByUsername(e,t){return this.userDAO.observeUserByUsername(e,t)}observeUser(e,t){return this.userDAO.subscribeToChanges(e,t)}getUserLastChanged(e){var t=this;return Pw(function*(){const n=yield t.userDAO.read(e);if(n.isAbsent())return Mw.empty();{const e=n.get().last_changed;return NW(null!=e,"should not receive a last_changed equal to null"),Mw.of(e)}})()}}return e.\u0275fac=function(t){return new(t||e)(Or($W),Or(VW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class HW extends A{constructor(e=1/0,t=1/0,n=YT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:i,_windowTime:s}=this;t||(n.push(e),!r&&n.push(i.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:r}=this,i=r.slice();for(let s=0;s<i.length&&!e.closed;s+=n?1:2)e.next(i[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:r}=this,i=(r?1:2)*e;if(e<1/0&&i<n.length&&n.splice(0,n.length-i),!r){const e=t.now();let r=0;for(let t=1;t<n.length&&n[t]<=e;t+=2)r=t;r&&n.splice(0,r+1)}}}const GW="@firebase/database";let WW="";class qW{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),nb(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:tb(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class jW{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return ib(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ZW=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new qW(t)}}catch{}return new jW},YW=ZW("localStorage"),KW=ZW("sessionStorage"),QW=new Ab("@firebase/database"),XW=function(){let e=1;return function(){return e++}}(),JW=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,Nw(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new pb;n.update(t);const r=n.digest();return Dw.encodeByteArray(r)},eq=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=eq.apply(null,r):t+="object"==typeof r?nb(r):r,t+=" "}return t};let tq=null,nq=!0;const rq=function(...e){if(!0===nq&&(nq=!1,null===tq&&!0===KW.get("logging_enabled")&&function(e,t){Nw(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(QW.logLevel=Pb.VERBOSE,tq=QW.log.bind(QW),t&&KW.set("logging_enabled",!0)):"function"==typeof e?tq=e:(tq=null,KW.remove("logging_enabled"))}(!0)),tq){const t=eq.apply(null,e);tq(t)}},iq=function(e){return function(...t){rq(e,...t)}},sq=function(...e){const t="FIREBASE INTERNAL ERROR: "+eq(...e);QW.error(t)},oq=function(...e){const t=`FIREBASE FATAL ERROR: ${eq(...e)}`;throw QW.error(t),new Error(t)},aq=function(...e){const t="FIREBASE WARNING: "+eq(...e);QW.warn(t)},lq=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},cq="[MIN_NAME]",uq="[MAX_NAME]",hq=function(e,t){if(e===t)return 0;if(e===cq||t===uq)return-1;if(t===cq||e===uq)return 1;{const n=_q(e),r=_q(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},dq=function(e,t){return e===t?0:e<t?-1:1},pq=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+nb(t))},fq=function(e){if("object"!=typeof e||null===e)return nb(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=nb(t[r]),n+=":",n+=fq(e[t[r]]);return n+="}",n},gq=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)r.push(e.substring(i,i+t>n?n:i+t));return r};function mq(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const yq=function(e){Nw(!lq(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,1-t)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()},vq=new RegExp("^-?(0*)\\d{1,10}$"),_q=function(e){if(vq.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Cq=function(e){try{e()}catch(t){setTimeout(()=>{throw aq("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},Eq=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class wq{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){aq(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class bq{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(rq("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',aq(e)}}let Sq=(()=>{class e{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return e.OWNER="owner",e})();const Pq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Oq="long_polling";class Tq{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=YW.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&YW.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Iq(e,t,n){let r;if(Nw("string"==typeof t,"typeof type must == string"),Nw("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Oq)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return mq(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class kq{constructor(){this.counters_={}}incrementCounter(e,t=1){ib(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Bw(this.counters_)}}const Aq={},Mq={};function Nq(e){const t=e.toString();return Aq[t]||(Aq[t]=new kq),Aq[t]}class Rq{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Cq(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class xq{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=iq(e),this.stats_=Nq(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Iq(t,Oq,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Rq(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Dq((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Pq.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){xq.forceAllow_=!0}static forceDisallow(){xq.forceDisallow_=!0}static isAvailable(){return!(!xq.forceAllow_&&(xq.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=nb(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Lw(t),r=gq(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=nb(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Dq{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=XW(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Dq.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){rq("frame writing exception"),i.stack&&rq(i.stack),rq(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||rq("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;(!e||"loaded"===e||"complete"===e)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{rq("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}let Lq=null;"undefined"!=typeof MozWebSocket?Lq=MozWebSocket:"undefined"!=typeof WebSocket&&(Lq=WebSocket);let Fq=(()=>{class e{constructor(t,n,r,i,s,o,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=iq(this.connId),this.stats_=Nq(n),this.connURL=e.connectionURL_(n,o,a,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Pq.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Iq(e,"websocket",s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,YW.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new Lq(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Lq&&!e.forceDisallow_}static previouslyFailed(){return YW.isInMemoryStorage||!0===YW.get("previous_websocket_failure")}markConnectionHealthy(){YW.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=tb(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Nw(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=nb(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=gq(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e})(),Uq=(()=>{class e{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[xq,Fq]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const n=Fq&&Fq.isAvailable();let r=n&&!Fq.previouslyFailed();if(t.webSocketOnly&&(n||aq("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Fq];else{const t=this.transports_=[];for(const n of e.ALL_TRANSPORTS)n&&n.isAvailable()&&t.push(n);e.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return e.globalTransportInitialized_=!1,e})();class Bq{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=iq("c:"+this.id+":"),this.transportManager_=new Uq(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Eq(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=pq("t",e),n=pq("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=pq("t",e),n=pq("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=pq("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?sq("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):sq("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&aq("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Eq(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Eq(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(YW.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Vq{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class $q{constructor(e){this.allowedEvents_=e,this.listeners_={},Nw(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Nw(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class zq extends $q{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!Ww()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new zq}getInitialEvent(e){return Nw("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Hq{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Gq(){return new Hq("")}function Wq(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function qq(e){return e.pieces_.length-e.pieceNum_}function jq(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Hq(e.pieces_,t)}function Zq(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Yq(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Kq(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Hq(t,0)}function Qq(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Hq)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Hq(n,0)}function Xq(e){return e.pieceNum_>=e.pieces_.length}function Jq(e,t){const n=Wq(e),r=Wq(t);if(null===n)return t;if(n===r)return Jq(jq(e),jq(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ej(e,t){const n=Yq(e,0),r=Yq(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=hq(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function tj(e,t){if(qq(e)!==qq(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function nj(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(qq(e)>qq(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class rj{constructor(e,t){this.errorPrefix_=t,this.parts_=Yq(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=yb(this.parts_[n]);ij(this)}}function ij(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+sj(e))}function sj(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class oj extends $q{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new oj}getInitialEvent(e){return Nw("visible"===e,"Unknown event type: "+e),[this.visible_]}}const aj=1e3;let lj,cj=(()=>{class e extends Vq{constructor(t,n,r,i,s,o,a,l){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=e.nextPersistentConnectionId_++,this.log_=iq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=aj,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");oj.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&zq.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(nb(i)),Nw(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new zw,n={p:e._path.toString(),q:e._queryObject};return this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),Nw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Nw(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){const n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r};t.tag&&(s.q=n._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const o=s.d,a=s.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_("listen response",s),"ok"!==a&&this.removeListen_(r,i),t.onComplete&&t.onComplete(a,o))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&ib(e,"w")){const n=sb(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();aq(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=rb(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=rb(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Nw(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{"ok"!==e.s&&this.log_("reportStats","Error sending stats: "+e.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+nb(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):sq("Unrecognized action received from server: "+nb(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Nw(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=aj,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=aj,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=aj),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return Pw(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const r=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+e.nextConnectionId_++,a=t.lastSessionId;let l=!1,c=null;const u=function(){c?c.close():(l=!0,s())};t.realtime_={close:u,sendRequest:function(e){Nw(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}};const h=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[e,n]=yield Promise.all([t.authTokenProvider_.getToken(h),t.appCheckTokenProvider_.getToken(h)]);l?rq("getToken() completed but was canceled"):(rq("getToken() completed. Creating connection."),t.authToken_=e&&e.accessToken,t.appCheckToken_=n&&n.token,c=new Bq(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,r,i,s,e=>{aq(e+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(n){t.log_("Failed to get token: "+n),l||(t.repoInfo_.nodeAdmin&&aq(n),u())}}})()}interrupt(e){rq("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rq("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ob(this.interruptReasons_)&&(this.reconnectDelay_=aj,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>fq(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Hq(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){rq("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){rq("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+WW.replace(/\./g,"-")]=1,Ww()?e["framework.cordova"]=1:jw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=zq.getInstance().currentlyOnline();return ob(this.interruptReasons_)&&e}}return e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e})();class uj{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new uj(e,t)}}class hj{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new uj(cq,e),r=new uj(cq,t);return 0!==this.compare(n,r)}minPost(){return uj.MIN}}class dj extends hj{static get __EMPTY_NODE(){return lj}static set __EMPTY_NODE(e){lj=e}compare(e,t){return hq(e.name,t.name)}isDefinedOn(e){throw Rw("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return uj.MIN}maxPost(){return new uj(uq,lj)}makePost(e,t){return Nw("string"==typeof e,"KeyIndex indexValue must always be a string."),new uj(e,lj)}toString(){return".key"}}const pj=new dj;class fj{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let gj,mj=(()=>{class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??yj.EMPTY_NODE,this.right=s??yj.EMPTY_NODE}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return yj.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return yj.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return e.RED=!0,e.BLACK=!1,e})();class yj{constructor(e,t=yj.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new yj(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,mj.BLACK,null,null))}remove(e){return new yj(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,mj.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fj(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fj(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fj(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fj(this.root_,null,this.comparator_,!0,e)}}function vj(e,t){return hq(e.name,t.name)}function _j(e,t){return hq(e,t)}yj.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new mj(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Cj=function(e){return"number"==typeof e?"number:"+yq(e):"string:"+e},Ej=function(e){if(e.isLeafNode()){const t=e.val();Nw("string"==typeof t||"number"==typeof t||"object"==typeof t&&ib(t,".sv"),"Priority must be a string or number.")}else Nw(e===gj||e.isEmpty(),"priority of unexpected type.");Nw(e===gj||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let wj,bj,Sj,Pj=(()=>{class e{constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Nw(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Ej(this.priorityNode_)}static set __childrenNodeConstructor(e){wj=e}static get __childrenNodeConstructor(){return wj}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Xq(t)?this:".priority"===Wq(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const r=Wq(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(Nw(".priority"!==r||1===qq(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(jq(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Cj(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?yq(this.value_):this.value_,this.lazyHash_=JW(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Nw(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return Nw(i>=0,"Unknown leaf type: "+n),Nw(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}return e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e})();const Oj=new class extends hj{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?hq(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return uj.MIN}maxPost(){return new uj(uq,new Pj("[PRIORITY-POST]",Sj))}makePost(e,t){const n=bj(e);return new uj(t,new Pj("[PRIORITY-POST]",n))}toString(){return".priority"}},Tj=Math.log(2);class Ij{constructor(e){this.count=parseInt(Math.log(e+1)/Tj,10),this.current_=this.count-1;const t=(e=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&t}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const kj=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new mj(a,o.node,mj.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),u=i(l+1,r);return o=e[l],a=n?n(o):o,new mj(a,o.node,mj.BLACK,c,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const c=i(s+1,a),u=e[s],h=n?n(u):u;l(new mj(h,u.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,mj.BLACK):(a(r,mj.BLACK),a(r,mj.RED))}return s}(new Ij(e.length));return new yj(r||t,s)};let Aj;const Mj={};class Nj{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Nw(Mj&&Oj,"ChildrenNode.ts has not been loaded"),Aj=Aj||new Nj({".priority":Mj},{".priority":Oj}),Aj}get(e){const t=sb(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof yj?t:null}hasIndex(e){return ib(this.indexSet_,e.toString())}addIndex(e,t){Nw(e!==pj,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(uj.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?kj(n,e.getCompare()):Mj;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=s,new Nj(c,l)}addToIndexes(e,t){const n=ab(this.indexes_,(n,r)=>{const i=sb(this.indexSet_,r);if(Nw(i,"Missing index implementation for "+r),n===Mj){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(uj.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),kj(n,i.getCompare())}return Mj}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new uj(e.name,r))),i.insert(e,e.node)}});return new Nj(n,this.indexSet_)}removeFromIndexes(e,t){const n=ab(this.indexes_,n=>{if(n===Mj)return n;{const r=t.get(e.name);return r?n.remove(new uj(e.name,r)):n}});return new Nj(n,this.indexSet_)}}let Rj,xj=(()=>{class e{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ej(this.priorityNode_),this.children_.isEmpty()&&Nw(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Rj||(Rj=new e(new yj(_j),null,Nj.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Rj}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Rj:t}}getChild(e){const t=Wq(e);return null===t?this:this.getImmediateChild(t).getChild(jq(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(t,n){if(Nw(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const r=new uj(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?Rj:this.priorityNode_;return new e(i,o,s)}}updateChild(e,t){const n=Wq(e);if(null===n)return t;{Nw(".priority"!==Wq(e)||1===qq(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(jq(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(Oj,(o,a)=>{n[o]=a.val(t),r++,s&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!t&&s&&i<2*r){const e=[];for(const t in n)e[t]=n[t];return e}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Cj(this.getPriority().val())+":"),this.forEachChild(Oj,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":JW(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new uj(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new uj(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new uj(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,uj.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,uj.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Dj?-1:0}withIndex(t){if(t===pj||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===pj||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Oj),n=t.getIterator(Oj);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===pj?null:this.indexMap_.get(e.toString())}}return e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e})();const Dj=new class extends xj{constructor(){super(new yj(_j),xj.EMPTY_NODE,Nj.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return xj.EMPTY_NODE}isEmpty(){return!1}};function Lj(e,t=null){if(null===e)return xj.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Nw(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Pj(e,Lj(t));if(e instanceof Array){let n=xj.EMPTY_NODE;return mq(e,(t,r)=>{if(ib(e,t)&&"."!==t.substring(0,1)){const e=Lj(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(Lj(t))}{const n=[];let r=!1;if(mq(e,(e,t)=>{if("."!==e.substring(0,1)){const i=Lj(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new uj(e,i)))}}),0===n.length)return xj.EMPTY_NODE;const i=kj(n,vj,e=>e.name,_j);if(r){const e=kj(n,Oj.getCompare());return new xj(i,Lj(t),new Nj({".priority":e},{".priority":Oj}))}return new xj(i,Lj(t),Nj.Default)}}Object.defineProperties(uj,{MIN:{value:new uj(cq,xj.EMPTY_NODE)},MAX:{value:new uj(uq,Dj)}}),dj.__EMPTY_NODE=xj.EMPTY_NODE,Pj.__childrenNodeConstructor=xj,function(e){gj=e}(Dj),function(e){Sj=e}(Dj),function(e){bj=e}(Lj);class Fj extends hj{constructor(e){super(),this.indexPath_=e,Nw(!Xq(e)&&".priority"!==Wq(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?hq(e.name,t.name):i}makePost(e,t){const n=Lj(e),r=xj.EMPTY_NODE.updateChild(this.indexPath_,n);return new uj(t,r)}maxPost(){const e=xj.EMPTY_NODE.updateChild(this.indexPath_,Dj);return new uj(uq,e)}toString(){return Yq(this.indexPath_,0).join("/")}}const Uj=new class extends hj{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?hq(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return uj.MIN}maxPost(){return uj.MAX}makePost(e,t){const n=Lj(e);return new uj(t,n)}toString(){return".value"}};function Bj(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Vj{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Oj}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Nw(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Nw(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:cq}hasEnd(){return this.endSet_}getIndexEndValue(){return Nw(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Nw(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:uq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Nw(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Oj}copy(){const e=new Vj;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function $j(e){const t={};if(e.isDefault())return t;let n;return e.index_===Oj?n="$priority":e.index_===Uj?n="$value":e.index_===pj?n="$key":(Nw(e.index_ instanceof Fj,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=nb(n),e.startSet_&&(t.startAt=nb(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+nb(e.indexStartName_))),e.endSet_&&(t.endAt=nb(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+nb(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function zj(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Oj&&(t.i=e.index_.toString()),t}class Hj extends Vq{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=iq("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Nw(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=Hj.getListenId_(e,n),o={};this.listens_[s]=o;const a=$j(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),sb(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=Hj.getListenId_(e,t);delete this.listens_[n]}get(e){const t=$j(e._queryParams),n=e._path.toString(),r=new zw;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ub(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=tb(o.responseText)}catch{aq("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&aq("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class Gj{constructor(){this.rootNode_=xj.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Wj(){return{value:null,children:new Map}}function qj(e,t,n){if(Xq(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=Wq(t);e.children.has(r)||e.children.set(r,Wj()),qj(e.children.get(r),t=jq(t),n)}}function jj(e,t){if(Xq(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Oj,(t,n)=>{qj(e,new Hq(t),n)}),jj(e,t)}}if(e.children.size>0){const n=Wq(t);return t=jq(t),e.children.has(n)&&jj(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}return!0}function Zj(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{Zj(r,new Hq(t.toString()+"/"+e),n)})}class Yj{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&mq(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class Kj{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Yj(e);const n=1e4+2e4*Math.random();Eq(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;mq(e,(e,r)=>{r>0&&ib(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),Eq(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Qj=(()=>(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Qj||(Qj={})),Qj))();function Xj(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class Jj{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Qj.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Xq(this.path)){if(null!=this.affectedTree.value)return Nw(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Hq(e));return new Jj(Gq(),t,this.revert)}}return Nw(Wq(this.path)===e,"operationForChild called for unrelated child."),new Jj(jq(this.path),this.affectedTree,this.revert)}}class eZ{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Qj.OVERWRITE}operationForChild(e){return Xq(this.path)?new eZ(this.source,Gq(),this.snap.getImmediateChild(e)):new eZ(this.source,jq(this.path),this.snap)}}class tZ{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Qj.MERGE}operationForChild(e){if(Xq(this.path)){const t=this.children.subtree(new Hq(e));return t.isEmpty()?null:t.value?new eZ(this.source,Gq(),t.value):new tZ(this.source,Gq(),t)}return Nw(Wq(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new tZ(this.source,jq(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class nZ{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Xq(e))return this.isFullyInitialized()&&!this.filtered_;const t=Wq(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function rZ(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Rw("Should only compare child_ events.");const r=new uj(t.childName,t.snapshotNode),i=new uj(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function iZ(e,t){return{eventCache:e,serverCache:t}}function sZ(e,t,n,r){return iZ(new nZ(t,n,r),e.serverCache)}function oZ(e,t,n,r){return iZ(e.eventCache,new nZ(t,n,r))}function aZ(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function lZ(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let cZ;class uZ{constructor(e,t=(()=>(cZ||(cZ=new yj(dq)),cZ))()){this.value=e,this.children=t}static fromObject(e){let t=new uZ(null);return mq(e,(e,n)=>{t=t.set(new Hq(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Gq(),value:this.value};if(Xq(e))return null;{const n=Wq(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(jq(e),t);return null!=i?{path:Qq(new Hq(n),i.path),value:i.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Xq(e))return this;{const t=Wq(e),n=this.children.get(t);return null!==n?n.subtree(jq(e)):new uZ(null)}}set(e,t){if(Xq(e))return new uZ(t,this.children);{const n=Wq(e),r=(this.children.get(n)||new uZ(null)).set(jq(e),t),i=this.children.insert(n,r);return new uZ(this.value,i)}}remove(e){if(Xq(e))return this.children.isEmpty()?new uZ(null):new uZ(null,this.children);{const t=Wq(e),n=this.children.get(t);if(n){const r=n.remove(jq(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new uZ(null):new uZ(this.value,i)}return this}}get(e){if(Xq(e))return this.value;{const t=Wq(e),n=this.children.get(t);return n?n.get(jq(e)):null}}setTree(e,t){if(Xq(e))return t;{const n=Wq(e),r=(this.children.get(n)||new uZ(null)).setTree(jq(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new uZ(this.value,i)}}fold(e){return this.fold_(Gq(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(Qq(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Gq(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Xq(e))return null;{const r=Wq(e),i=this.children.get(r);return i?i.findOnPath_(jq(e),Qq(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Gq(),t)}foreachOnPath_(e,t,n){if(Xq(e))return this;{this.value&&n(t,this.value);const r=Wq(e),i=this.children.get(r);return i?i.foreachOnPath_(jq(e),Qq(t,r),n):new uZ(null)}}foreach(e){this.foreach_(Gq(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(Qq(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class hZ{constructor(e){this.writeTree_=e}static empty(){return new hZ(new uZ(null))}}function dZ(e,t,n){if(Xq(t))return new hZ(new uZ(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=Jq(i,t);return s=s.updateChild(o,n),new hZ(e.writeTree_.set(i,s))}{const r=new uZ(n),i=e.writeTree_.setTree(t,r);return new hZ(i)}}}function pZ(e,t,n){let r=e;return mq(n,(e,n)=>{r=dZ(r,Qq(t,e),n)}),r}function fZ(e,t){if(Xq(t))return hZ.empty();{const n=e.writeTree_.setTree(t,new uZ(null));return new hZ(n)}}function gZ(e,t){return null!=mZ(e,t)}function mZ(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Jq(n.path,t)):null}function yZ(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Oj,(e,n)=>{t.push(new uj(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new uj(e,n.value))}),t}function vZ(e,t){if(Xq(t))return e;{const n=mZ(e,t);return new hZ(null!=n?new uZ(n):e.writeTree_.subtree(t))}}function _Z(e){return e.writeTree_.isEmpty()}function CZ(e,t){return EZ(Gq(),e.writeTree_,t)}function EZ(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(Nw(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=EZ(Qq(e,t),i,n)}),!n.getChild(e).isEmpty()&&null!==r&&(n=n.updateChild(Qq(e,".priority"),r)),n}}function wZ(e,t){return RZ(t,e)}function bZ(e,t){if(e.snap)return nj(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&nj(Qq(e.path,n),t))return!0;return!1}function SZ(e){return e.visible}function PZ(e,t,n){let r=hZ.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)nj(n,e)?(t=Jq(n,e),r=dZ(r,t,s.snap)):nj(e,n)&&(t=Jq(e,n),r=dZ(r,Gq(),s.snap.getChild(t)));else{if(!s.children)throw Rw("WriteRecord should have .snap or .children");if(nj(n,e))t=Jq(n,e),r=pZ(r,t,s.children);else if(nj(e,n))if(t=Jq(e,n),Xq(t))r=pZ(r,Gq(),s.children);else{const e=sb(s.children,Wq(t));if(e){const n=e.getChild(jq(t));r=dZ(r,Gq(),n)}}}}}return r}function OZ(e,t,n,r,i){if(r||i){const s=vZ(e.visibleWrites,t);return!i&&_Z(s)?n:i||null!=n||gZ(s,Gq())?CZ(PZ(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(nj(e.path,t)||nj(t,e.path))},t),n||xj.EMPTY_NODE):null}{const r=mZ(e.visibleWrites,t);if(null!=r)return r;{const r=vZ(e.visibleWrites,t);return _Z(r)?n:null!=n||gZ(r,Gq())?CZ(r,n||xj.EMPTY_NODE):null}}}function TZ(e,t,n,r){return OZ(e.writeTree,e.treePath,t,n,r)}function IZ(e,t){return function(e,t,n){let r=xj.EMPTY_NODE;const i=mZ(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Oj,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=vZ(e.visibleWrites,t);return n.forEachChild(Oj,(e,t)=>{const n=CZ(vZ(i,new Hq(e)),t);r=r.updateImmediateChild(e,n)}),yZ(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return yZ(vZ(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function kZ(e,t,n,r){return function(e,t,n,r,i){Nw(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Qq(t,n);if(gZ(e.visibleWrites,s))return null;{const t=vZ(e.visibleWrites,s);return _Z(t)?i.getChild(n):CZ(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function AZ(e,t){return function(e,t){return mZ(e.visibleWrites,t)}(e.writeTree,Qq(e.treePath,t))}function MZ(e,t,n){return function(e,t,n,r){const i=Qq(t,n),s=mZ(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?CZ(vZ(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function NZ(e,t){return RZ(Qq(e.treePath,t),e.writeTree)}function RZ(e,t){return{treePath:e,writeTree:t}}class xZ{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Nw("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Nw(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Bj(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,function(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Rw("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Bj(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const DZ=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class LZ{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new nZ(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return MZ(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:lZ(this.viewCache_),i=function(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const l=vZ(e.visibleWrites,t),c=mZ(l,Gq());if(null!=c)a=c;else{if(null==n)return[];a=CZ(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function FZ(e,t,n,r,i,s){const o=t.eventCache;if(null!=AZ(r,n))return t;{let a,l;if(Xq(n))if(Nw(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=lZ(t),i=IZ(r,n instanceof xj?n:xj.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=TZ(r,lZ(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=Wq(n);if(".priority"===c){Nw(1===qq(n),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=kZ(r,n,i,l);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=jq(n);let h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=kZ(r,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else h=MZ(r,c,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),c,h,u,i,s):o.getNode()}}return sZ(t,a,o.isFullyInitialized()||Xq(n),e.filter.filtersNodes())}}function UZ(e,t,n,r,i,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(Xq(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),e,null)}else{const e=Wq(n);if(!l.isCompleteForPath(n)&&qq(n)>1)return t;const i=jq(n),s=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,i,DZ,null)}const h=oZ(t,c,l.isFullyInitialized()||Xq(n),u.filtersNodes());return FZ(e,h,n,i,new LZ(i,h,s),a)}function BZ(e,t,n,r,i,s,o){const a=t.eventCache;let l,c;const u=new LZ(i,t,s);if(Xq(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=sZ(t,c,!0,e.filter.filtersNodes());else{const i=Wq(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=sZ(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=jq(n),c=a.getNode().getImmediateChild(i);let h;if(Xq(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===Zq(s)&&e.getChild(Kq(s)).isEmpty()?e:e.updateChild(s,r):xj.EMPTY_NODE}l=c.equals(h)?t:sZ(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return l}function VZ(e,t){return e.eventCache.isCompleteForChild(t)}function $Z(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function zZ(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Xq(n)?r:new uZ(null).setTree(n,r);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const l=$Z(0,t.serverCache.getNode().getImmediateChild(n),r);c=UZ(e,c,new Hq(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!l){const l=$Z(0,t.serverCache.getNode().getImmediateChild(n),r);c=UZ(e,c,new Hq(n),l,i,s,o,a)}}),c}function HZ(e,t){const n=lZ(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Xq(t)&&!n.getImmediateChild(Wq(t)).isEmpty())?n.getChild(t):null}function GZ(e,t,n,r){t.type===Qj.MERGE&&null!==t.source.queryId&&(Nw(lZ(e.viewCache_),"We should always have a full cache before handling merges"),Nw(aZ(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new xZ;let o,a;if(n.type===Qj.OVERWRITE){const l=n;l.source.fromUser?o=BZ(e,t,l.path,l.snap,r,i,s):(Nw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!Xq(l.path),o=UZ(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===Qj.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,l)=>{const c=Qq(n,r);VZ(t,Wq(c))&&(a=BZ(e,a,c,l,i,s,o))}),r.foreach((r,l)=>{const c=Qq(n,r);VZ(t,Wq(c))||(a=BZ(e,a,c,l,i,s,o))}),a}(e,t,l.path,l.children,r,i,s):(Nw(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=zZ(e,t,l.path,l.children,r,i,a,s))}else if(n.type===Qj.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=AZ(r,n))return t;{const a=new LZ(r,t,i),l=t.eventCache.getNode();let c;if(Xq(n)||".priority"===Wq(n)){let n;if(t.serverCache.isFullyInitialized())n=TZ(r,lZ(t));else{const e=t.serverCache.getNode();Nw(e instanceof xj,"serverChildren would be complete if leaf node"),n=IZ(r,e)}n=n,c=e.filter.updateFullNode(l,n,s)}else{const i=Wq(n);let u=MZ(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?e.filter.updateChild(l,i,u,jq(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,xj.EMPTY_NODE,jq(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=TZ(r,lZ(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=AZ(r,Gq()),sZ(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=AZ(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(Xq(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return UZ(e,t,n,l.getNode().getChild(n),i,s,a,o);if(Xq(n)){let r=new uZ(null);return l.getNode().forEachChild(pj,(e,t)=>{r=r.set(new Hq(e),t)}),zZ(e,t,n,r,i,s,a,o)}return t}{let c=new uZ(null);return r.foreach((e,t)=>{const r=Qq(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))}),zZ(e,t,n,c,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==Qj.LISTEN_COMPLETE)throw Rw("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache;return FZ(e,oZ(t,s.getNode(),s.isFullyInitialized()||Xq(n),s.isFiltered()),n,r,DZ,i)}(e,t,n.path,r,s)}const l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=aZ(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(function(e){return{type:"value",snapshotNode:e}}(aZ(t)))}}(t,o,l),{viewCache:o,changes:l}}(e.processor_,i,t,n,r);return function(e,t){Nw(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),Nw(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}(e.processor_,s.viewCache),Nw(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,function(e,t,n,r){return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(function(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}(t.childName,t.snapshotNode))}),rZ(e,i,"child_removed",t,r,n),rZ(e,i,"child_added",t,r,n),rZ(e,i,"child_moved",s,r,n),rZ(e,i,"child_changed",t,r,n),rZ(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r?[r]:e.eventRegistrations_)}(e,s.changes,s.viewCache.eventCache.getNode(),null)}let WZ,qZ;function jZ(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return Nw(null!=s,"SyncTree gave us an op for an invalid query."),GZ(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(GZ(s,t,n,r));return i}}function ZZ(e,t){let n=null;for(const r of e.views.values())n=n||HZ(r,t);return n}class YZ{constructor(e){this.listenProvider_=e,this.syncPointTree_=new uZ(null),this.pendingWriteTree_={visibleWrites:hZ.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function KZ(e,t,n,r,i){return function(e,t,n,r,i){Nw(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=dZ(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?eY(e,new eZ({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function QZ(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);Nw(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&bZ(t,r.path)?i=!1:nj(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?(function(e){e.visibleWrites=PZ(e.allWrites,SZ,Gq()),e.lastWriteId=e.allWrites.length>0?e.allWrites[e.allWrites.length-1].writeId:-1}(e),!0):(r.snap?e.visibleWrites=fZ(e.visibleWrites,r.path):mq(r.children,t=>{e.visibleWrites=fZ(e.visibleWrites,Qq(r.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new uZ(null);return null!=r.snap?t=t.set(Gq(),!0):mq(r.children,e=>{t=t.set(new Hq(e),!0)}),eY(e,new Jj(r.path,t,n))}return[]}function XZ(e,t,n){return eY(e,new eZ({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function JZ(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=ZZ(n,Jq(e,t));if(r)return r});return OZ(r,t,i,n,!0)}function eY(e,t){return tY(t,e.syncPointTree_,null,wZ(e.pendingWriteTree_,Gq()))}function tY(e,t,n,r){if(Xq(e.path))return nY(e,t,n,r);{const i=t.get(Gq());null==n&&null!=i&&(n=ZZ(i,Gq()));let s=[];const o=Wq(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=NZ(r,o);s=s.concat(tY(a,l,e,t))}return i&&(s=s.concat(jZ(i,e,r,n))),s}}function nY(e,t,n,r){const i=t.get(Gq());null==n&&null!=i&&(n=ZZ(i,Gq()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=NZ(r,t),l=e.operationForChild(t);l&&(s=s.concat(nY(l,i,o,a)))}),i&&(s=s.concat(jZ(i,e,r,n))),s}function rY(e,t){return e.tagToQueryMap.get(t)}function iY(e){const t=e.indexOf("$");return Nw(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Hq(e.substr(0,t))}}function sY(e,t,n){const r=e.syncPointTree_.get(t);return Nw(r,"Missing sync point for query tag that we're tracking"),jZ(r,n,wZ(e.pendingWriteTree_,t),null)}class oY{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new oY(t)}node(){return this.node_}}class aY{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Qq(this.path_,e);return new aY(this.syncTree_,t)}node(){return JZ(this.syncTree_,this.path_)}}const lY=function(e,t,n){return e&&"object"==typeof e?(Nw(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?cY(e[".sv"],t,n):"object"==typeof e[".sv"]?uY(e[".sv"],t):void Nw(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},cY=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Nw(!1,"Unexpected server value: "+e)}},uY=function(e,t,n){e.hasOwnProperty("increment")||Nw(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Nw(!1,"Unexpected increment value: "+r);const i=t.node();if(Nw(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},hY=function(e,t,n){return dY(e,new oY(t),n)};function dY(e,t,n){const r=e.getPriority().val(),i=lY(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=lY(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new Pj(s,Lj(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new Pj(i))),r.forEachChild(Oj,(e,r)=>{const i=dY(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class pY{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function fY(e,t){let n=t instanceof Hq?t:new Hq(t),r=e,i=Wq(n);for(;null!==i;){const e=sb(r.node.children,i)||{children:{},childCount:0};r=new pY(i,r,e),n=jq(n),i=Wq(n)}return r}function gY(e){return e.node.value}function mY(e,t){e.node.value=t,EY(e)}function yY(e){return e.node.childCount>0}function vY(e,t){mq(e.node.children,(n,r)=>{t(new pY(n,e,r))})}function _Y(e,t,n,r){n&&!r&&t(e),vY(e,e=>{_Y(e,t,!0,r)}),n&&r&&t(e)}function CY(e){return new Hq(null===e.parent?e.name:CY(e.parent)+"/"+e.name)}function EY(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===gY(e)&&!yY(e)}(n),i=ib(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,EY(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,EY(e))}(e.parent,e.name,e)}const wY=/[\[\].#$\/\u0000-\u001F\u007F]/,bY=/[\[\].#$\u0000-\u001F\u007F]/,SY=10485760,PY=function(e){return"string"==typeof e&&0!==e.length&&!wY.test(e)},OY=function(e){return"string"==typeof e&&0!==e.length&&!bY.test(e)},TY=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!lq(e)||e&&"object"==typeof e&&ib(e,".sv")},IY=function(e,t,n,r){r&&void 0===t||kY(mb(e,"value"),t,n)},kY=function(e,t,n){const r=n instanceof Hq?new rj(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+sj(r));if("function"==typeof t)throw new Error(e+"contains a function "+sj(r)+" with contents = "+t.toString());if(lq(t))throw new Error(e+"contains "+t.toString()+" "+sj(r));if("string"==typeof t&&t.length>SY/3&&yb(t)>SY)throw new Error(e+"contains a string greater than "+SY+" utf8 bytes "+sj(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(mq(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!PY(t)))throw new Error(e+" contains an invalid key ("+t+") "+sj(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=yb(t),ij(e)})(r,t),kY(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=yb(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+sj(r)+" in addition to actual children.")}},AY=function(e,t,n,r){if(!(r&&void 0===n||OY(n)))throw new Error(mb(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},MY=function(e,t){if(".info"===Wq(t))throw new Error(e+" failed = Can't modify data under /.info/")};class NY{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function RY(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null!==n&&!tj(s,n.path)&&(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function xY(e,t,n){RY(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];i&&(t(i.path)?(DY(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>nj(e,t)||nj(t,e))}function DY(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();tq&&rq("event: "+n.toString()),Cq(r)}}}class LY{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new NY,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Wj(),this.transactionQueueTree_=new pY,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function FY(e){const t=e.infoData_.getNode(new Hq(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function UY(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:FY(e)})}function BY(e,t,n,r,i){e.dataUpdateCount++;const s=new Hq(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=ab(n,e=>Lj(e));o=function(e,t,n,r){const i=rY(e,r);if(i){const r=iY(i),s=r.path,o=r.queryId,a=Jq(s,t),l=uZ.fromObject(n);return sY(e,s,new tZ(Xj(o),a,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=Lj(n);o=function(e,t,n,r){const i=rY(e,r);if(null!=i){const r=iY(i),s=r.path,o=r.queryId,a=Jq(s,t);return sY(e,s,new eZ(Xj(o),a,n))}return[]}(e.serverSyncTree_,s,t,i)}else if(r){const t=ab(n,e=>Lj(e));o=function(e,t,n){const r=uZ.fromObject(n);return eY(e,new tZ({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=Lj(n);o=XZ(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=YY(e,s)),xY(e.eventQueue_,a,o)}function VY(e,t){$Y(e,"connected",t),!1===t&&function(e){WY(e,"onDisconnectEvents");const t=UY(e),n=Wj();Zj(e.onDisconnect_,Gq(),(r,i)=>{const s=function(e,t,n,r){return dY(t,new aY(n,e),r)}(r,i,e.serverSyncTree_,t);qj(n,r,s)});let r=[];Zj(n,Gq(),(t,n)=>{r=r.concat(XZ(e.serverSyncTree_,t,n));const i=eK(e,t);YY(e,i)}),e.onDisconnect_=Wj(),xY(e.eventQueue_,Gq(),r)}(e)}function $Y(e,t,n){const r=new Hq("/.info/"+t),i=Lj(n);e.infoData_.updateSnapshot(r,i);const s=XZ(e.infoSyncTree_,r,i);xY(e.eventQueue_,r,s)}function zY(e){return e.nextWriteId_++}function HY(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&jj(e.onDisconnect_,t),qY(0,n,r,i)})}function GY(e,t,n,r){const i=Lj(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&qj(e.onDisconnect_,t,i),qY(0,r,n,s)})}function WY(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),rq(n,...t)}function qY(e,t,n,r){t&&Cq(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function jY(e,t,n){return JZ(e.serverSyncTree_,t,n)||xj.EMPTY_NODE}function ZY(e,t=e.transactionQueueTree_){if(t||JY(e,t),gY(t)){const n=QY(e,t);Nw(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=jY(e,t,r);let s=i;const o=i.hash();for(let c=0;c<n.length;c++){const e=n[c];Nw(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=Jq(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,r=>{WY(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(QZ(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();JY(e,fY(e.transactionQueueTree_,t)),ZY(e,e.transactionQueueTree_),xY(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Cq(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)n[e].status=3===n[e].status?4:0;else{aq("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}YY(e,t)}},o)}(e,CY(t),n)}else yY(t)&&vY(t,t=>{ZY(e,t)})}function YY(e,t){const n=KY(e,t),r=CY(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],l=Jq(n,a.path);let c,u=!1;if(Nw(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,c=a.abortReason,i=i.concat(QZ(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,c="maxretry",i=i.concat(QZ(e.serverSyncTree_,a.currentWriteId,!0));else{const n=jY(e,a.path,s);a.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){kY("transaction failed: Data returned ",r,a.path);let t=Lj(r);"object"==typeof r&&null!=r&&ib(r,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,l=UY(e),c=hY(t,n,l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=c,a.currentWriteId=zY(e),s.splice(s.indexOf(o),1),i=i.concat(KZ(e.serverSyncTree_,a.path,c,a.currentWriteId,a.applyLocally)),i=i.concat(QZ(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",i=i.concat(QZ(e.serverSyncTree_,a.currentWriteId,!0))}xY(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&r.push("nodata"===c?()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot):()=>t[o].onComplete(new Error(c),!1,null)))}JY(e,e.transactionQueueTree_);for(let o=0;o<r.length;o++)Cq(r[o]);ZY(e,e.transactionQueueTree_)}(e,QY(e,n),r),r}function KY(e,t){let n,r=e.transactionQueueTree_;for(n=Wq(t);null!==n&&void 0===gY(r);)r=fY(r,n),n=Wq(t=jq(t));return r}function QY(e,t){const n=[];return XY(e,t,n),n.sort((e,t)=>e.order-t.order),n}function XY(e,t,n){const r=gY(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);vY(t,t=>{XY(e,t,n)})}function JY(e,t){const n=gY(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,mY(t,n.length>0?n:void 0)}vY(t,t=>{JY(e,t)})}function eK(e,t){const n=CY(KY(e,t)),r=fY(e.transactionQueueTree_,t);return function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{tK(e,t)}),tK(e,r),_Y(r,t=>{tK(e,t)}),n}function tK(e,t){const n=gY(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(Nw(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(Nw(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(QZ(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?mY(t,void 0):n.length=s+1,xY(e.eventQueue_,CY(t),i);for(let e=0;e<r.length;e++)Cq(r[e])}}const nK=function(e,t){const n=rK(e),r=n.namespace;return"firebase.com"===n.domain&&oq(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==n.domain&&oq("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&aq("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Tq(n.host,n.secure,r,"ws"===n.scheme||"wss"===n.scheme,t,"",r!==n.subdomain),path:new Hq(n.pathString)}},rK=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch{}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):aq(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class iK{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new zw;return HY(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){MY("OnDisconnect.remove",this._path);const e=new zw;return GY(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){MY("OnDisconnect.set",this._path),IY("OnDisconnect.set",e,this._path,!1);const t=new zw;return GY(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){MY("OnDisconnect.setWithPriority",this._path),IY("OnDisconnect.setWithPriority",e,this._path,!1),function(e,t,n){if(!n||void 0!==t){if(lq(t))throw new Error(mb(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!TY(t))throw new Error(mb(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}("OnDisconnect.setWithPriority",t,!1);const n=new zw;return function(e,t,n,r,i){const s=Lj(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&qj(e.onDisconnect_,t,s),qY(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){MY("OnDisconnect.update",this._path),function(e,t,n,r){if(r&&void 0===t)return;const i=mb(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];mq(t,(e,t)=>{const r=new Hq(e);if(kY(i,t,Qq(n,r)),".priority"===Zq(r)&&!TY(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=Yq(r);for(let t=0;t<i.length;t++)if((".priority"!==i[t]||t!==i.length-1)&&!PY(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(ej);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&nj(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)}("OnDisconnect.update",e,this._path,!1);const t=new zw;return function(e,t,n,r){if(ob(n))return rq("onDisconnect().update() called with empty data.  Don't do anything."),void qY(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&mq(n,(n,r)=>{const i=Lj(r);qj(e.onDisconnect_,Qq(t,n),i)}),qY(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class sK{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Xq(this._path)?null:Zq(this._path)}get ref(){return new oK(this._repo,this._path)}get _queryIdentifier(){const e=zj(this._queryParams),t=fq(e);return"{}"===t?"default":t}get _queryObject(){return zj(this._queryParams)}isEqual(e){if(!((e=_b(e))instanceof sK))return!1;const t=this._repo===e._repo,n=tj(this._path,e._path);return t&&n&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class oK extends sK{constructor(e,t){super(e,t,new Vj,!1)}get parent(){const e=Kq(this._path);return null===e?null:new oK(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function aK(e,t){return(e=_b(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){return null===Wq((e=_b(e))._path)?function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),AY(e,t,n,r)}("child","path",t,!1):AY("child","path",t,!1),new oK(e._repo,Qq(e._path,t))}(e._root,t):e._root}function lK(e){return e=_b(e),new iK(e._repo,e._path)}function cK(e,t){e=_b(e),MY("set",e._path),IY("set",t,e._path,!1);const n=new zw;return function(e,t,n,r,i){WY(e,"set",{path:t.toString(),value:n,priority:r});const s=UY(e),o=Lj(n,r),a=JZ(e.serverSyncTree_,t),l=hY(o,a,s),c=zY(e),u=KZ(e.serverSyncTree_,t,l,c,!0);RY(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||aq("set at "+t+" failed: "+n);const o=QZ(e.serverSyncTree_,c,!s);xY(e.eventQueue_,t,o),qY(0,i,n,r)});const h=eK(e,t);YY(e,h),xY(e.eventQueue_,h,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}(function(e){Nw(!WZ,"__referenceConstructor has already been defined"),WZ=e})(oK),function(e){Nw(!qZ,"__referenceConstructor has already been defined"),qZ=e}(oK);const uK={};function hK(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||oq("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rq("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=nK(s,i),c=l.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${c.namespace}`,l=nK(s,i),c=l.repoInfo):o=!l.repoInfo.secure;const u=i&&o?new Sq(Sq.OWNER):new bq(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!PY(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),OY(e)}(n))throw new Error(mb(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",l),Xq(l.path)||oq("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=uK[t.name];i||(i={},uK[t.name]=i);let s=i[e.toURLString()];return s&&oq("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new LY(e,false,n,r),i[e.toURLString()]=s,s}(c,e,u,new wq(e.name,n));return new dK(h,e)}class dK{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=Nq(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Hj(e.repoInfo_,(t,n,r,i)=>{BY(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>VY(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{nb(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new cj(e.repoInfo_,t,(t,n,r,i)=>{BY(e,t,n,r,i)},t=>{VY(e,t)},t=>{!function(e,t){mq(t,(t,n)=>{$Y(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return Mq[n]||(Mq[n]=t()),Mq[n]}(e.repoInfo_,()=>new Kj(e.stats_,e.server_)),e.infoData_=new Gj,e.infoSyncTree_=new YZ({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=XZ(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),$Y(e,"connected",!1),e.serverSyncTree_=new YZ({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);xY(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new oK(this._repo,Gq())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=uK[t];(!n||n[e.key]!==e)&&oq(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&oq("Cannot call "+e+" on a deleted database.")}}function pK(e=cS(),t){return iS(e,"database").getImmediate({identifier:t})}function fK(e,t,n,r={}){(e=_b(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&oq("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&oq('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Sq(Sq.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Hw(r.mockUserToken,e.app.options.projectId);s=new Sq(t)}!function(e,t,n,r){e.repoInfo_=new Tq(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}const gK={".sv":"timestamp"};function mK(){return gK}cj.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},cj.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},WW="9.9.0",rS(new Cb("database",(e,{instanceIdentifier:t})=>hK(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),hS(GW,"0.13.3",void 0),hS(GW,"0.13.3","esm2017");class yK{constructor(e){return e}}const vK=new or("angularfire2.database-instances");function _K(e){return(t,n)=>{const r=t.runOutsideAngular(()=>e(n));return new yK(r)}}const CK={provide:class{constructor(){return lI("database")}},deps:[[new Nr,vK]]},EK={provide:yK,useFactory:function(e,t){const n=aI("database",e,t);return n&&new yK(n)},deps:[[new Nr,vK],_I]};let wK=(()=>{class e{constructor(){hS("angularfire",eI.full,"rtdb")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({providers:[EK,CK]}),e})();const bK=vI(fK,!0),SK=vI(pK,!0),PK=vI(lK,!0),OK=vI(aK,!0),TK=vI(cK,!0);class IK{constructor(e){this.db=e}setOffline(e){return TK(OK(this.db,"/status/"+e),IK.OFFLINE)}launchAutomaticPresenceUpdate(e){var t=this;return Pw(function*(){const n=OK(t.db,"/status/"+e);yield TK(n,IK.ONLINE),yield PK(n).set(IK.OFFLINE)})()}}IK.OFFLINE={last_changed:mK()},IK.ONLINE={last_changed:mK()},IK.\u0275fac=function(e){return new(e||IK)(Or(yK))},IK.\u0275prov=be({token:IK,factory:IK.\u0275fac,providedIn:"root"});class kK{static createUserWithEmailAndPassword(e,t,n){return FN(e,t,n)}static sendEmailVerification(e){return VN(e)}static sendPasswordResetEmail(e,t){return $N(e,t)}static signInWithEmailAndPassword(e,t,n){return Pw(function*(){return(yield zN(e,t,n)).user})()}static signInWithPopup(e,t){return Pw(function*(){return(yield HN(e,t)).user})()}static updateProfile(e,t){return GN(e,t)}}class AK{constructor(e,t,n,r){this.id=e,this.email=t,this.username=n,this.verified=r}isConnected(){return this.email.isPresent()}toMinimalUser(){return{id:this.id,name:this.username.get()}}}AK.NOT_CONNECTED=new AK("",Mw.empty(),Mw.empty(),!1);let MK=(()=>{class e{constructor(t,n,r){var i=this;this.userDAO=t,this.auth=n,this.connectivityDAO=r,this.user=Mw.empty(),this.userUnsubscribe=Mw.empty(),Tw(e.VERBOSE,"ConnectedUserService constructor"),this.userRS=new HW(1),this.userObs=this.userRS.asObservable(),this.unsubscribeFromAuth=BN(this.auth,function(){var t=Pw(function*(t){null==t?(Tw(e.VERBOSE,"User is not connected"),i.userUnsubscribe.isPresent()&&i.userUnsubscribe.get()(),i.userRS.next(AK.NOT_CONNECTED),i.user=Mw.empty()):(NW(i.user.isAbsent(),"ConnectedUserService received a double update for an user, this is unexpected"),yield i.connectivityDAO.launchAutomaticPresenceUpdate(t.uid),i.userUnsubscribe=Mw.of(i.userDAO.subscribeToChanges(t.uid,n=>{if(n.isPresent()){const r=n.get().username;Tw(e.VERBOSE,`User ${r} is connected, and the verified status is ${i.emailVerified(t)}`);const s=!0===i.emailVerified(t)&&null!=r;if(!0===s&&!1===n.get().verified)return i.userDAO.markVerified(t.uid);const o=new AK(t.uid,Mw.ofNullable(t.email),Mw.ofNullable(r),s);i.user=Mw.of(o),i.userRS.next(o)}})))});return function(e){return t.apply(this,arguments)}}())}emailVerified(e){return e.emailVerified}sendPasswordResetEmail(e){var t=this;return Pw(function*(){try{return yield kK.sendPasswordResetEmail(t.auth,e),TW.SUCCESS}catch(n){return TW.failure(t.mapFirebaseError(n))}})()}doRegister(t,n,r){var i=this;return Pw(function*(){return Tw(e.VERBOSE,"ConnectedUserService.doRegister("+n+")"),(yield i.userDAO.usernameIsAvailable(t))?i.registerAfterUsernameCheck(t,n,r):SW.failure($localize`This username is already in use.`)})()}registerAfterUsernameCheck(e,t,n){var r=this;return Pw(function*(){try{const i=yield kK.createUserWithEmailAndPassword(r.auth,t,n),s=Ow.getNonNullable(i.user);return yield r.createUser(s.uid,e),SW.success(s)}catch(i){return SW.failure(r.mapFirebaseError(i))}})()}mapFirebaseError(e){switch(e.code){case"auth/email-already-in-use":return $localize`This email address is already in use.`;case"auth/invalid-email":return $localize`This email address is invalid.`;case"auth/user-not-found":case"auth/wrong-password":return $localize`You have entered invalid credentials.`;case"auth/invalid-credential":return $localize`The credential is invalid or has expired, please try again.`;case"auth/weak-password":return $localize`Your password is too weak, please use a stronger password.`;case"auth/too-many-requests":return $localize`There has been too many requests from your device. You are temporarily blocked due to unusual activity. Try again later.`;case"auth/popup-closed-by-user":return $localize`You closed the authentication popup without finalizing your log in.`;case"auth/popup-blocked":return $localize`The authentication popup was blocked. Try again after disabling popup blocking.`;default:return MW.logError("ConnectedUserService","Unsupported firebase error",{errorCode:e.code,errorMessage:e.message}),e.message}}sendEmailVerification(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"ConnectedUserService.sendEmailVerification()");const n=Mw.ofNullable(t.auth.currentUser);if(!n.isPresent())return MW.logError("ConnectedUserService","Unlogged users cannot request for email verification");if(t.emailVerified(n.get()))return MW.logError("ConnectedUserService","Verified users should not ask email verification after being verified");try{return yield kK.sendEmailVerification(n.get()),TW.SUCCESS}catch(r){return TW.failure(t.mapFirebaseError(r))}})()}doEmailLogin(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"ConnectedUserService.doEmailLogin("+t+")");try{return yield kK.signInWithEmailAndPassword(r.auth,t,n),TW.SUCCESS}catch(i){return TW.failure(r.mapFirebaseError(i))}})()}createUser(e,t){var n=this;return Pw(function*(){null==t?yield n.userDAO.set(e,{verified:!1}):yield n.userDAO.set(e,{username:t,verified:!1})})()}doGoogleLogin(){var e=this;return Pw(function*(){return TW.ofFallible(yield e.registerOrLoginWithGoogle())})()}registerOrLoginWithGoogle(){var e=this;return Pw(function*(){try{const t=new GA;t.addScope("profile"),t.addScope("email");const n=yield kK.signInWithPopup(e.auth,t);return!1===(yield e.userDAO.exists(n.uid))&&(yield e.createUser(n.uid)),SW.success(n)}catch(t){return SW.failure(e.mapFirebaseError(t))}})()}disconnect(){var e=this;return Pw(function*(){const t=Mw.ofNullable(e.auth.currentUser);if(t.isPresent()){const n=t.get().uid;return yield e.connectivityDAO.setOffline(n),yield e.auth.signOut(),TW.SUCCESS}return TW.failure("Cannot disconnect a non-connected user")})()}getUserObs(){return this.userObs}setUsername(e){var t=this;return Pw(function*(){if(""===e)return TW.failure($localize`Your username may not be empty.`);try{if(!1===(yield t.userDAO.usernameIsAvailable(e)))return TW.failure($localize`This username is already in use, please select a different one.`);const n=Ow.getNonNullable(t.auth.currentUser);return yield kK.updateProfile(n,{displayName:e}),yield t.userDAO.setUsername(n.uid,e),yield t.userDAO.markVerified(n.uid),yield t.reloadUser(),TW.SUCCESS}catch(n){return TW.failure(t.mapFirebaseError(n))}})()}setPicture(e){var t=this;return Pw(function*(){try{const n=Ow.getNonNullable(t.auth.currentUser);return yield kK.updateProfile(n,{photoURL:e}),TW.SUCCESS}catch(n){return TW.failure(t.mapFirebaseError(n))}})()}reloadUser(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.auth.currentUser);yield t.getIdToken(!0),yield t.reload()})()}updateObservedPart(e){return NW(this.user.isPresent(),"Should not call updateObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:e})}removeObservedPart(){return NW(this.user.isPresent(),"Should not call removeObservedPart when not connected"),this.userDAO.update(this.user.get().id,{observedPart:null})}sendPresenceToken(){return NW(this.user.isPresent(),"Should not call sendPresenceToken when not connected"),this.userDAO.updatePresenceToken(this.user.get().id)}ngOnDestroy(){this.userUnsubscribe.isPresent()&&this.userUnsubscribe.get()(),this.unsubscribeFromAuth()}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(VW),Or(kN),Or(IK))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class NK{constructor(e){this.value=e}static of(e){switch(e){case"CREATOR":return NK.CREATOR;case"RANDOM":return NK.RANDOM;default:return NW("CHOSEN_PLAYER"===e,"Invalid value for FirstPlayer: "+e+"."),NK.CHOSEN_PLAYER}}}NK.CREATOR=new NK("CREATOR"),NK.RANDOM=new NK("RANDOM"),NK.CHOSEN_PLAYER=new NK("CHOSEN_PLAYER");class RK{constructor(e){this.value=e}static of(e){switch(e){case"STANDARD":return RK.STANDARD;case"BLITZ":return RK.BLITZ;case"CUSTOM":return RK.CUSTOM;default:throw new Error("Invalid part type: "+e+".")}}}RK.STANDARD=new RK("STANDARD"),RK.BLITZ=new RK("BLITZ"),RK.CUSTOM=new RK("CUSTOM"),RK.NORMAL_MOVE_DURATION=120,RK.NORMAL_PART_DURATION=1800,RK.BLITZ_MOVE_DURATION=30,RK.BLITZ_PART_DURATION=900;class xK{constructor(e){this.value=e}}xK.PART_CREATED=new xK(0),xK.CONFIG_PROPOSED=new xK(2),xK.PART_STARTED=new xK(3),xK.PART_FINISHED=new xK(4);class DK{}class LK extends DK{static disjunction3(e,t,n,r,i){return new class extends LK{encodeMove(s){return r(s)?{type:"T1",encoded:e.encode(s)}:i(s)?{type:"T2",encoded:t.encode(s)}:{type:"T3",encoded:n.encode(s)}}decodeMove(r){const i=Ow.getNonNullable(r).type,s=Ow.getNonNullable(r).encoded;return"T1"===i?e.decode(s):"T2"===i?t.decode(s):n.decode(s)}}}encode(e){return this.encodeMove(e)}decode(e){return NW(!1===Array.isArray(e),"MoveEncoder.decode called with an array"),this.decodeMove(e)}}class FK extends LK{static ofN(e,t,n){return new class extends FK{maxValue(){return e}encodeNumber(e){return t(e)}decodeNumber(e){return n(e)}}}static tuple(e,t,n){return new class extends FK{maxValue(){let t=0;return Object.keys(e).forEach(n=>{t=t*e[n].shift()+e[n].maxValue()}),t}encodeNumber(n){const r=t(n);let i=0;return Object.keys(r).forEach(t=>{i=i*e[t].shift()+e[t].encode(r[t])}),i}decodeNumber(t){const r={};let i=t;return Object.keys(e).reverse().forEach(t=>{const n=i%e[t].shift();i=(i-n)/e[t].shift(),r[t]=e[t].decode(n)}),n(r)}}}static disjunction(e,t,n){return new class extends FK{maxValue(){return Math.max(2*e.maxValue(),2*t.maxValue()+1)}encodeNumber(r){return n(r)?2*e.encodeNumber(r):2*t.encodeNumber(r)+1}decodeNumber(n){return n%2==0?e.decodeNumber(n/2):t.decodeNumber((n-1)/2)}}}static numberEncoder(e){return new class extends FK{maxValue(){return e}encodeNumber(t){if(t>e)throw new Error("Cannot encode number bigger than the max with numberEncoder");return t}decodeNumber(t){if(t>e)throw new Error("Cannot decode number bigger than the max with numberEncoder");return t}}}shift(){return this.maxValue()+1}encodeMove(e){return this.encodeNumber(e)}decodeMove(e){return NW("number"==typeof e,"Invalid encoded number"),this.decodeNumber(e)}}FK.booleanEncoder=new class extends FK{maxValue(){return 1}encodeNumber(e){return e?1:0}decodeNumber(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid encoded boolean")}};class UK{constructor(){this.value=2}isPlayer(){return!1}toString(){return"PlayerNone"}equals(e){return this===e}}UK.NONE=new UK;class BK{constructor(e){this.value=e}static of(e){switch(e){case 0:return BK.ZERO;default:return Ow.expectToBe(e,1),BK.ONE}}static fromTurn(e){return e%2==0?BK.ZERO:BK.ONE}isPlayer(){return!0}toString(){return"Player "+this.value}equals(e){return this===e}getScoreModifier(){return 0===this.value?-1:1}getPreVictory(){return this.getVictoryValue()-this.getScoreModifier()}getDefeatValue(){return this===BK.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER}getVictoryValue(){return this===BK.ZERO?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER}getOpponent(){switch(this){case BK.ZERO:return BK.ONE;default:return Ow.expectToBe(this,BK.ONE),BK.ZERO}}}var VK;BK.numberEncoder=FK.ofN(2,e=>e.value,e=>2===e?VK.NONE:BK.of(e)),BK.ZERO=new BK(0),BK.ONE=new BK(1),BK.PLAYERS=[BK.ZERO,BK.ONE],function(e){e.ZERO=BK.ZERO,e.ONE=BK.ONE,e.NONE=UK.NONE}(VK||(VK={}));class $K{static rematchAccepted(e,t){return zK("RematchAccepted",{typeGame:e,partId:t})}static getPlayer(e){return BK.of(Ow.getNonNullable(e.data).player)}static getTypeGame(e){return Ow.getNonNullable(e.data).typeGame}static getPartId(e){return Ow.getNonNullable(e.data).partId}}function zK(e,t){return{code:e,data:t}}function HK(e){return t=>zK(e,{player:t.value})}$K.drawProposed=HK("DrawProposed"),$K.drawAccepted=zK("DrawAccepted",{}),$K.drawRefused=HK("DrawRefused"),$K.takeBackAsked=HK("TakeBackAsked"),$K.takeBackRefused=HK("TakeBackRefused"),$K.takeBackAccepted=HK("TakeBackAccepted"),$K.rematchProposed=HK("RematchProposed"),$K.addTurnTime=HK("AddTurnTime"),$K.addGlobalTime=HK("AddGlobalTime");class GK{static mapBiArray(e,t){const n=[];let r=0;for(;r<e.length;){n[r]=[];let i=0;for(;i<e[r].length;)n[r][i]=t(e[r][i]),i++;r++}return n}static createTable(e,t,n){const r=[];let i=t-1;for(;i>=0;){r[i]=[];let t=e-1;for(;t>=0;)r[i][t]=n,t--;i--}return r}static copyBiArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=GK.copyImmutableArray(e[n]),n++;return t}static copyImmutableArray(e){const t=[];let n=0;for(;n<e.length;)t[n]=e[n],n++;return t}static sortByDescending(e,t){e.sort((e,n)=>{const r=t(e),i=t(n);return r<i?1:r>i?-1:0})}static compareArray(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===Aw(e[n],t[n]))return!1;return!0}static compareTable(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!1===GK.compareArray(e[n],t[n]))return!1;return!0}}let WK=(()=>{class e extends bW{constructor(t){super("joiners",t),Tw(e.VERBOSE,"JoinerDAO.constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(nW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),qK=(()=>{class e{constructor(t){this.joinerDAO=t,this.joinerUnsubscribe=Mw.empty(),Tw(e.VERBOSE,"JoinerService.constructor")}subscribeToChanges(e,t){this.observedJoinerId=e,this.joinerUnsubscribe=Mw.of(this.joinerDAO.subscribeToChanges(e,t))}unsubscribe(){NW(this.joinerUnsubscribe.isPresent(),"JoinerService cannot unsubscribe if no joiner is observed"),this.joinerUnsubscribe.get()(),this.joinerUnsubscribe=Mw.empty()}createInitialJoiner(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.createInitialJoiner("+t.id+", "+n+")"),r.set(n,{candidates:[],chosenOpponent:null,firstPlayer:NK.RANDOM.value,partType:RK.STANDARD.value,partStatus:xK.PART_CREATED.value,maximalMoveDuration:RK.NORMAL_MOVE_DURATION,totalPartDuration:RK.NORMAL_PART_DURATION,creator:t})})()}joinGame(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"JoinerService.joinGame("+t+", "+n.id+")");const i=yield r.joinerDAO.read(t);if(i.isAbsent())return TW.failure(e.GAME_DOES_NOT_EXIST());const s=GK.copyImmutableArray(i.get().candidates);return s.some(e=>e.id===n.id)?TW.failure(e.USER_ALREADY_IN_GAME()):(n.id===i.get().creator.id||(s[s.length]=n,yield r.joinerDAO.update(t,{candidates:s})),TW.SUCCESS)})()}cancelJoining(t){var n=this;return Pw(function*(){if(Tw(e.VERBOSE,"JoinerService.cancelJoining("+t.name+"); this.observedJoinerId = "+n.observedJoinerId),null==n.observedJoinerId)throw new Error("cannot cancel joining when not observing a joiner");const r=yield n.joinerDAO.read(n.observedJoinerId);if(!r.isAbsent()){const e=r.get(),i=GK.copyImmutableArray(e.candidates),s=i.findIndex(e=>e.id===t.id);let o=e.chosenOpponent,a=e.partStatus;if(i.splice(s,1),o?.id===t.id)o=null,a=xK.PART_CREATED.value;else if(-1===s)throw new Error("someone that was not candidate nor ChosenOpponent just left the chat: "+t.name);return n.joinerDAO.update(n.observedJoinerId,{chosenOpponent:o,partStatus:a,candidates:i})}})()}updateCandidates(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"JoinerService.reviewConfig"),NW(null!=n.observedJoinerId,"JoinerService is not observing a joiner");const r={candidates:t};return n.joinerDAO.update(Ow.getNonNullable(n.observedJoinerId),r)})()}deleteJoiner(){var t=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.deleteJoiner(); this.observedJoinerId = "+t.observedJoinerId),NW(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.delete(Ow.getNonNullable(t.observedJoinerId))})()}proposeConfig(t,n,r,i,s){var o=this;return Pw(function*(){return Tw(e.VERBOSE,{joinerService_proposeConfig:{maximalMoveDuration:r,firstPlayer:i,totalPartDuration:s}}),Tw(e.VERBOSE,"this.followedJoinerId: "+o.observedJoinerId),NW(null!=o.observedJoinerId,"JoinerService is not observing a joiner"),o.joinerDAO.update(Ow.getNonNullable(o.observedJoinerId),{partStatus:xK.CONFIG_PROPOSED.value,chosenOpponent:t,partType:n.value,maximalMoveDuration:r,totalPartDuration:s,firstPlayer:i.value})})()}setChosenOpponent(t){return Tw(e.VERBOSE,`JoinerService.setChosenOpponent(${t.name})`),NW(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(Ow.getNonNullable(this.observedJoinerId),{chosenOpponent:t})}reviewConfig(){var t=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.reviewConfig"),NW(null!=t.observedJoinerId,"JoinerService is not observing a joiner"),t.joinerDAO.update(Ow.getNonNullable(t.observedJoinerId),{partStatus:xK.PART_CREATED.value})})()}reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.reviewConfig"),NW(null!=n.observedJoinerId,"JoinerService is not observing a joiner"),n.joinerDAO.update(Ow.getNonNullable(n.observedJoinerId),{partStatus:xK.PART_CREATED.value,candidates:t,chosenOpponent:null})})()}acceptConfig(){return Tw(e.VERBOSE,"JoinerService.acceptConfig"),NW(null!=this.observedJoinerId,"JoinerService is not observing a joiner"),this.joinerDAO.update(Ow.getNonNullable(this.observedJoinerId),{partStatus:xK.PART_STARTED.value})}createJoiner(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.create("+JSON.stringify(t)+")"),n.joinerDAO.create(t)})()}readJoinerById(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.readJoinerById("+t+")"),(yield n.joinerDAO.read(t)).get()})()}set(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,"JoinerService.set("+t+", "+JSON.stringify(n)+")"),r.joinerDAO.set(t,n)})()}updateJoinerById(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,{joinerService_updateJoinerById:{partId:t,update:n}}),r.joinerDAO.update(t,n)})()}}return e.VERBOSE=!1,e.USER_ALREADY_IN_GAME=()=>$localize`You cannot join this game because you are already in another one.`,e.GAME_DOES_NOT_EXIST=()=>$localize`Game does not exist`,e.\u0275fac=function(t){return new(t||e)(Or(WK))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),jK=(()=>{class e{constructor(t,n,r){this.partDAO=t,this.joinerService=n,this.chatService=r,this.followedPartId=Mw.empty(),Tw(e.VERBOSE,"GameService.constructor")}getPartValidity(e,t){var n=this;return Pw(function*(){const r=yield n.partDAO.read(e);return r.isAbsent()?TW.failure("NONEXISTENT_PART"):r.get().typeGame===t?TW.SUCCESS:TW.failure("WRONG_GAME_TYPE")})()}createUnstartedPart(t,n){return Tw(e.VERBOSE,"GameService.createPart("+t.name+", "+n+")"),this.partDAO.create({lastUpdate:{index:0,player:0},typeGame:n,playerZero:t.name,turn:-1,result:RW.UNACHIEVED.value,listMoves:[]})}createChat(t){return Tw(e.VERBOSE,"GameService.createChat("+t+")"),this.chatService.createNewChat(t)}createPartJoinerAndChat(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,`GameService.createGame(${t.id}, ${n})`);const i=yield r.createUnstartedPart(t,n);return yield r.joinerService.createInitialJoiner(t,i),yield r.createChat(i),i})()}startGameWithConfig(t,n,r,i){Tw(e.VERBOSE,"GameService.startGameWithConfig("+t+", "+JSON.stringify(i));const s=this.getStartingConfig(i);return this.partDAO.updateAndBumpIndex(t,n,r,s)}getStartingConfig(e){let t,n,r=NK.of(e.firstPlayer);return r===NK.RANDOM&&(r=Math.random()<.5?NK.CREATOR:NK.CHOSEN_PLAYER),r===NK.CREATOR?(t=e.creator.name,n=Ow.getNonNullable(e.chosenOpponent).name):(t=Ow.getNonNullable(e.chosenOpponent).name,n=e.creator.name),{playerZero:t,playerOne:n,turn:0,beginning:tW(),remainingMsForZero:1e3*e.totalPartDuration,remainingMsForOne:1e3*e.totalPartDuration}}deletePart(t){var n=this;return Pw(function*(){return Tw(e.VERBOSE,"GameService.deletePart("+t+")"),n.partDAO.delete(t)})()}acceptConfig(t,n){var r=this;return Pw(function*(){return Tw(e.VERBOSE,{gameService_acceptConfig:{partId:t,joiner:n}}),yield r.joinerService.acceptConfig(),r.startGameWithConfig(t,BK.ONE,0,n)})()}startObserving(t,n){if(!this.followedPartId.isAbsent())throw new Error("GameService.startObserving should not be called while already observing a game");Tw(e.VERBOSE,"[start watching part "+t),this.followedPartId=Mw.of(t),this.followedPartUnsubscribe=this.partDAO.subscribeToChanges(t,n)}resign(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,n,t,{winner:r,loser:i,result:RW.RESIGN.value,request:null})}notifyTimeout(e,t,n,r,i){return this.partDAO.updateAndBumpIndex(e,t,n,{winner:r,loser:i,result:RW.TIMEOUT.value,request:null})}sendRequest(e,t,n,r){return this.partDAO.updateAndBumpIndex(e,t,n,{request:r})}proposeDraw(e,t,n){return this.sendRequest(e,n,t,$K.drawProposed(n))}acceptDraw(e,t,n){return this.partDAO.updateAndBumpIndex(e,n,t,{result:(n===BK.ZERO?RW.AGREED_DRAW_BY_ZERO:RW.AGREED_DRAW_BY_ONE).value,request:null})}refuseDraw(e,t,n){return this.sendRequest(e,n,t,$K.drawRefused(n))}proposeRematch(e,t,n){return this.sendRequest(e,n,t,$K.rematchProposed(n))}acceptRematch(t,n,r){var i=this;return Pw(function*(){Tw(e.VERBOSE,{called:"GameService.acceptRematch(",partDocument:t});const s=Ow.getNonNullable(t.data),o=yield i.joinerService.readJoinerById(t.id);let a;a=s.playerZero===o.creator.name?NK.CHOSEN_PLAYER:NK.CREATOR;const l={...o,candidates:[],firstPlayer:a.value,partStatus:xK.PART_STARTED.value},c=yield i.joinerService.createJoiner(l),u=i.getStartingConfig(l),h={lastUpdate:{index:0,player:r.value},typeGame:s.typeGame,result:RW.UNACHIEVED.value,listMoves:[],...u};return yield i.partDAO.set(c,h),yield i.createChat(c),i.sendRequest(t.id,r,n,$K.rematchAccepted(s.typeGame,c))})()}askTakeBack(e,t,n){return this.sendRequest(e,n,t,$K.takeBackAsked(n))}acceptTakeBack(e,t,n,r){var i=this;return Pw(function*(){NW($K.getPlayer(Ow.getNonNullable(t.data.request))!==n,"Illegal to accept your own request");const s=$K.takeBackAccepted(n);let o=t.data.listMoves.slice(0,t.data.listMoves.length-1);o.length%2===n.value&&(o=o.slice(0,o.length-1));const a={request:s,listMoves:o,turn:o.length,lastUpdateTime:tW(),remainingMsForZero:Ow.getNonNullable(t.data.remainingMsForZero)-r[0],remainingMsForOne:Ow.getNonNullable(t.data.remainingMsForOne)-r[1]},l=t.data.lastUpdate.index;return yield i.partDAO.updateAndBumpIndex(e,n,l,a)})()}refuseTakeBack(e,t,n){const r=$K.takeBackRefused(n);return this.partDAO.updateAndBumpIndex(e,n,t,{request:r})}addGlobalTime(e,t,n,r){var i=this;return Pw(function*(){let s={request:$K.addGlobalTime(r.getOpponent())};return s=r===BK.ZERO?{...s,remainingMsForOne:Ow.getNonNullable(n.remainingMsForOne)+3e5}:{...s,remainingMsForZero:Ow.getNonNullable(n.remainingMsForZero)+3e5},yield i.partDAO.updateAndBumpIndex(e,r,t,s)})()}addTurnTime(e,t,n){var r=this;return Pw(function*(){const i={request:$K.addTurnTime(e.getOpponent())};return yield r.partDAO.updateAndBumpIndex(n,e,t,i)})()}stopObserving(){Tw(e.VERBOSE,"GameService.stopObserving();"),this.followedPartId=Mw.empty(),this.followedPartUnsubscribe()}updateDBBoard(t,n,r,i,s,o,a,l){var c=this;return Pw(function*(){Tw(e.VERBOSE,{gameService_updateDBBoard:{partId:t,encodedMove:r,scores:s,msToSubstract:i,notifyDraw:o,winner:a,loser:l}});const u=(yield c.partDAO.read(t)).get(),h=u.lastUpdate.index,d=u.turn+1,p=GK.copyImmutableArray(u.listMoves);p[p.length]=r;let f={listMoves:p,turn:d,request:null,lastUpdateTime:tW()};return f=c.updateScore(f,s),f=c.substractMs(f,u,i),null!=a?f={...f,winner:a,loser:l,result:RW.VICTORY.value}:!0===o&&(f={...f,result:RW.HARD_DRAW.value}),yield c.partDAO.updateAndBumpIndex(t,n,h,f)})()}updateScore(e,t){return void 0!==t?{...e,scorePlayerZero:t[0],scorePlayerOne:t[1]}:e}substractMs(e,t,n){return n[0]>0?{...e,remainingMsForZero:Ow.getNonNullable(t.remainingMsForZero)-n[0]}:n[1]>0?{...e,remainingMsForOne:Ow.getNonNullable(t.remainingMsForOne)-n[1]}:e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(Or(DW),Or(qK),Or(UW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ZK={prefix:"fab",iconName:"facebook",icon:[512,512,[],"f09a","M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"]},YK={prefix:"fab",iconName:"github",icon:[496,512,[],"f09b","M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"]},KK={prefix:"fab",iconName:"twitter",icon:[512,512,[],"f099","M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"]};class QK{static getNavigatorLanguage(){return navigator.language}static getLocale(){const e=(localStorage.getItem("locale")??QK.getNavigatorLanguage()??"fr").slice(0,2).toLowerCase();return["en","fr"].some(t=>t===e)?e:"fr"}}let XK=(()=>{class e{changeTheme(e){localStorage.setItem("theme",e)}getTheme(){return Mw.ofNullable(localStorage.getItem("theme"))}changeLanguage(e){localStorage.setItem("locale",e.toLowerCase())}getLanguage(){return QK.getLocale()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),JK=(()=>{class e{constructor(e,t){this.document=e,this.userSettingsService=t,this.availableThemes=["dark","light"];const n=this.getStoredTheme();n.isPresent()?this.loadTheme(n.get()):window.matchMedia("(prefers-color-scheme: dark)").matches?this.loadTheme("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?this.loadTheme("light"):this.loadTheme("dark")}getStoredTheme(){const e=this.userSettingsService.getTheme();if(e.isPresent()){const t=e.get();if(this.availableThemes.some(e=>e===t))return Mw.of(t)}return Mw.empty()}loadTheme(e){this.loadStyle(e+".css"),this.theme=e}loadStyle(e){const t=this.document.getElementsByTagName("head")[0],n=this.document.getElementById("theme");if(null!=n)n.href=e;else{const n=this.document.createElement("link");n.id="theme",n.rel="stylesheet",n.href=`${e}`,t.appendChild(n)}}getTheme(){return this.theme}}return e.\u0275fac=function(t){return new(t||e)(Or(Kh),Or(XK))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var eQ={prefix:"fas",iconName:"book-open",icon:[576,512,[],"f518","M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"]},tQ={prefix:"fas",iconName:"cog",icon:[512,512,[],"f013","M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"]},nQ={prefix:"fas",iconName:"desktop",icon:[576,512,[],"f108","M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"]},rQ={prefix:"fas",iconName:"eye",icon:[576,512,[],"f06e","M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"]},iQ={prefix:"fas",iconName:"network-wired",icon:[640,512,[],"f6ff","M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"]},sQ={prefix:"fas",iconName:"reply",icon:[512,512,[],"f3e5","M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"]},oQ={prefix:"fas",iconName:"spinner",icon:[512,512,[],"f110","M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"]};function aQ(e){return(aQ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lQ(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cQ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){cQ(e,t,n[t])})}return e}function hQ(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,s=l}finally{try{!r&&null!=a.return&&a.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var dQ={},pQ={};try{"undefined"!=typeof window&&(dQ=window),"undefined"!=typeof document&&(pQ=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch{}var fQ=(dQ.navigator||{}).userAgent,gQ=void 0===fQ?"":fQ,mQ=dQ,yQ=pQ,vQ=!!yQ.documentElement&&!!yQ.head&&"function"==typeof yQ.addEventListener&&"function"==typeof yQ.createElement,_Q=(~gQ.indexOf("MSIE")||gQ.indexOf("Trident/"),"___FONT_AWESOME___"),CQ="svg-inline--fa",EQ=[1,2,3,4,5,6,7,8,9,10],wQ=EQ.concat([11,12,13,14,15,16,17,18,19,20]),bQ={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},SQ=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",bQ.GROUP,bQ.SWAP_OPACITY,bQ.PRIMARY,bQ.SECONDARY].concat(EQ.map(function(e){return"".concat(e,"x")})).concat(wQ.map(function(e){return"w-".concat(e)})),mQ.FontAwesomeConfig||{});yQ&&"function"==typeof yQ.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=hQ(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=yQ.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(SQ[n]=r)});var PQ=uQ({},{familyPrefix:"fa",replacementClass:CQ,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},SQ);PQ.autoReplaceSvg||(PQ.observeMutations=!1);var OQ=uQ({},PQ);mQ.FontAwesomeConfig=OQ;var TQ=mQ||{};TQ[_Q]||(TQ[_Q]={}),TQ[_Q].styles||(TQ[_Q].styles={}),TQ[_Q].hooks||(TQ[_Q].hooks={}),TQ[_Q].shims||(TQ[_Q].shims=[]);var IQ=TQ[_Q],kQ=[];vQ&&((yQ.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(yQ.readyState)||yQ.addEventListener("DOMContentLoaded",function e(){yQ.removeEventListener("DOMContentLoaded",e),kQ.map(function(e){return e()})}));var AQ,MQ="pending",NQ="fulfilled",RQ="rejected",xQ=function(){},DQ="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,LQ="undefined"==typeof setImmediate?setTimeout:setImmediate,FQ=[];function UQ(){for(var e=0;e<FQ.length;e++)FQ[e][0](FQ[e][1]);FQ=[],AQ=!1}function BQ(e,t){FQ.push([e,t]),AQ||(AQ=!0,LQ(UQ,0))}function VQ(e){var t=e.owner,n=t._state,r=t._data,i=e[n],s=e.then;if("function"==typeof i){n=NQ;try{r=i(r)}catch(o){GQ(s,o)}}$Q(s,r)||(n===NQ&&zQ(s,r),n===RQ&&GQ(s,r))}function $Q(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===aQ(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?HQ(e,r):zQ(e,r))},function(t){n||(n=!0,GQ(e,t))}),!0}}catch(i){return n||GQ(e,i),!0}return!1}function zQ(e,t){(e===t||!$Q(e,t))&&HQ(e,t)}function HQ(e,t){e._state===MQ&&(e._state="settled",e._data=t,BQ(qQ,e))}function GQ(e,t){e._state===MQ&&(e._state="settled",e._data=t,BQ(jQ,e))}function WQ(e){e._then=e._then.forEach(VQ)}function qQ(e){e._state=NQ,WQ(e)}function jQ(e){e._state=RQ,WQ(e),!e._handled&&DQ&&global.process.emit("unhandledRejection",e._data,e)}function ZQ(e){global.process.emit("rejectionHandled",e)}function YQ(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(!(this instanceof YQ))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){GQ(t,e)}try{e(function(e){zQ(t,e)},n)}catch(r){n(r)}}(e,this)}YQ.prototype={constructor:YQ,_state:MQ,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(xQ),fulfilled:e,rejected:t};return(t||e)&&!this._handled&&(this._handled=!0,this._state===RQ&&DQ&&BQ(ZQ,this)),this._state===NQ||this._state===RQ?BQ(VQ,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},YQ.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new YQ(function(t,n){var r=[],i=0;function s(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,a=0;a<e.length;a++)(o=e[a])&&"function"==typeof o.then?o.then(s(a),n):r[a]=o;i||t(r)})},YQ.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new YQ(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},YQ.resolve=function(e){return e&&"object"===aQ(e)&&e.constructor===YQ?e:new YQ(function(t){t(e)})},YQ.reject=function(e){return new YQ(function(t,n){n(e)})};var KQ={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function QQ(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function XQ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function JQ(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function eX(e){return e.size!==KQ.size||e.x!==KQ.x||e.y!==KQ.y||e.rotate!==KQ.rotate||e.flipX||e.flipY}function tX(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),s="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),o="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(s," ").concat(o)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var nX={x:0,y:0,width:"100%",height:"100%"};function rX(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function iX(e){return"g"===e.tag?e.children:[e]}function sX(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,s=e.iconName,o=e.transform,a=e.symbol,l=e.title,c=e.maskId,u=e.titleId,h=e.extra,d=e.watchable,p=void 0!==d&&d,f=r.found?r:n,g=f.width,m=f.height,y="fak"===i,v=y?"":"fa-w-".concat(Math.ceil(g/m*16)),_=[OQ.replacementClass,s?"".concat(OQ.familyPrefix,"-").concat(s):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),C={children:[],attributes:uQ({},h.attributes,{"data-prefix":i,"data-icon":s,class:_,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(g," ").concat(m)})},E=y&&!~h.classes.indexOf("fa-fw")?{width:"".concat(g/m*16*.0625,"em")}:{};p&&(C.attributes["data-fa-i2svg"]=""),l&&C.children.push({tag:"title",attributes:{id:C.attributes["aria-labelledby"]||"title-".concat(u||QQ())},children:[l]});var w=uQ({},C,{prefix:i,iconName:s,main:n,mask:r,maskId:c,transform:o,symbol:a,styles:uQ({},E,h.styles)}),b=r.found&&n.found?function(e){var t=e.children,n=e.attributes,r=e.main,i=e.mask,s=e.maskId,o=r.icon,a=i.icon,l=tX({transform:e.transform,containerWidth:i.width,iconWidth:r.width}),c={tag:"rect",attributes:uQ({},nX,{fill:"white"})},u=o.children?{children:o.children.map(rX)}:{},h={tag:"g",attributes:uQ({},l.inner),children:[rX(uQ({tag:o.tag,attributes:uQ({},o.attributes,l.path)},u))]},d={tag:"g",attributes:uQ({},l.outer),children:[h]},p="mask-".concat(s||QQ()),f="clip-".concat(s||QQ()),g={tag:"mask",attributes:uQ({},nX,{id:p,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[c,d]},m={tag:"defs",children:[{tag:"clipPath",attributes:{id:f},children:iX(a)},g]};return t.push(m,{tag:"rect",attributes:uQ({fill:"currentColor","clip-path":"url(#".concat(f,")"),mask:"url(#".concat(p,")")},nX)}),{children:t,attributes:n}}(w):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,s=JQ(e.styles);if(s.length>0&&(n.style=s),eX(i)){var o=tX({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:uQ({},o.outer),children:[{tag:"g",attributes:uQ({},o.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:uQ({},r.icon.attributes,o.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(w),S=b.attributes;return w.children=b.children,w.attributes=S,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:uQ({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat(OQ.familyPrefix,"-").concat(t):r}),children:n}]}]}(w):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,s=e.styles,o=e.transform;if(eX(o)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=JQ(uQ({},s,{"transform-origin":"".concat(a.x+o.x/16,"em ").concat(a.y+o.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(w)}var oX=function(e,t,n,r){var i,s,o,a=Object.keys(e),l=a.length,c=void 0!==r?function(e,t){return function(n,r,i,s){return e.call(t,n,r,i,s)}}(t,r):t;for(void 0===n?(i=1,o=e[a[0]]):(i=0,o=n);i<l;i++)o=c(o,e[s=a[i]],s,e);return o};function aX(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,s=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof IQ.hooks.addPack||i?IQ.styles[e]=uQ({},IQ.styles[e]||{},s):IQ.hooks.addPack(e,s),"fas"===e&&aX("fa",t)}var lX=IQ.styles,cX=IQ.shims,uX=function(){var e=function(e){return oX(lX,function(t,n,r){return t[r]=oX(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in lX;oX(cX,function(e,n){var r=n[1];return"far"===r&&!t&&(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function hX(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function dX(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,s=void 0===i?[]:i;return"string"==typeof e?XQ(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(XQ(e[n]),'" ')},"").trim()}(r),">").concat(s.map(dX).join(""),"</").concat(t,">")}uX();function pX(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}(pX.prototype=Object.create(Error.prototype)).constructor=pX;var fX={fill:"currentColor"},gX={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},mX=(uQ({},fX,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),uQ({},gX,{attributeName:"opacity"}));function yX(e){var t=e[0],n=e[1],r=hQ(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(OQ.familyPrefix,"-").concat(bQ.GROUP)},children:[{tag:"path",attributes:{class:"".concat(OQ.familyPrefix,"-").concat(bQ.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(OQ.familyPrefix,"-").concat(bQ.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function vX(){OQ.autoAddCss&&!wX&&(function(e){if(e&&vQ){var t=yQ.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=yQ.head.childNodes,r=null,i=n.length-1;i>-1;i--){var s=n[i],o=(s.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(o)>-1&&(r=s)}yQ.head.insertBefore(t,r)}}(function(){var e="fa",t=CQ,n=OQ.familyPrefix,r=OQ.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var s=new RegExp("\\.".concat(e,"\\-"),"g"),o=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(s,".".concat(n,"-")).replace(o,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),wX=!0)}function _X(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return dX(e)})}}),Object.defineProperty(e,"node",{get:function(){if(vQ){var t=yQ.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function CX(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return hX(EX.definitions,n,r)||hX(IQ.styles,n,r)}uQ({},fX,{cx:"256",cy:"364",r:"28"}),uQ({},gX,{attributeName:"r",values:"28;14;28;28;14;28;"}),uQ({},mX,{values:"1;0;1;1;0;1;"}),uQ({},fX,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),uQ({},mX,{values:"1;0;0;0;0;1;"}),uQ({},fX,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),uQ({},mX,{values:"0;0;1;1;0;0;"});var EX=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.definitions={}}return function(e,t,n){t&&lQ(e.prototype,t)}(e,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=uQ({},e.definitions[t]||{},i[t]),aX(t,i[t]),uX()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,s=r.iconName,o=r.icon;e[i]||(e[i]={}),e[i][s]=o}),e}}]),e}()),wX=!1,bX=function(e){return function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(e)},SX=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(t||{}).icon?t:CX(t||{}),i=n.mask;return i&&(i=(i||{}).icon?i:CX(i||{})),e(r,uQ({},n,{mask:i}))}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?KQ:n,i=t.symbol,s=void 0!==i&&i,o=t.mask,a=void 0===o?null:o,l=t.maskId,c=void 0===l?null:l,u=t.title,h=void 0===u?null:u,d=t.titleId,p=void 0===d?null:d,f=t.classes,g=void 0===f?[]:f,m=t.attributes,y=void 0===m?{}:m,v=t.styles,_=void 0===v?{}:v;if(e){var C=e.prefix,E=e.iconName,w=e.icon;return _X(uQ({type:"icon"},e),function(){return vX(),OQ.autoA11y&&(h?y["aria-labelledby"]="".concat(OQ.replacementClass,"-title-").concat(p||QQ()):(y["aria-hidden"]="true",y.focusable="false")),sX({icons:{main:yX(w),mask:a?yX(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:C,iconName:E,transform:uQ({},KQ,r),symbol:s,title:h,maskId:c,titleId:p,extra:{attributes:y,styles:_,classes:g}})})}});const PX=["*"],OX=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let TX=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),IX=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e){t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t;for(const e of t.icon[2])"string"==typeof e&&(this.definitions[t.prefix][e]=t)}}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),kX=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=st({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[vt]}),e})(),AX=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(ua(Oc),ua(bc))},e.\u0275cmp=Je({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[vt],ngContentSelectors:PX,decls:1,vars:0,template:function(e,t){1&e&&(function(e){const t=zt()[16][6];if(!t.projection){const n=t.projection=pr(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?Pa(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}(),function(e,t=0,n){const r=zt(),i=Ht(),s=Fs(i,20+e,16,null,n||null);null===s.projection&&(s.projection=t),Kt(),64!=(64&s.flags)&&function(e,t,n){hs(t[11],0,t,n,ji(e,n,t),Ji(n.parent||t[6],n,t))}(i,r,s)}(0))},encapsulation:2}),e})(),MX=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=this.icon??this.config.fallbackIcon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=((e,t)=>(e=>void 0!==e.prefix&&void 0!==e.iconName)(e)?e:Array.isArray(e)&&2===e.length?{prefix:e[0],iconName:e[1]}:"string"==typeof e?{prefix:t,iconName:e}:void 0)(e,this.config.defaultPrefix);return"icon"in t?t:this.iconLibrary.getIconDefinition(t.prefix,t.iconName)??((e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null)}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?bX(this.transform):this.transform;return{title:this.title,transform:t,classes:[...OX(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=SX(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(ua(Bp),ua(TX),ua(IX),ua(kX,8),ua(AX,8))},e.\u0275cmp=Je({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(nl("innerHTML",t.renderedIconHTML,vi),ra("title",t.title))},inputs:{icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[vt],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),NX=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e}),e.\u0275inj=Se({}),e})();function RX(e,t){if(1&e&&(ma(0),ga(1,"fa-icon",24),ya()),2&e){const e=Sa();Ts(1),ha("icon",e.faSpinner)}}function xX(e,t){if(1&e){const e=va();ma(0),pa(1,"div",9),pa(2,"a",10),Qa(3),fa(),pa(4,"div",12),pa(5,"a",26),Ea("click",function(){return Gt(e),Sa(2).logout()}),sc(6,27),fa(),fa(),fa(),ya()}if(2&e){const e=Sa(2);Ts(3),Xa(e.username.get())}}const DX=function(){return["/register"]},LX=function(){return["/login"]};function FX(e,t){1&e&&(pa(0,"div",28),pa(1,"a",29),pa(2,"strong"),sc(3,30),fa(),fa(),pa(4,"a",31),sc(5,32),fa(),fa()),2&e&&(Ts(1),ha("routerLink",wu(2,DX)),Ts(3),ha("routerLink",wu(3,LX)))}function UX(e,t){if(1&e&&(la(0,xX,7,1,"ng-container",22),la(1,FX,6,4,"ng-template",null,25,Ku)),2&e){const e=ca(2);ha("ngIf",Sa().username.isPresent())("ngIfElse",e)}}const BX=function(){return["/"]},VX=function(){return["/play"]},$X=function(){return["/lobby"]},zX=function(){return["/local"]},HX=function(){return["/tutorial"]},GX=function(){return["/settings"]};let WX=(()=>{class e{constructor(e,t,n){this.router=e,this.connectedUserService=t,this.userService=n,this.loading=!0,this.username=Mw.empty(),this.faCog=tQ,this.faSpinner=oQ,this.showMenu=!1}ngOnInit(){this.userSub=this.connectedUserService.getUserObs().subscribe(e=>{this.loading=!1,this.username=e.username.isPresent()?e.username:e.email})}logout(){var e=this;return Pw(function*(){yield e.connectedUserService.disconnect(),yield e.router.navigate(["/"])})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(MK),ua(zW))},e.\u0275cmp=Je({type:e,selectors:[["app-header"]],decls:35,vars:19,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Home`,t=$localize`Play online`,n=$localize`Create a game`,r=$localize`Join a game`,i=$localize`Play offline`,s=$localize`Create a game`,o=$localize`Learn the rules`,a=$localize`Settings`,l=$localize`Log out`,c=$localize`Register`,u=$localize`Log in`,[["role","navigation","aria-label","main navigation",1,"navbar","is-primary"],[1,"navbar-brand"],[1,"navbar-item",3,"routerLink"],["src","assets/images/logo.png","width","28","height","28"],["role","button","aria-label","menu","aria-expanded","false","data-target","menu",1,"navbar-burger",3,"ngClass","click"],["aria-hidden","true"],["id","menu",1,"navbar-menu",3,"ngClass","click"],[1,"navbar-start"],e,[1,"navbar-item","has-dropdown","is-hoverable"],[1,"navbar-link"],t,[1,"navbar-dropdown"],n,r,i,s,o,[1,"navbar-end"],["data-tooltip",a,1,"navbar-item",3,"routerLink"],[3,"icon"],[1,"navbar-item"],[4,"ngIf","ngIfElse"],["showUsernameOrLogin",""],[1,"navbar-item","fa-spin",3,"icon"],["connect",""],["id","logout",1,"navbar-item",3,"click"],l,[1,"buttons"],[1,"button","is-primary",3,"routerLink"],c,[1,"button","is-light",3,"routerLink"],u]},template:function(e,t){if(1&e&&(pa(0,"nav",0),pa(1,"div",1),pa(2,"a",2),ga(3,"img",3),fa(),pa(4,"a",4),Ea("click",function(){return t.showMenu=!t.showMenu}),ga(5,"span",5),ga(6,"span",5),ga(7,"span",5),fa(),fa(),pa(8,"div",6),Ea("click",function(){return t.showMenu=!t.showMenu}),pa(9,"div",7),pa(10,"a",2),sc(11,8),fa(),pa(12,"div",9),pa(13,"a",10),sc(14,11),fa(),pa(15,"div",12),pa(16,"a",2),sc(17,13),fa(),pa(18,"a",2),sc(19,14),fa(),fa(),fa(),pa(20,"div",9),pa(21,"a",10),sc(22,15),fa(),pa(23,"div",12),pa(24,"a",2),sc(25,16),fa(),pa(26,"a",2),sc(27,17),fa(),fa(),fa(),fa(),pa(28,"div",18),pa(29,"a",19),ga(30,"fa-icon",20),fa(),pa(31,"div",21),la(32,RX,2,1,"ng-container",22),la(33,UX,3,2,"ng-template",null,23,Ku),fa(),fa(),fa(),fa()),2&e){const e=ca(34);Ts(2),ha("routerLink",wu(12,BX)),Ts(2),ha("ngClass",t.showMenu?"is-active":""),Ts(4),ha("ngClass",t.showMenu?"is-active":""),Ts(2),ha("routerLink",wu(13,BX)),Ts(6),ha("routerLink",wu(14,VX)),Ts(2),ha("routerLink",wu(15,$X)),Ts(6),ha("routerLink",wu(16,zX)),Ts(2),ha("routerLink",wu(17,HX)),Ts(3),ha("routerLink",wu(18,GX)),Ts(1),ha("icon",t.faCog),Ts(2),ha("ngIf",t.loading)("ngIfElse",e)}},directives:[y_,Jd,MX,rp],encapsulation:2}),e})(),qX=(()=>{class e{constructor(e,t){this._themeService=e,this._errorLoggerService=t,this.faTwitter=KK,this.faFacebook=ZK,this.faGithub=YK}}return e.\u0275fac=function(t){return new(t||e)(ua(JK),ua(MW))},e.\u0275cmp=Je({type:e,selectors:[["app-root"]],decls:18,vars:3,consts:function(){let e;return e=$localize`If you like ${"\ufffd#8\ufffd"}:START_TAG_STRONG:EveryBoard${"\ufffd/#8\ufffd"}:CLOSE_TAG_STRONG:, follow us!`,[[1,"container","mt-2"],[1,"footer"],[1,"content","has-text-centered"],e,["href","https://github.com/EveryBoard/EveryBoard"],[3,"icon"],["href","https://twitter.com/EveryBoard"],["href","https://facebook.com/EveryBoard"]]},template:function(e,t){1&e&&(ga(0,"app-header"),pa(1,"main",0),ga(2,"router-outlet"),fa(),pa(3,"footer",1),pa(4,"div",2),pa(5,"p"),pa(6,"span"),rc(7,3),ga(8,"strong"),ic(),fa(),Qa(9," \xa0 "),pa(10,"a",4),ga(11,"fa-icon",5),fa(),Qa(12,"\xa0 "),pa(13,"a",6),ga(14,"fa-icon",5),fa(),Qa(15,"\xa0 "),pa(16,"a",7),ga(17,"fa-icon",5),fa(),fa(),fa(),fa()),2&e&&(Ts(11),ha("icon",t.faGithub),Ts(3),ha("icon",t.faTwitter),Ts(3),ha("icon",t.faFacebook))},directives:[WX,__,MX],encapsulation:2}),e})();class jX{constructor(e,t){this.x=e,this.y=t}equals(e){return this.x===e.x&&this.y===e.y}}class ZX extends jX{isDown(){return 1===this.y}isUp(){return-1===this.y}isLeft(){return-1===this.x}isRight(){return 1===this.x}toInt(){return 0===this.x&&-1===this.y?0:1===this.x&&0===this.y?1:0===this.x&&1===this.y?2:-1===this.x&&0===this.y?3:-1===this.x&&-1===this.y?4:1===this.x&&-1===this.y?5:-1===this.x&&1===this.y?6:7}toString(){return 0===this.x&&-1===this.y?"UP":1===this.x&&0===this.y?"RIGHT":0===this.x&&1===this.y?"DOWN":-1===this.x&&0===this.y?"LEFT":-1===this.x&&-1===this.y?"UP_LEFT":1===this.x&&-1===this.y?"UP_RIGHT":-1===this.x&&1===this.y?"DOWN_LEFT":"DOWN_RIGHT"}}class YX{of(e,t){for(const n of this.all)if(n.x===e&&n.y===t)return SW.success(n);return SW.failure("Invalid x and y in direction construction")}fromDelta(e,t){return 0===e&&0===t?SW.failure("Empty delta for direction"):Math.abs(e)===Math.abs(t)||0===e||0===t?this.of(Math.sign(e),Math.sign(t)):SW.failure(XX.DIRECTION_MUST_BE_LINEAR())}fromMove(e,t){return this.fromDelta(t.x-e.x,t.y-e.y)}fromString(e){switch(e){case"UP":return this.of(0,-1);case"RIGHT":return this.of(1,0);case"DOWN":return this.of(0,1);case"LEFT":return this.of(-1,0);case"UP_LEFT":return this.of(-1,-1);case"UP_RIGHT":return this.of(1,-1);case"DOWN_LEFT":return this.of(-1,1);case"DOWN_RIGHT":return this.of(1,1);default:return SW.failure(`Invalid direction string ${e}`)}}fromInt(e){switch(e){case 0:return this.of(0,-1);case 1:return this.of(1,0);case 2:return this.of(0,1);case 3:return this.of(-1,0);case 4:return this.of(-1,-1);case 5:return this.of(1,-1);case 6:return this.of(-1,1);case 7:return this.of(1,1);default:return SW.failure(`Invalid int direction: ${e}`)}}}class KX extends ZX{constructor(e,t){super(e,t)}isDiagonal(){return 0!==this.x&&0!==this.y}getOpposite(){return KX.factory.of(-this.x,-this.y).get()}}KX.UP=new KX(0,-1),KX.UP_RIGHT=new KX(1,-1),KX.RIGHT=new KX(1,0),KX.DOWN_RIGHT=new KX(1,1),KX.DOWN=new KX(0,1),KX.DOWN_LEFT=new KX(-1,1),KX.LEFT=new KX(-1,0),KX.UP_LEFT=new KX(-1,-1),KX.factory=new class extends YX{constructor(){super(...arguments),this.all=[KX.UP,KX.UP_RIGHT,KX.RIGHT,KX.DOWN_RIGHT,KX.DOWN,KX.DOWN_LEFT,KX.LEFT,KX.UP_LEFT]}},KX.DIRECTIONS=KX.factory.all,KX.DIAGONALS=[KX.UP_RIGHT,KX.DOWN_RIGHT,KX.DOWN_LEFT,KX.UP_LEFT],KX.ORTHOGONALS=[KX.UP,KX.RIGHT,KX.DOWN,KX.LEFT],KX.encoder=new class extends DK{encode(e){return e.toString()}decode(e){return NW("string"==typeof e,"Invalid encoded direction"),KX.factory.fromString(e).get()}};class QX extends ZX{constructor(e,t){super(e,t)}getOpposite(){return QX.factory.of(-this.x,-this.y).get()}}QX.UP=new QX(0,-1),QX.RIGHT=new QX(1,0),QX.DOWN=new QX(0,1),QX.LEFT=new QX(-1,0),QX.factory=new class extends YX{constructor(){super(...arguments),this.all=[QX.UP,QX.RIGHT,QX.DOWN,QX.LEFT]}of(e,t){return 0===e&&-1===t?SW.success(QX.UP):1===e&&0===t?SW.success(QX.RIGHT):0===e&&1===t?SW.success(QX.DOWN):-1===e&&0===t?SW.success(QX.LEFT):SW.failure("Invalid orthogonal from x and y")}},QX.ORTHOGONALS=QX.factory.all,QX.encoder=new class extends DK{encode(e){return e.toString()}decode(e){return NW("string"==typeof e,"Invalid encoded orthogonal"),QX.factory.fromString(e).get()}};let XX=(()=>{class e{}return e.DIRECTION_MUST_BE_LINEAR=()=>$localize`You must move in a straight line! You can only move orthogonally or diagonally!`,e})();class JX{constructor(e,t){this.x=e,this.y=t}static numberEncoder(e,t){return FK.tuple([FK.numberEncoder(e),FK.numberEncoder(t)],e=>[e.x,e.y],e=>new JX(e[0],e[1]))}getNext(e,t){return new JX(this.x+(t=t??1)*e.x,this.y+t*e.y)}getPrevious(e,t){return this.getNext(e,-(t=t??1))}getLeft(e){return new JX(this.x+e.y,this.y+-e.x)}getRight(e){return new JX(this.x+-e.y,this.y+e.x)}getOpposite(){return new JX(-this.x,-this.y)}isInRange(e,t){return!(this.x<0||this.y<0||this.x>=e||this.y>=t)}isNotInRange(e,t){return this.x<0||this.y<0||this.x>=e||this.y>=t}getDirectionToward(e){return KX.factory.fromMove(this,e)}getOrthogonalDistance(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}getDistance(e){if(!e.isAlignedWith(this))throw new Error("Cannot calculate distance with non aligned coords.");const t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.max(t,n)}isHexagonallyAlignedWith(e){const t=this.x-e.x,n=this.y-e.y;return t!==n&&(t===-n||t*n==0)}isAlignedWith(e){const t=Math.abs(this.x-e.x),n=Math.abs(this.y-e.y);return t===n||t*n==0}getVectorToward(e){return new JX(e.x-this.x,e.y-this.y)}getMinimalVectorToward(e){return this.getVectorToward(e).toVector()}getCoordsToward(e){if(e.equals(this))return[];if(!e.isAlignedWith(this))return[];const t=this.getDirectionToward(e).get();let n=this.getNext(t,1);const r=[];for(;!1===n.equals(e);)r.push(n),n=n.getNext(t,1);return r}toVector(){const e=Math.abs(this.x),t=Math.abs(this.y),n=Math.max(e,t);let r=this.x,i=this.y,s=2;for(;s<=n;)r%s==0&&i%s==0?(r/=s,i/=s):s++;return new JX(r,i)}isBetween(e,t){const n=e.getMinimalVectorToward(this),r=t.getMinimalVectorToward(this);return n.equals(r.getOpposite())}getUntil(e){const t=[],n=this.getDirectionToward(e).get();let r=this.getNext(n);for(;!1===r.equals(e);)t.push(r),r=r.getNext(n);return t}equals(e){return this===e||e.x===this.x&&e.y===this.y}compareTo(e){return e.y===this.y?e.x===this.x?0:this.x<e.x?-1:1:this.y<e.y?-1:1}toString(){return"("+this.x+", "+this.y+")"}}JX.encoder=new class extends DK{encode(e){return{x:e.x,y:e.y}}decode(e){const t=e;return NW(null!=t.x&&"number"==typeof t.x&&null!=t.y&&"number"==typeof t.y,"Invalid encoded coord"),new JX(t.x,t.y)}};let eJ=(()=>{class e{constructor(e){this.messageDisplayer=e,this.SPACE_SIZE=100,this.STROKE_WIDTH=8,this.SMALL_STROKE_WIDTH=2,this.scores=Mw.empty(),this.imagesLocation="assets/images/"}message(e){this.messageDisplayer.gameMessage(e)}cancelMove(e){return this.cancelMoveAttempt(),this.cancelMoveOnWrapper(e),null==e?TW.SUCCESS:(this.messageDisplayer.gameMessage(e),TW.failure(e))}cancelMoveAttempt(){}getPlayerClass(e){switch(e){case BK.ZERO:return"player0";case BK.ONE:return"player1";default:return Ow.expectToBe(e,VK.NONE),""}}pass(){var e=this;return Pw(function*(){return MW.logError("GameComponent","pass() called on a game that does not redefine it",{gameName:e.constructor.name})})()}getTurn(){return this.rules.node.gameState.turn}getCurrentPlayer(){return this.rules.node.gameState.getCurrentPlayer()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}range(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),tJ=(()=>{class e extends eJ{getHexaCoordsBy(e,t){const n=new JX(e,t);return this.getHexaCoordsAt(n)}getHexaCoordsAt(e){let t="";const n=this.hexaLayout.getHexaCoordsAt(e);for(const r of n)t+=r.x+" "+r.y+" ";return t+=n[0].x+" "+n[0].y,t}getCenterBy(e,t){const n=new JX(e,t);return this.getCenterAt(n)}getCenterAt(e){return this.hexaLayout.getCenterAt(e)}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class nJ{constructor(e){this.value=e}static from(e){switch(e){case nJ.ZERO.value:return nJ.ZERO;case nJ.ONE.value:return nJ.ONE;case nJ.EMPTY.value:return nJ.EMPTY;case nJ.UNREACHABLE.value:return nJ.UNREACHABLE;default:throw new Error("FourStatePiece has no value matching "+e)}}static ofPlayer(e){switch(e){case BK.ZERO:return nJ.ZERO;default:return Ow.expectToBe(e,BK.ONE),nJ.ONE}}equals(e){return this===e}is(e){return this.value===e.value}isPlayer(){return this===nJ.ZERO||this===nJ.ONE}}nJ.ZERO=new nJ(BK.ZERO.value),nJ.ONE=new nJ(BK.ONE.value),nJ.EMPTY=new nJ(VK.NONE.value),nJ.UNREACHABLE=new nJ(3);class rJ extends ZX{constructor(e,t){super(e,t)}static getAngle(e){switch(e){case rJ.UP:return 0;case rJ.UP_RIGHT:return 60;case rJ.RIGHT:return 120;case rJ.DOWN:return 180;case rJ.DOWN_LEFT:return 240;default:return Ow.expectToBe(e,rJ.LEFT),300}}getOpposite(){return rJ.factory.of(-this.x,-this.y).get()}}rJ.UP=new rJ(0,-1),rJ.LEFT=new rJ(-1,0),rJ.UP_RIGHT=new rJ(1,-1),rJ.DOWN_LEFT=new rJ(-1,1),rJ.RIGHT=new rJ(1,0),rJ.DOWN=new rJ(0,1),rJ.factory=new class extends YX{constructor(){super(...arguments),this.all=[rJ.UP,rJ.UP_RIGHT,rJ.RIGHT,rJ.DOWN,rJ.DOWN_LEFT,rJ.LEFT]}},rJ.encoder=new class extends FK{maxValue(){return 5}encodeNumber(e){switch(e){case rJ.UP:return 0;case rJ.UP_RIGHT:return 1;case rJ.RIGHT:return 2;case rJ.DOWN:return 3;case rJ.DOWN_LEFT:return 4;default:return 5}}decodeNumber(e){return NW(0<=e&&e<=5,"Invalid encoded number for HexaDirection "+e),rJ.factory.all[e]}};class iJ{constructor(e,t,n){this.size=e,this.origin=t,this.orientation=n}getCenterAt(e){const t=this.orientation.conversionMatrix;return new JX(this.size*(t[0]*e.x+t[1]*e.y)+this.origin.x,this.size*(t[2]*e.x+t[3]*e.y)+this.origin.y)}getCornerOffset(e){const t=2*Math.PI*(this.orientation.startAngle+e)/6;return new JX(this.size*Math.cos(t),this.size*Math.sin(t))}getHexaCoordsAt(e){const t=this.getCenterAt(e),n=[];for(let r=0;r<6;r+=1){const e=this.getCornerOffset(r);n.push(new JX(t.x+e.x,t.y+e.y))}return n}}class sJ{}class oJ extends sJ{constructor(){super(),this.startAngle=.5,this.conversionMatrix=[Math.sqrt(3),Math.sqrt(3)/2,0,1.5],this.inverseConversionMatrix=[Math.sqrt(3)/3,-1/3,0,2/3]}}oJ.INSTANCE=new oJ;class aJ extends sJ{constructor(){super(),this.startAngle=0,this.conversionMatrix=[1.5,0,Math.sqrt(3)/2,Math.sqrt(3)],this.inverseConversionMatrix=[2/3,0,-1/3,Math.sqrt(3)/3]}isOnBorder(e,t){return this.isOnTopRightBorder(e,t)||this.isOnRightBorder(e,t)||this.isOnBottomRightBorder(e,t)||this.isOnBottomLeftBorder(e,t)||this.isOnLeftBorder(e,t)||this.isOnTopLeftBorder(e,t)}isOnTopRightBorder(e,t){return 0===t.y}isOnRightBorder(e,t){return t.x===e.width-1}isOnLeftBorder(e,t){return 0===t.x}isOnBottomLeftBorder(e,t){return t.y===e.height-1}isOnTopLeftBorder(e,t){return null!=e.excludedCases[t.y]?t.x===e.excludedCases[t.y]:t.y===e.excludedCases.length&&0===t.x}isOnBottomRightBorder(e,t){return null!=e.excludedCases[e.height-1-t.y]?e.width-1-t.x===e.excludedCases[e.height-1-t.y]:e.height-1-t.y===e.excludedCases.length&&t.x===e.width-1}getAllBorders(e){const t=[];return e.forEachCoord((n,r)=>{this.isOnBorder(e,n)&&t.push(n)}),t}isTopCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnTopRightBorder(e,t)}isTopLeftCorner(e,t){return this.isOnTopLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isTopRightCorner(e,t){return this.isOnTopRightBorder(e,t)&&this.isOnRightBorder(e,t)}isBottomCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnBottomRightBorder(e,t)}isBottomLeftCorner(e,t){return this.isOnBottomLeftBorder(e,t)&&this.isOnLeftBorder(e,t)}isBottomRightCorner(e,t){return this.isOnBottomRightBorder(e,t)&&this.isOnRightBorder(e,t)}}aJ.INSTANCE=new aJ;let lJ=(()=>{class e{}return e.CANNOT_CHOOSE_OPPONENT_PIECE=()=>$localize`You cannot pick a piece of the opponent.`,e.MUST_CLICK_ON_EMPTY_SPACE=()=>$localize`You must click on an empty space.`,e.MUST_CLICK_ON_EMPTY_SQUARE=()=>$localize`You must click on an empty square.`,e.CANNOT_SELF_CAPTURE=()=>$localize`Your landing space should be empty or contain a piece of the opponent.`,e.MUST_CHOOSE_PLAYER_PIECE=()=>$localize`You must pick one of your pieces.`,e.CANNOT_PASS=()=>$localize`You cannot pass your turn.`,e.MUST_LAND_ON_EMPTY_SPACE=()=>$localize`You must drop your piece on an empty space.`,e.MUST_PASS=()=>$localize`You must pass your turn.`,e.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY=()=>$localize`You have selected an empty space, you must select one of your own pieces.`,e.MOVE_CANNOT_BE_STATIC=()=>$localize`You must choose different starting and ending coordinates.`,e.SOMETHING_IN_THE_WAY=()=>$localize`There is a piece between the piece you chose and its landing space.`,e})();class cJ{constructor(e,t){this.ruler=e,this.name=t}toString(){return this.name}}class uJ{constructor(e){this.value=e}static fromWinner(e){return e.isPlayer()?new uJ(e.getVictoryValue()):new uJ(0)}toString(){return""+this.value}}class hJ{static toComparableObjectSet(e){const t=[];return e.forEach(e=>{t.some(t=>t.equals(e))||t.push(e)}),t}static toComparableSet(e){const t=[];return e.forEach(e=>{t.some(t=>Aw(t,e))||t.push(e)}),t}}class dJ{constructor(e){this.values=void 0===e?[]:hJ.toComparableSet(e)}equals(e){if(e.size()!==this.size())return!1;for(const t of this)if(!1===e.contains(t))return!1;return!0}toString(){let e="";for(const t of this)e+=null==t?"null, ":t.toString()+", ";return"["+e.slice(0,-2)+"]"}add(e){return!this.contains(e)&&(this.values.push(e),!0)}union(e){for(const t of e)this.add(t)}contains(e){for(const t of this.values)if(Aw(t,e))return!0;return!1}size(){return this.values.length}toList(){const e=[];for(const t of this)e.push(t);return e}getAnyElement(){return this.size()>0?Mw.of(this.values[0]):Mw.empty()}[Symbol.iterator](){return this.values.values()}}class pJ{constructor(e){this.turn=e}getCurrentPlayer(){return BK.fromTurn(this.turn)}getCurrentOpponent(){return this.turn%2==1?BK.ZERO:BK.ONE}}class fJ extends pJ{constructor(e,t){super(t),this.board=e}getPieceAt(e){if(this.isOnBoard(e))return this.board[e.y][e.x];throw new Error("Accessing coord not on board "+e+".")}tryToGetPieceAt(e){return this.isOnBoard(e)?Mw.of(this.board[e.y][e.x]):Mw.empty()}isOnBoard(e){return e.isInRange(this.board[0].length,this.board.length)}getPieceAtXY(e,t){return this.getPieceAt(new JX(e,t))}forEachCoord(e){for(const[t,n]of this.getCoordsAndContents())e(t,n)}getCoordsAndContents(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++){const r=new JX(n,t);this.isOnBoard(r)&&e.push([r,this.getPieceAt(r)])}return e}getCopiedBoard(){return GK.copyBiArray(this.board)}}class gJ extends fJ{static getInitialState(){const e=nJ.EMPTY,t=nJ.UNREACHABLE,n=nJ.ZERO,r=nJ.ONE;return new gJ([[t,t,t,t,r,r,r,r,r],[t,t,t,r,r,r,r,r,r],[t,t,e,e,r,r,r,e,e],[t,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,t],[e,e,n,n,n,e,e,t,t],[n,n,n,n,n,n,t,t,t],[n,n,n,n,n,t,t,t,t]],0)}isInBoard(e){return e.isInRange(9,9)&&this.getPieceAt(e)!==nJ.UNREACHABLE}isPiece(e){return this.getPieceAt(e).isPlayer()}getScores(){const e=[14,14];for(let t=0;t<9;t++)for(let n=0;n<9;n++)this.getPieceAtXY(n,t)===nJ.ZERO&&(e[1]=e[1]-1),this.getPieceAtXY(n,t)===nJ.ONE&&(e[0]=e[0]-1);return e}}class mJ{}class yJ extends mJ{constructor(e,t){super(),this.coord=new JX(e,t)}}class vJ extends yJ{constructor(e,t,n){if(super(e.x,e.y),this.dir=t,this.lastPiece=n,e.isNotInRange(9,9))throw new Error("Coord "+e.toString()+" out of range, invalid move!")}static fromSingleCoord(e,t){try{return SW.success(new vJ(e,t,Mw.empty()))}catch(n){return SW.failure(n.message)}}static fromDoubleCoord(e,t,n){const r=[e,t];GK.sortByDescending(r,vJ.sortCoord);const i=r[1].getDirectionToward(r[0]).get(),s=rJ.factory.fromDelta(i.x,i.y);if(s.isFailure())return SW.failure("Invalid direction");const o=s.get();return r[1].getDistance(r[0])>2?SW.failure("Distance between first coord and last coord is too great"):o.equals(n)?vJ.fromSingleCoord(r[1],n):o.getOpposite().equals(n)?vJ.fromSingleCoord(r[0],n):SW.success(new vJ(r[1],n,Mw.of(r[0])))}static sortCoord(e){return 9*e.y+e.x}toString(){return this.isSingleCoord()?"AbaloneMove("+this.coord.x+", "+this.coord.y+", "+this.dir.toString()+")":"AbaloneMove("+this.coord.toString()+" > "+this.lastPiece.get().toString()+", "+this.dir.toString()+")"}isSingleCoord(){return this.lastPiece.isAbsent()}equals(e){return e.coord.equals(this.coord)&&e.dir.equals(this.dir)&&e.lastPiece.equals(this.lastPiece)}}vJ.encoder=new class extends FK{maxValue(){return 104831}encodeNumber(e){const t=9*e.coord.x*8+8*e.coord.y+e.dir.toInt();if(e.isSingleCoord())return t;{const n=e.lastPiece.get();return 9*n.x*2*9*9*8+2*n.y*9*9*8+648+t}}decodeNumber(e){const t=e%8;e=(e-t)/8;const n=rJ.factory.fromInt(t).get(),r=e%9,i=(e=(e-r)/9)%9;e=(e-i)/9;const s=new JX(i,r);if(0===e)return vJ.fromSingleCoord(s,n).get();{const t=(e=(e-1)/2)%9,r=(e=(e-t)/9)%9;e=(e-r)/9;const i=new JX(r,t);return vJ.fromDoubleCoord(s,i,n).get()}}};var _J=(()=>(function(e){e.VICTORY="VICTORY",e.PRE_VICTORY="PRE_VICTORY",e.DEFAULT="DEFAULT"}(_J||(_J={})),_J))();class CJ{constructor(e=[],t=!1){this.map=e,this.isImmutable=t}static from(e){const t=Object.keys(e),n=new CJ;for(const r of t)n.set(r,e[r]);return n}makeImmutable(){this.isImmutable=!0}get(e){for(const t of this.map)if(Aw(t.key,e))return Mw.of(t.value);return Mw.empty()}forEach(e){for(let t=0;t<this.map.length;t++)e(this.getByIndex(t))}getByIndex(e){return this.map[e]}putAll(e){this.checkImmutability("putAll");for(const t of e.map)this.put(t.key,t.value)}checkImmutability(e){if(this.isImmutable)throw new Error("Cannot call "+e+" on immutable map!")}put(e,t){this.checkImmutability("put");for(const n of this.map)if(Aw(n.key,e)){const e=n.value;return n.value=t,Mw.of(e)}return this.map.push({key:e,value:t}),Mw.empty()}containsKey(e){return this.map.some(t=>Aw(t.key,e))}size(){return this.map.length}listKeys(){return this.map.map(e=>e.key)}getKeySet(){return new dJ(this.listKeys())}filter(e){const t=new CJ;for(const n of this.map)e(n.key,n.value)&&t.set(n.key,n.value);return t}replace(e,t){if(this.checkImmutability("replace"),this.get(e).isAbsent())throw new Error("No Value to replace for key "+e.toString()+"!");return this.put(e,t),t}set(e,t){if(this.checkImmutability("set"),this.containsKey(e))throw new Error("Key "+e.toString()+" already exist in Map!");this.map.push({key:e,value:t})}delete(e){this.checkImmutability("delete");for(let t=0;t<this.map.length;t++)if(Aw(this.map[t].key,e)){const e=this.map[t].value,n=this.map.slice(0,t),r=this.map.slice(t+1);return this.map=n.concat(r),e}throw new Error('No Value to delete for key "'+e.toString()+'"!')}getCopy(){const e=new this.constructor;for(const t of this.listKeys())e.set(t,this.get(t).get());return e}equals(e){const t=this.getKeySet(),n=e.getKeySet();if(!1===t.equals(n))return!1;for(const r of t){const t=this.get(r).get(),n=e.get(r);if(NW(n.isPresent(),"value is absent in a map even though its key is present!"),!1===Aw(t,n.get()))return!1}return!0}}class EJ extends CJ{reverse(){const e=new EJ;for(const t of this.listKeys()){const n=this.get(t).get();if(e.containsKey(n))e.get(n).get().add(t);else{const r=new dJ;r.add(t),e.set(n,r)}}return e}}let wJ=(()=>{class e{}return e.createdNodes=0,e.minimaxTime=0,e})();class bJ{constructor(e,t=Mw.empty(),n=Mw.empty(),r){if(this.gameState=e,this.mother=t,this.move=n,this.minimaxCreator=r,this.childs=Mw.empty(),this.hopedValue=new CJ,this.ownValue=new CJ,this.possibleMoves=new CJ,this.ownValue=new CJ,null!=r){const e=r.getBoardValue(this);this.ownValue.set(r.name,e),this.hopedValue.set(r.name,e.value)}wJ.createdNodes++,Tw(bJ.VERBOSE||!1,"creating "+this.myToString())}static getScoreStatus(e){const t=!1;return e===Number.MAX_SAFE_INTEGER||e===Number.MIN_SAFE_INTEGER?(Tw(bJ.VERBOSE||t,"VICTORY"),_J.VICTORY):e===Number.MIN_SAFE_INTEGER+1?(Tw(bJ.VERBOSE||t,"PRE_VICTORY_MIN"),_J.PRE_VICTORY):e===Number.MAX_SAFE_INTEGER-1?(Tw(bJ.VERBOSE||t,"PRE_VICTORY_MAX"),_J.PRE_VICTORY):(Tw(bJ.VERBOSE||t,"DEFAULT"),_J.DEFAULT)}findBestMove(e,t,n=!1,r=!0){const i=(new Date).getTime();let s=this.alphaBeta(e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,n,r);for(;s.gameState.turn>this.gameState.turn+1;)s=s.mother.get(),e--;return wJ.minimaxTime+=(new Date).getTime()-i,s.move.get()}alphaBeta(e,t,n,r,i,s){if(e<1)return Tw(bJ.VERBOSE||!1,"isLeaf-Calculation : "+this.myToString()+" at depth "+e),this;if(r.ruler.getGameStatus(this).isEndGame)return Tw(bJ.VERBOSE||!1,"isLeaf-EndGame("+bJ.ruler.getGameStatus(this).winner.toString()+") : "+this.myToString()+" at depth "+e),this;const o=this.getPossibleMoves(r);NW(o.size()>0,"Minimax "+r.name+" should give move, received none!"),this.childs.isAbsent()&&(this.childs=Mw.of([]));const a=this.getBestChilds(o,e,t,n,r,i,s),l=this.getBestChildAmongst(a,i),c=l.hopedValue.get(r.toString()).get();return this.hopedValue.put(r.toString(),c),l}getPossibleMoves(e){const t=this.possibleMoves.get(e.name);if(t.isAbsent()){const t=e.getListMoves(this);return this.possibleMoves.set(e.name,new dJ(t)),new dJ(t)}return t.get()}getBestChilds(e,t,n,r,i,s,o){let a=[];const l=this.gameState.getCurrentPlayer();let c=l===BK.ZERO?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER;const u=l===BK.ZERO?(e,t)=>e<t:(e,t)=>e>t;for(const h of e){const e=this.getOrCreateChild(h,i).alphaBeta(t-1,n,r,i,s,o),d=e.getHopedValue(i);if(u(d,c)||0===a.length?(c=d,a=[e]):d===c&&a.push(e),o&&u(c,l===BK.ZERO?n:r))break;l===BK.ZERO?r=Math.min(c,r):n=Math.max(c,n)}return a}getBestChildAmongst(e,t){return t?e[Math.floor(Math.random()*e.length)]:e[0]}getOrCreateChild(e,t){let n=this.getSonByMove(e);if(n.isAbsent()){const r=t.ruler.isLegal(e,this.gameState),i=e.toString();NW(r.isSuccess(),'The minimax "'+t.name+'" has proposed an illegal move ('+i+"), this should not happen.");const s=t.ruler.applyLegalMove(e,this.gameState,r.get());n=Mw.of(new bJ(s,Mw.of(this),Mw.of(e),t)),this.childs.get().push(n.get())}return n.get()}getSonByMove(e){NW(this.childs.isPresent(),"Cannot get son of uncalculated node");for(const t of this.childs.get())if(t.move.isPresent()&&t.move.equalsValue(e))return Mw.of(t);return Mw.empty()}getInitialNode(){let e=this;for(;e.mother.isPresent();)e=e.mother.get();return e}getHopedValue(e){return this.hopedValue.get(e.name).get()}getOwnValue(e){const t=this.ownValue.get(e.name);if(t.isAbsent()){const t=e.getBoardValue(this);return this.ownValue.set(e.name,t),t}return t.get()}myToString(){let e="",t=this;if(t.mother.isAbsent())return"NodeInitial: "+t.gameState.turn;for(;t.mother.isPresent();)e=(t.move.isAbsent()?" ":" > "+t.move.get().toString()+"> ")+t.gameState.turn+" "+e,t=t.mother.get();return"Node: "+e}hasMoves(){return this.childs.isPresent()}countDescendants(){if(this.childs.isAbsent())return 0;let e=this.childs.get().length;for(const t of this.childs.get())e+=t.countDescendants();return e}}bJ.VERBOSE=!1,bJ.minimaxes=new CJ;class SJ{constructor(e,t){this.isEndGame=e,this.winner=t}static getVictory(e){return e===BK.ZERO?SJ.ZERO_WON:SJ.ONE_WON}static getDefeat(e){return e===BK.ZERO?SJ.ONE_WON:SJ.ZERO_WON}toBoardValue(){return this.winner.isPlayer()?this.winner.getVictoryValue():0}}SJ.ZERO_WON=new SJ(!0,BK.ZERO),SJ.ONE_WON=new SJ(!0,BK.ONE),SJ.DRAW=new SJ(!0,VK.NONE),SJ.ONGOING=new SJ(!1,VK.NONE);class PJ{constructor(e){this.stateType=e,this.setInitialBoard()}choose(e){const t=!1;Tw(t,"Rules.choose: "+e.toString()+" was proposed");const n=this.isLegal(e,this.node.gameState);if(this.node.hasMoves()){Tw(t,"Rules.choose: current node has moves");const r=this.node.getSonByMove(e);if(r.isPresent())return NW(n.isSuccess(),"Rules.choose: Move is illegal: "+n.getReasonOr("")),Tw(t,"Rules.choose: and this proposed move is found in the list, so it is legal"),this.node=r.get(),!0}if(Tw(t,"Rules.choose: current node has no moves or is pruned, let's verify ourselves"),n.isFailure())return Tw(t,"Rules.choose: Move is illegal: "+n.getReason()),!1;Tw(t,"Rules.choose: Move is legal, let's apply it");const r=this.applyLegalMove(e,this.node.gameState,n.get()),i=new bJ(r,Mw.of(this.node),Mw.of(e));return this.node=i,!0}setInitialBoard(){if(null==this.node){const e=this.stateType.getInitialState();bJ.ruler=this,this.node=new bJ(e)}else this.node=this.node.getInitialNode()}applyMoves(e,t,n){let r=0;for(const i of e){const e=n(i),s=this.isLegal(e,t);NW(s.isSuccess(),"Can't create state from invalid moves ("+r+"): "+s.toString()+"."),t=this.applyLegalMove(e,t,s.get()),r++}return t}}let OJ=(()=>{class e{}return e.CANNOT_MOVE_MORE_THAN_THREE_PIECES=()=>$localize`You cannot move more than 3 of your pieces!`,e.NOT_ENOUGH_PIECE_TO_PUSH=()=>$localize`You don't have enough pieces to push that group!`,e.CANNOT_PUSH_YOUR_OWN_PIECES=()=>$localize`You cannot push this piece because it is blocked by one of yours!`,e.MUST_ONLY_TRANSLATE_YOUR_PIECES=()=>$localize`This line contains pieces of your opponent or empty spaces, which is forbidden.`,e.TRANSLATION_IMPOSSIBLE=()=>$localize`This move is impossible, some landing spaces are occupied.`,e.LINE_AND_COORD_NOT_ALIGNED=()=>$localize`This space is not aligned with the current line.`,e})();class TJ extends PJ{static isLegal(e,t){const n=this.getFirstPieceValidity(e,t);return n.isFailure()?n.toFailedFallible():e.isSingleCoord()?TJ.isLegalPush(e,t):TJ.isLegalSideStep(e,t)}static getFirstPieceValidity(e,t){const n=t.getPieceAt(e.coord);return!1===t.isPiece(e.coord)?TW.failure(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n===nJ.ofPlayer(t.getCurrentOpponent())?TW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):TW.SUCCESS}static isLegalPush(e,t){let n=1,r=e.coord.getNext(e.dir);const i=nJ.ofPlayer(t.getCurrentPlayer()),s=nJ.EMPTY,o=t.getCopiedBoard();for(o[e.coord.y][e.coord.x]=s;n<=3&&t.isOnBoard(r)&&t.getPieceAt(r)===i;)n++,r=r.getNext(e.dir);return n>3?SW.failure(OJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES()):!1===t.isInBoard(r)||(o[r.y][r.x]=i,t.getPieceAt(r)===s)?SW.success(o):TJ.isLegalRealPush(r,e,t,n,o)}static isLegalRealPush(e,t,n,r,i){let s=0;const o=nJ.ofPlayer(n.getCurrentOpponent()),a=nJ.ofPlayer(n.getCurrentPlayer());for(;s<r&&n.isOnBoard(e)&&n.getPieceAt(e)===o;)s++,e=e.getNext(t.dir);return s>=r?SW.failure(OJ.NOT_ENOUGH_PIECE_TO_PUSH()):e.isInRange(9,9)&&(n.getPieceAt(e)===nJ.EMPTY&&(i[e.y][e.x]=o),n.getPieceAt(e)===a)?SW.failure(OJ.CANNOT_PUSH_YOUR_OWN_PIECES()):SW.success(i)}static isLegalSideStep(e,t){let n=e.lastPiece.get();const r=e.coord.getDirectionToward(n).get();n=n.getNext(r);let i=e.coord;const s=nJ.ofPlayer(t.getCurrentPlayer()),o=t.getCopiedBoard();for(;!1===i.equals(n)&&i.isInRange(9,9);){if(t.getPieceAt(i)!==s)return SW.failure(OJ.MUST_ONLY_TRANSLATE_YOUR_PIECES());const n=i.getNext(e.dir);if(o[i.y][i.x]=nJ.EMPTY,n.isInRange(9,9)){if(t.isPiece(n))return SW.failure(OJ.TRANSLATION_IMPOSSIBLE());t.getPieceAt(n)===nJ.EMPTY&&(o[n.y][n.x]=s)}i=i.getNext(r)}return SW.success(o)}static getGameStatus(e){const t=e.gameState.getScores();return t[0]>5?SJ.ZERO_WON:t[1]>5?SJ.ONE_WON:SJ.ONGOING}applyLegalMove(e,t,n){return new gJ(n,t.turn+1)}isLegal(e,t){return TJ.isLegal(e,t)}getGameStatus(e){return TJ.getGameStatus(e)}}class IJ extends cJ{getListMoves(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<9;i++)for(let e=0;e<9;e++){const s=new JX(e,i);if(!1!==n.getPieceAt(s).is(r))for(const e of rJ.factory.all){const r=vJ.fromSingleCoord(s,e).get();if(this.isAcceptablePush(r,n)){t.push(r);for(const r of rJ.factory.all)for(let i=1;i<=2&&!r.equals(e);i++){const o=s.getNext(r,i);if(!o.isInRange(9,9))break;{const r=vJ.fromDoubleCoord(s,o,e).get();TJ.isLegal(r,n).isSuccess()&&t.push(r)}}}}}return new dJ(t).toList()}isAcceptablePush(e,t){const n=t.getScores(),r=TJ.isLegal(e,t);if(r.isSuccess()){const e=t.getCurrentOpponent().value;return!(new gJ(r.get(),t.turn+1).getScores()[e]>n[e])}return!1}getBoardValue(e){const t=TJ.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState.getScores();return new uJ(n[1]-n[0])}}class kJ{constructor(e,t,n){this.title=e,this.instruction=t,this.state=n,this.previousMove=Mw.empty()}static fromMove(e,t,n,r,i,s){return new MJ(e,t,n,r,i,s)}static forClick(e,t,n,r,i,s){return new RJ(e,t,n,r,i,s)}static anyMove(e,t,n,r,i){return new NJ(e,t,n,r,i)}static fromPredicate(e,t,n,r,i,s){return new xJ(e,t,n,r,i,s)}static informational(e,t,n){return new DJ(e,t,n)}isMove(){return!1}isAnyMove(){return!1}isClick(){return!1}isPredicate(){return!1}isInformation(){return!1}hasSolution(){return!1}withPreviousMove(e){return this.previousMove=Mw.of(e),this}}class AJ extends kJ{constructor(e,t,n,r){super(e,t,n),this.successMessage=r}hasSolution(){return!0}getSuccessMessage(){return this.successMessage}}class MJ extends AJ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedMoves=r,this.failureMessage=s,NW(r.length>0,"TutorialStepMove: At least one accepted move should be provided, otherwise use TutorialStepInformational")}isMove(){return!0}getSolution(){return this.acceptedMoves[0]}getFailureMessage(){return this.failureMessage}}class NJ extends AJ{constructor(e,t,n,r,i){super(e,t,n,i),this.solutionMove=r}getSolution(){return this.solutionMove}isAnyMove(){return!0}}class RJ extends AJ{constructor(e,t,n,r,i,s){super(e,t,n,i),this.acceptedClicks=r,this.failureMessage=s}isClick(){return!0}getSolution(){return this.acceptedClicks[0]}getFailureMessage(){return this.failureMessage}}class xJ extends AJ{constructor(e,t,n,r,i,s){super(e,t,n,s),this.solutionMove=r,this.predicate=i}getSolution(){return this.solutionMove}isPredicate(){return!0}}class DJ extends kJ{isInformation(){return!0}}const LJ=nJ.EMPTY,FJ=nJ.UNREACHABLE,UJ=nJ.ZERO,BJ=nJ.ONE;class VJ{constructor(){this.tutorial=[kJ.informational($localize`Initial board and goal of the game`,$localize`At Abalone, the goal of the game is to be the first player to push 6 opponent's pieces out of the board. Let us see how!`,gJ.getInitialState()),kJ.anyMove($localize`Moving a piece`,$localize`At each turn, move one, two, or three pieces either along their line, or on their side.
        For your moves you can therefore choose between up to 6 directions.
        The pieces you move must be aligned and consecutive, and the move should land on an empty space (except to push, we will see that later).
        To make a move, click on one of your pieces, then click on an arrow to choose the move direction.<br/><br/>
        You're playing Dark, make any move!`,gJ.getInitialState(),vJ.fromSingleCoord(new JX(2,6),rJ.UP).get(),$localize`Congratulations!`),kJ.fromMove($localize`Pushing`,$localize`To push one opponent piece, you must move at least two of your pieces.
        To push two opponent pieces, you must move three of your pieces.
        If one of your pieces is in the way, it will be impossible to push.
        You cannot move more than three pieces.<br/><br/>
        Only one push towards the right is possible here, find it. (You're playing Dark).`,new gJ([[FJ,FJ,FJ,FJ,LJ,UJ,UJ,BJ,BJ],[FJ,FJ,FJ,LJ,LJ,LJ,LJ,LJ,LJ],[FJ,FJ,LJ,UJ,UJ,UJ,BJ,UJ,LJ],[FJ,LJ,LJ,LJ,LJ,LJ,LJ,LJ,LJ],[LJ,LJ,LJ,LJ,UJ,UJ,UJ,BJ,BJ],[LJ,LJ,LJ,LJ,LJ,LJ,LJ,LJ,FJ],[LJ,LJ,LJ,LJ,UJ,BJ,LJ,FJ,FJ],[LJ,LJ,LJ,UJ,LJ,LJ,FJ,FJ,FJ],[LJ,LJ,UJ,LJ,LJ,FJ,FJ,FJ,FJ]],0),[vJ.fromSingleCoord(new JX(4,4),rJ.RIGHT).get()],$localize`Congratulations! You know everything you need to start a game!`,$localize`Failed!`)]}}function $J(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=Sa(2).index,n=Sa().index;return Sa().onPieceClick(t,n)}),fa()}if(2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Ia("id","piece_",e,"_",t,""),ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.getCenterBy(e,t).x)("cy",n.getCenterBy(e,t).y)("r",.5*n.SPACE_SIZE)}}function zJ(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",4),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onCaseClick(t,n)}),fa(),la(2,$J,1,6,"circle",5),fa()}if(2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ts(1),Ia("id","case_",t,"_",r,""),ha("ngClass",i.getSquareClasses(t,r)),ra("points",i.getHexaCoordsBy(t,r)),Ts(1),ha("ngIf",i.isPiece(n))}}function HJ(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,zJ,3,5,"g",3),fa()),2&e){const e=t.$implicit,n=Sa(2);Ts(1),ha("ngIf",n.isBoard(e))}}function GJ(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,HJ,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function WJ(e,t){1&e&&(Cn(),pa(0,"marker",7),ga(1,"polygon",8),fa()),2&e&&Ta("id","arrowhead_",t.$implicit.dir.toString(),"")}function qJ(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),ga(1,"line",9),pa(2,"line",10),Ea("click",function(){const t=Gt(e).$implicit;return Sa().chooseDirection(t.dir)}),fa(),pa(3,"polygon",11),Ea("click",function(){const t=Gt(e).$implicit;return Sa().chooseDirection(t.dir)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),Ta("id","line_start_",e.dir.toString(),""),ra("x1",e.startCenter.x)("y1",e.startCenter.y)("x2",e.middle.x)("y2",e.middle.y),Ts(1),Ta("id","line_end_",e.dir.toString(),""),ra("x1",e.middle.x)("y1",e.middle.y)("x2",e.landingCenter.x)("y2",e.landingCenter.y),Ts(1),Ta("id","direction_",e.dir.toString(),""),ra("transform",e.transformation)}}class jJ{constructor(e,t,n,r,i,s){this.startCenter=e,this.middle=t,this.landingCenter=n,this.landing=r,this.dir=i,this.transformation=s}}let ZJ=(()=>{class e extends tJ{constructor(e){super(e),this.moveds=[],this.directions=[],this.selecteds=[],this.rules=new TJ(gJ),this.availableMinimaxes=[new IJ(this.rules,"Dummy")],this.encoder=vJ.encoder,this.tutorial=(new VJ).tutorial,this.scores=Mw.of([0,0]),this.SPACE_SIZE=30,this.hexaLayout=new iJ(this.SPACE_SIZE,new JX(-8*this.SPACE_SIZE,2*this.SPACE_SIZE),oJ.INSTANCE),this.updateBoard()}updateBoard(){this.cancelMoveAttempt(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.hexaBoard=this.rules.node.gameState.getCopiedBoard(),this.scores=Mw.of(this.rules.node.gameState.getScores())}hidePreviousMove(){this.moveds=[]}cancelMoveAttempt(){this.directions=[],this.selecteds=[]}showPreviousMove(){const e=this.rules.node.move.get();e.isSingleCoord()?this.showPushingMove(e):this.showSideStepMove(e)}showPushingMove(e){const t=this.rules.node.mother.get().gameState;let n=e.coord;for(this.moveds=[n],n=n.getNext(e.dir);n.isInRange(9,9)&&t.isPiece(n);)this.moveds.push(n),n=n.getNext(e.dir);n.isInRange(9,9)&&this.moveds.push(n)}showSideStepMove(e){let t=e.lastPiece.get();const n=e.coord.getDirectionToward(t).get();t=t.getNext(n);let r=e.coord;for(;!1===r.equals(t);)this.moveds.push(r),this.moveds.push(r.getNext(e.dir)),r=r.getNext(n)}onPieceClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#piece_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=n.rules.node.gameState.getCurrentOpponent();return n.hexaBoard[t][e].is(i)?n.opponentClick(e,t):0===n.selecteds.length?n.firstClick(e,t):1===n.selecteds.length?n.secondClick(e,t):n.thirdClick(e,t)})()}opponentClick(e,t){var n=this;return Pw(function*(){return(yield n.tryChoosingDirection(e,t)).isSuccess()?TW.SUCCESS:n.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE())})()}firstClick(e,t){var n=this;return Pw(function*(){return n.selecteds=[new JX(e,t)],n.showPossibleDirections(),TW.SUCCESS})()}showPossibleDirections(){this.directions=[],this.showDirection(1===this.selecteds.length)}showDirection(e){const t=this.rules.node.gameState,n=nJ.ofPlayer(t.getCurrentPlayer()),r=this.selecteds[0],i=this.selecteds[this.selecteds.length-1];for(const s of rJ.factory.all){let o,a=r.getNext(s,1);if(t.isOnBoard(a)&&t.getPieceAt(a)===n){if(e)continue;if(a=i.getNext(s,1),t.isOnBoard(a)&&t.getPieceAt(a)===n)continue}if(o=e?vJ.fromSingleCoord(r,s).get():vJ.fromDoubleCoord(r,i,s).get(),this.rules.isLegal(o,t).isSuccess()){const e=this.getCenterAt(r),t=this.getCenterAt(a),n=this.getMiddleOfArrow(s,a,t),i=t.x+" "+t.y,o=rJ.getAngle(s)+150,l=new jJ(e,n,t,a,s,"rotate("+o+" "+i+") translate("+i+")");this.directions.push(l)}}}getMiddleOfArrow(e,t,n){const r=t.getPrevious(e),i=this.getCenterAt(r);return new JX(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}isBoard(e){return e!==nJ.UNREACHABLE}isPiece(e){return e!==nJ.EMPTY}secondClick(e,t){var n=this;return Pw(function*(){const r=n.selecteds[0],i=new JX(e,t);if(i.equals(r))return n.cancelMoveAttempt(),TW.SUCCESS;if(!1===i.isHexagonallyAlignedWith(r))return n.cancelMoveAttempt(),n.firstClick(e,t);const s=i.getDistance(r);if(s>2)return n.cancelMove(OJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES());const o=r.getDirectionToward(i).get();n.selecteds=[r];for(let e=0;e<s;e++)n.selecteds.push(r.getNext(o,e+1));if(3===n.selecteds.length){const r=n.selecteds[1],i=n.rules.node.gameState.getCurrentPlayer();if(!1===n.hexaBoard[r.y][r.x].is(i))return n.cancelMoveAttempt(),n.firstClick(e,t)}return n.showPossibleDirections(),TW.SUCCESS})()}thirdClick(e,t){var n=this;return Pw(function*(){const r=new JX(e,t),i=n.selecteds[0];if(r.equals(i))return n.deselectExtremity(!0);const s=n.selecteds[n.selecteds.length-1];return r.equals(s)?n.deselectExtremity(!1):3===n.selecteds.length&&r.equals(n.selecteds[1])?(n.cancelMoveAttempt(),TW.SUCCESS):n.tryExtension(r,i,s)})()}tryExtension(e,t,n){var r=this;return Pw(function*(){const i=KX.factory.fromMove(t,e);if(i.isSuccess()){const s=KX.factory.fromMove(n,e);if(i.equals(s)){const i=t.getDistance(e),s=n.getDistance(e);return 2===Math.max(i,s)?(r.selecteds.push(e),GK.sortByDescending(r.selecteds,vJ.sortCoord),r.showPossibleDirections(),TW.SUCCESS):r.cancelMove(OJ.CANNOT_MOVE_MORE_THAN_THREE_PIECES())}}const s=r.cancelMove(OJ.LINE_AND_COORD_NOT_ALIGNED());return yield r.firstClick(e.x,e.y),s})()}deselectExtremity(e){var t=this;return Pw(function*(){return t.selecteds=t.selecteds.slice(e?1:0,e?void 0:-1),t.showPossibleDirections(),TW.SUCCESS})()}chooseDirection(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#direction_"+e.toString());return n.isFailure()?t.cancelMove(n.getReason()):t._chooseDirection(e)})()}_chooseDirection(e){var t=this;return Pw(function*(){const n=t.rules.node.gameState;let r;const i=t.selecteds[0];return r=1===t.selecteds.length?vJ.fromSingleCoord(i,e).get():vJ.fromDoubleCoord(i,t.selecteds[t.selecteds.length-1],e).get(),t.chooseMove(r,n,t.scores.get())})()}onCaseClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#case_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.tryChoosingDirection(e,t)})()}tryChoosingDirection(e,t){var n=this;return Pw(function*(){const r=new JX(e,t);for(const e of n.directions)if(e.landing.equals(r))return n._chooseDirection(e.dir);return TW.failure("not a direction")})()}getSquareClasses(e,t){const n=new JX(e,t),r=[];return this.moveds.some(e=>e.equals(n))&&r.push("moved"),r}getPieceClasses(e,t){const n=new JX(e,t),r=BK.of(this.hexaBoard[t][e].value),i=[this.getPlayerClass(r)];return this.selecteds.some(e=>e.equals(n))&&i.push("highlighted"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-abalone"]],features:[Go],decls:5,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-165 0 470 500","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id",4,"ngFor","ngForOf"],[4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass","click"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base",3,"id","ngClass","click"],["markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto",3,"id"],["points","0 0, 10 3.5, 0 7"],[1,"arrow",3,"id"],[1,"arrow",3,"id","click"],["points","-10 -5, 10 -5, 0 15, -10 -5",1,"arrow",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,GJ,2,1,"g",1),pa(2,"defs"),la(3,WJ,2,1,"marker",2),fa(),la(4,qJ,4,12,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.hexaBoard),Ts(2),ha("ngForOf",t.directions),Ts(1),ha("ngForOf",t.directions))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class YJ{constructor(e){this.x=e}static from(e){switch(e){case 0:return YJ.ZERO;case 1:return YJ.ONE;case 2:return YJ.TWO;default:return NW(3===e,"Invalid Apagos Coord "+e),YJ.THREE}}equals(e){return this.x===e.x}}YJ.ZERO=new YJ(0),YJ.ONE=new YJ(1),YJ.TWO=new YJ(2),YJ.THREE=new YJ(3);let KJ=(()=>{class e{}return e.PIECE_SHOULD_MOVE_DOWNWARD=()=>$localize`Pieces should only move downward!`,e.CANNOT_LAND_ON_A_FULL_SQUARE=()=>$localize`That square is already full, you cannot put a piece in it!`,e.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE=()=>$localize`You have no pieces in that square, select one that contains at least one of your pieces!`,e.NO_PIECE_REMAINING_TO_DROP=()=>$localize`There are no remaining pieces of that color to drop!`,e.NO_POSSIBLE_TRANSFER_REMAINS=()=>$localize`There is no possible transfer from that square!`,e})();class QJ extends mJ{constructor(e,t,n){super(),this.landing=e,this.piece=t,this.starting=n}static drop(e,t){return Ow.getNonNullable(QJ.ALL_MOVES.find(n=>n.landing.equals(e)&&n.piece.equalsValue(t)&&n.starting.equals(Mw.empty())))}static transfer(e,t){if(e.x<=t.x)return SW.failure(KJ.PIECE_SHOULD_MOVE_DOWNWARD());const n=Ow.getNonNullable(QJ.ALL_MOVES.find(n=>n.landing.equals(t)&&n.piece.equals(Mw.empty())&&n.starting.equals(Mw.of(e))));return SW.success(n)}isDrop(){return this.piece.isPresent()}toString(){return this.isDrop()?"ApagosMove.drop("+this.piece.get().toString()+" on "+this.landing.x+")":"ApagosMove.slideDown("+this.starting.get().x+" > "+this.landing.x+")"}equals(e){return!1!==this.starting.equals(e.starting)&&!1!==this.landing.equals(e.landing)&&this.piece.equals(e.piece)}}QJ.ALL_MOVES=[new QJ(YJ.ZERO,Mw.of(BK.ZERO),Mw.empty()),new QJ(YJ.ONE,Mw.of(BK.ZERO),Mw.empty()),new QJ(YJ.TWO,Mw.of(BK.ZERO),Mw.empty()),new QJ(YJ.THREE,Mw.of(BK.ZERO),Mw.empty()),new QJ(YJ.ZERO,Mw.of(BK.ONE),Mw.empty()),new QJ(YJ.ONE,Mw.of(BK.ONE),Mw.empty()),new QJ(YJ.TWO,Mw.of(BK.ONE),Mw.empty()),new QJ(YJ.THREE,Mw.of(BK.ONE),Mw.empty()),new QJ(YJ.TWO,Mw.empty(),Mw.of(YJ.THREE)),new QJ(YJ.ONE,Mw.empty(),Mw.of(YJ.THREE)),new QJ(YJ.ZERO,Mw.empty(),Mw.of(YJ.THREE)),new QJ(YJ.ONE,Mw.empty(),Mw.of(YJ.TWO)),new QJ(YJ.ZERO,Mw.empty(),Mw.of(YJ.TWO)),new QJ(YJ.ZERO,Mw.empty(),Mw.of(YJ.ONE))],QJ.encoder=new class extends FK{maxValue(){return QJ.ALL_MOVES.length}encodeNumber(e){const t=QJ.ALL_MOVES.findIndex(t=>t.equals(e));return NW(t>=0,e.toString()+" is not part of possibles moves of Apagos!"),t}decodeNumber(e){return NW(e<QJ.ALL_MOVES.length,e+" is not a valid encoded number for ApagosMove decoder"),QJ.ALL_MOVES[e]}};class XJ{constructor(e){this.containing=e}static from(e,t,n){if(e+t>n)return SW.failure("invalid starting space");const r=new CJ([{key:BK.ZERO,value:e},{key:BK.ONE,value:t},{key:VK.NONE,value:n}]);r.makeImmutable();const i=new XJ(r);return SW.success(i)}isFull(){return this.count(BK.ZERO)+this.count(BK.ONE)>=this.count(VK.NONE)}count(e){return this.containing.get(e).get()}addPiece(e){let t=this.count(BK.ZERO),n=this.count(BK.ONE);const r=this.count(VK.NONE);return e===BK.ZERO?t++:n++,XJ.from(t,n,r).get()}substractPiece(e){let t=this.count(BK.ZERO),n=this.count(BK.ONE);const r=this.count(VK.NONE);return e===BK.ZERO?t--:n--,XJ.from(t,n,r).get()}getDominatingPlayer(){const e=this.count(BK.ZERO),t=this.count(BK.ONE);return e>t?BK.ZERO:t>e?BK.ONE:VK.NONE}equals(e){return this.containing.equals(e.containing)}}let JJ=(()=>{class e extends pJ{constructor(e,t,n){super(e),this.board=t,this.remaining=n,this.remaining.makeImmutable()}static getInitialState(){return e.fromRepresentation(0,[[0,0,0,0],[0,0,0,0],[7,5,3,1]],this.PIECES_PER_PLAYER,this.PIECES_PER_PLAYER)}static fromRepresentation(t,n,r,i){const s=[];for(let e=0;e<4;e++){const t=XJ.from(n[0][e],n[1][e],n[2][e]).get();s.push(t)}const o=new CJ;return o.set(BK.ZERO,r),o.set(BK.ONE,i),new e(t,s,o)}getPieceAt(e){return this.board[e.x]}updateAt(t,n){const r=[];for(let e=0;e<4;e++)r.push(t.x===e?n:this.board[e]);const i=this.getRemainingCopy();return new e(this.turn,r,i)}getRemainingCopy(){return this.remaining.getCopy()}getRemaining(e){return this.remaining.get(e).get()}equals(e){return this.turn===e.turn&&GK.compareArray(e.board,this.board)&&this.remaining.equals(e.remaining)}}return e.PIECES_PER_PLAYER=10,e})();class e1 extends PJ{static get(){return e1.singleton.isAbsent()&&(e1.singleton=Mw.of(new e1(JJ))),this.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalTransfer(e,t)}applyLegalDrop(e,t){const n=t.getRemainingCopy(),r=n.get(e.piece.get()).get();n.put(e.piece.get(),r-1);const i=new JJ(t.turn+1,t.board,n),s=e.piece.get(),o=i.getPieceAt(e.landing).addPiece(s);if(e.landing===YJ.THREE)return i.updateAt(e.landing,o);{const t=YJ.from(e.landing.x+1),n=i.getPieceAt(t);return i.updateAt(e.landing,n).updateAt(t,o)}}applyLegalTransfer(e,t){const n=t.getCurrentPlayer(),r=e.starting.get(),i=t.getPieceAt(r).substractPiece(n),s=t.getPieceAt(e.landing).addPiece(n);let o=t.updateAt(r,i);return o=o.updateAt(e.landing,s),new JJ(o.turn+1,o.board,o.remaining)}isLegal(e,t){return t.getPieceAt(e.landing).isFull()?SW.failure(KJ.CANNOT_LAND_ON_A_FULL_SQUARE()):e.isDrop()?this.isLegalDrop(e,t):this.isLegalSlideDown(e,t)}isLegalDrop(e,t){return t.getRemaining(e.piece.get())<=0?SW.failure(KJ.NO_PIECE_REMAINING_TO_DROP()):SW.success(void 0)}isLegalSlideDown(e,t){const n=t.getCurrentPlayer();return 0===t.getPieceAt(e.starting.get()).count(n)?SW.failure(KJ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):SW.success(void 0)}getGameStatus(e){const t=e.gameState;for(let r=0;r<4;r++)if(!1===t.getPieceAt(YJ.from(r)).isFull())return SJ.ONGOING;const n=t.getPieceAt(YJ.THREE).getDominatingPlayer();return NW(n.isPlayer(),"winner can only be a player if the game is finished"),SJ.getVictory(n)}}e1.singleton=Mw.empty();class t1 extends cJ{getListMoves(e){const t=e.gameState;return QJ.ALL_MOVES.filter(function(e){return e1.get().isLegal(e,t).isSuccess()})}getBoardValue(e){const t=e1.get().getGameStatus(e);if(t.isEndGame)return uJ.fromWinner(t.winner);const n=e.gameState.board[3].getDominatingPlayer();return n.isPlayer()?new uJ(n.getScoreModifier()):new uJ(0)}}class n1{constructor(){this.tutorial=[kJ.informational($localize`Initial board and goal of the game`,$localize`At Apagos, there are 4 squares, each of them has a fixed number of holes for pieces. Each player starts with 10 pieces. Dark pieces belong to the first player, light pieces belong to the second one. The game ends when no one can play. The player owning the most pieces in the rightmost square wins!`,JJ.getInitialState()),kJ.anyMove($localize`Drop`,$localize`There are two kind of moves. One is the drop. To do one, you must click on a visible arrow, being of your color or the opponent's. If the chosen square is one of the 3 leftmost ones, it will exchange position with the square on its right. You're playing Light.<br/><br/>Drop a piece on one of those three squares.`,JJ.fromRepresentation(1,[[0,0,0,1],[0,0,0,0],[7,5,3,1]],9,10),QJ.drop(YJ.ZERO,BK.ZERO),$localize`Congratulations!`),kJ.fromPredicate($localize`Transfer`,$localize`The other kind of move is the transfer.<ol><li>Choose one of your pieces on the board by clicking on the square in which it is.</li><li>Choose its landing square by clicking on one of the arrow to finish the transfer.</li></ol>It can only be done with your pieces, from an higher square to a lower one.<br/><br/>You're playing Dark, do a transfer!`,JJ.fromRepresentation(2,[[0,0,1,0],[0,1,0,0],[7,5,3,1]],9,9),QJ.transfer(YJ.TWO,YJ.ZERO).get(),(e,t)=>e.isDrop()?TW.failure($localize`This move is a drop, please do a transfer!`):TW.SUCCESS,$localize`Congratulations!`),kJ.fromPredicate($localize`Victory`,$localize`When you put a last piece into a square, the games end. In this configuration you can win.<br/><br/>You're playing Light, do the winning move!`,JJ.fromRepresentation(2,[[1,0,3,4],[2,1,3,1],[3,1,7,5]],2,3),QJ.drop(YJ.TWO,BK.ONE),(e,t)=>e.isDrop()?e.piece.equalsValue(BK.ONE)?TW.SUCCESS:TW.failure($localize`You actively made your opponent win!`):TW.failure($localize`Wrong choice, your opponent will win in the next turn no matter which piece is dropped!`),$localize`Congratulations!`)]}}function r1(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=t.$implicit,n=Sa();ra("cx",(e+1)*n.PIECE_RADIUS)("cy",n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function i1(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa();return n.onArrowClick(t,n.PlayerOrNone.ZERO)}),fa()}if(2&e){const e=Sa().index,t=Sa();Ta("id","dropArrow_zero_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ZERO)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ZERO))}}function s1(e,t){if(1&e){const e=va();Cn(),pa(0,"polygon",7),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa();return n.onArrowClick(t,n.PlayerOrNone.ONE)}),fa()}if(2&e){const e=Sa().index,t=Sa();Ta("id","dropArrow_one_",e,""),ha("ngClass",t.getArrowClasses(e,t.PlayerOrNone.ONE)),ra("points",t.ARROW_COORD)("transform",t.getArrowTransform(e,t.PlayerOrNone.ONE))}}function o1(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",8),Ea("click",function(){Gt(e);const t=Sa().index;return Sa().onSquareClick(t)}),fa(),ya()}if(2&e){const e=t.$implicit,n=Sa(),r=n.index,i=n.$implicit,s=Sa();Ts(1),ka("id","square_",r,"_piece_",e,"_out_of_",i.count(s.PlayerOrNone.NONE),""),ha("ngClass",s.getPieceClasses(r,e,i)),ra("cx",s.getCircleCenter(r,e,i).x)("cy",s.getCircleCenter(r,e,i).y)}}function a1(e,t){if(1&e){const e=va();Cn(),ma(0),la(1,i1,1,4,"polygon",6),la(2,s1,1,4,"polygon",6),pa(3,"rect",7),Ea("click",function(){const t=Gt(e).index;return Sa().onSquareClick(t)}),fa(),la(4,o1,2,6,"ng-container",3),ya()}if(2&e){const e=t.$implicit,n=t.index,r=Sa();Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ZERO)),Ts(1),ha("ngIf",r.canDisplayArrow(n,r.PlayerOrNone.ONE)),Ts(1),Ta("id","square_",n,""),ha("ngClass",r.getSquareClasses(n)),ra("x",n*r.SPACE_SIZE)("y",(5-n)*r.SPACE_SIZE*.25)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngForOf",r.range(e.count(r.PlayerOrNone.NONE)))}}function l1(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=t.$implicit,n=Sa();ra("cx",4*n.SPACE_SIZE-(e+1)*n.PIECE_RADIUS)("cy",2.25*n.SPACE_SIZE+3*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}let c1=(()=>{class e extends eJ{constructor(t){super(t),this.PlayerOrNone=VK,this.ARROW_COORD=e.getArrowCoord(),this.PIECES_PER_PLAYER=JJ.PIECES_PER_PLAYER,this.selectedPiece=Mw.empty(),this.leftPiece=Mw.empty(),this.droppedPiece=Mw.empty(),this.displayableArrow=[],this.rules=new e1(JJ),this.availableMinimaxes=[new t1(this.rules,"ApagosDummyMinimax")],this.encoder=QJ.encoder,this.tutorial=(new n1).tutorial,this.PIECE_RADIUS=200/(this.PIECES_PER_PLAYER+1),this.updateBoard()}static getArrowCoord(){return"12.5,0 37.5,0 37.5,25 50,25 25,50 0,25 12.5,25"}cancelMoveAttempt(){this.selectedPiece=Mw.empty(),this.showPossibleDrops()}updateBoard(){const e=this.rules.node.gameState;this.board=e.board,this.remainingZero=e.remaining.get(BK.ZERO).get(),this.remainingOne=e.remaining.get(BK.ONE).get(),this.hideLastMove(),this.rules.node.move.isPresent()&&this.showLastMove(),this.showPossibleDrops()}hideLastMove(){this.movedSquare=[],this.droppedPiece=Mw.empty(),this.leftPiece=Mw.empty(),this.selectedPiece=Mw.empty()}showLastMove(){const e=this.rules.node.move.get();e.isDrop()?this.showLastDrop(e):this.showLastTransfer(e)}showLastDrop(e){const t=e.piece.get();let n=e.landing.x;this.movedSquare=[n],3!==e.landing.x&&(n+=1,this.movedSquare.push(n));const r=this.getLowestPlayerPiece(this.board[n],t);this.droppedPiece=Mw.of({square:n,piece:r})}getLowestPlayerPiece(e,t){const n=e.count(t);return t===BK.ZERO?n-1:e.count(VK.NONE)-n}showLastTransfer(e){const t=this.rules.node.mother.get().gameState,n=t.getCurrentPlayer(),r=e.starting.get().x,i=this.getLowestPlayerPiece(t.board[r],n);this.leftPiece=Mw.of({square:r,piece:i});const s=e.landing.x,o=this.getLowestPlayerPiece(this.board[s],n);this.droppedPiece=Mw.of({square:s,piece:o})}showPossibleDrops(){this.displayableArrow=[];const e=this.rules.node.gameState;for(let t=0;t<4;t++)!1===e.board[t].isFull()&&(e.remaining.get(BK.ZERO).get()>0&&this.displayableArrow.push({x:t,player:BK.ZERO}),e.remaining.get(BK.ONE).get()>0&&this.displayableArrow.push({x:t,player:BK.ONE}))}getCircleCenter(e,t,n){const r=e*this.SPACE_SIZE+.5*this.SPACE_SIZE,i=(5-e)*this.SPACE_SIZE*.25+.5*this.SPACE_SIZE;if(1===n.count(VK.NONE))return new JX(r,i);const s=n.count(VK.NONE),o=2*t*Math.PI/s-Math.PI/2,a=.3*this.SPACE_SIZE,l=a*Math.cos(o),c=a*Math.sin(o);return new JX(r+l,i+c)}canDisplayArrow(e,t){return this.displayableArrow.some(n=>n.x===e&&n.player.equals(t))}getArrowClasses(e,t){return[this.getPlayerClass(t)]}getArrowTransform(e,t){let n=t===BK.ZERO?0:.5*this.SPACE_SIZE;return n+=e*this.SPACE_SIZE,"translate("+n+", "+(3-e)*this.SPACE_SIZE*.25+")"}getSquareClasses(e){const t=["base"];return this.selectedPiece.isPresent()&&this.selectedPiece.get().square===e?t.push("selected"):this.movedSquare.includes(e)&&t.push("last-move"),t}onArrowClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#dropArrow_"+(t===BK.ZERO?"zero":"one")+"_"+e);if(r.isFailure())return n.cancelMove(r.getReason());const i=YJ.from(e);let s;if(n.selectedPiece.isPresent()){const e=n.selectedPiece.get().square;s=QJ.transfer(YJ.from(e),i).get()}else s=QJ.drop(i,t);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e,t,n){const r={square:e,piece:t},i=[];let s=n.count(BK.ZERO),o=n.count(BK.ONE);if(this.selectedPiece.equalsValue(r))i.push("selected");else if(this.droppedPiece.equalsValue(r))i.push("last-move");else if(this.leftPiece.isPresent()&&this.leftPiece.get().square===e){if(this.leftPiece.get().piece===t)return i.push("captured-stroke"),i;this.rules.node.gameState.getCurrentOpponent()===BK.ZERO?s++:o++}const a=n.count(VK.NONE)-(o+s),l=this.getPieceColor(t,s,a);return""!==l&&i.push(l),i}getPieceColor(e,t,n){return e<t?"player0":e>=t+n?"player1":""}onSquareClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#square_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.selectedPiece.isPresent()&&t.selectedPiece.get().square===e)return t.cancelMoveAttempt(),TW.SUCCESS;const r=t.rules.node.gameState.getCurrentPlayer(),i=t.board[e];return i.count(r)<=0?t.cancelMove(KJ.NO_PIECE_OF_YOU_IN_CHOSEN_SQUARE()):(t.selectedPiece=Mw.of({square:e,piece:t.getLowestPlayerPiece(i,r)}),0===t.showAndGetPossibleTranfers().length?t.cancelMove(KJ.NO_POSSIBLE_TRANSFER_REMAINS()):TW.SUCCESS)})()}showAndGetPossibleTranfers(){this.displayableArrow=[];let e=this.selectedPiece.get().square-1;const t=this.rules.node.gameState.getCurrentPlayer();for(;0<=e;)!1===this.board[e].isFull()&&this.displayableArrow.push({x:e,player:t}),e--;return this.displayableArrow}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-apagos"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-8 -8 416 350","preserveAspectRatio","xMidYMid meet"],["class","base mid-stroke player0",4,"ngFor","ngForOf"],["id","board"],[4,"ngFor","ngForOf"],["class","base mid-stroke player1",4,"ngFor","ngForOf"],[1,"base","mid-stroke","player0"],["class","base mid-stroke",3,"id","ngClass","click",4,"ngIf"],[1,"base","mid-stroke",3,"id","ngClass","click"],["r","10",1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","player1"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,r1,1,3,"circle",1),pa(2,"g",2),la(3,a1,5,9,"ng-container",3),fa(),la(4,l1,1,3,"circle",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.range(t.remainingZero)),Ts(1),ra("transform","translate(0, "+2*t.PIECE_RADIUS+")"),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.range(t.remainingOne)))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),u1=(()=>{class e extends eJ{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class h1 extends fJ{constructor(e,t,n){super(e,t),this.captured=n}static getInitialState(){const e=GK.createTable(6,2,4);return new h1(e,0,[0,0])}getCapturedCopy(){return[this.captured[0],this.captured[1]]}}let d1=(()=>{class e{}return e.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME=()=>$localize`You cannot distribute from the opponent's home.`,e.MUST_CHOOSE_NONEMPTY_HOUSE=()=>$localize`You should choose a non-empty house to distribute.`,e.SHOULD_DISTRIBUTE=()=>$localize`You should distribute but you do not.`,e})(),p1=(()=>{class e extends PJ{applyLegalMove(t,n,r){Tw(e.VERBOSE,{called:"AwaleRules.applyLegalMove",move:t,state:n});const i=t.x,s=n.getCurrentPlayer().value,o=n.getCurrentPlayer().getOpponent().value;let a=n.getCopiedBoard();const l=e.distribute(i,s,a);if(l.y===s)return new h1(a,n.turn+1,n.captured);{let t=[0,0];const r=GK.copyBiArray(a);return t[s]=e.capture(l.x,o,s,a),t[s]>0&&e.isStarving(o,a)&&(a=r,t=[0,0]),e.isStarving(s,a)&&!1===e.canDistribute(o,a)&&(t[o]+=e.mansoon(o,a)),t[0]+=n.captured[0],t[1]+=n.captured[1],new h1(a,n.turn+1,t)}}static mansoon(e,t){let n=0,r=0;do{n+=t[e][r],t[e][r]=0,r++}while(r<6);return n}static isLegal(t,n){const r=n.getCurrentPlayer().value,i=n.getCurrentPlayer().getOpponent().value,s=t.x;if(0===n.getPieceAtXY(s,r))return SW.failure(d1.MUST_CHOOSE_NONEMPTY_HOUSE());const o=e.isStarving(i,n.board),a=!1===e.doesDistribute(s,r,n.board);return o&&a?SW.failure(d1.SHOULD_DISTRIBUTE()):SW.success(void 0)}isLegal(t,n){return e.isLegal(t,n)}static doesDistribute(e,t,n){return 0===t?n[t][e]>5-e:n[t][e]>e}static canDistribute(t,n){for(let r=0;r<6;r++)if(e.doesDistribute(r++,t,n))return!0;return!1}static isStarving(e,t){let n=0;do{if(t[e][n++]>0)return!1}while(n<6);return!0}static distribute(e,t,n){const r=e,i=t;let s=n[t][e];for(n[t][e]=0;s>0;)0===t?5===e?t=1:e++:0===e?t=0:e--,(e!==r||t!==i)&&(n[t][e]+=1,s--);return new JX(e,t)}static capture(e,t,n,r){NW(t!==n,"AwaleRules.capture called with wrong values of x and player");let i=r[t][e];if(i<2||i>3)return 0;let s=0,o=-1,a=-1;0===n&&(o=1,a=6);do{s+=i,r[t][e]=0,i=r[t][e+=o]}while(e!==a&&(2===i||3===i));return s}static getGameStatus(e){const t=e.gameState;return t.captured[0]>24?SJ.ZERO_WON:t.captured[1]>24?SJ.ONE_WON:24===t.captured[0]&&24===t.captured[1]?SJ.DRAW:SJ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class f1 extends mJ{constructor(e){super(),this.x=e}static from(e){switch(e){case 0:return f1.ZERO;case 1:return f1.ONE;case 2:return f1.TWO;case 3:return f1.THREE;case 4:return f1.FOUR;default:return NW(5===e,"Invalid x for AwaleMove: "+e),f1.FIVE}}equals(e){return e===this||e.x===this.x}toString(){return"AwaleMove("+this.x+")"}}f1.ZERO=new f1(0),f1.ONE=new f1(1),f1.TWO=new f1(2),f1.THREE=new f1(3),f1.FOUR=new f1(4),f1.FIVE=new f1(5),f1.encoder=new class extends FK{maxValue(){return 5}encodeNumber(e){return e.x}decodeNumber(e){return f1.from(e)}};class g1 extends cJ{getListMoves(e){const t=[],n=e.gameState,r=n.turn%2;let i,s=0;do{0!==n.getPieceAtXY(s,r)&&(i=f1.from(s),p1.isLegal(i,n).isSuccess()&&(i=f1.from(s),t.push(i))),s++}while(s<6);return this.orderMoves(e,t)}orderMoves(e,t){const n=e.gameState.getCurrentPlayer().value,r=e.gameState.getCurrentPlayer().getOpponent().value;return GK.sortByDescending(t,t=>{const i=e.gameState.getCopiedBoard(),s=i[n][t.x],o=p1.distribute(t.x,n,i);let a,l=0;return o.y===n?(a=0,s<=6&&(l=10)):a=p1.capture(o.x,r,n,i),100*a+l-s}),t}getBoardValue(e){const t=p1.getGameStatus(e);if(t.isEndGame)return uJ.fromWinner(t.winner);const n=e.gameState.getCapturedCopy();return new uJ(n[1]-n[0])}}class m1{constructor(){this.tutorial=[kJ.anyMove($localize`Sowing`,$localize`Awalé is a game of distribution (sowing) and capture. Its goal is to capture the most seeds.
         Let's see how seeds are sown.
         As you're playing first, the 6 houses on the top are yours.<br/><br>
         Click on any of them to sow the seeds it contains: they will be sown clockwise, one seed per house.`,h1.getInitialState(),f1.ZERO,$localize`Look at the 4 houses that follow clockwise the one you picked, they now contain 5 seeds.
        This is how seeds are sown:
        one by one from the house next to the one they come from, clockwise.`),kJ.anyMove($localize`Big sowing`,$localize`You are now the second player (on the bottom).
        When there are enough seeds to make a full turn, something else happens.<br/><br/>
        Sow the house that contains 12 seeds.`,new h1([[0,0,0,0,0,0],[0,12,0,0,0,0]],1,[0,0]),f1.ONE,$localize`See, the house that you sowed has not been refilled, and the sowing immediately continued to the next house (which therefore contains two seeds).`),kJ.fromMove($localize`Simple capture`,$localize`After sowing, if the last seed falls in an opponent's house and if there is now two or three seeds in this house, the player captures these two or three seeds.
         Then, the player looks at the preceding house:
         if it is still in the opponent's side and contains two or three seeds, they are also captured.
         This continues until we reach either the player's side or a house containing neither two nor three seeds.<br/><br/>
         You are the second player, try to capture some pieces!`,new h1([[1,0,0,0,1,0],[1,0,0,0,1,0]],1,[0,0]),[f1.ZERO],$localize`Well done! This was a simple capture, now let us see how to make multiple captures.`,$localize`Failed. Try again and sow from the leftmost house.`),kJ.fromMove($localize`Multiple captures`,$localize`By sowing from your leftmost house, you will change the number of seeds in a house from 2 to 3, and from the preceding house from 1 to 2.
        As these are consecutive houses, all seeds in them will be captured.<br/><br/>
        Capture them.`,new h1([[2,1,0,0,1,0],[2,0,0,0,1,0]],1,[0,0]),[f1.ZERO],$localize`Nice, you win 3 points from the first house, and 2 from the second!`,$localize`Failed. Try again.`),kJ.fromMove($localize`Interrupted capture`,$localize`By clicking on your leftmost house, you end up on the 3rd house, which is capturable.<br/><br/>
        Do it.`,new h1([[1,0,1,0,0,1],[3,0,0,0,1,0]],1,[0,0]),[f1.ZERO],$localize`Notice that because the second house was not capturable, the captured was interrupted and you have not captured the first house.`,$localize`Failed. Try again.`),kJ.fromMove($localize`Capture on the other side only`,$localize`Try to capture the two leftmost houses of the opponent.`,new h1([[2,2,0,0,1,0],[1,3,0,0,0,0]],1,[0,0]),[f1.ONE],$localize`Congratulations! Notice that the capture was interrupted when entering your territory: you cannot capture your own houses!`,$localize`You have only captured one house, try again!`),kJ.fromMove($localize`Do not starve`,$localize`You have a very nice capture that seems possible: it seems that you can capture all the opponent's seeds!<br/><br/>
        Try it.`,new h1([[1,1,1,1,1,0],[5,0,0,1,0,0]],1,[0,0]),[f1.ZERO],$localize`Sadly, you cannot capture here, otherwise the opponent could not play after you.
        When this happens, the move can be made, but no capture takes place!`,$localize`Failed. Try again.`),kJ.anyMove($localize`Feeding is mandatory`,$localize`You cannot let another player starve, meaning that if your opponent has no seeds anymore and if you can give them at least one, you have to do it.<br/><br/>
        Go ahead!`,new h1([[0,0,0,0,0,0],[0,1,2,4,4,5]],1,[0,0]),f1.THREE,$localize`Congratulations! Note that you can choose to give your opponent the least number of seeds if it is better for you.
        It is often a good way to have easy captures!`),kJ.anyMove($localize`End of the game`,$localize`A game is won as soon as one player has captured 25 seeds, as that player has more than half of all the seeds.<br/><br/>
         Sow the house on the top right.`,new h1([[0,0,0,0,0,1],[0,1,2,3,4,4]],0,[0,0]),f1.FIVE,$localize`Also, as soon as on player cannot play, the other player captures all the seeds in its own side.
         Here, it was the first player's turn, and the second player has taken all the remaining seeds.`)]}}function y1(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),fa(),pa(2,"text",5),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),Qa(3),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("cx",50+100*n)("cy",50+120*r),Ts(1),ra("x",50+100*n)("y",66+120*r),Ts(1),Ja(" ",e," ")}}function v1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,y1,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let _1=(()=>{class e extends u1{constructor(e){super(e),this.last=Mw.empty(),this.captured=[],this.moved=[],this.scores=Mw.of([0,0]),this.rules=new p1(h1),this.availableMinimaxes=[new g1(this.rules,"AwaleMinimax")],this.encoder=f1.encoder,this.tutorial=(new m1).tutorial,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState;this.scores=Mw.of(e.getCapturedCopy()),this.hidePreviousMove();const t=this.rules.node.move;if(this.board=e.getCopiedBoard(),t.isPresent()){const n=e.getCurrentOpponent().value;this.last=Mw.of(new JX(t.get().x,n)),this.showPreviousMove()}else this.last=Mw.empty()}hidePreviousMove(){this.captured=[],this.moved=[]}showPreviousMove(){const e=this.rules.node.mother.get().gameState;for(let t=0;t<=1;t++)for(let n=0;n<=5;n++){const r=new JX(n,t),i=this.board[t][n],s=e.getPieceAt(r);this.last.equalsValue(r)||(i<s?this.captured.push(r):i>s&&this.moved.push(r))}}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(t!==n.rules.node.gameState.getCurrentPlayer().value)return n.cancelMove(d1.CANNOT_DISTRIBUTE_FROM_OPPONENT_HOME());n.last=Mw.empty();const i=f1.from(e);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}getSquareClasses(e,t){const n=new JX(e,t);return this.captured.some(e=>e.equals(n))?["captured"]:this.last.equalsValue(n)?["moved","highlighted"]:this.moved.some(e=>e.equals(n))?["moved"]:[]}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-awale-component"]],features:[Go],decls:4,vars:1,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-45 -20 700 260","preserveAspectRatio","xMidYMid meet"],["x","-40","y","-15","ry","115","rx","115","width","680","height","250","fill","blue",1,"base"],[4,"ngFor","ngForOf"],["x1","-40","y1","110","x2","640","y2","110",1,"base"],["r","46",1,"base",3,"id","ngClass","click"],[1,"text-big","text-center",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,v1,2,1,"g",2),ga(3,"line",3),fa()),2&e&&(Ts(2),ha("ngForOf",t.board))},directives:[tp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class C1 extends yJ{constructor(e,t){if(super(e.x,e.y),e.equals(t))throw new Error(lJ.MOVE_CANNOT_BE_STATIC());this.end=t}static getEncoder(e,t,n){return new class extends FK{constructor(){super(...arguments),this.shiftAX=t,this.shiftDY=this.shiftAX*e,this.shiftDX=this.shiftDY*t}maxValue(){return(e-1)*this.shiftDX+(t-1)*this.shiftDY+(e-1)*this.shiftAX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftDX+e.coord.y*this.shiftDY+e.end.x*this.shiftAX+e.end.y}decodeNumber(r){const i=r%t;r/=t;const s=new JX((r-=r%1)%e,i);r/=e;const o=(r-=r%1)%t;r/=t;const a=new JX((r-=r%1)%e,o);return n(a,s)}}}length(){return this.coord.getDistance(this.end)}getDirection(){return KX.factory.fromMove(this.coord,this.end)}}let E1=(()=>{class e{}return e.LANDING_ON_OCCUPIED_CASE=()=>$localize`You cannot land on an occupied square.`,e.THRONE_IS_LEFT_FOR_GOOD=()=>$localize`Once you left the central throne, you cannot return to it.`,e.SOLDIERS_CANNOT_SIT_ON_THRONE=()=>$localize`Soldiers cannot sit on the throne.`,e.MOVE_MUST_BE_ORTHOGONAL=()=>$localize`Tafl moves must be orthogonal.`,e})();class w1 extends C1{constructor(e,t){if(super(e,t),e.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Starting coord of TaflMove must be on the board, not at "+e.toString()+".");if(t.isNotInRange(this.getMaximalDistance(),this.getMaximalDistance()))throw new Error("Landing coord of TaflMove must be on the board, not at "+t.toString()+".");const n=e.getDirectionToward(t);if(n.isFailure()||n.get().isDiagonal())throw new Error(E1.MOVE_MUST_BE_ORTHOGONAL())}equals(e){return e===this||!1!==e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"TaflMove("+this.coord+"->"+this.end+")"}}class b1 extends w1{static of(e,t){return new b1(e,t)}static from(e,t){try{const n=new b1(e,t);return SW.success(n)}catch(n){return SW.failure(n.message)}}getMaximalDistance(){return 7}}b1.encoder=C1.getEncoder(7,7,b1.of);const S1={CASTLE_IS_LEFT_FOR_GOOD:!0,BORDER_CAN_SURROUND_KING:!1,CENTRAL_THRONE_CAN_SURROUND_KING:!0,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!0,WIDTH:7,INVADER:BK.ZERO};class P1{constructor(e,t){this.owner=e,this.king=t}isKing(){return this.king}getOwner(){return this.owner}}P1.UNOCCUPIED=new P1(VK.NONE,!1),P1.PLAYER_ONE_KING=new P1(BK.ONE,!0),P1.INVADERS=new P1(BK.ZERO,!1),P1.DEFENDERS=new P1(BK.ONE,!1);class O1{constructor(e){this.value=e}}O1.NONE=new O1("NONE"),O1.OPPONENT=new O1("OPPONENT"),O1.PLAYER=new O1("PLAYER");class T1 extends fJ{isCentralThrone(e){return e.equals(this.getCentralThrone())}getCentralThrone(){const e=(this.board.length-1)/2;return new JX(e,e)}getRelativeOwner(e,t){const n=this.getAbsoluteOwner(t);let r;return r=n===VK.NONE?O1.NONE:e===n?O1.PLAYER:O1.OPPONENT,r}getAbsoluteOwner(e){return this.getPieceAt(e).getOwner()}}class I1 extends T1{static getInitialState(){const e=P1.UNOCCUPIED,t=P1.INVADERS,n=P1.DEFENDERS;return new I1([[e,e,e,t,e,e,e],[e,e,e,t,e,e,e],[e,e,e,n,e,e,e],[t,t,n,P1.PLAYER_ONE_KING,n,t,t],[e,e,e,n,e,e,e],[e,e,e,t,e,e,e],[e,e,e,t,e,e,e]],0)}from(e,t){return new I1(e,t)}}let k1=(()=>{class e extends PJ{constructor(e,t,n){super(e),this.config=t,this.generateMove=n}isLegal(t,n){Tw(e.VERBOSE,{tablutRules_isLegal:{move:t,state:n}});const r=n.getCurrentPlayer(),i=this.getMoveValidity(r,t,n);return i.isFailure()?SW.failure(i.getReason()):SW.success(void 0)}getMoveValidity(e,t,n){const r=n.getRelativeOwner(e,t.coord);if(r===O1.NONE)return TW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE());if(r===O1.OPPONENT)return TW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(n.getRelativeOwner(e,t.end)!==O1.NONE)return TW.failure(E1.LANDING_ON_OCCUPIED_CASE());if(this.isThrone(n,t.end)){if(!n.getPieceAt(t.coord).isKing())return TW.failure(E1.SOLDIERS_CANNOT_SIT_ON_THRONE());if(n.isCentralThrone(t.end)&&this.config.CASTLE_IS_LEFT_FOR_GOOD)return TW.failure(E1.THRONE_IS_LEFT_FOR_GOOD())}const i=t.coord.getDirectionToward(t.end).get(),s=t.coord.getOrthogonalDistance(t.end);let o=t.coord.getNext(i);for(let a=1;a<s;a++){if(n.getPieceAt(o)!==P1.UNOCCUPIED)return TW.failure(lJ.SOMETHING_IN_THE_WAY());o=o.getNext(i)}return TW.SUCCESS}isThrone(e,t){return!!this.isExternalThrone(t)||e.isCentralThrone(t)}isExternalThrone(e){const t=this.config.WIDTH-1;return!(0!==e.x&&e.x!==t||0!==e.y&&e.y!==t)}tryCapture(e,t,n,r){const i=t.getNext(n);return i.isInRange(this.config.WIDTH,this.config.WIDTH)&&r.getRelativeOwner(e,i)===O1.OPPONENT?r.getPieceAt(i).isKing()?this.captureKing(e,t,n,r):this.capturePawn(e,t,n,r):Mw.empty()}captureKing(e,t,n,r){const i=t.getNext(n),{backCoord:s,back:o,backInRange:a,left:l,leftCoord:c,right:u,rightCoord:h}=this.getSurroundings(i,n,e,r);return!1===a?this.captureKingAgainstTheWall(l,u,i):o===O1.NONE&&this.isThrone(r,s)?this.captureKingAgainstThrone(s,i,l,u):o===O1.PLAYER?this.captureKingWithAtLeastASandwich(r,i,l,c,u,h):Mw.empty()}getSurroundings(e,t,n,r){const i=e.getNext(t),s=i.isInRange(this.config.WIDTH,this.config.WIDTH),o=s?r.getRelativeOwner(n,i):O1.NONE,a=e.getLeft(t),l=a.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,a):O1.NONE,c=e.getRight(t),u=c.isInRange(this.config.WIDTH,this.config.WIDTH)?r.getRelativeOwner(n,c):O1.NONE;return{backCoord:i,back:o,backInRange:s,leftCoord:a,left:l,rightCoord:c,right:u}}captureKingAgainstTheWall(t,n,r){let i=t===O1.PLAYER?1:0;return i+=n===O1.PLAYER?1:0,2===i&&this.config.BORDER_CAN_SURROUND_KING?(Tw(e.VERBOSE||!1,"king captured by 3 invaders against 1 border"),Mw.of(r)):Mw.empty()}captureKingAgainstThrone(e,t,n,r){if(this.isExternalThrone(e)){if(this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return Mw.of(t)}else{const e=r===O1.PLAYER,i=n===O1.PLAYER||e;if(this.config.CENTRAL_THRONE_CAN_SURROUND_KING&&i)return Mw.of(t)}return Mw.empty()}capturePawn(t,n,r,i){const s=!1,o=n.getNext(r),a=o.getNext(r);let l=O1.NONE;return a.isInRange(this.config.WIDTH,this.config.WIDTH)&&(l=i.getRelativeOwner(t,a)),l===O1.NONE?!1===this.isThrone(i,a)?(Tw(e.VERBOSE||s,"cannot capture a pawn without an ally; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")cannot capture a pawn without an ally behind"),Mw.empty()):(Tw(e.VERBOSE||s,"pawn captured by 1 opponent and 1 throne; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.of(o)):l===O1.PLAYER?(Tw(e.VERBOSE||s,"pawn captured by 2 opponents; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.of(o)):(Tw(e.VERBOSE||s,"no captures; "+o+"threatened by "+t+"'s pawn in  "+n+" coming from this direction ("+r.x+", "+r.y+")"),Mw.empty())}captureKingWithAtLeastASandwich(t,n,r,i,s,o){if(!1===this.kingTouchCentralThrone(t,n)&&this.config.KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED)return Mw.of(n);const a=this.config.CENTRAL_THRONE_CAN_SURROUND_KING,l=this.isThrone(t,i),c=r===O1.PLAYER||l&&a,u=this.isThrone(t,o);return c&&(s===O1.PLAYER||u&&a)?(Tw(e.VERBOSE||!1,"king captured by 4 invaders"),Mw.of(n)):Mw.empty()}kingTouchCentralThrone(e,t){const n=e.getCentralThrone();return t.getOrthogonalDistance(n)<=1}applyLegalMove(t,n){Tw(e.VERBOSE,{TablutRules_applyLegalMove:{move:t,state:n}});const r=n.turn,i=n.getCopiedBoard(),s=n.getCurrentPlayer(),o=t.coord,a=t.end;i[a.y][a.x]=i[o.y][o.x],i[o.y][o.x]=P1.UNOCCUPIED;for(const e of QX.ORTHOGONALS){const r=this.tryCapture(s,t.end,e,n);r.isPresent()&&(i[r.get().y][r.get().x]=P1.UNOCCUPIED)}return n.from(i,r+1)}getGameStatus(e){const t=this.getWinner(e.gameState);return t.isPresent()?SJ.getVictory(t.get()):SJ.ONGOING}getWinner(e){const t=!1,n=this.getKingCoord(e);if(n.isAbsent())return Tw(t,"The king is dead, victory to invader"),Mw.of(this.getInvader());const r=n.get();return this.isExternalThrone(r)?(Tw(t,"The king escape, victory to defender"),Mw.of(this.getDefender())):this.isPlayerImmobilized(BK.ZERO,e)?(Tw(t,"Zero has no move, victory to one"),Mw.of(BK.ONE)):this.isPlayerImmobilized(BK.ONE,e)?(Tw(t,"One has no move, victory to zero"),Mw.of(BK.ZERO)):(Tw(t,"no victory"),Mw.empty())}getKingCoord(t){Tw(e.VERBOSE,{TablutRules_getKingCoord:{state:t,con:this.config}});for(let e=0;e<this.config.WIDTH;e++)for(let n=0;n<this.config.WIDTH;n++)if(t.getPieceAtXY(n,e).isKing())return Mw.of(new JX(n,e));return Mw.empty()}getInvader(){return this.config.INVADER}getDefender(){return this.config.INVADER.getOpponent()}isPlayerImmobilized(e,t){return 0===this.getPlayerListMoves(e,t).length}getPlayerListMoves(t,n){const r=[],i=this.getPlayerListPawns(t,n);Tw(e.VERBOSE||!1,{TablutRules_getPlayerListMoves:{player:t,state:n}});for(const e of i){const t=this.getPossibleDestinations(e,n);for(const n of t){const t=this.generateMove(e,n);r.push(t)}}return r}getPlayerListPawns(e,t){const n=[];for(let r=0;r<this.config.WIDTH;r++)for(let i=0;i<this.config.WIDTH;i++){const s=new JX(i,r);t.getAbsoluteOwner(s)===e&&n.push(s)}return n}getPossibleDestinations(e,t){const n=[];let r;for(const i of QX.ORTHOGONALS){r=e.getNext(i,1);let s=!1;for(;r.isInRange(this.config.WIDTH,this.config.WIDTH)&&!1===s;)t.getAbsoluteOwner(r)===VK.NONE?this.isExternalThrone(r)?t.getPieceAt(e).isKing()&&n.push(r):t.isCentralThrone(r)?t.getPieceAt(e).isKing()&&!1===this.config.CASTLE_IS_LEFT_FOR_GOOD&&n.push(r):n.push(r):s=!0,r=r.getNext(i,1)}return n}}return e.VERBOSE=!1,e})();class A1 extends k1{constructor(){super(I1,S1,b1.of)}static get(){return null==A1.singleton&&(A1.singleton=new A1),bJ.ruler=this.singleton,A1.singleton}}class M1 extends u1{constructor(e,t,n){super(e),this.VERBOSE=t,this.generateMove=n,this.viewInfo={pieceClasses:[]},this.EMPTY=P1.UNOCCUPIED,this.captureds=[],this.chosen=new JX(-1,-1),this.lastMove=Mw.empty()}getViewBox(){const e=-this.STROKE_WIDTH,t=this.rules.config.WIDTH*this.SPACE_SIZE+2*this.STROKE_WIDTH;return e+" "+e+" "+t+" "+t}updateBoard(){Tw(this.VERBOSE,"taflComponent.updateBoard"),this.lastMove=this.rules.node.move,this.board=this.rules.node.gameState.getCopiedBoard(),this.captureds=[],this.lastMove.isPresent()&&this.showPreviousMove(),this.updateViewInfo()}showPreviousMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState.getCurrentOpponent();for(const n of QX.ORTHOGONALS){const r=this.lastMove.get().end.getNext(n,1);if(r.isInRange(this.rules.config.WIDTH,this.rules.config.WIDTH)){const n=e.getRelativeOwner(t,r)===O1.OPPONENT,i=this.rules.node.gameState.getPieceAt(r)===P1.UNOCCUPIED;n&&i&&this.captureds.push(r)}}}updateViewInfo(){const e=[];for(let t=0;t<this.board.length;t++){const n=[];for(let e=0;e<this.board[0].length;e++){let r=[];r=this.board[t][e].getOwner()===VK.NONE?[""]:this.getPieceClasses(e,t),n.push(r)}e.push(n)}this.viewInfo={pieceClasses:e}}onClick(e,t){var n=this;return Pw(function*(){Tw(n.VERBOSE,"TaflComponent.onClick("+e+", "+t+")");const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):-1===n.chosen.x?n.choosePiece(e,t):n.chooseDestination(e,t)})()}chooseDestination(e,t){var n=this;return Pw(function*(){Tw(n.VERBOSE,"TaflComponent.chooseDestination");const r=n.chosen,i=new JX(e,t),s=n.generateMove(r,i);return s.isSuccess()?(n.cancelMove(),yield n.chooseMove(s.get(),n.rules.node.gameState)):n.cancelMove(s.getReason())})()}choosePiece(e,t){return Tw(this.VERBOSE,"TaflComponent.choosePiece"),this.board[t][e]===P1.UNOCCUPIED?this.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE()):this.pieceBelongToCurrentPlayer(e,t)?(this.chosen=new JX(e,t),this.updateViewInfo(),Tw(this.VERBOSE,"selected piece = ("+e+", "+t+")"),TW.SUCCESS):this.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE())}pieceBelongToCurrentPlayer(e,t){const n=this.rules.node.gameState,r=n.getCurrentPlayer(),i=new JX(e,t);return n.getRelativeOwner(r,i)===O1.PLAYER}cancelMoveAttempt(){this.chosen=new JX(-1,-1)}isThrone(e,t){return this.rules.isThrone(this.rules.node.gameState,new JX(e,t))}isCentralThrone(e,t){return!1===this.rules.node.gameState.isCentralThrone(new JX(e,t))}getPieceClasses(e,t){const n=[],r=new JX(e,t),i=this.rules.node.gameState.getAbsoluteOwner(r);return n.push(this.getPlayerClass(i)),this.chosen.equals(r)&&n.push("selected"),n}getRectClasses(e,t){const n=[],r=new JX(e,t);if(this.captureds.some(e=>e.equals(r)))n.push("captured");else if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;(r.equals(e)||r.equals(t))&&n.push("moved")}return n}getClickables(){const e=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[t].length;n++)this.isClickable(n,t)&&e.push(new JX(n,t));return e}isClickable(e,t){return this.pieceBelongToCurrentPlayer(e,t)}isInvader(e,t){return this.board[t][e]===P1.INVADERS}isKing(e,t){return this.board[t][e].isKing()}}class N1 extends cJ{getListMoves(e){Tw(!1,{TaflMinimax_getListMoves:{node:e}});const t=e.gameState,n=t.getCurrentPlayer(),r=this.ruler.getPlayerListMoves(n,t);return this.orderMoves(t,r)}orderMoves(e,t){const n=this.ruler.getKingCoord(e).get();return e.getCurrentPlayer()===this.ruler.config.INVADER?GK.sortByDescending(t,e=>-e.end.getOrthogonalDistance(n)):GK.sortByDescending(t,e=>e.coord.equals(n)?this.ruler.isExternalThrone(e.end)?2:1:0),t}getBoardValue(e){const t=e.gameState,n=this.ruler.getWinner(t);if(n.isPresent())return new uJ(n.get().getVictoryValue());const r=this.ruler.getPlayerListPawns(BK.ZERO,t).length,i=this.ruler.getPlayerListPawns(BK.ONE,t).length;let s=[1,2][this.ruler.config.INVADER.value];s*=BK.ZERO.getScoreModifier();let o=[2,1][this.ruler.config.INVADER.value];return o*=BK.ONE.getScoreModifier(),new uJ(r*s+i*o)}}class R1{constructor(e,t){this.directThreats=e,this.mover=t}equals(e){return e.directThreats.equals(this.directThreats)&&e.mover.equals(this.mover)}}class x1 extends R1{constructor(e,t){super(new dJ([e]),t),this.directThreat=e,this.mover=t}}class D1 extends dJ{constructor(e){if(super(),this.map=[],this.values=[],void 0!==e)for(const t of e)this.add(t)}add(e){const t=this.toFields(e);let n=this.map;for(const i of t[0])void 0===n[i]&&(n[i]=[]),n=n[i];const r=t[1];return void 0===n[r]&&(n[r]=!0,this.values.push(e),!0)}contains(e){const t=this.toFields(e);let n=this.map;for(const r of t[0]){if(void 0===n[r])return!1;n=n[r]}return void 0!==n[t[1]]}[Symbol.iterator](){return this.values.values()}}class L1 extends D1{toFields(e){return[[e.y],e.x]}}class F1 extends N1{constructor(e,t){super(e,t),this.width=this.ruler.config.WIDTH,this.maxInfluence=16*(2*this.width-2),this.scoreByThreatenedPiece=16*this.maxInfluence+1,this.scoreBySafePiece=16*this.scoreByThreatenedPiece+1}getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState,r=P1.UNOCCUPIED;let i=0;const s=this.getPiecesMap(n),o=this.getThreatMap(n,s),a=this.filterThreatMap(o,n);for(const l of BK.PLAYERS)for(const e of s.get(l).get())if(a.get(e).isPresent())i+=l.getScoreModifier()*this.scoreByThreatenedPiece;else{i+=l.getScoreModifier()*this.scoreBySafePiece;let t=0;for(const i of QX.ORTHOGONALS){let s=e.getNext(i,1);for(;s.isInRange(this.width,this.width)&&n.getPieceAt(s)===r;)t++,s=s.getNext(i,1)}i+=t*l.getScoreModifier()}return new uJ(i)}getPiecesMap(e){const t=P1.UNOCCUPIED,n=[],r=[];for(let i=0;i<this.width;i++)for(let s=0;s<this.width;s++){const o=new JX(s,i);e.getPieceAt(o)!==t&&(e.getAbsoluteOwner(o)===BK.ZERO?n.push(o):r.push(o))}return new CJ([{key:BK.ZERO,value:new L1(n)},{key:BK.ONE,value:new L1(r)}])}getThreatMap(e,t){const n=new CJ;for(const r of BK.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreats(i,e);this.isThreatReal(i,e,t)&&n.set(i,new dJ(t))}return n}getThreats(e,t){const n=t.getAbsoluteOwner(e);NW(n.isPlayer(),"TaflPieceAndInfluenceMinimax.getThreats should be called with an occupied coordinate");const r=n.getOpponent(),i=[];for(const s of QX.ORTHOGONALS){const n=e.getPrevious(s,1);if(this.isAThreat(n,t,r)){const o=[];for(const n of QX.ORTHOGONALS){if(n===s.getOpposite())continue;let i=e.getNext(s,1);for(;i.isInRange(this.width,this.width)&&t.getPieceAt(i)===P1.UNOCCUPIED;)i=i.getNext(n);i.isInRange(this.width,this.width)&&t.getAbsoluteOwner(i)===r&&!1===e.getNext(s,1).equals(i)&&o.push(i)}i.push(new x1(n,new L1(o)))}}return i}isAThreat(e,t,n){return!(e.isNotInRange(this.width,this.width)||t.getAbsoluteOwner(e)!==n&&(!this.ruler.isThrone(t,e)||n!==BK.ONE&&t.getPieceAt(e)!==P1.UNOCCUPIED))}isThreatReal(e,t,n){if(0===n.length)return!1;if(t.getPieceAt(e).isKing())return 3===n.length;for(const r of n)if(r.mover.size()>0)return!0;return!1}filterThreatMap(e,t){const n=new CJ,r=e.listKeys(),i=r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentPlayer()),s=new L1(r.filter(e=>t.getAbsoluteOwner(e)===t.getCurrentOpponent()));for(const o of i){const t=e.get(o).get(),r=[];for(const e of t)if(!1===s.contains(e.directThreat)){const t=[];for(const n of e.mover)!1===s.contains(n)&&t.push(n);t.length>0&&r.push(new x1(e.directThreat,new L1(t)))}r.length>0&&n.set(o,new dJ(r))}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}class U1 extends F1{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=P1.UNOCCUPIED;let s=0;const o=this.getPiecesMap(n),a=this.getThreatMap(n,o),l=this.filterThreatMap(a,n);for(const c of BK.PLAYERS){const e=new L1;for(const t of o.get(c).get())if(l.get(t).isPresent())s+=c.getScoreModifier()*U1.SCORE_BY_THREATENED_PIECE;else{s+=c.getScoreModifier()*U1.SCORE_BY_SAFE_PIECE;for(const s of QX.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=U1.CONTROL_VALUE[t.y][t.x];s+=c.getScoreModifier()*e}}return new uJ(s)}}U1.SCORE_BY_THREATENED_PIECE=530,U1.SCORE_BY_SAFE_PIECE=16*U1.SCORE_BY_THREATENED_PIECE+1,U1.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];class B1 extends U1{getBoardValue(e){const t=this.ruler.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState,r=this.ruler.config.WIDTH,i=P1.UNOCCUPIED;let s=0,o=0,a=0;const l=this.getPiecesMap(n),c=this.getThreatMap(n,l),u=this.filterThreatMap(c,n);for(const d of BK.PLAYERS){const e=new L1;for(const t of l.get(d).get())if(u.get(t).isPresent())o+=d.getScoreModifier();else{s+=d.getScoreModifier();for(const s of QX.ORTHOGONALS){let o=t.getNext(s,1);for(;o.isInRange(r,r)&&n.getPieceAt(o)===i;)e.add(o),o=o.getNext(s,1)}}for(const t of e){const e=U1.CONTROL_VALUE[t.y][t.x];a+=d.getScoreModifier()*e}}const h=this.getStepForEscape(n);return new uJ(531*h*17*17+531*s*17+531*o+a)}getStepForEscape(e){const t=this.ruler.getKingCoord(e).get();return this._getStepForEscape(e,1,[t],[]).getOrElse(Number.MAX_SAFE_INTEGER)}_getStepForEscape(e,t,n,r){const i=this.getNextGen(e,n,r);return 0===i.length?Mw.empty():i.some(e=>this.ruler.isExternalThrone(e))?Mw.of(t):(t++,r.push(...i),this._getStepForEscape(e,t,i,r))}getNextGen(e,t,n){const r=[];for(const i of t)for(const t of QX.ORTHOGONALS){let s=i.getNext(t,1);for(;s.isInRange(this.ruler.config.WIDTH,this.ruler.config.WIDTH)&&e.getPieceAt(s)===P1.UNOCCUPIED;)n.every(e=>!1===e.equals(s))&&r.push(s),s=s.getNext(t,1)}return r}}B1.SCORE_BY_THREATENED_PIECE=530,B1.SCORE_BY_SAFE_PIECE=16*U1.SCORE_BY_THREATENED_PIECE+1,B1.CONTROL_VALUE=[[64,8,8,8,8,8,8,8,64],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[8,1,1,1,1,1,1,1,8],[64,8,8,8,8,8,8,8,64]];const V1=P1.UNOCCUPIED,$1=P1.INVADERS,z1=P1.DEFENDERS,H1=P1.PLAYER_ONE_KING;class G1{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`Brandhub is the Irish version of the family of viking strategy game called Tafl. The goal of the game is different for each player. The attacker plays first. Their pieces (dark) are close to the edges. Their goal is to capture the king, which is in the center of the board. The defender plays second. Their pieces (light) are in the middle. Their goal is to move the king on one of the 4 thrones in the corners. Note that the square in which the king starts, in the center of the board, is also a throne.`,I1.getInitialState()),kJ.anyMove($localize`Moving`,$localize`All pieces move the same way. Similarly to a rook in chess, a piece can move: <ol><li>By as many squares as you want.</li><li>Without going over another piece or stopping on another piece.</li><li>Horizontally or vertically.</li><li>Only the king can land on a corner throne.</li><li>Once the king left his central throne, he can't go back on it, nor can the other pieces.</li></ol>To move a piece, click on it and then on its landing square.<br/><br/>You're playing Dark, do the first move.`,I1.getInitialState(),b1.of(new JX(3,1),new JX(1,1)),$localize`Congratulations!`),kJ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new I1([[V1,V1,V1,$1,V1,V1,V1],[V1,V1,V1,$1,V1,V1,V1],[$1,V1,V1,z1,V1,V1,V1],[V1,V1,z1,H1,z1,$1,$1],[V1,V1,$1,V1,V1,V1,V1],[V1,V1,V1,z1,V1,$1,V1],[V1,V1,V1,$1,V1,V1,V1]],1),[b1.of(new JX(3,5),new JX(2,5))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),kJ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new I1([[V1,V1,V1,$1,V1,V1,V1],[V1,V1,$1,V1,V1,V1,V1],[V1,V1,V1,z1,V1,V1,V1],[$1,z1,V1,V1,z1,$1,$1],[V1,z1,V1,V1,V1,V1,V1],[V1,$1,V1,H1,V1,$1,V1],[V1,V1,V1,$1,V1,V1,V1]],12),[b1.of(new JX(2,1),new JX(3,1)),b1.of(new JX(3,0),new JX(3,1))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),kJ.fromMove($localize`Capturing the king on his throne`,$localize`To capture the king when he sits on his throne, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.<br/><br/>Capture the king.`,new I1([[V1,V1,V1,V1,V1,V1,V1],[V1,V1,V1,z1,V1,V1,V1],[V1,V1,V1,$1,V1,V1,V1],[V1,$1,V1,H1,$1,V1,V1],[V1,V1,V1,$1,V1,V1,V1],[V1,z1,V1,V1,V1,V1,V1],[V1,V1,V1,V1,V1,V1,V1]],72),[b1.of(new JX(1,3),new JX(2,3))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),kJ.fromMove($localize`Capturing the king next to his throne`,$localize`Another way to capture the king is to use three soldier plus the central throne to surround the king on four sides.<br/><br/>Capture the king.`,new I1([[V1,V1,$1,V1,V1,V1,V1],[V1,V1,V1,$1,V1,V1,V1],[V1,V1,V1,H1,$1,V1,V1],[V1,$1,z1,V1,z1,V1,V1],[V1,V1,V1,$1,V1,V1,V1],[V1,V1,V1,V1,V1,V1,V1],[V1,V1,V1,V1,V1,V1,V1]],72),[b1.of(new JX(2,0),new JX(2,2))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`),kJ.fromMove($localize`Capturing the king far from his throne`,$localize`When the king is not on his central throne nor next to it, he can be captured like a soldier.<br/><br/>Capture the king.`,new I1([[V1,V1,V1,V1,V1,V1,V1],[V1,V1,V1,V1,V1,V1,V1],[V1,$1,V1,$1,V1,V1,V1],[$1,V1,V1,V1,z1,V1,V1],[V1,V1,V1,z1,V1,V1,V1],[V1,V1,V1,V1,V1,V1,V1],[V1,H1,V1,$1,V1,V1,V1]],72),[b1.of(new JX(3,6),new JX(2,6))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function W1(e,t){1&e&&(Cn(),ga(0,"polyline",8))}function q1(e,t){1&e&&(Cn(),ga(0,"polyline",9))}function j1(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,W1,1,0,"polyline",6),la(2,q1,1,0,"ng-template",null,7,Ku),fa()),2&e){const e=ca(3),t=Sa().index,n=Sa().index,r=Sa();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function Z1(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10),ga(4,"line",10),ga(5,"line",10),fa()),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.1*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.9*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.15*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.85*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE)}}function Y1(e,t){if(1&e&&(Cn(),ga(0,"polyline",15)),2&e){const e=Sa(3).index,t=Sa().index;ha("ngClass",Sa().viewInfo.pieceClasses[t][e])}}function K1(e,t){if(1&e&&(Cn(),ga(0,"line",10),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10)),2&e){const e=Sa(3).index,t=Sa().index,n=Sa();ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.04*n.SPACE_SIZE)("y1",.5*n.SPACE_SIZE)("x2",.96*n.SPACE_SIZE)("y2",.5*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.2*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.8*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.8*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.2*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE)}}function Q1(e,t){if(1&e&&(Cn(),la(0,Y1,1,1,"polyline",13),la(1,K1,4,20,"ng-template",null,14,Ku)),2&e){const e=ca(2),t=Sa(2).index,n=Sa().index;ha("ngIf",Sa().isKing(t,n))("ngIfElse",e)}}function X1(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",10),la(2,Z1,6,25,"g",11),la(3,Q1,3,2,"ng-template",null,12,Ku),fa()),2&e){const e=ca(4),t=Sa().index,n=Sa().index,r=Sa();Ts(1),ha("ngClass",r.viewInfo.pieceClasses[n][t]),ra("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)("cx",.5*r.SPACE_SIZE)("cy",.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function J1(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),ga(1,"rect",4),la(2,j1,4,2,"g",5),la(3,X1,5,6,"g",5),fa()}if(2&e){const e=t.index,n=Sa().index,r=Sa();Ia("id","click_",e,"_",n,""),ra("transform","translate("+r.SPACE_SIZE*e+", "+r.SPACE_SIZE*n+")"),Ts(1),ha("ngClass",r.getRectClasses(e,n)),ra("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function e0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,J1,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function t0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",16),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let n0=(()=>{class e extends M1{constructor(e){super(e,!1,b1.from),this.rules=A1.get(),this.availableMinimaxes=[new N1(this.rules,"DummyBot"),new F1(this.rules,"Piece > Influence"),new U1(this.rules,"Piece > Control"),new B1(this.rules,"Escape > Piece > Control")],this.encoder=b1.encoder,this.tutorial=(new G1).tutorial}ngOnInit(){this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-brandhub"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,e0,2,1,"g",1),la(2,t0,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[tp,Jd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),r0=(()=>{class e extends eJ{constructor(){super(...arguments),this.SPACE_SIZE=50}getTriangleCornerCoords(e,t){return(e+t)%2==1?this.getDownwardCoordinate(e,t):this.getUpwardCoordinate(e,t)}getTriangleCoordinate(e,t){return this.getTriangleCornerCoords(e,t).map(e=>e.x+","+e.y).reduce((e,t)=>e+","+t)}getDownwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new JX(.5*this.SPACE_SIZE*e,i);return[o,new JX(n,s),new JX(r,i),o]}getUpwardCoordinate(e,t){const n=.5*this.SPACE_SIZE*(e+1),r=.5*this.SPACE_SIZE*(e+2),i=this.SPACE_SIZE*t,s=this.SPACE_SIZE*(t+1),o=new JX(.5*this.SPACE_SIZE*e,s);return[o,new JX(n,i),new JX(r,s),o]}getPyramidCoordinate(e,t){return(e+t)%2==1?this.getDownwardPyramidCoordinate(e,t):this.getUpwardPyramidCoordinate(e,t)}getDownwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=this.SPACE_SIZE*t,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r+this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}getUpwardPyramidCoordinate(e,t){const n=this.SPACE_SIZE*e/2,r=(t+1)*this.SPACE_SIZE,i=n+", "+r,s=n+this.SPACE_SIZE+", "+r,o=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE),a=n+this.SPACE_SIZE/2+", "+(r-this.SPACE_SIZE/2);return i+","+o+","+a+","+i+","+a+","+s+","+i+","+s+","+o+","+a+","+s}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=tr(e)))(n||e)}}(),e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],features:[Go],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),i0=(()=>{class e{}return e.INVALID_DISTANCE=()=>$localize`Your piece must land on one of the closest six triangles with the same color as the triangle on which the piece is.`,e.NOT_ENOUGH_TILES_TO_EXCHANGE=()=>$localize`You do not have enough tiles to exchange in order to capture this piece. Pick one of your piece and move it.`,e.FIRST_CLICK_SHOULD_NOT_BE_NULL=()=>$localize`Your first click must be on the piece that you want to move, or on a piece of your opponent that you want to exchange against two tiles.`,e.CANNOT_CAPTURE_FROM_EMPTY=()=>$localize`You cannot capture from an empty space.`,e.CANNOT_CAPTURE_OWN_PIECES=()=>$localize`You cannot capture your own pieces.`,e})();class s0{constructor(e,t){this.direction=e,this.str=t}static fromCoords(e,t){const n=e.getVectorToward(t),r=s0.STEPS.findIndex(e=>e.direction.equals(n));if(-1===r)throw new Error(i0.INVALID_DISTANCE());return s0.STEPS[r]}toInt(){return s0.STEPS.findIndex(e=>e.direction.equals(this.direction))}equals(e){return this===e}toString(){return this.str}}s0.LEFT=new s0(new jX(-2,0),"LEFT"),s0.UP_LEFT=new s0(KX.UP_LEFT,"UP_LEFT"),s0.UP_RIGHT=new s0(KX.UP_RIGHT,"UP_RIGHT"),s0.RIGHT=new s0(new jX(2,0),"RIGHT"),s0.DOWN_LEFT=new s0(KX.DOWN_LEFT,"DOWN_LEFT"),s0.DOWN_RIGHT=new s0(KX.DOWN_RIGHT,"DOWN_RIGHT"),s0.STEPS=[s0.LEFT,s0.UP_LEFT,s0.UP_RIGHT,s0.RIGHT,s0.DOWN_LEFT,s0.DOWN_RIGHT];class o0 extends mJ{constructor(e,t,n,r){super(),this.start=e,this.step=t,this.landingCoord=n,this.capture=r}static fromMovement(e,t){if(e.isNotInRange(15,10))throw new Error("Starting coord cannot be out of range (width: 15, height: 10).");const n=new JX(e.x+t.direction.x,e.y+t.direction.y);if(n.isNotInRange(15,10))throw new Error("Landing coord cannot be out of range (width: 15, height: 10).");return new o0(Mw.of(e),Mw.of(t),Mw.of(n),Mw.empty())}static fromTilesExchange(e){if(e.isNotInRange(15,10))throw new Error("Captured coord cannot be out of range (width: 15, height: 10).");return new o0(Mw.empty(),Mw.empty(),Mw.empty(),Mw.of(e))}static fromCoordToCoord(e,t){const n=s0.fromCoords(e,t);return o0.fromMovement(e,n)}isTileExchange(){return this.capture.isPresent()}toString(){return this.isTileExchange()?"CoerceoMove("+this.capture.get().toString()+")":"CoerceoMove("+this.start.get().toString()+" > "+this.step.get().toString()+" > "+this.landingCoord.get().toString()+")"}equals(e){return!(!this.capture.equals(e.capture)||!this.start.equals(e.start)||!this.step.equals(e.step))}}o0.encoder=new class extends FK{maxValue(){return 1035}encodeNumber(e){if(e.isTileExchange()){const t=e.capture.get().y;return 10*e.capture.get().x+t}{const t=e.start.get().y,n=e.start.get().x;return 150*(e.step.get().toInt()+1)+10*n+t}}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%10,n=(e=(e-t)/10)%15;return 0==(e=(e-n)/15)?o0.fromTilesExchange(new JX(n,t)):o0.fromMovement(new JX(n,t),s0.STEPS[e-1])}};class a0{static getNeighbors(e){let t;const n=new JX(e.x-1,e.y),r=new JX(e.x+1,e.y);return t=(e.x+e.y)%2==1?[n,r,new JX(e.x,e.y-1)]:[n,r,new JX(e.x,e.y+1)],t}static getFakeNeighbors(e){return new JX(e.x,(e.x+e.y)%2==1?e.y+1:e.y-1)}static getCommonNeighbor(e,t){const n=a0.getNeighbors(e),r=a0.getNeighbors(t);let i=0;for(;i<n.length;){const e=n[i];let t=0;for(;t<r.length;){if(e.equals(r[t]))return Mw.of(e);t++}i++}return Mw.empty()}}class l0 extends fJ{static getEmptyNeighbors(e,t,n){const r=[];for(const i of a0.getNeighbors(t))i.isInRange(e[0].length,e.length)&&e[i.y][i.x]===n&&r.push(i);return r}getEmptyNeighboors(e,t){return l0.getEmptyNeighbors(this.board,e,t)}}class c0 extends l0{constructor(e,t,n,r){super(e,t),this.tiles=n,this.captures=r}static getTilesUpperLeftCoord(e){const t=e.x-e.x%3;let n=e.y;return n-=t%2==0?e.y%2:(e.y+1)%2,new JX(t,n)}static getPresentNeighboorEntrances(e){return[new JX(e.x+1,e.y-1),new JX(e.x+3,e.y+0),new JX(e.x+3,e.y+1),new JX(e.x+1,e.y+2),new JX(e.x-1,e.y+1),new JX(e.x-1,e.y+0)].filter(c0.isInRange)}static getInitialState(){const e=nJ.EMPTY,t=nJ.UNREACHABLE,n=nJ.ZERO,r=nJ.ONE;return new c0([[t,t,t,t,t,t,n,e,n,t,t,t,t,t,t],[t,t,t,e,e,n,e,e,e,n,e,e,t,t,t],[e,r,e,r,e,e,n,e,n,e,e,r,e,r,e],[r,e,e,e,r,e,e,e,e,e,r,e,e,e,r],[e,r,e,r,e,e,e,e,e,e,e,r,e,r,e],[e,n,e,n,e,e,e,e,e,e,e,n,e,n,e],[n,e,e,e,n,e,e,e,e,e,n,e,e,e,n],[e,n,e,n,e,e,r,e,r,e,e,n,e,n,e],[t,t,t,e,e,r,e,e,e,r,e,e,t,t,t],[t,t,t,t,t,t,r,e,r,t,t,t,t,t,t]],0,[0,0],[0,0])}applyLegalMovement(e){Tw(c0.VERBOSE,{coerceoState_applyLegalMovement:{object:this,move:e}});const t=e.start.get(),n=e.landingCoord.get(),r=this.getCopiedBoard();return r[n.y][n.x]=nJ.ofPlayer(this.getCurrentPlayer()),r[t.y][t.x]=nJ.EMPTY,new c0(r,this.turn,this.tiles,this.captures)}doMovementCaptures(e){Tw(c0.VERBOSE,{coerceoState_doMovementCaptures:{object:this,move:e}});const t=this.getCapturedNeighbors(e.landingCoord.get());let n=this;for(const r of t)n=n.capture(r);return n}getCapturedNeighbors(e){const t=this.getCurrentOpponent();return a0.getNeighbors(e).filter(e=>!e.isNotInRange(15,10)&&!!this.getPieceAt(e).is(t)&&this.isSurrounded(e))}isSurrounded(e){return 0===this.getEmptyNeighboors(e,nJ.EMPTY).length}capture(e){Tw(c0.VERBOSE,{coerceoState_captureIfNeeded:{object:this,coord:e}});const t=this.getCopiedBoard(),n=[this.captures[0],this.captures[1]];return Tw(c0.VERBOSE,e.toString()+" has been captured"),t[e.y][e.x]=nJ.EMPTY,n[this.getCurrentPlayer().value]+=1,new c0(t,this.turn,this.tiles,n)}removeTilesIfNeeded(e,t){Tw(c0.VERBOSE,{coerceoState_removeTilesIfNeeded:{object:this,tile:e,countTiles:t}});let n=this;const r=c0.getTilesUpperLeftCoord(e);if(this.isTileEmpty(r)&&this.isDeconnectable(r)){n=this.deconnectTile(r,t);const e=c0.getPresentNeighboorEntrances(r);for(const r of e){const e=n.getPieceAt(r);e===nJ.EMPTY?n=n.removeTilesIfNeeded(r,t):e.is(this.getCurrentOpponent())&&n.isSurrounded(r)&&(n=n.capture(r))}}return n}isTileEmpty(e){NW(this.getPieceAt(e)!==nJ.UNREACHABLE,"Should not call isTileEmpty on removed tile");for(let t=0;t<2;t++)for(let n=0;n<3;n++){const r=e.getNext(new jX(n,t),1);if(this.getPieceAt(r)!==nJ.EMPTY)return!1}return!0}isDeconnectable(e){const t=this.getPresentNeighboorTilesRelativeIndexes(e);if(t.length>3)return!1;let n=0;for(let r=1;r<t.length;r++)!1===this.areNeighboor(t[r-1],t[r])&&(n+=1);return!1===this.areNeighboor(t[0],t[t.length-1])&&(n+=1),n<=1}areNeighboor(e,t){return e+1===t||0===e&&5===t}getPresentNeighboorTilesRelativeIndexes(e){const t=[];let n=Mw.empty();for(let r=0;r<6;r++){const i=e.getNext(c0.NEIGHBOORS_TILES_DIRECTIONS[r],1);i.isInRange(15,10)&&this.getPieceAt(i)!==nJ.UNREACHABLE&&(n.isAbsent()&&(n=Mw.of(r)),t.push(r-n.get()))}return t}deconnectTile(e,t){Tw(c0.VERBOSE,{coerceoState_deconnectTile:{object:this,tileUpperLeft:e,countTiles:t}});const n=this.getCopiedBoard(),r=e.x,i=e.y;for(let o=0;o<2;o++)for(let e=0;e<3;e++)n[i+o][r+e]=nJ.UNREACHABLE;const s=[this.tiles[0],this.tiles[1]];return t&&(s[this.getCurrentPlayer().value]+=1),new c0(n,this.turn,s,this.captures)}getLegalLandings(e){const t=[];for(const n of s0.STEPS){const r=e.getNext(n.direction,1);this.isOnBoard(r)&&this.getPieceAt(r)===nJ.EMPTY&&t.push(r)}return t}getPiecesByFreedom(){const e=[[0,0,0,0],[0,0,0,0]];for(let t=0;t<10;t++)for(let n=0;n<15;n++){const r=this.board[t][n];if(r.isPlayer()){const i=this.getEmptyNeighboors(new JX(n,t),nJ.EMPTY).length;e[r.value][i]=e[r.value][i]+1}}return e}}c0.VERBOSE=!1,c0.NEIGHBOORS_TILES_DIRECTIONS=[new jX(0,-2),new jX(3,-1),new jX(3,1),new jX(0,2),new jX(-3,1),new jX(-3,-1)],c0.isInRange=e=>e.isInRange(15,10);let u0=(()=>{class e extends PJ{applyLegalMove(e,t,n){return e.isTileExchange()?this.applyLegalTileExchange(e,t):this.applyLegalMovement(e,t)}applyLegalTileExchange(t,n){const r=n.getCopiedBoard(),i=t.capture.get();r[i.y][i.x]=nJ.EMPTY;const s=[n.captures[0],n.captures[1]];s[n.getCurrentPlayer().value]+=1;const o=[n.tiles[0],n.tiles[1]];o[n.getCurrentPlayer().value]-=2;const a=new c0(r,n.turn,o,s),l=a.removeTilesIfNeeded(i,!1),c=new c0(l.getCopiedBoard(),l.turn+1,l.tiles,l.captures);return Tw(e.VERBOSE,{coerceoRules_applyLegalTileExchange:{a_initialState:n,afterCapture:a,afterTileRemoval:l,resultingState:c}}),c}applyLegalMovement(t,n){const r=n.applyLegalMovement(t),i=r.removeTilesIfNeeded(t.start.get(),!0),s=i.doMovementCaptures(t),o=new c0(s.board,n.turn+1,s.tiles,s.captures);return Tw(e.VERBOSE,{ab_state:n,afterMovement:r,afterTilesRemoved:i,afterCaptures:s,resultingState:o}),o}isLegal(e,t){return e.isTileExchange()?this.isLegalTileExchange(e,t):this.isLegalMovement(e,t)}isLegalTileExchange(e,t){if(t.tiles[t.getCurrentPlayer().value]<2)return SW.failure(i0.NOT_ENOUGH_TILES_TO_EXCHANGE());const n=t.getPieceAt(e.capture.get());return n===nJ.UNREACHABLE||n===nJ.EMPTY?SW.failure(i0.CANNOT_CAPTURE_FROM_EMPTY()):n.is(t.getCurrentPlayer())?SW.failure(i0.CANNOT_CAPTURE_OWN_PIECES()):SW.success(void 0)}isLegalMovement(e,t){if(t.getPieceAt(e.start.get())===nJ.UNREACHABLE){const t="Cannot start with a coord outside the board "+e.start.get().toString()+".";return SW.failure(t)}if(t.getPieceAt(e.landingCoord.get())===nJ.UNREACHABLE){const t="Cannot end with a coord outside the board "+e.landingCoord.get().toString()+".";return SW.failure(t)}const n=t.getPieceAt(e.start.get());return n===nJ.EMPTY?SW.failure(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY()):n.is(t.getCurrentOpponent())?SW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):t.getPieceAt(e.landingCoord.get()).is(t.getCurrentPlayer())?SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE()):SW.success(void 0)}static getGameStatus(e){const t=e.gameState;return t.captures[0]>=18?SJ.ZERO_WON:t.captures[1]>=18?SJ.ONE_WON:SJ.ONGOING}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class h0 extends cJ{getListMoves(e){let t=this.getListExchanges(e);return t=t.concat(this.getListMovement(e)),this.putCaptureFirst(e,t)}getListExchanges(e){const t=[],n=e.gameState,r=n.getCurrentPlayer().value,i=nJ.ofPlayer(n.getCurrentOpponent());if(n.tiles[r]<2)return t;for(let s=0;s<10;s++)for(let e=0;e<15;e++){const r=new JX(e,s);if(n.getPieceAt(r)===i){const e=o0.fromTilesExchange(r);t.push(e)}}return t}getListMovement(e){const t=[],n=e.gameState,r=n.getCurrentPlayer();for(let i=0;i<10;i++)for(let e=0;e<15;e++){const s=new JX(e,i);if(n.getPieceAt(s).is(r)){const e=n.getLegalLandings(s);for(const n of e){const e=o0.fromCoordToCoord(s,n);t.push(e)}}}return t}getBoardValue(e){const t=u0.getGameStatus(e);if(t.isEndGame)return uJ.fromWinner(t.winner);const n=e.gameState,r=n.getPiecesByFreedom(),i=this.getPiecesScore(r);return new uJ(2*n.captures[1]+i[1]-(2*n.captures[0]+i[0]))}getPiecesScore(e){return[this.getPlayerPiecesScore(e[0]),this.getPlayerPiecesScore(e[1])]}getPlayerPiecesScore(e){return 3*e[0]+1*e[1]+3*e[2]+3*e[3]}putCaptureFirst(e,t){return GK.sortByDescending(t,t=>this.moveCapturesList(e,t).length),t}moveCapturesList(e,t){return t.isTileExchange()?[t.capture.get()]:e.gameState.applyLegalMovement(t).removeTilesIfNeeded(t.start.get(),!0).getCapturedNeighbors(t.landingCoord.get())}}let d0=(()=>{class e extends h0{getBoardValue(t){const n=u0.getGameStatus(t);if(n.isEndGame)return uJ.fromWinner(n.winner);const r=t.gameState,i=this.getPiecesMap(r),s=this.getThreatMap(r,i),o=this.filterThreatMap(s,r);let a=0;for(const l of BK.PLAYERS)for(const t of i.get(l).get())o.get(t).isPresent()?a+=l.getScoreModifier()*e.SCORE_BY_THREATENED_PIECE:a+=l.getScoreModifier()*e.SCORE_BY_SAFE_PIECE;return a+=r.tiles[1]-r.tiles[0],new uJ(a)}getPiecesMap(e){const t=new CJ,n=[],r=[];for(let i=0;i<10;i++)for(let t=0;t<15;t++){const s=new JX(t,i),o=e.getPieceAt(s);o===nJ.ZERO?n.push(s):o===nJ.ONE&&r.push(s)}return t.set(BK.ZERO,new L1(n)),t.set(BK.ONE,new L1(r)),t}getThreatMap(e,t){const n=new CJ;for(const r of BK.PLAYERS)for(const i of t.get(r).get()){const t=this.getThreat(i,e);t.isPresent()&&n.set(i,t.get())}return n}getThreat(e,t){const n=BK.of(t.getPieceAt(e).value).getOpponent();let r=Mw.empty();const i=[],s=a0.getNeighbors(e).filter(e=>e.isInRange(15,10));for(const o of s){const e=t.getPieceAt(o);if(e.is(n))i.push(o);else if(e===nJ.EMPTY){if(r.isPresent())return Mw.empty();r=Mw.of(o)}}if(r.isPresent()){const e=[];for(const s of s0.STEPS){const o=r.get().getNext(s.direction,1);o.isInRange(15,10)&&t.getPieceAt(o).is(n)&&i.every(e=>!1===e.equals(o))&&e.push(o)}if(e.length>0)return Mw.of(new R1(new L1(i),new L1(e)))}return Mw.empty()}filterThreatMap(e,t){const n=new CJ,r=e.listKeys(),i=r.filter(e=>t.getPieceAt(e).is(t.getCurrentPlayer())),s=new L1(r.filter(e=>t.getPieceAt(e).is(t.getCurrentOpponent())));for(const o of i){const t=e.get(o).get();NW(1===t.directThreats.size(),"oldThreat must contain exactly one direct threat");const r=t.directThreats.getAnyElement().get();let i=Mw.empty();if(!1===s.contains(r)){const e=[];for(const n of t.mover)!1===s.contains(n)&&e.push(n);e.length>0&&(i=Mw.of(new R1(t.directThreats,new L1(e))))}i.isPresent()&&n.set(o,i.get())}for(const o of s){const t=e.get(o).get();n.set(o,t)}return n}}return e.SCORE_BY_THREATENED_PIECE=1e3,e.SCORE_BY_SAFE_PIECE=1e6,e})();const p0=nJ.EMPTY,f0=nJ.UNREACHABLE,g0=nJ.ZERO,m0=nJ.ONE;class y0{constructor(){this.tutorial=[kJ.informational($localize`Board and goal of the game`,$localize`Coerceo is played on a board like this, composed of hexagonal tiles, each comprising 6 triangles.
         The triangles are the spaces on which pieces move during the game.
         The tiles can be removed from the board (you will see how later).
         The dark pieces belong to the first player and can only move on the dark spaces,
         while the light pieces belong to the second player and can only move on the light spaces.
         The goal of the game is to capture all of the opponent's pieces.`,c0.getInitialState()),kJ.anyMove($localize`Move`,$localize`To move a piece, you need to:
        <ol>
          <li>Click on one of your pieces.</li>
          <li>Click on one of the triangular space highlighted in yellow.</li>
        </ol>
        You can pass through the opponent's pieces.
        You're playing first, hence you're playing Dark.<br/><br/>
        Perform any move.`,c0.getInitialState(),o0.fromCoordToCoord(new JX(3,5),new JX(5,5)),$localize`Congratulations! Let's see captures now.`),kJ.fromMove($localize`Capture`,$localize`Every piece has three neighboring triangular spaces (2 on the sides).
        When all neighboring spaces except one are occupied, and one opponent moves to that last free space, your piece is captured!
        However, it is possible to place a piece between 3 of the opponent's pieces (or 2 on the side) without being captured.<br/><br/>
        You're playing Light, make a capture.`,new c0([[f0,f0,f0,f0,f0,f0,g0,p0,g0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,g0,p0,p0,p0,p0,p0,g0,p0,p0,f0,f0,f0],[p0,m0,p0,m0,g0,m0,p0,p0,g0,p0,p0,m0,p0,m0,p0],[m0,p0,p0,p0,p0,p0,p0,p0,p0,p0,m0,p0,p0,p0,m0],[p0,m0,p0,m0,p0,p0,p0,p0,p0,p0,p0,m0,p0,m0,p0],[p0,g0,p0,g0,p0,p0,p0,p0,p0,p0,p0,g0,p0,g0,p0],[g0,p0,p0,p0,g0,p0,p0,p0,p0,p0,g0,p0,p0,p0,g0],[p0,g0,p0,g0,p0,p0,m0,p0,m0,p0,p0,g0,p0,g0,p0],[f0,f0,f0,p0,p0,m0,p0,p0,p0,m0,p0,p0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,m0,p0,m0,f0,f0,f0,f0,f0,f0]],3,[0,0],[0,0]),[o0.fromCoordToCoord(new JX(5,2),new JX(4,1)),o0.fromCoordToCoord(new JX(3,4),new JX(4,3))],$localize`Congratulations!`,$localize`Failed, you have not captured any piece.`),kJ.fromMove($localize`Gain a tile`,$localize`When a tile is empty, it can become removable from the board.
        For it to be removable, at least three of its sides must be free, and these should be neighboring sides.
        Note that if one empty tile, neighboring a tile that was just removed, also becomes removable, it will be removed too.
        For example, here, the topmost dark piece will not disconnect its tile when leaving it.
        But, by leaving the bottom left tile, two tiles will be removed.<br/><br/>
        Perform a move that lets you gain two tiles.`,new c0([[f0,f0,f0,f0,f0,f0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,m0,p0,p0,f0,f0,f0,f0,f0,f0],[p0,p0,p0,f0,f0,f0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[p0,p0,m0,p0,p0,p0,p0,g0,p0,f0,f0,f0,f0,f0,f0],[p0,p0,p0,m0,p0,p0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[p0,p0,p0,p0,p0,p0,p0,p0,p0,p0,p0,g0,f0,f0,f0],[p0,p0,g0,p0,p0,m0,p0,p0,p0,p0,g0,p0,p0,p0,g0],[p0,p0,p0,p0,p0,p0,m0,p0,m0,p0,p0,g0,p0,g0,p0],[f0,f0,f0,p0,p0,m0,p0,p0,p0,m0,p0,p0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,m0,p0,m0,f0,f0,f0,f0,f0,f0]],2,[0,0],[0,0]),[o0.fromCoordToCoord(new JX(2,6),new JX(4,6)),o0.fromCoordToCoord(new JX(2,6),new JX(3,5)),o0.fromCoordToCoord(new JX(2,6),new JX(3,7))],$localize`Congratulations!`,$localize`Failed, you have not gained the two tiles that you could, try again!`),kJ.fromMove($localize`Exchanging a tile`,$localize`When you have a tile, you can see it on the left of the board.
        As soon as you have two, you can click on an opponent's piece to capture it immediately instead of moving one of your pieces.
        This will cost you two tiles.
        If any tiles are removed during that turn, nobody will get them.<br/><br/>
        Gain some time and capture the last piece!`,new c0([[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,g0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,p0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,p0,m0,p0,m0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,m0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,m0,p0,m0,f0,f0,f0,f0,f0,f0]],1,[0,2],[0,0]),[o0.fromTilesExchange(new JX(5,5))],$localize`Congratulations!`,$localize`It's nice to move a piece, but you could have had the opponent's piece immediately by clicking on it!`),kJ.fromMove($localize`Special capture`,$localize`When a tile is removed from the board during your turn, some of the opponent's pieces may have lost their last free neighboring space, they will therefore be captured!
        If this happens to one of your piece during your turn, it will however stay on the board.<br/><br/>
        A move that demonstrate both of these things can be done on this board by Light. Try it!`,new c0([[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,p0,p0,g0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,g0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,g0,m0,p0,m0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,m0,g0,p0,p0,p0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,p0,p0,m0,f0,f0,f0,f0,f0,f0,f0,f0,f0],[f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0,f0]],1,[0,0],[0,0]),[o0.fromCoordToCoord(new JX(7,6),new JX(6,5)),o0.fromCoordToCoord(new JX(7,6),new JX(8,5))],$localize`Congratulations! See, your piece no longer had any empty neighboring space after you have gained the tile, but it stayed on the board as it was your turn.
        However, the opponent's piece has disappeared because the tile's capture has removed its last empty neighboring space.`,$localize`Failed!`)]}}function v0(e,t){if(1&e&&(Cn(),ga(0,"polygon",13)),2&e){const e=Sa().index,t=Sa().index,n=Sa();ha("ngClass",n.getPyramidClass(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function _0(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ha("ngClass",n.getEmptyClass(e,t)),ra("points",n.getTriangleCoordinate(e,t))}}function C0(e,t){if(1&e&&(Cn(),la(0,_0,1,2,"polygon",14)),2&e){const e=Sa().index,t=Sa().index;ha("ngIf",Sa().isEmptyCase(e,t))}}function E0(e,t){if(1&e&&(Cn(),ga(0,"polygon",16)),2&e){const e=Sa().index,t=Sa().index,n=Sa();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function w0(e,t){if(1&e&&(Cn(),ga(0,"polygon",17)),2&e){const e=Sa().index,t=Sa().index,n=Sa();Ia("id","dark_line_",e,"_",t,""),ra("points",n.getLineCoordinate(e,t))}}function b0(e,t){if(1&e){const e=va();Cn(),pa(0,"g",8),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),la(1,v0,1,2,"polygon",9),la(2,C0,1,1,"ng-template",null,10,Ku),la(4,E0,1,3,"polygon",11),la(5,w0,1,3,"polygon",12),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(3),i=Sa().index,s=Sa();Ia("id","click_",n,"_",i,""),Ts(1),ha("ngIf",s.isPyramid(n,i))("ngIfElse",r),Ts(3),ha("ngIf",e!==s.NONE),Ts(1),ha("ngIf",e!==s.NONE)}}function S0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,b0,6,6,"g",7),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function P0(e,t){if(1&e&&(Cn(),ga(0,"polygon",18)),2&e){const e=t.$implicit;ra("points",Sa().getTriangleCoordinate(e.x,e.y))}}function O0(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=Sa();ra("points",e.getTriangleCoordinate(e.lastStart.get().x,e.lastStart.get().y))}}function T0(e,t){if(1&e&&(Cn(),ga(0,"polygon",19)),2&e){const e=Sa();ra("points",e.getTriangleCoordinate(e.lastEnd.get().x,e.lastEnd.get().y))}}function I0(e,t){if(1&e&&(Cn(),ga(0,"polygon",20)),2&e){const e=Sa();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}function k0(e,t){if(1&e&&(Cn(),pa(0,"g",21),ga(1,"polygon",22),pa(2,"text",23),Qa(3),fa(),fa()),2&e){const e=Sa();Ts(1),ra("points",e.getTilesCountCoordinate(0,0))("stroke",e.lastTurnWasTilesExchange(0)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+0*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Xa(e.tiles[0])}}function A0(e,t){if(1&e&&(Cn(),pa(0,"g",24),ga(1,"polygon",25),pa(2,"text",26),Qa(3),fa(),fa()),2&e){const e=Sa();Ts(1),ra("points",e.getTilesCountCoordinate(0,9))("stroke",e.lastTurnWasTilesExchange(1)?"yellow":"black"),Ts(1),ra("x",e.SPACE_SIZE/2+0*e.SPACE_SIZE)("y",16+e.SPACE_SIZE/2+9*e.SPACE_SIZE)("font-size",e.SPACE_SIZE/2),Ts(1),Xa(e.tiles[1])}}let M0=(()=>{class e extends r0{constructor(e){super(e),this.tiles=[0,0],this.NONE=nJ.UNREACHABLE,this.chosenCoord=Mw.empty(),this.lastStart=Mw.empty(),this.lastEnd=Mw.empty(),this.highlights=[],this.scores=Mw.of([0,0]),this.rules=new u0(c0),this.availableMinimaxes=[new h0(this.rules,"Normal"),new d0(this.rules,"Piece > Threat > Tiles")],this.encoder=o0.encoder,this.tutorial=(new y0).tutorial,this.SPACE_SIZE=70,this.updateBoard()}updateBoard(){this.chosenCoord=Mw.empty(),this.state=this.rules.node.gameState,this.scores=Mw.of(this.state.captures),this.tiles=this.state.tiles;const e=this.rules.node.move;e.isPresent()?(this.lastStart=e.get().start,this.lastEnd=e.get().landingCoord):(this.lastStart=Mw.empty(),this.lastEnd=Mw.empty()),this.board=this.rules.node.gameState.board}showHighlight(){this.highlights=this.state.getLegalLandings(this.chosenCoord.get())}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.highlights=[]}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new JX(e,t);return n.chosenCoord.isAbsent()?n.firstClick(i):n.secondClick(i)})()}firstClick(e){var t=this;return Pw(function*(){const n=t.state.getPieceAt(e);if(n.is(t.state.getCurrentOpponent())){const n=o0.fromTilesExchange(e);return t.chooseMove(n,t.state,t.state.captures)}return n.is(t.state.getCurrentPlayer())?(t.chosenCoord=Mw.of(e),t.showHighlight(),TW.SUCCESS):t.cancelMove(i0.FIRST_CLICK_SHOULD_NOT_BE_NULL())})()}secondClick(e){var t=this;return Pw(function*(){if(e.equals(t.chosenCoord.get()))return t.cancelMoveAttempt(),TW.SUCCESS;if(t.highlights.some(t=>t.equals(e))){const n=o0.fromCoordToCoord(t.chosenCoord.get(),e);return t.chooseMove(n,t.state,t.state.captures)}return t.cancelMove(i0.INVALID_DISTANCE())})()}isPyramid(e,t){return this.board[t][e].isPlayer()||this.wasOpponent(e,t)}wasOpponent(e,t){const n=this.rules.node.mother;return n.isPresent()&&n.get().gameState.getPieceAtXY(e,t).is(n.get().gameState.getCurrentOpponent())}getPyramidClass(e,t){const n=this.board[t][e];return n===nJ.ZERO?this.getPlayerClass(BK.ZERO):n===nJ.ONE?this.getPlayerClass(BK.ONE):"captured"}isEmptyCase(e,t){return this.board[t][e]===nJ.EMPTY||this.wasRemoved(e,t)}wasRemoved(e,t){const n=this.rules.node.mother;if(this.board[t][e]===nJ.UNREACHABLE&&n.isPresent()){const r=n.get().gameState.getPieceAtXY(e,t);return r===nJ.EMPTY||r.is(n.get().gameState.getCurrentPlayer())}return!1}getEmptyClass(e,t){return this.board[t][e]===nJ.EMPTY?(e+t)%2==1?"background":"background2":"captured2"}getTilesCountCoordinate(e,t){const n=100*e,r=100*t,i=n+25;return i+", "+r+", "+(n+75)+", "+r+", "+(n+100)+", "+(r+50)+", "+(n+75)+", "+(r+100)+", "+(n+25)+", "+(r+100)+", "+(n+0)+", "+(r+50)+", "+i+", "+r}getLineCoordinate(e,t){const n=this.getTriangleCornerCoords(e,t);return e%3==0?n[0].x+","+n[0].y+","+n[1].x+","+n[1].y:e%3==1?n[0].x+","+n[0].y+","+n[2].x+","+n[2].y:n[1].x+","+n[1].y+","+n[2].x+","+n[2].y}mustShowTilesOf(e){return this.tiles[e]>0||this.lastTurnWasTilesExchange(e)}lastTurnWasTilesExchange(e){return!this.rules.node.mother.isAbsent()&&this.rules.node.mother.get().gameState.tiles[e]>this.tiles[e]}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-coerceo"]],features:[Go],decls:8,vars:8,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill highlighted",4,"ngFor","ngForOf"],["class","base no-fill last-move",4,"ngIf"],["class","base no-fill selected",4,"ngIf"],["id","tilesCountZero",4,"ngIf"],["id","tilesCountOne",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["class","base mid-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf","ngIfElse"],["emptyCase",""],["class","base",3,"id",4,"ngIf"],["class","white-stroke",3,"id",4,"ngIf"],["stroke-linecap","round",1,"base","mid-stroke",3,"ngClass"],["class","base small-stroke","stroke-linecap","round",3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base","small-stroke",3,"ngClass"],[1,"base",3,"id"],[1,"white-stroke",3,"id"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","last-move"],[1,"base","no-fill","selected"],["id","tilesCountZero"],["stroke-linecap","round",1,"base","player0"],["id","playerZeroTilesCount","text-anchor","middle",1,"text"],["id","tilesCountOne"],["stroke-linecap","round",1,"base","player1"],["id","playerOneTilesCount","text-anchor","middle",1,"text"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,S0,2,1,"g",1),la(2,P0,1,1,"polygon",2),la(3,O0,1,1,"polygon",3),la(4,T0,1,1,"polygon",3),la(5,I0,1,1,"polygon",4),la(6,k0,4,6,"g",5),la(7,A0,4,6,"g",6),fa()),2&e&&(ra("viewBox","-5 -5 "+(10+8*t.SPACE_SIZE)+" "+(10+10*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.highlights),Ts(1),ha("ngIf",t.lastStart.isPresent()),Ts(1),ha("ngIf",t.lastEnd.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()),Ts(1),ha("ngIf",t.mustShowTilesOf(0)),Ts(1),ha("ngIf",t.mustShowTilesOf(1)))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),N0=(()=>{class e{}return e.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP=()=>$localize`Your piece should land on a neighboring square.`,e.CANNOT_DROP_AFTER_TURN_40=()=>$localize`You cannot drop a piece during the moving phase.`,e.CANNOT_MOVE_BEFORE_TURN_40=()=>$localize`You cannot move a piece before both players have dropped all of their pieces.`,e.MUST_JUMP_OVER_PIECES=()=>$localize`A jump must be made over a piece, not over an empty square.`,e.MUST_DROP_IN_CENTRAL_ZONE=()=>$localize`A drop must occur in the central zone of the board.`,e.INVALID_JUMP=()=>$localize`A jump must land two squares from its original position, and be done in a straight line in any direction.`,e.SAME_LOCATION_VISITED_IN_JUMP=()=>$localize`You are visiting the same location twice in a move, you are not allowed to do so.`,e})();class R0 extends fJ{static getInitialState(){const e=GK.createTable(R0.WIDTH,R0.HEIGHT,VK.NONE);return new R0(e,0)}isShelter(e){return 0===e.x||e.x===R0.WIDTH-1?R0.SHELTERS_INDICES.some(t=>e.y===t):(0===e.y||e.y===R0.HEIGHT-1)&&R0.SHELTERS_INDICES.some(t=>e.x===t)}isCentralZone(e){return e.x>=R0.CENTRAL_ZONE_TOP_LEFT.x&&e.x<=R0.CENTRAL_ZONE_BOTTOM_RIGHT.x&&e.y>=R0.CENTRAL_ZONE_TOP_LEFT.y&&e.y<=R0.CENTRAL_ZONE_BOTTOM_RIGHT.y}isDropPhase(){return this.turn<40}getSidePieces(){return this.turn%2==0?[20-this.turn/2,20-this.turn/2]:[20-(this.turn-1)/2-1,20-(this.turn-1)/2]}}R0.WIDTH=17,R0.HEIGHT=17,R0.CENTRAL_ZONE_TOP_LEFT=new JX(4,6),R0.CENTRAL_ZONE_BOTTOM_RIGHT=new JX(12,10),R0.SHELTERS_INDICES=[0,1,3,5,7,8,9,11,13,15,16],R0.ALL_SHELTERS=new dJ(R0.SHELTERS_INDICES.flatMap(e=>[new JX(e,0),new JX(e,R0.HEIGHT-1),new JX(0,e),new JX(R0.WIDTH-1,e)])).toList();class x0 extends yJ{constructor(e){super(e.x,e.y)}static of(e){return e.isInRange(R0.WIDTH,R0.HEIGHT)?SW.success(new x0(e)):SW.failure("Move out of board")}toString(){return`ConspirateursMoveDrop(${this.coord.toString()})`}equals(e){return!!e.isDrop()&&this.coord.equals(e.coord)}isDrop(){return!0}isSimple(){return!1}isJump(){return!1}}x0.encoder=class{static getEncoder(e,t,n){return new class extends FK{constructor(){super(...arguments),this.shiftX=t}maxValue(){return(e-1)*this.shiftX+(t-1)}encodeNumber(e){return e.coord.x*this.shiftX+e.coord.y}decodeNumber(r){const i=r%t;r/=t;const s=new JX((r-=r%1)%e,i);return n(s)}}}}.getEncoder(R0.WIDTH,R0.HEIGHT,e=>x0.of(e).get());class D0 extends C1{constructor(e,t){super(e,t)}static of(e,t){return e.isInRange(R0.WIDTH,R0.HEIGHT)&&t.isInRange(R0.WIDTH,R0.HEIGHT)?e.isAlignedWith(t)&&1===e.getDistance(t)?SW.success(new D0(e,t)):SW.failure(N0.SIMPLE_MOVE_SHOULD_BE_OF_ONE_STEP()):SW.failure("Move out of board")}toString(){return`ConspirateursMoveSimple(${this.coord.toString()} -> ${this.end.toString()})`}equals(e){return!(!e.isSimple()||e!==this&&(!1===e.coord.equals(this.coord)||!1===e.end.equals(this.end)))}isDrop(){return!1}isSimple(){return!0}isJump(){return!1}}D0.encoder=C1.getEncoder(R0.WIDTH,R0.HEIGHT,(e,t)=>D0.of(e,t).get());class L0 extends mJ{constructor(e){super(),this.coords=e}static of(e){if(e.length<2)return SW.failure("ConspirateursMoveJump requires at least one jump, so two coords");for(const t of e)if(t.isNotInRange(R0.WIDTH,R0.HEIGHT))return SW.failure("Move out of board");for(let t=1;t<e.length;t++)if(e[t-1].getDirectionToward(e[t]).isFailure()||2!==e[t-1].getDistance(e[t]))return SW.failure(N0.INVALID_JUMP());return new L1(e).size()===e.length?SW.success(new L0(e)):SW.failure(N0.SAME_LOCATION_VISITED_IN_JUMP())}addJump(e){const t=GK.copyImmutableArray(this.coords);return t.push(e),L0.of(t)}getStartingCoord(){return this.coords[0]}getEndingCoord(){return this.coords[this.coords.length-1]}getLandingCoords(){return this.coords.slice(1)}getJumpedOverCoords(){const e=[];for(let t=1;t<this.coords.length;t++){const n=this.coords[t-1].getDirectionToward(this.coords[t]).get();e.push(this.coords[t-1].getNext(n,1))}return e}toString(){return`ConspirateursMoveJump(${this.coords.map(e=>e.toString()).reduce((e,t)=>e+" -> "+t)})`}equals(e){return!(e.isSimple()||e.isDrop()||e!==this&&(!1===this.getStartingCoord().equals(e.getStartingCoord())||!1===this.getEndingCoord().equals(e.getEndingCoord())))}isDrop(){return!1}isSimple(){return!1}isJump(){return!0}}L0.encoder=new class extends LK{constructor(){super(...arguments),this.coordEncoder=JX.numberEncoder(R0.WIDTH,R0.HEIGHT)}encodeMove(e){return{coords:e.coords.map(this.coordEncoder.encodeNumber)}}decodeMove(e){NW(null!=Ow.getNonNullable(e).coords,"Encoded ConspirateursMoveJump should contain coords");const t=Ow.getNonNullable(e).coords.map(this.coordEncoder.decodeNumber);return L0.of(t).get()}};const F0=LK.disjunction3(x0.encoder,D0.encoder,L0.encoder,e=>e.isDrop(),e=>e.isSimple());class U0 extends PJ{constructor(){super(R0)}static get(){return U0.singleton.isAbsent()&&(U0.singleton=Mw.of(new U0)),U0.singleton.get()}applyLegalMove(e,t,n){const r=t.getCopiedBoard();if(e.isDrop())r[e.coord.y][e.coord.x]=t.getCurrentPlayer();else if(e.isSimple())r[e.coord.y][e.coord.x]=VK.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer();else{const n=e.getStartingCoord(),i=e.getEndingCoord();r[n.y][n.x]=VK.NONE,r[i.y][i.x]=t.getCurrentPlayer()}return new R0(r,t.turn+1)}isLegal(e,t){return e.isDrop()?this.dropLegality(e,t):e.isSimple()?this.simpleMoveLegality(e,t):this.jumpLegality(e,t)}dropLegality(e,t){return t.turn>=40?SW.failure(N0.CANNOT_DROP_AFTER_TURN_40()):t.getPieceAt(e.coord).isPlayer()?SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE()):!1===t.isCentralZone(e.coord)?SW.failure(N0.MUST_DROP_IN_CENTRAL_ZONE()):SW.success(void 0)}simpleMoveLegality(e,t){return t.turn<40?SW.failure(N0.CANNOT_MOVE_BEFORE_TURN_40()):t.getPieceAt(e.coord)!==t.getCurrentPlayer()?SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE()):t.getPieceAt(e.end).isPlayer()?SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE()):SW.success(void 0)}jumpLegality(e,t){if(t.turn<40)return SW.failure(N0.CANNOT_MOVE_BEFORE_TURN_40());if(t.getPieceAt(e.getStartingCoord())!==t.getCurrentPlayer())return SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE());for(const n of e.getJumpedOverCoords())if(t.getPieceAt(n)===VK.NONE)return SW.failure(N0.MUST_JUMP_OVER_PIECES());for(const n of e.getLandingCoords())if(t.getPieceAt(n).isPlayer())return SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE());return SW.success(void 0)}jumpTargetsFrom(e){const t=[new JX(e.x+2,e.y),new JX(e.x-2,e.y),new JX(e.x,e.y+2),new JX(e.x,e.y-2),new JX(e.x+2,e.y+2),new JX(e.x+2,e.y-2),new JX(e.x-2,e.y+2),new JX(e.x-2,e.y-2)],n=[];for(const r of t)L0.of([e,r]).isSuccess()&&n.push(r);return n}nextJumps(e,t){const n=e.getEndingCoord(),r=[];for(const i of this.jumpTargetsFrom(n)){const n=e.addJump(i);n.isSuccess()&&this.jumpLegality(n.get(),t).isSuccess()&&r.push(n.get())}return r}jumpHasPossibleNextTargets(e,t){return this.nextJumps(e,t).length>0}getGameStatus(e){const t=e.gameState,n=[0,0];for(const r of R0.ALL_SHELTERS){const e=t.getPieceAt(r);if(e.isPlayer()&&(n[e.value]+=1,20===n[e.value]))return SJ.getVictory(e)}return SJ.ONGOING}}U0.singleton=Mw.empty();class B0 extends cJ{getListMoves(e){return e.gameState.turn<40?this.getListMovesDrop(e.gameState):this.getListMovesAfterDrop(e.gameState)}getListMovesDrop(e){const t=[],n=R0.CENTRAL_ZONE_TOP_LEFT,r=R0.CENTRAL_ZONE_BOTTOM_RIGHT;for(let i=n.y;i<=r.y;i++)for(let s=n.x;s<=r.x;s++)e.getPieceAtXY(s,i)===VK.NONE&&t.push(x0.of(new JX(s,i)).get());return t}getListMovesAfterDrop(e){let t=[];const n=e.getCurrentPlayer();for(let r=0;r<R0.HEIGHT;r++)for(let i=0;i<R0.WIDTH;i++){const s=new JX(i,r);e.getPieceAt(s)===n&&(t=t.concat(this.getListSimpleMoves(e,s)),t=t.concat(this.getListJumps(e,s)))}return t}getListSimpleMoves(e,t){const n=[],r=[new JX(t.x+1,t.y),new JX(t.x-1,t.y),new JX(t.x,t.y+1),new JX(t.x,t.y-1),new JX(t.x+1,t.y+1),new JX(t.x+1,t.y-1),new JX(t.x-1,t.y+1),new JX(t.x-1,t.y-1)];for(const i of r){const r=D0.of(t,i);r.isSuccess()&&U0.get().simpleMoveLegality(r.get(),e).isSuccess()&&n.push(r.get())}return n}getListJumps(e,t){const n=new dJ;for(const r of U0.get().jumpTargetsFrom(t)){const i=L0.of([t,r]).get();U0.get().jumpLegality(i,e).isSuccess()&&(n.add(i),n.union(this.getListJumpStartingFrom(e,i)))}return n.toList()}getListJumpStartingFrom(e,t){const n=U0.get().nextJumps(t,e),r=new dJ(n);for(const i of n)r.union(this.getListJumpStartingFrom(e,i));return r}getBoardValue(e){const t=e.gameState;let n=0;const r=new CJ([{key:BK.ZERO,value:0},{key:BK.ONE,value:0}]);for(let i=0;i<R0.HEIGHT;i++)for(let e=0;e<R0.WIDTH;e++){const s=new JX(e,i),o=t.getPieceAt(s);if(o.isPlayer())if(t.isShelter(s)){if(n+=20*o.getScoreModifier(),r.replace(o,r.get(o).get()+1),20===r.get(o).get())return new uJ(o.getVictoryValue())}else{let e=100;for(const n of R0.ALL_SHELTERS)if(t.getPieceAt(n)===VK.NONE){const t=s.getOrthogonalDistance(n);e=Math.min(e,t)}n-=o.getScoreModifier()*e}}return new uJ(n)}}const V0=VK.NONE,$0=BK.ZERO,z0=BK.ONE;class H0{constructor(){this.tutorial=[kJ.informational($localize`Board and aim of the game`,$localize`Conspirateurs is played on a 17x17 board. The goal of the game is to place all of your pieces in shelters, which are the special squares on the edge of the board. Note the central zone in the middle of the board, where each player will put their pieces initially.`,R0.getInitialState()),kJ.anyMove($localize`Initial phase`,$localize`In the initial phase of the game, each player drop their 20 pieces, one per turn consecutively, in the central zone of the board. This phase does not allow any other kind of move.<br/><br/>Drop one of your piece in the central zone.`,R0.getInitialState(),x0.of(new JX(7,7)).get(),$localize`Congratulations!`),kJ.fromPredicate($localize`Simple move`,$localize`Once all pieces have been placed, there are two kind of moves that can be performed. The first is a simple move in any direction, orthogonally or diagonally, of a single step.<br/><br/>You're playing Dark. Click on one of your piece and perform such a move.`,new R0([[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,$0,z0,z0,$0,$0,z0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,z0,$0,z0,$0,$0,$0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,z0,V0,V0,V0,V0,V0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,$0,z0,z0,z0,$0,$0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,z0,z0,z0,z0,z0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0]],40),D0.of(new JX(4,6),new JX(3,5)).get(),(e,t)=>e.isSimple()?TW.SUCCESS:TW.failure($localize`You have made a jump, not a simple move. Try again!`),$localize`Congratulations!`),kJ.fromPredicate($localize`Jumps`,$localize`The other type of move is a jump. A piece can jump over a neighboring piece in any direction, as long as it lands directly on the square after that piece, along the same direction.<br/><br/>You're playing Dark. Perform a jump by clicking on one of your piece that can perform a jump, and then on the target square. You may need to click a second time on the target square to confirm your jump, in case your piece is still highlighted (we will see shortly why this is useful).`,new R0([[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,$0,z0,z0,$0,$0,z0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,z0,$0,z0,$0,$0,$0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,z0,V0,V0,V0,V0,V0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,$0,z0,z0,z0,$0,$0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,z0,z0,z0,z0,z0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0]],40),L0.of([new JX(6,7),new JX(6,5)]).get(),(e,t)=>e.isJump()?TW.SUCCESS:TW.failure($localize`You have not performed a jump. Try again!`),$localize`Congratulations!`),kJ.fromMove($localize`Chaining jumps in a single move`,$localize`Jumps can be chained when possible. You can decide whether to continue a jump or to stop it at any time. To finish your jump, click a second time on your current location. Otherwise, simply keep clicking on your next location. Once no more destination is possible, your move will end without you needing to click the piece a second time.<br/><br/>You're playing Dark and you can perform a triple jump! Do it.`,new R0([[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,z0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,z0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,z0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,$0,V0,z0,$0,$0,z0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,V0,$0,z0,$0,$0,$0,$0,z0,V0,V0,V0,V0],[V0,V0,V0,V0,$0,z0,V0,V0,V0,V0,V0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,$0,z0,z0,z0,$0,$0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,z0,$0,z0,z0,z0,z0,z0,z0,$0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0],[V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0,V0]],40),[L0.of([new JX(8,6),new JX(6,4),new JX(6,2),new JX(6,0)]).get()],$localize`Congratulations! You now know everything to play the game. Remember: to win, you have to place all of your pieces in shelters before your opponent does.`,$localize`You have not performed a triple jump. Try again!`)]}}function G0(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",9),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa(2).onClick(t.coord)}),fa()}if(2&e){const e=Sa().$implicit,t=Sa(2);ra("x",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.x+t.STROKE_WIDTH)("y",1.5*t.STROKE_WIDTH+t.SPACE_SIZE*e.coord.y+t.STROKE_WIDTH)("width",t.SPACE_SIZE-3*t.STROKE_WIDTH)("height",t.SPACE_SIZE-3*t.STROKE_WIDTH)}}function W0(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",6),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa(2).onClick(t.coord)}),fa()}if(2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function q0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).onClick(t.coord)}),fa(),la(2,G0,1,4,"rect",7),la(3,W0,1,6,"circle",8),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isShelter),Ts(1),ha("ngIf",e.hasPiece)}}function j0(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,q0,4,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function Z0(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",10),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngClass",n.viewInfo.boardInfo[e.y][e.x].shelterClasses),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function Y0(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=t.$implicit,n=Sa();Ta("id","sidePiece_0_",e,""),ra("cx",-n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function K0(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=Sa();Ta("id","sidePiece_1_",e,""),ra("cx",1715+n.PIECE_RADIUS)("cy",1670-e*n.PIECE_RADIUS)("r",n.PIECE_RADIUS-5)}}function Q0(e,t){if(1&e&&(Cn(),ga(0,"rect",13)),2&e){const e=Sa();ra("x",e.SPACE_SIZE*e.CENTRAL_ZONE_START.x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.CENTRAL_ZONE_START.y+e.STROKE_WIDTH)("width",e.CENTRAL_ZONE_SIZE.x*e.SPACE_SIZE)("height",e.CENTRAL_ZONE_SIZE.y*e.SPACE_SIZE)}}let X0=(()=>{class e extends eJ{constructor(e){super(e),this.ALL_SHELTERS=R0.ALL_SHELTERS,this.CENTRAL_ZONE_START=R0.CENTRAL_ZONE_TOP_LEFT,this.CENTRAL_ZONE_SIZE=new jX(R0.CENTRAL_ZONE_BOTTOM_RIGHT.x-R0.CENTRAL_ZONE_TOP_LEFT.x+1,R0.CENTRAL_ZONE_BOTTOM_RIGHT.y-R0.CENTRAL_ZONE_TOP_LEFT.y+1),this.viewInfo={dropPhase:!0,boardInfo:[],victory:[],lastMoveArrow:"",sidePieces:[20,20]},this.selected=Mw.empty(),this.jumpInConstruction=Mw.empty(),this.PIECE_RADIUS=this.SPACE_SIZE/2-this.STROKE_WIDTH,this.rules=U0.get(),this.availableMinimaxes=[new B0(this.rules,"ConspirateursMinimax")],this.encoder=F0,this.tutorial=(new H0).tutorial}ngOnInit(){this.updateBoard()}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}updateViewInfo(){const e=this.getState();this.viewInfo.dropPhase=e.isDropPhase(),this.viewInfo.boardInfo=[],this.viewInfo.lastMoveArrow="";for(let t=0;t<R0.HEIGHT;t++){this.viewInfo.boardInfo.push([]);for(let n=0;n<R0.WIDTH;n++){const r=new JX(n,t),i=e.getPieceAt(r),s={coord:r,squareClasses:[],shelterClasses:[],pieceClasses:[this.getPlayerClass(i)],hasPiece:i.isPlayer(),isShelter:!1,isOccupiedShelter:!1};this.viewInfo.boardInfo[t].push(s)}}this.viewInfo.sidePieces=e.getSidePieces(),this.updateOccupiedShelters(),this.updateSelected(),this.updateVictory()}updateOccupiedShelters(){for(const e of R0.ALL_SHELTERS){const t=this.viewInfo.boardInfo[e.y][e.x];t.isShelter=!0,t.hasPiece&&t.shelterClasses.push("highlighted")}}updateSelected(){if(this.selected.isPresent())if(this.jumpInConstruction.isPresent()){const e=this.jumpInConstruction.get(),t=e.getStartingCoord(),n=e.getEndingCoord();this.viewInfo.boardInfo[t.y][t.x].hasPiece=!1,this.viewInfo.boardInfo[n.y][n.x].pieceClasses=[this.getPlayerClass(this.getCurrentPlayer()),"selected"],this.viewInfo.boardInfo[n.y][n.x].hasPiece=!0;for(const r of e.coords)this.viewInfo.boardInfo[r.y][r.x].squareClasses.push("moved")}else{const e=this.selected.get();this.viewInfo.boardInfo[e.y][e.x].pieceClasses.push("selected")}}updateVictory(){const e=this.getState(),t=U0.get().getGameStatus(this.rules.node);if(!0===t.isEndGame)for(const n of R0.ALL_SHELTERS)e.getPieceAt(n)===t.winner&&this.viewInfo.boardInfo[n.y][n.x].squareClasses.push("victory")}showLastMove(){const e=this.rules.node.move.get();if(e.isDrop())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved");else if(e.isSimple())this.viewInfo.boardInfo[e.coord.y][e.coord.x].squareClasses.push("moved"),this.viewInfo.boardInfo[e.end.y][e.end.x].squareClasses.push("moved");else{this.viewInfo.lastMoveArrow="";for(const t of e.coords)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved"),this.viewInfo.lastMoveArrow+=t.x*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" ",this.viewInfo.lastMoveArrow+=t.y*this.SPACE_SIZE+this.SPACE_SIZE/2+this.STROKE_WIDTH,this.viewInfo.lastMoveArrow+=" "}}cancelMoveAttempt(){this.jumpInConstruction=Mw.empty(),this.selected=Mw.empty(),this.updateBoard()}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());const r=t.getState();if(r.getPieceAt(e)===t.getCurrentPlayer())return t.selected=Mw.of(e),t.jumpInConstruction=Mw.empty(),t.updateViewInfo(),TW.SUCCESS;if(t.jumpInConstruction.isPresent())return t.constructJump(e);if(t.selected.isPresent())return t.selectNextCoord(e);if(r.isDropPhase()){const n=x0.of(e);return NW(n.isSuccess(),"ConspirateursMove should be valid by construction"),t.chooseMove(n.get(),r)}return t.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE())})()}constructJump(e){var t=this;return Pw(function*(){const n=t.jumpInConstruction.get(),r=t.getState();if(e.equals(n.getEndingCoord()))return t.chooseMove(n,r);{const i=n.addJump(e);if(i.isFailure())return t.cancelMove(i.getReason());const s=t.rules.jumpLegality(i.get(),r);return s.isFailure()?t.cancelMove(s.getReason()):t.updateJump(i.get())}})()}updateJump(e){var t=this;return Pw(function*(){const n=t.getState();return t.rules.jumpHasPossibleNextTargets(e,n)?(t.jumpInConstruction=Mw.of(e),t.updateViewInfo(),TW.SUCCESS):t.chooseMove(e,n)})()}selectNextCoord(e){var t=this;return Pw(function*(){const n=t.selected.get(),r=D0.of(n,e);if(r.isSuccess())return t.chooseMove(r.get(),t.getState());{const r=L0.of([n,e]);return r.isFailure()?t.cancelMove(r.getReason()):t.updateJump(r.get())}})()}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-conspirateurs"]],features:[Go],decls:7,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 0 1915 1715","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base mid-stroke player0",3,"id",4,"ngFor","ngForOf"],["class","base mid-stroke player1",3,"id",4,"ngFor","ngForOf"],["class","base no-fill highlighted mid-stroke",4,"ngIf"],["id","lastJump",1,"base","no-fill"],[1,"base",3,"id","ngClass","click"],["class","base no-fill mid-stroke",3,"click",4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf"],[1,"base","no-fill","mid-stroke",3,"click"],[1,"base","no-fill","mid-stroke",3,"ngClass","click"],[1,"base","mid-stroke","player0",3,"id"],[1,"base","mid-stroke","player1",3,"id"],[1,"base","no-fill","highlighted","mid-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,j0,2,1,"g",1),la(2,Z0,2,5,"g",1),la(3,Y0,1,4,"circle",2),la(4,K0,1,4,"circle",3),la(5,Q0,1,4,"rect",4),ga(6,"polyline",5),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.ALL_SHELTERS),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[0])),Ts(1),ha("ngForOf",t.range(t.viewInfo.sidePieces[1])),Ts(1),ha("ngIf",t.viewInfo.dropPhase),Ts(1),ra("points",t.viewInfo.lastMoveArrow))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class J0{constructor(e,t){this.owner=e,this.otherPieceType=t}static of(e,t){return e===BK.ZERO?t?J0.ZERO_SECOND:J0.ZERO_FIRST:e===BK.ONE?t?J0.ONE_SECOND:J0.ONE_FIRST:J0.EMPTY}toString(){return`DiamPiece(${this.owner}, ${this.otherPieceType})`}}J0.encoder=FK.tuple([BK.numberEncoder,FK.booleanEncoder],e=>[e.owner,e.otherPieceType],e=>J0.of(e[0],e[1])),J0.EMPTY=new J0(VK.NONE,!1),J0.ZERO_FIRST=new J0(BK.ZERO,!1),J0.ZERO_SECOND=new J0(BK.ZERO,!0),J0.ONE_FIRST=new J0(BK.ONE,!1),J0.ONE_SECOND=new J0(BK.ONE,!0),J0.PLAYER_PIECES=[J0.ZERO_FIRST,J0.ZERO_SECOND,J0.ONE_FIRST,J0.ONE_SECOND];class e2 extends mJ{constructor(e,t){if(super(),this.target=e,this.piece=t,t===J0.EMPTY)throw new Error("Cannot drop an empty piece")}isDrop(){return!0}getTarget(){return this.target}equals(e){return!(this.target!==e.target||this.piece!==e.piece)}toString(){return`DiamMoveDrop(${this.target}, ${this.piece})`}}e2.encoder=FK.tuple([FK.numberEncoder(7),J0.encoder],e=>[e.target,e.piece],e=>new e2(e[0],e[1]));class t2 extends mJ{constructor(e,t){super(),this.start=e,this.moveDirection=t}static fromRepresentation(e,t){return new t2(new JX(e.x,3-e.y),t)}isDrop(){return!1}getTarget(){return"clockwise"===this.moveDirection?(this.start.x+1)%8:(this.start.x+7)%8}equals(e){return!(!1===this.start.equals(e.start)||this.moveDirection!==e.moveDirection)}toString(){return`DiamMoveShift(${this.start}, ${this.moveDirection})`}}t2.encoder=FK.tuple([JX.numberEncoder(8,4),FK.booleanEncoder],e=>[e.start,"clockwise"===e.moveDirection],e=>new t2(e[0],e[1]?"clockwise":"counterclockwise"));const n2=FK.disjunction(e2.encoder,t2.encoder,e=>e.isDrop());let r2=(()=>{class e{}return e.NO_MORE_PIECES_OF_THIS_TYPE=()=>$localize`You do not have any pieces of this type anymore.`,e.SPACE_IS_FULL=()=>$localize`You cannot play here: this space is already full.`,e.TARGET_STACK_TOO_HIGH=()=>$localize`You cannot add more pieces to the target stack, as it will contain more than 4 pieces.`,e.MUST_SHIFT_TO_NEIGHBOR=()=>$localize`To perform a shift, you must move the pieces to a neighboring space.`,e.MUST_SELECT_PIECE_FIRST=()=>$localize`You must first select either a piece from the side, or a stack of pieces to shift on the board.`,e})(),i2=(()=>{class e extends fJ{constructor(e,t,n){super(e,n),this.remainingPieces=t}static getInitialState(){const t=J0.EMPTY;return new e([[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t]],[4,4,4,4],0)}static fromRepresentation(t,n){const r=t.reverse(),i=[4,4,4,4];for(let s=0;s<e.HEIGHT;s++)for(let t=0;t<e.WIDTH;t++){const n=r[s][t];r[s][t]!==J0.EMPTY&&i[e.pieceIndex(n)]--}return NW(i.every(e=>e>=0),"Invalid DiamState representation uses too many pieces"),new e(r,i,n)}static pieceIndex(e){switch(e){case J0.ZERO_FIRST:return 0;case J0.ZERO_SECOND:return 1;case J0.ONE_FIRST:return 2;default:return Ow.expectToBe(e,J0.ONE_SECOND),3}}getRemainingPiecesOf(t){return this.remainingPieces[e.pieceIndex(t)]}getStackHeight(t){let n=0;for(let r=0;r<e.HEIGHT&&this.getPieceAtXY(t,r)!==J0.EMPTY;r++)n++;return n}}return e.WIDTH=8,e.HEIGHT=4,e})();class s2 extends PJ{constructor(){super(i2)}static get(){return s2.singleton.isAbsent()&&(s2.singleton=Mw.of(new s2)),s2.singleton.get()}applyLegalMove(e,t,n){return e.isDrop()?this.applyLegalDrop(e,t):this.applyLegalShift(e,t)}applyLegalDrop(e,t){const n=GK.copyBiArray(t.board);n[t.getStackHeight(e.target)][e.target]=e.piece;const r=GK.copyImmutableArray(t.remainingPieces);return r[i2.pieceIndex(e.piece)]-=1,new i2(n,r,t.turn+1)}applyLegalShift(e,t){const n=GK.copyBiArray(t.board),r=e.getTarget();let i=t.getStackHeight(r),s=e.start.y;for(;s<i2.HEIGHT&&t.getPieceAtXY(e.start.x,s)!==J0.EMPTY;)n[i][r]=t.getPieceAtXY(e.start.x,s),n[s][e.start.x]=J0.EMPTY,i++,s++;return new i2(n,t.remainingPieces,t.turn+1)}isLegal(e,t){return e.isDrop()?this.isDropLegal(e,t):this.isShiftLegal(e,t)}isDropLegal(e,t){return e.piece.owner!==t.getCurrentPlayer()?SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE()):0===t.getRemainingPiecesOf(e.piece)?SW.failure(r2.NO_MORE_PIECES_OF_THIS_TYPE()):this.dropHeightValidity(e,t)}dropHeightValidity(e,t){return t.getStackHeight(e.target)===i2.HEIGHT?SW.failure(r2.SPACE_IS_FULL()):SW.success(void 0)}isShiftLegal(e,t){return t.getPieceAt(e.start).owner!==t.getCurrentPlayer()?SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE()):this.shiftHeightValidity(e,t)}shiftHeightValidity(e,t){const n=t.getStackHeight(e.start.x)-e.start.y;return t.getStackHeight(e.getTarget())+n>i2.HEIGHT?SW.failure(r2.TARGET_STACK_TOO_HIGH()):SW.success(void 0)}getGameStatus(e){const t=this.findHighestAlignment(e.gameState);if(t.isPresent()){const n=e.gameState.getPieceAt(t.get());return NW(n.owner.isPlayer(),"highest alignment is owned by a player"),SJ.getVictory(n.owner)}return SJ.ONGOING}findHighestAlignment(e){for(let t=0;t<i2.WIDTH/2;t++)for(let n=i2.HEIGHT-1;n>0;n--){const r=e.getPieceAtXY(t,n),i=e.getPieceAtXY(t+i2.WIDTH/2,n);if(r!==J0.EMPTY&&r===i)return Mw.of(new JX(t,n))}return Mw.empty()}pieceCanMove(e,t){return!!this.isShiftLegal(new t2(t,"clockwise"),e).isSuccess()||!!this.isShiftLegal(new t2(t,"counterclockwise"),e).isSuccess()}}s2.singleton=Mw.empty();class o2 extends cJ{getListMoves(e){const t=e.gameState,n=this.getListDrops(t),r=this.getListShifts(t);return n.concat(r)}getListShifts(e){const t=[],n=this.getShiftSources(e);for(const r of n)for(const n of[new t2(r,"clockwise"),new t2(r,"counterclockwise")])s2.get().shiftHeightValidity(n,e).isSuccess()&&t.push(n);return t}getListDrops(e){const t=this.getRemainingPiecesForCurrentPlayer(e),n=[];for(let r=0;r<i2.WIDTH;r++)for(const i of t){const t=new e2(r,i);s2.get().dropHeightValidity(t,e).isSuccess()&&n.push(t)}return n}getRemainingPiecesForCurrentPlayer(e){const t=[];for(const n of J0.PLAYER_PIECES)this.currentPlayerCanDropPiece(e,n)&&t.push(n);return t}currentPlayerCanDropPiece(e,t){return e.getCurrentPlayer()===t.owner&&e.getRemainingPiecesOf(t)>0}getShiftSources(e){const t=[],n=e.getCurrentPlayer();for(let r=0;r<i2.HEIGHT;r++)for(let i=0;i<i2.WIDTH;i++)e.getPieceAtXY(i,r).owner===n&&t.push(new JX(i,r));return t}getBoardValue(e){const t=s2.get().getGameStatus(e);return new uJ(t.isEndGame?t.toBoardValue():0)}}const a2=J0.EMPTY,l2=J0.ZERO_FIRST,c2=J0.ZERO_SECOND,u2=J0.ONE_FIRST,h2=J0.ONE_SECOND;class d2{constructor(){this.tutorial=[kJ.informational($localize`Initial board and player pieces`,$localize`Diam's board is a circular board made of 8 spaces. Each player has 8 pieces: 4 of one color, and 4 of another color. Initially, the board is empty. All the remaining pieces are displayed next to the board: Dark's pieces are on the left, Light's pieces are on the right.`,i2.getInitialState()),kJ.fromMove($localize`Goal of the game`,$localize`At Diam, the goal is to align two of your pieces, having exactly the same color, on diametrically opposed spaces, on top of at least another piece. Note here that Dark does not win because the dark pieces are not on top of any other piece. You're playing Light. Here, you can win by dropping one of your pieces on the leftmost space. You can do it by clicking on the corresponding piece next to the board, and then on the space in which you want to drop your piece.<br/><br/>Do it!`,i2.fromRepresentation([[a2,a2,a2,a2,a2,a2,a2,a2],[a2,a2,a2,a2,a2,a2,a2,a2],[a2,a2,a2,a2,u2,a2,a2,a2],[l2,a2,a2,a2,l2,a2,a2,a2]],3),[new e2(0,J0.ONE_FIRST)],$localize`Congratulations, you won!`,$localize`Failed, you should drop your piece on the leftmost space, using the piece of the same color of the other piece you already have on the board.`),kJ.fromMove($localize`Types of move`,$localize`You can perform two types of move: either dropping one of your piece like you did in the previous step, or you can shift one of your pieces on the board to a neighboring space. You can pick any of your piece on the board, even if there are pieces on top of it. Only one condition applies: there can never be more  than 4 pieces in a space. When you pick a piece with other pieces on top of it, all the other pieces move with yours.<br/><br/>You're playing Dark, try to move one of your piece that is already on the board.`,i2.fromRepresentation([[a2,a2,a2,a2,a2,a2,a2,a2],[a2,a2,a2,a2,h2,a2,a2,a2],[a2,a2,a2,a2,l2,a2,a2,a2],[u2,a2,a2,a2,c2,a2,a2,a2]],4),[t2.fromRepresentation(new JX(4,3),"counterclockwise"),t2.fromRepresentation(new JX(4,3),"clockwise"),t2.fromRepresentation(new JX(4,2),"counterclockwise"),t2.fromRepresentation(new JX(4,2),"clockwise")],$localize`Congratulations!`,$localize`Failed, try to move one of your piece that is already on the board.`),kJ.fromMove($localize`Special case`,$localize`It can happen that, in a single turn, both players reach an alignment. If it is the case, only the player with the highest alignment wins.<br/><br/>Here, playing Dark, you can win by performing such a move, do it!`,i2.fromRepresentation([[a2,a2,a2,a2,l2,a2,a2,a2],[a2,a2,a2,a2,h2,a2,a2,l2],[a2,a2,a2,a2,l2,a2,a2,h2],[a2,u2,a2,a2,c2,a2,a2,u2]],8),[t2.fromRepresentation(new JX(4,2),"counterclockwise")],$localize`Congratulations!`,$localize`Failed, try to shift a stack of pieces to the left.`)]}}function p2(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"path",6),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onSpaceClick(t)}),fa(),pa(2,"path",7),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onSpaceClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),Ta("id","click_",e,""),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.BOARD_PATHS[e]),Ts(1),ha("ngClass",n.viewInfo.boardInfo[e].spaceClasses),ra("d",n.DECORATION_PATHS[e])}}function f2(e,t){if(1&e){const e=va();Cn(),pa(0,"g",9),Ea("click",function(){const t=Gt(e).$implicit,n=Sa().$implicit;return Sa().onPieceInGameClick(n,t.y)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",Sa().$implicit,"_",e.y,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}function g2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,f2,3,8,"g",8),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",n.viewInfo.boardInfo[e].pieces)}}function m2(e,t){if(1&e){const e=va();Cn(),pa(0,"g",12),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onRemainingPieceClick(t.actualPiece)}),ga(1,"use",10),ga(2,"use",11),fa()}if(2&e){const e=t.$implicit;Ia("id","piece_",e.actualPiece.owner.value,"_",e.actualPiece.otherPieceType?1:0,""),ha("ngClass",e.foregroundClasses),Ts(1),ha("ngClass",e.backgroundClasses),ra("x",e.drawPosition.x)("y",e.drawPosition.y),Ts(1),ra("x",e.drawPosition.x)("y",e.drawPosition.y)}}const y2=function(){return[0,1,2,3,4,5,6,7]},v2=function(){return[2,1,3,0,4,7,5,6]};class _2 extends eJ{constructor(e){super(e),this.BOARD_PATHS=["M 2.8324855,277.57643 164.46619,228.81694 170.57257,148.42756 32.571357,104.19835 Z","M 170.57257,148.42237 246.4213,96.276913 195.13813,2.0233391 32.571357,104.19315 Z","m 195.14159,2.0268021 205.0898,0.010821 -52.1686,94.2453509 -101.64149,-0.0057 z","M 348.06279,96.281239 400.23529,2.0330788 564.39307,104.19207 424.66384,148.41891 Z","m 424.66384,148.42237 7.27882,80.37683 164.9712,48.72701 -32.52079,-173.33068 z","m 431.94266,228.80481 -75.73854,62.15055 79.06197,135.86929 161.64688,-149.29953 z","m 356.20412,290.9506 79.06197,135.86929 -268.2864,0.0433 74.14082,-135.90175 z","M 241.12051,290.96379 166.97969,426.86556 2.8324855,277.57708 164.46619,228.81759 Z"],this.DECORATION_PATHS=["m 170.57257,148.42302 v 40.08918 l -6.11049,80.38634 v -40.09025 z","m 170.57646,188.51696 v -40.08918 l 75.8509,-52.140047 v 40.086147 z","m 246.42323,96.285785 v 40.086155 l 101.63847,-0.003 0.001,-40.082256 z","m 424.66037,148.42345 v 40.08377 l -76.60213,-52.14178 10e-4,-40.082033 z","m 424.66037,148.42193 v 40.08377 l 7.27884,80.37445 v -40.08377 z","m 435.26609,466.90582 v -40.08615 l 161.64688,-149.2995 8.9e-4,40.08701 z","m 166.97969,426.86815 v 40.08638 l 268.28379,-0.0433 v -40.08031 z","m 2.8324855,277.57297 v 40.08636 L 166.97969,466.94782 v -40.08636 z"],this.selected=Mw.empty(),this.viewInfo={boardInfo:[],remainingPieces:[]},this.rules=s2.get(),this.availableMinimaxes=[new o2(this.rules,"DiamDummyMinimax")],this.encoder=n2,this.tutorial=(new d2).tutorial}ngOnInit(){this.updateBoard()}onSpaceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e);return n.isFailure()?t.cancelMove(n.getReason()):t.onSpaceClickAfterCheck(e)})()}onSpaceClickAfterCheck(e){var t=this;return Pw(function*(){if(t.selected.isPresent()){const n=t.selected.get();let r;if("pieceFromReserve"===n.type)r=new e2(e,n.piece);else if((n.position.x+1)%i2.WIDTH===e)r=new t2(n.position,"clockwise");else{if((n.position.x+(i2.WIDTH-1))%i2.WIDTH!==e)return t.cancelMove(r2.MUST_SHIFT_TO_NEIGHBOR());r=new t2(n.position,"counterclockwise")}return t.chooseMove(r,t.getState())}return t.cancelMove(r2.MUST_SELECT_PIECE_FIRST())})()}onPieceInGameClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.getState().getPieceAtXY(e,t).owner===n.getCurrentPlayer()?(n.selected=Mw.of({type:"pieceFromBoard",position:new JX(e,t)}),n.updateViewInfo(),TW.SUCCESS):n.selected.isPresent()?n.onSpaceClickAfterCheck(e):n.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE())})()}onRemainingPieceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay(t.getPieceId(e));return n.isFailure()?t.cancelMove(n.getReason()):e.owner===t.getCurrentPlayer()?(t.selected=Mw.of({type:"pieceFromReserve",piece:e}),t.updateViewInfo(),TW.SUCCESS):t.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE())})()}getPieceId(e){return"#piece_"+e.owner.value+"_"+(e.otherPieceType?1:0)}updateBoard(){this.updateViewInfo(),this.rules.node.move.isPresent()&&this.showLastMove()}getLastMovedFromDrop(e,t){const n=this.getDrawPositionRemainingPiece(e.piece,t.getRemainingPiecesOf(e.piece)-1),r=e.getTarget(),i=t.getStackHeight(e.getTarget()),s=this.getDrawPositionOnBoard(r,i),o=new JX(r,i);return[{start:Mw.empty(),end:o,startDrawPosition:n,endDrawPosition:s}]}getLastMovedFromShift(e,t){const n=e.start.x,r=e.getTarget();let i=t.getStackHeight(r);const s=[];for(let o=e.start.y;o<i2.HEIGHT&&t.getPieceAtXY(n,o)!==J0.EMPTY;o++,i++)s.push({start:Mw.of(new JX(n,o)),end:new JX(r,i),startDrawPosition:this.getDrawPositionOnBoard(n,o),endDrawPosition:this.getDrawPositionOnBoard(r,i)});return s}updateViewInfo(){this.updateBoardInfo(),this.updateRemainingPiecesInfo()}updateBoardInfo(){for(let e=0;e<i2.WIDTH;e++)this.viewInfo.boardInfo[e]={x:e,spaceClasses:[],pieces:this.getPieces(e)}}showLastMove(){this.showLastMoveOnSpaces(),this.showLastMoveOnPieces()}showLastMoveOnSpaces(){const e=this.rules.node.move;NW(e.isPresent(),"showLastMoveOnSpaces called without a last move");const t=e.get();for(let n=0;n<i2.WIDTH;n++){const e=[];t.isDrop()?t.getTarget()===n&&e.push("moved"):(t.getTarget()===n||t.start.x===n)&&e.push("moved"),this.viewInfo.boardInfo[n].spaceClasses=e}}showLastMoveOnPieces(){const e=this.rules.node.move;NW(e.isPresent(),"showLastMoveOnPieces called without a last move");const t=e.get(),n=this.getPreviousState();let r=[];r=t.isDrop()?this.getLastMovedFromDrop(t,n):this.getLastMovedFromShift(t,n);for(const i of r)this.viewInfo.boardInfo[i.end.x].pieces[i.end.y].foregroundClasses.push("last-move")}updateRemainingPiecesInfo(){const e=this.getCurrentPlayer();this.viewInfo.remainingPieces=[];const t=this.isPlayerTurn();for(const n of J0.PLAYER_PIECES){const r=this.getState().getRemainingPiecesOf(n);for(let i=0;i<r;i++){const s=[];this.isTopPieceOfReserveAndSelected(i,r,n)&&s.push("selected"),t&&i===r-1&&n.owner===e&&s.push("clickable-hover"),this.viewInfo.remainingPieces.push({backgroundClasses:["player"+n.owner.value+(n.otherPieceType?"-alternate":"")],foregroundClasses:s,y:i,drawPosition:this.getDrawPositionRemainingPiece(n,i),actualPiece:n})}}}isTopPieceOfReserveAndSelected(e,t,n){if(this.selected.isPresent()){const r=this.selected.get();return"pieceFromReserve"===r.type&&r.piece===n&&e===t-1}return!1}getDrawPositionRemainingPiece(e,t){let n,r;return n=e.owner===BK.ZERO?-100:600,r=e.otherPieceType?100:450,new JX(n,r).getNext(new jX(0,-t*_2.PIECE_HEIGHT))}getPieces(e){const t=this.rules.findHighestAlignment(this.getState()),n=this.isPlayerTurn(),r=[];for(let i=0;i<i2.HEIGHT;i++){const s=this.getState().getPieceAtXY(e,i),o=new JX(e,i);if(s!==J0.EMPTY){const a=[];this.pieceFromBoardIsSelected(e,i)&&a.push("selected"),this.isVictory(e,i,t)&&a.push("victory-stroke"),n&&this.rules.pieceCanMove(this.getState(),o)&&a.push("clickable-hover"),r.push({backgroundClasses:["player"+s.owner.value+(s.otherPieceType?"-alternate":"")],foregroundClasses:a,y:i,drawPosition:this.getDrawPositionOnBoard(e,i),actualPiece:s})}}return r}pieceFromBoardIsSelected(e,t){if(this.selected.isPresent()){const n=this.selected.get();return"pieceFromBoard"===n.type&&n.position.x===e&&n.position.y===t}return!1}isVictory(e,t,n){if(n.isPresent()){const r=n.get();return r.x%4==e%4&&r.y===t}return!1}getDrawPositionOnBoard(e,t){return _2.CENTER[e].getNext(new jX(0,-t*_2.PIECE_HEIGHT))}cancelMoveAttempt(){this.selected=Mw.empty(),this.updateBoard()}}_2.CENTER=[new JX(40,160),new JX(100,50),new JX(255,2),new JX(400,50),new JX(460,160),new JX(400,270),new JX(255,320),new JX(100,270)],_2.PIECE_HEIGHT=36,_2.\u0275fac=function(e){return new(e||_2)(ua(AW))},_2.\u0275cmp=Je({type:_2,selectors:[["app-diam"]],features:[Go],decls:8,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-110 -120 800 710","preserveAspectRatio","xMidYMid meet"],["id","piece"],["d","M 1.4319358,16.913484 V 49.329973 H 1.482219 A 39.498175,14.141265 0 0 0 40.938372,63.011675 39.498175,14.141265 0 0 0 80.394523,49.329973 h 0.06885 V 16.913484 h -0.02864 A 39.769348,14.114049 0 0 1 40.941466,29.431707 39.769348,14.114049 0 0 1 1.4481812,16.913484 Z"],["cx","40.952408","cy","15.225397","rx","39.769348","ry","14.11405"],[4,"ngFor","ngForOf"],["class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],[1,"base","mid-stroke",3,"id","ngClass","click"],[1,"base","mid-stroke","high-brightness",3,"ngClass","click"],["pointer-events","fill","class","base-no-fill no-fill mid-small-stroke",3,"id","ngClass","click",4,"ngFor","ngForOf"],["pointer-events","fill",1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"],[0,"xlink","href","#piece",1,"base","mid-stroke",3,"ngClass"],[0,"xlink","href","#piece"],[1,"base-no-fill","no-fill","mid-small-stroke",3,"id","ngClass","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"g",1),ga(3,"path",2),ga(4,"ellipse",3),fa(),fa(),la(5,p2,3,5,"g",4),la(6,g2,2,1,"g",4),la(7,m2,3,8,"g",5),fa()),2&e&&(Ts(5),ha("ngForOf",wu(3,y2)),Ts(1),ha("ngForOf",wu(4,v2)),Ts(1),ha("ngForOf",t.viewInfo.remainingPieces))},directives:[tp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class C2{constructor(e,t){this.offset=e,this.constant=t}static fromTwoCoords(e,t){const n=e.x,r=t.x,i=e.y,s=t.y,o=n+i,a=r+s;return n===r&&i!==s&&o!==a?Mw.of(C2.constantQ(n)):n!==r&&i===s&&o!==a?Mw.of(C2.constantR(i)):n!==r&&i!==s&&o===a?Mw.of(C2.constantS(o)):Mw.empty()}static constantQ(e){return new C2(e,"q")}static constantR(e){return new C2(e,"r")}static constantS(e){return new C2(e,"s")}static areOnSameLine(e){if(e.length<2)return!0;const t=C2.fromTwoCoords(e[0],e[1]);if(t.isAbsent())return!1;const n=t.get();for(const r of e.slice(2))if(!1===n.contains(r))return!1;return!0}toString(){return`Line(${this.constant}, ${this.offset})`}equals(e){return this===e||!(this.offset!==e.offset||this.constant!==e.constant)}contains(e){switch(this.constant){case"q":return e.x===this.offset;case"r":return e.y===this.offset;case"s":return e.x+e.y===this.offset}}getDirection(){switch(this.constant){case"q":return rJ.DOWN;case"r":return rJ.RIGHT;case"s":return rJ.DOWN_LEFT}}}class E2 extends fJ{constructor(e,t,n,r,i,s){super(t,e),this.board=t,this.width=n,this.height=r,this.excludedCases=i,this.empty=s,NW(this.excludedCases.length<this.height/2+1,"Invalid excluded cases specification for HexagonalGameState.")}static neighbors(e,t){return[new JX(e.x+t,e.y-t),new JX(e.x+t,e.y),new JX(e.x-t,e.y+t),new JX(e.x-t,e.y),new JX(e.x,e.y+t),new JX(e.x,e.y-t)]}setAt(e,t){if(this.isOnBoard(e))return this.setAtUnsafe(e,t);throw new Error("Setting coord not on board: "+e+".")}equalsT(e,t){if(this===e)return!0;if(this.width!==e.width||this.height!==e.height||!1===t(this.empty,e.empty)||this.excludedCases.length!==e.excludedCases.length)return!1;for(let n=0;n<this.excludedCases.length;n++)if(this.excludedCases[n]!==e.excludedCases[n])return!1;for(const n of this.allCoords())if(!1===t(this.getPieceAt(n),e.getPieceAt(n)))return!1;return!0}allCoords(){const e=[];return this.forEachCoord(t=>{e.push(t)}),e}allLines(){const e=[];for(let t=0;t<this.width;t++)e.push(C2.constantQ(t));for(let t=0;t<this.height;t++)e.push(C2.constantR(t));for(let t=this.excludedCases.length;t<this.height+this.excludedCases.length;t++)e.push(C2.constantS(t));return e}getEntranceOnLine(e){let t,n;switch(e.constant){case"q":return n=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new JX(e.offset,n));case"r":return t=null!=this.excludedCases[e.offset]?this.excludedCases[e.offset]:0,this.findEntranceFrom(e,new JX(t,e.offset));case"s":return this.findEntranceFrom(e,e.offset<this.width?new JX(e.offset,0):new JX(this.width-1,e.offset-this.width+1))}}findEntranceFrom(e,t){const n=e.getDirection();let r=t;for(let s=0;s<Math.max(this.width,this.height);s++){if(this.isOnBoard(r))return r;r=r.getNext(n)}const i=MW.logError("HexagonalGameState.findEntranceFrom","could not find a board entrance, board must be invalid",{start:t.toString(),line:e.toString()});throw new Error(i.getReason())}}class w2{constructor(e,t,n){this.owner=e,this.size=t,this.source=n}static append(e,t){return new w2(e.owner,e.size+t.size,e.source||t.source)}getValue(){return w2.encoder.encodeNumber(this)}getOwner(){return this.owner}belongsTo(e){return this.owner===e}containsSource(){return this.source}isEmpty(){return 0===this.size}getSize(){return this.size}toString(){return"DvonnPieceStack("+this.owner.toString()+", "+this.size+", "+this.source+")"}}w2.sizeEncoder=FK.numberEncoder(49),w2.encoder=FK.tuple([FK.booleanEncoder,BK.numberEncoder,w2.sizeEncoder],e=>[e.source,e.owner,e.size],e=>new w2(e[1],e[2],e[0])),w2.MAX_SIZE=49,w2.EMPTY=new w2(VK.NONE,0,!1),w2.UNREACHABLE=new w2(VK.NONE,-1,!1),w2.PLAYER_ZERO=new w2(BK.ZERO,1,!1),w2.PLAYER_ONE=new w2(BK.ONE,1,!1),w2.SOURCE=new w2(VK.NONE,1,!0);let b2=(()=>{class e extends E2{constructor(t,n,r){super(n,t,e.WIDTH,e.HEIGHT,e.EXCLUDED_CASES,w2.EMPTY),this.alreadyPassed=r}static balancedBoard(){const e=w2.UNREACHABLE,t=w2.PLAYER_ZERO,n=w2.PLAYER_ONE,r=w2.SOURCE;return[[e,e,t,n,n,n,t,t,n,r,n],[e,n,n,t,t,t,n,n,t,n,n],[n,n,n,n,t,r,n,t,t,t,t],[t,t,n,t,t,n,n,n,t,t,e],[t,r,t,n,n,t,t,t,n,e,e]]}static isOnBoard(t){return!t.isNotInRange(e.WIDTH,e.HEIGHT)&&e.balancedBoard()[t.y][t.x]!==w2.UNREACHABLE}static getInitialState(){return new e(e.balancedBoard(),0,!1)}getAllPieces(){const t=[];for(let n=0;n<e.HEIGHT;n++)for(let r=0;r<e.WIDTH;r++){const e=new JX(r,n);this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()&&t.push(e)}return t}numberOfNeighbors(e){return E2.neighbors(e,1).filter(e=>this.isOnBoard(e)&&!1===this.getPieceAt(e).isEmpty()).length}setAtUnsafe(t,n){const r=GK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.turn,this.alreadyPassed)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==w2.UNREACHABLE}}return e.WIDTH=11,e.HEIGHT=5,e.EXCLUDED_CASES=[2,1],e})();class S2 extends C1{constructor(e,t){super(e,t)}static of(e,t){if(-1===e.x&&-1===e.y&&-2===t.x&&-2===t.y)return S2.PASS;if(!b2.isOnBoard(e))throw new Error("Starting coord of DvonnMove must be on the board, not at "+e.toString());if(!b2.isOnBoard(t))throw new Error("End coord of DvonnMove must be on the board, not at "+e.toString());if(e.y===t.y)return new S2(e,t);if(e.x===t.x)return new S2(e,t);if(e.x+e.y===t.x+t.y)return new S2(e,t);throw new Error("Invalid move")}toString(){return this===S2.PASS?"DvonnMove.PASS":"DvonnMove("+this.coord+"->"+this.end+")"}length(){return this.coord.y===this.end.y?Math.abs(this.coord.x-this.end.x):Math.abs(this.coord.y-this.end.y)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}}S2.PASS=new S2(new JX(-1,-1),new JX(-2,-2)),S2.encoder=new class extends FK{maxValue(){return 42148}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return S2.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new S2(new JX((e=e/16|0)%16,r),new JX(n,t))}};let P2=(()=>{class e{}return e.NOT_PLAYER_PIECE=()=>$localize`You must select a piece or a stack of your color.`,e.EMPTY_STACK=()=>$localize`You must select a stack.`,e.TOO_MANY_NEIGHBORS=()=>$localize`This stack cannot be moved because all 6 of its neighbors are occupied. You must select a stack with strictly less than 6 neighbors.`,e.CANT_REACH_TARGET=()=>$localize`This stack cannot move because it could never land on another piece.`,e.INVALID_MOVE_LENGTH=()=>$localize`A stack must always be moved by as many spaces as there are pieces in the stack.`,e.EMPTY_TARGET_STACK=()=>$localize`The stack must land on an occupied space.`,e})();class O2 extends PJ{static getGameStatus(e){const t=e.gameState,n=O2.getScores(t);return 0===O2.getMovablePieces(t).length?n[0]>n[1]?SJ.ZERO_WON:n[0]<n[1]?SJ.ONE_WON:SJ.DRAW:SJ.ONGOING}static getMovablePieces(e){return O2.getFreePieces(e).filter(t=>O2.pieceHasTarget(e,t))}static getFreePieces(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).belongsTo(e.getCurrentPlayer())&&e.numberOfNeighbors(t)<6)}static pieceHasTarget(e,t){const n=e.getPieceAt(t).getSize();return void 0!==E2.neighbors(t,n).find(t=>e.isOnBoard(t)&&!e.getPieceAt(t).isEmpty())}static pieceTargets(e,t){const n=e.getPieceAt(t).getSize();return E2.neighbors(t,n).filter(t=>e.isOnBoard(t)&&!1===e.getPieceAt(t).isEmpty())}static getScores(e){let t=0,n=0;return e.getAllPieces().map(r=>{const i=e.getPieceAt(r);i.belongsTo(BK.ZERO)?t+=i.getSize():i.belongsTo(BK.ONE)&&(n+=i.getSize())}),[t,n]}isMovablePiece(e,t){NW(e.isOnBoard(t),"piece is not on the board");const n=e.getPieceAt(t);return n.getSize()<1?TW.failure(P2.EMPTY_STACK()):n.belongsTo(e.getCurrentPlayer())?e.numberOfNeighbors(t)>=6?TW.failure(P2.TOO_MANY_NEIGHBORS()):O2.pieceHasTarget(e,t)?TW.SUCCESS:TW.failure(P2.CANT_REACH_TARGET()):TW.failure(P2.NOT_PLAYER_PIECE())}canOnlyPass(e){return 0===O2.getMovablePieces(e).length}sourceCoords(e){return e.getAllPieces().filter(t=>e.getPieceAt(t).containsSource())}markPiecesConnectedTo(e,t,n){E2.neighbors(t,1).forEach(t=>{e.isOnBoard(t)&&!n[t.y][t.x]&&!e.getPieceAt(t).isEmpty()&&(n[t.y][t.x]=!0,this.markPiecesConnectedTo(e,t,n))})}removeDisconnectedPieces(e){const t=GK.createTable(b2.WIDTH,b2.HEIGHT,!1);this.sourceCoords(e).forEach(n=>{t[n.y][n.x]=!0,this.markPiecesConnectedTo(e,n,t)});let n=e;return n.getAllPieces().forEach(e=>{t[e.y][e.x]||(n=n.setAt(e,w2.EMPTY))}),n}applyLegalMove(e,t,n){if(e===S2.PASS)return new b2(t.board,t.turn+1,!0);{const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end),i=t.setAt(e.coord,w2.EMPTY).setAt(e.end,w2.append(n,r));return this.removeDisconnectedPieces(new b2(i.board,t.turn+1,!1))}}isLegal(e,t){if(0===O2.getMovablePieces(t).length)return e!==S2.PASS||t.alreadyPassed?SW.failure(lJ.MUST_PASS()):SW.success(void 0);if(e===S2.PASS)return SW.failure(lJ.CANNOT_PASS());const n=this.isMovablePiece(t,e.coord);if(n.isFailure())return n.toFailedFallible();const r=t.getPieceAt(e.coord);return e.length()!==r.getSize()?SW.failure(P2.INVALID_MOVE_LENGTH()):t.getPieceAt(e.end).isEmpty()?SW.failure(P2.EMPTY_TARGET_STACK()):SW.success(void 0)}getGameStatus(e){return O2.getGameStatus(e)}}class T2 extends cJ{getListMoves(e){const t=e.move,n=e.gameState,r=[];return O2.getMovablePieces(n).forEach(e=>O2.pieceTargets(n,e).forEach(t=>{const n=S2.of(e,t);r.push(n)})),0===r.length&&!1===t.equalsValue(S2.PASS)&&r.push(S2.PASS),r}getBoardValue(e){const t=e.gameState,n=O2.getScores(t);return 0===O2.getMovablePieces(t).length?new uJ(n[0]>n[1]?Number.MIN_SAFE_INTEGER:n[0]<n[1]?Number.MAX_SAFE_INTEGER:0):new uJ(n[0]-n[1])}}class I2 extends T2{getListMoves(e){const t=e.gameState,n=super.getListMoves(e),r=t.getCurrentPlayer().getOpponent();return GK.sortByDescending(n,e=>{NW(e!==S2.PASS,"Cannot sort with DvonnMove.PASS");const n=t.getPieceAt(e.end);return n.belongsTo(r)?n.getSize():0}),n}getBoardValue(e){const t=O2.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState,r=O2.getScores(n),i=n.getAllPieces(),s=i.length,o=i.filter(e=>n.getPieceAt(e).belongsTo(BK.ZERO)).length,a=i.filter(e=>n.getPieceAt(e).belongsTo(BK.ONE)).length;return new uJ((a*r[1]-o*r[0])/s)}}const k2=w2.EMPTY,A2=w2.UNREACHABLE,M2=w2.SOURCE,N2=w2.PLAYER_ZERO,R2=w2.PLAYER_ONE,x2=new w2(BK.ZERO,2,!1),D2=new w2(BK.ONE,2,!1),L2=new w2(BK.ZERO,4,!1),F2=new w2(BK.ONE,4,!1);class U2{constructor(){this.tutorial=[kJ.anyMove($localize`Moving`,$localize`At Dvonn, each hexagonal space contains a stack of pieces.
        If no number is indicated on a stack, it means that it only contains one piece.
        The number written on a stack indicates the number of pieces within that stack, hence the number of points its owner gets.
        The owner of a stack is the one that has a piece at the top of the stack.
        Only the owner of a stack can move it.
        A stack cannot be moved if it is surrounded by 6 other stacks.
        A stack is moved by as many spaces as there are pieces within, in a straight line, and it should land on an occupied space.
        This line cannot move along the vertex of two neighboring spaces, as would a vertical move.
        Therefore, there are six possible directions.
        The player with dark pieces starts.<br/><br/>
        You're playing Dark, click on a stack and move it by one space.`,b2.getInitialState(),S2.of(new JX(2,0),new JX(3,0)),$localize`Congratulations!`),kJ.fromPredicate($localize`Disconnection`,$localize`Pieces with a lightning strike are called "sources".
        When a stack is not directly nor indirectly connected to a source, it is removed from the board.<br/><br/>
        You're playing Dark, try to disconnect the stack of 4 pieces from your opponent. There are two ways of doing that, one is better than the other: try to find that one!`,new b2([[A2,A2,R2,M2,k2,k2,k2,k2,k2,k2,k2],[A2,k2,N2,k2,k2,k2,k2,k2,k2,k2,k2],[k2,k2,F2,k2,k2,k2,k2,R2,M2,k2,k2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,k2,A2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,A2,A2]],0,!1),S2.of(new JX(2,1),new JX(2,0)),(e,t)=>e.end.equals(new JX(3,0))?TW.failure($localize`You have successfully disconnected the stack of 4 pieces of your opponent, but on the next move your opponent will be able to move on your new stack, and to win the game! There exists a better outcome of this situation, try to find it.`):(NW(e.end.equals(new JX(2,0)),"player made an impossible move"),TW.SUCCESS),$localize`Nice, you have disconnected 4 pieces of your opponent, and your new stack cannot be reached by your opponent!
        Your opponent therefore lost 5 points: 4 from the disconnected stack, and one from the stack on which you moved.
        Disconnected stacks will not be visible at the next turn.`),kJ.fromPredicate($localize`Moving on a source`,$localize`You are allowed to move your stacks on any other stack.
        This means that you can take control of a source by moving one of your stack on top of it.
        This way, you know that this stack may never be disconnected, as it contains a source.<br/><br/>
        You're playing Dark and you can take control of a source, do it!`,new b2([[A2,A2,M2,R2,k2,k2,k2,k2,k2,k2,k2],[A2,N2,N2,k2,k2,k2,k2,k2,k2,k2,k2],[k2,R2,N2,R2,k2,k2,N2,D2,M2,k2,k2],[k2,k2,R2,k2,k2,k2,k2,k2,k2,k2,A2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,A2,A2]],0,!1),S2.of(new JX(2,1),new JX(2,0)),(e,t)=>e.end.equals(new JX(2,0))?TW.SUCCESS:TW.failure($localize`You have not taken possession of a source, try again.`),$localize`Congratulations! However, note that your opponent could later take possession of one of your stack that contains a source, so watch out when you take control of sources!`),kJ.informational($localize`Passing`,$localize`It can happen that you have no possible move to make.
        If this is the case, and if your opponent can still move, you must pass your turn.<br/><br/>
        This is a situation that occurs here for Dark.`,new b2([[A2,A2,M2,k2,k2,k2,k2,k2,k2,k2,k2],[A2,k2,x2,k2,k2,k2,k2,k2,k2,k2,k2],[k2,k2,D2,k2,k2,k2,k2,D2,M2,L2,k2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,k2,A2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,A2,A2]],0,!1)),kJ.fromMove($localize`End of the game`,$localize`When no more move is possible for both players, the game ends and the player with the most points wins.<br/><br/>
        Make your last move.`,new b2([[A2,A2,M2,k2,k2,k2,k2,k2,k2,k2,k2],[A2,k2,N2,k2,k2,k2,k2,k2,k2,k2,k2],[k2,k2,k2,k2,k2,k2,k2,k2,M2,L2,k2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,k2,A2],[k2,k2,k2,k2,k2,k2,k2,k2,k2,A2,A2]],0,!1),[S2.of(new JX(2,1),new JX(2,0))],$localize`Congratulations, you won 6 - 0!`,$localize`Bad idea, by moving on the source you would have won a point.`)]}}function B2(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa().$implicit,t=Sa().$implicit,n=Sa();ha("ngClass",n.getPieceClasses(e)),ra("cx",n.getCenterAt(t).x)("cy",n.getCenterAt(t).y)("r",n.SPACE_SIZE)}}function V2(e,t){if(1&e&&(Cn(),ga(0,"polygon",11)),2&e){const e=Sa().$implicit,t=Sa().$implicit,n=Sa();ra("transform",1===e.getSize()?"translate("+(n.getCenterAt(t).x-18)+" "+(n.getCenterAt(t).y-16)+") scale(0.10)":"translate("+(n.getCenterAt(t).x-3)+" "+(n.getCenterAt(t).y-12)+") scale(0.07)")}}function $2(e,t){if(1&e){const e=va();Cn(),pa(0,"text",12),Ea("click",function(){Gt(e);const t=Sa(2).$implicit;return Sa().onClick(t.x,t.y)}),Qa(1),fa()}if(2&e){const e=Sa().$implicit,t=Sa().$implicit,n=Sa();ra("x",e.containsSource()?n.getCenterAt(t).x-7:n.getCenterAt(t).x)("y",n.getCenterAt(t).y),Ts(1),Xa(e.getSize())}}function z2(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa().onClick(t.x,t.y)}),ga(1,"polyline",6),la(2,B2,1,4,"circle",7),la(3,V2,1,1,"polygon",8),la(4,$2,2,3,"text",9),fa()}if(2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa();Ia("id","click_",n.x,"_",n.y,""),Ts(1),ra("points",r.getHexaCoordsAt(n)),Ts(1),ha("ngIf",e.getSize()>0),Ts(1),ha("ngIf",e.containsSource()),Ts(1),ha("ngIf",e.getSize()>1)}}const H2=function(e){return[e]};function G2(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,z2,5,6,"g",4),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",bu(1,H2,n.state.getPieceAt(e)))}}function W2(e,t){if(1&e&&(Cn(),pa(0,"text",16),Qa(1),fa()),2&e){const e=Sa().$implicit,t=Sa();ra("x",t.getCenterAt(e.coord).x)("y",t.getCenterAt(e.coord).y),Ts(1),Xa(e.caseContent.getSize())}}function q2(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",13),ga(2,"circle",14),la(3,W2,2,3,"text",15),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ra("points",n.getHexaCoordsAt(e.coord)),Ts(1),Ia("id","captured_",e.coord.x,"_",e.coord.y,""),ha("ngClass",n.getPieceClasses(e.caseContent)),ra("cx",n.getCenterAt(e.coord).x)("cy",n.getCenterAt(e.coord).y)("r",n.SPACE_SIZE),Ts(1),ha("ngIf",e.caseContent.getSize()>1)}}function j2(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",17),ga(2,"polyline",17),ya()),2&e){const e=Sa();Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().coord)),Ts(1),ra("points",e.getHexaCoordsAt(e.lastMove.get().end))}}function Z2(e,t){if(1&e&&(Cn(),ga(0,"polyline",18)),2&e){const e=Sa();ra("points",e.getHexaCoordsAt(e.chosen.get()))}}let Y2=(()=>{class e extends tJ{constructor(e){super(e),this.lastMove=Mw.empty(),this.chosen=Mw.empty(),this.disconnecteds=[],this.rules=new O2(b2),this.availableMinimaxes=[new T2(this.rules,"DvonnMinimax"),new I2(this.rules,"DvonnMinimaxMaximizeStacks")],this.encoder=S2.encoder,this.tutorial=(new U2).tutorial,this.SPACE_SIZE=30,this.canPass=!1,this.scores=Mw.of(O2.getScores(this.rules.node.gameState)),this.hexaLayout=new iJ(1.5*this.SPACE_SIZE,new JX(-this.SPACE_SIZE,2*this.SPACE_SIZE),oJ.INSTANCE),this.state=this.rules.node.gameState,this.hexaBoard=this.rules.node.gameState.board}hideLastMove(){this.lastMove=Mw.empty()}updateBoard(){this.cancelMoveAttempt(),this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move,this.disconnecteds=[],this.lastMove.isPresent()?this.calculateDisconnecteds():this.hideLastMove(),this.canPass=this.rules.canOnlyPass(this.state),this.scores=Mw.of(O2.getScores(this.state))}calculateDisconnecteds(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.gameState;for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[n].length;r++){const i=new JX(r,n);if(!0===t.isOnBoard(i)&&!1===i.equals(this.lastMove.get().coord)){const s=t.getPieceAt(i),o=e.getPieceAt(i);if(s.isEmpty()&&!o.isEmpty()){const e={coord:new JX(r,n),caseContent:o};this.disconnecteds.push(e)}}}}cancelMoveAttempt(){this.chosen=Mw.empty()}pass(){var e=this;return Pw(function*(){return NW(e.canPass,"DvonnComponent: pass() can only be called if canPass is true"),yield e.chooseMove(S2.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosen.isAbsent()?n.choosePiece(e,t):n.chosen.equalsValue(new JX(e,t))?(n.cancelMoveAttempt(),TW.SUCCESS):yield n.chooseDestination(e,t)})()}choosePiece(e,t){const n=new JX(e,t),r=this.rules.isMovablePiece(this.rules.node.gameState,n);return r.isSuccess()?(this.chosen=Mw.of(n),TW.SUCCESS):this.cancelMove(r.getReason())}chooseDestination(e,t){var n=this;return Pw(function*(){const r=n.chosen.get(),i=new JX(e,t),s=S2.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}getPieceClasses(e){if(e.containsSource()&&1===e.getSize())return["other-piece","dashed-stroke"];const t=this.getPlayerClass(e.getOwner());return e.containsSource()?[t,"other-piece-stroke","dashed-stroke"]:[t]}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-dvonn"]],features:[Go],decls:5,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 875 380","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","mid-stroke"],["class","base mid-stroke",3,"ngClass",4,"ngIf"],["class","other-piece-light","points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",4,"ngIf"],["class","text-center text-medium","dy","13",3,"click",4,"ngIf"],[1,"base","mid-stroke",3,"ngClass"],["points","157.055,0 90.798,196.319 164.417,196.319 88.344,400 289.571,159.509 218.405,159.509 311.656,0",1,"other-piece-light"],["dy","13",1,"text-center","text-medium",3,"click"],[1,"base","mid-stroke","captured"],[1,"base","mid-stroke","semi-transparent",3,"id","ngClass"],["class","text-center text-big","dy","17",4,"ngIf"],["dy","17",1,"text-center","text-big"],[1,"base","no-fill","highlighted"],[1,"base","no-fill","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,G2,2,3,"g",1),la(2,q2,4,8,"g",1),la(3,j2,3,2,"ng-container",2),la(4,Z2,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.state.allCoords()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();var K2=(()=>(function(e){e[e.NONE=0]="NONE",e[e.SMALL=1]="SMALL",e[e.MEDIUM=2]="MEDIUM",e[e.BIG=3]="BIG"}(K2||(K2={})),K2))();class Q2{constructor(e){this.value=e}static of(e){switch(e){case 0:return Q2.SMALL_BLACK;case 1:return Q2.SMALL_WHITE;case 2:return Q2.MEDIUM_BLACK;case 3:return Q2.MEDIUM_WHITE;case 4:return Q2.BIG_BLACK;case 5:return Q2.BIG_WHITE;case 6:return Q2.EMPTY;default:throw new Error("Invalid value "+e+" for EncapsulePiece")}}static ofSizeAndPlayer(e,t){return t===BK.ZERO&&e===K2.BIG?Q2.BIG_BLACK:t===BK.ZERO&&e===K2.MEDIUM?Q2.MEDIUM_BLACK:t===BK.ZERO&&e===K2.SMALL?Q2.SMALL_BLACK:t===BK.ONE&&e===K2.BIG?Q2.BIG_WHITE:t===BK.ONE&&e===K2.MEDIUM?Q2.MEDIUM_WHITE:t===BK.ONE&&e===K2.SMALL?Q2.SMALL_WHITE:Q2.EMPTY}getPlayer(){switch(this){case Q2.SMALL_BLACK:case Q2.MEDIUM_BLACK:case Q2.BIG_BLACK:return BK.ZERO;case Q2.SMALL_WHITE:case Q2.MEDIUM_WHITE:case Q2.BIG_WHITE:return BK.ONE;default:return VK.NONE}}getSize(){switch(this){case Q2.BIG_BLACK:case Q2.BIG_WHITE:return K2.BIG;case Q2.MEDIUM_BLACK:case Q2.MEDIUM_WHITE:return K2.MEDIUM;case Q2.SMALL_BLACK:case Q2.SMALL_WHITE:return K2.SMALL;default:return Ow.expectToBe(this,Q2.EMPTY),K2.NONE}}belongsTo(e){return this.getPlayer()===e}equals(e){return this===e}toString(){switch(this){case Q2.BIG_BLACK:return"BIG_BLACK";case Q2.BIG_WHITE:return"BIG_WHITE";case Q2.MEDIUM_BLACK:return"MEDIUM_BLACK";case Q2.MEDIUM_WHITE:return"MEDIUM_WHITE";case Q2.SMALL_BLACK:return"SMALL_BLACK";case Q2.SMALL_WHITE:return"SMALL_WHITE";default:return Ow.expectToBe(this,Q2.EMPTY),"EMPTY"}}}Q2.SMALL_BLACK=new Q2(0),Q2.SMALL_WHITE=new Q2(1),Q2.MEDIUM_BLACK=new Q2(2),Q2.MEDIUM_WHITE=new Q2(3),Q2.BIG_BLACK=new Q2(4),Q2.BIG_WHITE=new Q2(5),Q2.EMPTY=new Q2(6);class X2 extends fJ{constructor(e,t,n){super(e,t),this.remainingPieces=n}static getInitialState(){const e=new J2(VK.NONE,VK.NONE,VK.NONE).encode(),t=GK.createTable(3,3,e),n=GK.mapBiArray(t,e=>J2.decode(e));return new X2(n,0,[Q2.BIG_BLACK,Q2.BIG_BLACK,Q2.BIG_WHITE,Q2.BIG_WHITE,Q2.MEDIUM_BLACK,Q2.MEDIUM_BLACK,Q2.MEDIUM_WHITE,Q2.MEDIUM_WHITE,Q2.SMALL_BLACK,Q2.SMALL_BLACK,Q2.SMALL_WHITE,Q2.SMALL_WHITE])}getRemainingPieces(){return GK.copyImmutableArray(this.remainingPieces)}getRemainingPiecesOfPlayer(e){return this.getRemainingPieces().filter(t=>t.getPlayer()===e)}pieceBelongsToCurrentPlayer(e){return e.belongsTo(this.getCurrentPlayer())}isDroppable(e){return this.pieceBelongsToCurrentPlayer(e)&&this.isInRemainingPieces(e)}isInRemainingPieces(e){return this.remainingPieces.some(t=>t===e)}getPlayerRemainingPieces(){return this.remainingPieces.filter(e=>this.pieceBelongsToCurrentPlayer(e))}}class J2{constructor(e,t,n){this.small=e,this.medium=t,this.big=n}static decode(e){NW(e%1==0,"EncapsuleCase must be encoded as integer: "+e),NW(e>=0,"To small representation for EncapsuleCase: "+e),NW(e<=26,"To big representation for EncapsuleCase: "+e);const t=BK.numberEncoder.decodeNumber(e%3);e-=t.value;const n=BK.numberEncoder.decodeNumber((e/=3)%3);e-=n.value;const r=BK.numberEncoder.decodeNumber(e/=3);return new J2(t,n,r)}isEmpty(){return this.small===VK.NONE&&this.medium===VK.NONE&&this.big===VK.NONE}toList(){const e=[];return this.small.isPlayer()&&e.push(Q2.ofSizeAndPlayer(K2.SMALL,this.small)),this.medium.isPlayer()&&e.push(Q2.ofSizeAndPlayer(K2.MEDIUM,this.medium)),this.big.isPlayer()&&e.push(Q2.ofSizeAndPlayer(K2.BIG,this.big)),e}toOrderedPieceNames(){const e=Q2.ofSizeAndPlayer(K2.SMALL,this.small),t=Q2.ofSizeAndPlayer(K2.MEDIUM,this.medium),n=Q2.ofSizeAndPlayer(K2.BIG,this.big);return[e.toString(),t.toString(),n.toString()]}getBiggest(){return this.big===BK.ZERO?Q2.BIG_BLACK:this.big===BK.ONE?Q2.BIG_WHITE:this.medium===BK.ZERO?Q2.MEDIUM_BLACK:this.medium===BK.ONE?Q2.MEDIUM_WHITE:this.small===BK.ZERO?Q2.SMALL_BLACK:this.small===BK.ONE?Q2.SMALL_WHITE:Q2.EMPTY}tryToSuperposePiece(e){const t=this.getBiggest().getSize();if(e===Q2.EMPTY)throw new Error("Cannot move EMPTY on a space");return e.getSize()>t?Mw.of(this.put(e)):Mw.empty()}removeBiggest(){const e=this.getBiggest();if(e===Q2.EMPTY)throw new Error("Cannot removed piece from empty space");let t;const n=e.getSize();switch(n){case K2.BIG:t=new J2(this.small,this.medium,VK.NONE);break;case K2.MEDIUM:t=new J2(this.small,VK.NONE,VK.NONE);break;default:Ow.expectToBe(n,K2.SMALL),t=new J2(VK.NONE,VK.NONE,VK.NONE)}return{removedCase:t,removedPiece:e}}put(e){if(e===Q2.EMPTY)throw new Error("Cannot put EMPTY on space");const t=e.getPlayer(),n=e.getSize();switch(n){case K2.BIG:return new J2(this.small,this.medium,t);case K2.MEDIUM:return NW(this.big===VK.NONE,"Cannot put a piece on top of a bigger one"),new J2(this.small,t,this.big);default:return Ow.expectToBe(n,K2.SMALL),NW(this.big===VK.NONE,"Cannot put a piece on top of a bigger one"),NW(this.medium===VK.NONE,"Cannot put a piece on top of a bigger one"),new J2(t,this.medium,this.big)}}encode(){return this.small.value+3*this.medium.value+9*this.big.value}belongsTo(e){return this.getBiggest().getPlayer()===e}toString(){const e=this.toOrderedPieceNames();return"("+e[0]+", "+e[1]+", "+e[2]+")"}}J2.EMPTY=new J2(VK.NONE,VK.NONE,VK.NONE);let e3=(()=>{class e{}return e.PIECE_OUT_OF_STOCK=()=>$localize`You do not have pieces of this type anymore.`,e.INVALID_PLACEMENT=()=>$localize`You must put your piece on an empty square or on a smaller piece.`,e.NOT_DROPPABLE=()=>$localize`You must pick your piece among the remaining ones.`,e.INVALID_PIECE_SELECTED=()=>$localize`You must pick one of your remaining pieces or one piece on the board that is the biggest of its square.`,e.SAME_DEST_AS_ORIGIN=()=>$localize`You must select a different landing square than the square where the move originates from.`,e.END_YOUR_MOVE=()=>$localize`You are performing a move, you must select a landing square.`,e})();class t3 extends PJ{static isVictory(e){const t=e.getCopiedBoard();for(const n of t3.LINES){const e=t3.isVictoriousLine([t[n[0].y][n[0].x],t[n[1].y][n[1].x],t[n[2].y][n[2].x]]);if(e.isPresent())return e}return Mw.empty()}static isVictoriousLine(e){const t=e.map(e=>e.getBiggest()).map(e=>e.getPlayer());return t[0]===VK.NONE?Mw.empty():t[0]===t[1]&&t[1]===t[2]?Mw.of(t[0]):Mw.empty()}static isLegal(e,t){let n;if(Tw(!1,e.toString()),e.isDropping()){if(n=e.piece.get(),!1===t.pieceBelongsToCurrentPlayer(n))return SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE());if(!1===t.isInRemainingPieces(n))return SW.failure(e3.PIECE_OUT_OF_STOCK())}else{const r=e.startingCoord.get();if(n=t.getPieceAt(r).getBiggest(),!1===t.pieceBelongsToCurrentPlayer(n))return SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE())}const r=t.getPieceAt(e.landingCoord).tryToSuperposePiece(n);return r.isPresent()?SW.success(r.get()):SW.failure(e3.INVALID_PLACEMENT())}isLegal(e,t){return t3.isLegal(e,t)}applyLegalMove(e,t,n){const r=t.getCopiedBoard();let i=t.getRemainingPieces();const s=t.turn+1;let o;if(r[e.landingCoord.y][e.landingCoord.x]=J2.decode(n.encode()),e.isDropping()){o=e.piece.get();const t=i.indexOf(o);i=i.slice(0,t).concat(i.slice(t+1))}else{const t=e.startingCoord.get(),n=r[t.y][t.x].encode(),i=J2.decode(n).removeBiggest();r[t.y][t.x]=J2.decode(i.removedCase.encode()),o=i.removedPiece}return new X2(r,s,i)}static getGameStatus(e){const t=t3.isVictory(e.gameState);return t.isPresent()?SJ.getVictory(t.get()):SJ.ONGOING}getGameStatus(e){return t3.getGameStatus(e)}}t3.LINES=[[new JX(0,0),new JX(0,1),new JX(0,2)],[new JX(1,0),new JX(1,1),new JX(1,2)],[new JX(2,0),new JX(2,1),new JX(2,2)],[new JX(0,0),new JX(1,0),new JX(2,0)],[new JX(0,1),new JX(1,1),new JX(2,1)],[new JX(0,2),new JX(1,2),new JX(2,2)],[new JX(0,0),new JX(1,1),new JX(2,2)],[new JX(0,2),new JX(1,1),new JX(2,0)]];class n3 extends mJ{constructor(e,t,n){super(),this.startingCoord=e,this.landingCoord=t,this.piece=n}static fromMove(e,t){if(e.equals(t))throw new Error("Starting coord and landing coord must be separate coords");return new n3(Mw.of(e),t,Mw.empty())}static fromDrop(e,t){return new n3(Mw.empty(),t,Mw.of(e))}isDropping(){return this.startingCoord.isAbsent()}equals(e){return this===e||!1!==e.landingCoord.equals(this.landingCoord)&&!1!==this.startingCoord.equals(e.startingCoord)&&this.piece.equals(e.piece)}toString(){return this.isDropping()?"EncapsuleMove("+this.piece.get().toString()+" -> "+this.landingCoord+")":"EncapsuleMove("+this.startingCoord.get()+"->"+this.landingCoord+")"}}n3.encoder=new class extends FK{maxValue(){return 161}encodeNumber(e){const t=e.landingCoord.x,n=e.landingCoord.y;if(e.isDropping()){const r=0;return 18*e.piece.get().value+6*t+2*n+r}{const r=1,i=e.startingCoord.get().y;return 54*e.startingCoord.get().x+18*i+6*t+2*n+r}}decodeNumber(e){const t=e%2;e-=t;const n=(e/=2)%3;e-=n;const r=(e/=3)%3;e-=r,e/=3;const i=new JX(r,n);if(0===t){const t=Q2.of(e);return n3.fromDrop(t,i)}{const t=e%3;e-=t;const n=new JX((e/=3)%3,t);return n3.fromMove(n,i)}}};class r3 extends cJ{getBoardValue(e){const t=t3.getGameStatus(e);return new uJ(t.toBoardValue())}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getCurrentPlayer(),s=hJ.toComparableObjectSet(n.getPlayerRemainingPieces());for(let o=0;o<3;o++)for(let e=0;e<3;e++){const a=new JX(e,o);for(const e of s){const r=n3.fromDrop(e,a);t3.isLegal(r,n).isSuccess()&&t.push(r)}if(r[o][e].belongsTo(i))for(let e=0;e<3;e++)for(let r=0;r<3;r++){const i=new JX(r,e);if(!i.equals(a)){const e=n3.fromMove(a,i);t3.isLegal(e,n).isSuccess()&&t.push(e)}}}return t}}const i3=new J2(VK.NONE,VK.NONE,VK.NONE),s3=new J2(BK.ZERO,VK.NONE,VK.NONE),o3=new J2(VK.NONE,BK.ZERO,VK.NONE),a3=new J2(VK.NONE,VK.NONE,BK.ZERO),l3=new J2(BK.ONE,VK.NONE,VK.NONE),c3=new J2(VK.NONE,VK.NONE,BK.ONE),u3=new J2(BK.ONE,BK.ZERO,VK.NONE),h3=new J2(BK.ZERO,BK.ZERO,VK.NONE);class d3{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`The goal of Encapsule is to align three of your pieces.
        Here, we have a victory of the dark player.`,new X2([[s3,l3,c3],[i3,o3,i3],[i3,i3,a3]],0,[Q2.SMALL_BLACK,Q2.MEDIUM_BLACK,Q2.BIG_BLACK,Q2.SMALL_WHITE,Q2.MEDIUM_WHITE,Q2.MEDIUM_WHITE,Q2.BIG_WHITE])),kJ.anyMove($localize`Putting a piece`,$localize`This is the initial board. You're playing Dark.<br/><br/>
        Pick one of your piece on the side of the board and put it on the board.`,X2.getInitialState(),n3.fromDrop(Q2.SMALL_BLACK,new JX(1,1)),$localize`Congratulations!`),kJ.fromMove($localize`Moving`,$localize`Another possible action is to move one of your pieces that is already on the board.<br/><br/>
        Click on your dark piece and then on any empty square of the board.`,new X2([[s3,c3,i3],[i3,i3,i3],[i3,i3,i3]],0,[]),[n3.fromMove(new JX(0,0),new JX(2,0)),n3.fromMove(new JX(0,0),new JX(0,1)),n3.fromMove(new JX(0,0),new JX(1,1)),n3.fromMove(new JX(0,0),new JX(2,1)),n3.fromMove(new JX(0,0),new JX(0,2)),n3.fromMove(new JX(0,0),new JX(1,2)),n3.fromMove(new JX(0,0),new JX(2,2))],$localize`Congratulations!`,$localize`Failed. Try again.`),kJ.fromPredicate($localize`Particularity`,$localize`At Encapsule, pieces encapsulate each other.
        It is therefore possible to have up to three pieces per square!
        However, only the biggest piece of each square counts:
        you cannot win with a piece that is "hidden" by a bigger piece.
        Similarly, you cannot move a piece if it is encapsulated by a bigger piece.
        Finally, you cannot encapsulate a piece with a smaller piece.
        You're playing Dark and you can win now in various ways.<br/><br/>
        Try to win by making a move, and not by putting a new piece on the board.`,new X2([[u3,i3,l3],[h3,c3,c3],[i3,i3,i3]],0,[Q2.MEDIUM_BLACK,Q2.BIG_BLACK,Q2.MEDIUM_WHITE,Q2.MEDIUM_WHITE]),n3.fromMove(new JX(0,1),new JX(0,2)),(e,t)=>{if(e.landingCoord.equals(new JX(0,2))){if(e.isDropping())return TW.failure($localize`You won, but the exercise is to win while moving a piece!`);if(e.startingCoord.equalsValue(new JX(0,1)))return TW.SUCCESS}return TW.failure($localize`Failed. Try again.`)},$localize`Congratulations!`)]}}function p3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return Sa().onPieceClick(0,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa();Ts(1),Ta("id","piece_0_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(0,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}function f3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onBoardClick(t,n)}),fa()}if(2&e){const e=t.$implicit,n=Sa().index,r=Sa().index,i=Sa();ha("ngClass",i.getPieceClasses(e)),ra("r",i.getPieceRadius(e))("cx",i.SPACE_SIZE*n+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function g3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",6),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onBoardClick(t,n)}),fa(),la(2,f3,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","click_",n,"_",r,""),ha("ngClass",i.getRectClasses(n,r)),ra("x",i.SPACE_SIZE*n+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngForOf",i.getListPieces(e))}}function m3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,g3,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function y3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",9),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onBoardClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function v3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",5),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index;return Sa().onPieceClick(1,n,r)}),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa();Ts(1),Ta("id","piece_1_",e.toString(),""),ha("ngClass",r.getSidePieceClasses(e,n)),ra("r",r.getPieceRadius(e))("cx",r.getPieceLeftX(1,n)+r.getPieceRadius(e))("cy",r.SPACE_SIZE/2)}}let _3=(()=>{class e extends u1{constructor(e){super(e),this.INTER_PIECE_SPACE=20,this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.chosenCoord=Mw.empty(),this.chosenPiece=Mw.empty(),this.remainingPieceLeftX=[],this.rules=new t3(X2),this.availableMinimaxes=[new r3(this.rules,"EncapsuleMinimax")],this.encoder=n3.encoder,this.tutorial=(new d3).tutorial,this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard();const e=this.rules.node.move;this.calculateLeftX(),e.isPresent()?(this.lastLandingCoord=Mw.of(e.get().landingCoord),this.lastStartingCoord=e.get().startingCoord):(this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty())}getListPieces(e){return e.toList()}getRemainingPieces(e){return this.rules.node.gameState.getRemainingPiecesOfPlayer(BK.of(e))}onBoardClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new JX(e,t),s=n.rules.node.gameState;if(n.chosenCoord.isAbsent()){if(n.chosenCoord=Mw.of(i),n.chosenPiece.isPresent()){const e=n3.fromDrop(n.chosenPiece.get(),i);return n.chooseMove(e,n.rules.node.gameState)}return!1===s.getPieceAt(i).belongsTo(s.getCurrentPlayer())?n.cancelMove(e3.INVALID_PIECE_SELECTED()):TW.SUCCESS}if(n.chosenCoord.equalsValue(i))return n.cancelMove(e3.SAME_DEST_AS_ORIGIN());{const e=n3.fromMove(n.chosenCoord.get(),i);return n.chooseMove(e,n.rules.node.gameState)}})()}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.chosenPiece=Mw.empty(),this.chosenPieceIndex=-1}onPieceClick(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t.toString());return i.isFailure()?r.cancelMove(i.getReason()):!1===r.rules.node.gameState.isDroppable(t)?r.cancelMove(e3.NOT_DROPPABLE()):r.chosenCoord.isAbsent()?(r.chosenPiece=Mw.of(t),r.chosenPieceIndex=n,TW.SUCCESS):r.cancelMove(e3.END_YOUR_MOVE())})()}getRectClasses(e,t){return this.isSelected(e,t)?"moved":""}isSelected(e,t){const n=new JX(e,t);return!(!this.lastStartingCoord.equalsValue(n)&&!this.lastLandingCoord.equalsValue(n))}getPieceClasses(e){return[this.getPieceStrokeClass(e)]}getPieceStrokeClass(e){const t=e.getPlayer();return NW(t.isPlayer(),"EncapsuleComponent.getPieceStrokeClass should only be called with actual pieces!"),"player"+t.value+"-stroke"}getPieceRadius(e){switch(e.getSize()){case K2.BIG:return this.SPACE_SIZE/2-1*this.STROKE_WIDTH;case K2.MEDIUM:return this.SPACE_SIZE/2-2*this.STROKE_WIDTH-3;default:return Ow.expectToBe(e.getSize(),K2.SMALL),this.SPACE_SIZE/2-3*this.STROKE_WIDTH-6}}getHighlightedCases(){const e=[];return this.chosenCoord.isPresent()&&e.push(this.chosenCoord.get()),e}getSidePieceClasses(e,t){const n=this.getPieceClasses(e);return this.isSelectedPiece(e)&&this.chosenPieceIndex===t&&n.push("clickable "),n}isSelectedPiece(e){return this.chosenPiece.equalsValue(e)}calculateLeftX(){this.remainingPieceLeftX=[];for(let e=0;e<=1;e++){this.remainingPieceLeftX.push([]);const t=this.getRemainingPieces(e);for(let n=0;n<t.length;n++)if(0===n)this.remainingPieceLeftX[e].push(0);else{const r=this.remainingPieceLeftX[e][n-1],i=2*this.getPieceRadius(t[n-1]);this.remainingPieceLeftX[e].push(r+i+this.INTER_PIECE_SPACE)}}}getPieceLeftX(e,t){return this.remainingPieceLeftX[e][t]}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-encapsule"]],features:[Go],decls:11,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 520 520","preserveAspectRatio","xMidYMid meet"],["remainingCasePlayerZero",""],[4,"ngFor","ngForOf"],["boardDiv",""],["remainingCasePlayerOne",""],["pointer-events","fill",1,"base","no-fill",3,"id","ngClass","click"],[1,"base",3,"id","ngClass","click"],["class","base no-fill",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"base","no-fill",3,"ngClass","click"],["pointer-events","fill",1,"base","no-fill","highlighted",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",null,1),la(3,p3,2,5,"g",2),fa(),pa(4,"g",null,3),la(6,m3,2,1,"g",2),la(7,y3,2,4,"g",2),fa(),pa(8,"g",null,4),la(10,v3,2,5,"g",2),fa(),fa()),2&e&&(Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", 0)"),Ts(2),ha("ngForOf",t.getRemainingPieces(0)),Ts(1),ra("transform","translate("+(260-1.5*t.SPACE_SIZE-t.STROKE_WIDTH)+", "+t.SPACE_SIZE+")"),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCases()),Ts(1),ra("transform","translate("+t.STROKE_WIDTH+", "+(2*t.STROKE_WIDTH+4*t.SPACE_SIZE)+")"),Ts(2),ha("ngForOf",t.getRemainingPieces(1)))},directives:[tp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class C3 extends yJ{constructor(e,t,n,r,i){if(super(e,t),this.movedPieces=n,this.stepSize=r,this.direction=i,this.coord.isNotInRange(14,12))throw new Error("Illegal coord outside of board "+this.coord.toString()+".");if(n<1)throw new Error("Must select minimum one piece (got "+n+").");if(r<1)throw new Error("Step size must be minimum one (got "+r+").");if(r>n)throw new Error("Cannot move a phalanx further than its size (got step size "+r+" for "+n+" pieces).")}toString(){return"EpaminondasMove("+this.coord.toString()+", m:"+this.movedPieces+", s:"+this.stepSize+", "+this.direction.toString()+")"}equals(e){return this===e||!(!this.coord.equals(e.coord)||this.movedPieces!==e.movedPieces||this.stepSize!==e.stepSize)&&this.direction.equals(e.direction)}}C3.encoder=new class extends FK{maxValue(){return 122303}encodeNumber(e){const t=e.direction.toInt();return 8*e.coord.x*7*13*12+8*e.coord.y*7*13+8*(e.movedPieces-1)*7+8*(e.stepSize-1)+t}decodeNumber(e){if(e%1!=0)throw new Error("EncodedMove must be an integer.");const t=e%8;e-=t;const n=(e/=8)%7;e-=n;const r=(e/=7)%13;e-=r;const i=(e/=13)%12;e-=i;const s=e/=12,o=KX.factory.fromInt(t);return new C3(s,i,r+1,n+1,o.get())}};class E3 extends fJ{static getInitialState(){const e=VK.NONE,t=BK.ONE,n=BK.ZERO;return new E3([[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e,e,e],[n,n,n,n,n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n,n,n,n,n]],0)}count(e,t){let n=0;for(let r=0;r<14;r++)this.board[t][r]===e&&n++;return n}doesOwnPiece(e){for(let t=0;t<12;t++)for(let n=0;n<14;n++)if(this.board[t][n]===e)return!0;return!1}}let w3=(()=>{class e{}return e.PHALANX_IS_LEAVING_BOARD=()=>$localize`The move distance of your phalanx puts it out of the board.`,e.SOMETHING_IN_PHALANX_WAY=()=>$localize`There is something in the way of your phalanx.`,e.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE=()=>$localize`Your phalanx must be bigger than the one you are capturing.`,e.CASE_NOT_ALIGNED_WITH_SELECTED=()=>$localize`This square is not aligned with the selected piece.`,e.SINGLE_PIECE_MUST_MOVE_BY_ONE=()=>$localize`A single piece can only move by one square.`,e.SINGLE_PIECE_CANNOT_CAPTURE=()=>$localize`A single piece cannot make a capture.`,e.CASE_NOT_ALIGNED_WITH_PHALANX=()=>$localize`This square is not aligned with the direction of the phalanx.`,e.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD=()=>$localize`A phalanx can't contain pieces outside of the board.`,e.PHALANX_CANNOT_CONTAIN_EMPTY_CASE=()=>$localize`A phalanx cannot contain an empty square.`,e.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE=()=>$localize`A phalanx cannot contain a piece of the opponent.`,e})();class b3 extends PJ{static isLegal(e,t){const n=this.getPhalanxValidity(t,e);if(n.isFailure())return SW.failure(n.getReason());const r=this.getLandingStatus(t,e);if(r.isFailure())return r;const i=GK.copyBiArray(r.get()),s=t.getCurrentOpponent(),o=b3.getCaptureValidity(t,i,e,s);return o.isFailure()?o:SW.success(o.get())}static getPhalanxValidity(e,t){let n=t.coord,r=0;const i=e.getCurrentOpponent();for(;r<t.movedPieces;){if(n.isNotInRange(14,12))return TW.failure(w3.PHALANX_CANNOT_CONTAIN_PIECES_OUTSIDE_BOARD());const s=e.getPieceAt(n);if(s===VK.NONE)return TW.failure(w3.PHALANX_CANNOT_CONTAIN_EMPTY_CASE());if(s===i)return TW.failure(w3.PHALANX_CANNOT_CONTAIN_OPPONENT_PIECE());n=n.getNext(t.direction,1),r++}return TW.SUCCESS}static getLandingStatus(e,t){const n=e.getCopiedBoard(),r=e.getCurrentPlayer();let i=t.coord,s=t.coord.getNext(t.direction,t.movedPieces),o=0;for(;o+1<t.stepSize;){if(n[i.y][i.x]=VK.NONE,n[s.y][s.x]=r,s.isNotInRange(14,12))return SW.failure(w3.PHALANX_IS_LEAVING_BOARD());if(e.getPieceAt(s).isPlayer())return SW.failure(w3.SOMETHING_IN_PHALANX_WAY());o++,s=s.getNext(t.direction,1),i=i.getNext(t.direction,1)}return s.isNotInRange(14,12)?SW.failure(w3.PHALANX_IS_LEAVING_BOARD()):e.getPieceAt(s)===r?SW.failure(lJ.CANNOT_SELF_CAPTURE()):(n[i.y][i.x]=VK.NONE,n[s.y][s.x]=r,SW.success(n))}static getCaptureValidity(e,t,n,r){let i=n.coord.getNext(n.direction,n.movedPieces+n.stepSize-1),s=0;for(;i.isInRange(14,12)&&e.getPieceAt(i)===r;){if(s>0&&(t[i.y][i.x]=VK.NONE),s++,s>=n.movedPieces)return SW.failure(w3.PHALANX_SHOULD_BE_GREATER_TO_CAPTURE());i=i.getNext(n.direction,1)}return SW.success(t)}isLegal(e,t){return b3.isLegal(e,t)}applyLegalMove(e,t,n){return new E3(n,t.turn+1)}getGameStatus(e){const t=e.gameState,n=t.count(BK.ZERO,0),r=t.count(BK.ONE,11);if(t.turn%2==0){if(n>r)return SJ.ZERO_WON}else if(r>n)return SJ.ONE_WON;return!1===t.doesOwnPiece(BK.ZERO)?SJ.ONE_WON:!1===t.doesOwnPiece(BK.ONE)?SJ.ZERO_WON:SJ.ONGOING}}class S3 extends cJ{static getListMoves(e){const t=e.gameState.getCurrentPlayer(),n=e.gameState.getCurrentOpponent(),r=VK.NONE;let i=[];const s=e.gameState;let o;for(let a=0;a<12;a++)for(let e=0;e<14;e++){const l=new JX(e,a);if(s.getPieceAt(l)===t)for(const c of KX.DIRECTIONS){let u=1,h=l.getNext(c,1);for(;h.isInRange(14,12)&&s.getPieceAt(h)===t;)u+=1,h=h.getNext(c,1);let d=1;for(;h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===r;)o=new C3(e,a,u,d,c),i=this.addMove(i,o,s),d++,h=h.getNext(c,1);h.isInRange(14,12)&&d<=u&&s.getPieceAt(h)===n&&(o=new C3(e,a,u,d,c),i=this.addMove(i,o,s))}}return i}static addMove(e,t,n){return b3.isLegal(t,n).isSuccess()&&e.push(t),e}getListMoves(e){const t=S3.getListMoves(e);return GK.sortByDescending(t,e=>e.stepSize),t}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new uJ(t.isEndGame?t.toBoardValue():this.getPieceCountPlusRowDomination(e.gameState))}getPieceCountPlusRowDomination(e){let t=0;for(let n=0;n<12;n++){let r=0;const i=[0,0];for(let s=0;s<14;s++){const o=new JX(s,n),a=e.getPieceAt(o);if(a.isPlayer()){const n=a.getScoreModifier();t+=2002*n,i[a.value]=n,r+=n;for(const r of[KX.UP_LEFT,KX.UP,KX.UP_RIGHT]){let i=o.getNext(r,1);for(;i.isInRange(14,12)&&e.getPieceAt(i)===a;)t+=1*n,i=i.getNext(r,1)}}}0!==r&&(t+=Math.abs(r)/r*2),t+=1*i.reduce((e,t)=>e+t)}return t}}class P3 extends cJ{getListMoves(e){const t=S3.getListMoves(e);return this.orderMovesByPhalanxSizeAndFilter(t,e.gameState)}orderMovesByPhalanxSizeAndFilter(e,t){return GK.sortByDescending(e,e=>e.movedPieces),e.length>40?e.filter(e=>!!this.moveIsCapture(e,t)||e.movedPieces*Math.random()>1):e}moveIsCapture(e,t){const n=e.coord.getNext(e.direction,e.movedPieces+e.stepSize-1);return t.board[n.y][n.x]===t.getCurrentOpponent()}getBoardValue(e){const t=this.ruler.getGameStatus(e);return new uJ(t.isEndGame?t.toBoardValue():this.getPieceCountThenSupportThenAdvancement(e.gameState))}getPieceCountThenSupportThenAdvancement(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=new JX(r,n),s=e.getPieceAt(i);if(s.isPlayer()){let r,o;s===BK.ZERO?(r=12-n,o=[KX.UP_LEFT,KX.UP,KX.UP_RIGHT]):(r=n+1,o=[KX.DOWN_LEFT,KX.DOWN,KX.DOWN_RIGHT]);const a=s.getScoreModifier();t+=r*a,t+=149629*a;for(const n of o){let r=i.getNext(n,1);for(;r.isInRange(14,12)&&e.getPieceAt(r)===s;)t+=337*a,r=r.getNext(n,1)}}}return t}}class O3 extends S3{constructor(){super(...arguments),this.DOMINANCE_FACTOR=20,this.DEFENSE_FACTOR=5,this.TERRITORY_FACTOR=2,this.OFFENSE_FACTOR=10,this.CENTER_FACTOR=5,this.MOBILITY_FACTOR=.12}getDominance(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new JX(r,n));i.isPlayer()&&(t+=i.getScoreModifier())}return t*this.DOMINANCE_FACTOR}getDefense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new JX(n,11))===BK.ZERO&&(t+=BK.ZERO.getScoreModifier()),e.getPieceAt(new JX(n,0))===BK.ONE&&(t+=BK.ONE.getScoreModifier());return t*this.DEFENSE_FACTOR}getTerritory(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new JX(r,n));if(i.isPlayer()){for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const a=new JX(r+s,n+o);if(a.isInRange(14,12)){const n=e.getPieceAt(a);(n===i||n===VK.NONE)&&(t+=1*i.getScoreModifier())}}t-=i.getScoreModifier()}}return t*this.TERRITORY_FACTOR}getOffense(e){let t=0;for(let n=0;n<14;n++)e.getPieceAt(new JX(n,0))===BK.ZERO&&(t+=BK.ZERO.getScoreModifier()),e.getPieceAt(new JX(n,11))===BK.ONE&&(t+=BK.ONE.getScoreModifier());return t*this.OFFENSE_FACTOR}getCenter(e){let t=0;for(let n=0;n<12;n++)for(let r=0;r<14;r++){const i=e.getPieceAt(new JX(r,n));i.isPlayer()&&(t+=i.getScoreModifier()*Math.sqrt((r-6.5)*(r-6.5)))}return t*this.CENTER_FACTOR}getMobility(e){let t=0,n=0,r=0;for(let i=0;i<12;i++)for(let s=0;s<14;s++){const o=new JX(s,i),a=e.getPieceAt(o);if(a.isPlayer())for(const i of KX.DIRECTIONS){let s=1,l=o.getNext(i,1);for(;l.isInRange(14,12)&&e.getPieceAt(l)===a;)s+=1,l=l.getNext(i,1);let c=1;for(;l.isInRange(14,12)&&c<=s&&e.getPieceAt(l)===VK.NONE;)c++,l=l.getNext(i,1);t+=c*c*a.getScoreModifier(),a===BK.ZERO?n=Math.max(n,c):a===BK.ONE&&(r=Math.max(r,c))}}return(t+n*BK.ZERO.getScoreModifier()+r*BK.ONE.getScoreModifier())*this.MOBILITY_FACTOR}getBoardValue(e){const t=e.gameState,n=this.ruler.getGameStatus(e);if(n.isEndGame)return new uJ(n.toBoardValue());const r=this.getDominance(t),i=this.getDefense(t),s=this.getTerritory(t),o=this.getCenter(t),a=this.getOffense(t),l=this.getMobility(t);return new uJ(r+i+s+o+a+l)}}const T3=VK.NONE,I3=BK.ZERO,k3=BK.ONE;class A3{constructor(){this.tutorial=[kJ.informational($localize`Initial board`,$localize`This is the initial board of Epaminondas.
        The top line is the starting line of Light.
        The bottom line is the starting line of Dark.`,E3.getInitialState()),kJ.informational($localize`Goal of the game (1/2)`,$localize`After multiple moves, if at the beginning of its turn, a player has more pieces on the opponent's starting line
        than the number of pieces the opponent has on the player's starting line, the player wins.
        Here, it's Dark's turn to play: Dark has therefore won.`,new E3([[T3,T3,T3,T3,T3,I3,T3,T3,k3,k3,k3,k3,k3,k3],[T3,T3,T3,T3,T3,I3,T3,T3,T3,T3,T3,T3,k3,k3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,k3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,I3,I3,I3,I3,T3,T3,T3]],0)),kJ.informational($localize`Goal of the game (2/2)`,$localize`Here, it is Light's turn.
        Light wins because they have two pieces on Dark's starting line, and Dark only has one on Light's starting line.`,new E3([[T3,T3,T3,T3,T3,I3,T3,T3,T3,T3,k3,k3,k3,k3],[T3,T3,T3,T3,T3,I3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,k3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,k3,k3,T3,T3,T3,I3,I3,T3,I3,I3,I3,I3]],1)),kJ.fromPredicate($localize`Moving a piece`,$localize`Here is the starting board. Dark plays first.
        Let's start with moving a single piece:
        <ol>
            <li>Click on a piece.</li>
            <li>Click on a empty neighboring square.</li>
        </ol>`,E3.getInitialState(),new C3(0,10,1,1,KX.UP),(e,t)=>1===e.movedPieces?TW.SUCCESS:TW.failure($localize`Congratulations, you are in advance. But this is not the exercise here, try again.`),$localize`This is how you move a single piece.`),kJ.fromPredicate($localize`Moving a phalanx`,$localize`Let us now see how to move multiple pieces along a line, which is called a phalanx:
        <ol>
            <li>Click on the first piece of the phalanx.</li>
            <li>Click on the last piece of the phalanx.</li>
            <li>Click on one of the squares highlighted in yellow; you can move your phalanx up to a distance equal to its length.</li>
        </ol><br/>
        Move a phalanx!`,E3.getInitialState(),new C3(0,11,2,1,KX.UP),(e,t)=>e.movedPieces>1?TW.SUCCESS:TW.failure($localize`Failed! You moved only one piece.`),$localize`Congratulations!
        The moved pieces can be horizontally, vertically, or diagonally aligned.
        The move should be made along this axis, forward or backwards.
        There can be no opponent nor holes in the phalanx.`),kJ.fromMove($localize`Capture`,$localize`In order to capture pieces of the opponent:
        <ol>
            <li>It must be aligned with the phalanx you are moving.</li>
            <li>It must be strictly shorter than your phalanx.</li>
            <li>The first piece of your phalanx should land on the first piece of the opponent's phalanx that you want to capture.</li>
        </ol><br/>
        Capture a phalanx.`,new E3([[T3,T3,T3,T3,T3,T3,T3,T3,k3,k3,k3,k3,k3,k3],[T3,T3,T3,T3,T3,T3,k3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,k3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,k3,T3,k3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,k3,k3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,k3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,I3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,I3,T3,T3,T3,T3,k3,T3,T3,T3,T3,T3,T3],[T3,T3,I3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,I3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3,T3],[T3,T3,T3,T3,T3,T3,T3,I3,I3,I3,I3,I3,I3,I3]],0),[new C3(2,10,4,2,KX.UP)],$localize`Congratulations, you made it!
        Note that the diagonal phalanx was not aligned with your phalanx, hence even if it is longer, this does not prevent you from capturing some of its pieces on another alignment.`,$localize`Failed, you have not captured the phalanx.`)]}}function M3(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",4),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onClick(t,n)}),fa()}if(2&e){const e=Sa().index,t=Sa().index,n=Sa();ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE*e+n.STROKE_WIDTH+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.STROKE_WIDTH+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function N3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),fa(),la(2,M3,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=Sa().index,r=Sa();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e+r.STROKE_WIDTH)("y",r.SPACE_SIZE*n+r.STROKE_WIDTH)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.NONE)}}function R3(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,N3,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function x3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",5),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),ra("x",n.SPACE_SIZE*e.x+n.STROKE_WIDTH)("y",n.SPACE_SIZE*e.y+n.STROKE_WIDTH)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let D3=(()=>{class e extends u1{constructor(e){super(e),this.NONE=VK.NONE,this.firstPiece=Mw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=Mw.empty(),this.phalanxDirection=Mw.empty(),this.phalanxMiddles=[],this.moveds=[],this.captureds=[],this.rules=new b3(E3),this.availableMinimaxes=[new S3(this.rules,"Normal"),new P3(this.rules,"Positional"),new O3(this.rules,"Attack")],this.encoder=C3.encoder,this.tutorial=(new A3).tutorial,this.updateBoard()}updateBoard(){this.firstPiece=Mw.empty(),this.lastPiece=Mw.empty(),this.hidePreviousMove(),this.rules.node.move.isPresent()&&this.showPreviousMove(),this.board=this.rules.node.gameState.getCopiedBoard()}showPreviousMove(){const e=this.rules.node.move.get();let t=e.coord;this.moveds=[t];for(let i=1;i<e.stepSize+e.movedPieces;i++)t=t.getNext(e.direction,1),this.moveds.push(t);const n=this.rules.node.mother.get(),r=n.gameState.getCurrentOpponent();for(;t.isInRange(14,12)&&n.gameState.getPieceAt(t)===r;)this.captureds.push(t),t=t.getNext(e.direction,1)}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.firstPiece.isAbsent()?n.firstClick(e,t):n.lastPiece.isAbsent()?n.secondClick(e,t):n.thirdClick(e,t)})()}firstClick(e,t){var n=this;return Pw(function*(){const r=n.rules.node.gameState.getCurrentOpponent(),i=n.rules.node.gameState.getCurrentPlayer();switch(n.board[t][e]){case i:return n.firstPiece=Mw.of(new JX(e,t)),n.validExtensions=n.getValidExtensions(i),n.phalanxValidLandings=n.getPhalanxValidLandings(),TW.SUCCESS;case r:return n.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE());default:return Ow.expectToBe(n.board[t][e],VK.NONE),n.cancelMove(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY())}})()}hidePreviousMove(){this.captureds=[],this.moveds=[]}getValidExtensions(e){return this.lastPiece.isPresent()?this.getPhalanxValidExtensions(e):this.getFirstPieceExtensions(e)}getFirstPieceExtensions(e){const t=[];for(const n of KX.DIRECTIONS){let r=this.firstPiece.get().getNext(n,1);for(;r.isInRange(14,12)&&this.board[r.y][r.x]===e;)t.push(r),r=r.getNext(n,1)}return t}getPhalanxValidExtensions(e){let t=KX.factory.fromMove(this.firstPiece.get(),this.lastPiece.get()).get();const n=this.lastPiece.get().getNext(t,1),r=this.getExtensionsToward(n,t,e);t=t.getOpposite();const i=this.firstPiece.get().getNext(t,1),s=this.getExtensionsToward(i,t,e);return r.concat(s)}getExtensionsToward(e,t,n){const r=[];for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r.push(e),e=e.getNext(t,1);return r}getPhalanxValidLandings(){if(this.lastPiece.isPresent()){const e=this.firstPiece.get(),t=this.lastPiece.get(),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=Math.max(n,r)+1;let s=KX.factory.fromMove(e,t).get();const o=t.getNext(s,1),a=this.getLandingsToward(o,s,i);s=s.getOpposite();const l=e.getNext(s,1);return this.getLandingsToward(l,s,i).concat(a)}return this.getNeighbooringEmptyCases()}getNeighbooringEmptyCases(){const e=[];for(const t of KX.DIRECTIONS){const n=this.firstPiece.get().getNext(t,1);n.isInRange(14,12)&&this.board[n.y][n.x]===VK.NONE&&e.push(n)}return e}getLandingsToward(e,t,n){const r=this.rules.node.gameState.getCurrentPlayer(),i=this.rules.node.gameState.getCurrentOpponent(),s=[];for(;e.isInRange(14,12)&&s.length<n&&this.board[e.y][e.x]!==r;){if(this.board[e.y][e.x]===i)return this.getPhalanxLength(e,t,i)<n&&s.push(e),s;s.push(e),e=e.getNext(t,1)}return s}getPhalanxLength(e,t,n){let r=0;for(;e.isInRange(14,12)&&this.board[e.y][e.x]===n;)r++,e=e.getNext(t,1);return r}cancelMoveAttempt(){this.firstPiece=Mw.empty(),this.validExtensions=[],this.phalanxValidLandings=[],this.lastPiece=Mw.empty(),this.phalanxMiddles=[],this.hidePreviousMove()}secondClick(e,t){var n=this;return Pw(function*(){const r=new JX(e,t),i=n.firstPiece.get();if(r.equals(i))return n.cancelMoveAttempt(),TW.SUCCESS;const s=n.rules.node.gameState.getCurrentOpponent(),o=n.rules.node.gameState.getCurrentPlayer();if(!r.isAlignedWith(i))return n.cancelMove(w3.CASE_NOT_ALIGNED_WITH_SELECTED());const a=r.getDistance(i),l=i.getDirectionToward(r).get();switch(n.board[t][e]){case VK.NONE:return 1===a?n.tryMove(new C3(i.x,i.y,1,1,l)):n.cancelMove(w3.SINGLE_PIECE_MUST_MOVE_BY_ONE());case s:return n.cancelMove(w3.SINGLE_PIECE_CANNOT_CAPTURE());default:Ow.expectToBe(n.board[t][e],o);const c=new C3(i.x,i.y,a,1,l),u=b3.getPhalanxValidity(n.rules.node.gameState,c);return u.isFailure()?n.cancelMove(u.getReason()):(n.lastPiece=Mw.of(r),n.validExtensions=n.getValidExtensions(o),n.phalanxValidLandings=n.getPhalanxValidLandings(),n.phalanxMiddles=i.getCoordsToward(r),n.phalanxDirection=Mw.of(l),TW.SUCCESS)}})()}thirdClick(e,t){var n=this;return Pw(function*(){const r=n.rules.node.gameState.getCurrentPlayer(),i=new JX(e,t);if(n.firstPiece.equalsValue(i))return n.moveFirstPiece(r);if(n.lastPiece.equalsValue(i))return n.moveLastPiece(r);const s=n.firstPiece.get(),o=n.lastPiece.get();if(!i.isAlignedWith(s))return n.cancelMove(w3.CASE_NOT_ALIGNED_WITH_PHALANX());let a=KX.factory.fromMove(s,o).get();const l=KX.factory.fromMove(s,i).get();if(a===l.getOpposite()&&(n.firstPiece=Mw.of(o),n.lastPiece=Mw.of(s),a=l),a!==l)return n.cancelMove(w3.CASE_NOT_ALIGNED_WITH_PHALANX());if(n.board[t][e]===r){n.lastPiece=Mw.of(i);const e=n.firstPiece.get().getDistance(i)+1,t=new C3(n.firstPiece.get().x,n.firstPiece.get().y,e,1,a),s=b3.getPhalanxValidity(n.rules.node.gameState,t);return s.isFailure()?n.cancelMove(s.getReason()):(n.phalanxMiddles=n.firstPiece.get().getCoordsToward(n.lastPiece.get()),n.validExtensions=n.getValidExtensions(r),n.phalanxValidLandings=n.getPhalanxValidLandings(),TW.SUCCESS)}{const e=n.firstPiece.get().getDistance(n.lastPiece.get())+1,t=n.lastPiece.get().getDistance(i),r=new C3(n.firstPiece.get().x,n.firstPiece.get().y,e,t,a);return n.tryMove(r)}})()}moveFirstPiece(e){var t=this;return Pw(function*(){return t.firstPiece=Mw.of(t.firstPiece.get().getNext(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?yield t.moveOnlyPiece(e):(t.phalanxMiddles=t.phalanxMiddles.slice(1),t.validExtensions=t.getPhalanxValidExtensions(e)),t.phalanxValidLandings=t.getPhalanxValidLandings(),TW.SUCCESS})()}moveLastPiece(e){var t=this;return Pw(function*(){return t.lastPiece=Mw.of(t.lastPiece.get().getPrevious(t.phalanxDirection.get(),1)),t.firstPiece.equals(t.lastPiece)?t.moveOnlyPiece(e):(t.phalanxMiddles=t.firstPiece.get().getCoordsToward(t.lastPiece.get()),t.validExtensions=t.getPhalanxValidExtensions(e),t.phalanxValidLandings=t.getPhalanxValidLandings(),TW.SUCCESS)})()}moveOnlyPiece(e){var t=this;return Pw(function*(){return t.lastPiece=Mw.empty(),t.validExtensions=t.getFirstPieceExtensions(e),t.phalanxDirection=Mw.empty(),t.phalanxMiddles=[],t.phalanxValidLandings=t.getPhalanxValidLandings(),TW.SUCCESS})()}tryMove(e){const t=this.rules.node.gameState;return this.cancelMove(),this.chooseMove(e,t)}getPieceClasses(e,t){const n=this.getPlayerClass(this.board[t][e]);return this.getPieceStrokeClasses(e,t).concat([n])}getPieceStrokeClasses(e,t){const n=new JX(e,t);return this.firstPiece.isAbsent()?[]:this.firstPiece.equalsValue(n)||this.lastPiece.equalsValue(n)||this.phalanxMiddles.some(e=>e.equals(n))?["highlighted"]:[]}getRectClasses(e,t){const n=new JX(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:this.moveds.some(e=>e.equals(n))?["moved"]:[]}getHighlightedCoords(){return this.firstPiece.isPresent()?this.phalanxValidLandings.concat(this.validExtensions):this.getCurrentPlayerPieces()}getCurrentPlayerPieces(){const e=[],t=this.rules.node.gameState.getCurrentPlayer();for(let n=0;n<this.board.length;n++)for(let r=0;r<this.board[n].length;r++)this.board[n][r]===t&&e.push(new JX(r,n));return e}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-epaminondas"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 1410 1210","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass","click",4,"ngIf"],[1,"base",3,"ngClass","click"],[1,"no-fill","mid-stroke","clickable",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,R3,2,1,"g",1),la(2,x3,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getHighlightedCoords()))},directives:[tp,Jd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();function L3(e){return new class extends DK{encode(t){return t.isPresent()?e.encode(t.get()):null}decode(t){return null===t?Mw.empty():Mw.of(e.decode(t))}}}class F3{constructor(e){if(e.length<4)throw new Error("Cannot create a GipfCapture with less than 4 captured pieces");if(!1===C2.areOnSameLine(e))throw new Error("Cannot create a GipfCapture with pieces that are not on the same line");this.capturedSpaces=GK.copyImmutableArray(e).sort((e,t)=>{if(e.x===t.x){if(e.y===t.y)throw new Error("Cannot create a GipfCapture with duplicate cases");return e.y>t.y?1:-1}return e.x>t.x?1:-1});let t=Mw.empty();for(const n of this.capturedSpaces){if(t.isPresent()&&1!==t.get().getDistance(n))throw new Error("Cannot create a GipfCapture with non-consecutive cases");t=Mw.of(n)}}toString(){let e="";for(const t of this.capturedSpaces)""!==e&&(e+=","),e+=t.toString();return e}size(){return this.capturedSpaces.length}forEach(e){this.capturedSpaces.forEach(e)}contains(e){for(let t=0;t<this.capturedSpaces.length;t++)if(this.capturedSpaces[t].equals(e))return!0;return!1}intersectsWith(e){return this.capturedSpaces.some(t=>e.contains(t))}getLine(){return C2.fromTwoCoords(this.capturedSpaces[0],this.capturedSpaces[1]).get()}equals(e){if(this===e)return!0;if(this.capturedSpaces.length!==e.capturedSpaces.length)return!1;for(let t=0;t<this.capturedSpaces.length;t++)if(!this.capturedSpaces[t].equals(e.capturedSpaces[t]))return!1;return!0}}F3.encoder=new class extends DK{encode(e){return e.capturedSpaces.map(e=>JX.encoder.encode(e))}decode(e){return new F3(e.map(e=>JX.encoder.decode(e)))}};class U3{constructor(e,t){this.coord=e,this.direction=t}toString(){return this.direction.isPresent()?this.coord.toString()+"@"+this.direction.get().toString():this.coord.toString()}equals(e){return!!this.coord.equals(e.coord)&&this.direction.equals(e.direction)}}U3.encoder=new class extends DK{constructor(){super(...arguments),this.optionalDirectionEncoder=L3(rJ.encoder)}encode(e){return{coord:JX.encoder.encode(e.coord),direction:this.optionalDirectionEncoder.encode(e.direction)}}decode(e){const t=e;return NW(null!=t.coord,"Invalid encoded GipfPlacement"),new U3(JX.encoder.decode(t.coord),this.optionalDirectionEncoder.decode(t.direction))}};class B3 extends mJ{constructor(e,t,n){super(),this.placement=e,this.initialCaptures=t,this.finalCaptures=n}toString(){return"GipfMove(["+this.capturesToString(this.initialCaptures)+"], "+this.placement.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}equals(e){return this===e||!(!1===this.placement.equals(e.placement)||!1===GK.compareArray(this.initialCaptures,e.initialCaptures)||!1===GK.compareArray(this.finalCaptures,e.finalCaptures))}encode(){return B3.encoder.encode(this)}decode(e){return B3.encoder.decode(e)}}B3.encoder=new class extends LK{encodeMove(e){const t={placement:U3.encoder.encode(e.placement)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=F3.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=F3.encoder.encode(e)}),t}decodeMove(e){const t=e;return NW(null!=t.placement,"Invalid encoded GipfMove"),new B3(U3.encoder.decode(t.placement),this.decodeArray(t,"initialCapture",F3.encoder.decode),this.decodeArray(t,"finalCapture",F3.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class V3 extends E2{constructor(e,t,n,r){super(t,e,7,7,[3,2,1],nJ.EMPTY),this.sidePieces=n,this.capturedPieces=r}static getInitialState(){const e=nJ.EMPTY,t=nJ.UNREACHABLE,n=nJ.ZERO,r=nJ.ONE;return new V3([[t,t,t,r,e,e,n],[t,t,e,e,e,e,e],[t,e,e,e,e,e,e],[n,e,e,e,e,e,r],[e,e,e,e,e,e,t],[e,e,e,e,e,t,t],[r,e,e,n,t,t,t]],0,[12,12],[0,0])}equals(e){return this.turn===e.turn&&this.sidePieces[0]===e.sidePieces[0]&&this.sidePieces[1]===e.sidePieces[1]&&this.capturedPieces[0]===e.capturedPieces[0]&&this.capturedPieces[1]===e.capturedPieces[1]&&GK.compareTable(this.board,e.board)}getNumberOfPiecesToPlace(e){return this.sidePieces[e.value]}getNumberOfPiecesCaptured(e){return this.capturedPieces[e.value]}setAtUnsafe(e,t){const n=GK.copyBiArray(this.board);return n[e.y][e.x]=t,new V3(n,this.turn,this.sidePieces,this.capturedPieces)}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==nJ.UNREACHABLE}}let $3=(()=>{class e{}return e.CAPTURE_MUST_BE_ALIGNED=()=>$localize`You can only capture when 4 or more of your pieces are aligned, and it is not the case.`,e.INVALID_CAPTURED_PIECES=()=>$localize`You must select a valid capture that contains 4 pieces or more.`,e.MISSING_CAPTURES=()=>$localize`There are still possible captures to be done.`,e.PLACEMENT_NOT_ON_BORDER=()=>$localize`Pieces must be inserted in spaces on the edge of the board.`,e.INVALID_PLACEMENT_DIRECTION=()=>$localize`You must select a valid placement direction.`,e.PLACEMENT_WITHOUT_DIRECTION=()=>$localize`You must select a placement with a direction alongside the insertion space.`,e.PLACEMENT_ON_COMPLETE_LINE=()=>$localize`You cannot place a piece on a complete line.`,e.AMBIGUOUS_CAPTURE_COORD=()=>$localize`This piece belongs to two captures. Please select another piece in the capture you'd like to make.`,e.CLICK_FURTHER_THAN_ONE_COORD=()=>$localize`You must click on an arrow to select your destination.`,e.NO_DIRECTIONS_AVAILABLE=()=>$localize`You cannot insert a piece here, as all lines are full. Select another space.`,e})();class z3 extends PJ{applyLegalMove(e,t,n){return new V3(n.board,n.turn+1,n.sidePieces,n.capturedPieces)}static applyCaptures(e,t){let n=e;return t.forEach(e=>{n=z3.applyCapture(n,e)}),n}static applyCapture(e,t){const n=e.getCurrentPlayer();let r=e;const i=[e.sidePieces[0],e.sidePieces[1]],s=[e.capturedPieces[0],e.capturedPieces[1]];return t.forEach(t=>{const o=e.getPieceAt(t);r=r.setAt(t,nJ.EMPTY),o.is(n)?i[n.value]+=1:s[n.value]+=1}),new V3(r.board,e.turn,i,s)}static getPlacements(e){const t=[];return aJ.INSTANCE.getAllBorders(e).forEach(n=>{e.getPieceAt(n)===nJ.EMPTY?t.push(new U3(n,Mw.empty())):z3.getAllDirectionsForEntrance(e,n).forEach(r=>{!1===z3.isLineComplete(e,n,r)&&t.push(new U3(n,Mw.of(r)))})}),t}static isLineComplete(e,t,n){return z3.nextGapInLine(e,t,n).isAbsent()}static nextGapInLine(e,t,n){for(let r=t;e.isOnBoard(r);r=r.getNext(n))if(e.getPieceAt(r)===nJ.EMPTY)return Mw.of(r);return Mw.empty()}static applyPlacement(e,t){const n=e.getCurrentPlayer();let r=e,i=nJ.ofPlayer(e.getCurrentPlayer());if(t.direction.isAbsent()){const n=t.coord;if(e.getPieceAt(n)!==nJ.EMPTY)throw new Error("Apply placement called without direction while the coord is occupied");r=r.setAt(n,i)}else for(let o=t.coord;r.isOnBoard(o)&&i!==nJ.EMPTY;o=o.getNext(t.direction.get())){const t=e.getPieceAt(o);r=r.setAt(o,i),i=t}const s=[e.sidePieces[0],e.sidePieces[1]];return s[n.value]-=1,new V3(r.board,e.turn,s,e.capturedPieces)}getPiecesMoved(e,t,n){const r=z3.applyCaptures(e,t);if(n.direction.isAbsent())return[n.coord];{const e=n.direction.get(),t=[];t.push(n.coord);let i=n.coord.getNext(e);for(;r.isOnBoard(i)&&r.getPieceAt(i)!==nJ.EMPTY;)t.push(i),i=i.getNext(e);return NW(r.isOnBoard(i)&&r.getPieceAt(i)===nJ.EMPTY,"getPiecesMoved called with an invalid placement performed on a full line"),t.push(i),t}}static getAllDirectionsForEntrance(e,t){if(aJ.INSTANCE.isTopLeftCorner(e,t))return[rJ.RIGHT,rJ.DOWN,rJ.UP_RIGHT];if(aJ.INSTANCE.isTopCorner(e,t))return[rJ.DOWN,rJ.DOWN_LEFT,rJ.RIGHT];if(aJ.INSTANCE.isTopRightCorner(e,t))return[rJ.DOWN_LEFT,rJ.DOWN,rJ.LEFT];if(aJ.INSTANCE.isBottomLeftCorner(e,t))return[rJ.UP_RIGHT,rJ.UP,rJ.RIGHT];if(aJ.INSTANCE.isBottomCorner(e,t))return[rJ.UP,rJ.LEFT,rJ.UP_RIGHT];if(aJ.INSTANCE.isBottomRightCorner(e,t))return[rJ.LEFT,rJ.UP,rJ.DOWN_LEFT];if(aJ.INSTANCE.isOnTopLeftBorder(e,t))return[rJ.RIGHT,rJ.DOWN];if(aJ.INSTANCE.isOnLeftBorder(e,t))return[rJ.UP_RIGHT,rJ.RIGHT];if(aJ.INSTANCE.isOnBottomLeftBorder(e,t))return[rJ.UP,rJ.UP_RIGHT];if(aJ.INSTANCE.isOnBottomRightBorder(e,t))return[rJ.LEFT,rJ.UP];if(aJ.INSTANCE.isOnRightBorder(e,t))return[rJ.LEFT,rJ.DOWN_LEFT];if(aJ.INSTANCE.isOnTopRightBorder(e,t))return[rJ.DOWN_LEFT,rJ.DOWN];throw new Error("not a border")}isLegal(e,t){const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=z3.applyCaptures(t,e.initialCaptures),i=this.noMoreCapturesValidity(r);if(i.isFailure())return i.toFailedFallible();const s=this.placementValidity(r,e.placement);if(s.isFailure())return s.toFailedFallible();const o=z3.applyPlacement(r,e.placement),a=this.capturesValidity(o,e.finalCaptures);if(a.isFailure())return a.toFailedFallible();const l=z3.applyCaptures(o,e.finalCaptures),c=this.noMoreCapturesValidity(l);return c.isFailure()?c.toFailedFallible():SW.success(l)}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=z3.applyCapture(n,r)}return TW.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer(),r=z3.getLinePortionWithFourPiecesOfPlayer(e,n,t.getLine());if(r.isAbsent())return TW.failure($3.CAPTURE_MUST_BE_ALIGNED());const i=r.get();return z3.getCapturable(e,i).equals(t)?TW.SUCCESS:TW.failure($3.INVALID_CAPTURED_PIECES())}static getLinePortionsWithFourPiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=z3.getLinePortionWithFourPiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}static getLinePortionWithFourPiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o=i;for(let a=i;e.isOnBoard(a);a=a.getNext(s))if(e.getPieceAt(a).is(t)?(0===r&&(o=a),r+=1):r=0,4===r)return Mw.of({0:o,1:a,2:s});return Mw.empty()}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===z3.getLinePortionsWithFourPiecesOfPlayer(e,t).length?TW.SUCCESS:TW.failure($3.MISSING_CAPTURES())}placementValidity(e,t){const n=this.placementCoordValidity(e,t.coord);if(n.isFailure())return n;if(e.getPieceAt(t.coord)!==nJ.EMPTY){if(t.direction.isAbsent())return TW.failure($3.PLACEMENT_WITHOUT_DIRECTION());if(z3.isLineComplete(e,t.coord,t.direction.get()))return TW.failure($3.PLACEMENT_ON_COMPLETE_LINE());for(const n of z3.getAllDirectionsForEntrance(e,t.coord))if(n===t.direction.get())return TW.SUCCESS;return TW.failure($3.INVALID_PLACEMENT_DIRECTION())}return TW.SUCCESS}placementCoordValidity(e,t){return aJ.INSTANCE.isOnBorder(e,t)?TW.SUCCESS:TW.failure($3.PLACEMENT_NOT_ON_BORDER())}static getCapturable(e,t){const n=[],r=t[0],i=t[1],s=t[2],o=s.getOpposite();let a=r.getNext(o);for(;e.isOnBoard(a)&&e.getPieceAt(a)!==nJ.EMPTY;)n.push(a),a=a.getNext(o);for(let l=r;!l.equals(i);l=l.getNext(s))n.push(l);for(let l=i;e.isOnBoard(l)&&e.getPieceAt(l)!==nJ.EMPTY;l=l.getNext(s))n.push(l);return new F3(n)}static getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return z3.getLinePortionsWithFourPiecesOfPlayer(e,t).forEach(t=>{n.push(z3.getCapturable(e,t))}),n}static getPlayerScore(e,t){const n=e.getNumberOfPiecesToPlace(t);if(0===n&&0===z3.getPossibleCaptures(e).length)return Mw.empty();const r=e.getNumberOfPiecesCaptured(t);return Mw.of(n+3*r)}static isGameOver(e){const t=z3.getPlayerScore(e,BK.ZERO),n=z3.getPlayerScore(e,BK.ONE);return t.isAbsent()||n.isAbsent()}getGameStatus(e){const t=e.gameState,n=z3.getPlayerScore(t,BK.ZERO),r=z3.getPlayerScore(t,BK.ONE);return n.isAbsent()?SJ.ONE_WON:r.isAbsent()?SJ.ZERO_WON:SJ.ONGOING}}class H3 extends cJ{static getPossibleCaptureCombinationsFromPossibleCaptures(e){const t=H3.computeIntersections(e);let n=[[]];return e.forEach((e,r)=>{if(0===t[r].length)n.forEach(e=>{e.push(r)});else{const e=[],i=t[r].some(e=>e>r);for(const s of n)!0===s.some(e=>t[r].some(t=>e===t))?e.push(GK.copyImmutableArray(s)):i?(e.push(GK.copyImmutableArray(s)),s.push(r),e.push(GK.copyImmutableArray(s))):(s.push(r),e.push(GK.copyImmutableArray(s)));n=e}}),n.map(t=>t.map(t=>e[t]))}static computeIntersections(e){const t=[];return e.forEach((n,r)=>{t.push([]),e.forEach((e,i)=>{r!==i&&n.intersectsWith(e)&&t[r].push(i)})}),t}getBoardValue(e){const t=e.gameState,n=z3.getPlayerScore(t,BK.ZERO),r=z3.getPlayerScore(t,BK.ONE);return n.isAbsent()?new uJ(BK.ONE.getVictoryValue()):r.isAbsent()?new uJ(BK.ZERO.getVictoryValue()):new uJ(n.get()-r.get())}getListMoves(e){return this.getListMoveFromState(e.gameState)}getListMoveFromState(e){const t=[];return z3.isGameOver(e)||this.getPossibleCaptureCombinations(e).forEach(n=>{const r=z3.applyCaptures(e,n);z3.getPlacements(r).forEach(e=>{const i=z3.applyPlacement(r,e);this.getPossibleCaptureCombinations(i).forEach(r=>{const i=new B3(e,n,r);t.push(i)})})}),t}getPossibleCaptureCombinations(e){const t=z3.getPossibleCaptures(e);return H3.getPossibleCaptureCombinationsFromPossibleCaptures(t)}}class G3{constructor(e,t,n,r,i,s){this.source=e,this.destination=t,this.x1=n,this.y1=r,this.x2=i,this.y2=s}}const W3=nJ.UNREACHABLE,q3=nJ.EMPTY,j3=nJ.ZERO,Z3=nJ.ONE;class Y3{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`The goal of Gipf is to capture the opponent's piece so that the opponent can no longer play.
        This is the initial board.
        Each player has 12 pieces on the side and 3 pieces on the board.
        When, at its turn, a player has no more pieces on the side, that player cannot play anymore and loses the game.
        The first player plays with the dark pieces, the second player plays with the light pieces.`,V3.getInitialState()),kJ.anyMove($localize`Pushing`,$localize`Pieces can only enter the board through the edges. To insert a new piece:
        <ol>
            <li>Click on a space on the edge of the board.</li>
            <li>If that space was already occupied, click on the arrow that indicates the direction in which you want to push the piece(s) already on the corresponding line.</li>
        </ol>
        You cannot push when a line is full.<br/><br/>
        You're playing Dark, insert a piece.`,V3.getInitialState(),new B3(new U3(new JX(3,0),Mw.of(rJ.DOWN)),[],[]),$localize`Congratulations!`),kJ.fromMove($localize`Capture (1/3)`,$localize`To capture, you must align 4 of your own pieces, which will be the first 4 captured pieces.
        There are multiple important aspects of a capture:
        <ol>
            <li>When 4 pieces are captured, all pieces that are directly aligned with these 4 pieces are also captured.</li>
            <li>As soon as there is an empty space on the line, the capture stops.</li>
            <li>Your own pieces that are captured go back to your stock.
                Your opponent's pieces however are really captured and do not go back to your opponent's stock.</li>
            <li>If you create a line of 4 of your opponent's pieces, it will be at the beginning of your opponent's turn that your opponent can capture them.
                This means that a turn happens in three phases:
                <ol type="A">
                    <li>Pick the capture(s) resulting from the last move of your opponent (by clicking on it).</li>
                    <li>Make your insertion.</li>
                    <li>Pick the capture(s) resulting from your move (by clicking on it).</li>
                </ol>
            </li>
        </ol><br/>
        You're playing Dark, you can make a capture, do it.`,new V3([[W3,W3,W3,j3,Z3,q3,q3],[W3,W3,q3,q3,q3,q3,q3],[W3,q3,q3,q3,q3,q3,q3],[j3,j3,j3,q3,q3,q3,q3],[Z3,q3,q3,q3,q3,q3,W3],[q3,q3,q3,Z3,q3,W3,W3],[q3,q3,q3,Z3,W3,W3,W3]],42,[8,8],[0,0]),[new B3(new U3(new JX(0,3),Mw.of(rJ.RIGHT)),[],[new F3([new JX(0,3),new JX(1,3),new JX(2,3),new JX(3,3)])])],$localize`Congratulations, you have gotten 4 of your pieces back. This is not the most useful capture.
        Let's now see how captures can really be useful.`,$localize`Failed!`),kJ.fromMove($localize`Capture (2/3)`,$localize`Here, there are three different ways of capturing.
        <ol>
          <li>One way does not capture any of your opponent's pieces.</li>
          <li>Another way captures one of your opponent's pieces.</li>
          <li>The last way captures two of your opponent's pieces.</li>
        </ol>
        <br/><br/>
        Pick the last one.`,new V3([[W3,W3,W3,q3,q3,q3,q3],[W3,W3,q3,Z3,q3,q3,q3],[W3,q3,q3,j3,q3,q3,q3],[j3,j3,j3,Z3,q3,q3,q3],[q3,q3,q3,j3,q3,q3,W3],[q3,q3,q3,j3,q3,W3,W3],[q3,q3,q3,Z3,W3,W3,W3]],42,[8,4],[2,3]),[new B3(new U3(new JX(0,3),Mw.of(rJ.RIGHT)),[],[new F3([new JX(3,1),new JX(3,2),new JX(3,3),new JX(3,4),new JX(3,5),new JX(3,6)])])],$localize`Congratulations, you have gotten back 4 of your pieces and captured 2 of the opponent's.
        The most you can get is 3 per capture.`,$localize`Failed, the best capture was taking 2 of your opponent's pieces`),kJ.fromMove($localize`Capture (3/3)`,$localize`Here, you must capture at the beginning of your turn.
        This is due to a move of your opponent at the previous turn
        (even though this is a fictitious board for pedagogical purpose).
        After your capture, by performing the right move you can even capture two more of your opponent's pieces!
        Keep it mind that the most useful in a capture is to take your opponent's pieces.`,new V3([[W3,W3,W3,j3,q3,q3,j3],[W3,W3,q3,j3,q3,q3,j3],[W3,j3,j3,q3,j3,Z3,j3],[q3,q3,q3,j3,q3,q3,j3],[q3,q3,q3,j3,q3,q3,W3],[j3,j3,j3,Z3,Z3,W3,W3],[q3,q3,q3,j3,W3,W3,W3]],42,[8,4],[2,3]),[new B3(new U3(new JX(3,6),Mw.of(rJ.UP)),[new F3([new JX(6,0),new JX(6,1),new JX(6,2),new JX(6,3)])],[new F3([new JX(0,5),new JX(1,5),new JX(2,5),new JX(3,5),new JX(4,5)]),new F3([new JX(1,2),new JX(2,2),new JX(3,2),new JX(4,2),new JX(5,2)])]),new B3(new U3(new JX(4,6),Mw.of(rJ.UP)),[new F3([new JX(6,0),new JX(6,1),new JX(6,2),new JX(6,3)])],[new F3([new JX(0,5),new JX(1,5),new JX(2,5),new JX(3,5),new JX(4,5)]),new F3([new JX(3,0),new JX(3,1),new JX(3,2),new JX(3,3),new JX(3,4)])]),new B3(new U3(new JX(3,6),Mw.of(rJ.UP)),[new F3([new JX(6,0),new JX(6,1),new JX(6,2),new JX(6,3)])],[new F3([new JX(1,2),new JX(2,2),new JX(3,2),new JX(4,2),new JX(5,2)]),new F3([new JX(0,5),new JX(1,5),new JX(2,5),new JX(3,5),new JX(4,5)])])],$localize`Congratulations, you have gotten 12 of your pieces back and captured 2 of your opponent's pieces.`,$localize`Failed, the best capture takes 2 of your opponent's pieces.`)]}}function K3(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa().$implicit,t=Sa();ha("ngClass",t.getPieceClass(e)),ra("cx",t.getCenterAt(e).x)("cy",t.getCenterAt(e).y)("r",t.SPACE_SIZE)}}function Q3(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",8),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t)}),ga(2,"polyline",9),la(3,K3,1,4,"circle",10),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),Ia("id","click_",e.x,"_",e.y,""),Ts(1),Ia("id","case_",e.x,"_",e.y,""),ha("ngClass",n.getSpaceClass(e)),ra("points",n.getHexaCoordsAt(e)),Ts(1),ha("ngIf",n.isPiece(e))}}function X3(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).onClick(t)}),fa()}if(2&e){const e=t.$implicit;ra("points",Sa(2).getHexaCoordsAt(e))}}function J3(e,t){if(1&e&&(Cn(),pa(0,"g",12),la(1,X3,1,1,"polyline",13),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e.capturedSpaces)}}function e4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"line",15),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.destination)}),fa(),fa()}if(2&e){const e=t.$implicit;Ts(1),ra("x1",e.x1)("y1",e.y1)("x2",e.x2)("y2",e.y2)}}function t4(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),fa()),2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getSidePieceClass(n)),ra("cx",10+e*r.SPACE_SIZE*.5)("cy",10+(r.SPACE_SIZE+10)*n)("r",.5*r.SPACE_SIZE)}}function n4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,t4,2,6,"g",5),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function r4(e,t){if(1&e&&(Cn(),ga(0,"line",17)),2&e){const e=Sa();ra("x1",e.inserted.get().x1)("y1",e.inserted.get().y1)("x2",e.inserted.get().x2)("y2",e.inserted.get().y2)}}const i4=function(){return[0,1]};let s4=(()=>{class e extends tJ{constructor(t){super(t),this.inserted=Mw.empty(),this.arrows=[],this.captured=[],this.moved=[],this.movePhase=e.PHASE_PLACEMENT_COORD,this.possibleCaptures=[],this.initialCaptures=[],this.placement=Mw.empty(),this.placementEntrance=Mw.empty(),this.finalCaptures=[],this.scores=Mw.of([0,0]),this.rules=new z3(V3),this.availableMinimaxes=[new H3(this.rules,"GipfMinimax")],this.encoder=B3.encoder,this.tutorial=(new Y3).tutorial,this.SPACE_SIZE=40,this.constructedState=this.rules.node.gameState,this.hexaLayout=new iJ(1.5*this.SPACE_SIZE,new JX(2*this.SPACE_SIZE,0),aJ.INSTANCE)}updateBoard(){this.showLastMove(),this.cancelMoveAttempt(),this.moveToInitialCaptureOrPlacementPhase()}showLastMove(){this.inserted=Mw.empty();const e=this.rules.node.move;if(e.isPresent()&&e.get().placement.direction.isPresent()){const t=e.get().placement;this.inserted=Mw.of(this.arrowTowards(t.coord,t.direction.get()))}this.cancelMoveAttempt()}arrowTowards(e,t){const n=e.getNext(t.getOpposite()),r=this.getCenterAt(e),i=this.getCenterAt(n);return new G3(n,e,i.x,i.y,r.x,r.y)}markCapture(e){e.forEach(e=>{this.captured.push(e)})}getAllCoords(){return this.constructedState.allCoords()}getPlayerSidePieces(e){const t=this.constructedState.getNumberOfPiecesToPlace(BK.of(e)),n=[];for(let r=0;r<t;r+=1)n.push(r);return n}isPiece(e){return this.getPiece(e)!==nJ.EMPTY}getPiece(e){return this.constructedState.getPieceAt(e)}onClick(t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+t.x+"_"+t.y);if(r.isFailure())return n.cancelMove(r.getReason());switch(n.movePhase){case e.PHASE_INITIAL_CAPTURE:case e.PHASE_FINAL_CAPTURE:return n.selectCapture(t);case e.PHASE_PLACEMENT_COORD:return n.selectPlacementCoord(t);default:Ow.expectToBe(n.movePhase,e.PHASE_PLACEMENT_DIRECTION);const r=n.placementEntrance.get();if(!1===r.isAlignedWith(t))return n.cancelMove($3.INVALID_PLACEMENT_DIRECTION());if(1!==r.getDistance(t))return n.cancelMove($3.CLICK_FURTHER_THAN_ONE_COORD());const i=rJ.factory.fromMove(r,t);return n.selectPlacementDirection(i.toOptional())}})()}selectCapture(t){var n=this;return Pw(function*(){const r=[];if(n.possibleCaptures.forEach(e=>{e.contains(t)&&r.push(e)}),r.length>1)return n.cancelMove($3.AMBIGUOUS_CAPTURE_COORD());if(0===r.length)return n.cancelMove($3.MISSING_CAPTURES());const i=r[0];switch(n.constructedState=z3.applyCapture(n.constructedState,i),n.markCapture(i),n.possibleCaptures=z3.getPossibleCaptures(n.constructedState),n.movePhase){case e.PHASE_INITIAL_CAPTURE:return n.initialCaptures.push(i),0===n.possibleCaptures.length?n.moveToPlacementPhase():TW.SUCCESS;default:return Ow.expectToBe(n.movePhase,e.PHASE_FINAL_CAPTURE),n.finalCaptures.push(i),0===n.possibleCaptures.length?n.tryMove(n.initialCaptures,n.placement.get(),n.finalCaptures):TW.SUCCESS}})()}moveToPlacementPhase(){return this.movePhase=e.PHASE_PLACEMENT_COORD,TW.SUCCESS}moveToInitialCaptureOrPlacementPhase(){return this.possibleCaptures=z3.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?e.PHASE_PLACEMENT_COORD:e.PHASE_INITIAL_CAPTURE,TW.SUCCESS}moveToFinalCapturePhaseOrTryMove(){var t=this;return Pw(function*(){return t.possibleCaptures=z3.getPossibleCaptures(t.constructedState),0===t.possibleCaptures.length?t.tryMove(t.initialCaptures,t.placement.get(),t.finalCaptures):(t.movePhase=e.PHASE_FINAL_CAPTURE,TW.SUCCESS)})()}computeArrows(e){this.arrows=[];for(const t of z3.getAllDirectionsForEntrance(this.constructedState,e))if(!1===z3.isLineComplete(this.constructedState,e,t)){const n=e.getNext(t),r=this.getCenterAt(e),i=this.getCenterAt(n);this.arrows.push(new G3(e,n,r.x,r.y,i.x,i.y))}}selectPlacementCoord(t){var n=this;return Pw(function*(){const r=n.rules.placementCoordValidity(n.constructedState,t);return r.isFailure()?n.cancelMove(r.getReason()):(n.placementEntrance=Mw.of(t),n.constructedState.getPieceAt(t)===nJ.EMPTY?n.selectPlacementDirection(Mw.empty()):(n.movePhase=e.PHASE_PLACEMENT_DIRECTION,n.computeArrows(t),0===n.arrows.length&&n.cancelMove($3.NO_DIRECTIONS_AVAILABLE()),TW.SUCCESS))})()}selectPlacementDirection(e){var t=this;return Pw(function*(){t.placement=Mw.of(new U3(t.placementEntrance.get(),e));const n=t.rules.placementValidity(t.constructedState,t.placement.get());return n.isFailure()?t.cancelMove(n.getReason()):(t.arrows=[],t.constructedState=z3.applyPlacement(t.constructedState,t.placement.get()),t.moveToFinalCapturePhaseOrTryMove())})()}tryMove(e,t,n){var r=this;return Pw(function*(){const i=new B3(t,e,n);return yield r.chooseMove(i,r.rules.node.gameState,r.scores.get())})()}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.captured=[],this.moved=[];const e=this.rules.node.move;if(e.isPresent()){const t=e.get(),n=this.rules.node.mother.get().gameState;t.initialCaptures.forEach(e=>this.markCapture(e)),t.finalCaptures.forEach(e=>this.markCapture(e)),this.moved=this.rules.getPiecesMoved(n,t.initialCaptures,t.placement)}this.initialCaptures=[],this.finalCaptures=[],this.placementEntrance=Mw.empty(),this.placement=Mw.empty(),this.arrows=[],this.moveToInitialCaptureOrPlacementPhase()}getSpaceClass(e){return this.captured.some(t=>t.equals(e))?"captured":this.moved.some(t=>t.equals(e))?"moved":""}getPieceClass(e){const t=this.getPiece(e);return this.getPlayerClass(BK.of(t.value))}getSidePieceClass(e){return this.getPlayerClass(BK.of(e))}}return e.PHASE_INITIAL_CAPTURE=0,e.PHASE_PLACEMENT_COORD=1,e.PHASE_PLACEMENT_DIRECTION=2,e.PHASE_FINAL_CAPTURE=3,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-gipf"]],features:[Go],decls:11,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -12 708 854","preserveAspectRatio","xMidYMid meet"],["id","arrowhead","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7"],["id","arrowhead-moved","markerWidth","10","markerHeight","7","refX","5","refY","3.5","orient","auto"],["points","0 0, 10 3.5, 0 7",1,"moved","moved-stroke"],[4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],["class","arrow moved-stroke","marker-end","url(#arrowhead-moved)",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"],["pointer-events","fill",1,"capturable"],["class","no-fill","stroke-linecap","round",3,"click",4,"ngFor","ngForOf"],["stroke-linecap","round",1,"no-fill",3,"click"],["marker-end","url(#arrowhead)",1,"arrow",3,"click"],[1,"base","small-stroke",3,"id","ngClass"],["marker-end","url(#arrowhead-moved)",1,"arrow","moved-stroke"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),pa(4,"marker",3),ga(5,"polygon",4),fa(),fa(),la(6,Q3,4,7,"g",5),la(7,J3,2,1,"g",6),la(8,e4,2,4,"g",5),la(9,n4,2,1,"g",5),la(10,r4,1,4,"line",7),fa()),2&e&&(Ts(6),ha("ngForOf",t.getAllCoords()),Ts(1),ha("ngForOf",t.possibleCaptures),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",wu(5,i4)),Ts(1),ha("ngIf",t.inserted.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class o4 extends yJ{equals(e){return this===e||this.coord.equals(e.coord)}toString(){return this===o4.PASS?"GoMove.PASS":this===o4.ACCEPT?"GoMove.ACCEPT":"GoMove("+this.coord.x+", "+this.coord.y+")"}}o4.PASS=new o4(-1,0),o4.ACCEPT=new o4(-2,0),o4.PASS_NUMBER=-1,o4.ACCEPT_NUMBER=-2,o4.encoder=new class extends FK{maxValue(){return 360}encodeNumber(e){return 19*e.coord.y+e.coord.x}decodeNumber(e){if(e===o4.PASS_NUMBER)return o4.PASS;const t=e%19;return new o4(t,(e-t)/19)}};class a4{constructor(e,t){this.player=e,this.type=t}equals(e){return e===this}toString(){switch(this){case a4.BLACK:return"GoPiece.BLACK";case a4.WHITE:return"GoPiece.WHITE";case a4.EMPTY:return"GoPiece.EMPTY";case a4.DEAD_BLACK:return"GoPiece.DEAD_BLACK";case a4.DEAD_WHITE:return"GoPiece.DEAD_WHITE";case a4.BLACK_TERRITORY:return"GoPiece.BLACK_TERRITORY";default:return NW(this===a4.WHITE_TERRITORY,"Unexisting GoPiece"),"GoPiece.WHITE_TERRITORY"}}static pieceBelongTo(e,t){return t===e.player&&"territory"!==e.type}static ofPlayer(e){return e===BK.ZERO?a4.BLACK:a4.WHITE}isOccupied(){return[a4.BLACK,a4.WHITE,a4.DEAD_BLACK,a4.DEAD_WHITE].includes(this)}isEmpty(){return[a4.BLACK_TERRITORY,a4.WHITE_TERRITORY,a4.EMPTY].includes(this)}isDead(){return[a4.DEAD_BLACK,a4.DEAD_WHITE].includes(this)}isTerritory(){return[a4.BLACK_TERRITORY,a4.WHITE_TERRITORY].includes(this)}getOwner(){return this.player}nonTerritory(){return NW(this.isEmpty(),'Usually not false, if false, cover by test and return "this"'),a4.EMPTY}}a4.BLACK=new a4(BK.ZERO,"alive"),a4.WHITE=new a4(BK.ONE,"alive"),a4.EMPTY=new a4(VK.NONE,"empty"),a4.DEAD_BLACK=new a4(BK.ZERO,"dead"),a4.DEAD_WHITE=new a4(BK.ONE,"dead"),a4.BLACK_TERRITORY=new a4(VK.NONE,"territory"),a4.WHITE_TERRITORY=new a4(VK.NONE,"territory");var l4=(()=>(function(e){e.PLAYING="PLAYING",e.PASSED="PASSED",e.COUNTING="COUNTING",e.ACCEPT="ACCEPT",e.FINISHED="FINISHED"}(l4||(l4={})),l4))();let c4=(()=>{class e extends fJ{constructor(e,t,n,r,i){super(e,n),this.captured=t,this.koCoord=r,this.phase=i}static getInitialState(){const t=e.getStartingBoard();return new e(t,[0,0],0,Mw.empty(),l4.PLAYING)}getCapturedCopy(){return[this.captured[0],this.captured[1]]}static getStartingBoard(){return GK.createTable(e.WIDTH,e.HEIGHT,a4.EMPTY)}copy(){return new e(this.getCopiedBoard(),this.getCapturedCopy(),this.turn,this.koCoord,this.phase)}isDead(e){return this.getPieceAt(e).isDead()}isTerritory(e){return this.getPieceAt(e).isTerritory()}}return e.WIDTH=13,e.HEIGHT=13,e})(),u4=(()=>{class e{constructor(e){this.color=e}selfContains(e){return this.getCoords().some(t=>t.equals(e))}static insertAsEntryPoint(e,t){return 0===e.length?[t]:t.compareTo(e[0])<0?[t].concat(e):e.concat([t])}}return e.VERBOSE=!1,e})();class h4 extends u4{constructor(e,t,n,r,i,s){super(e),this.emptyCoords=t,this.blackCoords=n,this.whiteCoords=r,this.deadBlackCoords=i,this.deadWhiteCoords=s}getCoords(){return this.color===a4.BLACK?this.blackCoords:this.color===a4.WHITE?this.whiteCoords:this.color===a4.DEAD_BLACK?this.deadBlackCoords:this.color===a4.DEAD_WHITE?this.deadWhiteCoords:this.emptyCoords}contains(e){return this.blackCoords.concat(this.whiteCoords.concat(this.emptyCoords.concat(this.deadBlackCoords.concat(this.deadWhiteCoords)))).some(t=>t.equals(e))}addPawn(e,t){if(this.contains(e))throw new Error("This group already contains "+e);switch(t){case a4.BLACK:this.blackCoords=u4.insertAsEntryPoint(this.blackCoords,e);break;case a4.WHITE:this.whiteCoords=u4.insertAsEntryPoint(this.whiteCoords,e);break;case a4.DEAD_BLACK:this.deadBlackCoords=u4.insertAsEntryPoint(this.deadBlackCoords,e);break;case a4.DEAD_WHITE:this.deadWhiteCoords=u4.insertAsEntryPoint(this.deadWhiteCoords,e);break;default:Ow.expectToBeMultiple(t,[a4.EMPTY,a4.BLACK_TERRITORY,a4.WHITE_TERRITORY]),this.emptyCoords=u4.insertAsEntryPoint(this.emptyCoords,e)}}isMonoWrapped(){return(0===this.emptyCoords.length?1:2)*(this.blackCoords.length+this.deadWhiteCoords.length===0?1:2)*(this.whiteCoords.length+this.deadBlackCoords.length===0?1:2)==4}getWrapper(){const e=new CJ([{key:a4.EMPTY,value:this.emptyCoords.length},{key:a4.BLACK,value:this.blackCoords.length+this.deadWhiteCoords.length},{key:a4.WHITE,value:this.whiteCoords.length+this.deadBlackCoords.length}]);e.put(this.color.nonTerritory(),0);const t=e.filter((e,t)=>t>0);if(1===t.size())return t.getByIndex(0).key;throw new Error("Can't call getWrapper on non-mono-wrapped group")}getNeighboorsEntryPoint(){const e=[];return this.color!==a4.EMPTY&&this.emptyCoords.length>0&&e.push(this.emptyCoords[0]),this.color!==a4.BLACK&&this.blackCoords.length>0&&e.push(this.blackCoords[0]),this.color!==a4.WHITE&&this.whiteCoords.length>0&&e.push(this.whiteCoords[0]),this.color!==a4.DEAD_BLACK&&this.deadBlackCoords.length>0&&e.push(this.deadBlackCoords[0]),this.color!==a4.DEAD_WHITE&&this.deadWhiteCoords.length>0&&e.push(this.deadWhiteCoords[0]),e}}class d4 extends class{getGroupDatas(e,t){Tw(u4.VERBOSE,"GroupDatas.getGroupDatas("+e+", "+t+")");const n=this.getNewInstance(t[e.y][e.x]);return this._getGroupDatas(e,t,n)}_getGroupDatas(e,t,n){Tw(u4.VERBOSE,{GroupDatas_getGroupDatas:{groupDatas:n,coord:e}});const r=t[e.y][e.x];if(n.addPawn(e,r),r===n.color)for(const i of this.getDirections()){const r=e.getNext(i);r.isInRange(t[0].length,t.length)&&(n.contains(r)||(n=this._getGroupDatas(r,t,n)))}return n}}{getNewInstance(e){return new h4(e,[],[],[],[],[])}getDirections(){return QX.ORTHOGONALS}}let p4=(()=>{class e{}return e.ILLEGAL_KO=()=>$localize`This move is a ko, you must play somewhere else before you can play in this intersection again.`,e.CANNOT_PASS_AFTER_PASSED_PHASE=()=>$localize`We are in the counting phase, you must mark stones as dead or alive or accept the current board by passing your turn.`,e.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE=()=>$localize`You cannot accept before the counting phase.`,e.OCCUPIED_INTERSECTION=()=>$localize`This intersection is already occupied.`,e.CANNOT_COMMIT_SUICIDE=()=>$localize`You cannot commit suicide.`,e})(),f4=(()=>{class e extends PJ{static isLegal(t,n){const r=!1;if(Tw(e.VERBOSE||r,{isLegal:{move:t,state:n}}),e.isPass(t)){const t=n.phase===l4.PLAYING,i=n.phase===l4.PASSED;return Tw(e.VERBOSE||r,"GoRules.isLegal at "+n.phase+(t||i?" forbid":" allowed")+" passing on "+n.getCopiedBoard()),t||i?SW.success([]):SW.failure(p4.CANNOT_PASS_AFTER_PASSED_PHASE())}if(e.isAccept(t)){const e=n.phase===l4.ACCEPT;return n.phase===l4.COUNTING||e?SW.success([]):SW.failure(p4.CANNOT_ACCEPT_BEFORE_COUNTING_PHASE())}return e.isOccupied(t.coord,n.getCopiedBoard())?(Tw(e.VERBOSE||r,"GoRules.isLegal: move is marking"),e.isLegalDeadMarking(t,n)?SW.success([]):SW.failure(p4.OCCUPIED_INTERSECTION())):(Tw(e.VERBOSE||r,"GoRules.isLegal: move is normal stuff: "+t.toString()),e.isLegalNormalMove(t,n))}static getNewKo(e,t,n){if(1===n.length){const r=n[0],i=e.coord,s=t[i.y][i.x],o=(new d4).getGroupDatas(i,t),a=o.emptyCoords,l=a4.pieceBelongTo(s,BK.ZERO)?o.blackCoords:o.whiteCoords;if(1===a.length&&a[0].equals(r)&&1===l.length)return Mw.of(r)}return Mw.empty()}static markTerritoryAndCount(t){Tw(e.VERBOSE,{markTerritoryAndCount:{state:t}});const n=t.getCopiedBoard(),r=e.getTerritoryLikeGroup(t),i=t.getCapturedCopy();for(const e of r){const t=e.getWrapper();if(t===a4.WHITE){i[1]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=a4.WHITE_TERRITORY}else{NW(t===a4.BLACK,"territory should be wrapped by black or white, not by "+t.toString()),i[0]+=e.emptyCoords.length;for(const t of e.getCoords())n[t.y][t.x]=a4.BLACK_TERRITORY}}return new c4(n,i,t.turn,t.koCoord,t.phase)}static removeAndSubstractTerritory(e){const t=e.getCopiedBoard(),n=e.getCapturedCopy();let r;for(let i=0;i<e.board.length;i++)for(let s=0;s<e.board[0].length;s++)r=t[i][s],r===a4.BLACK_TERRITORY?(t[i][s]=a4.EMPTY,n[0]=n[0]-1):r===a4.WHITE_TERRITORY&&(t[i][s]=a4.EMPTY,n[1]=n[1]-1);return new c4(t,n,e.turn,e.koCoord,e.phase)}static getEmptyZones(t){return e.getGroupsDatasWhere(t.getCopiedBoard(),e=>e.isEmpty())}static getGroupsDatasWhere(e,t){const n=[];let r,i,s;const o=new d4;for(let a=0;a<e.length;a++)for(let l=0;l<e[0].length;l++)r=new JX(l,a),s=e[a][l],t(s)&&(n.some(e=>e.selfContains(r))||(i=o.getGroupDatas(r,e),n.push(i)));return n}static addDeadToScore(e){const t=e.getCapturedCopy();let n,r=t[1],i=t[0];for(let s=0;s<e.board.length;s++)for(let t=0;t<e.board[0].length;t++)n=e.getPieceAtXY(t,s),n===a4.DEAD_BLACK?r++:n===a4.DEAD_WHITE&&i++;return[i,r]}static switchAliveness(e,t){const n=t.getCopiedBoard();NW(!1===n[e.y][e.x].isEmpty(),"Can't switch emptyness aliveness");const r=(new d4).getGroupDatas(e,n),i=t.getCapturedCopy();switch(r.color){case a4.DEAD_BLACK:i[1]-=2*r.deadBlackCoords.length;for(const e of r.deadBlackCoords)n[e.y][e.x]=a4.BLACK;break;case a4.DEAD_WHITE:i[0]-=2*r.deadWhiteCoords.length;for(const e of r.deadWhiteCoords)n[e.y][e.x]=a4.WHITE;break;case a4.WHITE:i[0]+=2*r.whiteCoords.length;for(const e of r.whiteCoords)n[e.y][e.x]=a4.DEAD_WHITE;break;default:Ow.expectToBe(r.color,a4.BLACK),i[1]+=2*r.blackCoords.length;for(const e of r.blackCoords)n[e.y][e.x]=a4.DEAD_BLACK}return new c4(n,i,t.turn,t.koCoord,t.phase)}static getGameStatus(e){const t=e.gameState;return t.phase===l4.FINISHED?t.captured[0]>t.captured[1]?SJ.ZERO_WON:t.captured[1]>t.captured[0]?SJ.ONE_WON:SJ.DRAW:SJ.ONGOING}static isPass(e){return e.equals(o4.PASS)}static isAccept(e){return e.equals(o4.ACCEPT)}static isLegalDeadMarking(t,n){return e.isOccupied(t.coord,n.getCopiedBoard())&&(n.phase===l4.COUNTING||n.phase===l4.ACCEPT)}static isLegalNormalMove(t,n){const r=n.getCopiedBoard();if(e.isKo(t,n))return SW.failure(p4.ILLEGAL_KO());[l4.COUNTING,l4.ACCEPT].includes(n.phase)&&(n=e.resurrectStones(n));const i=e.getCaptureState(t,n);if(g4.isCapturing(i))return SW.success(i.capturedCoords);{r[t.coord.y][t.coord.x]=n.turn%2==0?a4.BLACK:a4.WHITE;const e=0===(new d4).getGroupDatas(t.coord,r).emptyCoords.length;return r[t.coord.y][t.coord.x]=a4.EMPTY,e?SW.failure(p4.CANNOT_COMMIT_SUICIDE()):SW.success([])}}static isOccupied(e,t){return t[e.y][e.x].isOccupied()}static isKo(e,t){return!!t.koCoord.isPresent()&&e.coord.equals(t.koCoord.get())}static getCaptureState(t,n){Tw(e.VERBOSE||!1,{getCaptureState:{move:t,state:n}});const r=new g4;let i;for(const s of QX.ORTHOGONALS)i=e.getCapturedInDirection(t.coord,s,n),i.length>0&&r.capturedCoords.every(e=>!i[0].equals(e))&&(r.capturedCoords=r.capturedCoords.concat(i));return r}static getCapturedInDirection(t,n,r){const i=r.getCopiedBoard(),s=t.getNext(n);if(s.isInRange(r.board[0].length,r.board.length)&&i[s.y][s.x]===(r.turn%2==0?a4.WHITE:a4.BLACK)){Tw(e.VERBOSE||!1,"a group could be captured");const t=(new d4).getGroupDatas(s,i);if(e.isCapturableGroup(t,r.koCoord))return Tw(e.VERBOSE||!1,{neightbooringGroupCoord:t.getCoords(),message:"is capturable"}),t.getCoords()}return[]}static isCapturableGroup(e,t){return!(!e.color.isOccupied()||1!==e.emptyCoords.length)&&!1===t.equalsValue(e.emptyCoords[0])}static getTerritoryLikeGroup(t){return e.getEmptyZones(t).filter(e=>e.isMonoWrapped())}static applyPass(t){const n=t.getCopiedBoard(),r=t.getCapturedCopy(),i=t.turn;let s,o;return t.phase===l4.PASSED?(s=l4.COUNTING,o=new c4(n,r,i+1,Mw.empty(),s),o=e.markTerritoryAndCount(o)):(NW(t.phase===l4.PLAYING,"Cannot pass in counting phase!"),s=l4.PASSED,o=new c4(n,r,i+1,Mw.empty(),s)),o}static applyLegalAccept(e){const t=e.getCopiedBoard();let n;return n=e.phase===l4.COUNTING?l4.ACCEPT:l4.FINISHED,new c4(t,e.getCapturedCopy(),e.turn+1,Mw.empty(),n)}static applyNormalLegalMove(t,n,r){let i;Tw(e.VERBOSE,{applyNormalLegal:{currentState:t,legalMove:n,status}}),i=[l4.COUNTING,l4.ACCEPT].includes(t.phase)?e.resurrectStones(t):t.copy();const s=n.coord.x,o=n.coord.y,a=i.getCopiedBoard(),l=i.turn,c=a4.ofPlayer(i.getCurrentPlayer()),u=l+1;a[o][s]=c;for(const e of r)a[e.y][e.x]=a4.EMPTY;const h=e.getNewKo(n,a,r),d=i.getCapturedCopy();return d[c.player.value]+=r.length,new c4(a,d,u,h,l4.PLAYING)}static resurrectStones(t){for(let n=0;n<t.board.length;n++)for(let r=0;r<t.board[0].length;r++)t.getPieceAtXY(r,n).isDead()&&(t=e.switchAliveness(new JX(r,n),t));return e.removeAndSubstractTerritory(t)}static applyDeadMarkingMove(t,n){Tw(e.VERBOSE,{applyDeadMarkingMove:{legalMove:t,state:n}});const r=e.removeAndSubstractTerritory(n),i=e.switchAliveness(t.coord,r),s=new c4(i.getCopiedBoard(),i.getCapturedCopy(),i.turn+1,Mw.empty(),l4.COUNTING);return e.markTerritoryAndCount(s)}isLegal(t,n){return e.isLegal(t,n)}applyLegalMove(t,n,r){return Tw(e.VERBOSE,{applyLegalMove:{legalMove:t,state:n,status:r}}),e.isPass(t)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isPass"),e.applyPass(n)):e.isAccept(t)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isAccept"),e.applyLegalAccept(n)):e.isLegalDeadMarking(t,n)?(Tw(e.VERBOSE,"GoRules.applyLegalMove: isDeadMarking"),e.applyDeadMarkingMove(t,n)):(Tw(e.VERBOSE,"GoRules.applyLegalMove: else it is normal move"),e.applyNormalLegalMove(n,t,r))}getGameStatus(t){return e.getGameStatus(t)}}return e.VERBOSE=!1,e})();class g4{constructor(){this.capturedCoords=[]}static isCapturing(e){return e.capturedCoords.length>0}}class m4 extends cJ{getListMoves(e){Tw(f4.VERBOSE||!1,"GoRules.getListMoves");const t=e.gameState,n=this.getPlayingMovesList(t);if(t.phase===l4.PLAYING||t.phase===l4.PASSED)return n.push(o4.PASS),n;{Tw(f4.VERBOSE||!1,"GoRules.getListMoves in counting phase");const e=this.getCountingMovesList(t);return 0===e.length?[o4.ACCEPT]:e}}getPlayingMovesList(e){const t=[];let n;for(let r=0;r<e.board.length;r++)for(let i=0;i<e.board[0].length;i++)n=new o4(i,r),e.getPieceAt(n.coord)===a4.EMPTY&&f4.isLegal(n,e).isSuccess()&&t.push(n);return t}getCountingMovesList(e){const t=[],n=this.getCorrectBoard(e).getCopiedBoard(),r=f4.getGroupsDatasWhere(n,e=>e!==a4.EMPTY);for(const i of r){const r=i.getCoords()[0],s=n[r.y][r.x];if(e.getPieceAt(r)!==s){const e=new o4(r.x,r.y);return t.push(e),t}}return t}getCorrectBoard(e){const t=this.mapBoard(e.getCopiedBoard(),e=>e===a4.BLACK?a4.DEAD_BLACK:e===a4.WHITE?a4.DEAD_WHITE:e.isTerritory()?a4.EMPTY:e),n=new c4(t,e.getCapturedCopy(),e.turn,e.koCoord,e.phase),r=f4.getTerritoryLikeGroup(n);return this.setAliveUniqueWrapper(n,r)}mapBoard(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<e[0].length;r++)e[n][r]=t(e[n][r]);return e}setAliveUniqueWrapper(e,t){let n,r=e.copy();for(const i of t){n=i.deadBlackCoords.concat(i.deadWhiteCoords);for(const e of n)r.isDead(e)&&(r=f4.switchAliveness(e,r))}return r}getBoardValue(e){const t=e.gameState,n=f4.getGameStatus(e);if(n.isEndGame)return new uJ(n.toBoardValue());Tw(f4.VERBOSE||!1,"GoRules.getBoardValue");const r=f4.markTerritoryAndCount(t),i=r.getCapturedCopy(),s=this.getDeadStones(r);return new uJ(i[1]+2*s[0]-(i[0]+2*s[1]))}getDeadStones(e){const t=[0,0];for(let n=0;n<e.board.length;n++)for(let r=0;r<e.board[0].length;r++){const i=e.getPieceAtXY(r,n);"dead"===i.type&&(t[i.player.value]=t[i.player.value]+1)}return t}}const y4=a4.WHITE,v4=a4.BLACK,_4=a4.DEAD_WHITE,C4=a4.WHITE_TERRITORY,E4=a4.BLACK_TERRITORY,w4=a4.EMPTY;class b4{constructor(){this.tutorial=[kJ.informational($localize`Preliminary information`,$localize`The game of Go is played on a board called a Goban, and the stones are placed on the intersections.
        The traditional board is made of 19x19 intersections, but on this website we have the 13x13 board.
        (For shorter parts, 9x9 and 5x5 boards exist, but are not yet available here).
        For this tutorial, we will use a smaller board for pedagogical purposes.`,c4.getInitialState()),kJ.informational($localize`Goal of the game`,$localize`The goal of the game is to have the most points at the end of the game.
        We call "territories" the intersections that are empty and isolated from the rest of the Goban by the stones of a single player.
        Here, Dark has 9 territories on the left, and Light has 8 on the right.
        The top part belongs to no one.
        Each player's score at the end of the game is the sum of that player's territories and captures.`,new c4([[w4,v4,w4,w4,y4,y4],[w4,v4,w4,w4,y4,w4],[w4,v4,v4,y4,y4,w4],[w4,w4,v4,y4,w4,w4],[w4,w4,v4,y4,w4,w4],[w4,w4,v4,y4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING)),kJ.fromMove($localize`Simple capture`,$localize`An isolated stone, like the one in the middle here, has 4 neighboring intersections (not 8, because we do not count diagonals).
        It is said of a group which has exactly 2 free neighboring squares, that this group has two liberties.
        If Dark plays on the last liberty of the light stone, this stone is removed from the Goban (captured) and Dark earns one point.<br/><br/>
        The light piece only has one liberty left, play there.`,new c4([[w4,w4,w4,w4,w4],[w4,w4,v4,w4,w4],[w4,v4,y4,w4,w4],[w4,w4,v4,w4,w4],[w4,w4,w4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING),[new o4(3,2)],$localize`Congratulations, you have earned one point.`,$localize`Failed, try again by playing on one of the intersections directly next to the light stone.`),kJ.fromMove($localize`Capturing multiple stones`,$localize`Stones that are connected horizontally or vertically must be captured at the same time, and are not capturable in isolation.<br/><br/>
        The light group here only has one liberty left, capture it.`,new c4([[w4,v4,w4,w4,w4],[v4,y4,w4,w4,w4],[v4,y4,y4,v4,w4],[w4,v4,v4,w4,w4],[w4,w4,w4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING),[new o4(2,1)],$localize`Congratulations, you have earned three points and formed a territory.`,$localize`Failed, you have not captured the group. Play on the last liberty of that group.`),kJ.informational($localize`Suicide`,$localize`In Go, suicide is forbidden.
        If putting a piece on an intersection removes the last liberty of your group and does not capture any stone, playing on that intersection would be a suicide and is therefore forbidden.
        Here, the top left intersection is a suicide for Light.
        On the bottom right, it would be a suicide for Dark, and on the bottom left it is not a suicide for any player.`,new c4([[w4,v4,w4,w4,w4],[v4,w4,w4,w4,w4],[v4,w4,w4,w4,y4],[y4,v4,w4,y4,w4],[w4,y4,w4,y4,v4]],[0,0],0,Mw.empty(),l4.PLAYING)),kJ.informational($localize`Life and death (death)`,$localize`From the capture rule follows the life and death notion:
        dead stones are stones that are definitely capturable (without losing anything else).
        Alive stones are stones that can never be captured.
        From the capture rule, Dark can play inside Light's territory and make a capture.
        In this case, we say that Light has only one eye (its last liberty) and that Light is dead (even if not yet captured).
        At the end of the game, the dead stones will count as captures, and the intersections they occupy as territories.`,new c4([[w4,w4,w4,w4,w4],[v4,v4,v4,w4,w4],[y4,y4,v4,w4,w4],[w4,y4,v4,w4,w4],[y4,y4,v4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING)),kJ.informational($localize`Life and death (eyes)`,$localize`Here, Light cannot play on the top left, nor on the bottom left.
        Light will never be able to capture Dark.
        We say that Dark has two eyes (the eye on the top left, and the one on the bottom left) and that Dark is alive.`,new c4([[w4,v4,y4,w4,w4],[y4,v4,y4,w4,w4],[v4,v4,y4,w4,w4],[y4,v4,y4,w4,w4],[w4,v4,y4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING)),kJ.informational($localize`Seki`,$localize`If Dark plays on the middle line, Light will play on the opposite intersection and capture Dark.
        Similarly, if Light plays on the middle line, Dark will capture Light.
        In other words, there is no point in playing on the middle line.
        In that case, we say that stones in the middle are alive by Seki, and that both intersections in the middle are neutral.`,new c4([[w4,y4,v4,w4,y4,v4,w4],[w4,y4,v4,v4,y4,v4,w4],[w4,y4,v4,v4,y4,v4,w4],[w4,y4,v4,v4,y4,v4,w4],[w4,y4,v4,y4,y4,v4,w4],[w4,y4,v4,y4,y4,v4,w4],[w4,y4,v4,w4,y4,v4,w4]],[0,0],0,Mw.empty(),l4.PLAYING)),kJ.fromMove($localize`Ko`,$localize`A player, by putting a stone, cannot go back to an identical state of the Goban as before, in order to avoid an endless game.<br/><br/>
        Capture the light stone.`,new c4([[w4,w4,w4,w4,w4,w4,w4],[w4,w4,w4,w4,w4,w4,w4],[w4,w4,w4,v4,y4,w4,w4],[w4,w4,v4,y4,w4,y4,w4],[w4,w4,w4,v4,y4,w4,w4],[w4,w4,w4,w4,w4,w4,w4],[w4,w4,w4,w4,w4,w4,w4]],[0,0],0,Mw.empty(),l4.PLAYING),[new o4(4,3)],$localize`Now, if Light tries to recapture the stone that Dark has just put on the Goban, this one would go back to its previous state, opening the door for an endless game.
        This intersection is therefore marked with a red square, to remind the players that this intersection is forbidden.
        This rule is called the Ko.
        The trick for Light is to try to create a big enough threat so that Dark must answer immediately, and does not have the time to protect its last stone, so that Light can capture it right after.`,$localize`Failed!`),kJ.fromMove($localize`End of the game`,$localize`When a player feels that there is no advantage to putting a new stone, that player can pass a turn.
        The game phase stops when both players pass consecutively, and we move on to the counting phase.
        The dead groups are then marked by clicking on them.
        Every intersection in a player's territory earns that player a point.
        The winner is the one with most points.<br/><br/>
        A last stone is dead, mark it.`,new c4([[y4,v4,v4,v4,v4,v4,E4,E4,E4],[y4,y4,y4,y4,v4,v4,v4,E4,E4],[y4,C4,y4,y4,v4,_4,_4,v4,E4],[v4,y4,y4,y4,y4,v4,E4,E4,E4],[w4,y4,C4,y4,v4,v4,_4,v4,E4],[y4,C4,y4,y4,v4,v4,v4,v4,v4],[y4,y4,v4,v4,v4,y4,y4,v4,y4],[v4,v4,v4,y4,y4,y4,C4,y4,y4],[E4,E4,v4,v4,v4,y4,y4,C4,C4]],[0,0],0,Mw.empty(),l4.COUNTING),[new o4(0,3)],$localize`Congratulations, Dark has 15 territories and 3 light stones still present, called prisoners at the end of the game.
        The intersections where the prisoners are count as Dark's territory
        Light has 8 territories and 1 prisoner.
        The end result is therefore 18 - 9 for Dark.`,$localize`Failed, try again.`)]}}function S4(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa(2).index,t=Sa().index;ra("cx",25+50*e)("cy",25+50*t)("r",22)}}function P4(e,t){if(1&e){const e=va();Cn(),pa(0,"line",11),Ea("click",function(){Gt(e);const t=Sa(2).index,n=Sa().index;return Sa().onClick(t,n)}),fa()}if(2&e){const e=Sa(2).index,t=Sa().index;ra("x1",50*e)("y1",50*t)("x2",50+50*e)("y2",50+50*t)}}function O4(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",7),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onClick(t,n)}),fa(),la(2,S4,1,3,"circle",8),la(3,P4,1,4,"line",9),fa()}if(2&e){const e=Sa().index,t=Sa().index,n=Sa();Ts(1),ha("ngClass",n.getSpaceClass(e,t)),ra("cx",25+50*e)("cy",25+50*t)("r",22),Ts(1),ha("ngIf",n.isLastCase(e,t)),Ts(1),ha("ngIf",n.isDead(e,t))}}function T4(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",15),Ea("click",function(){Gt(e);const t=Sa(2).index,n=Sa().index;return Sa().onClick(t,n)}),fa()}if(2&e){const e=Sa(2),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();ra("cx",25+50*t)("cy",25+50*r)("r",10)("class",n===i.GoPiece.WHITE_TERRITORY?"player1":"player0")}}function I4(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",12),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onClick(t,n)}),fa(),pa(1,"line",13),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onClick(t,n)}),fa(),pa(2,"line",13),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().onClick(t,n)}),fa(),la(3,T4,1,4,"circle",14)}if(2&e){const e=Sa().index,t=Sa().index,n=Sa();Ia("id","click_",e,"_",t,""),ra("x",50*e)("y",50*t),Ts(1),ra("x1",50*e)("y1",25+50*t)("x2",50+50*e)("y2",25+50*t),Ts(1),ra("x1",25+50*e)("y1",50*t)("x2",25+50*e)("y2",50+50*t),Ts(1),ha("ngIf",n.isTerritory(e,t))}}function k4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O4,4,6,"g",5),la(2,I4,4,13,"ng-template",null,6,Ku),fa()),2&e){const e=t.index,n=ca(3),r=Sa().index,i=Sa();Ts(1),ha("ngIf",i.caseIsFull(e,r))("ngIfElse",n)}}function A4(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,k4,4,2,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function M4(e,t){if(1&e&&(Cn(),ga(0,"rect",16)),2&e){const e=Sa();ra("x",12.5+50*e.ko.get().x)("y",12.5+50*e.ko.get().y)}}function N4(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",17),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit;ra("cx",25+50*e.x)("cy",25+50*e.y)("r",7)}}let R4=(()=>{class e extends u1{constructor(e){super(e),this.ko=Mw.empty(),this.last=Mw.empty(),this.captures=[],this.GoPiece=a4,this.scores=Mw.of([0,0]),this.rules=new f4(c4),this.availableMinimaxes=[new m4(this.rules,"GoMinimax")],this.encoder=o4.encoder,this.tutorial=(new b4).tutorial,this.canPass=!0,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.last=Mw.empty();const i=new o4(e,t);return n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){Tw(e.VERBOSE,"updateBoard");const t=this.rules.node.gameState,n=this.rules.node.move,r=t.phase;this.board=t.getCopiedBoard(),this.scores=Mw.of(t.getCapturedCopy()),this.ko=t.koCoord,n.isPresent()?this.showCaptures():this.captures=[],this.last=n.map(e=>e.coord),this.canPass=r!==l4.FINISHED}showCaptures(){const e=this.rules.node.mother.get().gameState;this.captures=[];for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board[0].length;n++){const r=new JX(n,t),i=!1===e.getPieceAt(r).isEmpty(),s=this.board[t][n]===a4.EMPTY,o=!1===this.ko.equalsValue(r);i&&s&&o&&this.captures.push(r)}}pass(){var e=this;return Pw(function*(){const t=e.rules.node.gameState.phase;return t===l4.PLAYING||t===l4.PASSED?e.onClick(o4.PASS.coord.x,o4.PASS.coord.y):(NW(t===l4.COUNTING||t===l4.ACCEPT,"GoComponent: pass() must be called only in playing, passed, counting, or accept phases"),e.onClick(o4.ACCEPT.coord.x,o4.ACCEPT.coord.y))})()}getSpaceClass(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t);return this.getPlayerClass(n.getOwner())}caseIsFull(e,t){return this.rules.node.gameState.getPieceAtXY(e,t)!==a4.EMPTY&&!this.isTerritory(e,t)}isLastCase(e,t){if(this.last.isPresent()){const n=this.last.get();return e===n.x&&t===n.y}return!1}isDead(e,t){return this.rules.node.gameState.isDead(new JX(e,t))}isTerritory(e,t){return this.rules.node.gameState.isTerritory(new JX(e,t))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-go"]],features:[Go],decls:5,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["x","0","y","0",1,"base","mid-small-stroke"],[4,"ngFor","ngForOf"],["width","25","height","25","class","captured-stroke mid-stroke no-fill",4,"ngIf"],["class","captured",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["empty",""],[1,"base","mid-stroke",3,"ngClass","click"],["class","base no-fill mid-stroke highlighted",4,"ngIf"],["class","base no-fill captured-stroke",3,"click",4,"ngIf"],[1,"base","no-fill","mid-stroke","highlighted"],[1,"base","no-fill","captured-stroke",3,"click"],["width","50","height","50","fill-opacity","0",1,"base","no-stroke",3,"id","click"],[1,"base","mid-stroke",3,"click"],[3,"click",4,"ngIf"],[3,"click"],["width","25","height","25",1,"captured-stroke","mid-stroke","no-fill"],[1,"captured",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),ga(1,"rect",1),la(2,A4,2,1,"g",2),la(3,M4,1,2,"rect",3),la(4,N4,1,3,"circle",4),fa()),2&e&&(ra("viewBox","0 -3 "+50*t.board.length+" "+(6+50*t.board.length)),Ts(1),ra("width",50*t.board.length)("height",50*t.board.length),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.ko.isPresent()),Ts(1),ha("ngForOf",t.captures))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class x4{constructor(e,t,n){this.value=e,this.name=t,this.rgb=n}static of(e){switch(e){case 0:return x4.ANY;case 1:return x4.ORANGE;case 2:return x4.BLUE;case 3:return x4.PURPLE;case 4:return x4.PINK;case 5:return x4.YELLOW;case 6:return x4.RED;case 7:return x4.GREEN;default:return Ow.expectToBe(e,8,"Invalid value "+e+" for KamisadoColor"),x4.BROWN}}}x4.ANY=new x4(0,"any","#000"),x4.ORANGE=new x4(1,"orange","#d67421"),x4.BLUE=new x4(2,"blue","#006bac"),x4.PURPLE=new x4(3,"purple","#6f3787"),x4.PINK=new x4(4,"pink","#d2719e"),x4.YELLOW=new x4(5,"yellow","#e2c200"),x4.RED=new x4(6,"red","#d23339"),x4.GREEN=new x4(7,"green","#009157"),x4.BROWN=new x4(8,"brown","#562500");class D4{constructor(e,t){this.player=e,this.color=t}static of(e,t){return new D4(e,x4.of(t))}static createPlayerColors(e){return{ORANGE:new D4(e,x4.ORANGE),BLUE:new D4(e,x4.BLUE),PURPLE:new D4(e,x4.PURPLE),PINK:new D4(e,x4.PINK),YELLOW:new D4(e,x4.YELLOW),RED:new D4(e,x4.RED),GREEN:new D4(e,x4.GREEN),BROWN:new D4(e,x4.BROWN)}}equals(e){return e.player===this.player&&e.color===this.color}isEmpty(){return this.player.equals(VK.NONE)}belongsTo(e){return this.player===e}}D4.EMPTY=new D4(VK.NONE,x4.ANY),D4.ZERO=D4.createPlayerColors(BK.ZERO),D4.ONE=D4.createPlayerColors(BK.ONE);class L4{static getColorAt(e,t){return L4.COLORS[t][e]}static getInitialBoard(){const e=D4.EMPTY;return[[1,2,3,4,5,6,7,8].map(e=>D4.of(BK.ONE,e)),[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e],[8,7,6,5,4,3,2,1].map(e=>D4.of(BK.ZERO,e))]}static isEmptyAt(e,t){return e[t.y][t.x].equals(D4.EMPTY)}static allPieceCoords(e){const t=[];for(let n=0;n<e.length;n++)for(let r=0;r<e[n].length;r++){const i=new JX(r,n);L4.isEmptyAt(e,i)||t.push(i)}return t}}L4.INITIAL=L4.getInitialBoard(),L4.SIZE=8,L4.COLORS=GK.mapBiArray([[1,2,3,4,5,6,7,8],[6,1,4,7,2,5,8,3],[7,4,1,6,3,8,5,2],[4,3,2,1,8,7,6,5],[5,6,7,8,1,2,3,4],[2,5,8,3,6,1,4,7],[3,8,5,2,7,4,1,6],[8,7,6,5,4,3,2,1]],x4.of);class F4 extends C1{constructor(e,t){super(e,t)}static of(e,t){if(e.isNotInRange(L4.SIZE,L4.SIZE))throw new Error("Starting coord of KamisadoMove must be on the board, not at "+e.toString());if(t.isNotInRange(L4.SIZE,L4.SIZE))throw new Error("End coord of KamisadoMove must be on the board, not at "+t.toString());return new F4(e,t)}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return this===F4.PASS?"KamisadoMove(PASS)":"KamisadoMove("+this.coord+"->"+this.end+")"}}F4.PASS=new F4(new JX(-2,-2),new JX(-3,-3)),F4.encoder=new class extends FK{maxValue(){return 34952}encodeNumber(e){return 4096*e.coord.x+256*e.coord.y+16*e.end.x+e.end.y}decodeNumber(e){if(e<0)return F4.PASS;const t=e%16,n=(e=e/16|0)%16,r=(e=e/16|0)%16;return new F4(new JX((e=e/16|0)%16,r),new JX(n,t))}};class U4 extends fJ{constructor(e,t,n,r,i){super(GK.copyBiArray(i),e),this.colorToPlay=t,this.coordToPlay=n,this.alreadyPassed=r}static getInitialState(){return new U4(0,x4.ANY,Mw.empty(),!1,L4.INITIAL)}}let B4=(()=>{class e{}return e.NOT_RIGHT_COLOR=()=>$localize`This piece is not of the color you have to play.`,e.DIRECTION_NOT_ALLOWED=()=>$localize`You can only move forward, orthogonally or diagonally.`,e.MOVE_BLOCKED=()=>$localize`This move is blocked by another piece.`,e.PLAY_WITH_SELECTED_PIECE=()=>$localize`You must play with the selected piece.`,e})();class V4 extends PJ{static getColorMatchingPiece(e){return e.coordToPlay.isPresent()?[e.coordToPlay.get()]:[new JX(0,7),new JX(1,7),new JX(2,7),new JX(3,7),new JX(4,7),new JX(5,7),new JX(6,7),new JX(7,7)]}static getMovablePieces(e){return V4.getColorMatchingPiece(e).filter(t=>{for(const n of this.playerDirections(e.getCurrentPlayer())){const r=t.getNext(n);if(e.isOnBoard(r)&&L4.isEmptyAt(e.board,r))return!0}return!1})}static playerDirections(e){return e===BK.ONE?[KX.DOWN,KX.DOWN_LEFT,KX.DOWN_RIGHT]:[KX.UP,KX.UP_LEFT,KX.UP_RIGHT]}static directionAllowedForPlayer(e,t){return t===BK.ZERO?e.y<0:e.y>0}static getListMovesFromState(e){const t=V4.getMovablePieces(e);return 0===t.length?(NW(!1===e.alreadyPassed,"getListMovesFromState should not be called once game is ended."),[F4.PASS]):V4.getListMovesFromNonBlockedState(e,t)}static getListMovesFromNonBlockedState(e,t){const n=[],r=e.getCurrentPlayer();for(const i of t)for(const t of V4.playerDirections(r))for(let r=1;r<L4.SIZE;r++){const s=i.getNext(t,r);if(!e.isOnBoard(s)||!L4.isEmptyAt(e.board,s))break;{const e=F4.of(i,s);n.push(e)}}return n}static mustPass(e){return 0===this.getMovablePieces(e).length}static getFurthestPiecePositions(e){let t=7,n=0;return L4.allPieceCoords(e.board).forEach(r=>{const i=e.getPieceAt(r);NW(i!==D4.EMPTY,"allPieceCoords failed to filter KamisadoPiece.EMPTY"),i.player===BK.ONE?n=Math.max(n,r.y):t=Math.min(t,r.y)}),[t,n]}static isLegal(e,t){const n=e.coord,r=e.end,i=t.colorToPlay;if(e===F4.PASS)return this.isLegalPass(t);if(V4.isVictory(t))return SW.failure("You should never see this message");const s=t.getPieceAt(n);if(!s.belongsTo(t.getCurrentPlayer()))return SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE());if(i!==x4.ANY&&s.color!==i)return SW.failure(B4.NOT_RIGHT_COLOR());if(!t.getPieceAt(r).isEmpty())return SW.failure(lJ.MUST_CLICK_ON_EMPTY_SPACE());const o=KX.factory.fromMove(n,r);if(o.isFailure())return SW.failure(B4.DIRECTION_NOT_ALLOWED());const a=o.get();if(!V4.directionAllowedForPlayer(a,t.getCurrentPlayer()))return SW.failure(B4.DIRECTION_NOT_ALLOWED());let l=n;for(;!l.equals(r);)if(l=l.getNext(a),!t.getPieceAt(l).isEmpty())return SW.failure(B4.MOVE_BLOCKED());return SW.success(void 0)}static isLegalPass(e){return this.mustPass(e)&&!e.alreadyPassed?SW.success(void 0):SW.failure(lJ.CANNOT_PASS())}static isVictory(e){const[t,n]=this.getFurthestPiecePositions(e);return 0===t||7===n}nextCoordToPlay(e,t){return Mw.ofNullable(L4.allPieceCoords(e.board).find(n=>{const r=e.getPieceAt(n);return r.player===e.getCurrentOpponent()&&r.color===t}))}applyLegalMove(e,t,n){if(e===F4.PASS){const e=this.nextCoordToPlay(t,t.colorToPlay);return new U4(t.turn+1,t.colorToPlay,e,!0,t.board)}const r=e.coord,i=e.end,s=t.getCopiedBoard();s[i.y][i.x]=s[r.y][r.x],s[r.y][r.x]=D4.EMPTY;const o=L4.getColorAt(i.x,i.y),a=this.nextCoordToPlay(t,o);return new U4(t.turn+1,o,a,!1,s)}isLegal(e,t){return V4.isLegal(e,t)}getGameStatus(e){const t=e.gameState,n=t.getCurrentPlayer();if(V4.mustPass(t)&&t.alreadyPassed)return SJ.getDefeat(n);const[r,i]=V4.getFurthestPiecePositions(t);return 7===i?SJ.ONE_WON:0===r?SJ.ZERO_WON:SJ.ONGOING}}class $4 extends cJ{getListMoves(e){const t=V4.getListMovesFromState(e.gameState);return GK.sortByDescending(t,e=>e.length()),t}getBoardValue(e){const t=e.gameState,n=t.getCurrentPlayer();if(V4.mustPass(t)&&t.alreadyPassed)return new uJ(n.getDefeatValue());const[r,i]=V4.getFurthestPiecePositions(t);return new uJ(7===i?BK.ONE.getVictoryValue():0===r?BK.ZERO.getVictoryValue():i-(7-r))}}const z4=D4.EMPTY,H4=D4.ZERO.ORANGE,G4=D4.ONE.ORANGE,W4=D4.ZERO.BLUE,q4=D4.ONE.BLUE,j4=D4.ZERO.PURPLE,Z4=D4.ONE.PURPLE,Y4=D4.ZERO.PINK,K4=D4.ONE.PINK,Q4=D4.ZERO.YELLOW,X4=D4.ONE.YELLOW,J4=D4.ZERO.RED,e5=D4.ONE.RED,t5=D4.ZERO.GREEN,n5=D4.ONE.GREEN,r5=D4.ZERO.BROWN,i5=D4.ONE.BROWN;class s5{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`At Kamisado, there are two ways to win the game:
        either by moving one of your pieces on the opponent's starting line,
        or by forcing the opponent to make a move that blocks the entire game.
        Here, Dark wins because its brown piece is on Light's starting line, on the top left.`,new U4(5,x4.ORANGE,Mw.empty(),!1,[[r5,q4,Z4,K4,X4,e5,n5,i5],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,G4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,t5,J4,Q4,Y4,j4,W4,H4]])).withPreviousMove(F4.of(new JX(0,7),new JX(0,0))),kJ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
        At Kamisado, pieces can only move forward, vertically or diagonally.
        You're playing first, with dark pieces, you can make your first move.<br/><br/>
        Click on the piece of your choice and click on the landing square.`,U4.getInitialState(),F4.of(new JX(7,7),new JX(3,3)),$localize`Perfect! Note that each of your piece has a different color.`),kJ.fromMove($localize`Moving`,$localize`Let us now consider the move of Light, after the blue piece has been moved by Dark.
        All moves after the initial move must be made from the piece that corresponds to the color
        of the square upon which the last move ended.
        Here, the last move ended on the pink square, hence the pink piece must move.
        It is already selected, you do not have to click on it.<br/><br/>
        Move it on a blue square.`,new U4(1,x4.PINK,Mw.of(new JX(3,0)),!1,[[G4,q4,Z4,K4,X4,e5,n5,i5],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,W4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[r5,t5,J4,Q4,Y4,j4,z4,H4]]),[F4.of(new JX(3,0),new JX(3,6)),F4.of(new JX(3,0),new JX(4,1))],$localize`Congratulations!`,$localize`You have not moved your pink piece on a blue square!`).withPreviousMove(F4.of(new JX(6,7),new JX(6,5))),kJ.informational($localize`Stuck situation`,$localize`Dark moved to another pink square, hence you have to move your pink piece again.
        However, your pink piece is stuck! In this case, you must pass your turn.
        Dark will now have to play by moving its pink piece.`,new U4(1,x4.PINK,Mw.of(new JX(3,6)),!1,[[G4,q4,Z4,z4,X4,e5,n5,i5],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,z4,W4],[z4,z4,z4,z4,z4,z4,z4,z4],[z4,z4,z4,K4,z4,z4,z4,z4],[r5,t5,J4,Q4,Y4,j4,z4,H4]])).withPreviousMove(F4.of(new JX(6,5),new JX(7,4))),kJ.fromMove($localize`Victory by blocking`,$localize`At any time, if a player blocks the entire game, that player loses.
        In other words, if a player forces its opponent to move a piece that the opponent cannot move,
        and the player cannot move its own piece of the same color, then that player loses.
        Here, you're playing Dark and you can force your opponent to create such a situation, hence you can force your opponent to lose!<br/><br/>
        Try to make this move.`,new U4(2,x4.RED,Mw.of(new JX(2,4)),!1,[[z4,q4,Z4,z4,z4,e5,z4,z4],[z4,z4,z4,X4,z4,z4,z4,z4],[z4,z4,z4,K4,z4,Z4,z4,z4],[z4,z4,z4,Q4,z4,z4,z4,z4],[z4,z4,J4,z4,z4,z4,z4,z4],[z4,z4,z4,z4,z4,z4,n5,z4],[G4,z4,z4,z4,z4,Y4,z4,i5],[r5,t5,z4,z4,z4,z4,W4,H4]]),[F4.of(new JX(2,4),new JX(0,2))],$localize`Perfect!
         Your opponent must move its green piece on the orange square, forcing you to play with your orange piece.
         Your orange piece will be stuck and you will have to pass your turn.
         Your opponent will have to pass its turn too because its orange piece is also stuck: the game is completely stuck.
         In this case, the last player to have moved a piece loses.
         Here, your opponent will have moved its green piece last, you therefore win!`,$localize`Failed!`).withPreviousMove(F4.of(new JX(4,0),new JX(3,1)))]}}function o5(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();ra("cx",i.SPACE_SIZE/2+t*i.SPACE_SIZE)("cy",i.SPACE_SIZE/2+r*i.SPACE_SIZE)("fill",i.pieceColor(n))("r",i.SPACE_SIZE/2-i.STROKE_WIDTH)}}function a5(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=Sa(),t=e.$implicit,n=e.index,r=Sa().index,i=Sa();ha("ngClass",i.piecePlayerClass(t)),ra("x",i.SPACE_SIZE/2+n*i.SPACE_SIZE-i.SPACE_SIZE/8)("y",i.SPACE_SIZE/2+r*i.SPACE_SIZE-i.SPACE_SIZE/8)("rx",i.isPlayerZero(t)?i.SPACE_SIZE:0)("ry",i.isPlayerZero(t)?i.SPACE_SIZE:0)("width",i.SPACE_SIZE/4)("height",i.SPACE_SIZE/4)}}function l5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",4),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),ga(2,"rect",5),la(3,o5,1,4,"circle",6),la(4,a5,1,7,"rect",7),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE)("fill",i.backgroundColor(n,r)),Ts(1),ha("ngIf",e!==i.UNOCCUPIED),Ts(1),ha("ngIf",e!==i.UNOCCUPIED)}}function c5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,l5,5,9,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function u5(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"rect",10),ga(2,"rect",10),fa()),2&e){const e=Sa();Ts(1),ra("x",e.lastMove.get().coord.x*e.SPACE_SIZE)("y",e.lastMove.get().coord.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE),Ts(1),ra("x",e.lastMove.get().end.x*e.SPACE_SIZE)("y",e.lastMove.get().end.y*e.SPACE_SIZE)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function h5(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa();ra("cx",e.SPACE_SIZE/2+e.chosen.get().x*e.SPACE_SIZE)("cy",e.SPACE_SIZE/2+e.chosen.get().y*e.SPACE_SIZE)}}let d5=(()=>{class e extends u1{constructor(e){super(e),this.UNOCCUPIED=D4.EMPTY,this.lastMove=Mw.empty(),this.chosen=Mw.empty(),this.chosenAutomatically=!1,this.rules=new V4(U4),this.availableMinimaxes=[new $4(this.rules,"KamisadoMinimax")],this.encoder=F4.encoder,this.tutorial=(new s5).tutorial,this.canPass=!1,this.updateBoard()}backgroundColor(e,t){return L4.getColorAt(e,t).rgb}isPlayerZero(e){return e.player===BK.ZERO}pieceColor(e){return e.color.rgb}piecePlayerClass(e){return this.getPlayerClass(e.player)}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.lastMove=this.rules.node.move,this.canPass=V4.mustPass(e),this.canPass||e.coordToPlay.isAbsent()?(this.chosenAutomatically=!1,this.chosen=Mw.empty()):(this.chosenAutomatically=!0,this.chosen=e.coordToPlay)}pass(){var e=this;return Pw(function*(){return NW(e.canPass,"KamisadoComponent: pass() must be called only if canPass is true"),e.chooseMove(F4.PASS,e.rules.node.gameState)})()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new JX(e,t);if(n.canPass)return n.cancelMove(lJ.MUST_PASS());if(n.chosen.isAbsent())return n.choosePiece(e,t);if(!1===n.chosenAutomatically&&n.chosen.equalsValue(i))return n.cancelMoveAttempt(),TW.SUCCESS;{const r=n.rules.node.gameState.getPieceAtXY(e,t),s=n.rules.node.gameState.getCurrentPlayer();return r.belongsTo(s)?n.chosenAutomatically?n.cancelMove(B4.PLAY_WITH_SELECTED_PIECE()):(n.chosen=Mw.of(i),TW.SUCCESS):yield n.chooseDestination(e,t)}})()}choosePiece(e,t){const n=this.rules.node.gameState.getPieceAtXY(e,t),r=this.rules.node.gameState.getCurrentOpponent();return n.belongsTo(r)?this.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosen=Mw.of(new JX(e,t)),TW.SUCCESS)}chooseDestination(e,t){var n=this;return Pw(function*(){const r=n.chosen.get(),i=new JX(e,t),s=F4.of(r,i);return n.chooseMove(s,n.rules.node.gameState)})()}cancelMoveAttempt(){this.chosenAutomatically||(this.chosen=Mw.empty())}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-kamisado"]],features:[Go],decls:4,vars:4,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","30","class","base mid-stroke no-fill highlighted",4,"ngIf"],[3,"id","click"],["fill-opacity","0.7",1,"base-no-fill"],["class","base-no-fill",4,"ngIf"],["class","no-stroke",3,"ngClass",4,"ngIf"],[1,"base-no-fill"],[1,"no-stroke",3,"ngClass"],[1,"base","no-fill","mid-stroke","highlighted"],["r","30",1,"base","mid-stroke","no-fill","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,c5,2,1,"g",1),la(2,u5,3,8,"g",2),la(3,h5,1,2,"circle",3),fa()),2&e&&(ra("viewBox","-4 -4 "+8*t.SPACE_SIZE+" "+(8+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMove.isPresent()),Ts(1),ha("ngIf",t.chosen.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),p5=(()=>{class e extends fJ{static getInitialState(){const t=VK.NONE,n=BK.ZERO,r=BK.ONE;return new e([[t,n,n,n,n,n,n,t],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[r,t,t,t,t,t,t,r],[t,n,n,n,n,n,n,t]],0)}static isOnBoard(t){return t.isInRange(e.SIZE,e.SIZE)}}return e.SIZE=8,e})();class f5 extends C1{constructor(e,t,n){super(e,t),this.direction=n,this.direction=KX.factory.fromMove(e,t).get()}static of(e,t){const n=KX.factory.fromMove(e,t);return n.isFailure()?SW.failure(n.getReason()):e.isNotInRange(p5.SIZE,p5.SIZE)?SW.failure("start coord is not in range"):t.isNotInRange(p5.SIZE,p5.SIZE)?SW.failure("end coord is not in range"):SW.success(new f5(e,t,n.get()))}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"LinesOfActionMove("+this.coord+"->"+this.end+")"}encode(){return f5.encoder.encode(this)}decode(e){return f5.encoder.decode(e)}}f5.encoder=C1.getEncoder(p5.SIZE,p5.SIZE,(e,t)=>f5.of(e,t).get());let g5=(()=>{class e{}return e.INVALID_MOVE_LENGTH=()=>$localize`Your move should have a length equal to the number of pieces that exist on the same line.`,e.CANNOT_JUMP_OVER_OPPONENT=()=>$localize`You cannot jump over the opponent's pieces.`,e.PIECE_CANNOT_MOVE=()=>$localize`This piece has no possible move, select another one.`,e.INVALID_DIRECTION=()=>$localize`A move must be orthogonal or diagonal.`,e})();class m5 extends PJ{static getListMovesFromState(e){const t=[];if(m5.getVictory(e).isPresent())return t;for(let n=0;n<p5.SIZE;n++)for(let r=0;r<p5.SIZE;r++){const i=new JX(r,n);if(e.getPieceAt(i).isPlayer())for(const n of m5.possibleTargets(e,i)){const e=f5.of(i,n).get();t.push(e)}}return t}static getNumberOfGroups(e){const t=GK.createTable(p5.SIZE,p5.SIZE,-1),n=[0,0];let r=0;for(let i=0;i<p5.SIZE;i++)for(let s=0;s<p5.SIZE;s++)if(-1===t[i][s]){const o=e.getPieceAt(new JX(s,i));o.isPlayer()&&(r+=1,m5.markGroupStartingAt(e,t,new JX(s,i),r),n[o.value]+=1)}return n}static markGroupStartingAt(e,t,n,r){const i=[n],s=e.getPieceAt(n);for(;i.length>0;){const n=Ow.getNonNullable(i.pop());if(-1===t[n.y][n.x]){const o=e.getPieceAt(n);if(o===s){t[n.y][n.x]=r;for(const t of KX.DIRECTIONS){const r=n.getNext(t);e.isOnBoard(r)&&i.push(r)}}else o===VK.NONE&&(t[n.y][n.x]=0)}}}applyLegalMove(e,t,n){const r=t.getCopiedBoard();return r[e.coord.y][e.coord.x]=VK.NONE,r[e.end.y][e.end.x]=t.getCurrentPlayer(),new p5(r,t.turn+1)}static isLegal(e,t){return t.getPieceAt(e.coord)!==t.getCurrentPlayer()?SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE()):e.length()!==this.numberOfPiecesOnLine(t,e.coord,e.direction)?SW.failure(g5.INVALID_MOVE_LENGTH()):e.coord.getCoordsToward(e.end).some(e=>t.getPieceAt(e)===t.getCurrentOpponent())?SW.failure(g5.CANNOT_JUMP_OVER_OPPONENT()):t.getPieceAt(e.end)===t.getCurrentPlayer()?SW.failure(lJ.CANNOT_SELF_CAPTURE()):SW.success(void 0)}isLegal(e,t){return m5.isLegal(e,t)}static numberOfPiecesOnLine(e,t,n){let r=0;for(const i of m5.getLineCoords(t,n))e.getPieceAt(i).isPlayer()&&(r+=1);return r}static getLineCoords(e,t){const n=m5.getEntranceAndForwardDirection(e,t);let r=n[0];const i=n[1],s=[];for(;p5.isOnBoard(r);)s.push(r),r=r.getNext(i);return s}static getEntranceAndForwardDirection(e,t){switch(t){case KX.UP:case KX.DOWN:return[new JX(e.x,0),KX.DOWN];case KX.LEFT:case KX.RIGHT:return[new JX(0,e.y),KX.RIGHT];case KX.UP_RIGHT:case KX.DOWN_LEFT:return[new JX(Math.max(0,e.x+e.y-7),Math.min(7,e.x+e.y)),KX.UP_RIGHT];default:return Ow.expectToBeMultiple(t,[KX.UP_LEFT,KX.DOWN_RIGHT]),[new JX(e.x-Math.min(e.x,e.y),e.y-Math.min(e.x,e.y)),KX.DOWN_RIGHT]}}static getVictory(e){const[t,n]=m5.getNumberOfGroups(e);return 1===t&&1===n?Mw.of(VK.NONE):1===t?Mw.of(BK.ZERO):1===n?Mw.of(BK.ONE):Mw.empty()}static possibleTargets(e,t){const n=[];for(const r of KX.DIRECTIONS){const i=m5.numberOfPiecesOnLine(e,t,r),s=t.getNext(r,i);if(e.isOnBoard(s)){const r=f5.of(t,s).get();m5.isLegal(r,e).isSuccess()&&n.push(s)}}return n}getGameStatus(e){const t=e.gameState,[n,r]=m5.getNumberOfGroups(t);return 1===n&&r>1?SJ.ZERO_WON:n>1&&1===r?SJ.ONE_WON:SJ.ONGOING}}class y5 extends cJ{getListMoves(e){return m5.getListMovesFromState(e.gameState)}getBoardValue(e){const t=e.gameState,[n,r]=m5.getNumberOfGroups(t);return new uJ(1===n&&r>1?BK.ZERO.getVictoryValue():n>1&&1===r?BK.ONE.getVictoryValue():100/n*BK.ZERO.getScoreModifier()+100/r*BK.ONE.getScoreModifier())}}const v5=VK.NONE,_5=BK.ZERO,C5=BK.ONE;class E5{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`At Lines of Actions, the goal is to group your pieces contiguously, orthogonally and/or diagonally.
        Here, Dark wins the game:
        Dark's pieces are forming a single group, while Light's pieces form three groups.`,new p5([[v5,v5,v5,v5,v5,v5,v5,v5],[C5,v5,v5,v5,_5,v5,v5,C5],[v5,v5,_5,_5,C5,v5,v5,v5],[v5,v5,v5,_5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5]],0)),kJ.anyMove($localize`Initial board and initial move`,$localize`Here is the initial board.
         Moves can be made orthogonally or diagonally.
         The length of a move is equal to the number of pieces that are on the line of the move.
         Note that there is a helping indicator to let you know where a piece can land when you select it.<br/><br/>
         You're playing Dark, make the first move!`,p5.getInitialState(),f5.of(new JX(1,7),new JX(1,5)).get(),$localize`Congratulations!`),kJ.fromMove($localize`Jumping`,$localize`During a move, it is possible to jump above your own pieces.
        But it is forbidden to jump over the opponent's pieces.<br/><br/>
        You're playing Dark, make a jump over one of your pieces on the following board.`,new p5([[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,C5,_5,_5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,v5,v5,_5]],0),[f5.of(new JX(3,1),new JX(6,1)).get()],$localize`Congratulations!`,$localize`Failed. You did not jump over one of your pieces.`),kJ.fromMove($localize`Moving`,$localize`Here is a different board. Pick the dark piece in the middle (line 4, column 4)
        and observe its possible moves.
        Horizontally, this piece can move only of one square because it is the only piece on this line.
        Vertically, this piece can move of three squares because there are in total three pieces on that vertical line.
        But it can only go up, as below it the landing square is occupied by one of your pieces.
        Diagonally, only one move is possible: on the diagonal that contains three pieces,
        only in the direction where it does not jump over one of the opponent's pieces.
        On the other diagonal, there are too many pieces to end the move on the board.<br/><br/>
        Make one of these moves.`,new p5([[v5,v5,v5,v5,v5,v5,C5,v5],[v5,v5,v5,v5,v5,_5,v5,v5],[v5,v5,v5,v5,C5,v5,v5,v5],[v5,v5,v5,_5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,C5,v5,C5],[v5,v5,v5,_5,v5,v5,C5,C5],[v5,v5,v5,_5,v5,v5,v5,v5]],0),[f5.of(new JX(3,3),new JX(3,0)).get(),f5.of(new JX(3,3),new JX(0,0)).get(),f5.of(new JX(3,3),new JX(2,3)).get(),f5.of(new JX(3,3),new JX(4,3)).get()],$localize`Congratulations!`,$localize`Failed. This was not one of the expected moves.`),kJ.fromMove($localize`Capturing`,$localize`If a move ends on an opponent's pieces, this one is captured and removed from the board.
        However, a move cannot end on one of the player's pieces.
        Watch out, having less pieces at Lines of Action makes a victory easier, as there are less pieces to regroup!
        If a player has only one piece, that player wins the game.<br/><br/>
        On the following board, try to capture one piece with Dark.`,new p5([[v5,_5,v5,_5,_5,_5,_5,v5],[C5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,_5,v5,C5,v5,v5,v5],[C5,v5,v5,v5,v5,v5,v5,C5],[C5,v5,v5,v5,v5,v5,v5,C5],[C5,v5,v5,v5,v5,v5,v5,C5],[C5,v5,v5,v5,v5,v5,v5,C5],[v5,_5,_5,_5,_5,_5,_5,v5]],0),[f5.of(new JX(2,2),new JX(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`),kJ.fromMove($localize`Tie`,$localize`In the special case where a move ends up connecting all pieces of both player, simultaneously,
        then the game ends up with a tie.<br/><br/>
        You're playing Dark, force the tie in one move.`,new p5([[v5,v5,v5,v5,v5,v5,v5,v5],[v5,v5,v5,v5,v5,v5,v5,v5],[_5,v5,v5,_5,C5,_5,v5,v5],[v5,v5,v5,_5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,v5,v5,C5],[v5,v5,v5,v5,v5,v5,v5,v5]],0),[f5.of(new JX(0,2),new JX(4,2)).get()],$localize`Congratulations!`,$localize`Failed!`)]}}function w5(e,t){if(1&e&&(Cn(),ga(0,"circle",3)),2&e){const e=Sa().index,t=Sa().index,n=Sa();ha("ngClass",n.getPieceClasses(e,t)),ra("cx",n.SPACE_SIZE/2+e*n.SPACE_SIZE)("cy",n.SPACE_SIZE/2+t*n.SPACE_SIZE)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function b5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",2),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),ga(2,"rect",3),la(3,w5,1,4,"circle",4),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","click_",n,"_",r,""),Ts(1),ha("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function S5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,b5,4,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function P5(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",5),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),ra("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}let O5=(()=>{class e extends u1{constructor(e){super(e),this.INDICATOR_SIZE=20,this.EMPTY=VK.NONE,this.targets=[],this.selected=Mw.empty(),this.lastMove=Mw.empty(),this.captured=Mw.empty(),this.rules=new m5(p5),this.availableMinimaxes=[new y5(this.rules,"LinesOfActionMinimax")],this.encoder=f5.encoder,this.tutorial=(new E5).tutorial,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new JX(e,t);if(n.selected.isPresent()){if(n.getState().getPieceAt(i)===n.getState().getCurrentPlayer())return n.select(i);{const r=f5.of(n.selected.get(),new JX(e,t));return r.isSuccess()?n.chooseMove(r.get(),n.rules.node.gameState):n.cancelMove(g5.INVALID_DIRECTION())}}return n.select(i)})()}select(e){var t=this;return Pw(function*(){return t.getState().getPieceAt(e)!==t.getState().getCurrentPlayer()?t.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE()):(t.selected=Mw.of(e),t.targets=m5.possibleTargets(t.rules.node.gameState,t.selected.get()),0===t.targets.length?t.cancelMove(g5.PIECE_CANNOT_MOVE()):TW.SUCCESS)})()}getState(){return this.rules.node.gameState}getPreviousState(){return this.rules.node.mother.get().gameState}updateBoard(){if(this.cancelMoveAttempt(),this.board=this.getState().board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.lastMove.get();this.captured=this.getPreviousState().getPieceAt(e.end).isPlayer()?Mw.of(e.end):Mw.empty()}}cancelMoveAttempt(){this.selected=Mw.empty(),this.targets=[]}getSquareClasses(e,t){const n=new JX(e,t);if(this.lastMove.isPresent()){const e=this.lastMove.get().coord,t=this.lastMove.get().end;if(this.captured.isPresent()&&n.equals(this.captured.get()))return["captured"];if(n.equals(e)||n.equals(t))return["moved"]}return[]}getPieceClasses(e,t){const n=this.board[t][e],r=new JX(e,t),i=[this.getPlayerClass(n)];return this.selected.isPresent()&&this.selected.get().equals(r)&&i.push("selected"),i}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-linesofaction"]],features:[Go],decls:3,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 808","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"ngClass",4,"ngIf"],[1,"indicator",3,"click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,S5,2,1,"g",1),la(2,P5,2,4,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.targets))},directives:[tp,Jd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class T5 extends yJ{constructor(e,t,n,r={top:0,bottom:0,left:0,right:0}){super(e.x,e.y),this.direction=t,this.orientation=n,this.captures=r}toString(){return`LodestoneMove(${this.coord.toString()}, ${this.direction}, ${this.orientation}, { top: ${this.captures.top}, bottom: ${this.captures.bottom}, left: ${this.captures.left}, right: ${this.captures.right} })`}equals(e){return this===e||!(!1===this.coord.equals(e.coord)||this.orientation!==e.orientation||this.direction!==e.direction||this.captures.top!==e.captures.top||this.captures.bottom!==e.captures.bottom||this.captures.left!==e.captures.left||this.captures.right!==e.captures.right)}}T5.encoder=new class extends LK{encodeMove(e){return{coord:JX.encoder.encode(e.coord),direction:e.direction,orientation:e.orientation,captures:e.captures}}decodeMove(e){const t=e;return NW(null!=t.coord,"Invalid encoded LodestoneMove"),NW(null!=t.direction,"Invalid encoded LodestoneMove"),NW(null!=t.orientation,"Invalid encoded LodestoneMove"),NW(null!=t.captures,"Invalid encoded LodestoneMove"),new T5(JX.encoder.decode(t.coord),t.direction,t.orientation,t.captures)}};let I5=(()=>{class e{}return e.MUST_FLIP_LODESTONE=()=>$localize`You must flip your lodestone before putting it back on the board.`,e.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES=()=>$localize`As long as there are pressure plates, you must place all the pieces that you have captured on them.`,e.TARGET_IS_CRUMBLED=()=>$localize`You must place your lodestone on a non-crumbled square!`,e.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE=()=>$localize`You placed too many captures on the same pressure plate, which has not enough space left.`,e.MUST_PLACE_CAPTURES=()=>$localize`You must place your captures on the pressure plates, on the side of the board.`,e.NO_CAPTURES_TO_PLACE_YET=()=>$localize`You cannot place any capture now, you must first place your lodestone on the board!`,e})();class k5{constructor(e){this.unreachable=e}isLodestone(){return!1}isPlayerPiece(){return!1}isEmpty(){return!0}isUnreachable(){return this.unreachable}equals(e){return this===e}}k5.UNREACHABLE=new k5(!0),k5.EMPTY=new k5(!1);class A5{constructor(e){this.owner=e}static of(e){return e===BK.ZERO?A5.ZERO:A5.ONE}isLodestone(){return!1}isPlayerPiece(){return!0}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}A5.ZERO=new A5(BK.ZERO),A5.ONE=new A5(BK.ONE);class M5{constructor(e,t,n){this.owner=e,this.direction=t,this.orientation=n}static of(e,t){return M5.LODESTONES[e.value][t.direction][t.orientation]}isLodestone(){return!0}isPlayerPiece(){return!1}isEmpty(){return!1}isUnreachable(){return!1}equals(e){return this===e}}M5.LODESTONES={0:{push:{diagonal:new M5(BK.ZERO,"push","diagonal"),orthogonal:new M5(BK.ZERO,"push","orthogonal")},pull:{diagonal:new M5(BK.ZERO,"pull","diagonal"),orthogonal:new M5(BK.ZERO,"pull","orthogonal")}},1:{push:{diagonal:new M5(BK.ONE,"push","diagonal"),orthogonal:new M5(BK.ONE,"push","orthogonal")},pull:{diagonal:new M5(BK.ONE,"pull","diagonal"),orthogonal:new M5(BK.ONE,"pull","orthogonal")}}};class N5{constructor(e,t){this.width=e,this.pieces=t}remainingSpaces(){return 5===this.width?8-this.pieces.length:3-this.pieces.length}addCaptured(e,t){if(this.pieces.length+t>=this.width)return 5===this.width?N5.EMPTY_3.addCaptured(e,t+this.pieces.length-5):(NW(this.pieces.length+t===3,"should never put more pieces than the plate can support"),Mw.empty());{const n=GK.copyImmutableArray(this.pieces);for(let r=0;r<t;r++)n.push(A5.of(e));return Mw.of(new N5(this.width,n))}}getPieceAt(e){return e<this.pieces.length?this.pieces[e]:k5.EMPTY}}N5.POSITIONS=["top","bottom","left","right"],N5.EMPTY_5=new N5(5,[]),N5.EMPTY_3=new N5(3,[]);let R5=(()=>{class e extends fJ{constructor(e,t,n,r){super(e,t),this.lodestones=n,this.pressurePlates=r}static getInitialState(){const t=k5.EMPTY,n=A5.ZERO,r=A5.ONE;return new e([[t,t,n,r,n,r,t,t],[t,n,r,n,r,n,r,t],[n,r,n,r,n,r,n,r],[r,n,r,t,t,n,r,n],[n,r,n,t,t,r,n,r],[r,n,r,n,r,n,r,n],[t,r,n,r,n,r,n,t],[t,t,r,n,r,n,t,t]],0,new CJ,{top:Mw.of(N5.EMPTY_5),bottom:Mw.of(N5.EMPTY_5),left:Mw.of(N5.EMPTY_5),right:Mw.of(N5.EMPTY_5)})}withBoard(t){return new e(t,this.turn,this.lodestones,this.pressurePlates)}remainingSpaces(){const e=this.remainingSpacesDetails();return e.top+e.bottom+e.left+e.right}remainingSpacesDetails(){const e={top:0,bottom:0,left:0,right:0};for(const t of N5.POSITIONS){const n=this.pressurePlates[t];n.isPresent()&&(e[t]=n.get().remainingSpaces())}return e}numberOfPieces(){const t=[0,0];for(let n=0;n<e.SIZE;n++)for(let r=0;r<e.SIZE;r++){const e=this.getPieceAtXY(r,n);e.isPlayerPiece()&&(t[e.owner.value]+=1)}return t}getScores(){const e=this.numberOfPieces();return[24-e[1],24-e[0]]}nextLodestoneDirection(){const e=this.getCurrentPlayer(),t=this.lodestones.get(e);if(!t.isPresent())return Mw.empty();{const e=this.getPieceAt(t.get());switch(NW(e.isLodestone(),"Piece must be lodestone (invariant from LodestoneState)"+t.get()),e.direction){case"push":return Mw.of("pull");case"pull":return Mw.of("push")}}}}return e.SIZE=8,e})();class x5 extends PJ{constructor(){super(R5)}static get(){return x5.singleton.isAbsent()&&(x5.singleton=Mw.of(new x5)),x5.singleton.get()}applyLegalMove(e,t,n){const r=t.getCurrentPlayer(),i=r.getOpponent(),s=GK.copyBiArray(n.board),o=t.lodestones.getCopy();o.put(r,e.coord);const a={...t.pressurePlates};return this.updatePressurePlates(s,a,o,i,e.captures),new R5(s,t.turn+1,o,a)}updatePressurePlates(e,t,n,r,i){for(const s of N5.POSITIONS)t[s]=this.updatePressurePlate(e,s,t[s],n,r,i[s])}updatePressurePlate(e,t,n,r,i,s){if(n.isPresent()){const o=n.get().addCaptured(i,s),a=x5.THREATENED_COORD_RANGE.get(t).get();return o.isAbsent()?(this.removePressurePlate(e,a.startForBigPlate,a.direction,r),this.removePressurePlate(e,a.startForSmallPlate,a.direction,r)):o.get().width<n.get().width&&this.removePressurePlate(e,a.startForBigPlate,a.direction,r),o}return n}removePressurePlate(e,t,n,r){for(let i=t;i.isInRange(R5.SIZE,R5.SIZE);i=i.getNext(n)){for(const e of BK.PLAYERS)r.get(e).equalsValue(i)&&r.delete(e);e[i.y][i.x]=k5.UNREACHABLE}}isLegal(e,t){const n=this.isLegalWithoutCaptures(t,e.coord,e.direction);if(n.isFailure())return SW.failure(n.getReason());const r=this.applyMoveWithoutPlacingCaptures(t,e.coord,e);if(e.captures.top+e.captures.bottom+e.captures.left+e.captures.right!==Math.min(r.captures.length,t.remainingSpaces()))return SW.failure(I5.MUST_PLACE_CAPTURES_ON_PRESSURE_PLATES());for(const i of N5.POSITIONS){const n=t.pressurePlates[i];if(n.isPresent()&&n.get().remainingSpaces()<e.captures[i])return SW.failure(I5.TOO_MANY_CAPTURES_ON_SAME_PRESSURE_PLATE())}return SW.success(r)}applyMoveWithoutPlacingCaptures(e,t,n){let r;const i=GK.copyBiArray(e.board),s=e.lodestones.get(e.getCurrentPlayer());if(s.isPresent()){const e=s.get();i[e.y][e.x]=k5.EMPTY}return r="pull"===n.direction?this.applyPull(e,i,t,n.orientation):this.applyPush(e,i,t,n.orientation),r.board[t.y][t.x]=M5.of(e.getCurrentPlayer(),n),r.moved.push(t),r}applyPull(e,t,n,r){const i=e.getCurrentPlayer(),s=i.getOpponent(),o=[],a=[],l="diagonal"===r?KX.DIAGONALS:KX.ORTHOGONALS;for(const c of l)for(let r=n.getNext(c);e.isOnBoard(r);r=r.getNext(c)){const n=t[r.y][r.x],l=r.getNext(c);if(e.isOnBoard(l)){const e=t[l.y][l.x];e.isPlayerPiece()&&e.owner===i&&(n.isEmpty()?(a.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=k5.EMPTY):n.isPlayerPiece()&&n.owner===s&&(o.push(r),t[r.y][r.x]=e,a.push(l),t[l.y][l.x]=k5.EMPTY))}}return{board:t,captures:o,moved:a}}applyPush(e,t,n,r){const i=e.getCurrentPlayer().getOpponent(),s=[],o=[],a="diagonal"===r?KX.DIAGONALS:KX.ORTHOGONALS;for(const l of a)for(let r=n.getNext(l,R5.SIZE);!1===r.equals(n);r=r.getPrevious(l))if(e.isOnBoard(r)){const n=t[r.y][r.x];if(n.isPlayerPiece()&&n.owner===i){const i=r.getNext(l);if(e.isOnBoard(i)){const e=t[i.y][i.x];e.isUnreachable()?(s.push(r),t[r.y][r.x]=k5.EMPTY):e.isEmpty()&&(o.push(i),t[i.y][i.x]=n,o.push(r),t[r.y][r.x]=k5.EMPTY)}else s.push(r),t[r.y][r.x]=k5.EMPTY}}return{board:t,captures:s,moved:o}}isLegalWithoutCaptures(e,t,n){const r=this.isTargetLegal(e,t);if(r.isFailure())return r;const i=e.nextLodestoneDirection();return!1===(i.isAbsent()||i.equalsValue(n))?TW.failure(I5.MUST_FLIP_LODESTONE()):TW.SUCCESS}isTargetLegal(e,t){const n=e.getPieceAt(t);if(n.isUnreachable())return TW.failure(I5.TARGET_IS_CRUMBLED());if(n.isPlayerPiece())return TW.failure(lJ.MUST_CLICK_ON_EMPTY_SQUARE());const r=e.getCurrentPlayer();return n.isLodestone()&&n.owner!==r?TW.failure(lJ.MUST_CLICK_ON_EMPTY_SQUARE()):TW.SUCCESS}getGameStatus(e){const t=e.gameState.numberOfPieces();return 0===t[0]&&0===t[1]?SJ.DRAW:0===t[0]?SJ.ONE_WON:0===t[1]?SJ.ZERO_WON:SJ.ONGOING}}x5.THREATENED_COORD_RANGE=CJ.from({top:{startForBigPlate:new JX(0,0),startForSmallPlate:new JX(0,1),direction:KX.RIGHT},bottom:{startForBigPlate:new JX(0,R5.SIZE-1),startForSmallPlate:new JX(0,R5.SIZE-2),direction:KX.RIGHT},left:{startForBigPlate:new JX(0,0),startForSmallPlate:new JX(1,0),direction:KX.DOWN},right:{startForBigPlate:new JX(R5.SIZE-1,0),startForSmallPlate:new JX(R5.SIZE-2,0),direction:KX.DOWN}}),x5.singleton=Mw.empty();class D5 extends cJ{getListMoves(e){const t=e.gameState;return this.flatMapEmptyCoords(t,e=>{const n=[];for(const r of this.nextDirection(t)){const i=["diagonal","orthogonal"];for(const s of i){const i=x5.get().applyMoveWithoutPlacingCaptures(t,e,{direction:r,orientation:s}).captures.length;for(const o of this.captureCombinations(t,i))n.push(new T5(e,r,s,o))}}return n})}captureCombinations(e,t){if(0===t)return new dJ([{top:0,bottom:0,left:0,right:0}]);{const n=new dJ,r=e.remainingSpacesDetails(),i=this.captureCombinations(e,t-1);for(const e of i)e.top+1<=r.top&&n.add({...e,top:e.top+1}),e.bottom+1<=r.bottom&&n.add({...e,bottom:e.bottom+1}),e.left+1<=r.left&&n.add({...e,left:e.left+1}),e.right+1<=r.right&&n.add({...e,right:e.right+1});return 0===n.size()?i:n}}flatMapEmptyCoords(e,t){let n=[];for(let r=0;r<R5.SIZE;r++)for(let i=0;i<R5.SIZE;i++){const s=new JX(i,r),o=e.getPieceAt(s);(o.isEmpty()&&!1===o.isUnreachable()||o.isLodestone()&&o.owner===e.getCurrentPlayer())&&(n=n.concat(t(s)))}return n}nextDirection(e){const t=e.nextLodestoneDirection();return t.isPresent()?[t.get()]:["push","pull"]}getBoardValue(e){const t=e.gameState.getScores();let n;return n=24===t[0]&&24!==t[1]?BK.ZERO.getVictoryValue():24!==t[0]&&24===t[1]?BK.ONE.getVictoryValue():t[0]*BK.ZERO.getScoreModifier()+t[1]*BK.ONE.getScoreModifier(),new uJ(n)}}const L5=k5.UNREACHABLE,F5=k5.EMPTY,U5=A5.ZERO,B5=A5.ONE,V5=M5.of(BK.ONE,{direction:"push",orientation:"orthogonal"}),$5={top:Mw.of(N5.EMPTY_5),bottom:Mw.of(N5.EMPTY_5),left:Mw.of(N5.EMPTY_5),right:Mw.of(N5.EMPTY_5)};class z5{constructor(){this.tutorial=[kJ.informational($localize`Board and aim of the game`,$localize`Lodestone is played on a 8x8 board, which contains so-called <i>pressure plates</i> along the board, that will contain captured pieces. The initial board is shown here. The aim of the game is to be the only player with pieces remaining on the board. To do so, you will have to either push your opponent's pieces off the board, or to crush them with your pieces. You will do it by using a lodestone.`,R5.getInitialState()),kJ.forClick($localize`Selecting a lodestone`,$localize`To perform a move, you have to place your lodestone on the board. Your lodestone has two sides: <ul><li>its <i>repelling</i> side with which it will repel the opponent's pieces (indicated by the outward triangles of your opponent's color on the lodestone), and</li><li>its <i>attracting</i> side with which it will attract your pieces (indicated by the inward triangles of your color on the lodestone).</li></ul>Your lodestone can be placed to move pieces orthogonally or diagonally. All available lodestone sides and orientation are shown below the board.<br/><br/>You're playing Dark. Select the lodestone that repels your opponent's pieces diagonally.`,R5.getInitialState(),["#lodestone_push_diagonal"],$localize`Congratulations!`,$localize`This is not the right lodestone, try again.`),kJ.informational($localize`The repelling lodestone`,$localize`Upon placing a lodestone on the board, it will move all pieces it acts upon (according to its direction and orientation) simultaneously. Let us first see how the repelling lodestone acts on the pieces. All the opponent's pieces aligned with the lodestone, as indicated by the triangles' orientations, will be pushed one square away from the lodestone. An opponent's piece will be blocked in case it encounters on its way either one of your piece, a lodestone, or another blocked piece. Finally, if an opponent's piece falls out of the board, it is captured.`,R5.getInitialState()),kJ.informational($localize`The attracting lodestone`,$localize`When the lodestone is on its attracting side it will pull your pieces one square towards it. In case one of your pieces encounters a lodestone on its way or another blocked piece, it is blocked. However, if it encounter an opponent's piece, it will capture it.`,R5.getInitialState()),kJ.informational($localize`Flipping the lodestone`,$localize`Note that, after every move, you must flip your lodestone: if it was on its repelling side, you must use it on its attracting side, and vice versa. Also, you are allowed to place your lodestone on the same location as it was on your previous turn.`,R5.getInitialState()),kJ.fromPredicate($localize`Capturing`,$localize`To summarize, it is possible to capture the opponent's pieces in two ways:<ul><li>with a repelling lodestone, by pushing your opponent's pieces out of the board, or</li><li>with an attracting lodestone, by moving your pieces on your opponent's pieces.</li></ul>Once a lodestone is placed and the pieces have been moved and/or captured, in case any of the opponent's pieces have been captured, you have to place them on the <i>pressure plates</i> that lie around the board. To do so, click on an empty space of the pressure plate of your choice for each capture. You can cancel this by clicking again on a piece you just put on a pressure plate.<br/><br/>You're playing Dark. Try to perform a move that captures at least one of your opponent's piece, and place your capture(s) on pressure plates.`,R5.getInitialState(),new T5(new JX(0,6),"pull","orthogonal",{top:2,bottom:1,left:1,right:1}),(e,t)=>32===t.remainingSpaces()?TW.failure($localize`You have not captured any of the opponent's pieces, try again!`):TW.SUCCESS,"Congratulations!"),kJ.fromPredicate($localize`Crumbling a first pressure plate`,$localize`When a pressure plate is full, it will crumble and take a full row or column of the board with it! All pieces that are on the crumbled squares are considered lost, but will not have to be placed on pressure plates. You have here a board with a pressure plate that only requires one more piece to crumble.<br/><br/>You're playing Dark. Perform a move that captures at least one piece, and fill that pressure plate to make it crumble.`,new R5([[F5,F5,F5,F5,B5,F5,F5,F5],[F5,F5,U5,F5,F5,B5,F5,F5],[F5,F5,V5,F5,F5,F5,F5,U5],[F5,F5,F5,F5,B5,F5,F5,U5],[F5,F5,F5,F5,F5,U5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5]],0,new CJ([{key:BK.ONE,value:new JX(2,2)}]),{...$5,top:N5.EMPTY_5.addCaptured(BK.ONE,4)}),new T5(new JX(6,2),"push","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>5===t.pressurePlates.top.get().width?TW.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble!`):TW.SUCCESS,"Congratulations!"),kJ.fromPredicate($localize`Crumbling a second pressure plate`,$localize`Once a pressure plate has crumbled, a shorter pressure plate takes it place. It is the case here, where only 3 spots are available on the top pressure plate.<br/><br/>You're playing Dark. Perform a move that captures enough pieces to fill the top pressure plate, and make it crumble.`,new R5([[L5,L5,L5,L5,L5,L5,L5,L5],[F5,F5,F5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,U5],[F5,F5,F5,F5,F5,U5,F5,U5],[F5,V5,F5,F5,B5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,B5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5]],0,new CJ([{key:BK.ONE,value:new JX(1,4)}]),{...$5,top:N5.EMPTY_3.addCaptured(BK.ONE,2)}),new T5(new JX(3,5),"pull","diagonal",{top:1,bottom:0,left:0,right:0}),(e,t)=>t.pressurePlates.top.isPresent()?TW.failure($localize`You must capture and place your capture on the top pressure plate to make it crumble a second time!`):TW.SUCCESS,"Congratulations!"),kJ.informational($localize`Minimal board`,$localize`After a pressure plate has crumbled for a second time, there is no more pressure plate available on that side. In case all pressure plates have crumbled, the board is reduced to a 4x4 board.`,new R5([[L5,L5,L5,L5,L5,L5,L5,L5],[L5,L5,L5,L5,L5,L5,L5,L5],[L5,L5,U5,B5,F5,F5,L5,L5],[L5,L5,V5,B5,F5,F5,L5,L5],[L5,L5,F5,U5,U5,F5,L5,L5],[L5,L5,U5,F5,F5,F5,L5,L5],[L5,L5,L5,L5,L5,L5,L5,L5],[L5,L5,L5,L5,L5,L5,L5,L5]],0,new CJ([{key:BK.ONE,value:new JX(2,3)}]),{top:Mw.empty(),bottom:Mw.empty(),left:Mw.empty(),right:Mw.empty()})),kJ.fromMove($localize`Making the lodestone fall`,$localize`If, at any point during the game, your lodestone is situated on a square that crumbles with a pressure plate, you will be allowed to select any lodestone side on your next turn.<br/><br/>In this board, playing Dark, you can place your lodestone and make a pressure plate crumble so that your lodestone falls too, allowing to choose more freely its side on your next turn. Do it!`,new R5([[F5,F5,F5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,F5,B5,F5,F5],[F5,F5,F5,V5,F5,F5,U5,F5],[F5,F5,U5,U5,B5,F5,F5,U5],[F5,F5,F5,F5,F5,U5,F5,F5],[F5,F5,U5,F5,F5,F5,F5,F5],[F5,F5,B5,F5,F5,F5,F5,F5],[F5,F5,F5,F5,F5,F5,F5,F5]],0,new CJ([{key:BK.ONE,value:new JX(3,2)}]),{...$5,top:N5.EMPTY_5.addCaptured(BK.ONE,4)}),[new T5(new JX(4,0),"pull","diagonal",{top:1,bottom:0,left:0,right:0})],$localize`Congratulations! At your next turn, you will be allowed to place your lodestone on any side.`,$localize`Failed, try again.`),kJ.fromMove($localize`End of the game`,$localize`In order to win, you must take out all of your opponent's pieces.<br/><br/>Here, you can win in a single move, do it!`,new R5([[L5,L5,L5,L5,L5,L5,L5,L5],[L5,L5,L5,L5,L5,L5,L5,L5],[L5,B5,U5,B5,F5,F5,L5,L5],[L5,B5,V5,F5,B5,F5,L5,L5],[L5,F5,F5,U5,U5,F5,L5,L5],[L5,B5,U5,F5,B5,F5,L5,L5],[L5,F5,F5,F5,U5,F5,L5,L5],[L5,L5,L5,L5,L5,L5,L5,L5]],0,new CJ([{key:BK.ONE,value:new JX(2,3)}]),{top:Mw.empty(),bottom:N5.EMPTY_3.addCaptured(BK.ZERO,2),left:Mw.of(N5.EMPTY_3),right:Mw.empty()}),[new T5(new JX(4,2),"pull","orthogonal",{top:0,bottom:0,left:3,right:0})],$localize`Congratulations, you won!`,$localize`This is not the winning move. Try again.`)]}}function H5(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa(2),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ia("id","piece_",t,"_",r,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*t+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function G5(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=Sa().$implicit,t=Sa(3).$implicit,n=Sa(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_OUT)}}function W5(e,t){if(1&e&&(Cn(),ga(0,"polygon",15)),2&e){const e=Sa().$implicit,t=Sa(3).$implicit,n=Sa(2);aa("transform","rotate(",90*e,")"),ha("ngClass",t.lodestone.movingClass),ra("points",n.TRIANGLE_IN)}}function q5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,G5,1,3,"polygon",14),la(2,W5,1,3,"polygon",14),fa()),2&e){const e=Sa(3).$implicit;Ts(1),ha("ngIf","push"===e.lodestone.direction),Ts(1),ha("ngIf","pull"===e.lodestone.direction)}}const j5=function(){return[0,1,2,3]};function Z5(e,t){if(1&e&&(Cn(),pa(0,"g",11),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,q5,3,2,"g",1),fa(),fa()),2&e){const e=Sa(2),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();ra("transform",i.getSquareTransform(t,r)),Ts(1),ha("ngClass",n.lodestone.selectedClass),ra("r",i.PIECE_RADIUS),Ts(1),ha("ngClass",n.lodestone.pieceClasses),ra("r",i.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===n.lodestone.orientation?45:0,")"),Ts(1),ha("ngForOf",wu(7,j5))}}function Y5(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa(2).selectCoord(t.coord)}),ga(1,"rect",7),la(2,H5,1,6,"circle",8),la(3,Z5,5,8,"g",9),fa()}if(2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ia("id","square_",t,"_",r,""),Ts(1),ha("ngClass",n.squareClasses),ra("x",i.SPACE_SIZE*t+i.STROKE_WIDTH)("y",i.SPACE_SIZE*r+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",n.hasPiece),Ts(1),ha("ngIf",n.lodestone)}}function K5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Y5,4,9,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",!1===e.crumbled)}}function Q5(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,K5,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function X5(e,t){if(1&e&&(Cn(),pa(0,"g",16),ga(1,"circle",17),fa()),2&e){const e=t.$implicit,n=t.index,r=Sa();Ta("id","capture_",n,""),ra("transform",r.getCaptureTransform(n)),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS)}}function J5(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polygon",15),fa()),2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa();Ts(1),aa("transform","rotate(",90*e,")"),ha("ngClass",n.movingClass),ra("points","push"===n.direction?r.TRIANGLE_OUT:r.TRIANGLE_IN)}}function e6(e,t){if(1&e){const e=va();Cn(),pa(0,"g",6),Ea("click",function(){const t=Gt(e).$implicit;return Sa().selectLodestone(t)}),ga(1,"circle",12),ga(2,"circle",13),pa(3,"g"),la(4,J5,2,3,"g",1),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa();Ia("id","lodestone_",e.direction,"_",e.orientation,""),ra("transform",r.getAvailableLodestoneTransform(n)),Ts(1),ha("ngClass",e.selectedClass),ra("r",r.PIECE_RADIUS),Ts(1),ha("ngClass",e.pieceClasses),ra("r",r.PIECE_RADIUS/4),Ts(1),aa("transform","rotate(","diagonal"===e.orientation?45:0,")"),Ts(1),ha("ngForOf",wu(9,j5))}}function t6(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().$implicit,i=Sa();Ia("id","platePiece_",r.position,"_",t,""),ha("ngClass",n.pieceClasses),ra("r",i.PIECE_RADIUS)("cx",i.SPACE_SIZE*n.coord.x+i.STROKE_WIDTH+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*n.coord.y+i.STROKE_WIDTH+i.SPACE_SIZE/2)}}function n6(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"g",6),Ea("click",function(){const t=Gt(e),n=t.$implicit,r=t.index,i=Sa().$implicit;return Sa().onPressurePlateClick(n.temporary,i.position,r)}),ga(2,"rect",18),la(3,t6,1,6,"circle",8),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().$implicit,i=Sa();ra("transform",i.getPressurePlateTransform(r.position)),Ts(1),Ia("id","plate_",r.position,"_",n,""),Ts(1),Ia("id","plateSquare_",r.position,"_",n,""),ha("ngClass",e.squareClasses),ra("x",i.SPACE_SIZE*e.coord.x+i.STROKE_WIDTH)("y",i.SPACE_SIZE*e.coord.y+i.STROKE_WIDTH)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.hasPiece)}}function r6(e,t){if(1&e&&(Cn(),pa(0,"g",16),la(1,n6,4,11,"g",1),fa()),2&e){const e=t.$implicit;Ta("id","pressurePlate_",e.position,""),Ts(1),ha("ngForOf",e.coords)}}function i6(e,t){if(1&e&&(Cn(),ga(0,"rect",19)),2&e){const e=Sa();Ia("id","selection_",e.viewInfo.selected.get().x,"_",e.viewInfo.selected.get().y,""),ra("x",e.SPACE_SIZE*e.viewInfo.selected.get().x+e.STROKE_WIDTH)("y",e.SPACE_SIZE*e.viewInfo.selected.get().y+e.STROKE_WIDTH)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}class s6 extends eJ{constructor(e){super(e),this.viewInfo={availableLodestones:[],capturesToPlace:[],boardInfo:[],currentPlayerClass:"",opponentClass:"",pressurePlates:[],selected:Mw.empty(),pressurePlateShift:{top:new jX(0,0),left:new jX(0,0),right:new jX(0,0),bottom:new jX(0,0)}},this.stateAfterPlacingLodestone=Mw.empty(),this.lastInfos=Mw.empty(),this.capturesToPlace=0,this.selectedCoord=Mw.empty(),this.selectedLodestone=Mw.empty(),this.captures={top:0,bottom:0,left:0,right:0},this.rules=x5.get(),this.tutorial=(new z5).tutorial,this.availableMinimaxes=[new D5(this.rules,"LodestoneDummyMinimax")],this.encoder=T5.encoder,this.PIECE_RADIUS=.5*(this.SPACE_SIZE-2*this.STROKE_WIDTH);const t=.8*this.PIECE_RADIUS,n=.3*this.PIECE_RADIUS,r=.2*this.PIECE_RADIUS;this.TRIANGLE_OUT=`${t},0 ${n},${r} ${n},-${r}`,this.TRIANGLE_IN=`${n},0 ${t},${n} ${t},-${n}`,this.displayedState=this.rules.node.gameState,this.scores=Mw.of([0,0])}ngOnInit(){this.updateBoard()}selectCoord(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#square_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.capturesToPlace>0)return t.cancelMove(I5.MUST_PLACE_CAPTURES());const r=x5.get().isTargetLegal(t.getState(),e);return r.isFailure()?t.cancelMove(r.getReason()):t.selectedLodestone.isPresent()?(t.selectedCoord=Mw.of(e),t.putLodestone()):(t.selectedCoord=Mw.of(e),t.updateViewInfo(),TW.SUCCESS)})()}selectLodestone(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#lodestone_"+e.direction+"_"+e.orientation);if(n.isFailure())return t.cancelMove(n.getReason());NW(0===t.capturesToPlace,"should not be able to click on a lodestone when captures need to be placed");const r=t.getCurrentPlayer();return t.selectedLodestone=Mw.of(M5.of(r,e)),t.selectedCoord.isPresent()?t.putLodestone():(t.updateViewInfo(),TW.SUCCESS)})()}putLodestone(){var e=this;return Pw(function*(){NW(e.selectedCoord.isPresent(),"coord should have been selected"),NW(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=e.getState();NW(x5.get().isLegalWithoutCaptures(r,t,n.direction).isSuccess(),"Lodestone component should only allow creation of legal moves");const i=x5.get().applyMoveWithoutPlacingCaptures(r,t,n);return e.lastInfos=Mw.of(i),e.capturesToPlace=Math.min(i.captures.length,r.remainingSpaces()),0===e.capturesToPlace?e.applyMove():(e.displayedState=e.displayedState.withBoard(i.board),e.stateAfterPlacingLodestone=Mw.of(e.displayedState),e.updateViewInfo(),TW.SUCCESS)})()}applyMove(){var e=this;return Pw(function*(){NW(e.selectedCoord.isPresent(),"coord should have been selected"),NW(e.selectedLodestone.isPresent(),"lodestone should have been selected");const t=e.selectedCoord.get(),n=e.selectedLodestone.get(),r=new T5(t,n.direction,n.orientation,e.captures);return e.chooseMove(r,e.getState())})()}onPressurePlateClick(e,t,n){return e?this.deselectPressurePlate(t,n):this.selectPressurePlate(t,n)}selectPressurePlate(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(0===n.capturesToPlace)return n.cancelMove(I5.NO_CAPTURES_TO_PLACE_YET());n.capturesToPlace--,n.captures[e]++;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=GK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return x5.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new R5(o,i.turn,l,a),0===n.capturesToPlace?n.applyMove():(n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),TW.SUCCESS)})()}deselectPressurePlate(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#plate_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());n.capturesToPlace++,n.captures[e]--;const i=n.stateAfterPlacingLodestone.get(),s=n.getCurrentPlayer().getOpponent(),o=GK.copyBiArray(i.board),a={...i.pressurePlates},l=i.lodestones.getCopy();return x5.get().updatePressurePlates(o,a,l,s,n.captures),n.displayedState=new R5(o,i.turn,l,a),n.updateViewInfo(),n.showPressurePlateDifferences(n.getState(),n.displayedState,!0),TW.SUCCESS})()}updateBoard(){this.cancelMoveAttempt(),this.rules.node.move.isPresent()&&this.showLastMove(),this.scores=Mw.of(this.getState().getScores())}cancelMoveAttempt(){this.displayedState=this.getState(),this.stateAfterPlacingLodestone=Mw.empty(),this.lastInfos=Mw.empty();const e=this.displayedState.lodestones.get(this.getCurrentPlayer());if(e.isPresent()){const t=GK.copyBiArray(this.displayedState.board);t[e.get().y][e.get().x]=k5.EMPTY,this.displayedState=this.displayedState.withBoard(t)}this.selectedCoord=Mw.empty(),this.selectedLodestone=Mw.empty(),this.capturesToPlace=0,this.captures={top:0,bottom:0,left:0,right:0},this.updateViewInfo()}updateViewInfo(){const e=this.getState().getCurrentPlayer();this.viewInfo.currentPlayerClass=this.getPlayerClass(e),this.viewInfo.opponentClass=this.getPlayerClass(e.getOpponent()),this.showBoard(),this.showAvailableLodestones(),this.showCapturesToPlace(),this.showPressurePlates(),this.computePressurePlateShift(),this.lastInfos.isPresent()&&this.showMovedAndCaptured(this.lastInfos.get())}showBoard(){this.viewInfo.boardInfo=[];for(let e=0;e<R5.SIZE;e++){this.viewInfo.boardInfo.push([]);for(let t=0;t<R5.SIZE;t++){const n=new JX(t,e);this.viewInfo.boardInfo[e].push(this.getSquareInfo(n))}}this.viewInfo.selected=this.selectedCoord.isPresent()&&!1===this.displayedState.getPieceAt(this.selectedCoord.get()).isUnreachable()?this.selectedCoord:Mw.empty()}getSquareInfo(e){const t=this.displayedState.getPieceAt(e),n={coord:e,squareClasses:[],crumbled:t.isUnreachable(),hasPiece:t.isPlayerPiece(),pieceClasses:[]};return t.isPlayerPiece()&&(n.pieceClasses=[this.getPlayerClass(t.owner)]),t.isLodestone()&&(n.lodestone={direction:t.direction,pieceClasses:[this.getPlayerClass(t.owner)],selectedClass:"",movingClass:"",orientation:t.orientation},n.lodestone.movingClass=this.getPlayerClass("push"===t.direction?t.owner.getOpponent():t.owner)),n}showAvailableLodestones(){if(this.capturesToPlace>0)this.viewInfo.availableLodestones=[];else{const e=this.getState().getCurrentPlayer(),t=this.getState().nextLodestoneDirection();if(t.isPresent()){const n=t.get();this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:n,orientation:"orthogonal"}),this.nextLodestone(e,{direction:n,orientation:"diagonal"})]}else this.viewInfo.availableLodestones=[this.nextLodestone(e,{direction:"push",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"push",orientation:"diagonal"}),this.nextLodestone(e,{direction:"pull",orientation:"orthogonal"}),this.nextLodestone(e,{direction:"pull",orientation:"diagonal"})]}}showCapturesToPlace(){const e=this.getCurrentPlayer().getOpponent();this.viewInfo.capturesToPlace=[];for(let t=0;t<this.capturesToPlace;t++)this.viewInfo.capturesToPlace.push({pieceClasses:[this.getPlayerClass(e)]})}nextLodestone(e,t){const n=M5.of(e,t),r={direction:n.direction,orientation:n.orientation,pieceClasses:[this.getPlayerClass(n.owner)],movingClass:"",selectedClass:""};return r.movingClass=this.getPlayerClass("push"===n.direction?n.owner.getOpponent():n.owner),this.selectedLodestone.equalsValue(n)&&(r.selectedClass="selected"),r}showPressurePlates(){this.viewInfo.pressurePlates=[];for(const e of N5.POSITIONS){const t=[],n=this.displayedState.pressurePlates[e];if(n.isPresent()){const r=s6.PRESSURE_PLATES_POSITIONS.get(e).get(),i=n.get().width;let s=5===i?r.startForBigPlate:r.startForSmallPlate;for(let e=0;e<i;e++){s=s.getNext(r.direction);const i=n.get().getPieceAt(e);let o="";i.isPlayerPiece()&&(o=this.getPlayerClass(i.owner)),t.push({coord:s,hasPiece:i.isPlayerPiece(),pieceClasses:[o],squareClasses:[],temporary:!1})}}this.viewInfo.pressurePlates.push({position:e,coords:t})}}showLastMove(){const e=this.rules.node.mother.get().gameState,t=this.rules.node.move.get();this.lastInfos=Mw.of(x5.get().applyMoveWithoutPlacingCaptures(e,t.coord,t)),this.updateViewInfo();const n=this.getState();this.showPressurePlateDifferences(e,n,!1)}showPressurePlateDifferences(e,t,n){for(const r of N5.POSITIONS)this.showPressurePlateDifference(e.pressurePlates[r],t.pressurePlates[r],r,n)}showPressurePlateDifference(e,t,n,r){if(e.isPresent()&&t.isPresent()){const i=e.get(),s=t.get(),o=Ow.getNonNullable(this.viewInfo.pressurePlates.find(e=>e.position===n));if(i.width===s.width)for(let e=0;e<s.width;e++){const t=i.getPieceAt(e),n=s.getPieceAt(e);!1===t.equals(n)&&(o.coords[e].squareClasses.push("moved"),o.coords[e].temporary=r,r&&o.coords[e].pieceClasses.push("semi-transparent"))}else for(const e of o.coords)e.squareClasses.push("moved")}}showMovedAndCaptured(e){for(const t of e.moved)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("moved");for(const t of e.captures)this.viewInfo.boardInfo[t.y][t.x].squareClasses.push("captured")}computePressurePlateShift(){const e=this.displayedState,t=this.getPressurePlateShift(e.pressurePlates.left),n=this.getPressurePlateShift(e.pressurePlates.right),r=this.getPressurePlateShift(e.pressurePlates.top),i=this.getPressurePlateShift(e.pressurePlates.bottom);this.viewInfo.pressurePlateShift.top=new JX(.5*(t-n),0),this.viewInfo.pressurePlateShift.bottom=new JX(.5*(t-n),0),this.viewInfo.pressurePlateShift.left=new JX(0,.5*(r-i)),this.viewInfo.pressurePlateShift.right=new JX(0,.5*(r-i))}getPressurePlateShift(e){return e.isAbsent()?2:3===e.get().width?1:0}getSquareTransform(e,t){return`translate(${e*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2}, ${t*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getCaptureTransform(e){return`translate(${(e+(R5.SIZE/2-this.viewInfo.capturesToPlace.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${-2*this.SPACE_SIZE-30+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getAvailableLodestoneTransform(e){return`translate(${(e+(R5.SIZE/2-this.viewInfo.availableLodestones.length/2))*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2+this.viewInfo.pressurePlateShift.top.x*this.SPACE_SIZE}, ${30+9*this.SPACE_SIZE+this.STROKE_WIDTH+this.SPACE_SIZE/2})`}getPressurePlateTransform(e){return`translate(${this.viewInfo.pressurePlateShift[e].x*this.SPACE_SIZE}, ${this.viewInfo.pressurePlateShift[e].y*this.SPACE_SIZE})`}}s6.PRESSURE_PLATE_EXTRA_SHIFT=.2,s6.PRESSURE_PLATES_POSITIONS=CJ.from({top:{startForBigPlate:new JX(.5,-1-s6.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new JX(1.5,0-s6.PRESSURE_PLATE_EXTRA_SHIFT),direction:KX.RIGHT},bottom:{startForBigPlate:new JX(.5,8+s6.PRESSURE_PLATE_EXTRA_SHIFT),startForSmallPlate:new JX(1.5,7+s6.PRESSURE_PLATE_EXTRA_SHIFT),direction:KX.RIGHT},left:{startForBigPlate:new JX(-1-s6.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new JX(0-s6.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:KX.DOWN},right:{startForBigPlate:new JX(8+s6.PRESSURE_PLATE_EXTRA_SHIFT,.5),startForSmallPlate:new JX(7+s6.PRESSURE_PLATE_EXTRA_SHIFT,1.5),direction:KX.DOWN}}),s6.\u0275fac=function(e){return new(e||s6)(ua(AW))},s6.\u0275cmp=Je({type:s6,selectors:[["app-lodestone"]],features:[Go],decls:6,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-100 -220 1016 1256","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],["class","base no-fill selected",3,"id",4,"ngIf"],[3,"id","click",4,"ngIf"],[3,"id","click"],[1,"base",3,"ngClass"],["class","base",3,"id","ngClass",4,"ngIf"],["class","lodestone",4,"ngIf"],[1,"base",3,"id","ngClass"],[1,"lodestone"],["cx","0","cy","0",1,"base","black-fill","outside",3,"ngClass"],["cx","0","cy","0",1,"base","no-stroke",3,"ngClass"],["class","base no-stroke",3,"ngClass",4,"ngIf"],[1,"base","no-stroke",3,"ngClass"],[3,"id"],["cx","0","cy","0",1,"base",3,"ngClass"],["rx","20","ry","20",1,"base",3,"id","ngClass"],[1,"base","no-fill","selected",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,Q5,2,1,"g",1),la(2,X5,2,4,"g",2),la(3,e6,5,10,"g",3),la(4,r6,2,2,"g",2),la(5,i6,1,6,"rect",4),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.boardInfo),Ts(1),ha("ngForOf",t.viewInfo.capturesToPlace),Ts(1),ha("ngForOf",t.viewInfo.availableLodestones),Ts(1),ha("ngForOf",t.viewInfo.pressurePlates),Ts(1),ha("ngIf",t.viewInfo.selected.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let o6=(()=>{class e{}return e.START_COORD_OUT_OF_RANGE=()=>$localize`Start coord cannot be out of range`,e.END_COORD_OUT_OF_RANGE=()=>$localize`End coord cannot be out of range`,e.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP=()=>$localize`Pawns must move one step diagonally.`,e.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS=()=>$localize`Drones must move one or two steps in any direction.`,e})();class a6 extends C1{constructor(e,t,n){super(e,t),this.calledTheClock=n}static from(e,t,n=!1){if(e.isNotInRange(4,8))return SW.failure(o6.START_COORD_OUT_OF_RANGE());if(t.isNotInRange(4,8))return SW.failure(o6.END_COORD_OUT_OF_RANGE());if(t.equals(e))return SW.failure(lJ.MOVE_CANNOT_BE_STATIC());const r=KX.factory.fromDelta(t.x-e.x,t.y-e.y);return r.isFailure()?SW.failure(r.getReason()):SW.success(new a6(e,t,n))}toString(){return"MartianChessMove(("+this.coord.x+", "+this.coord.y+") -> ("+this.end.x+", "+this.end.y+")"+(this.calledTheClock?", CALL_THE_CLOCK":"")+")"}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.end.equals(e.end)&&this.calledTheClock===e.calledTheClock}isValidForPawn(){const e=Math.abs(this.coord.x-this.end.x),t=Math.abs(this.coord.y-this.end.y);return 1===e&&1===t}isValidForDrone(){return this.coord.getDistance(this.end)<=2}isUndoneBy(e){if(e.isAbsent())return!1;const t=e.get();return t.end.equals(this.coord)&&t.coord.equals(this.end)}}a6.encoder=FK.tuple([JX.numberEncoder(4,8),JX.numberEncoder(4,8),FK.booleanEncoder],e=>[e.coord,e.end,e.calledTheClock],e=>a6.from(e[0],e[1],e[2]).get());class l6{constructor(e){this.value=e}static tryMerge(e,t){NW(e!==l6.EMPTY&&t!==l6.EMPTY,"tryMerge cannot be called with empty pieces");const n=e.value+t.value;return 2===n||3===n?Mw.of(l6.from(n)):Mw.empty()}static from(e){switch(e){case l6.DRONE.value:return l6.DRONE;default:return Ow.expectToBe(e,l6.QUEEN.value),l6.QUEEN}}getValue(){return this.value}equals(e){return this.getValue()===e.getValue()}}l6.EMPTY=new l6(0),l6.PAWN=new l6(1),l6.DRONE=new l6(2),l6.QUEEN=new l6(3);class c6 extends cJ{constructor(e,t){super(e,t),this.ruler=e}getListMoves(e){const t=e.gameState,n=t.getCurrentPlayer(),r=t.getPlayerTerritory(n);let i=[];for(const s of r)for(let e=0;e<4;e++)switch(t.getPieceAtXY(e,s)){case l6.PAWN:i=i.concat(this.getMovesForPawnAt(t,e,s));break;case l6.DRONE:i=i.concat(this.getMovesForDroneAt(t,e,s));break;case l6.QUEEN:i=i.concat(this.getMovesForQueenAt(t,e,s))}return i}getMovesForPawnAt(e,t,n){const r=new JX(t,n),i=[];for(const s of KX.DIAGONALS){const e=r.getNext(s);e.isInRange(4,8)&&i.push(e)}return this.addLegalMoves(e,r,i)}addLegalMoves(e,t,n){const r=[],i=e.getPieceAt(t),s=!1===e.isTherePieceOnPlayerSide(l6.DRONE),o=!1===e.isTherePieceOnPlayerSide(l6.QUEEN),a=e.lastMove;for(const l of n){const n=e.getPieceAt(l);if(n===l6.EMPTY)this.add(r,a6.from(t,l).get(),a);else if(e.isInPlayerTerritory(l)){const e=l6.tryMerge(n,i);if(e.isPresent()){const n=e.get(),i=a6.from(t,l).get();(n===l6.DRONE&&s||n===l6.QUEEN&&o)&&this.add(r,i,a)}}else this.add(r,a6.from(t,l).get(),a)}return r}add(e,t,n){!1===t.isUndoneBy(n)&&e.push(t)}getMovesForDroneAt(e,t,n){const r=new JX(t,n),i=this.getLandingCoordsForLinearMove(r,e,2);return this.addLegalMoves(e,r,i)}getLandingCoordsForLinearMove(e,t,n){const r=[];for(const i of KX.DIRECTIONS){let s=1,o=e.getNext(i,s),a=t.tryToGetPieceAt(o),l=a.equalsValue(l6.EMPTY);for(;l;)r.push(o),s++,o=e.getNext(i,s),a=t.tryToGetPieceAt(o),l=a.equalsValue(l6.EMPTY)&&s<n;a.isPresent()&&r.push(o)}return r}getMovesForQueenAt(e,t,n){const r=new JX(t,n),i=this.getLandingCoordsForQueen(r,e);return this.addLegalMoves(e,r,i)}getLandingCoordsForQueen(e,t){return this.getLandingCoordsForLinearMove(e,t,8)}getBoardValue(e){const t=this.ruler.getGameStatus(e);let n;if(t.isEndGame)n=t.toBoardValue();else{const t=e.gameState.getScoreOf(BK.ZERO);n=e.gameState.getScoreOf(BK.ONE)-t}return new uJ(n)}}class u6{constructor(e){this.captures=e,e.makeImmutable()}static from(e){const t=new CJ;for(const n of e)u6.addToMap(t,n);return new u6(t)}static addToMap(e,t){const n=e.get(t);n.isPresent()?e.replace(t,n.get()+1):e.set(t,1)}toValue(){let e=0;return this.captures.forEach(t=>{e+=t.key.getValue()*t.value}),e}add(e){const t=this.captures.getCopy();return u6.addToMap(t,e),new u6(t)}}class h6 extends fJ{constructor(e,t,n=Mw.empty(),r=Mw.empty(),i){super(e,t),this.lastMove=n,this.countDown=r,null==i&&(i=new CJ([{key:BK.ZERO,value:u6.from([])},{key:BK.ONE,value:u6.from([])}])),i.makeImmutable(),this.captured=i}static getInitialState(){const e=l6.EMPTY,t=l6.PAWN,n=l6.DRONE,r=l6.QUEEN;return new h6([[r,r,n,e],[r,n,t,e],[n,t,t,e],[e,e,e,e],[e,e,e,e],[e,t,t,n],[e,t,n,r],[e,n,r,r]],0,Mw.empty())}getPlayerTerritory(e){return e===BK.ZERO?h6.PLAYER_ZERO_TERRITORY:h6.PLAYER_ONE_TERRITORY}isTherePieceOnPlayerSide(e){const t=this.getCurrentPlayer(),n=this.getPlayerTerritory(t);for(const r of n)for(let t=0;t<4;t++)if(this.getPieceAtXY(t,r)===e)return!0;return!1}getScoreOf(e){return this.captured.get(e).get().toValue()}getEmptyTerritory(){return this.isTerritoryEmpty(BK.ZERO)?Mw.of(BK.ZERO):this.isTerritoryEmpty(BK.ONE)?Mw.of(BK.ONE):Mw.empty()}isTerritoryEmpty(e){const t=this.getPlayerTerritory(e);for(const n of t)for(let e=0;e<4;e++)if(this.getPieceAtXY(e,n)!==l6.EMPTY)return!1;return!0}isInOpponentTerritory(e){const t=this.getCurrentOpponent();return this.getPlayerTerritory(t).contains(e.y)}isInPlayerTerritory(e){const t=this.getCurrentPlayer();return this.getPlayerTerritory(t).contains(e.y)}getCapturesOf(e){const t=this.captured.get(BK.fromTurn(e)).get();return[t.captures.get(l6.PAWN).getOrElse(0),t.captures.get(l6.DRONE).getOrElse(0),t.captures.get(l6.QUEEN).getOrElse(0)]}}h6.PLAYER_ZERO_TERRITORY=new dJ([0,1,2,3]),h6.PLAYER_ONE_TERRITORY=new dJ([4,5,6,7]);let d6=(()=>{class e{}return e.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY=()=>$localize`You must pick a piece from your side of the board in order to move it.`,e.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT=()=>$localize`This is not a valid promotion nor a valid capture.`,e.CANNOT_UNDO_LAST_MOVE=()=>$localize`You cannot perform a move that is the reverse of the previous one.`,e})();class p6 extends PJ{applyLegalMove(e,t,n){const r=t.getCopiedBoard();r[e.coord.y][e.coord.x]=l6.EMPTY,r[e.end.y][e.end.x]=n.finalPiece;const i=n.score;let s=t.countDown;if(s.isPresent())if(this.isCapture(e,t))s=p6.STARTING_COUNT_DOWN;else{const e=t.countDown.get();s=Mw.of(e-1)}return e.calledTheClock&&(s=p6.STARTING_COUNT_DOWN),new h6(r,t.turn+1,Mw.of(e),s,i)}isLegal(e,t){this.assertNonDoubleClockCall(e,t);const n=this.isLegalMove(e,t);if(n.isFailure())return SW.failure(n.getReason());if(e.isUndoneBy(t.lastMove))return SW.failure(d6.CANNOT_UNDO_LAST_MOVE());if(this.isFieldPromotion(e,t))return this.isLegalFieldPromotion(e,t);const r=t.getPieceAt(e.coord),i=t.captured.getCopy();if(this.isCapture(e,t)){const n=t.getCurrentPlayer();let r=i.get(n).get();const s=t.getPieceAt(e.end);r=r.add(s),i.replace(n,r),i.makeImmutable()}return SW.success({finalPiece:r,score:i})}assertNonDoubleClockCall(e,t){NW(!1===(t.countDown.isPresent()&&e.calledTheClock),"Should not call the clock twice")}isCapture(e,t){const n=t.isInOpponentTerritory(e.end),r=t.getPieceAt(e.end)!==l6.EMPTY;return n&&r}isFieldPromotion(e,t){const n=t.isInPlayerTerritory(e.end),r=t.getPieceAt(e.end)!==l6.EMPTY;return n&&r}isLegalFieldPromotion(e,t){const n=this.getPromotedPiece(e,t);if(n.isAbsent())return SW.failure(d6.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());const r=n.get();if(t.isTherePieceOnPlayerSide(r))return SW.failure(d6.CANNOT_CAPTURE_YOUR_OWN_PIECE_NOR_PROMOTE_IT());{const e={finalPiece:r,score:t.captured.getCopy()};return SW.success(e)}}isLegalMove(e,t){if(!1===t.isInPlayerTerritory(e.coord))return SW.failure(d6.MUST_CHOOSE_PIECE_FROM_YOUR_TERRITORY());const n=t.getPieceAt(e.coord);if(n===l6.EMPTY)return SW.failure(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(n===l6.PAWN)return e.isValidForPawn()?SW.success(void 0):SW.failure(o6.PAWN_MUST_MOVE_ONE_DIAGONAL_STEP());if(n===l6.DRONE&&!1===e.isValidForDrone())return SW.failure(o6.DRONE_MUST_DO_TWO_ORTHOGONAL_STEPS());for(const r of e.coord.getUntil(e.end))if(t.getPieceAt(r)!==l6.EMPTY)return SW.failure(lJ.SOMETHING_IN_THE_WAY());return SW.success(void 0)}getPromotedPiece(e,t){const n=t.getPieceAt(e.coord),r=t.getPieceAt(e.end);return l6.tryMerge(n,r)}getGameStatus(e){const t=e.gameState;if(t.countDown.equalsValue(0))return this.getGameStatusScoreVictoryOr(t,SJ.DRAW);if(t.getEmptyTerritory().isPresent()){const e=t.getCurrentOpponent(),n=SJ.getVictory(e);return this.getGameStatusScoreVictoryOr(t,n)}return SJ.ONGOING}getGameStatusScoreVictoryOr(e,t){const n=e.getScoreOf(BK.ZERO),r=e.getScoreOf(BK.ONE);return n>r?SJ.ZERO_WON:r>n?SJ.ONE_WON:t}}p6.STARTING_COUNT_DOWN=Mw.of(7);let f6=(()=>{class e{}return e.YOU_DID_NOT_CAPTURE_ANY_PIECE=()=>$localize`Failed, you did not capture any piece.`,e})();const g6=l6.EMPTY,m6=l6.PAWN,y6=l6.DRONE,v6=l6.QUEEN,_6=()=>$localize`This is not a field promotion!`;class C6{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`At Martian Chess, the goal is to have the most points at the end of the game. Each piece is assigned a value, you win this value when capturing the piece. The board is divided in two by a line called the canal. There is one side for each player. You do not own pieces, but you control the ones on your side of the canal. Pieces are colored to help you: they will change color when crossing the canal.`,h6.getInitialState()),kJ.informational($localize`The pieces`,$localize`The pieces are dark on the side of the first player, the light ones on the side of the second one. There are 3 kind of pieces: <ul><li>The Queens: represented as circles with 3 dots.</li><li>The Drones: represented as circles with 2 dots.</li><li>The Pawns: represented as circles with one dot.</li></ul>`,h6.getInitialState()),kJ.fromPredicate($localize`Moving pawns`,$localize`Pawns are worth one point. They can move one step diagonally.<br/><br/>You're playing Dark, move a pawn.`,h6.getInitialState(),a6.from(new JX(1,2),new JX(2,3)).get(),(e,t)=>t.getPieceAt(e.end)===l6.PAWN?TW.SUCCESS:TW.failure($localize`This is not a pawn!`),$localize`Congratulations!`),kJ.fromPredicate($localize`Moving drones`,$localize`Drones are worth two points. They can move one or two steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a drone.`,h6.getInitialState(),a6.from(new JX(2,0),new JX(3,0)).get(),(e,t)=>t.getPieceAt(e.end)===l6.DRONE?TW.SUCCESS:TW.failure($localize`This is not a drone!`),$localize`Congratulations!`),kJ.fromPredicate($localize`Moving queens`,$localize`Queens are worth three points. They can move any number of steps in any direction, in a straight line, without jumping over other pieces.<br/><br/>You're playing Dark, move a queen.`,new h6([[y6,m6,g6,g6],[v6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,v6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[v6,y6,m6,g6]],0),a6.from(new JX(2,3),new JX(2,7)).get(),(e,t)=>t.getPieceAt(e.end)===l6.QUEEN?TW.SUCCESS:TW.failure($localize`This is not a queen!`),$localize`Congratulations!`),kJ.fromMove($localize`Capture`,$localize`When a piece crosses the canal and lands on another piece, you capture it and gain the value of that captured piece. However, you lose control of your piece as it crosses the canal!<br/><br/>A capture is possible for Dark, do it.`,new h6([[y6,m6,m6,g6],[g6,g6,g6,g6],[v6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,m6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,y6,m6,g6]],0),[a6.from(new JX(0,2),new JX(2,4)).get()],$localize`Congratulations! By capturing that pawn, you won one point.`,f6.YOU_DID_NOT_CAPTURE_ANY_PIECE()),kJ.fromMove($localize`Field Promotion (1/2)`,$localize`It is sometimes possible to perform what is called a field promotion. If you are out of one type of piece, you can merge two pieces to add their value and get a new piece. For example, if you have no drones, you can merge two pawns into a drone. To merge two pawns, move one of your pawns on another.<br/><br/>Such a move is possible for Dark. Do it.`,new h6([[g6,g6,g6,v6],[g6,m6,g6,g6],[g6,g6,m6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,v6],[g6,g6,y6,g6],[g6,m6,g6,g6]],0),[a6.from(new JX(1,1),new JX(2,2)).get(),a6.from(new JX(2,2),new JX(1,1)).get()],$localize`Congratulations!`,_6()),kJ.fromPredicate($localize`Field Promotion (2/2)`,$localize`The other kind of field promotion is to merge a drone and a pawn to obtain a queen.<br/><br/>Such a move is possible for Light. Do it.`,new h6([[m6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,y6,g6],[g6,m6,g6,g6]],1),a6.from(new JX(1,7),new JX(2,6)).get(),(e,t)=>t.getPieceAt(e.end)===l6.QUEEN?TW.SUCCESS:TW.failure(_6()),$localize`Congratulations!`),kJ.fromPredicate($localize`Call the clock`,$localize`When the game seems to be going nowhere, you can "call the clock" during your turn. To do so, click on the clock symbol on the right, then perform your move. Once the clock is called, seven more turn will be played.<br/><br/>You're playing Dark. Call the clock and perform a move.`,h6.getInitialState(),a6.from(new JX(2,2),new JX(3,3),!0).get(),(e,t)=>e.calledTheClock?TW.SUCCESS:TW.failure($localize`You did not call the clock!`),$localize`Congratulations!`),kJ.fromMove($localize`Restarting the clock`,$localize`If the clock has been called, whenever a capture is done the countdown restarts.<br/><br/>You are playing Dark, do a capture to restart the countdown.`,new h6([[g6,g6,g6,g6],[g6,m6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,m6],[g6,g6,y6,g6],[g6,m6,g6,g6]],14,Mw.empty(),Mw.of(1)),[a6.from(new JX(1,1),new JX(2,2)).get()],$localize`Congratulations!`,$localize`This is not a capture, the game is now over, please retry!`),kJ.anyMove($localize`End game (by clock)`,$localize`When seven turns have passed after the clock has been called, the player with the most points win. If both player have the same number of points, it is a tie.<br/><br/>You are playing Dark, do the last move.`,new h6([[g6,g6,g6,v6],[g6,m6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[y6,g6,g6,g6],[g6,g6,g6,g6],[g6,y6,g6,g6]],14,Mw.empty(),Mw.of(1)),a6.from(new JX(1,1),new JX(2,2)).get(),$localize`Congratulations!`),kJ.fromPredicate($localize`End by emptyness`,$localize`When a player's last piece is moved into the opponent territory, the game ends. If both players have the same number of points, the last player win!<br/><br/>Light player can win this way, do it!`,new h6([[g6,g6,g6,v6],[g6,m6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,m6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6],[g6,g6,g6,g6]],1),a6.from(new JX(2,4),new JX(1,3)).get(),(e,t)=>3===e.end.y?TW.SUCCESS:TW.failure($localize`Your piece is still in you territory!`),$localize`Congratulations!`)]}}function E6(e,t){if(1&e&&(Cn(),ga(0,"g",20)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Va(n.style),Ia("mainShapeId","pawn_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function w6(e,t){if(1&e&&(Cn(),ga(0,"g",21)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Va(n.style),Ia("mainShapeId","drone_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function b6(e,t){if(1&e&&(Cn(),ga(0,"g",22)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Va(n.style),Ia("mainShapeId","queen_",e,"_",t,""),ha("pieceClasses",n.getPieceClasses(e,t))}}function S6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,E6,1,5,"g",17),la(2,w6,1,5,"g",18),la(3,b6,1,5,"g",19),fa()),2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();ra("transform",i.getPieceLocation(t,r)),Ts(1),ha("ngIf",n===i.pieces.PAWN),Ts(1),ha("ngIf",n===i.pieces.DRONE),Ts(1),ha("ngIf",n===i.pieces.QUEEN)}}function P6(e,t){if(1&e){const e=va();Cn(),pa(0,"g",15),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),ga(1,"rect",16),la(2,S6,4,4,"g",14),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ia("id","click_",n,"_",r,""),ra("transform","translate(0,  "+(r<=3?0:2*i.STROKE_WIDTH)+")"),Ts(1),Ia("id","square_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",n*i.SPACE_SIZE)("y",r*i.SPACE_SIZE)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.pieces.EMPTY)}}function O6(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",23),Ea("click",function(){const t=Gt(e).$implicit;return Sa(3).onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa(3);Ts(1),Ia("id","indicator_",e.x,"_",e.y,""),ra("transform","translate(0,  "+(e.y<=3?0:2*n.STROKE_WIDTH)+")")("x",e.x*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("y",e.y*n.SPACE_SIZE+(n.SPACE_SIZE/2-n.INDICATOR_SIZE/2))("width",n.INDICATOR_SIZE)("height",n.INDICATOR_SIZE)}}function T6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O6,2,7,"g",1),fa()),2&e){const e=Sa(2);Ts(1),ha("ngForOf",e.selectedPieceInfo.get().legalLandings)}}function I6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,P6,3,11,"g",13),la(2,T6,2,1,"g",14),fa()),2&e){const e=t.$implicit,n=Sa();ra("transform","translate("+n.SPACE_SIZE+", 0)"),Ts(1),ha("ngForOf",e),Ts(1),ha("ngIf",n.selectedPieceInfo.isPresent())}}function k6(e,t){if(1&e&&(Cn(),pa(0,"text",24),Qa(1),fa()),2&e){const e=Sa();ha("ngClass","player"+e.getCurrentPlayer().value)("ngClass",e.getClockCircleClasses()),ra("x",.5*e.SPACE_SIZE)("y",.5*e.SPACE_SIZE),Ts(1),Xa(e.countDown.get())}}function A6(e,t){if(1&e&&(Cn(),ga(0,"polyline",25)),2&e){const e=Sa();ha("ngClass",e.getClockCircleClasses()),ra("points",e.clockNeedlesPoints)}}const M6=function(e){return[e]};function N6(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"g",28),Ea("click",function(){const t=Gt(e).index;return Sa(2).chooseStyle(t)}),fa(),ya()}if(2&e){const e=t.$implicit,n=t.index,r=Sa(2);Ts(1),Va(e.style),ha("id",e.name)("pieceClasses",bu(5,M6,"player"+r.getCurrentPlayer().value)),ra("transform","translate(0, "+-(n+1)*r.SPACE_SIZE+")")}}function R6(e,t){if(1&e&&(Cn(),pa(0,"g",26),ga(1,"rect",27),la(2,N6,2,7,"ng-container",1),fa()),2&e){const e=Sa();Ts(1),ra("x",0)("y",-e.listOfStyles.length*e.SPACE_SIZE)("width",1*e.SPACE_SIZE)("height",e.listOfStyles.length*e.SPACE_SIZE),Ts(1),ha("ngForOf",e.listOfStyles)}}function x6(e,t){if(1&e&&(Cn(),pa(0,"text",34),Qa(1),fa()),2&e){const e=Sa(2).$implicit,t=Sa().$implicit,n=Sa();ha("ngClass","player"+(0===t?1:0)),ra("x",n.SPACE_SIZE/2)("y",n.SPACE_SIZE/2),Ts(1),Xa(e+" x ")}}function D6(e,t){if(1&e&&(Cn(),ga(0,"g",35)),2&e){const e=Sa(3).$implicit;Va(Sa().style),ha("pieceClasses",bu(3,M6,"player"+(0===e?1:0)))}}function L6(e,t){if(1&e&&(Cn(),ga(0,"g",36)),2&e){const e=Sa(3).$implicit;Va(Sa().style),ha("pieceClasses",bu(3,M6,"player"+(0===e?1:0)))}}function F6(e,t){if(1&e&&(Cn(),ga(0,"g",37)),2&e){const e=Sa(3).$implicit;Va(Sa().style),ha("pieceClasses",bu(3,M6,"player"+(0===e?1:0)))}}function U6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,x6,2,4,"text",30),pa(2,"g",29),la(3,D6,1,5,"g",31),la(4,L6,1,5,"g",32),la(5,F6,1,5,"g",33),fa(),fa()),2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().$implicit,i=Sa();ra("transform","translate(0, "+2*t*i.SPACE_SIZE+")"),Ts(1),ha("ngIf",n>1),Ts(1),Ia("id","piece_",t,"_player_",r,""),ra("transform","translate("+i.SPACE_SIZE+", 0)"),Ts(1),ha("ngIf",0===t),Ts(1),ha("ngIf",1===t),Ts(1),ha("ngIf",2===t)}}function B6(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,U6,6,8,"g",14),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",e>0)}}function V6(e,t){if(1&e&&(Cn(),pa(0,"g"),pa(1,"g",29),la(2,B6,2,1,"g",1),fa(),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),Ta("id","capture_of_player_",e,""),ra("transform","scale(0.5, 0.5) translate("+-n.SPACE_SIZE/2+", "+(n.SPACE_SIZE/2+e*(10*n.SPACE_SIZE+4*n.STROKE_WIDTH))+")"),Ts(1),ha("ngForOf",n.state.getCapturesOf(e))}}const $6=function(){return[0,1]};let z6=(()=>{class e extends u1{constructor(t){super(t),this.INDICATOR_SIZE=20,this.LEFT=e.SPACE_SIZE/-4+e.STROKE_WIDTH/-2,this.UP=-e.STROKE_WIDTH/2,this.WIDTH=6.5*e.SPACE_SIZE+e.STROKE_WIDTH,this.HEIGHT=8*e.SPACE_SIZE+3*e.STROKE_WIDTH,this.MartianChessComponent=e,this.style={shape:"Circle",points:"Horizontal Points"},this.pieces=l6,this.selectedPieceInfo=Mw.empty(),this.countDown=Mw.empty(),this.callTheClock=!1,this.displayModePanel=!1,this.listOfStyles=[{name:"Star",style:{shape:"Star",points:"Dots"}},{name:"Polygon",style:{shape:"Polygon",points:"Concentric Circles"}},{name:"Simple",style:{shape:"Circle",points:"Horizontal Points"}},{name:"Circely",style:{shape:"Circle",points:"Concentric Circles"}}],this.rules=new p6(h6),this.availableMinimaxes=[new c6(this.rules,"Martian Chess Dummy Minimax")],this.SPACE_SIZE=e.SPACE_SIZE,this.configCogTransformation=this.getConfigCogTransformation(),this.configViewTranslation=this.getConfigViewTranslation(),this.clockNeedlesPoints=this.getClockNeedlesPoints(),this.encoder=a6.encoder,this.tutorial=(new C6).tutorial,this.scores=Mw.of([0,0]),this.updateBoard()}static getRegularPolygon(t,n=0){const r=e.getRegularPolygonCoords(t,n);return e.mapCoordsToString(r)}static getNPointedStar(t,n){const r=this.getNPointedStarCoords(t,n);return e.mapCoordsToString(r)}static getNPointedStarCoords(t,n){const r=[],i=.5*e.SPACE_SIZE,s=.5*e.SPACE_SIZE;t*=2;for(let o=0;o<t;o++){const a=(o*(360/t)+n)/180*Math.PI,l=o%2==0?e.SPACE_SIZE/2:e.SPACE_SIZE/6,c=i+.8*l*Math.cos(a),u=s+.8*l*Math.sin(a);r.push(new JX(c,u))}return r}static getRegularPolygonCoords(t,n=0){const r=[],i=.5*e.SPACE_SIZE,s=.5*e.SPACE_SIZE;for(let o=0;o<t;o++){const a=(o*(360/t)-90)/180*Math.PI,l=.5*e.SPACE_SIZE,c=i+.8*l*Math.cos(a),u=s+.8*l*Math.sin(a)+n;r.push(new JX(c,u))}return r}static mapCoordsToString(e){let t="";for(const n of e)t+=n.x+", "+n.y+" ";return t}static getRadius(e){return this.SPACE_SIZE*e/10}getConfigViewTranslation(){return"translate("+(5.25*this.SPACE_SIZE+0)+", "+(7*this.SPACE_SIZE+0+2*this.STROKE_WIDTH)+")"}getConfigCogTransformation(){const e=this.STROKE_WIDTH,t=(this.SPACE_SIZE-e)/40;return"translate("+1*e+", "+1*e+") scale("+t+" "+t+")"}getClockNeedlesPoints(){const e=.5*this.SPACE_SIZE;return e+" "+.1*this.SPACE_SIZE+", "+e+" "+e+", "+.75*this.SPACE_SIZE+" "+e}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board;const e=this.state.getScoreOf(BK.ZERO),t=this.state.getScoreOf(BK.ONE);this.countDown=this.state.countDown,this.scores=Mw.of([e,t])}getPieceLocation(e,t){return"translate("+this.SPACE_SIZE*e+", "+this.SPACE_SIZE*t+")"}getPieceClasses(e,t){const n=new JX(e,t),r=[];return r.push(t<=3?"player0":"player1"),this.selectedPieceInfo.isPresent()&&this.selectedPieceInfo.get().selectedPiece.equals(n)&&r.push("highlighted"),this.rules.node.move.isPresent()&&this.rules.node.move.get().end.equals(n)&&this.rules.node.mother.get().gameState.getPieceAt(n)!==l6.EMPTY&&this.rules.node.gameState.isInOpponentTerritory(new JX(0,t))&&r.push("highlighted"),r}onClick(e,t){var n=this;return Pw(function*(){n.displayModePanel=!1;const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new JX(e,t);return n.selectedPieceInfo.isPresent()?n.secondClick(i):n.firstClick(i)})()}firstClick(e){var t=this;return Pw(function*(){return t.isOneOfUsersPieces(e)?t.selectAsFirstPiece(e):(t.cancelMoveAttempt(),TW.SUCCESS)})()}selectAsFirstPiece(e){var t=this;return Pw(function*(){const n=t.getLegalLandings(e);return t.selectedPieceInfo=Mw.of({selectedPiece:e,legalLandings:n}),TW.SUCCESS})()}getLegalLandings(e){const t=this.state.getPieceAt(e);let n;return n=t===l6.PAWN?KX.DIAGONALS.map(t=>e.getNext(t)):this.getValidLinearLandingSquareUntil(e,t===l6.DRONE?2:8),n.filter(t=>{const n=a6.from(e,t);return!!n.isSuccess()&&this.rules.isLegal(n.get(),this.getState()).isSuccess()})}getValidLinearLandingSquareUntil(e,t){return KX.DIRECTIONS.flatMap(n=>{const r=[];let i=e.getNext(n),s=1;for(;i.isInRange(4,8)&&s<=t&&(r.push(i),this.getState().getPieceAt(i)===l6.EMPTY);)i=i.getNext(n),s++;return r})}secondClick(e){var t=this;return Pw(function*(){const n=t.selectedPieceInfo.get();if(n.selectedPiece.equals(e))return t.cancelMoveAttempt(),TW.SUCCESS;if(n.legalLandings.some(t=>t.equals(e))){const r=a6.from(n.selectedPiece,e,t.callTheClock);NW(r.isSuccess(),"MartianChessComponent or Rules did a mistake thinking this would have been a legal move!");const i=t.rules.node.gameState;return t.chooseMove(r.get(),i)}if(t.isOneOfUsersPieces(e))return t.selectAsFirstPiece(e);{const r=a6.from(n.selectedPiece,e,t.callTheClock);return r.isSuccess()?t.chooseMove(r.get(),t.getState()):t.cancelMove(r.getReason())}})()}isOneOfUsersPieces(e){return this.state.getPieceAt(e)!==l6.EMPTY&&this.state.isInPlayerTerritory(e)}cancelMoveAttempt(){this.selectedPieceInfo=Mw.empty(),this.callTheClock=!1}onClockClick(){var e=this;return Pw(function*(){const t=e.canUserPlay("#clockOrCountDownView");return t.isFailure()?e.cancelMove(t.getReason()):(e.getState().countDown.isAbsent()&&(e.callTheClock=!e.callTheClock),TW.SUCCESS)})()}getClockCircleClasses(){const e=["base"];return this.callTheClock&&e.push("highlighted"),this.getCurrentPlayer()===BK.ZERO?e.push("player0-stroke"):e.push("player1-stroke"),e}getSquareClasses(e,t){const n=new JX(e,t),r=["base"];if(this.rules.node.move.isPresent()){const e=this.rules.node,i=e.move.get();i.coord.equals(n)?r.push("moved"):i.end.equals(n)&&(e.mother.get().gameState.getPieceAt(n)===l6.EMPTY||e.gameState.isInOpponentTerritory(new JX(0,t))?r.push("moved"):r.push("captured"))}return r}onModeCogClick(){this.displayModePanel=!this.displayModePanel}chooseStyle(e){this.style=this.listOfStyles[e].style,this.displayModePanel=!1}}return e.SPACE_SIZE=100,e.STROKE_WIDTH=8,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-martian-chess"]],features:[Go],decls:15,vars:25,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["id","clockOrCountDownView",3,"click"],["x","0","y","0",1,"transparent"],["id","clockOrCountDownCircle",3,"ngClass"],["id","countDownText","class","text-giant text-center",3,"ngClass",4,"ngIf"],["class","base","stroke-linecap","round",3,"ngClass",4,"ngIf"],["id","canal",3,"ngClass"],["id","modeCogView"],["id","modeCog",3,"click"],["d","M35.497,15.111h-1.656c-0.282-0.924-0.653-1.807-1.102-2.646l1.176-1.175c1.364-1.366,1.366-3.582,0-4.949l-1.258-1.258 c-0.656-0.656-1.548-1.025-2.476-1.025l0,0c-0.93,0-1.818,0.369-2.477,1.025l-1.176,1.175c-0.838-0.446-1.721-0.817-2.645-1.102 V3.501c0-1.934-1.566-3.5-3.5-3.5h-1.778c-1.934,0-3.5,1.566-3.5,3.5v1.655c-0.923,0.282-1.807,0.653-2.645,1.102l-1.174-1.175 c-1.367-1.367-3.584-1.367-4.951,0L5.081,6.34c-1.367,1.366-1.367,3.583,0,4.949l1.174,1.175c-0.446,0.84-0.818,1.723-1.102,2.646 H3.5c-1.934,0-3.5,1.566-3.5,3.5v1.778c0,1.932,1.566,3.5,3.5,3.5h1.654c0.283,0.922,0.654,1.807,1.102,2.645l-1.175,1.176 c-1.366,1.365-1.366,3.582-0.001,4.949l1.258,1.258c0.656,0.654,1.547,1.023,2.475,1.023h0.001c0.929,0,1.818-0.369,2.475-1.023 l1.176-1.176c0.837,0.447,1.722,0.818,2.644,1.102v1.656c0,1.932,1.566,3.5,3.5,3.5h1.778c1.934,0,3.5-1.568,3.5-3.5v-1.656 c0.924-0.283,1.807-0.654,2.645-1.102l1.177,1.176c0.655,0.656,1.547,1.023,2.476,1.023c0.93,0,1.817-0.369,2.477-1.023 l1.256-1.258c1.366-1.367,1.365-3.582,0-4.949l-1.176-1.174c0.447-0.84,0.818-1.725,1.102-2.646h1.656c1.934,0,3.5-1.568,3.5-3.5 v-1.777C38.997,16.679,37.43,15.111,35.497,15.111z M19.499,27.499c-4.41,0-8-3.588-8-8c0-4.411,3.59-8,8-8c4.412,0,8,3.589,8,8 C27.499,23.911,23.911,27.499,19.499,27.499z",3,"ngClass"],["id","modePanel",4,"ngIf"],["id","captures"],[3,"id","click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"id","click"],[3,"id","ngClass"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId","style",4,"ngIf"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses","style",4,"ngIf"],["app-martian-chess-pawn","",3,"mainShapeId","pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses","mainShapeId"],["app-martian-chess-queen","",3,"mainShapeId","pieceClasses"],[1,"indicator",3,"id","click"],["id","countDownText",1,"text-giant","text-center",3,"ngClass"],["stroke-linecap","round",1,"base",3,"ngClass"],["id","modePanel"],["stroke-width","8",1,"base"],["app-martian-chess-queen","",3,"id","pieceClasses","click"],[3,"id"],["class","text-giant text-center",3,"ngClass",4,"ngIf"],["app-martian-chess-pawn","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-drone","",3,"pieceClasses","style",4,"ngIf"],["app-martian-chess-queen","",3,"pieceClasses","style",4,"ngIf"],[1,"text-giant","text-center",3,"ngClass"],["app-martian-chess-pawn","",3,"pieceClasses"],["app-martian-chess-drone","",3,"pieceClasses"],["app-martian-chess-queen","",3,"pieceClasses"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,I6,3,3,"g",1),pa(2,"g",2),Ea("click",function(){return t.onClockClick()}),ga(3,"rect",3),ga(4,"circle",4),la(5,k6,2,5,"text",5),la(6,A6,1,2,"polyline",6),fa(),ga(7,"line",7),pa(8,"g",8),pa(9,"g",9),Ea("click",function(){return t.onModeCogClick()}),ga(10,"rect",3),ga(11,"path",10),fa(),la(12,R6,3,5,"g",11),fa(),pa(13,"g",12),la(14,V6,3,3,"g",1),fa(),fa()),2&e&&(ra("viewBox",t.LEFT+" "+t.UP+" "+t.WIDTH+" "+t.HEIGHT),Ts(1),ha("ngForOf",t.board),Ts(1),ra("transform","translate("+5.25*t.SPACE_SIZE+", 0)"),Ts(1),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngClass",t.getClockCircleClasses()),ra("cx",.5*t.SPACE_SIZE)("cy",.5*t.SPACE_SIZE)("r",.4*t.SPACE_SIZE),Ts(1),ha("ngIf",t.countDown.isPresent()),Ts(1),ha("ngIf",t.countDown.isAbsent()),Ts(1),ha("ngClass","player"+t.getCurrentPlayer().value),ra("x1",t.SPACE_SIZE)("y1",5*t.SPACE_SIZE+8)("x2",5*t.SPACE_SIZE)("y2",5*t.SPACE_SIZE+8)("stroke-width",2*t.STROKE_WIDTH),Ts(1),ra("transform",t.configViewTranslation),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngClass","player"+t.getCurrentPlayer().value),ra("transform",t.configCogTransformation),Ts(1),ha("ngIf",t.displayModePanel),Ts(2),ha("ngForOf",wu(24,$6)))},styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();const H6=Number.MAX_SAFE_INTEGER,G6=Number.MIN_SAFE_INTEGER;class W6 extends fJ{constructor(e,t){super(GK.copyBiArray(W6.initialBoard),e),this.turn=e,this.location=t}static getInitialState(){return new W6(0,new JX(0,0))}}W6.BOARD_0=[[6,4,3,1],[4,4,3,1],[3,3,2,0],[1,1,0,0]],W6.BOARD_1=[[0,+H6,-1,-1],[1,2,+H6,-1],[+G6,3,4,-1],[-1,+G6,+G6,-1]],W6.BOARD_2=[[0,+H6,-1,-1],[+H6,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],W6.BOARD_3=[[0,1,+G6,-1],[1,+G6,-1,-1],[+G6,-1,-1,-1],[-1,-1,-1,-1]],W6.BOARD_4=[[0,1,+G6,-1],[1,+G6,-1,-1],[+G6,-1,-1,-1],[-1,-1,-1,1]],W6.initialBoard=W6.BOARD_0;class q6 extends PJ{static getGameStatus(e){const t=e.gameState,n=t.getPieceAt(t.location);return n===BK.ZERO.getVictoryValue()?SJ.ZERO_WON:n===BK.ONE.getVictoryValue()?SJ.ONE_WON:t.location.equals(new JX(3,3))?0===n?SJ.DRAW:n>0?SJ.ONE_WON:SJ.ZERO_WON:SJ.ONGOING}applyLegalMove(e,t,n){const r=new JX(t.location.x+(!0===e.right?1:0),t.location.y+(!1===e.right?1:0));return new W6(t.turn+1,r)}isLegal(e,t){const n=t.location,r=t.getCopiedBoard();return n.x+1===r[0].length&&!0===e.right||n.y+1===r.length&&!1===e.right?SW.failure("incorrect move"):SW.success(void 0)}getGameStatus(e){return q6.getGameStatus(e)}}class j6 extends mJ{constructor(e){super(),this.right=e}equals(e){return this===e||this.right===e.right}toString(){return this.right?"Move RIGHT":"Move DOWN"}}j6.RIGHT=new j6(!0),j6.DOWN=new j6(!1),j6.encoder=new class extends FK{maxValue(){return 1}decodeNumber(e){return 0===e?j6.RIGHT:j6.DOWN}encodeNumber(e){return e.right?0:1}};class Z6 extends cJ{getBoardValue(e){const t=q6.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());const n=e.gameState;return new uJ(n.getPieceAt(n.location))}getListMoves(e){const t=[],n=e.gameState;return n.location.x<3&&t.push(j6.RIGHT),n.location.y<3&&t.push(j6.DOWN),t}}function Y6(e,t){1&e&&(ma(0),Qa(1,"("),ya())}function K6(e,t){1&e&&(ma(0),Qa(1,")"),ya())}function Q6(e,t){if(1&e&&(pa(0,"td"),la(1,Y6,2,0,"ng-container",3),Qa(2),la(3,K6,2,0,"ng-container",3),fa()),2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r),Ts(1),Ja(" ",e," "),Ts(1),ha("ngIf",i.coord.x===n&&i.coord.y===r)}}function X6(e,t){if(1&e&&(pa(0,"tr"),la(1,Q6,4,3,"td",0),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let J6=(()=>{class e extends u1{constructor(e){super(e),this.coord=new JX(-1,-1),this.rules=new q6(W6),this.availableMinimaxes=[new Z6(this.rules,"MinimaxTestingMinimax")],this.encoder=j6.encoder}chooseRight(){var e=this;return Pw(function*(){const t=e.canUserPlay("#click_right");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(j6.RIGHT,e.rules.node.gameState)})()}chooseDown(){var e=this;return Pw(function*(){const t=e.canUserPlay("#click_down");return t.isFailure()?e.cancelMove(t.getReason()):e.chooseMove(j6.DOWN,e.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.coord=e.location}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-minimax-testing"]],features:[Go],decls:8,vars:2,consts:[[4,"ngFor","ngForOf"],["id","click_right",3,"click"],["id","click_down",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(pa(0,"table"),la(1,X6,2,1,"tr",0),pa(2,"div",1),Ea("click",function(){return t.chooseRight()}),Qa(3," goRight "),fa(),pa(4,"div",2),Ea("click",function(){return t.chooseDown()}),Qa(5," goDown "),fa(),pa(6,"div"),Qa(7),fa(),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(6),Ja(" ",t.coord," "))},directives:[tp,rp],encapsulation:2}),e})();class e8 extends fJ{static getInitialState(){const e=GK.createTable(7,6,VK.NONE);return new e8(e,0)}}class t8 extends mJ{constructor(e){super(),this.x=e}static of(e){switch(e){case 0:return t8.ZERO;case 1:return t8.ONE;case 2:return t8.TWO;case 3:return t8.THREE;case 4:return t8.FOUR;case 5:return t8.FIVE;case 6:return t8.SIX;default:throw new Error("Invalid P4Move")}}equals(e){return this===e}toString(){return"P4Move("+this.x+")"}}t8.ZERO=new t8(0),t8.ONE=new t8(1),t8.TWO=new t8(2),t8.THREE=new t8(3),t8.FOUR=new t8(4),t8.FIVE=new t8(5),t8.SIX=new t8(6),t8.encoder=new class extends FK{maxValue(){return 6}encodeNumber(e){return e.x}decodeNumber(e){return t8.of(e)}};let n8=(()=>{class e{}return e.COLUMN_IS_FULL=()=>$localize`Please put your piece in an incomplete column.`,e})(),r8=(()=>{class e extends PJ{static getVictoriousCoords(t){const n=[];for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new JX(r,i));(s===BK.ZERO.getVictoryValue()||s===BK.ONE.getVictoryValue())&&n.push(new JX(r,i))}return n}static getBoardValueFromScratch(t){Tw(e.VERBOSE,{P4Rules_getBoardValueFromScratch:{state:t}});let n=0;for(let r=0;r<7;r++)for(let i=5;-1!==i&&t.board[i][r].isPlayer();i--){const s=e.getSquareScore(t.board,new JX(r,i));if(bJ.getScoreStatus(s)!==_J.DEFAULT)return Tw(e.VERBOSE,{preVictoryOrVictory:{state:t,tmpScore:s,coord:{x:r,y:i}}}),new uJ(s);n+=s}return new uJ(n)}static getLowestUnoccupiedCase(e,t){let n=0;for(;n<6&&e[n][t]===VK.NONE;)n++;return n-1}static getNumberOfFreeSpacesAndAllies(e,t,n,r,i){let s=0,o=0,a=!0,l=new JX(t.x+n.x,t.y+n.y);for(;l.isInRange(7,6)&&3!==s;){const t=e[l.y][l.x];if(t===r)return[s,o];t===i&&a?o++:a=!1,t!==r&&t!==i&&s++,l=l.getNext(n)}return[s,o]}static getOpponent(e,t){const n=e[t.y][t.x];return NW(n.isPlayer(),"getOpponent should not be called with PlayerOrNone.NONE"),n===BK.ONE?BK.ZERO:BK.ONE}static getSquareScore(t,n){Tw(e.VERBOSE,"getSquareScore(board, "+n.x+", "+n.y+") called"),Tw(e.VERBOSE,t);let r=0;const i=e.getOpponent(t,n),s=i.getOpponent(),o=new CJ,a=new CJ;for(const l of KX.DIRECTIONS){const r=e.getNumberOfFreeSpacesAndAllies(t,n,l,i,s);o.set(l,r[0]),a.set(l,r[1])}for(const l of[KX.UP,KX.UP_RIGHT,KX.RIGHT,KX.DOWN_RIGHT]){const i=a.get(l).get()+a.get(l.getOpposite()).get();if(i>2)return Tw(e.VERBOSE,{text:"there is some kind of victory here ("+n.x+", "+n.y+")\nline allies : "+i+"\n",board:t}),s.getVictoryValue();const c=o.get(l).get()+o.get(l.getOpposite()).get();3===c?r+=2:c>3&&(r+=c-2)}return r*s.getScoreModifier()}static getListMoves(t){Tw(e.VERBOSE,{context:"P4Rules.getListMoves",node:t});const n=t.gameState,r=[];for(let e=0;e<7;e++)if(n.getPieceAtXY(e,0)===VK.NONE){const t=t8.of(e);r.push(t)}return r}static getBoardValue(t){return Tw(e.VERBOSE,{text:"P4Rules.getBoardValue called",board:t.getCopiedBoard()}),e.getBoardValueFromScratch(t)}applyLegalMove(t,n,r){const i=t.x,s=n.getCopiedBoard(),o=e.getLowestUnoccupiedCase(s,i),a=n.turn;return s[o][i]=n.getCurrentPlayer(),new e8(s,a+1)}isLegal(t,n){return Tw(e.VERBOSE,{context:"P4Rules.isLegal",move:t.toString(),state:n}),n.getPieceAtXY(t.x,0).isPlayer()?SW.failure(n8.COLUMN_IS_FULL()):SW.success(void 0)}getGameStatus(t){const n=t.gameState;for(let r=0;r<7;r++)for(let t=5;t>=0&&n.board[t][r].isPlayer();t--){const i=e.getSquareScore(n.board,new JX(r,t));if(bJ.getScoreStatus(i)===_J.VICTORY)return SJ.getVictory(n.getCurrentOpponent())}return 42===n.turn?SJ.DRAW:SJ.ONGOING}}return e.VERBOSE=!1,e})();class i8 extends cJ{getListMoves(e){return r8.getListMoves(e)}getBoardValue(e){const t=e.gameState;return Tw(r8.VERBOSE,{text:"P4Rules instance methods getBoardValue called",board:t.getCopiedBoard()}),r8.getBoardValue(t)}}const s8=BK.ZERO,o8=BK.ONE,a8=VK.NONE;class l8{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`The board at Four in a Row is made of 7 columns and 6 rows, and it is initially empty.
        The first player plays Dark, the second plays Light.
        The goal is to be the first to align 4 of its pieces (horizontally, vertically, or diagonally).`,e8.getInitialState()),kJ.anyMove($localize`Dropping a piece`,$localize`Click on any space in any column.`,e8.getInitialState(),t8.THREE,$localize`As you can see, the piece falls at the bottom of the column.`),kJ.fromMove($localize`Victory`,$localize`You're playing Dark.
        Place your piece so that you create a horizontal alignment of 4 of your pieces.`,new e8([[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,o8,a8,a8,a8],[a8,a8,a8,o8,a8,a8,a8],[a8,a8,s8,s8,s8,o8,a8]],0),[t8.of(1)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`),kJ.fromMove($localize`Other victory`,$localize`You can also align 4 pieces diagonally or vertically.`,new e8([[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,a8,a8,a8,a8],[a8,a8,a8,s8,o8,a8,a8],[a8,a8,s8,s8,o8,a8,a8],[a8,s8,o8,s8,s8,a8,a8]],0),[t8.of(3),t8.of(4)],$localize`You won!`,$localize`Failed, you have not aligned 4 pieces and missed an opportunity to win.`)]}}function c8(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=Sa().index,t=Sa().index,n=Sa();ha("ngClass",n.getSquareFillClass(e,t)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)}}function u8(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){const t=Gt(e).index;return Sa(2).onClick(t)}),ga(1,"rect",6),la(2,c8,1,4,"circle",7),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ta("id","click_",n,""),Ts(1),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY_CASE)}}function h8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,u8,3,6,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function d8(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=Sa();ra("x",e.SPACE_SIZE*e.last.get().x)("y",e.SPACE_SIZE*e.last.get().y)("width",e.SPACE_SIZE)("height",e.SPACE_SIZE)}}function p8(e,t){if(1&e&&(Cn(),ga(0,"rect",10)),2&e){const e=t.$implicit,n=Sa();Ia("id","victory_coord_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let f8=(()=>{class e extends u1{constructor(e){super(e),this.EMPTY_CASE=VK.NONE,this.victoryCoords=[],this.rules=new r8(e8),this.availableMinimaxes=[new i8(this.rules,"P4Minimax")],this.encoder=t8.encoder,this.tutorial=(new l8).tutorial,this.updateBoard()}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e);if(n.isFailure())return t.cancelMove(n.getReason());const r=t8.of(e);return yield t.chooseMove(r,t.rules.node.gameState)})()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.victoryCoords=r8.getVictoriousCoords(e),this.board=e.board,t.isPresent()?this.showLastMove():this.hideLastMove()}showLastMove(){const e=this.rules.node.move,t=r8.getLowestUnoccupiedCase(this.rules.node.gameState.board,e.get().x)+1;this.last=Mw.of(new JX(e.get().x,t))}hideLastMove(){this.last=Mw.empty()}getSquareFillClass(e,t){return[this.getPlayerClass(this.board[t][e])]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-p4"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 708 608","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["class","base no-fill last-move mid-stroke",4,"ngIf"],["class","base no-fill victory-stroke mid-stroke",3,"id",4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base"],["class","base","pointer-events","fill",3,"ngClass",4,"ngIf"],["pointer-events","fill",1,"base",3,"ngClass"],[1,"base","no-fill","last-move","mid-stroke"],[1,"base","no-fill","victory-stroke","mid-stroke",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,h8,2,1,"g",1),la(2,d8,1,4,"rect",2),la(3,p8,1,6,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.last.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class g8 extends yJ{constructor(e,t,n,r=!1){if(super(e,t),this.blockTurned=n,this.turnedClockwise=r,this.coord.isNotInRange(6,6))throw new Error("The board is a 6 cas wide square, invalid coord: "+this.coord.toString())}static withRotation(e,t,n,r){if(n<0||3<n)throw new Error("This block do not exist: "+n);return new g8(e,t,Mw.of(n),r)}static rotationless(e,t){return new g8(e,t,Mw.empty())}toString(){return this.blockTurned.isPresent()?"PentagoMove("+this.coord.toString()+", "+this.blockTurned.get()+", "+(this.turnedClockwise?"CLOCKWISE":"ANTI-CLOCKWISE")+")":"PentagoMove"+this.coord.toString()}equals(e){return!1!==this.coord.equals(e.coord)&&!1!==this.blockTurned.equals(e.blockTurned)&&this.turnedClockwise===e.turnedClockwise}}g8.encoder=new class extends LK{encodeMove(e){const t={coord:JX.encoder.encode(e.coord)};return e.blockTurned.isPresent()&&(t.blockTurned=e.blockTurned.get(),t.turnedClockwise=e.turnedClockwise),t}decodeMove(e){const t=e,n=JX.encoder.decode(t.coord),r=Mw.ofNullable(t.blockTurned);if(r.isPresent()){const e=t.turnedClockwise;return g8.withRotation(n.x,n.y,r.get(),e)}return g8.rotationless(n.x,n.y)}};let m8=(()=>{class e{}return e.CANNOT_ROTATE_NEUTRAL_BLOCK=()=>$localize`If the quadrant to turn is neutral, please just use move without rotation.`,e.MUST_CHOOSE_BLOCK_TO_ROTATE=()=>$localize`No quadrant is neutral, you must pick a quadrant to rotate.`,e})();class y8 extends fJ{constructor(e,t){super(e,t),this.neutralBlocks=this.getBlocksNeutralities()}static getInitialState(){const e=GK.createTable(6,6,VK.NONE);return new y8(e,0)}getBlocksNeutralities(){const e=[];for(let t=0;t<4;t++)this.getBlockNeutrality(t)&&e.push(t);return e}getBlockNeutrality(e){const t=y8.getBlockCenter(e),n=this.getPieceAt(t.getNext(KX.UP,1)),r=this.getPieceAt(t.getNext(KX.UP_LEFT,1));return this.getPieceAt(t.getNext(KX.RIGHT,1))===n&&this.getPieceAt(t.getNext(KX.DOWN,1))===n&&this.getPieceAt(t.getNext(KX.LEFT,1))===n&&this.getPieceAt(t.getNext(KX.UP_RIGHT,1))===r&&this.getPieceAt(t.getNext(KX.DOWN_RIGHT,1))===r&&this.getPieceAt(t.getNext(KX.DOWN_LEFT,1))===r}static getBlockCenter(e){return new JX(1+(e%2==0?0:3),1+(e<2?0:3))}applyLegalDrop(e){const t=this.getCopiedBoard();return t[e.coord.y][e.coord.x]=this.getCurrentPlayer(),new y8(t,this.turn)}applyLegalMove(e){const t=this.applyLegalDrop(e),n=t.getCopiedBoard();if(e.blockTurned.isPresent()){const r=y8.getBlockCenter(e.blockTurned.get());if(e.turnedClockwise)for(const e of y8.ROTATION_MAP){const i=e[0].getNext(r),s=e[1].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}else for(const e of y8.ROTATION_MAP){const i=e[1].getNext(r),s=e[0].getNext(r),o=t.getPieceAt(i);n[s.y][s.x]=o}}return new y8(n,this.turn+1)}blockIsNeutral(e){return this.neutralBlocks.includes(e)}}y8.ROTATION_MAP=[[new JX(-1,-1),new JX(1,-1)],[new JX(0,-1),new JX(1,0)],[new JX(1,-1),new JX(1,1)],[new JX(1,0),new JX(0,1)],[new JX(1,1),new JX(-1,1)],[new JX(0,1),new JX(-1,0)],[new JX(-1,1),new JX(-1,-1)],[new JX(-1,0),new JX(0,-1)]];class v8 extends PJ{static get(){return v8.singleton.isAbsent()&&(v8.singleton=Mw.of(new v8(y8))),v8.singleton.get()}applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){if(t.getPieceAt(e.coord).isPlayer())return SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE());const n=t.applyLegalDrop(e);if(0===n.neutralBlocks.length){if(e.blockTurned.isAbsent())return SW.failure(m8.MUST_CHOOSE_BLOCK_TO_ROTATE())}else if(e.blockTurned.isPresent()){const t=e.blockTurned.get();if(n.neutralBlocks.includes(t))return SW.failure(m8.CANNOT_ROTATE_NEUTRAL_BLOCK())}return SW.success(void 0)}getVictoryCoords(e){let t=[];for(const n of v8.VICTORY_SOURCE){const r=e.getPieceAt(n[0]),i=[n[0]];if(r.isPlayer()){let s=n[0].getNext(n[1]),o=!0;for(let t=0;t<3&&o;t++)e.getPieceAt(s)!==r?o=!1:(i.push(s),s=s.getNext(n[1]));if(o&&(e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i)),n[2])){const s=n[0].getPrevious(n[1],1);e.getPieceAt(s)===r&&(i.push(s),t=t.concat(i))}}}return t}getGameStatus(e){const t=e.gameState,n=this.getVictoryCoords(t),r=[!1,!1];for(let i=0;i<n.length;i+=5)r[t.getPieceAt(n[i]).value]=!0;return!0===r[0]?!0===r[1]?SJ.DRAW:SJ.ZERO_WON:!0===r[1]?SJ.ONE_WON:36===t.turn?SJ.DRAW:SJ.ONGOING}}v8.singleton=Mw.empty(),v8.VICTORY_SOURCE=[[new JX(1,0),new jX(1,1),!1],[new JX(0,1),new jX(1,1),!1],[new JX(4,0),new jX(-1,1),!1],[new JX(5,1),new jX(-1,1),!1],[new JX(1,1),new jX(1,1),!0],[new JX(4,1),new jX(-1,1),!0],[new JX(0,1),new jX(0,1),!0],[new JX(1,1),new jX(0,1),!0],[new JX(2,1),new jX(0,1),!0],[new JX(3,1),new jX(0,1),!0],[new JX(4,1),new jX(0,1),!0],[new JX(5,1),new jX(0,1),!0],[new JX(1,0),new jX(1,0),!0],[new JX(1,1),new jX(1,0),!0],[new JX(1,2),new jX(1,0),!0],[new JX(1,3),new jX(1,0),!0],[new JX(1,4),new jX(1,0),!0],[new JX(1,5),new jX(1,0),!0]];class _8 extends cJ{getListMoves(e){const t=[],n=e.gameState.neutralBlocks;if(0===e.gameState.turn)return _8.FIRST_TURN_MOVES;const r=this.getLegalDrops(e.gameState);for(const i of r){const r=g8.rotationless(i.x,i.y),s=e.gameState.applyLegalDrop(r),o=this.getLegalRotations(s,n);for(const e of o)t.push(g8.withRotation(i.x,i.y,e[0],e[1]));0===s.neutralBlocks.length==0&&t.push(r)}return t}getLegalDrops(e){const t=[];for(let n=0;n<6;n++)for(let r=0;r<6;r++){const i=new JX(r,n);e.getPieceAt(i)===VK.NONE&&t.push(i)}return t}getLegalRotations(e,t){const n=0===e.neutralBlocks.length,r=[];for(let i=0;i<4;i++)!1===e.blockIsNeutral(i)&&(t.includes(i)?n&&r.push([i,!0]):r.push([i,!0],[i,!1]));return r}getBoardValue(e){return new uJ(v8.get().getGameStatus(e).toBoardValue())}}_8.FIRST_TURN_MOVES=[g8.rotationless(0,0),g8.rotationless(1,0),g8.rotationless(2,0),g8.rotationless(0,1),g8.rotationless(1,1),g8.rotationless(0,2)];const C8=VK.NONE,E8=BK.ONE,w8=BK.ZERO;class b8{constructor(){this.tutorial=[kJ.informational($localize`Initial board`,$localize`The initial Pentago board is made of 6x6 spaces, subdivided in 4 quadrants, which can each rotate.`,y8.getInitialState()),kJ.informational($localize`Goal of the game`,$localize`The goal at Pentago is to align 5 of your pieces. In the following board, Dark wins.`,new y8([[w8,C8,C8,w8,E8,C8],[w8,E8,C8,C8,C8,C8],[w8,C8,E8,C8,C8,C8],[w8,C8,C8,C8,C8,E8],[w8,C8,C8,C8,E8,C8],[C8,C8,C8,C8,C8,C8]],10)).withPreviousMove(g8.withRotation(0,0,0,!1)),kJ.fromPredicate($localize`Simple move`,$localize`At their turn, players put a piece on the board and possibly rotate one quadrant.
        As long as there are neutral quadrants, i.e., quadrants that would not change after being rotated, a player may skip rotating a quadrant.
        To do this, you have to click on the crossed circle that appears at the center of the board when it is possible.<br/><br/>
        Do it.`,new y8([[C8,C8,C8,C8,C8,C8],[C8,w8,C8,C8,E8,C8],[C8,C8,C8,C8,C8,C8],[C8,C8,C8,C8,C8,C8],[C8,E8,C8,C8,w8,C8],[C8,C8,C8,C8,C8,C8]],10),g8.rotationless(2,2),(e,t)=>e.blockTurned.isPresent()?TW.failure($localize`You have made a move with a rotation. This tutorial step is about moves without rotations!`):TW.SUCCESS,$localize`Congratulations!`),kJ.fromPredicate($localize`Move with rotation`,$localize`After putting a piece, arrows will appear on non-neutral quadrants.<br/><br/>
        Click on one of them and see the rotation!`,new y8([[C8,C8,C8,C8,C8,C8],[C8,w8,C8,C8,E8,C8],[C8,C8,C8,C8,C8,C8],[C8,C8,C8,C8,C8,C8],[C8,E8,C8,C8,w8,C8],[C8,C8,C8,C8,C8,C8]],10),g8.withRotation(0,0,0,!0),(e,t)=>e.blockTurned.isPresent()?TW.SUCCESS:TW.failure($localize`You made a move without rotation, try again!`),$localize`Congratulations! Note that if all quadrants are neutral after you have put your piece, there will be no rotation.`)]}}function S8(e,t){if(1&e){const e=va();Cn(),ma(0),pa(1,"circle",9),Ea("click",function(){const t=Gt(e).$implicit,n=Sa().$implicit,r=Sa().index,i=Sa().index;return Sa().onClick(3*r+t,3*i+n)}),fa(),ya()}if(2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa(),i=r.index,s=r.$implicit,o=Sa(),a=o.index,l=o.$implicit,c=Sa();Ts(1),Ia("id","click_",3*i+e,"_",3*a+n,""),ha("ngClass",c.getSquareClasses(3*i+e,3*a+n)),ra("cx",s+2*c.STROKE_WIDTH+(e+.5)*c.SPACE_SIZE)("cy",l+2*c.STROKE_WIDTH+(n+.5)*c.SPACE_SIZE)("r",(c.SPACE_SIZE-c.STROKE_WIDTH)/2)}}const P8=function(){return[0,1,2]};function O8(e,t){1&e&&(Cn(),ma(0),la(1,S8,2,6,"ng-container",3),ya()),2&e&&(Ts(1),ha("ngForOf",wu(1,P8)))}function T8(e,t){if(1&e&&(Cn(),ma(0),ga(1,"rect",8),la(2,O8,2,2,"ng-container",3),ya()),2&e){const e=t.$implicit,n=t.index,r=Sa(),i=r.index,s=r.$implicit,o=Sa();Ts(1),ha("ngClass",o.getBlockClasses(n,i)),ra("x",o.STROKE_WIDTH+e)("y",o.STROKE_WIDTH+s)("rx",3*o.STROKE_WIDTH)("ry",3*o.STROKE_WIDTH)("width",o.BLOCK_WIDTH)("height",o.BLOCK_WIDTH),Ts(1),ha("ngForOf",wu(8,P8))}}const I8=function(e){return[0,e]};function k8(e,t){if(1&e&&(Cn(),ma(0),la(1,T8,3,9,"ng-container",3),ya()),2&e){const e=Sa();Ts(1),ha("ngForOf",bu(1,I8,e.BLOCK_SEPARATION))}}function A8(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa();Ia("id","currentDrop_",e.currentDrop.get().x,"_",e.currentDrop.get().y,""),ha("ngClass",e.getPlayerClass(e.rules.node.gameState.getCurrentPlayer())),ra("cx",e.getCenter(e.currentDrop.get().x))("cy",e.getCenter(e.currentDrop.get().y))("r",(e.SPACE_SIZE-e.STROKE_WIDTH)/2)}}function M8(e,t){if(1&e){const e=va();Cn(),pa(0,"path",11),Ea("click",function(){const t=Gt(e).$implicit;return Sa().rotate(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa();Ia("id","rotate_",e[1],"_",e[2]?"clockwise":"counterclockwise",""),ra("d",e[0])("stroke-width",2*n.STROKE_WIDTH)}}function N8(e,t){if(1&e&&(Cn(),ga(0,"circle",12)),2&e){const e=t.$implicit,n=Sa();Ia("id","victoryCoord_",e.x,"_",e.y,""),ha("ngClass",n.getSquareClasses(e.x,e.y)),ra("cx",n.getCenter(e.x))("cy",n.getCenter(e.y))("r",(n.SPACE_SIZE-n.STROKE_WIDTH)/2)("stroke-width",n.STROKE_WIDTH)}}function R8(e,t){if(1&e){const e=va();Cn(),pa(0,"g",13),Ea("click",function(){return Gt(e),Sa().skipRotation()}),ga(1,"circle",14),ga(2,"line",15),fa()}if(2&e){const e=Sa();Ts(1),ra("cx",e.BLOCK_SEPARATION)("cy",e.BLOCK_SEPARATION)("r",.75*e.SPACE_SIZE)("stroke-width",2*e.STROKE_WIDTH),Ts(1),ra("x1",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("y1",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("x2",e.BLOCK_SEPARATION+e.DIAGONAL_BAR_OFFSET)("y2",e.BLOCK_SEPARATION-e.DIAGONAL_BAR_OFFSET)("stroke-width",2*e.STROKE_WIDTH)}}let x8=(()=>{class e extends u1{constructor(e){super(e),this.arrows=[],this.victoryCoords=[],this.rules=new v8(y8),this.availableMinimaxes=[new _8(this.rules,"PentagoMinimax")],this.encoder=g8.encoder,this.tutorial=(new b8).tutorial,this.BLOCK_WIDTH=3*this.SPACE_SIZE+2*this.STROKE_WIDTH,this.BLOCK_SEPARATION=this.BLOCK_WIDTH+2*this.STROKE_WIDTH,this.DIAGONAL_BAR_OFFSET=.75*Math.cos(Math.PI/4)*this.SPACE_SIZE,this.ARROWS=this.generateArrowsCoord(),this.updateBoard()}updateBoard(){this.board=this.rules.node.gameState.getCopiedBoard(),this.victoryCoords=this.rules.getVictoryCoords(this.rules.node.gameState),this.showLastMove()}showLastMove(){const e=this.rules.node.move;if(this.cancelMoveAttempt(),e.isAbsent())this.hidePreviousMove();else{const t=e.get();this.movedBlock=t.blockTurned;const n=new JX(t.coord.x%3-1,t.coord.y%3-1);if(t.blockTurned.isPresent()&&!1===n.equals(new JX(0,0))&&this.coordBelongToBlock(t)){let e;e=t.turnedClockwise?Ow.getNonNullable(y8.ROTATION_MAP.find(e=>e[0].equals(n)))[1]:Ow.getNonNullable(y8.ROTATION_MAP.find(e=>e[1].equals(n)))[0];const r=t.blockTurned.get();e=e.getNext(new jX(r%2==0?1:4,r<2?1:4),1),this.lastDrop=Mw.of(e)}else this.lastDrop=Mw.of(t.coord)}}coordBelongToBlock(e){return e.blockTurned.equalsValue(2*(e.coord.y<3?0:1)+(e.coord.x<3?0:1))}hidePreviousMove(){this.lastDrop=Mw.empty(),this.movedBlock=Mw.empty(),this.victoryCoords=[]}generateArrowsCoord(){const e=2*this.BLOCK_SEPARATION,t=this.SPACE_SIZE,n=.5*this.SPACE_SIZE;return[["M "+n+" 0 q "+t+" -"+t+" "+2*t+" 0",0,!0],["M 0 "+n+" q -"+t+" "+t+" 0 "+2*t,0,!1],["M "+e+" "+n+" q "+t+" "+t+" 0 "+2*t,1,!0],["M "+(e-n)+" 0 q -"+t+" -"+t+" -"+2*t+" 0",1,!1],["M 0 "+(e-n)+" q -"+t+" -"+t+" 0 -"+2*t,2,!0],["M "+n+" "+e+" q "+t+" "+t+" "+2*t+" 0",2,!1],["M "+(e-n)+" "+e+" q -"+t+" "+t+" -"+2*t+" 0",3,!0],["M "+e+" "+(e-n)+"  q "+t+" -"+t+" 0 -"+2*t,3,!1]]}cancelMoveAttempt(){this.arrows=[],this.currentDrop=Mw.empty(),this.canSkipRotation=!1}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.board[t][e].isPlayer())return n.cancelMove(lJ.MUST_LAND_ON_EMPTY_SPACE());const i=g8.rotationless(e,t),s=n.rules.node.gameState,o=s.applyLegalDrop(i);if(4===o.neutralBlocks.length)return n.chooseMove(i,s);const a=n.rules.getGameStatus(n.rules.node);return n.canSkipRotation=o.neutralBlocks.length>0&&!1===a.isEndGame,n.currentDrop=Mw.of(new JX(e,t)),n.displayArrows(o.neutralBlocks),TW.SUCCESS})()}getCenter(e){return(e<3?0:this.BLOCK_SEPARATION)+2*this.STROKE_WIDTH+(e%3+.5)*this.SPACE_SIZE}displayArrows(e){this.arrows=[];for(let t=0;t<4;t++)if(!1===e.includes(t)){const e=this.ARROWS.filter(e=>e[1]===t);this.arrows=this.arrows.concat(e)}}getBlockClasses(e,t){return this.movedBlock.equalsValue(e+2*t)?["moved"]:[]}getSquareClasses(e,t){const n=[],r=this.getPlayerClass(this.board[t][e]);return n.push(r),this.lastDrop.equalsValue(new JX(e,t))&&n.push("last-move"),n}rotate(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#rotate_"+e[1]+"_"+(e[2]?"clockwise":"counterclockwise"));if(n.isFailure())return t.cancelMove(n.getReason());const r=t.currentDrop.get(),i=g8.withRotation(r.x,r.y,e[1],e[2]);return t.chooseMove(i,t.rules.node.gameState)})()}skipRotation(){var e=this;return Pw(function*(){const t=e.canUserPlay("#skipRotation");if(t.isFailure())return e.cancelMove(t.getReason());const n=e.currentDrop.get(),r=g8.rotationless(n.x,n.y);return e.chooseMove(r,e.rules.node.gameState)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-pentago"]],features:[Go],decls:9,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-60 -60 780 780"],["id","arrowhead","markerWidth","5","markerHeight","3.5","refX","2.5","refY","1.75","orient","auto","fill","blue"],["points","0 0, 5 1.75, 0 3.5"],[4,"ngFor","ngForOf"],["class","base","pointer-events","fill",3,"id","ngClass",4,"ngIf"],["class","no-fill","stroke","blue","marker-end","url(#arrowhead)",3,"id","click",4,"ngFor","ngForOf"],["class","base victory-stroke",3,"id","ngClass",4,"ngFor","ngForOf"],["id","skipRotation",3,"click",4,"ngIf"],[1,"base","no-fill",3,"ngClass"],["pointer-events","fill",1,"base",3,"id","ngClass","click"],["pointer-events","fill",1,"base",3,"id","ngClass"],["stroke","blue","marker-end","url(#arrowhead)",1,"no-fill",3,"id","click"],[1,"base","victory-stroke",3,"id","ngClass"],["id","skipRotation",3,"click"],["stroke","red",1,"background"],["stroke","red"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),pa(2,"marker",1),ga(3,"polygon",2),fa(),fa(),la(4,k8,2,3,"ng-container",3),la(5,A8,1,6,"circle",4),la(6,M8,1,4,"path",5),la(7,N8,1,7,"circle",6),la(8,R8,3,9,"g",7),fa()),2&e&&(Ts(4),ha("ngForOf",bu(5,I8,t.BLOCK_SEPARATION)),Ts(1),ha("ngIf",t.currentDrop.isPresent()),Ts(1),ha("ngForOf",t.arrows),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngIf",t.canSkipRotation))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class D8 extends JX{constructor(e,t,n){if(super(e,t),this.z=n,e<0||e>3)throw new Error(`PylosCoord: Invalid X: ${e}.`);if(t<0||t>3)throw new Error(`PylosCoord: Invalid Y: ${t}.`);if(n<0||n>3)throw new Error(`PylosCoord: Invalid Z: ${n}.`);const r=4-n;if(this.isNotInRange(r,r))throw new Error(this.toString()+" is not in range.")}static encodeOptional(e){let t;return t=e.isPresent()?D8.encode(e.get())+1:0,t}static encode(e){return 16*e.x+4*e.y+e.z}static decodeToOptional(e){return 0===e?Mw.empty():Mw.of(D8.decode(e-1))}static decode(e){const t=e%4;e-=t;const n=(e/=4)%4;return e-=n,new D8(e/=4,n,t)}toString(){return"PylosCoord"+this.toShortString()}toShortString(){return"("+this.x+", "+this.y+", "+this.z+")"}equals(e){return this===e||e.x===this.x&&e.y===this.y&&e.z===this.z}isUpperThan(e){return this.z>e.z}getLowerPieces(){if(0===this.z)throw new Error("PylosCoord: floor pieces don't have lower pieces.");const e=this.z-1;return[new D8(this.x,this.y,e),new D8(this.x+1,this.y,e),new D8(this.x,this.y+1,e),new D8(this.x+1,this.y+1,e)]}getHigherPieces(){if(3===this.z)throw new Error("Top piece don't have lower pieces.");const e=this.z+1,t=new JX(this.x-1,this.y-1),n=new JX(this.x,this.y-1),r=new JX(this.x-1,this.y),i=new JX(this.x,this.y),s=4-e;return[t,n,r,i].filter(e=>e.isInRange(s,s)).map(t=>new D8(t.x,t.y,e))}getNextValid(e){const t=new JX(this.x,this.y).getNext(e),n=4-this.z;return t.isNotInRange(n,n)?Mw.empty():Mw.of(new D8(t.x,t.y,this.z))}}class L8 extends mJ{constructor(e,t,n,r){super(),this.startingCoord=e,this.landingCoord=t,this.firstCapture=n,this.secondCapture=r}static fromClimb(e,t,n){const r=Mw.of(e),i=L8.checkCaptures(n),s=new L8(r,t,i.firstCapture,i.secondCapture);if(!t.isUpperThan(e))throw new Error("PylosMove: When piece move it must move upward.");return s}static checkCaptures(e){let t=Mw.empty(),n=Mw.empty();if(e.length>0&&(t=Mw.of(e[0]),e.length>1)){if(e[1].equals(e[0]))throw new Error("PylosMove: should not capture twice same piece.");if(n=Mw.of(e[1]),e[1].isUpperThan(e[0])&&(t=Mw.of(e[1]),n=Mw.of(e[0])),e.length>2)throw new Error("PylosMove: can't capture that much piece.")}return{firstCapture:t,secondCapture:n}}static fromDrop(e,t){const n=Mw.empty(),r=L8.checkCaptures(t);return new L8(n,e,r.firstCapture,r.secondCapture)}static changeCapture(e,t){const n=L8.checkCaptures(t);return new L8(e.startingCoord,e.landingCoord,n.firstCapture,n.secondCapture)}isClimb(){return this.startingCoord.isPresent()}toString(){const e=this.startingCoord.isAbsent()?"-":this.startingCoord.get().toShortString(),t=this.firstCapture.isAbsent()?"-":this.firstCapture.get().toShortString(),n=this.secondCapture.isAbsent()?"-":this.secondCapture.get().toShortString();return"PylosMove("+e+", "+this.landingCoord.toShortString()+", "+t+", "+n+")"}equals(e){return e===this||!!(this.startingCoord.equals(e.startingCoord)&&this.landingCoord.equals(e.landingCoord)&&this.firstCapture.equals(e.firstCapture)&&this.secondCapture.equals(e.secondCapture))}}L8.encoder=new class extends FK{maxValue(){return 17575999}encodeNumber(e){const t=D8.encode(e.landingCoord),n=D8.encodeOptional(e.startingCoord),r=D8.encodeOptional(e.firstCapture);return 270400*D8.encodeOptional(e.secondCapture)+4160*r+64*n+t}decodeNumber(e){const t=D8.decode(e%64);e-=e%64;const n=D8.decodeToOptional((e/=64)%65);e-=e%65;const r=D8.decodeToOptional((e/=65)%65);e-=e%65;const i=D8.decodeToOptional(e/=65);return new L8(n,t,r,i)}};class F8 extends pJ{constructor(e,t){super(t),this.boards=e}static getInitialState(){const e=GK.createTable(4,4,VK.NONE),t=GK.createTable(3,3,VK.NONE),n=GK.createTable(2,2,VK.NONE);return new F8([e,t,n,[[VK.NONE]]],0)}getPieceAt(e){return this.boards[e.z][e.y][e.x]}applyLegalMove(e){const t=[];return t.push({coord:e.landingCoord,value:this.getCurrentPlayer()}),e.startingCoord.isPresent()&&t.push({coord:e.startingCoord.get(),value:VK.NONE}),e.firstCapture.isPresent()&&t.push({coord:e.firstCapture.get(),value:VK.NONE}),e.secondCapture.isPresent()&&t.push({coord:e.secondCapture.get(),value:VK.NONE}),this.setBoardAts(t,this.turn+1)}setBoardAts(e,t){const n=[GK.copyBiArray(this.boards[0]),GK.copyBiArray(this.boards[1]),GK.copyBiArray(this.boards[2]),GK.copyBiArray(this.boards[3])];for(const r of e){const e=r.coord;n[e.z][e.y][e.x]=r.value}return new F8(n,t)}isLandable(e){if(this.getPieceAt(e).isPlayer())return!1;if(0===e.z)return!0;const t=e.getLowerPieces();for(const n of t)if(this.getPieceAt(n)===VK.NONE)return!1;return!0}isSupporting(e){if(3===e.z)return!1;const t=e.getHigherPieces();for(const n of t)if(this.getPieceAt(n).isPlayer())return!0;return!1}getPiecesRepartition(){const e={};e[VK.NONE.value]=0,e[BK.ZERO.value]=0,e[BK.ONE.value]=0;for(let t=0;t<3;t++)for(let n=0;n<4-t;n++)for(let r=0;r<4-t;r++){const i=new D8(r,n,t),s=this.getPieceAt(i);e[s.value]=1+e[s.value]}return e}}let U8=(()=>{class e{}return e.MUST_MOVE_UPWARD=()=>$localize`You must move your pieces upward.`,e.SHOULD_HAVE_SUPPORTING_PIECES=()=>$localize`Your piece must land on the board or on 4 other pieces.`,e.CANNOT_LAND=()=>$localize`You cannot land on this space.`,e.CANNOT_CAPTURE=()=>$localize`You cannot capture.`,e.INVALID_FIRST_CAPTURE=()=>$localize`Your first capture is invalid.`,e.INVALID_SECOND_CAPTURE=()=>$localize`Your second capture is invalid.`,e})();class B8 extends PJ{static getStateInfo(e){const t=[],n=[];for(let r=0;r<3;r++)for(let i=0;i<4-r;i++)for(let s=0;s<4-r;s++){const o=new D8(s,i,r);e.getPieceAt(o)===e.getCurrentPlayer()&&!1===e.isSupporting(o)&&t.push(o),e.isLandable(o)&&n.push(o)}return{freeToMove:t,landable:n}}static getClimbingMoves(e){const t=[];for(const n of e.freeToMove)for(const r of e.landable)if(r.isUpperThan(n)&&!1===r.getLowerPieces().some(e=>n.equals(e))){const e=L8.fromClimb(n,r,[]);t.push(e)}return t}static getDropMoves(e){const t=[];for(const n of e.landable){const e=L8.fromDrop(n,[]);t.push(e)}return t}static canCapture(e,t){const n=e.getCurrentPlayer();for(const r of[QX.UP,QX.DOWN]){const i=t.getNextValid(r);if(i.isPresent()&&e.getPieceAt(i.get())===n)for(const t of[QX.LEFT,QX.RIGHT]){const s=i.get().getNextValid(t);if(s.isPresent()&&e.getPieceAt(s.get())===n){const t=r.getOpposite(),i=s.get().getNextValid(t).get();if(e.getPieceAt(i)===n)return!0}}}return!1}static getPossibleCaptures(e,t,n){const r=[],i=(e=e.filter(e=>!1===t.equalsValue(e))).concat(n);for(let s=0;s<i.length;s++){const e=i[s];r.push([e]);for(let t=s+1;t<i.length;t++)r.push([i[t],e])}return r}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}static isValidCapture(e,t,n){const r=e.getCurrentPlayer();return!(!n.equals(t.landingCoord)&&e.getPieceAt(n)!==r||n.getHigherPieces().filter(n=>e.getPieceAt(n).isPlayer()&&!1===n.equals(t.firstCapture.get())).length>0)}static getGameStatus(e){const t=e.gameState.getPiecesRepartition();return 15===t[BK.ZERO.value]?SJ.ONE_WON:15===t[BK.ONE.value]?SJ.ZERO_WON:SJ.ONGOING}applyLegalMove(e,t,n){return B8.applyLegalMove(e,t,n)}isLegal(e,t){if(t.getPieceAt(e.landingCoord).isPlayer())return SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE());const n=t.getCurrentOpponent();if(e.startingCoord.isPresent()){const r=e.startingCoord.get(),i=t.getPieceAt(r);if(i===n)return SW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(i===VK.NONE)return SW.failure(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());if(r.getHigherPieces().filter(n=>t.getPieceAt(n).isPlayer()||n.equals(e.landingCoord)).length>0)return SW.failure(U8.SHOULD_HAVE_SUPPORTING_PIECES())}if(!t.isLandable(e.landingCoord))return SW.failure(U8.CANNOT_LAND());if(e.firstCapture.isPresent()){if(!1===B8.canCapture(t,e.landingCoord))return SW.failure(U8.CANNOT_CAPTURE());if(!B8.isValidCapture(t,e,e.firstCapture.get()))return SW.failure(U8.INVALID_FIRST_CAPTURE());if(e.secondCapture.isPresent()&&!B8.isValidCapture(t,e,e.secondCapture.get()))return SW.failure(U8.INVALID_SECOND_CAPTURE())}return SW.success(void 0)}getGameStatus(e){return B8.getGameStatus(e)}}class V8 extends cJ{static getListMoves(e){const t=e.gameState,n=[],r=B8.getStateInfo(t),i=B8.getClimbingMoves(r),s=B8.getDropMoves(r),o=i.concat(s);for(const a of o){let e=[[]];B8.canCapture(t,a.landingCoord)&&(e=B8.getPossibleCaptures(r.freeToMove,a.startingCoord,a.landingCoord));for(const t of e){const e=L8.changeCapture(a,t);n.push(e)}}return n}getListMoves(e){return V8.getListMoves(e)}getBoardValue(e){const t=B8.getGameStatus(e);if(t.isEndGame)return new uJ(t.toBoardValue());{const t=e.gameState.getPiecesRepartition();return new uJ(t[BK.ZERO.value]-t[BK.ONE.value])}}}class $8 extends V8{static countStoneUsed(e){let t=e.isClimb()?0:1;return e.firstCapture.isPresent()&&(t-=1,e.secondCapture.isPresent()&&(t-=1)),t}static sumMoveEmplacementByValue(e){let t=e.landingCoord.z;return e.startingCoord.isPresent()&&(t+=3-e.startingCoord.get().z),e.firstCapture.isPresent()&&(t+=3-e.firstCapture.get().z,e.secondCapture.isPresent()&&(t+=3-e.secondCapture.get().z)),t}getListMoves(e){const t=V8.getListMoves(e);return this.orderMoves(t)}orderMoves(e){return e.sort((e,t)=>{const n=12*$8.countStoneUsed(e),r=12*$8.countStoneUsed(t);return n+$8.sumMoveEmplacementByValue(e)-(r+$8.sumMoveEmplacementByValue(t))})}}const z8=VK.NONE,H8=BK.ZERO,G8=BK.ONE;class W8{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`At Pylos, the goal is to be the last to play.
        To do this, you have to save up your pieces.
        As soon as a player puts its last piece, that player loses the game immediately.
        Here is what the initial board looks like, it is a board of 4 x 4 squares.
        This board will become a pyramid, little by little.
        It will be filled by the pieces of your stock. Each player has 15 pieces.`,F8.getInitialState()),kJ.anyMove($localize`Dropping a piece`,$localize`When it is your turn, you can always drop one of your piece on an empty square.
        The gray squares are where you can drop your pieces.<br/><br/>
        Click on one of the squares to drop a piece there.`,F8.getInitialState(),L8.fromDrop(new D8(1,1,0),[]),$localize`There you go, as simple as that.`),kJ.fromMove($localize`Climbing`,$localize`When 4 pieces form a square, it is possible to put a fifth piece on top.
        However, when that happens, you can save a piece by climbing instead of dropping a piece.
        To climb:
        <ol>
            <li>Click on one of your free pieces, which should be lower than the landing square.</li>
            <li>Click on an empty landing square, higher than your selected piece.</li>
        </ol><br/>
        Go ahead, climb!`,new F8([[[H8,G8,z8,z8],[G8,H8,z8,z8],[z8,z8,z8,z8],[z8,z8,z8,H8]],[[z8,z8,z8],[z8,z8,z8],[z8,z8,z8]],[[z8,z8],[z8,z8]],[[z8]]],0),[L8.fromClimb(new D8(3,3,0),new D8(0,0,1),[])],$localize`Congratulations!<br/>
        Some important notes:
        <ol>
            <li>You cannot move a piece that is directly below another one.</li>
            <li>Of course, you cannot move the opponent's pieces.</li>
            <li>You can only climb when the landing square is higher than the starting square.</li>
        </ol>`,$localize`Failed!`),kJ.fromMove($localize`Square (1/2)`,$localize`When the piece you just moved or dropped is the fourth one of a square of your color,
        you can choose anywhere on the board one or two of your pieces.
        These pieces will be removed from the board, allowing you to save up one or two pieces.
        A chosen piece must not be directly below another piece.
        A chosen piece can be the piece you just placed.
        You're playing Dark.<br/><br/>
        Form a square, then click twice on one of the four pieces to remove only that one.`,new F8([[[H8,H8,z8,z8],[z8,H8,z8,z8],[z8,z8,z8,z8],[z8,z8,z8,z8]],[[z8,z8,z8],[z8,z8,z8],[z8,z8,z8]],[[z8,z8],[z8,z8]],[[z8]]],0),[L8.fromDrop(new D8(0,1,0),[new D8(0,0,0)]),L8.fromDrop(new D8(0,1,0),[new D8(0,1,0)]),L8.fromDrop(new D8(0,1,0),[new D8(1,0,0)]),L8.fromDrop(new D8(0,1,0),[new D8(1,1,0)])],$localize`Congratulations, you have saved up one piece.`,$localize`Failed!`),kJ.fromPredicate($localize`Square (2/2)`,$localize`You're playing Dark.<br/><br/>
        Do like in the previous step, but this time click on two different pieces.`,new F8([[[H8,H8,z8,z8],[z8,H8,z8,z8],[z8,z8,z8,z8],[z8,z8,z8,z8]],[[z8,z8,z8],[z8,z8,z8],[z8,z8,z8]],[[z8,z8],[z8,z8]],[[z8]]],0),L8.fromDrop(new D8(0,1,0),[new D8(0,0,0),new D8(1,0,0)]),(e,t)=>e.secondCapture.isPresent()?TW.SUCCESS:e.firstCapture.isPresent()?TW.failure($localize`Failed, you only captured one piece.`):TW.failure(f6.YOU_DID_NOT_CAPTURE_ANY_PIECE()),$localize`Congratulations, you have saved up two pieces.`)]}}function q8(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",4),fa()),2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa();Ts(1),Ia("id","piece_",n,"_",e,""),ha("ngClass",r.getPlayerPieceClass(n)),ra("cx",.5*r.SPACE_SIZE+(800-r.SPACE_SIZE)/14*e)("cy",860+(r.SPACE_SIZE+10)*n)("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)}}function j8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,q8,2,6,"g",1),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",n.getPlayerSidePieces(e))}}function Z8(e,t){if(1&e){const e=va();Cn(),pa(0,"circle",8),Ea("click",function(){Gt(e);const t=Sa(2).$implicit,n=Sa().$implicit,r=Sa().$implicit;return Sa().onPieceClick(t,n,r)}),fa()}if(2&e){const e=Sa(2).$implicit,t=Sa().$implicit,n=Sa().$implicit,r=Sa();ka("id","piece_",e,"_",t,"_",n,""),ha("ngClass",r.getPieceClasses(e,t,n)),ra("r",r.getPieceRadius(n)-r.STROKE_WIDTH)("cx",r.getPieceCx(e,t,n))("cy",r.getPieceCy(e,t,n))}}function Y8(e,t){if(1&e){const e=va();Cn(),pa(0,"rect",8),Ea("click",function(){Gt(e);const t=Sa(2).$implicit,n=Sa().$implicit,r=Sa().$implicit;return Sa().onDrop(t,n,r)}),fa()}if(2&e){const e=Sa(2).$implicit,t=Sa().$implicit,n=Sa().$implicit,r=Sa();ka("id","drop_",e,"_",t,"_",n,""),ha("ngClass",r.getSquareClasses(e,t,n)),ra("width",2*r.getPieceRadius(n))("height",2*r.getPieceRadius(n))("x",r.getPieceCx(e,t,n)-r.getPieceRadius(n))("y",r.getPieceCy(e,t,n)-r.getPieceRadius(n))}}function K8(e,t){if(1&e&&(Cn(),ma(0),la(1,Z8,1,7,"circle",6),la(2,Y8,1,8,"ng-template",null,7,Ku),ya()),2&e){const e=ca(3),t=Sa().$implicit,n=Sa().$implicit,r=Sa().$implicit,i=Sa();Ts(1),ha("ngIf",i.isOccupied(t,n,r))("ngIfElse",e)}}function Q8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,K8,4,2,"ng-container",5),fa()),2&e){const e=t.$implicit,n=Sa().$implicit,r=Sa().$implicit,i=Sa();Ts(1),ha("ngIf",i.isDrawable(e,n,r))}}function X8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Q8,2,1,"g",1),fa()),2&e){const e=Sa().$implicit,t=Sa();Ts(1),ha("ngForOf",t.getLevelRange(e))}}function J8(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,X8,2,1,"g",1),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",n.getLevelRange(e))}}function e7(e,t){if(1&e&&(Cn(),ga(0,"rect",9)),2&e){const e=Sa();ka("id","highCapture_",e.highCapture.get().x,"_",e.highCapture.get().y,"_",e.highCapture.get().z,""),ra("width",2*e.getPieceRadius(e.highCapture.get().z))("height",2*e.getPieceRadius(e.highCapture.get().z))("x",e.getPieceCx(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))("y",e.getPieceCy(e.highCapture.get().x,e.highCapture.get().y,e.highCapture.get().z)-e.getPieceRadius(e.highCapture.get().z))}}const t7=function(){return[0,1]},n7=function(){return[0,1,2]};let r7=(()=>{class e extends eJ{constructor(e){super(e),this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.lastFirstCapture=Mw.empty(),this.lastSecondCapture=Mw.empty(),this.highCapture=Mw.empty(),this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty(),this.chosenFirstCapture=Mw.empty(),this.lastMove=Mw.empty(),this.remainingPieces={0:15,1:15},this.rules=new B8(F8),this.availableMinimaxes=[new V8(this.rules,"PylosMinimax"),new $8(this.rules,"PylosOrderedMinimax")],this.encoder=L8.encoder,this.tutorial=(new W8).tutorial,this.SPACE_SIZE=this.getPieceRadius(0),this.updateBoard()}getLevelRange(e){switch(e){case 0:return[0,1,2,3];case 1:return[0,1,2];default:return Ow.expectToBe(e,2),[0,1]}}isDrawable(e,t,n){const r=new D8(e,t,n);return this.state.getPieceAt(r)!==VK.NONE||this.state.isLandable(r)}onPieceClick(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#piece_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new D8(e,t,n);return r.state.getPieceAt(s)===r.state.getCurrentOpponent()?r.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):r.chosenLandingCoord.isAbsent()?(r.chosenStartingCoord=Mw.of(s),TW.SUCCESS):r.chosenFirstCapture.isAbsent()?(r.chosenFirstCapture=Mw.of(s),TW.SUCCESS):r.chosenFirstCapture.equalsValue(s)?r.concludeMoveWithCapture([r.chosenFirstCapture.get()]):r.concludeMoveWithCapture([r.chosenFirstCapture.get(),s])})()}concludeMoveWithCapture(e){var t=this;return Pw(function*(){let n;return n=t.chosenStartingCoord.isAbsent()?L8.fromDrop(t.chosenLandingCoord.get(),e):L8.fromClimb(t.chosenStartingCoord.get(),t.chosenLandingCoord.get(),e),t.tryMove(n,t.state)})()}tryMove(e,t){var n=this;return Pw(function*(){return n.cancelMove(),n.chooseMove(e,t)})()}cancelMoveAttempt(){this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty(),this.chosenFirstCapture=Mw.empty()}onDrop(e,t,n){var r=this;return Pw(function*(){const i=r.canUserPlay("#drop_"+e+"_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());const s=new D8(e,t,n);return B8.canCapture(r.state,s)?(r.chosenLandingCoord=Mw.of(s),TW.SUCCESS):r.isCapturelessMoveFinished(s)?(r.chosenLandingCoord=Mw.of(s),r.concludeMoveWithCapture([])):r.cancelMove(U8.MUST_MOVE_UPWARD())})()}isCapturelessMoveFinished(e){return!!this.chosenStartingCoord.isAbsent()||e.isUpperThan(this.chosenStartingCoord.get())}getSquareClasses(e,t,n){const r=new D8(e,t,n);if(this.lastMove.isPresent()){const e=this.lastMove.get();if(e.firstCapture.equalsValue(r)||e.secondCapture.equalsValue(r))return["captured"];if(r.equals(e.landingCoord)||e.startingCoord.equalsValue(r))return["moved"]}return[]}getPieceRadius(e){return 90+5*e}getPieceCx(e,t,n){return 100+100*n+200*e}getPieceCy(e,t,n){return 100+100*n+200*t}isOccupied(e,t,n){const r=new D8(e,t,n),i=this.rules.node.gameState.getPieceAt(r).isPlayer(),s=this.chosenLandingCoord.equalsValue(r);return i||s}getPieceClasses(e,t,n){const r=new D8(e,t,n),i=[this.getPieceFillClass(r)];return(this.lastLandingCoord.equalsValue(r)||this.lastStartingCoord.equalsValue(r))&&i.push("highlighted"),(this.chosenStartingCoord.equalsValue(r)||this.chosenLandingCoord.equalsValue(r))&&i.push("selected"),this.chosenFirstCapture.equalsValue(r)&&i.push("pre-captured"),i}getPieceFillClass(e){return this.chosenLandingCoord.equalsValue(e)?this.getPlayerClass(this.state.getCurrentPlayer()):this.getPlayerPieceClass(this.state.getPieceAt(e).value)}getPlayerPieceClass(e){return this.getPlayerClass(BK.of(e))}getPlayerSidePieces(e){const t=this.remainingPieces[e],n=[];for(let r=0;r<t;r++)n.push(r);return n}updateBoard(){this.state=this.rules.node.gameState,this.lastMove=this.rules.node.move;const e=this.state.getPiecesRepartition();this.remainingPieces={0:15-e[0],1:15-e[1]},this.highCapture=Mw.empty(),this.lastMove.isPresent()?this.showLastMove():(this.lastLandingCoord=Mw.empty(),this.lastStartingCoord=Mw.empty(),this.lastFirstCapture=Mw.empty(),this.lastSecondCapture=Mw.empty(),this.chosenFirstCapture=Mw.empty(),this.chosenStartingCoord=Mw.empty(),this.chosenLandingCoord=Mw.empty())}showLastMove(){const e=this.lastMove.get();this.lastLandingCoord=Mw.of(e.landingCoord),this.lastStartingCoord=e.startingCoord,this.lastFirstCapture=e.firstCapture,this.lastSecondCapture=e.secondCapture,this.lastFirstCapture.isPresent()&&!1===this.isDrawableCoord(this.lastFirstCapture.get())&&(this.highCapture=this.lastFirstCapture)}isDrawableCoord(e){return this.isDrawable(e.x,e.y,e.z)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-pylos"]],features:[Go],decls:5,vars:5,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 -4 800 1021","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],["x","0","y","0","width","800","height","800",1,"base"],["class","base captured",3,"id",4,"ngIf"],[1,"base","small-stroke",3,"id","ngClass"],[4,"ngIf"],["class","base",3,"id","ngClass","click",4,"ngIf","ngIfElse"],["onlyRect",""],[1,"base",3,"id","ngClass","click"],[1,"base","captured",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,j8,2,1,"g",1),ga(2,"rect",2),la(3,J8,2,1,"g",1),la(4,e7,1,7,"rect",3),fa()),2&e&&(Ts(1),ha("ngForOf",wu(3,t7)),Ts(2),ha("ngForOf",wu(4,n7)),Ts(1),ha("ngIf",t.highCapture.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class i7{constructor(e){this.value=e}static fromInt(e){if(0<=e&&e<=15)return i7.pieces[e];if(16===e)return i7.EMPTY;throw new Error("Invalid piece ("+e+")")}equals(e){return this===e}toString(){return"QuartoPiece("+this.value+")"}isRectangle(){return this.value%4<2}}i7.AAAA=new i7(0),i7.AAAB=new i7(1),i7.AABA=new i7(2),i7.AABB=new i7(3),i7.ABAA=new i7(4),i7.ABAB=new i7(5),i7.ABBA=new i7(6),i7.ABBB=new i7(7),i7.BAAA=new i7(8),i7.BAAB=new i7(9),i7.BABA=new i7(10),i7.BABB=new i7(11),i7.BBAA=new i7(12),i7.BBAB=new i7(13),i7.BBBA=new i7(14),i7.BBBB=new i7(15),i7.EMPTY=new i7(16),i7.pieces=[i7.AAAA,i7.AAAB,i7.AABA,i7.AABB,i7.ABAA,i7.ABAB,i7.ABBA,i7.ABBB,i7.BAAA,i7.BAAB,i7.BABA,i7.BABB,i7.BBAA,i7.BBAB,i7.BBBA,i7.BBBB];class s7 extends yJ{constructor(e,t,n){super(e,t),this.piece=n}toString(){return"QuartoMove("+this.coord.x+", "+this.coord.y+", "+this.piece.value+")"}equals(e){return this===e||!!e.coord.equals(this.coord)&&this.piece===e.piece}}s7.encoder=new class extends FK{maxValue(){return 496}encodeNumber(e){return 128*e.coord.x+32*e.coord.y+e.piece.value}decodeNumber(e){const t=e%32;e-=t;const n=(e/=32)%4;return e-=n,new s7(e/=4,n,i7.fromInt(t))}};class o7 extends fJ{constructor(e,t,n){super(e,t),this.pieceInHand=n}static getInitialState(){const e=GK.createTable(4,4,i7.EMPTY);return new o7(e,0,i7.AAAA)}static isGivable(e,t,n){return e!==n&&!1===o7.isAlreadyOnBoard(e,t)}static isAlreadyOnBoard(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++)if(t[n][r]===e)return!0;return!1}getRemainingPieces(){const e=i7.pieces,t=[];for(const n of e)o7.isGivable(n,this.board,this.pieceInHand)&&t.push(n);return t}}let a7=(()=>{class e{}return e.MUST_GIVE_A_PIECE=()=>$localize`You must give a piece.`,e.PIECE_ALREADY_ON_BOARD=()=>$localize`That piece is already on the board.`,e.CANNOT_GIVE_PIECE_IN_HAND=()=>$localize`You cannot give the piece that was in your hands.`,e})();class l7{constructor(e){this.subCriterion=[Mw.empty(),Mw.empty(),Mw.empty(),Mw.empty()],this.subCriterion[0]=Mw.of(8==(8&e.value)),this.subCriterion[1]=Mw.of(4==(4&e.value)),this.subCriterion[2]=Mw.of(2==(2&e.value)),this.subCriterion[3]=Mw.of(1==(1&e.value))}mergeWith(e){let t=4;for(let n=0;n<4;n++)!1===this.subCriterion[n].equals(e.subCriterion[n])&&(this.subCriterion[n]=Mw.empty()),this.subCriterion[n].isAbsent()&&t--;return t>0}mergeWithQuartoPiece(e){const t=new l7(e);return this.mergeWith(t)}areAllAbsent(){for(let e=0;e<4;e++)if(this.subCriterion[e].isPresent())return!1;return!0}match(e){for(let t=0;t<4;t++)if(this.subCriterion[t].equals(e.subCriterion[t]))return!0;return!1}matchPiece(e){return this.match(new l7(e))}toString(){return"Criterion{"+this.subCriterion.map(e=>e.isPresent()?e.get()?"1":"0":"x").join(" ")+"}"}}class c7{constructor(e,t){this.initialCoord=e,this.direction=t}allCoords(){const e=[];for(let t=0;t<4;t++)e.push(this.initialCoord.getNext(this.direction,t));return e}}class u7 extends PJ{static isOccupied(e){return e!==i7.EMPTY}static isLegal(e,t){const n=e.coord.x,r=e.coord.y,i=e.piece,s=t.getCopiedBoard(),o=t.pieceInHand;return u7.isOccupied(s[r][n])?TW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE()):i===i7.EMPTY?15===t.turn?TW.SUCCESS:TW.failure(a7.MUST_GIVE_A_PIECE()):o7.isAlreadyOnBoard(i,s)?TW.failure(a7.PIECE_ALREADY_ON_BOARD()):o===i?TW.failure(a7.CANNOT_GIVE_PIECE_IN_HAND()):TW.SUCCESS}isLegal(e,t){return u7.isLegal(e,t).toFallible(void 0)}applyLegalMove(e,t){const n=t.getCopiedBoard();return n[e.coord.y][e.coord.x]=t.pieceInHand,new o7(n,t.turn+1,e.piece)}static updateBoardStatus(e,t,n){return n.score===_J.PRE_VICTORY?this.isThereAVictoriousLine(e,t)?{score:_J.VICTORY,sensitiveSquares:new L1}:n:this.searchForVictoryOrPreVictoryInLine(e,t,n)}static isThereAVictoriousLine(e,t){let n=e.initialCoord,r=t.getPieceAt(n);const i=new l7(r);for(let s=0;s<3&&!1!==u7.isOccupied(r)&&!i.areAllAbsent();s++)n=n.getNext(e.direction,1),r=t.getPieceAt(n),i.mergeWithQuartoPiece(r);return!(!u7.isOccupied(r)||i.areAllAbsent())}static searchForVictoryOrPreVictoryInLine(e,t,n){const r=u7.getLineInfos(e,t,n);if(r.boardStatus.isPresent())return r.boardStatus.get();const i=r.commonCriterion,s=r.sensitiveCoord;if(i.isPresent()&&!1===i.get().areAllAbsent()){if(s.isAbsent())return{score:_J.VICTORY,sensitiveSquares:new L1};{i.get().matchPiece(t.pieceInHand)&&(n.score=_J.PRE_VICTORY);const e=s.get();n.sensitiveSquares.add(e)}}return n}static getLineInfos(e,t,n){let r=Mw.empty(),i=Mw.empty(),s=e.initialCoord;for(let o=0;o<4;o++){const o=t.getPieceAt(s);if(o===i7.EMPTY){if(!r.isAbsent())return{sensitiveCoord:Mw.of(s),commonCriterion:i,boardStatus:Mw.of(n)};r=Mw.of(s)}else i.isAbsent()?(i=Mw.of(new l7(o)),Tw(u7.VERBOSE,"set commonCrit to "+i.toString())):(i.get().mergeWithQuartoPiece(o),Tw(u7.VERBOSE,"update commonCrit: "+i.toString()));s=s.getNext(e.direction,1)}return{commonCriterion:i,sensitiveCoord:r,boardStatus:Mw.empty()}}static scoreToGameStatus(e,t){const n=BK.of(t%2);return e===_J.VICTORY?SJ.getDefeat(n):16===t?SJ.DRAW:SJ.ONGOING}getGameStatus(e){const t=e.gameState;let n={score:_J.DEFAULT,sensitiveSquares:new L1};for(const r of u7.lines)if(n=u7.updateBoardStatus(r,t,n),n.score===_J.VICTORY)return u7.scoreToGameStatus(n.score,t.turn);return u7.scoreToGameStatus(n.score,t.turn)}getVictoriousCoords(e){for(const t of u7.lines)if(u7.isThereAVictoriousLine(t,e))return t.allCoords();return[]}}u7.VERBOSE=!1,u7.lines=[new c7(new JX(0,0),KX.DOWN),new c7(new JX(1,0),KX.DOWN),new c7(new JX(2,0),KX.DOWN),new c7(new JX(3,0),KX.DOWN),new c7(new JX(0,0),KX.RIGHT),new c7(new JX(0,1),KX.RIGHT),new c7(new JX(0,2),KX.RIGHT),new c7(new JX(0,3),KX.RIGHT),new c7(new JX(0,0),KX.DOWN_RIGHT),new c7(new JX(0,3),KX.UP_RIGHT)];class h7 extends cJ{static scoreToBoardValue(e,t){if(e===_J.DEFAULT)return new uJ(0);{const n=BK.of(t%2);return new uJ(e===_J.PRE_VICTORY?n.getPreVictory():n.getDefeatValue())}}getListMoves(e){const t=[],n=e.gameState,r=n.getCopiedBoard(),i=n.getRemainingPieces(),s=n.pieceInHand;let o;for(let a=0;a<4;a++)for(let e=0;e<4;e++)if(r[a][e]===i7.EMPTY){if(o=n.getCopiedBoard(),o[a][e]=s,15===n.turn){const n=new s7(e,a,i7.EMPTY);return t.push(n),t}for(const n of i){const r=new s7(e,a,n);t.push(r)}}return t}getBoardValue(e){const t=e.gameState;let n={score:_J.DEFAULT,sensitiveSquares:new L1};for(const r of u7.lines)if(n=u7.updateBoardStatus(r,t,n),n.score===_J.VICTORY)break;return h7.scoreToBoardValue(n.score,t.turn)}}const d7=i7.AABA,p7=i7.AABB,f7=i7.ABAA,g7=i7.ABAB,m7=i7.ABBA,y7=i7.BAAA,v7=i7.BAAB,_7=i7.BABB,C7=i7.BBAA,E7=i7.BBAB,w7=i7.BBBA,b7=i7.BBBB,S7=i7.EMPTY;class P7{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`Quarto is an alignment game.
        The goal is to align four pieces that have at least one common aspect:
        <ul>
          <li>their color (light or dark),</li>
          <li>their size (big or small),</li>
          <li>their pattern (empty or dotted),</li>
          <li>their shape (round or square).</li>
        </ul>
        Here, we have a board with a victory by an alignment of dark pieces.`,new o7([[w7,C7,f7,d7],[S7,S7,S7,S7],[S7,S7,S7,S7],[S7,S7,S7,S7]],7,i7.ABAB)),kJ.anyMove($localize`Placement`,$localize`Every placement occurs in two steps: placing the piece you have in hand (in the small square) on a square of the board,
        and picking a piece that the opponent will have to place, by clicking on one of the pieces inside the dotted square.
        If you prefer, the order of these two steps can be reversed.
        Keep in mind that the second click confirms the move.<br/><br/>
        Make a move.`,new o7([[w7,p7,m7,S7],[S7,S7,S7,S7],[S7,y7,S7,S7],[S7,S7,S7,S7]],7,i7.ABAA),new s7(2,2,i7.BAAB),$localize`Perfect!`),kJ.fromMove($localize`Situation`,$localize`We have here a tricky situation.<br/><br/>
        Analyze the board and play your move, carefully paying attention not to let the opponent win on the next move.`,new o7([[b7,w7,E7,S7],[f7,_7,C7,S7],[g7,y7,v7,S7],[S7,S7,S7,S7]],7,i7.AABA),[new s7(3,3,i7.AABB)],$localize`Well done!`,$localize`Failed!`)]}}function O7(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=Sa(2),t=e.$implicit,n=e.index,r=Sa().index,i=Sa();ha("ngClass",i.getPieceClasses(t.value)),ra("x",i.SPACE_SIZE*n+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("y",i.SPACE_SIZE*r+(i.SPACE_SIZE/2-i.getPieceSize(t.value)))("width",2*i.getPieceSize(t.value))("height",2*i.getPieceSize(t.value))}}function T7(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa(2),t=e.$implicit,n=e.index,r=Sa().index,i=Sa();ha("ngClass",i.getPieceClasses(t.value)),ra("cx",i.SPACE_SIZE*n+i.SPACE_SIZE/2)("cy",i.SPACE_SIZE*r+i.SPACE_SIZE/2)("r",i.getPieceSize(t.value))}}function I7(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function k7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,O7,1,5,"rect",9),la(2,T7,1,4,"ng-template",null,10,Ku),la(4,I7,1,3,"circle",3),fa()),2&e){const e=ca(3),t=Sa().$implicit,n=Sa(2);Ts(1),ha("ngIf",t.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",n.pieceHasDot(t.value))}}function A7(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().chooseCoord(t,n)}),fa(),la(2,k7,5,3,"g",3),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","chooseCoord_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*n)("y",i.SPACE_SIZE*r)("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e!==i.EMPTY)}}function M7(e,t){if(1&e&&(Cn(),pa(0,"g",null,7),la(2,A7,3,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(2),ha("ngForOf",e)}}function N7(e,t){if(1&e&&(Cn(),ga(0,"rect",15)),2&e){const e=Sa(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("y",e.SPACE_SIZE/2-e.getPieceSize(e.pieceInHand.value))("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function R7(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",e.getPieceSize(e.pieceInHand.value))}}function x7(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=Sa(2);ra("cx",e.SPACE_SIZE/2)("cy",e.SPACE_SIZE/2)("r",10)}}function D7(e,t){if(1&e&&(Cn(),pa(0,"g",null,12),ga(2,"rect",13),la(3,N7,1,5,"rect",14),la(4,R7,1,4,"ng-template",null,10,Ku),la(6,x7,1,3,"circle",3),fa()),2&e){const e=ca(5),t=Sa();ra("transform","translate("+t.chosen.get().x*t.SPACE_SIZE+" "+t.chosen.get().y*t.SPACE_SIZE+")"),Ts(2),ra("width",t.SPACE_SIZE)("height",t.SPACE_SIZE),Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function L7(e,t){if(1&e&&(Cn(),pa(0,"g",null,16),ga(2,"rect",17),fa()),2&e){const e=t.$implicit,n=Sa();Ts(2),ra("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)("transform","translate("+e.x*n.SPACE_SIZE+" "+e.y*n.SPACE_SIZE+")")}}function F7(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=Sa(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("x",0)("y",.75*e.SPACE_SIZE)("transform","translate("+-e.getPieceSize(e.pieceInHand.value)+", "+-e.getPieceSize(e.pieceInHand.value)+")")("width",2*e.getPieceSize(e.pieceInHand.value))("height",2*e.getPieceSize(e.pieceInHand.value))}}function U7(e,t){if(1&e&&(Cn(),ga(0,"circle",19)),2&e){const e=Sa(2);ha("ngClass",e.getPieceClasses(e.pieceInHand.value)),ra("cy",.75*e.SPACE_SIZE)("r",e.getPieceSize(e.pieceInHand.value))}}function B7(e,t){1&e&&(Cn(),ga(0,"circle",20)),2&e&&ra("cy",.75*Sa(2).SPACE_SIZE)("r",10)}function V7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,F7,1,6,"rect",9),la(2,U7,1,3,"ng-template",null,10,Ku),la(4,B7,1,2,"circle",18),fa()),2&e){const e=ca(3),t=Sa();Ts(1),ha("ngIf",t.pieceInHand.isRectangle())("ngIfElse",e),Ts(3),ha("ngIf",t.pieceHasDot(t.pieceInHand.value))}}function $7(e,t){if(1&e&&(Cn(),ga(0,"rect",27)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ra("x",n.SPACE_SIZE*e)("y",n.SPACE_SIZE*t)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}function z7(e,t){if(1&e&&(Cn(),ga(0,"rect",11)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ha("ngClass",n.getPieceClasses(4*t+e)),ra("x",n.SPACE_SIZE*e+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("y",n.SPACE_SIZE*t+n.SPACE_SIZE/2-n.getPieceSize(4*t+e))("width",2*n.getPieceSize(4*t+e))("height",2*n.getPieceSize(4*t+e))}}function H7(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ha("ngClass",n.getPieceClasses(4*t+e)),ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",n.getPieceSize(4*t+e))}}function G7(e,t){if(1&e&&(Cn(),ga(0,"circle")),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();ra("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)("r",10)}}function W7(e,t){if(1&e){const e=va();Cn(),pa(0,"g",25),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().choosePiece(4*n+t)}),la(1,$7,1,4,"rect",26),la(2,z7,1,5,"rect",9),la(3,H7,1,4,"ng-template",null,10,Ku),la(5,G7,1,3,"circle",3),fa()}if(2&e){const e=ca(4),t=Sa().index,n=Sa().index,r=Sa();Ta("id","choosePiece_",4*n+t,""),Ts(1),ha("ngIf",r.pieceToGive.value===4*n+t),Ts(1),ha("ngIf",(4*n+t)%4<2)("ngIfElse",e),Ts(3),ha("ngIf",r.pieceHasDot(4*n+t))}}function q7(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,W7,6,5,"g",24),fa()),2&e){const e=t.index,n=Sa().index,r=Sa();Ts(1),ha("ngIf",r.isRemaining(4*n+e))}}function j7(e,t){if(1&e&&(Cn(),pa(0,"g",null,21),ga(2,"rect",22,23),la(4,q7,2,1,"g",2),fa()),2&e){const e=t.$implicit,n=Sa();ra("transform","translate(0 "+6.5*n.SPACE_SIZE+")"),Ts(2),ra("x",-.125*n.SPACE_SIZE)("y",-.125*n.SPACE_SIZE)("width",4.25*n.SPACE_SIZE)("height",4.25*n.SPACE_SIZE),Ts(2),ha("ngForOf",e)}}let Z7=(()=>{class e extends u1{constructor(e){super(e),this.EMPTY=i7.EMPTY,this.chosen=Mw.empty(),this.lastMove=Mw.empty(),this.pieceInHand=i7.EMPTY,this.pieceToGive=i7.EMPTY,this.victoriousCoords=[],this.rules=new u7(o7),this.availableMinimaxes=[new h7(this.rules,"QuartoMinimax")],this.encoder=s7.encoder,this.tutorial=(new P7).tutorial,this.pieceInHand=this.rules.node.gameState.pieceInHand,this.updateBoard()}updateBoard(){const e=this.rules.node.gameState,t=this.rules.node.move;this.board=e.getCopiedBoard(),this.chosen=Mw.empty(),this.pieceInHand=e.pieceInHand,this.victoriousCoords=this.rules.getVictoriousCoords(e),this.lastMove=t.map(e=>e.coord)}chooseCoord(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#chooseCoord_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(n.hideLastMove(),n.board[t][e]===i7.EMPTY){if(n.showPieceInHandOnBoard(e,t),15===n.rules.node.gameState.turn){const r=new s7(e,t,i7.EMPTY);return n.chooseMove(r,n.rules.node.gameState)}if(n.pieceToGive===i7.EMPTY)return TW.SUCCESS;{const r=new s7(e,t,n.pieceToGive);return n.chooseMove(r,n.rules.node.gameState)}}return n.cancelMove(lJ.MUST_CLICK_ON_EMPTY_SPACE())})()}choosePiece(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#choosePiece_"+e);if(n.isFailure())return t.cancelMove(n.getReason());if(t.hideLastMove(),t.pieceToGive=i7.fromInt(e),t.chosen.isAbsent())return TW.SUCCESS;{const e=t.chosen.get(),n=new s7(e.x,e.y,t.pieceToGive);return t.chooseMove(n,t.rules.node.gameState)}})()}hideLastMove(){this.lastMove=Mw.empty()}cancelMoveAttempt(){this.hideLastMove(),this.pieceToGive=i7.EMPTY}showPieceInHandOnBoard(e,t){this.chosen=Mw.of(new JX(e,t))}isRemaining(e){return o7.isGivable(i7.fromInt(e),this.board,this.pieceInHand)}getSquareClasses(e,t){const n=new JX(e,t);return this.lastMove.equalsValue(n)?["moved"]:[]}getPieceClasses(e){const t=[];return t.push(e%2==0?"player0":"player1"),t}getPieceSize(e){return e<8?40:25}pieceHasDot(e){return e!==i7.EMPTY.value&&e%8<4}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-quarto"]],features:[Go],decls:11,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["transform","translate(5 5)"],[4,"ngFor","ngForOf"],[4,"ngIf"],["pieceInHandDiv",""],["x","0","y","0",1,"base","no-fill"],["rectangleInWhichThePieceInHandIsWaiting",""],["boardDiv",""],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf","ngIfElse"],["circle",""],[1,"base",3,"ngClass"],["chosenPiece",""],["id","highlight","x","0","y","0",1,"base","highlighted","mid-stroke"],["x","0","y","0","class","base",3,"ngClass",4,"ngIf","ngIfElse"],["x","0","y","0",1,"base",3,"ngClass"],["victoriousCoordsDiv",""],["id","victory","x","0","y","0",1,"base","no-fill","victory-stroke"],["cx","0",4,"ngIf"],["cx","0",1,"base",3,"ngClass"],["cx","0"],["remainingPiece",""],["stroke-dasharray","10, 10",1,"base","no-fill"],["rectangleInWhichTheRemainingPiecesAre",""],[3,"id","click",4,"ngIf"],[3,"id","click"],["class","base highlighted",4,"ngIf"],[1,"base","highlighted"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"g",1),la(2,M7,3,1,"g",2),la(3,D7,7,6,"g",3),la(4,L7,3,3,"g",2),pa(5,"g",null,4),ga(7,"rect",5,6),la(9,V7,5,3,"g",3),fa(),la(10,j7,5,6,"g",2),fa(),fa()),2&e&&(ra("viewBox","0 0 "+4.25*t.SPACE_SIZE+" "+10.75*t.SPACE_SIZE),Ts(2),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosen.isPresent()),Ts(1),ha("ngForOf",t.victoriousCoords),Ts(1),ra("transform","translate("+2*t.SPACE_SIZE+", "+4.5*t.SPACE_SIZE+")"),Ts(2),ra("width",1.5*t.SPACE_SIZE)("height",1.5*t.SPACE_SIZE)("transform","translate("+-.75*t.SPACE_SIZE+", 0)"),Ts(2),ha("ngIf",t.chosen.isAbsent()),Ts(1),ha("ngForOf",t.board))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),Y7=(()=>{class e{}return e.NO_INSIDE_CLICK=()=>$localize`You must pick a space from the edge of the board.`,e})();class K7 extends yJ{constructor(e,t,n){super(e,t),this.direction=n;const r=K7.isValidCoord(this.coord);if(r.isFailure())throw new Error(r.getReason());if(0===e&&n===QX.LEFT)throw new Error("Invalid direction: pawn on the left side can't be moved to the left.");if(4===e&&n===QX.RIGHT)throw new Error("Invalid direction: pawn on the right side can't be moved to the right.");if(0===t&&n===QX.UP)throw new Error("Invalid direction: pawn on the top side can't be moved up.");if(4===t&&n===QX.DOWN)throw new Error("Invalid direction: pawn on the bottom side can't be moved down.")}static isValidCoord(e){return e.isNotInRange(5,5)?TW.failure("Invalid coord for QuixoMove: "+e.toString()+" is outside the board."):0!==e.x&&4!==e.x&&0!==e.y&&4!==e.y?TW.failure(Y7.NO_INSIDE_CLICK()):TW.SUCCESS}toString(){return"QuixoMove("+this.coord.x+", "+this.coord.y+", "+this.direction.toString()+")"}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.direction===this.direction}}K7.encoder=new class extends FK{maxValue(){return 128}encodeNumber(e){const t=e.direction.toInt();return 20*e.coord.x+4*e.coord.y+t}decodeNumber(e){const t=QX.factory.fromInt(e%4).get();e-=e%4;const n=(e/=4)%5;return e-=e%5,new K7(e/=5,n,t)}};class Q7 extends fJ{static getInitialState(){const e=GK.createTable(5,5,VK.NONE);return new Q7(e,0)}applyLegalMove(e){const t=this.getCopiedBoard(),n=this.turn+1;let r=e.coord,i=e.coord.getNext(e.direction);for(;i.isInRange(5,5);)t[r.y][r.x]=t[i.y][i.x],r=r.getNext(e.direction),i=i.getNext(e.direction);return t[r.y][r.x]=this.getCurrentPlayer(),new Q7(t,n)}}class X7 extends PJ{static getVerticalCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=0;r<5;r++)e.gameState.getPieceAtXY(0,r)!==t&&n.push(new JX(0,r)),e.gameState.getPieceAtXY(4,r)!==t&&n.push(new JX(4,r));return n}static getHorizontalCenterCoords(e){const t=e.gameState.getCurrentOpponent(),n=[];for(let r=1;r<4;r++)e.gameState.getPieceAtXY(r,0)!==t&&n.push(new JX(r,0)),e.gameState.getPieceAtXY(r,4)!==t&&n.push(new JX(r,4));return n}static getPossibleDirections(e){const t=[];return 0!==e.x&&t.push(QX.LEFT),0!==e.y&&t.push(QX.UP),4!==e.x&&t.push(QX.RIGHT),4!==e.y&&t.push(QX.DOWN),t}static getLinesSums(e){const t={};t[BK.ZERO.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]},t[BK.ONE.value]={columns:[0,0,0,0,0],rows:[0,0,0,0,0],diagonals:[0,0]};for(let n=0;n<5;n++)for(let r=0;r<5;r++){const i=e.getPieceAtXY(r,n);if(i.isPlayer()){const e=i.value;t[e].columns[r]=t[e].columns[r]+1,t[e].rows[n]=t[e].rows[n]+1,r===n&&(t[e].diagonals[0]=t[e].diagonals[0]+1),r+n===4&&(t[e].diagonals[1]=t[e].diagonals[1]+1)}}return t}static getVictoriousCoords(e){const t=X7.getLinesSums(e),n=[];for(let r=0;r<2;r++){for(let e=0;e<5;e++){if(5===t[r].columns[e])for(let t=0;t<5;t++)n.push(new JX(e,t));if(5===t[r].rows[e])for(let t=0;t<5;t++)n.push(new JX(t,e))}if(5===t[r].diagonals[0])for(let e=0;e<5;e++)n.push(new JX(e,e));if(5===t[r].diagonals[1])for(let e=0;e<5;e++)n.push(new JX(e,4-e))}return n}static getFullestLine(e){const t=e.columns.concat(e.rows.concat(e.diagonals));return Math.max(...t)}applyLegalMove(e,t,n){return X7.applyLegalMove(e,t,n)}static applyLegalMove(e,t,n){return t.applyLegalMove(e)}isLegal(e,t){return t.getPieceAt(e.coord)===t.getCurrentOpponent()?SW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):SW.success(void 0)}getGameStatus(e){const t=e.gameState,n=X7.getLinesSums(t),r=X7.getFullestLine(n[BK.ZERO.value]),i=X7.getFullestLine(n[BK.ONE.value]),s=t.getCurrentPlayer();return 5===r&&(s===BK.ZERO||i<5)?SJ.ZERO_WON:5===i?SJ.ONE_WON:SJ.ONGOING}}class J7 extends cJ{getListMoves(e){const t=[],n=X7.getVerticalCoords(e),r=X7.getHorizontalCenterCoords(e).concat(n);for(const i of r){const e=X7.getPossibleDirections(i);for(const n of e){const e=new K7(i.x,i.y,n);t.push(e)}}return t}getBoardValue(e){const t=e.gameState,n=X7.getLinesSums(t),r=X7.getFullestLine(n[BK.ZERO.value]),i=X7.getFullestLine(n[BK.ONE.value]),s=t.getCurrentPlayer();return new uJ(5===r&&(s===BK.ZERO||i<5)?BK.ZERO.getVictoryValue():5===i?BK.ONE.getVictoryValue():i-r)}}class e9{static getArrowTransform(e,t,n){let r,i,s;switch(n){case QX.UP:r=0,i=-1,s=-90;break;case QX.DOWN:r=0,i=1,s=90;break;case QX.LEFT:r=-1,i=0,s=180;break;default:Ow.expectToBe(n,QX.RIGHT),r=1,i=0,s=0}return[`translate(${t.x*e+e/2+r*e/4} ${t.y*e+e/2+i*e/4})`,"scale(2.5)",`rotate(${s})`].join(" ")}}const t9=VK.NONE,n9=BK.ZERO,r9=BK.ONE;class i9{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game.`,$localize`At Quixo, the goal is to align 5 of your pieces.
        The first player plays with dark pieces, the second with light pieces.
        The board is made of 25 spaces spread over a 5x5 square.
        Every piece has a neutral side, a light side, and a dark side.`,Q7.getInitialState()),kJ.fromMove($localize`What a move looks like (without animation)`,$localize`When it is your turn:
        <ol>
            <li>Click on one of your pieces or on a neutral one. You cannot choose a piece of the opponent.
                You can only choose a piece from the edge of the board.</li>
            <li>Pick a direction in which you want to send the piece (by clicking on the arrow).</li>
        </ol>
        You have to imagine that the piece you picked has been moved to the other side of the board, in the chosen direction.
        Once on the other side, all pieces will move by one space in the opposing direction.
        Afterwards, if the piece was neutral, it will become yours and takes your color.<br/><br/>
        For example, take the bottom right neutral piece, and move it to the left (you're playing Light).`,new Q7([[t9,t9,t9,t9,t9],[t9,t9,t9,t9,t9],[t9,t9,t9,t9,t9],[t9,t9,t9,t9,t9],[n9,n9,n9,n9,t9]],1),[new K7(4,4,QX.LEFT)],$localize`See how the four dark pieces have been moved one space to the right.
        The neutral piece has been move 4 pieces to the left and has become light.`,$localize`Failed!`),kJ.fromMove($localize`Victory`,$localize`You already know everything you need in order to play, but there is one last particularity.
        If you create a line of 5 of your pieces, you win.
        If you create a line of 5 of your opponent's pieces, you lose.
        If you create both, you lose too!<br/><br/>
        You can win with this board, try it.
        You're playing Light.`,new Q7([[t9,r9,t9,r9,r9],[t9,n9,n9,t9,n9],[r9,r9,r9,n9,r9],[n9,t9,n9,r9,r9],[r9,n9,t9,r9,n9]],31),[new K7(3,0,QX.DOWN)],$localize`Congratulations, you won!`,$localize`Failed!`)]}}function s9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",4),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onBoardClick(t,n)}),fa(),fa()}if(2&e){const e=t.index,n=Sa().index,r=Sa();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getPieceClasses(e,n)),ra("cx",50+100*e)("cy",50+100*n)}}function o9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,s9,2,5,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function a9(e,t){if(1&e){const e=va();Cn(),pa(0,"use",6),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa(2);Ta("id","chooseDirection_",e,""),ra("transform",n.getArrowTransform(n.chosenCoord.get(),e))}}function l9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,a9,1,2,"use",5),fa()),2&e){const e=Sa();Ts(1),ha("ngForOf",e.getPossiblesDirections())}}let c9=(()=>{class e extends u1{constructor(e){super(e),this.lastMoveCoord=Mw.empty(),this.chosenCoord=Mw.empty(),this.victoriousCoords=[],this.rules=new X7(Q7),this.availableMinimaxes=[new J7(this.rules,"QuixoMinimax")],this.encoder=K7.encoder,this.tutorial=(new i9).tutorial,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.board=this.state.board,this.lastMoveCoord=this.rules.node.move.map(e=>e.coord),this.victoriousCoords=X7.getVictoriousCoords(this.state)}cancelMoveAttempt(){this.chosenCoord=Mw.empty()}getPieceClasses(e,t){const n=new JX(e,t),r=[];return r.push(this.getPlayerClass(this.board[t][e])),this.chosenCoord.equalsValue(n)?r.push("selected"):this.lastMoveCoord.equalsValue(n)&&r.push("last-move"),this.victoriousCoords.some(e=>e.equals(n))&&r.push("victory-stroke"),r}onBoardClick(e,t){const n=this.canUserPlay("#click_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=new JX(e,t),i=K7.isValidCoord(r);return i.isFailure()?this.cancelMove(i.getReason()):this.board[t][e]===this.state.getCurrentOpponent()?this.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(this.chosenCoord=Mw.of(r),TW.SUCCESS)}getPossiblesDirections(){const e=[],t=this.chosenCoord.get();return 4!==t.x&&e.push("RIGHT"),0!==t.x&&e.push("LEFT"),4!==t.y&&e.push("DOWN"),0!==t.y&&e.push("UP"),e}chooseDirection(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#chooseDirection_"+e);return n.isFailure()?t.cancelMove(n.getReason()):(t.chosenDirection=QX.factory.fromString(e).get(),yield t.tryMove())})()}tryMove(){var e=this;return Pw(function*(){const t=e.chosenCoord.get(),n=new K7(t.x,t.y,e.chosenDirection);return e.cancelMove(),e.chooseMove(n,e.rules.node.gameState)})()}getArrowTransform(e,t){return e9.getArrowTransform(this.SPACE_SIZE,e,QX.factory.fromString(t).get())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-quixo"]],features:[Go],decls:5,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 500 500","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -3.5, 10 0, 0 3.5"],[4,"ngFor","ngForOf"],[4,"ngIf"],["r","45",1,"base",3,"id","ngClass","click"],[0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),fa(),la(3,o9,2,1,"g",2),la(4,l9,2,1,"g",3),fa()),2&e&&(Ts(3),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),u9=(()=>{class e extends fJ{static getInitialState(){const t=GK.createTable(e.BOARD_WIDTH,e.BOARD_HEIGHT,VK.NONE);return t[3][3]=BK.ZERO,t[4][4]=BK.ZERO,t[3][4]=BK.ONE,t[4][3]=BK.ONE,new e(t,0)}static getNeighbooringPawnLike(e,t,n,r){let i;const s=[];for(let o=-1;o<2;o++)for(let a=-1;a<2;a++)i=new JX(n+a,r+o),i.isInRange(this.BOARD_WIDTH,this.BOARD_HEIGHT)&&e[i.y][i.x]===t&&s.push(i);return s}countScore(){const t=[0,0];for(let n=0;n<e.BOARD_HEIGHT;n++)for(let r=0;r<e.BOARD_WIDTH;r++){const e=this.board[n][r];e.isPlayer()&&(t[e.value]+=1)}return t}}return e.BOARD_WIDTH=8,e.BOARD_HEIGHT=8,e})();class h9 extends yJ{equals(e){return e===this||e.coord.equals(this.coord)}toString(){return"ReversiMove("+this.coord.x+", "+this.coord.y+")"}}h9.encoder=new class extends FK{maxValue(){return(u9.BOARD_HEIGHT-1)*u9.BOARD_WIDTH+(u9.BOARD_WIDTH-1)}encodeNumber(e){return e.coord.y*u9.BOARD_WIDTH+e.coord.x}decodeNumber(e){const t=e%u9.BOARD_WIDTH;return new h9(t,(e-t)/u9.BOARD_WIDTH)}},h9.PASS=new h9(-1,-1),h9.PASS_NUMBER=h9.encoder.encodeNumber(h9.PASS);let d9=(()=>{class e{}return e.NO_ELEMENT_SWITCHED=()=>$localize`Your move should switch at least one piece.`,e})();class p9{constructor(e,t){this.move=e,this.switched=t}}let f9=(()=>{class e extends PJ{static getGameStatus(t){const n=t.gameState;if(!1===e.isGameEnded(n))return SJ.ONGOING;const r=n.countScore(),i=r[1]-r[0];return i<0?SJ.ZERO_WON:i>0?SJ.ONE_WON:SJ.DRAW}applyLegalMove(e,t,n){const r=t.turn,i=t.getCurrentPlayer(),s=t.getCopiedBoard();if(e.equals(h9.PASS))return new u9(s,r+1);for(const o of n)s[o.y][o.x]=i;return s[e.coord.y][e.coord.x]=i,new u9(s,r+1)}static getAllSwitcheds(t,n,r){const i=[],s=n.getOpponent();for(const o of KX.DIRECTIONS){const a=t.coord.getNext(o);if(a.isInRange(u9.BOARD_WIDTH,u9.BOARD_HEIGHT)&&r[a.y][a.x]===s){const t=e.getSandwicheds(n,o,a,r);for(const e of t)i.push(e)}}return i}static getSandwicheds(e,t,n,r){const i=[n];let s=n.getNext(t);for(;s.isInRange(u9.BOARD_WIDTH,u9.BOARD_HEIGHT);){const n=r[s.y][s.x];if(n===e)return i;if(n===VK.NONE)return[];i.push(s),s=s.getNext(t)}return[]}static isGameEnded(e){return this.playerCanOnlyPass(e)&&this.nextPlayerCantOnlyPass(e)}getGameStatus(t){return e.getGameStatus(t)}static playerCanOnlyPass(e){const t=this.getListMoves(e);return 1===t.length&&t[0].move.equals(h9.PASS)}static nextPlayerCantOnlyPass(e){const t=e.getCopiedBoard(),n=new u9(t,e.turn+1);return this.playerCanOnlyPass(n)}static getListMoves(t){const n=[];let r;const i=t.getCurrentPlayer(),s=t.getCurrentOpponent();for(let o=0;o<8;o++)for(let a=0;a<8;a++)if(t.getPieceAtXY(a,o)===VK.NONE&&(r=t.getCopiedBoard(),u9.getNeighbooringPawnLike(r,s,a,o).length>0)){const s=new h9(a,o),l=e.getAllSwitcheds(s,i,r);if(l.length>0){for(const e of l)NW(i!==t.getPieceAt(e),e+"was already switched!"),r[e.y][e.x]=i;r[o][a]=i,n.push(new p9(s,l.length))}}return 0===n.length&&n.push(new p9(h9.PASS,0)),n}isLegal(t,n){if(t.equals(h9.PASS))return e.playerCanOnlyPass(n)?SW.success([]):SW.failure(lJ.MUST_PASS());if(n.getPieceAt(t.coord).isPlayer())return Tw(e.VERBOSE,"ReversiRules.isLegal: you cannot play on a busy space"),SW.failure(lJ.MUST_CLICK_ON_EMPTY_SPACE());const r=n.getCopiedBoard(),i=e.getAllSwitcheds(t,n.getCurrentPlayer(),r);return Tw(e.VERBOSE,"ReversiRules.isLegal: "+i.length+" element(s) switched"),0===i.length?SW.failure(d9.NO_ELEMENT_SWITCHED()):SW.success(i)}}return e.VERBOSE=!1,e})();class g9 extends cJ{getBoardValue(e){const t=f9.getGameStatus(e);if(t.isEndGame)return uJ.fromWinner(t.winner);const n=e.gameState.getCopiedBoard();let r=0,i=0;for(let s=0;s<u9.BOARD_HEIGHT;s++)for(let e=0;e<u9.BOARD_WIDTH;e++){const t=(0===e||e===u9.BOARD_WIDTH-1?4:1)*(0===s||s===u9.BOARD_HEIGHT-1?4:1);n[s][e]===BK.ZERO&&(r+=t),n[s][e]===BK.ONE&&(i+=t)}return r*=BK.ZERO.getScoreModifier(),i*=BK.ONE.getScoreModifier(),new uJ(i+r)}getListMoves(e){const t=f9.getListMoves(e.gameState);return GK.sortByDescending(t,e=>g9.bestCoords.some(t=>e.move.coord.equals(t))?100:e.switched),t.map(e=>e.move)}}g9.bestCoords=[new JX(0,0),new JX(0,u9.BOARD_HEIGHT-1),new JX(u9.BOARD_WIDTH-1,0),new JX(u9.BOARD_WIDTH-1,u9.BOARD_HEIGHT-1)];const m9=VK.NONE,y9=BK.ZERO,v9=BK.ONE;class _9{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`At Reversi, the pieces are double sided: one dark side for the first player, one light side for the second player.
        When one piece is flipped, its owner changes.
        The player owning the most pieces at the end of the game wins.
        Here, Dark has 28 points and Light has 36, hence Light wins.`,new u9([[y9,y9,y9,y9,y9,y9,y9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,y9,y9,y9,y9,y9,y9,y9]],60)),kJ.anyMove($localize`Capture (1/2)`,$localize`At the beginning of the game, pieces are placed as shown here.
        For a move to be legal, it must sandwich at least one piece of the opponent between the piece you're putting and another of your pieces.<br/><br/>
        Do any move by clicking to put your piece
        Dark plays first.`,u9.getInitialState(),new h9(2,4),$localize`Congratulations!`),kJ.fromMove($localize`Capture (2/2)`,$localize`A move can also capture a bigger line, and more than one lines at a time
        You're playing light here.<br/><br/>
        Play on the bottom left to see an example.`,new u9([[m9,m9,m9,m9,m9,m9,m9,m9],[m9,m9,m9,m9,m9,m9,m9,m9],[m9,m9,m9,m9,m9,m9,m9,m9],[m9,m9,m9,m9,v9,m9,m9,m9],[m9,m9,m9,y9,m9,m9,m9,m9],[m9,m9,y9,m9,m9,m9,m9,m9],[y9,y9,m9,m9,m9,m9,m9,m9],[m9,y9,v9,y9,v9,y9,m9,m9]],1),[new h9(0,7)],$localize`Congratulations!`,$localize`Lower and more to the left, please.`),kJ.informational($localize`Passing a turn`,$localize`If, during its turn, a player has no move that would allow that player to flip a piece, that player must pass
        Moreover, if the next player could not play neither, the game ends before the board is full, and points are counted in the usual way.`,new u9([[v9,y9,y9,y9,y9,y9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[y9,v9,v9,v9,v9,v9,v9,y9],[v9,v9,v9,v9,v9,v9,m9,m9],[y9,y9,y9,y9,y9,y9,m9,m9]],60))]}}function C9(e,t){if(1&e&&(Cn(),ga(0,"circle",4)),2&e){const e=Sa().index,t=Sa().index,n=Sa();ha("ngClass",n.getPieceClass(e,t)),ra("r",n.SPACE_SIZE/2-n.STROKE_WIDTH)("cx",n.SPACE_SIZE*e+n.SPACE_SIZE/2)("cy",n.SPACE_SIZE*t+n.SPACE_SIZE/2)}}function E9(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",2),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),fa(),la(2,C9,1,4,"circle",3),fa()}if(2&e){const e=t.index,n=Sa().index,r=Sa();Ts(1),Ia("id","click_",e,"_",n,""),ha("ngClass",r.getRectClasses(e,n)),ra("x",r.SPACE_SIZE*e)("y",r.SPACE_SIZE*n)("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function w9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,E9,3,8,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let b9=(()=>{class e extends u1{constructor(e){super(e),this.EMPTY=VK.NONE,this.lastMove=new JX(-2,-2),this.captureds=[],this.scores=Mw.of([2,2]),this.rules=new f9(u9),this.availableMinimaxes=[new g9(this.rules,"ReversiMinimax")],this.encoder=h9.encoder,this.tutorial=(new _9).tutorial,this.canPass=!1,this.updateBoard()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);if(r.isFailure())return n.cancelMove(r.getReason());const i=new h9(e,t);return yield n.chooseMove(i,n.rules.node.gameState,n.scores.get())})()}updateBoard(){const e=this.rules.node.gameState;this.board=e.getCopiedBoard(),this.captureds=[],this.rules.node.move.isPresent()?this.showPreviousMove():this.lastMove=new JX(-2,-2),this.scores=Mw.of(e.countScore()),this.canPass=f9.playerCanOnlyPass(e)}showPreviousMove(){this.lastMove=this.rules.node.move.get().coord;const e=this.rules.node.gameState.getCurrentPlayer(),t=this.rules.node.gameState.getCurrentOpponent();for(const n of KX.DIRECTIONS){let r=this.lastMove.getNext(n,1);for(;r.isInRange(u9.BOARD_WIDTH,u9.BOARD_HEIGHT)&&this.rules.node.gameState.getPieceAt(r)===t&&this.rules.node.mother.get().gameState.getPieceAt(r)===e;)this.captureds.push(r),r=r.getNext(n,1)}}getRectClasses(e,t){const n=new JX(e,t);return this.captureds.some(e=>e.equals(n))?["captured"]:n.equals(this.lastMove)?["moved"]:[]}getPieceClass(e,t){return this.getPlayerClass(this.board[t][e])}pass(){var e=this;return Pw(function*(){return NW(e.canPass,"ReversiComponent: pass() can only be called if canPass is true"),e.onClick(h9.PASS.coord.x,h9.PASS.coord.y)})()}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-reversi"]],features:[Go],decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[1,"base",3,"id","ngClass","click"],["class","base",3,"ngClass",4,"ngIf"],[1,"base",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,w9,2,1,"g",1),fa()),2&e&&(ra("viewBox","0 -4 "+8*t.SPACE_SIZE+" "+(10+8*t.SPACE_SIZE)),Ts(1),ha("ngForOf",t.board))},directives:[tp,Jd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),S9=(()=>{class e extends l0{static getInitialState(){const t=nJ.UNREACHABLE,n=nJ.ZERO,r=nJ.ONE,i=nJ.EMPTY;return new e([[t,t,n,r,i,i,i,n,r,t,t],[t,i,i,i,i,i,i,i,i,i,t],[r,i,i,i,i,i,i,i,i,i,n],[n,i,i,i,i,i,i,i,i,i,r],[t,i,i,i,i,i,i,i,i,i,t],[t,t,r,n,i,i,i,r,n,t,t]],0)}}return e.HEIGHT=6,e.WIDTH=11,e})(),P9=(()=>{class e{}return e.CAN_ONLY_REBOUND_ON_BLACK=()=>$localize`You can only rebound on dark spaces.`,e.CAN_ONLY_REBOUND_ON_EMPTY_SPACE=()=>$localize`You can only rebound on empty spaces.`,e.MUST_CHOOSE_PYRAMID_FIRST=()=>$localize`You must pick one of your pyramids first.`,e.MUST_CHOOSE_OWN_PYRAMID=()=>$localize`You must pick one of your pyramids.`,e.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS=()=>$localize`Those two spaces are not neighbors.`,e.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR=()=>$localize`Those two spaces have no intermediary neighbor.`,e})();class O9 extends C1{constructor(e,t){super(e,t)}static checkDistanceAndLocation(e,t){const n=Math.abs(e.x-t.x)+Math.abs(e.y-t.y);if(0===n)return TW.failure(lJ.MOVE_CANNOT_BE_STATIC());if(1===n){const n=a0.getFakeNeighbors(e);if(t.equals(n))return TW.failure(P9.THOSE_TWO_SPACES_ARE_NOT_NEIGHBORS())}else{if(2!==n)return TW.failure($localize`You can move one or two spaces, not ${n}.`);if((e.x+e.y)%2==0)return TW.failure(P9.CAN_ONLY_REBOUND_ON_BLACK());if(e.x===t.x)return TW.failure(P9.THOSE_TWO_SPACES_HAVE_NO_COMMON_NEIGHBOR())}return TW.SUCCESS}static from(e,t){if(!e.isInRange(S9.WIDTH,S9.HEIGHT))throw new Error("Move must start inside the board not at "+e.toString()+".");if(!t.isInRange(S9.WIDTH,S9.HEIGHT))throw new Error("Move must end inside the board not at "+t.toString()+".");const n=O9.checkDistanceAndLocation(e,t);return n.isFailure()?n.toFailedFallible():SW.success(new O9(e,t))}isSimpleStep(){return Math.abs(this.coord.x-this.end.x)+Math.abs(this.coord.y-this.end.y)===1}equals(e){return e===this||!!e.coord.equals(this.coord)&&e.end.equals(this.end)}toString(){return"SaharaMove("+this.coord+"->"+this.end+")"}}O9.encoder=new class extends FK{maxValue(){return 396*S9.WIDTH+66*S9.HEIGHT+6*S9.WIDTH+S9.HEIGHT}encodeNumber(e){return 396*e.coord.x+66*e.coord.y+6*e.end.x+e.end.y}decodeNumber(e){const t=e%6;e-=t;const n=(e/=6)%11;e-=n;const r=(e/=11)%6;return e-=r,O9.from(new JX(e/=6,r),new JX(n,t)).get()}};let T9=(()=>{class e extends PJ{static getStartingCoords(e,t){const n=[];for(let r=0;r<S9.HEIGHT;r++)for(let i=0;i<S9.WIDTH;i++)e[r][i].is(t)&&n.push(new JX(i,r));return n}static getBoardValuesFor(t,n){const r=e.getStartingCoords(t,n),i=[];for(const e of r){const n=l0.getEmptyNeighbors(t,e,nJ.EMPTY).length;if(0===n)return[0];i.push(n)}return i.sort((e,t)=>e-t)}applyLegalMove(t,n,r){Tw(e.VERBOSE,"Legal move "+t.toString()+" applied");const i=n.getCopiedBoard();return i[t.end.y][t.end.x]=i[t.coord.y][t.coord.x],i[t.coord.y][t.coord.x]=nJ.EMPTY,new S9(i,n.turn+1)}isLegal(e,t){if(t.getPieceAt(e.coord).value!==t.getCurrentPlayer().value)return SW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE());if(t.getPieceAt(e.end)!==nJ.EMPTY)return SW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE());const n=a0.getCommonNeighbor(e.coord,e.end);return n.isPresent()?t.getPieceAt(n.get())===nJ.EMPTY?SW.success(void 0):SW.failure(P9.CAN_ONLY_REBOUND_ON_EMPTY_SPACE()):SW.success(void 0)}getGameStatus(t){const n=t.gameState.getCopiedBoard(),r=e.getBoardValuesFor(n,BK.ZERO),i=e.getBoardValuesFor(n,BK.ONE);return e.getGameStatusFromFreedoms(r,i)}static getGameStatusFromFreedoms(e,t){return 0===e[0]?SJ.ONE_WON:0===t[0]?SJ.ZERO_WON:SJ.ONGOING}}return e.VERBOSE=!1,e})();class I9 extends cJ{getListMoves(e){const t=[],n=e.gameState.getCopiedBoard(),r=e.gameState.getCurrentPlayer(),i=T9.getStartingCoords(n,r);for(const s of i){const e=l0.getEmptyNeighbors(n,s,nJ.EMPTY);for(const r of e){const e=O9.from(s,r).get();if(n[r.y][r.x]=n[s.y][s.x],n[s.y][s.x]=nJ.EMPTY,t.push(e),(r.y+r.x)%2==0){const e=l0.getEmptyNeighbors(n,r,nJ.EMPTY);for(const i of e)if(!i.equals(s)){const e=O9.from(s,i).get();n[i.y][i.x]=n[r.y][r.x],n[r.y][r.x]=nJ.EMPTY,t.push(e),n[r.y][r.x]=n[i.y][i.x],n[i.y][i.x]=nJ.EMPTY}}n[s.y][s.x]=n[r.y][r.x],n[r.y][r.x]=nJ.EMPTY}}return t}getBoardValue(e){const t=e.gameState.getCopiedBoard(),n=T9.getBoardValuesFor(t,BK.ZERO),r=T9.getBoardValuesFor(t,BK.ONE),i=T9.getGameStatusFromFreedoms(n,r);if(i.isEndGame)return uJ.fromWinner(i.winner);let s=0;for(;s<6&&n[s]===r[s];)s++;return new uJ(r[s%6]-n[s%6])}}const k9=nJ.UNREACHABLE,A9=nJ.ZERO,M9=nJ.ONE,N9=nJ.EMPTY;class R9{constructor(){this.tutorial=[kJ.informational($localize`Initial board`,$localize`Sâhârâ is played on a board where each space is a triangle.
        Each player has six pyramids.`,S9.getInitialState()),kJ.informational($localize`Goal of the game`,$localize`At Sâhârâ, the goal of the game is to immobilize one of the opponent's pyramids.
        To do so, you have to occupy all neighboring space of that pyramid.
        Here, Light has lost because its leftmost pyramid is immobilized.`,new S9([[k9,k9,N9,N9,M9,N9,N9,A9,M9,k9,k9],[k9,N9,N9,N9,N9,N9,N9,N9,N9,N9,k9],[M9,A9,N9,N9,N9,N9,N9,N9,N9,N9,A9],[A9,N9,N9,N9,N9,N9,N9,N9,N9,N9,M9],[k9,N9,N9,N9,N9,N9,N9,N9,N9,N9,k9],[k9,k9,M9,A9,N9,N9,N9,M9,A9,k9,k9]],3)),kJ.fromPredicate($localize`Simple step`,$localize`To immobilize your opponent, you have to move your pyramids.
        When a pyramid shares its vertices with light spaces, it can move on these spaces (we call this a simple step).
        You're the first player, playing with the dark pyramids.
        <ol>
            <li>Click on one of your pyramids.</li>
            <li>Click on one of its two or three neighboring spaces in order to move your pyramid there.</li>
        </ol><br/>
        Do any simple step.`,S9.getInitialState(),O9.from(new JX(2,0),new JX(2,1)).get(),(e,t)=>e.isSimpleStep()?TW.SUCCESS:TW.failure($localize`You have made a double step, which is good but it is the next exercise!`),$localize`Congratulations!`),kJ.fromPredicate($localize`Double step`,$localize`When a pyramid shares its vertices with dark spaces, it can move one or two steps.
        To do so:
        <ol>
            <li>Click on the pyramid to move.</li>
            <li>Click on one of the 6 destinations that you can reach in two steps:
                 the 6 neighboring light spaces of the 3 dark spaces that are neighbors of your pyramid.
        </ol>`,S9.getInitialState(),O9.from(new JX(7,0),new JX(5,0)).get(),(e,t)=>e.isSimpleStep()?TW.failure($localize`Failed! You have made a single step.`):TW.SUCCESS,$localize`Congratulations!`)]}}function x9(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"polyline",6),fa()),2&e){const e=Sa().index,t=Sa().index,n=Sa();Ts(1),ha("ngClass",n.getPlayerClassFor(e,t)),ra("points",n.getPyramidCoordinate(e,t))}}function D9(e,t){if(1&e&&(Cn(),ga(0,"polyline",9)),2&e){const e=Sa(2).index,t=Sa().index;ra("points",Sa().getTriangleCoordinate(e,t))}}function L9(e,t){if(1&e&&(Cn(),ga(0,"polyline",10)),2&e){const e=Sa(2).index,t=Sa().index;ra("points",Sa().getTriangleCoordinate(e,t))}}function F9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,D9,1,1,"polyline",7),la(2,L9,1,1,"polyline",8),fa()),2&e){const e=Sa().index,t=Sa().index;Ts(1),ha("ngIf",(e+t)%2==1),Ts(1),ha("ngIf",(e+t)%2==0)}}function U9(e,t){if(1&e){const e=va();Cn(),pa(0,"g",5),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),la(1,x9,2,2,"g",2),la(2,F9,3,2,"g",2),fa()}if(2&e){const e=t.$implicit;Ia("id","click_",t.index,"_",Sa().index,""),Ts(1),ha("ngIf",e.isPlayer()),Ts(1),ha("ngIf",2===e.value)}}function B9(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,U9,3,4,"g",4),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function V9(e,t){if(1&e&&(Cn(),ma(0),ga(1,"polyline",11),ga(2,"polyline",11),ya()),2&e){const e=Sa();Ts(1),ra("points",e.getTriangleCoordinate(e.lastCoord.get().x,e.lastCoord.get().y)),Ts(1),ra("points",e.getTriangleCoordinate(e.lastMoved.get().x,e.lastMoved.get().y))}}function $9(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=Sa();ra("points",e.getTriangleCoordinate(e.chosenCoord.get().x,e.chosenCoord.get().y))}}let z9=(()=>{class e extends r0{constructor(e){super(e),this.lastCoord=Mw.empty(),this.lastMoved=Mw.empty(),this.chosenCoord=Mw.empty(),this.rules=new T9(S9),this.availableMinimaxes=[new I9(this.rules,"SaharaMinimax")],this.encoder=O9.encoder,this.tutorial=(new R9).tutorial,this.updateBoard()}cancelMoveAttempt(){this.chosenCoord=Mw.empty()}onClick(e,t){var n=this;return Pw(function*(){const r=n.canUserPlay("#click_"+e+"_"+t);return r.isFailure()?n.cancelMove(r.getReason()):n.chosenCoord.isAbsent()?n.choosePiece(e,t):n.chooseLandingCoord(e,t)})()}choosePiece(e,t){return this.board[t][e]===nJ.EMPTY?this.cancelMove(P9.MUST_CHOOSE_PYRAMID_FIRST()):this.board[t][e].value===this.getTurn()%2?(this.chosenCoord=Mw.of(new JX(e,t)),TW.SUCCESS):this.cancelMove(P9.MUST_CHOOSE_OWN_PYRAMID())}chooseLandingCoord(e,t){var n=this;return Pw(function*(){const r=new JX(e,t),i=n.rules.node.gameState.getCurrentPlayer(),s=nJ.ofPlayer(i);if(n.board[t][e]===s)return n.chosenCoord=Mw.of(new JX(e,t)),TW.SUCCESS;const o=O9.from(n.chosenCoord.get(),r);return o.isFailure()?n.cancelMove(o.getReason()):yield n.chooseMove(o.get(),n.rules.node.gameState)})()}updateBoard(){this.chosenCoord=Mw.empty();const e=this.rules.node.move;this.lastCoord=e.map(e=>e.coord),this.lastMoved=e.map(e=>e.end),this.board=this.rules.node.gameState.board}getPlayerClassFor(e,t){return this.getPlayerClass(BK.of(this.board[t][e].value))}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-sahara"]],features:[Go],decls:4,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","-4 -4 300 308","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","base no-fill small-stroke selected",4,"ngIf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"base","small-stroke",3,"ngClass"],["class","base small-stroke",4,"ngIf"],["class","base small-stroke background2",4,"ngIf"],[1,"base","small-stroke"],[1,"base","small-stroke","background2"],[1,"base","no-fill","small-stroke","highlighted"],[1,"base","no-fill","small-stroke","selected"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,B9,2,1,"g",1),la(2,V9,3,2,"ng-container",2),la(3,$9,1,1,"polyline",3),fa()),2&e&&(Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngIf",t.lastMoved.isPresent()),Ts(1),ha("ngIf",t.chosenCoord.isPresent()))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class H9 extends yJ{constructor(e,t,n,r){super(e,t),this.x=e,this.y=t,this.moveDirection=n,this.landingOrientation=r,this.checkValidity()}checkValidity(){const e=this.coord.isInRange(5,5);if(this.isRotation()){if(!e)throw new Error("Cannot rotate piece outside the board: "+this.toString()+".")}else if(this.coord.getNext(this.moveDirection.get()).isNotInRange(5,5)){if(!e)throw new Error("SiamMove should end or start on the board: "+this.toString()+".");if(this.moveDirection.get()!==this.landingOrientation)throw new Error("SiamMove should have moveDirection and landingOrientation matching when a piece goes out of the board: "+this.toString()+".")}}isRotation(){return this.moveDirection.isAbsent()}equals(e){return this===e||!(!this.coord.equals(e.coord)||!1===this.moveDirection.equals(e.moveDirection))&&this.landingOrientation===e.landingOrientation}toString(){const e=this.moveDirection.isAbsent()?"-":this.moveDirection.get().toString();return"SiamMove("+this.coord.x+", "+this.coord.y+", "+e+", "+this.landingOrientation+")"}isInsertion(){return-1===this.coord.x||5===this.coord.x||-1===this.coord.y||5===this.coord.y}}H9.encoder=new class extends FK{maxValue(){return 2408}encodeNumber(e){const t=e.coord.y+1,n=e.coord.x+1,r=e.moveDirection.isAbsent()?4:e.moveDirection.get().toInt();return 245*e.landingOrientation.toInt()+49*r+7*n+t}decodeNumber(e){const t=e%7;e-=t;const n=(e/=7)%7;e-=n;const r=(e/=7)%5,i=4===r?Mw.empty():QX.factory.fromInt(r).toOptional();e-=r;const s=QX.factory.fromInt(e/=5).get();return new H9(n-1,t-1,i,s)}};class G9{constructor(e){this.value=e}static decode(e){switch(e){case 0:return G9.EMPTY;case 1:return G9.WHITE_UP;case 2:return G9.WHITE_RIGHT;case 3:return G9.WHITE_DOWN;case 4:return G9.WHITE_LEFT;case 5:return G9.BLACK_UP;case 6:return G9.BLACK_RIGHT;case 7:return G9.BLACK_DOWN;case 8:return G9.BLACK_LEFT;case 9:return G9.MOUNTAIN}}belongTo(e){return e===BK.ZERO?1<=this.value&&this.value<=4:5<=this.value&&this.value<=8}isEmptyOrMountain(){return 0===this.value||9===this.value}isPiece(){return!this.isEmptyOrMountain()}getOwner(){return 1<=this.value&&this.value<=4?BK.ZERO:5<=this.value&&this.value<=8?BK.ONE:VK.NONE}getOptionalDirection(){switch(this.value){case 0:return Mw.empty();case 1:case 5:return Mw.of(QX.UP);case 2:case 6:return Mw.of(QX.RIGHT);case 3:case 7:return Mw.of(QX.DOWN);case 4:case 8:return Mw.of(QX.LEFT);default:return Ow.expectToBe(this.value,9),Mw.empty()}}static of(e,t){return t===BK.ZERO?e===QX.UP?G9.WHITE_UP:e===QX.RIGHT?G9.WHITE_RIGHT:e===QX.DOWN?G9.WHITE_DOWN:G9.WHITE_LEFT:e===QX.UP?G9.BLACK_UP:e===QX.RIGHT?G9.BLACK_RIGHT:e===QX.DOWN?G9.BLACK_DOWN:G9.BLACK_LEFT}getDirection(){return this.getOptionalDirection().get()}toString(){switch(this.value){case 0:return"EMPTY";case 1:return"WHITE_UP";case 2:return"WHITE_RIGHT";case 3:return"WHITE_DOWN";case 4:return"WHITE_LEFT";case 5:return"BLACK_UP";case 6:return"BLACK_RIGHT";case 7:return"BLACK_DOWN";case 8:return"BLACK_LEFT";default:return Ow.expectToBe(this.value,9),"MOUNTAIN"}}}G9.EMPTY=new G9(0),G9.WHITE_UP=new G9(1),G9.WHITE_RIGHT=new G9(2),G9.WHITE_DOWN=new G9(3),G9.WHITE_LEFT=new G9(4),G9.BLACK_UP=new G9(5),G9.BLACK_RIGHT=new G9(6),G9.BLACK_DOWN=new G9(7),G9.BLACK_LEFT=new G9(8),G9.MOUNTAIN=new G9(9);class W9 extends fJ{static getInitialState(){const e=GK.createTable(5,5,G9.EMPTY);return e[2][1]=G9.MOUNTAIN,e[2][2]=G9.MOUNTAIN,e[2][3]=G9.MOUNTAIN,new W9(e,0)}countPlayerPawn(){let e=0;for(let t=0;t<5;t++)for(let n=0;n<5;n++)this.board[t][n].belongTo(this.getCurrentPlayer())&&e++;return e}}let q9=(()=>{class e{}return e.CANNOT_INSERT_WHEN_SELECTED=()=>$localize`You cannot insert a piece when you have already selected a piece.`,e.NO_REMAINING_PIECE_TO_INSERT=()=>$localize`You cannot insert a piece, all your pieces are already on the board.`,e.NOT_ENOUGH_FORCE_TO_PUSH=()=>$localize`You do not have enough strength to push.`,e.ILLEGAL_ROTATION=()=>$localize`You cannot push and turn at the same time.`,e.ILLEGAL_PUSH=()=>$localize`Your push is invalid: it is either not straight, is not pushing anything, or is leaving the board.`,e.MUST_INSERT_OR_CHOOSE_YOUR_PIECE=()=>$localize`You should insert or choose one of your pieces!`,e})();class j9{constructor(e,t){this.resultingBoard=e,this.moved=t}}let Z9=(()=>{class e extends PJ{isLegal(t,n){if(Tw(e.VERBOSE,{SiamRules_isLegal:{move:t,state:n}}),!t.isInsertion()&&!n.getPieceAt(t.coord).belongTo(n.getCurrentPlayer()))return SW.failure(lJ.MUST_CHOOSE_PLAYER_PIECE());if(t.isRotation())return Tw(e.VERBOSE,"Move is rotation"),this.isLegalRotation(t,n);{let r;if(t.isInsertion()){Tw(e.VERBOSE,"Move is insertion");const i=this.isLegalInsertion(t.coord,n);if(i.legal.isFailure())return SW.failure(i.legal.getReason());r=i.insertedPiece}else Tw(e.VERBOSE,"Move is forward"),r=n.getPieceAt(t.coord);return e.isLegalForwarding(t,n,r)}}isLegalInsertion(t,n){const r=n.countPlayerPawn(),i=n.getCurrentPlayer(),s=r<5?TW.SUCCESS:TW.failure(q9.NO_REMAINING_PIECE_TO_INSERT());return{insertedPiece:e.getInsertedPiece(t,i),legal:s}}static getInsertedPiece(e,t){return G9.of(-1===e.x?QX.RIGHT:-1===e.y?QX.DOWN:5===e.x?QX.LEFT:QX.UP,t)}static isLegalForwarding(t,n,r){Tw(e.VERBOSE,{isLegalForwarding:{move:t.toString(),state:n,firstPiece:r}});const i=[];let s=G9.of(t.landingOrientation,n.getCurrentPlayer());const o=t.moveDirection.get();let a=t.coord.getNext(o);if(a.isInRange(5,5)&&n.getPieceAt(a)!==G9.EMPTY&&!1===e.isStraight(r,t))return Tw(e.VERBOSE,"Illegal push because not straight or not pushing anything or leaving the board"),SW.failure(q9.ILLEGAL_PUSH());let l=Mw.of(o);const c=o.getOpposite();let u=0;const h=n.getCopiedBoard();t.coord.isInRange(5,5)&&(h[t.coord.y][t.coord.x]=G9.EMPTY,i.push(t.coord));let d=a.isInRange(5,5)&&s!==G9.EMPTY;for(;d;){l.equalsValue(o)?u++:l.equalsValue(c)&&u--,Tw(e.VERBOSE,{totalForce:u,movingPiece:s,landingCoord:a});const t=h[a.y][a.x];t===G9.MOUNTAIN&&(u-=.9),h[a.y][a.x]=s,i.push(a),s=t,a=a.getNext(o),l=s.getOptionalDirection(),d=a.isInRange(5,5)&&s!==G9.EMPTY&&u>0}return a.isNotInRange(5,5)&&(Tw(e.VERBOSE,"This movement would push "+s+" outside the board"),l.equalsValue(o)?u++:l.equalsValue(c)&&u--),u<=0?(Tw(e.VERBOSE,"This move is an illegal push: "+h),SW.failure(q9.NOT_ENOUGH_FORCE_TO_PUSH())):(Tw(e.VERBOSE,"This move is a legal push: "+h),SW.success(new j9(h,i)))}static isStraight(e,t){const n=e.getDirection();return t.moveDirection.equalsValue(n)&&n===t.landingOrientation}isLegalRotation(t,n){Tw(e.VERBOSE,{isLegalRotation:{rotation:t,state:n}});const r=t.coord,i=n.getPieceAt(r),s=n.getCurrentPlayer();if(i.getDirection()===t.landingOrientation)return SW.failure(q9.ILLEGAL_ROTATION());const o=n.getCopiedBoard();return o[r.y][r.x]=G9.of(t.landingOrientation,s),SW.success(new j9(o,[r]))}applyLegalMove(e,t,n){const r=GK.copyBiArray(n.resultingBoard);return new W9(r,t.turn+1)}static getBoardValueInfo(t,n){const r=e.getMountainsRowsAndColumns(n),i=r.rows,s=r.columns,o=e.getWinner(n,t,r.nbMountain);if(o.isPlayer())return o===BK.ZERO?{shortestZero:0,shortestOne:Number.POSITIVE_INFINITY,boardValue:Number.MIN_SAFE_INTEGER}:{shortestZero:Number.POSITIVE_INFINITY,shortestOne:0,boardValue:Number.MAX_SAFE_INTEGER};{const t=e.getPushers(n,s,i);let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const a=n.getCurrentPlayer();for(const e of t)e.coord.isInRange(5,5)?n.getPieceAt(e.coord).belongTo(BK.ZERO)?r=Math.min(r,e.distance):o=Math.min(o,e.distance):a===BK.ZERO?r=Math.min(r,e.distance):o=Math.min(o,e.distance);return{shortestZero:r,shortestOne:o,boardValue:e.getScoreFromShortestDistances(r,o,a)}}}static getScoreFromShortestDistances(e,t,n){e===Number.MAX_SAFE_INTEGER&&(e=6),t===Number.MAX_SAFE_INTEGER&&(t=6);const r=6-e,i=6-t;return r===i?n.getScoreModifier():r>i?-10*(r+1)+(i+1):10*(i+1)-(r+1)}static getMountainsRowsAndColumns(e){const t=[],n=[];let r=0;for(let i=0;i<5;i++)for(let s=0;s<5;s++)e.getPieceAtXY(s,i)===G9.MOUNTAIN&&(t.includes(i)||t.push(i),n.includes(s)||n.push(s),r++);return{rows:t,columns:n,nbMountain:r}}static getWinner(t,n,r){return 2===r?e.getPusher(t,n.get()):VK.NONE}static getPusher(t,n){const r=n.coord;let i;i=r.isInRange(5,5)?t.getPieceAt(r.getNext(n.landingOrientation)):e.getInsertedPiece(r,t.getCurrentOpponent());const s=i.getDirection(),o=e.getPusherCoord(t,s,r),a=t.getPieceAt(o).getOwner();return Tw(e.VERBOSE,r.toString()+" belong to "+t.getCurrentOpponent().value+", "+o.toString()+" belong to "+a.value+", "+a.value+" win"),a}static getPusherCoord(e,t,n){let r=n.getNext(t),i=n;for(;r.isInRange(5,5);){n=r,r=r.getNext(t);const s=e.getPieceAt(n);s!==G9.MOUNTAIN&&s.getDirection()===t&&(i=n)}return i}static getPushers(t,n,r){Tw(e.VERBOSE,{getPushers:{state:t,mountainsColumn:n,mountainsRow:r}});let i=[];const s=[];for(const e of n){let t=QX.DOWN,n=new JX(e,4);s.push({direction:t,fallingCoord:n}),t=QX.UP,n=new JX(e,0),s.push({direction:t,fallingCoord:n})}for(const e of r){let t=QX.LEFT,n=new JX(0,e);s.push({direction:t,fallingCoord:n}),t=QX.RIGHT,n=new JX(4,e),s.push({direction:t,fallingCoord:n})}for(const o of s)i=e.addPotentialDirectionPusher(t,o.fallingCoord,o.direction,i);return i}static addPotentialDirectionPusher(t,n,r,i){const s=e.getLineClosestPusher(t,n,r);if(s.isAbsent())return i;const o=s.get(),a=o.distance;return Tw(e.VERBOSE,"new closest challenger"),i.push({coord:o.coord,distance:a}),i}static getLineClosestPusher(t,n,r){Tw(e.VERBOSE,{getDirectionClosestPusher:{state:t,fallingCoord:n,direction:r.toString()}});const i=r.getOpposite();let s=1,o=t.getPieceAt(n),a=n,l=Mw.empty(),c=!1,u=!1,h=0;for(;a.isInRange(5,5)&&!1===c;){const e=t.getPieceAt(a);if(e.isEmptyOrMountain())e===G9.MOUNTAIN?(h+=.9,u=!0):s++;else{const t=e.getDirection();t===r?u&&(h-=1,h<=0&&(c=!0,a=a.getNext(r))):t===i?(h+=1,u||s++):u?(l=Mw.of(a),o!==G9.EMPTY&&s++):s++}o=e,a=a.getPrevious(r)}if(!1===c&&l.isPresent())for(s++,h-=1;!1===a.equals(l.get());)a=a.getNext(r),s--;return a.isNotInRange(5,5)&&(h-=1,5===t.countPlayerPawn())||h>0?Mw.empty():Mw.of({distance:s,coord:a})}static getPushingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer(),r=[],i=[];for(let s=0;s<5;s++)r.push(new H9(-1,s,Mw.of(QX.RIGHT),QX.RIGHT)),i.push(G9.of(QX.RIGHT,n)),r.push(new H9(5,s,Mw.of(QX.LEFT),QX.LEFT)),i.push(G9.of(QX.LEFT,n)),r.push(new H9(s,-1,Mw.of(QX.DOWN),QX.DOWN)),i.push(G9.of(QX.DOWN,n)),r.push(new H9(s,5,Mw.of(QX.UP),QX.UP)),i.push(G9.of(QX.UP,n));for(let s=0;s<r.length;s++)this.isLegalForwarding(r[s],e.gameState,i[s]).isSuccess()&&t.push(r[s]);return t}static getDerapingInsertions(e){const t=[],n=e.gameState.getCurrentPlayer();let r,i,s;for(let o=1;o<=3;o++)r=new H9(-1,o,Mw.of(QX.RIGHT),QX.UP),i=G9.of(QX.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new H9(-1,o,Mw.of(QX.RIGHT),QX.DOWN),i=G9.of(QX.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new H9(5,o,Mw.of(QX.LEFT),QX.UP),i=G9.of(QX.UP,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new H9(5,o,Mw.of(QX.LEFT),QX.DOWN),i=G9.of(QX.DOWN,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));for(let o=1;o<=3;o++)r=new H9(o,-1,Mw.of(QX.DOWN),QX.LEFT),i=G9.of(QX.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new H9(o,-1,Mw.of(QX.DOWN),QX.RIGHT),i=G9.of(QX.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r)),r=new H9(o,5,Mw.of(QX.UP),QX.LEFT),i=G9.of(QX.LEFT,n),s=this.isLegalForwarding(r,e.gameState,i),s.isSuccess()&&(t.push(r),r=new H9(o,5,Mw.of(QX.UP),QX.RIGHT),i=G9.of(QX.RIGHT,n),s=this.isLegalForwarding(r,e.gameState,i),t.push(r));return t}static getCoordDirection(e,t,n){const r=new JX(e,t);return this.getInsertedPiece(r,n.getCurrentPlayer()).getDirection()}getGameStatus(t){const n=e.getMountainsRowsAndColumns(t.gameState),r=e.getWinner(t.gameState,t.move,n.nbMountain);return r.isPlayer()?SJ.getVictory(r):SJ.ONGOING}}return e.VERBOSE=!1,e})();class Y9 extends cJ{getBoardValue(e){return new uJ(Z9.getBoardValueInfo(e.move,e.gameState).boardValue)}getListMoves(e){let t=[];const n=e.gameState.getCurrentPlayer();let r;for(let i=0;i<5;i++)for(let s=0;s<5;s++)if(r=e.gameState.getPieceAtXY(s,i),r.belongTo(n)){const o=r.getDirection();for(const a of QX.ORTHOGONALS){if(a!==o){const r=e.gameState.getCopiedBoard(),o=new H9(s,i,Mw.empty(),a);r[i][s]=G9.of(a,n),t.push(o)}let l;l=new JX(s+a.x,i+a.y).isInRange(5,5)?QX.ORTHOGONALS:[a];for(const n of l){const o=new H9(s,i,Mw.of(a),n);Z9.isLegalForwarding(o,e.gameState,r).isSuccess()&&t.push(o)}}}return e.gameState.countPlayerPawn()<5&&(t=t.concat(Z9.getPushingInsertions(e)),t=t.concat(Z9.getDerapingInsertions(e))),Tw(Z9.VERBOSE,{getListMovesResult:t}),t}}const K9=G9.EMPTY,Q9=G9.MOUNTAIN,X9=G9.WHITE_UP,J9=G9.WHITE_LEFT,eee=G9.WHITE_RIGHT,tee=G9.WHITE_DOWN,nee=G9.BLACK_UP,ree=G9.BLACK_LEFT,iee=G9.BLACK_RIGHT,see=G9.BLACK_DOWN;class oee{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`The goal at Siam is to be the first to push a mountain out of the board.
        The initial board contains three mountains, and no pieces are initially on the board.
        During its turn, a player can do one of the following three actions:
        <ol>
            <li>Put a new piece on the board.</li>
            <li>Change the orientation of one of its piece, and optionally move it.</li>
            <li>Take one of its pieces out of the board.</li>
        </ol>`,W9.getInitialState()),kJ.anyMove($localize`Inserting a piece`,$localize`Each player has 5 pieces in total.
        As long as you do not have 5 pieces on the board, you can insert new pieces. To do so:
        <ol>
            <li>Click on one of the big arrows alongside the board.</li>
            <li>Click on one of the small arrows that appeared on the landing square of your piece.
                This is the direction in which your piece will be oriented.</li>
        </ol><br/>
        Insert a piece on the board.`,W9.getInitialState(),new H9(2,-1,Mw.of(QX.DOWN),QX.DOWN),$localize`Congratulations!`),kJ.fromMove($localize`Moving a piece`,$localize`We will distinguish here "moving" and "pushing".
        A move is made from a piece's square to an empty neighboring square, horizontally or vertically.
        During that move, you can also move the piece out of the board.
        To move a piece:
        <ol>
            <li>Click on it.</li>
            <li>Click on one of the 4 arrows to pick the direction in which it will move.
                You can also click on the middle dot to change the piece's orientation without moving it.</li>
            <li>Click on one of the 4 arrows on the landing square to pick its orientation.</li>
        </ol><br/>
        Try to move the piece that is on the board one square upwards and to orient it downwards.`,new W9([[K9,K9,K9,K9,K9],[K9,K9,K9,K9,K9],[K9,Q9,Q9,Q9,K9],[K9,K9,K9,K9,K9],[K9,K9,X9,K9,K9]],0),[new H9(2,4,Mw.of(QX.UP),QX.DOWN)],$localize`Congratulations, you made a side-slip!`,$localize`Failed!`),kJ.fromMove($localize`Moving a piece out of the board`,$localize`To move a piece out of the board, you do not have to pick an orientation after the move.<br/><br/>
        Get that piece out of the board!`,new W9([[K9,K9,K9,K9,K9],[K9,K9,K9,K9,K9],[K9,Q9,Q9,Q9,K9],[K9,K9,K9,K9,K9],[K9,K9,X9,K9,K9]],0),[new H9(2,4,Mw.of(QX.DOWN),QX.DOWN)],$localize`Congratulations, even if in this context it was not a useful move.`,$localize`Failed, the piece is still on the board.`),kJ.fromMove($localize`Pushing`,$localize`When the landing square of your move is occupied, we use the term "push".
        In order to push, multiple conditions must hold:
        <ol>
            <li>Your piece must already be oriented in the direction of the push.</li>
            <li>The number of the pieces (opponent's or not) that are facing yours (called the resistants)
                must be smaller than the number of pieces that are oriented in the same direction as the push, yourself included (the pushers).</li>
            <li>The number of mountains on that line must be smaller or equal to the difference between the pushers and the resistants.</li>
        </ol>
        Your piece on the top right cannot push because there is one mountain too much.
        Your piece on the bottom right can push.<br/><br/>
        Do it.`,new W9([[eee,Q9,Q9,ree,J9],[K9,K9,K9,K9,K9],[K9,K9,K9,Q9,K9],[K9,K9,K9,K9,K9],[K9,K9,iee,ree,J9]],0),[new H9(4,4,Mw.of(QX.LEFT),QX.LEFT)],$localize`Congratulations!`,$localize`Failed!`),kJ.fromMove($localize`Victory`,$localize`The game ends when a mountain is pushed out of the board.
        If you pushed it and nobody is in front of you, you're the winner.
        However, if you were pushing an opponent oriented in the same direction as you, your opponent will win because that piece is closer to the mountain.
        However, if that opponent is closer to the mountain but not oriented towards it, victory will be yours.<br/><br/>
        You have two ways of ending the game here: you can either win, or lose. Choose correctly!`,new W9([[K9,K9,K9,K9,K9],[K9,K9,K9,K9,K9],[Q9,nee,J9,K9,tee],[K9,K9,K9,K9,see],[K9,K9,K9,K9,Q9]],0),[new H9(2,2,Mw.of(QX.LEFT),QX.LEFT)],$localize`Congratulations, you won!`,$localize`Failed, you lost.`)]}}function aee(e,t){if(1&e){const e=va();Cn(),pa(0,"use",7),Ea("click",function(){const t=Gt(e).$implicit;return Sa(3).insertAt(t.x,t.y)}),fa()}if(2&e){const e=t.$implicit,n=Sa(3);Ia("id","insertAt_",e.x,"_",e.y,""),ra("transform",n.getInsertionArrowTransform(e.x+1,e.y+1,e.dir))}}const lee=function(e,t){return{dir:"DOWN",x:e,y:t}},cee=function(e){return{dir:"UP",x:e,y:5}},uee=function(e,t){return{dir:"RIGHT",x:e,y:t}},hee=function(e){return{dir:"LEFT",x:5,y:e}},dee=function(e,t,n,r){return[e,t,n,r]};function pee(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,aee,1,3,"use",6),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",Pu(11,dee,Su(1,lee,e,-1),bu(4,cee,e),Su(6,uee,-1,e),bu(9,hee,e)))}}const fee=function(){return[0,1,2,3,4]};function gee(e,t){1&e&&(Cn(),ma(0),la(1,pee,2,16,"g",5),ya()),2&e&&(Ts(1),ha("ngForOf",wu(1,fee)))}function mee(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return Sa(5).chooseDirection(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa(3).index,r=Sa().index,i=Sa();Ta("id","chooseDirection_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}const yee=function(){return["RIGHT","DOWN","LEFT","UP"]};function vee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"circle",11),Ea("click",function(){return Gt(e),Sa(4).chooseDirection("")}),fa(),la(2,mee,1,2,"use",12),fa()}if(2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Ts(1),ra("cx",(e+1)*n.SPACE_SIZE+n.SPACE_SIZE/2)("cy",(t+1)*n.SPACE_SIZE+n.SPACE_SIZE/2),Ts(1),ha("ngForOf",wu(3,yee))}}function _ee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"use",10),Ea("click",function(){Gt(e);const t=Sa().index,n=Sa().index;return Sa().clickPiece(t,n)}),fa(),la(2,vee,3,4,"g",4),fa()}if(2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ts(1),Ia("id","clickPiece_",t,"_",r,""),ha("ngClass",i.getPieceClasses(n)),ra("transform",i.getPieceTransform(t,r)),Ts(1),ha("ngIf",i.choosingDirection(t,r))}}function Cee(e,t){if(1&e&&(Cn(),ga(0,"use",14)),2&e){const e=Sa().index,t=Sa().index,n=Sa();ra("transform","translate("+(e+1)*n.SPACE_SIZE+" "+(t+1)*n.SPACE_SIZE+")")}}function Eee(e,t){if(1&e){const e=va();Cn(),pa(0,"use",13),Ea("click",function(){const t=Gt(e).$implicit;return Sa(4).chooseOrientation(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa(2).index,r=Sa().index,i=Sa();Ta("id","chooseOrientation_",e,""),ra("transform",i.getArrowTransform(n+1,r+1,e))}}function wee(e,t){1&e&&(Cn(),pa(0,"g"),la(1,Eee,1,2,"use",12),fa()),2&e&&(Ts(1),ha("ngForOf",wu(1,yee)))}function bee(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",8),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().insertAt(t,n)}),fa(),la(2,_ee,3,5,"g",4),la(3,Cee,1,1,"use",9),la(4,wee,2,2,"g",4),fa()}if(2&e){const e=t.$implicit,n=t.index,r=Sa().index,i=Sa();Ts(1),Ia("id","insertAt_",n,"_",r,""),ha("ngClass",i.getSquareClasses(n,r)),ra("x",i.SPACE_SIZE*(n+1))("y",i.SPACE_SIZE*(r+1))("width",i.SPACE_SIZE)("height",i.SPACE_SIZE),Ts(1),ha("ngIf",e.isPiece()),Ts(1),ha("ngIf",i.isMountain(e)),Ts(1),ha("ngIf",i.choosingOrientation(n,r))}}function See(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,bee,5,10,"g",5),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let Pee=(()=>{class e extends u1{constructor(e){super(e),this.lastMove=Mw.empty(),this.chosenCoord=Mw.empty(),this.landingCoord=Mw.empty(),this.chosenDirection=Mw.empty(),this.chosenOrientation=Mw.empty(),this.movedPieces=[],this.rules=new Z9(W9),this.availableMinimaxes=[new Y9(this.rules,"SiamMinimax")],this.encoder=H9.encoder,this.tutorial=(new oee).tutorial,this.updateBoard()}updateBoard(){if(Tw(e.VERBOSE,"updateBoard"),this.board=this.rules.node.gameState.board,this.lastMove=this.rules.node.move,this.lastMove.isPresent()){const e=this.rules.node.mother.get().gameState;this.movedPieces=this.rules.isLegal(this.lastMove.get(),e).get().moved}else this.movedPieces=[]}cancelMoveAttempt(){this.chosenCoord=Mw.empty(),this.chosenDirection=Mw.empty(),this.landingCoord=Mw.empty(),this.chosenOrientation=Mw.empty()}clickPiece(e,t){const n=this.canUserPlay("#clickPiece_"+e+"_"+t);if(n.isFailure())return this.cancelMove(n.getReason());const r=this.board[t][e],i=this.rules.node.gameState.getCurrentOpponent();return r.getOwner()===i?this.cancelMove(lJ.MUST_CHOOSE_PLAYER_PIECE()):(this.chosenCoord=Mw.of(new JX(e,t)),TW.SUCCESS)}chooseDirection(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.chooseDirection("+t+")");const r=n.canUserPlay("#chooseDirection_"+t);if(r.isFailure())return n.cancelMove(r.getReason());if(""===t)n.chosenDirection=Mw.empty(),n.landingCoord=n.chosenCoord;else{const r=QX.factory.fromString(t).get();if(n.chosenDirection=Mw.of(r),n.landingCoord=Mw.of(n.chosenCoord.get().getNext(r)),n.landingCoord.get().isNotInRange(5,5))return Tw(e.VERBOSE,"orientation and direction should be the same: "+r),n.chosenOrientation=Mw.of(r),yield n.tryMove()}return TW.SUCCESS})()}chooseOrientation(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.chooseOrientation("+t+")");const r=n.canUserPlay("#chooseOrientation_"+t);return r.isFailure()?n.cancelMove(r.getReason()):(n.chosenOrientation=Mw.of(QX.factory.fromString(t).get()),yield n.tryMove())})()}insertAt(t,n){var r=this;return Pw(function*(){Tw(e.VERBOSE,"SiamComponent.insertAt("+t+", "+n+")");const i=r.canUserPlay("#insertAt_"+t+"_"+n);if(i.isFailure())return r.cancelMove(i.getReason());if(r.chosenCoord.isPresent())return r.cancelMove(q9.CANNOT_INSERT_WHEN_SELECTED());{const e=new JX(t,n);if(r.getState().isOnBoard(e)&&r.getState().getPieceAtXY(t,n).isEmptyOrMountain())return r.cancelMove(q9.MUST_INSERT_OR_CHOOSE_YOUR_PIECE());r.chosenCoord=Mw.of(e);const i=Z9.getCoordDirection(t,n,r.rules.node.gameState);return r.chosenDirection=Mw.of(i),r.landingCoord=Mw.of(r.chosenCoord.get().getNext(i)),TW.SUCCESS}})()}tryMove(){var e=this;return Pw(function*(){const t=e.chosenCoord.get(),n=new H9(t.x,t.y,e.chosenDirection,e.chosenOrientation.get());return e.cancelMove(),yield e.chooseMove(n,e.rules.node.gameState)})()}isMountain(e){return e===G9.MOUNTAIN}choosingOrientation(t,n){const r=new JX(t,n);return!!(this.chosenCoord.isPresent()&&this.landingCoord.equalsValue(r)&&this.chosenOrientation.isAbsent())&&(Tw(e.VERBOSE,"choosing orientation now"),!0)}choosingDirection(t,n){const r=new JX(t,n);return!!(this.chosenCoord.equalsValue(r)&&this.chosenDirection.isAbsent()&&this.landingCoord.isAbsent()&&this.chosenOrientation.isAbsent())&&(Tw(e.VERBOSE,"choosing direction now"),!0)}getInsertionArrowTransform(e,t,n){const r=`rotate(${90*(QX.factory.fromString(n).get().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+e*this.SPACE_SIZE+", "+t*this.SPACE_SIZE+")",r].join(" ")}getPieceTransform(e,t){const n=`rotate(${90*(this.board[t][e].getDirection().toInt()-2)} ${this.SPACE_SIZE/2} ${this.SPACE_SIZE/2})`;return["translate("+(e+1)*this.SPACE_SIZE+", "+(t+1)*this.SPACE_SIZE+")",n].join(" ")}getArrowTransform(e,t,n){return e9.getArrowTransform(this.SPACE_SIZE,new JX(e,t),QX.factory.fromString(n).get())}getPieceClasses(e){return[this.getPlayerClass(e.getOwner())]}getSquareClasses(e,t){const n=new JX(e,t);return this.movedPieces.some(e=>e.equals(n))?["moved"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-siam"]],features:[Go],decls:7,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 0 700 700","preserveAspectRatio","xMidYMid meet"],["id","triangle","points","0 -6, 10 0, 0 6"],["id","arrow","points","30 7, 30 50, 10 50, 50 93, 90 50, 70 50, 70 7, 27.5 7"],["id","mountain","points","5 95, 16 68, 24 76, 48 28, 64 60, 72 44, 95 95, 5 95"],[4,"ngIf"],[4,"ngFor","ngForOf"],[0,"xlink","href","#arrow","class","base mid-stroke",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","click"],[1,"base",3,"id","ngClass","click"],[0,"xlink","href","#mountain","fill","brown",4,"ngIf"],[0,"xlink","href","#arrow",1,"base","mid-stroke",3,"id","ngClass","click"],["id","chooseDirection_","r","8",1,"arrow","selected-fill","no-stroke",3,"click"],["class","arrow selected-fill no-stroke",0,"xlink","href","#triangle",3,"id","click",4,"ngFor","ngForOf"],[0,"xlink","href","#triangle",1,"arrow","selected-fill","no-stroke",3,"id","click"],[0,"xlink","href","#mountain","fill","brown"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),pa(1,"defs"),ga(2,"polygon",1),ga(3,"polygon",2),ga(4,"polygon",3),fa(),la(5,gee,2,2,"ng-container",4),la(6,See,2,1,"g",5),fa()),2&e&&(Ts(5),ha("ngIf",t.isPlayerTurn()),Ts(1),ha("ngForOf",t.board))},directives:[rp,tp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})(),Oee=(()=>{class e{}return e.NO_MOVEMENT_BEFORE_TURN_40=()=>$localize`You cannot move yet. Pick a space where you will put a new piece.`,e.MUST_CUT=()=>$localize`Several groups are of the same size, you must pick the one to keep.`,e.CANNOT_CHOOSE_TO_KEEP=()=>$localize`You cannot choose which part to keep when one is smaller than the other.`,e.CAN_NO_LONGER_DROP=()=>$localize`You cannot put new pieces anymore. Pick a piece to move.`,e.MUST_CAPTURE_BIGGEST_GROUPS=()=>$localize`You must choose one of the biggest groups to keep it.`,e.CANNOT_KEEP_EMPTY_COORD=()=>$localize`You cannot pick an empty space. Pick one of the biggest groups.`,e.MUST_DROP_NEXT_TO_OTHER_PIECE=()=>$localize`You must put this piece next to another piece.`,e})();class Tee extends pJ{constructor(e,t,n){super(t),this.pieces=e;const r=this.getCalculatedScale();this.pieces=r.pieces,this.width=r.width,this.height=r.height,this.offset=n??r.offset,this.pieces.makeImmutable()}static getInitialState(){return Tee.fromRepresentation([[BK.ZERO.value],[BK.ONE.value]],0)}static fromRepresentation(e,t,n){const r=new EJ;for(let i=0;i<e.length;i++)for(let t=0;t<e[0].length;t++)e[i][t]!==VK.NONE.value&&r.set(new JX(t,i),BK.of(e[i][t]));return new Tee(r,t,n)}static deplacePiece(e,t){const n=e.pieces.getCopy();return n.delete(t.start.get()),n.set(t.landing,e.getCurrentPlayer()),n}static getGroups(e,t){let n=new EJ,r=0;for(const o of rJ.factory.all){const i=t.getNext(o,1);n=Tee.putCoordInGroup(e,i,n,""+r),r++}const i=n.reverse(),s=new dJ;for(let o=0;o<i.size();o++)s.add(i.getByIndex(o).value);return s}static putCoordInGroup(e,t,n,r){if(e.get(t).isPresent()&&n.get(t).isAbsent()){n.set(t,r);for(const i of rJ.factory.all){const s=t.getNext(i,1);n=Tee.putCoordInGroup(e,s,n,r)}}return n}getCalculatedScale(){let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const o of this.pieces.listKeys())e=Math.min(o.x,e),t=Math.max(o.x,t),n=Math.min(o.y,n),r=Math.max(o.y,r);let i=new EJ;const s=new jX(-e,-n);if(0!==e||0!==n)for(const o of this.pieces.listKeys()){const e=this.pieces.delete(o),t=o.getNext(s);i.set(t,e)}else i=this.pieces;return{width:t+1-e,height:r+1-n,pieces:i,offset:s}}toRepresentation(){const e=GK.createTable(this.width,this.height,VK.NONE.value);for(const t of this.pieces.listKeys()){const n=this.getPieceAt(t).value;e[t.y][t.x]=n}return e}isIllegalLandingZone(e,t){return this.pieces.containsKey(e)?TW.failure(lJ.MUST_LAND_ON_EMPTY_SPACE()):this.isCoordConnected(e,t)?TW.SUCCESS:TW.failure(Oee.MUST_DROP_NEXT_TO_OTHER_PIECE())}isCoordConnected(e,t){for(const n of rJ.factory.all){const r=e.getNext(n,1);if(this.pieces.containsKey(r)&&!1===t.equalsValue(r))return!0}return!1}isOnBoard(e){return this.pieces.containsKey(e)}getPieceAt(e){return this.isOnBoard(e)?this.pieces.get(e).get():VK.NONE}applyLegalDrop(e){const t=this.pieces.getCopy();return t.put(e,this.getCurrentPlayer()),new Tee(t,this.turn+1)}applyLegalDeplacement(e,t){const n=Tee.deplacePiece(this,e);let r=new EJ;if(t.size()>0){r=new EJ;for(const e of t)r.set(e,n.get(e).get())}else r=n.getCopy();return new Tee(r,this.turn+1)}countPieces(){const e=this.pieces.reverse(),t=e.get(BK.ZERO).getOrElse(new L1),n=e.get(BK.ONE).getOrElse(new L1);return[t.size(),n.size()]}switchPiece(e){const t=this.pieces.getCopy(),n=this.getPieceAt(e);if(n.isPlayer())return t.replace(e,n.getOpponent()),new Tee(t,this.turn,this.offset);MW.logErrorAndFail("SixState","Cannot switch piece if there is no piece!",{coord:e.toString()})}equals(e){return this.turn===e.turn&&this.pieces.equals(e.pieces)}}class Iee extends mJ{constructor(e,t,n){if(super(),this.start=e,this.landing=t,this.keep=n,e.equalsValue(t))throw new Error("Deplacement cannot be static!");if(e.isPresent()&&e.equals(n))throw new Error("Cannot keep starting coord, since it will always be empty after move!")}static fromDrop(e){return new Iee(Mw.empty(),e,Mw.empty())}static fromMovement(e,t){return new Iee(Mw.of(e),t,Mw.empty())}static fromCut(e,t,n){return new Iee(Mw.of(e),t,Mw.of(n))}isDrop(){return this.start.isAbsent()}isCut(){return this.keep.isPresent()}toString(){return this.isDrop()?"SixMove("+this.landing.toString()+")":this.isCut()?"SixMove("+this.start.get().toString()+" > "+this.landing+", keep: "+this.keep.get().toString()+")":"SixMove("+this.start.get().toString()+" > "+this.landing+")"}equals(e){return!1!==this.landing.equals(e.landing)&&!1!==this.start.equals(e.start)&&this.keep.equals(e.keep)}}Iee.encoder=new class extends LK{encodeMove(e){return{start:e.start.isPresent()?JX.encoder.encode(e.start.get()):null,landing:JX.encoder.encode(e.landing),keep:e.keep.isPresent()?JX.encoder.encode(e.keep.get()):null}}decodeMove(e){const t=e;if("object"!=typeof e)throw new Error("Invalid encodedMove of type "+typeof e+"!");const n=JX.encoder.decode(t.landing);if(null==t.start)return Iee.fromDrop(n);const r=JX.encoder.decode(t.start);if(null==t.keep)return Iee.fromMovement(r,n);{const e=JX.encoder.decode(t.keep);return Iee.fromCut(r,n,e)}}};class kee extends PJ{constructor(){super(...arguments),this.VERBOSE=!1}applyLegalMove(e,t,n){return t.turn<40?t.applyLegalDrop(e.landing):t.applyLegalDeplacement(e,n)}isLegal(e,t){Tw(this.VERBOSE,{called:"SixRules.isLegal",move:e,state:t});const n=t.isIllegalLandingZone(e.landing,e.start);return n.isFailure()?n.toFailedFallible():t.turn<40?this.isLegalDrop(e,t):kee.isLegalPhaseTwoMove(e,t)}static getLegalLandings(e){const t=new L1;for(const n of e.pieces.listKeys())for(const r of rJ.factory.all){const i=n.getNext(r,1);e.getPieceAt(i)===VK.NONE&&t.add(i)}return t.toList()}isLegalDrop(e,t){return!1===e.isDrop()?SW.failure(Oee.NO_MOVEMENT_BEFORE_TURN_40()):SW.success(t.pieces.getKeySet())}static isLegalPhaseTwoMove(e,t){if(e.isDrop())return SW.failure(Oee.CAN_NO_LONGER_DROP());switch(t.getPieceAt(e.start.get())){case VK.NONE:return SW.failure(lJ.MUST_CHOOSE_OWN_PIECE_NOT_EMPTY());case t.getCurrentOpponent():return SW.failure(lJ.CANNOT_CHOOSE_OPPONENT_PIECE())}const n=Tee.deplacePiece(t,e),r=Tee.getGroups(n,e.start.get());if(kee.isSplit(r)){const t=this.getBiggerGroups(r);return 1===t.size()?e.keep.isPresent()?SW.failure(Oee.CANNOT_CHOOSE_TO_KEEP()):SW.success(t.getAnyElement().get()):this.moveKeepBiggerGroup(e.keep,t,n)}return SW.success(new L1)}static isSplit(e){return e.size()>1}static getBiggerGroups(e){let t=0,n=new dJ;for(const r of e){const e=r.size();e>t?(t=e,n=new dJ([r])):e===t&&n.add(r)}return n}static moveKeepBiggerGroup(e,t,n){if(e.isAbsent())return SW.failure(Oee.MUST_CUT());if(n.get(e.get()).isAbsent())return SW.failure(Oee.CANNOT_KEEP_EMPTY_COORD());const r=e.get();for(const i of t)if(i.contains(r))return SW.success(i);return SW.failure(Oee.MUST_CAPTURE_BIGGEST_GROUPS())}getGameStatus(e){const t=e.gameState,n=t.getCurrentOpponent();let r=[];if(e.move.isPresent()&&(r=this.getShapeVictory(e.move.get(),t)),6===r.length)return SJ.getVictory(n);if(t.turn>39){const e=t.countPieces(),n=e[0],r=e[1];return n<6&&r<6?n<r?SJ.ONE_WON:r<n?SJ.ZERO_WON:SJ.DRAW:n<6?SJ.getDefeat(BK.ZERO):r<6?SJ.getDefeat(BK.ONE):SJ.ONGOING}return SJ.ONGOING}startSearchingVictorySources(){Tw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}getShapeVictory(e,t){for(this.startSearchingVictorySources();this.hasNextVictorySource();){this.getNextVictorySource();const n=this.searchVictoryOnly(this.currentVictorySource,e,t);if(6===n.length)return n}return[]}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(rJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return[];const t=(e+i.length)%6;i.push(s),s=s.getNext(rJ.factory.all[t],1)}return i}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=rJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return[];a=!0,i=i.getOpposite(),s=s.getNext(i,o.length)}s=s.getNext(i,1)}return o}searchVictoryOnlyForTriangleCorner(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=rJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.length%2==0&&(i=rJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return s}searchVictoryOnlyForTriangleEdge(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=rJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return[];s.push(o),s.length%2==0&&(i=rJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return s}}class Aee extends cJ{calculateBoardValue(e,t){this.startSearchingVictorySources();let n={status:_J.DEFAULT,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};for(;this.hasNextVictorySource();){const r=this.getNextVictorySource();let i;if(i=n.status===_J.PRE_VICTORY?this.searchVictoryOnly(r,e,t):this.getBoardInfo(r,e,t,n),i.status===_J.VICTORY)return i;n={status:i.status,victory:Mw.empty(),preVictory:i.preVictory,sum:n.sum+i.sum}}return n}}class Mee extends uJ{constructor(e,t){super(e),this.value=e,this.preVictory=t}}class Nee extends Aee{constructor(){super(...arguments),this.VERBOSE=!1}static get(){if(null==Nee.INSTANCE){const e=new kee(Tee);Nee.INSTANCE=new Nee(e,"SixMinimax")}return Nee.INSTANCE}getListMoves(e){const t=Nee.get(),n=e.getOwnValue(t);if(n.preVictory.isPresent())return e.gameState.turn<40?this.createForcedDrop(n):this.createForcedDeplacement(e,n);const r=kee.getLegalLandings(e.gameState);return e.gameState.turn<40?this.getListDrop(r):this.getListDeplacement(e.gameState,r)}createForcedDrop(e){Tw(this.VERBOSE,{called:"SixMinimax.createForceDrop",unheritance:e});const t=[],n=Iee.fromDrop(e.preVictory.get());return t.push(n),t}createForcedDeplacement(e,t){Tw(this.VERBOSE,{called:"SixRules.createForcedDeplacement",node:e});const n=this.getSafelyMovablePieceOrFirstOne(e),r=[t.preVictory.get()];return this.getDeplacementFrom(e.gameState,n,r)}getDeplacementFrom(e,t,n){const r=[];for(const i of t)for(const t of n){const n=Iee.fromMovement(i,t);if(e.isCoordConnected(t,Mw.of(i))){const s=Tee.deplacePiece(e,n),o=Tee.getGroups(s,n.start.get());if(kee.isSplit(o))for(const e of o){const n=e.getAnyElement().get(),s=Iee.fromCut(i,t,n);r.push(s)}else r.push(n)}}return r}getSafelyMovablePieceOrFirstOne(e){const t=e.gameState,n=t.pieces.reverse(),r=t.getCurrentPlayer(),i=n.get(r).get(),s=i.getAnyElement().get(),o=[];for(const a of i)!1===this.isPieceBlockingAVictory(t,a)&&o.push(a);return new L1(0===o.length?[s]:o)}isPieceBlockingAVictory(e,t){const n=e.switchPiece(t),r=Iee.fromDrop(t);for(this.startSearchingVictorySources();this.hasNextVictorySource();)if(this.currentVictorySource=this.getNextVictorySource(),this.searchVictoryOnly(this.currentVictorySource,r,n).status===_J.VICTORY)return!0;return!1}getListDrop(e){const t=[];for(const n of e){const e=Iee.fromDrop(n);t.push(e)}return t}getListDeplacement(e,t){const n=e.getCurrentPlayer(),r=e.pieces.reverse().get(n).get();return this.getDeplacementFrom(e,r,t)}getBoardValue(e){const t=e.move,n=e.gameState,r=n.getCurrentOpponent(),i=r.getVictoryValue();let s={status:_J.DEFAULT,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};t.isPresent()&&(s=this.calculateBoardValue(t.get(),n));let o=Mw.empty();if(s.status===_J.DEFAULT&&s.preVictory.isPresent()&&(o=Mw.of(s.preVictory.get())),s.status===_J.VICTORY)return new Mee(i,Mw.empty());if(n.turn>39){const e=n.countPieces(),t=e[0],r=e[1];return t<6&&r<6?new Mee(t<r?BK.ONE.getVictoryValue():r<t?BK.ZERO.getVictoryValue():0,Mw.empty()):t<6?new Mee(BK.ZERO.getDefeatValue(),Mw.empty()):r<6?new Mee(BK.ONE.getDefeatValue(),Mw.empty()):new Mee(t-r,o)}return new Mee(s.status===_J.PRE_VICTORY?r.getPreVictory():s.sum*r.getScoreModifier(),o)}startSearchingVictorySources(){Tw(this.VERBOSE,"SixRules.startSearchingVictorySources()"),this.currentVictorySource={typeSource:"LINE",index:-1}}hasNextVictorySource(){return"CIRCLE"!==this.currentVictorySource.typeSource||5!==this.currentVictorySource.index}getNextVictorySource(){if(5===this.currentVictorySource.index){let e;switch(this.currentVictorySource.typeSource){case"LINE":e="TRIANGLE_CORNER";break;case"TRIANGLE_CORNER":e="TRIANGLE_EDGE";break;default:e="CIRCLE"}this.currentVictorySource={typeSource:e,index:0}}else{let e=1;"LINE"===this.currentVictorySource.typeSource&&(e=2),this.currentVictorySource={typeSource:this.currentVictorySource.typeSource,index:this.currentVictorySource.index+e}}return this.currentVictorySource}searchVictoryOnly(e,t,n){const r=t.landing.getNext(n.offset,1);switch(Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnly",victorySource:e,move:t,state:n}),e.typeSource){case"LINE":return this.searchVictoryOnlyForLine(e.index,r,n);case"CIRCLE":return this.searchVictoryOnlyForCircle(e.index,r,n);case"TRIANGLE_CORNER":return this.searchVictoryOnlyForTriangleCorner(e.index,r,n);default:return this.searchVictoryOnlyForTriangleEdge(e.index,r,n)}}searchVictoryOnlyForCircle(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryOnlyForCircle",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent(),i=[t];let s=t.getNext(rJ.factory.all[e],1);for(;i.length<6;){if(n.getPieceAt(s)!==r)return{status:_J.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};const t=(e+i.length)%6;i.push(s),s=s.getNext(rJ.factory.all[t],1)}return{status:_J.VICTORY,victory:Mw.of(i),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForLine(e,t,n){const r=n.getCurrentOpponent();let i=rJ.factory.all[e],s=t.getNext(i,1);const o=[t];let a=!1;for(;o.length<6;){if(n.getPieceAt(s)===r)o.push(s);else{if(a)return{status:_J.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};a=!0,i=i.getOpposite(),s=s.getNext(i,o.length-1)}s=s.getNext(i,1)}return{status:_J.VICTORY,victory:Mw.of(o),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForTriangleCorner(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleCornerOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=rJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:_J.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};s.length%2==0&&(i=rJ.factory.all[(e+s.length)%6]),s.push(o),o=o.getNext(i,1)}return{status:_J.VICTORY,victory:Mw.of(s),preVictory:Mw.empty(),sum:0}}searchVictoryOnlyForTriangleEdge(e,t,n){Tw(this.VERBOSE,{called:"SixRules.searchVictoryTriangleEdgeOnly",index:e,lastDrop:t,state:n});const r=n.getCurrentOpponent();let i=rJ.factory.all[e];const s=[t];let o=t.getNext(i,1);for(;s.length<6;){if(n.getPieceAt(o)!==r)return{status:_J.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};s.push(o),s.length%2==0&&(i=rJ.factory.all[(e+s.length)%6]),o=o.getNext(i,1)}return{status:_J.VICTORY,victory:Mw.of(s),preVictory:Mw.empty(),sum:0}}getBoardInfo(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfo",victorySource:e,move:t,state:n,boardInfo:r});const i=t.landing.getNext(n.offset,1);switch(e.typeSource){case"CIRCLE":return this.getBoardInfoForCircle(e.index,i,n,r);case"LINE":return this.getBoardInfoForLine(e.index,i,n,r);case"TRIANGLE_CORNER":return this.getBoardInfoForTriangleCorner(e.index,i,n,r);default:return this.getBoardInfoForTriangleEdge(e.index,i,n,r)}}getBoardInfoForCircle(e,t,n,r){Tw(this.VERBOSE,{called:"SixMinimaw.getBoardInfoForCircle",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer(),s=[t];let o=t.getNext(rJ.factory.all[e],1),a=0,l=Mw.empty();for(;s.length<6;){const t=n.getPieceAt(o);if(t===i)return r;const c=(e+s.length)%6;s.push(o);const u=rJ.factory.all[c];t===VK.NONE?(a+=.16,l=Mw.of(o)):a++,o=o.getNext(u,1)}return this.getBoardInfoResult(a,l,s,r)}getBoardInfoResult(e,t,n,r){let i=r.preVictory;if(4.16===e){if(Tw(this.VERBOSE,"5+1 found!"),i.isPresent()&&!1===i.equals(t))return{status:_J.PRE_VICTORY,victory:Mw.empty(),preVictory:Mw.empty(),sum:0};i=t}else if(5===e)return{status:_J.VICTORY,victory:Mw.of(n),preVictory:Mw.empty(),sum:0};return{status:r.status,victory:Mw.empty(),preVictory:i,sum:r.sum+e}}getBoardInfoForLine(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForLine",index:e,lastDrop:t,state:n,boardInfo:r});const i=rJ.factory.all[e];let s=t.getPrevious(i,5),o=[],a=[],l=Mw.empty();for(let f=0;f<6;f++){const e=this.updateEncounterAndReturnLastEmpty(n,s,a);e.isPresent()&&(l=e),o.push(s),s=s.getNext(i,1)}let c=r.status,u=r.preVictory,h=0,d=0;for(;h<6;){const e=a.reduce((e,t)=>e+t);if(6===e)return{status:_J.VICTORY,victory:Mw.of(o),preVictory:Mw.empty(),sum:0};5.16===e&&c===_J.DEFAULT&&(u.isPresent()?(NW(!1===u.equals(l),"Impossible to have point aligned with differents line to a same point"),c=_J.PRE_VICTORY):u=l),d=Math.max(d,e),o=o.slice(1,6),o.push(s),a=a.slice(1,6);const t=this.updateEncounterAndReturnLastEmpty(n,s,a);t.isPresent()&&(l=t),h++,s=s.getNext(i,1)}const p={status:c,victory:Mw.of(o),preVictory:u,sum:d};return this.getBoardInfoResult(d,l,o,p)}updateEncounterAndReturnLastEmpty(e,t,n){const r=e.getCurrentPlayer();switch(e.getPieceAt(t)){case r:return n.push(-7),Mw.empty();case VK.NONE:return n.push(.16),Mw.of(t);default:return n.push(1),Mw.empty()}}getBoardInfoForTriangleCorner(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleCorner",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=rJ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=Mw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===VK.NONE?(l+=.16,c=Mw.of(a)):l++,o.length%2==0&&(s=rJ.factory.all[(e+o.length)%6]),o.push(a),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}getBoardInfoForTriangleEdge(e,t,n,r){Tw(this.VERBOSE,{called:"SixRules.getBoardInfoForTriangleEdge",index:e,lastDrop:t,state:n,boardInfo:r});const i=n.getCurrentPlayer();let s=rJ.factory.all[e];const o=[t];let a=t.getNext(s,1),l=0,c=Mw.empty();for(;o.length<6;){const t=n.getPieceAt(a);if(t===i)return r;t===VK.NONE?(l+=.16,c=Mw.of(a)):l++,o.push(a),o.length%2==0&&(s=rJ.factory.all[(e+o.length)%6]),a=a.getNext(s,1)}return this.getBoardInfoResult(l,c,o,r)}}const Ree=VK.NONE.value,xee=BK.ZERO.value,Dee=BK.ONE.value;let Lee=(()=>{class e{}return e.MOVEMENT_NOT_DISCONNECTING=()=>$localize`This move does not disconnect your opponent's pieces. Try again with another piece.`,e.MOVEMENT_SELF_DISCONNECTING=()=>$localize`You lost one of your pieces during this move. There is a way to disconnect an opponent's piece without losing any of yours, try again!`,e})();class Fee{constructor(){this.tutorial=[kJ.informational($localize`Six`,$localize`Six is a game without board, where pieces are placed on the side of each other, in a contiguous block.
        Each player has 21 pieces, with one for each player already on the board.
        The goal of the game is to form one of the three winning shapes with your pieces.`,Tee.getInitialState()),kJ.fromMove($localize`Victory (line)`,$localize`On this board, by putting your piece at the right place, you can align six of your pieces and win the game<br/><br/>
        Find the victory. You're playing Dark.`,Tee.fromRepresentation([[xee,Dee,Dee,Dee,Dee,xee],[Ree,xee,Dee,Ree,xee,Ree],[Dee,Dee,xee,Ree,Ree,Ree],[Ree,Ree,xee,Ree,Ree,Ree],[Ree,xee,Ree,Ree,Ree,Ree],[xee,Ree,Ree,Ree,Ree,Ree]],0),[Iee.fromDrop(new JX(3,2))],$localize`Congratulations!`,$localize`Failed!`),kJ.fromMove($localize`Victory (circle)`,$localize`On this board, by putting your piece at the right place, you can form a circle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,Tee.fromRepresentation([[Ree,Ree,Ree,Dee,Ree,Ree],[Ree,Ree,Dee,Dee,xee,xee],[Ree,Dee,Ree,xee,Dee,Ree],[Dee,xee,xee,xee,xee,Dee]],0),[Iee.fromDrop(new JX(5,2))],$localize`Congratulations! Note that if a piece is inside the circle, it does not change anything.`,$localize`Failed!`),kJ.fromMove($localize`Victory (triangle)`,$localize`On this board, by putting your piece at the right place, you can form a triangle with six of your pieces and win the game.<br/><br/>
        Find the victory. You're playing Dark.`,Tee.fromRepresentation([[Ree,Ree,Ree,Dee,Ree,Ree],[Ree,xee,Dee,xee,xee,xee],[Ree,xee,Ree,xee,xee,Ree],[Dee,Dee,Dee,Ree,Dee,Ree]],0),[Iee.fromDrop(new JX(3,3))],$localize`Congratulations!`,$localize`Failed!`),kJ.fromPredicate($localize`Second phase`,$localize`After 40 turns, your pieces have all been placed and we move on to the second phase of the game.
        You now have to move your pieces, paying attention not to remove a piece that was preventing the opponent's victory.
        From now on, if after move, on or more pieces are disconnected from the largest group of pieces, these will be taken out of the game.<br/><br/>
        You're playing Dark. Make a move that disconnects one of your opponent's pieces.`,Tee.fromRepresentation([[Ree,Ree,Ree,Ree,Ree,Ree,Ree,Dee,Ree],[Ree,Ree,Ree,Ree,Ree,Ree,xee,Ree,Ree],[Ree,Ree,Ree,Ree,xee,xee,xee,Ree,Ree],[Ree,Ree,Ree,Ree,Dee,Dee,Ree,Dee,xee],[Ree,xee,Dee,Dee,xee,xee,Dee,Ree,Ree],[xee,xee,xee,xee,Dee,Dee,Dee,xee,Ree],[Dee,Dee,xee,Ree,Dee,Dee,xee,Ree,Ree],[Ree,xee,Ree,xee,xee,Ree,Ree,Ree,Ree],[Dee,Dee,Dee,Dee,Ree,Ree,Ree,Ree,Ree],[Ree,xee,Ree,Dee,Ree,Ree,Ree,Ree,Ree]],40),Iee.fromMovement(new JX(6,1),new JX(5,1)),(e,t)=>{const n=t.countPieces();return 19===n[0]?18===n[1]?TW.SUCCESS:TW.failure(Lee.MOVEMENT_NOT_DISCONNECTING()):TW.failure(Lee.MOVEMENT_SELF_DISCONNECTING())},$localize`Congratulations, your opponent now has one piece less and you're closer to victory!`),kJ.fromPredicate($localize`Victory by disconnection`,$localize`During the second phase of the game, on top of normal victories (line, circle, triangle), you can win by disconnection.
        If at any time, at least one player does not have enough pieces to win (less than 6), the game ends.
        The one with the most pieces wins. In case they both have the same number of pieces, it's a draw.<br/><br/>
        Here, you're playing Dark and you can win. Do it!`,Tee.fromRepresentation([[Ree,Ree,Ree,Ree,Ree,Dee],[Ree,Ree,Ree,Ree,xee,Dee],[Ree,Ree,Ree,Dee,xee,xee],[Ree,Ree,xee,Ree,Dee,xee],[Dee,Dee,Ree,Ree,Ree,xee],[xee,Dee,Ree,Ree,Ree,Ree],[xee,Ree,Ree,Ree,Ree,Ree]],40),Iee.fromMovement(new JX(2,3),new JX(3,3)),(e,t)=>e.start.equalsValue(new JX(2,3))?TW.SUCCESS:TW.failure(Lee.MOVEMENT_NOT_DISCONNECTING()),$localize`Congratulations, you won!`),kJ.fromPredicate($localize`Special disconnection`,$localize`During a disconnection, two or more groups could have the same size,
        in which case you will have to click on the group you wish to keep.<br/><br/>
        You're playing Dark, play such a move!`,Tee.fromRepresentation([[Ree,Ree,Ree,Ree,Ree,Dee],[Ree,Ree,Ree,Ree,xee,Dee],[Ree,Ree,Ree,Dee,xee,xee],[xee,Ree,xee,Ree,Ree,Dee],[Dee,Dee,Ree,Ree,Ree,Ree],[xee,xee,Ree,Ree,Ree,Ree],[xee,Ree,Ree,Ree,Ree,Ree]],40),Iee.fromCut(new JX(2,3),new JX(2,5),new JX(2,5)),(e,t)=>e.keep.isAbsent()?TW.failure($localize`This move has not cut the board in two equal halves.`):t.getPieceAt(e.landing.getNext(t.offset))===VK.NONE?TW.failure($localize`Failed. You did cut the board in two but you kept the half where you're in minority. Therefore, you lost! Try again.`):TW.SUCCESS,$localize`Congratulations, you won!`)]}}function Uee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onPieceClick(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa();Ia("id","piece_",e.x,"_",e.y,""),ha("ngClass",n.getPieceClass(e)),ra("points",n.getHexaCoordsAt(e))}}function Bee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",11),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onNeighborClick(t)}),fa()}if(2&e){const e=t.$implicit,n=Sa();Ia("id","neighbor_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function Vee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",10),Ea("click",function(){Gt(e);const t=Sa();return t.onPieceClick(t.chosenLanding.get())}),fa()}if(2&e){const e=Sa();Ia("id","chosenLanding_",e.chosenLanding.get().x,"_",e.chosenLanding.get().y,""),ha("ngClass",e.getPlayerClass(e.state.getCurrentPlayer())),ra("points",e.getHexaCoordsAt(e.chosenLanding.get()))}}function $ee(e,t){if(1&e&&(Cn(),ga(0,"polyline",12)),2&e){const e=t.$implicit,n=Sa();Ia("id","disconnected_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function zee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",13),Ea("click",function(){Gt(e);const t=Sa();return t.onNeighborClick(t.leftCoord.get())}),fa()}if(2&e){const e=Sa();Ia("id","leftCoord_",e.leftCoord.get().x,"_",e.leftCoord.get().y,""),ra("points",e.getHexaCoordsAt(e.leftCoord.get()))}}function Hee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=Sa();return t.onPieceClick(t.lastDrop.get())}),fa()}if(2&e){const e=Sa();Ia("id","lastDrop_",e.lastDrop.get().x,"_",e.lastDrop.get().y,""),ra("points",e.getHexaCoordsAt(e.lastDrop.get()))}}function Gee(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",15),Ea("click",function(){Gt(e);const t=Sa();return t.onPieceClick(t.selectedPiece.get())}),fa()}if(2&e){const e=Sa();Ia("id","selectedPiece_",e.selectedPiece.get().x,"_",e.selectedPiece.get().y,""),ha("ngClass",e.getSelectedPieceClass()),ra("points",e.getHexaCoordsAt(e.selectedPiece.get()))}}function Wee(e,t){if(1&e&&(Cn(),ga(0,"polyline",16)),2&e){const e=t.$implicit,n=Sa();Ia("id","victoryCoord_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function qee(e,t){if(1&e){const e=va();Cn(),pa(0,"g",19),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).onPieceClick(t)}),ga(1,"polyline",20),fa()}if(2&e){const e=t.$implicit,n=Sa(2);Ts(1),Ia("id","cuttable_",e.x,"_",e.y,""),ra("points",n.getHexaCoordsAt(e))}}function jee(e,t){if(1&e&&(Cn(),pa(0,"g",17),la(1,qee,2,3,"g",18),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let Zee=(()=>{class e extends tJ{constructor(e){super(e),this.disconnecteds=[],this.cuttableGroups=[],this.leftCoord=Mw.empty(),this.lastDrop=Mw.empty(),this.selectedPiece=Mw.empty(),this.chosenLanding=Mw.empty(),this.nextClickShouldSelectGroup=!1,this.rules=new kee(Tee),this.availableMinimaxes=[new Nee(this.rules,"SixMinimax")],this.encoder=Iee.encoder,this.tutorial=(new Fee).tutorial,this.SPACE_SIZE=30,this.hexaLayout=new iJ(1.5*this.SPACE_SIZE,new JX(2*this.SPACE_SIZE,0),aJ.INSTANCE),this.updateBoard()}cancelMoveAttempt(){this.selectedPiece=Mw.empty(),this.chosenLanding=Mw.empty(),this.cuttableGroups=[],this.nextClickShouldSelectGroup=!1,this.updateBoard()}updateBoard(){this.state=this.rules.node.gameState,this.rules.node.move.isPresent()?this.showLastMove():(this.leftCoord=Mw.empty(),this.lastDrop=Mw.empty(),this.victoryCoords=[],this.disconnecteds=[]),this.pieces=this.state.pieces.listKeys(),this.neighbors=this.getEmptyNeighbors(),this.viewBox=this.getViewBox()}getViewBox(){const e=this.mapAbstractCoordToCornerCoords(),t=this.getLimits(e);return t.minX-this.STROKE_WIDTH/2+" "+(t.minY-this.STROKE_WIDTH/2)+" "+(this.STROKE_WIDTH+t.maxX-t.minX)+" "+(this.STROKE_WIDTH+t.maxY-t.minY)}mapAbstractCoordToCornerCoords(){const e=this.pieces.concat(this.disconnecteds).concat(this.neighbors).map(e=>this.hexaLayout.getHexaCoordsAt(e));let t=[];for(const n of e)t=t.concat(n);return t}getLimits(e){let t=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;for(const s of e)s.x<r&&(r=s.x),s.y<i&&(i=s.y),t=Math.max(t,s.x),n=Math.max(n,s.y);return{minX:r,minY:i,maxX:t,maxY:n}}showLastMove(){const e=this.rules.node.move.get();this.lastDrop=Mw.of(e.landing.getNext(this.state.offset,1)),this.leftCoord=!1===e.isDrop()?Mw.of(e.start.get().getNext(this.state.offset,1)):Mw.empty();const t=this.rules.node.gameState;this.rules.getGameStatus(this.rules.node).isEndGame&&(this.victoryCoords=this.rules.getShapeVictory(e,t)),this.disconnecteds=this.getDisconnected()}getDisconnected(){const e=this.rules.node.mother.get().gameState.pieces.listKeys(),t=this.rules.node.gameState.pieces.listKeys(),n=[];for(const i of e)!1===this.rules.node.move.get().start.equalsValue(i)&&!1===t.some(e=>e.equals(i.getNext(this.state.offset,1)))&&n.push(i.getNext(this.state.offset,1));const r=this.lastDrop.get();return!1===this.pieces.some(e=>e.equals(r))&&!1===t.some(e=>e.equals(r))&&n.push(r),n}getEmptyNeighbors(){let e=kee.getLegalLandings(this.state);if(this.chosenLanding.isPresent()){const t=this.chosenLanding.get();e=e.filter(e=>!1===e.equals(t))}return e}getPieceClass(e){const t=this.rules.node.gameState.getPieceAt(e);return this.getPlayerClass(t)}onPieceClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#piece_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.state.turn<40)return t.cancelMove(Oee.NO_MOVEMENT_BEFORE_TURN_40());if(t.chosenLanding.isAbsent())return t.state.getPieceAt(e)===t.state.getCurrentOpponent()?t.cancelMove(lJ.CANNOT_CHOOSE_OPPONENT_PIECE()):(t.selectedPiece=Mw.of(e),TW.SUCCESS);{const n=Iee.fromCut(t.selectedPiece.get(),t.chosenLanding.get(),e);return t.chooseMove(n,t.state)}})()}onNeighborClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#neighbor_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());if(t.nextClickShouldSelectGroup)return t.cancelMove(Oee.MUST_CUT());if(t.state.turn<40)return t.chooseMove(Iee.fromDrop(e),t.state);if(t.selectedPiece.isAbsent())return t.cancelMove(Oee.CAN_NO_LONGER_DROP());{const n=Iee.fromMovement(t.selectedPiece.get(),e),r=kee.isLegalPhaseTwoMove(n,t.state);return t.neededCutting(r)?(t.chosenLanding=Mw.of(e),t.moveVirtuallyPiece(),t.showCuttable(),t.nextClickShouldSelectGroup=!0,TW.SUCCESS):t.chooseMove(n,t.state)}})()}neededCutting(e){return e.isFailure()&&e.getReason()===Oee.MUST_CUT()}moveVirtuallyPiece(){const e=this.selectedPiece.get();this.pieces=this.pieces.filter(t=>!1===t.equals(e)),this.neighbors=this.getEmptyNeighbors()}showCuttable(){const e=Iee.fromMovement(this.selectedPiece.get(),this.chosenLanding.get()),t=Tee.deplacePiece(this.state,e),n=Tee.getGroups(t,e.start.get()),r=kee.getBiggerGroups(n);this.cuttableGroups=[];for(const i of r)this.cuttableGroups.push(i.toList())}getSelectedPieceClass(){return this.chosenLanding.isPresent()?"moved":"selected"}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-six"]],features:[Go],decls:10,vars:10,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],["class","base round",3,"id","ngClass","click",4,"ngFor","ngForOf"],["class","base round",3,"id","click",4,"ngFor","ngForOf"],["class","base round",3,"id","ngClass","click",4,"ngIf"],["class","base round captured",3,"id",4,"ngFor","ngForOf"],["class","base round moved mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round last-move mid-stroke",3,"id","click",4,"ngIf"],["class","base no-fill round",3,"id","ngClass","click",4,"ngIf"],["class","base no-fill round highlighted mid-stroke",3,"id",4,"ngFor","ngForOf"],["pointer-events","fill","class","capturable",4,"ngFor","ngForOf"],[1,"base","round",3,"id","ngClass","click"],[1,"base","round",3,"id","click"],[1,"base","round","captured",3,"id"],[1,"base","round","moved","mid-stroke",3,"id","click"],[1,"base","no-fill","round","last-move","mid-stroke",3,"id","click"],[1,"base","no-fill","round",3,"id","ngClass","click"],[1,"base","no-fill","round","highlighted","mid-stroke",3,"id"],["pointer-events","fill",1,"capturable"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["stroke-linecap","round",1,"no-fill",3,"id"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,Uee,1,4,"polyline",1),la(2,Bee,1,3,"polyline",2),la(3,Vee,1,4,"polyline",3),la(4,$ee,1,3,"polyline",4),la(5,zee,1,3,"polyline",5),la(6,Hee,1,3,"polyline",6),la(7,Gee,1,4,"polyline",7),la(8,Wee,1,3,"polyline",8),la(9,jee,2,1,"g",9),fa()),2&e&&(ra("viewBox",t.viewBox),Ts(1),ha("ngForOf",t.pieces),Ts(1),ha("ngForOf",t.neighbors),Ts(1),ha("ngIf",t.chosenLanding.isPresent()),Ts(1),ha("ngForOf",t.disconnecteds),Ts(1),ha("ngIf",t.leftCoord.isPresent()),Ts(1),ha("ngIf",t.lastDrop.isPresent()),Ts(1),ha("ngIf",t.selectedPiece.isPresent()),Ts(1),ha("ngForOf",t.victoryCoords),Ts(1),ha("ngForOf",t.cuttableGroups))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class Yee extends w1{static of(e,t){return new Yee(e,t)}static from(e,t){try{const n=new Yee(e,t);return SW.success(n)}catch(n){return SW.failure(n.message)}}getMaximalDistance(){return 9}}Yee.encoder=C1.getEncoder(9,9,Yee.of);const Kee={CASTLE_IS_LEFT_FOR_GOOD:!1,BORDER_CAN_SURROUND_KING:!0,CENTRAL_THRONE_CAN_SURROUND_KING:!1,KING_FAR_FROM_CENTRAL_THRONE_CAN_BE_SANDWICHED:!1,WIDTH:9,INVADER:BK.ZERO};class Qee extends T1{static getInitialState(){const e=P1.UNOCCUPIED,t=P1.INVADERS,n=P1.DEFENDERS;return new Qee([[e,e,e,t,t,t,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,e,n,e,e,e,e],[t,e,e,e,n,e,e,e,t],[t,t,n,n,P1.PLAYER_ONE_KING,n,n,t,t],[t,e,e,e,n,e,e,e,t],[e,e,e,e,n,e,e,e,e],[e,e,e,e,t,e,e,e,e],[e,e,e,t,t,t,e,e,e]],0)}from(e,t){return new Qee(e,t)}}class Xee extends k1{constructor(){super(Qee,Kee,Yee.of)}static get(){return null==Xee.singleton&&(Xee.singleton=new Xee),bJ.ruler=this.singleton,Xee.singleton}}const Jee=P1.UNOCCUPIED,ete=P1.INVADERS,tte=P1.DEFENDERS,nte=P1.PLAYER_ONE_KING;class rte{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`Tablut is a strategy game that was played by the Vikings.
        The goal of the game is different for each player.
        The attacker plays first. Its pieces (dark) are close to the edges.
        Its goal is to capture the king, which is in the center of the board.
        The defender plays second. Its pieces (light) are in the middle.
        Its goal is to move the king on one of the 4 thrones in the corners.
        Note that the square in which the king starts, in the center of the board, is also a throne.`,Qee.getInitialState()),kJ.anyMove($localize`Moving`,$localize`All pieces move the same way.
        Similarly to a rook in chess, a piece can move:
        <ol>
            <li>By as many squares as you want.</li>
            <li>Without going over another piece or stopping on another piece.</li>
            <li>Horizontally or vertically.</li>
            <li>Only the king can land on a throne.</li>
        </ol>
        To move a piece, click on it and then on its landing square.<br/><br/>
        You're playing Dark, do the first move.`,Qee.getInitialState(),Yee.of(new JX(4,1),new JX(1,1)),$localize`Congratulations!`),kJ.fromMove($localize`Capturing a soldier (1/2)`,$localize`All pieces, attackers and defenders, except the king, are soldiers. To capture them, they have to be sandwiched between two of your pieces. By getting too close, an attacker's soldier is in danger.<br/><br/>Capture it.`,new Qee([[Jee,Jee,Jee,ete,ete,ete,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,ete,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,ete,tte,Jee,Jee,Jee,ete],[ete,ete,tte,tte,nte,tte,tte,ete,ete],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,ete],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,ete,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,ete,ete,ete,Jee,Jee,Jee]],1),[Yee.of(new JX(2,4),new JX(2,3)),Yee.of(new JX(4,2),new JX(3,2))],$localize`Congratulations, that will teach him a lesson!`,$localize`Failed, you missed an opportunity to capture a piece of the opponent.`),kJ.fromMove($localize`Capturing a soldier (2/2)`,$localize`A second way to capture a soldier is to sandwich it against an empty throne. The king has moved and endangered one of its soldiers.<br/><br/>Capture it.`,new Qee([[Jee,Jee,Jee,ete,ete,ete,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,ete,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,Jee],[Jee,Jee,tte,Jee,nte,Jee,tte,Jee,ete],[ete,ete,Jee,tte,Jee,tte,tte,ete,ete],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,ete],[Jee,Jee,Jee,Jee,tte,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,ete,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,ete,ete,ete,Jee,Jee,Jee]],12),[Yee.of(new JX(1,4),new JX(2,4))],$localize`Congratulations, one less defender. But keep an eye on the king, it is the most important.`,$localize`Failed, you did not do the expected move.`),kJ.fromMove($localize`Capturing the king (1/2)`,$localize`To capture the king, two soldiers are not enough.
        For the first solution, the four squares neighbor to the king (horizontally and vertically) must be occupied by your soldiers.
        This also works if the king is on the throne.<br/><br/>
        Capture the king.`,new Qee([[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,ete,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[ete,nte,Jee,ete,Jee,Jee,Jee,Jee,Jee],[Jee,ete,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee]],72),[Yee.of(new JX(3,4),new JX(2,4))],$localize`Congratulations, you won!`,$localize`Failed, you let the king run away.`),kJ.fromMove($localize`Capturing the king (2/2)`,$localize`Another way to capture the king is to immobilize it against an edge of the board.
        Note that the king cannot be captured next to a throne.<br/><br/>
        Capture the king.`,new Qee([[Jee,Jee,ete,nte,ete,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,ete,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee],[Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee,Jee]],72),[Yee.of(new JX(3,3),new JX(3,1))],$localize`The king is dead, long live the king. Congratulations, you won.`,$localize`Failed!`)]}}function ite(e,t){1&e&&(Cn(),ga(0,"polyline",8))}function ste(e,t){1&e&&(Cn(),ga(0,"polyline",9))}function ote(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,ite,1,0,"polyline",6),la(2,ste,1,0,"ng-template",null,7,Ku),fa()),2&e){const e=ca(3),t=Sa().index,n=Sa().index,r=Sa();Ts(1),ha("ngIf",r.isCentralThrone(t,n))("ngIfElse",e)}}function ate(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10),ga(4,"line",10),ga(5,"line",10),fa()),2&e){const e=Sa(2).index,t=Sa().index,n=Sa();Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.1*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.9*n.SPACE_SIZE)("y2",.6*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.15*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.4*n.SPACE_SIZE)("x2",.85*n.SPACE_SIZE)("y2",.75*n.SPACE_SIZE)}}function lte(e,t){if(1&e&&(Cn(),ga(0,"polyline",15)),2&e){const e=Sa(3).index,t=Sa().index;ha("ngClass",Sa().viewInfo.pieceClasses[t][e])}}function cte(e,t){if(1&e&&(Cn(),ga(0,"line",10),ga(1,"line",10),ga(2,"line",10),ga(3,"line",10)),2&e){const e=Sa(3).index,t=Sa().index,n=Sa();ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.5*n.SPACE_SIZE)("y1",.04*n.SPACE_SIZE)("x2",.5*n.SPACE_SIZE)("y2",.96*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.04*n.SPACE_SIZE)("y1",.5*n.SPACE_SIZE)("x2",.96*n.SPACE_SIZE)("y2",.5*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.2*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.8*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE),Ts(1),ha("ngClass",n.viewInfo.pieceClasses[t][e]),ra("x1",.8*n.SPACE_SIZE)("y1",.2*n.SPACE_SIZE)("x2",.2*n.SPACE_SIZE)("y2",.8*n.SPACE_SIZE)}}function ute(e,t){if(1&e&&(Cn(),la(0,lte,1,1,"polyline",13),la(1,cte,4,20,"ng-template",null,14,Ku)),2&e){const e=ca(2),t=Sa(2).index,n=Sa().index;ha("ngIf",Sa().isKing(t,n))("ngIfElse",e)}}function hte(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",10),la(2,ate,6,25,"g",11),la(3,ute,3,2,"ng-template",null,12,Ku),fa()),2&e){const e=ca(4),t=Sa().index,n=Sa().index,r=Sa();Ts(1),ha("ngClass",r.viewInfo.pieceClasses[n][t]),ra("r",r.SPACE_SIZE/2-r.STROKE_WIDTH)("cx",.5*r.SPACE_SIZE)("cy",.5*r.SPACE_SIZE),Ts(1),ha("ngIf",r.isInvader(t,n))("ngIfElse",e)}}function dte(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){const t=Gt(e).index,n=Sa().index;return Sa().onClick(t,n)}),ga(1,"rect",4),la(2,ote,4,2,"g",5),la(3,hte,5,6,"g",5),fa()}if(2&e){const e=t.index,n=Sa().index,r=Sa();Ia("id","click_",e,"_",n,""),ra("transform","translate("+r.SPACE_SIZE*e+", "+r.SPACE_SIZE*n+")"),Ts(1),ha("ngClass",r.getRectClasses(e,n)),ra("width",r.SPACE_SIZE)("height",r.SPACE_SIZE),Ts(1),ha("ngIf",r.board[n][e]===r.EMPTY&&r.isThrone(e,n)),Ts(1),ha("ngIf",r.board[n][e]!==r.EMPTY)}}function pte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,dte,4,8,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function fte(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",16),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t.x,t.y)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),Ia("id","click_",e.x,"_",e.y,""),ra("x",n.SPACE_SIZE*e.x)("y",n.SPACE_SIZE*e.y)("width",n.SPACE_SIZE)("height",n.SPACE_SIZE)}}let gte=(()=>{class e extends M1{constructor(e){super(e,!1,Yee.from),this.rules=Xee.get(),this.availableMinimaxes=[new N1(this.rules,"DummyBot"),new F1(this.rules,"Piece > Influence"),new U1(this.rules,"Piece > Control"),new B1(this.rules,"Escape > Piece > Control")],this.encoder=Yee.encoder,this.tutorial=(new rte).tutorial,this.updateBoard()}}return e.\u0275fac=function(t){return new(t||e)(ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["app-tablut"]],features:[Go],decls:3,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],["x","0","y","0",1,"base",3,"ngClass"],[4,"ngIf"],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15","class","base",4,"ngIf","ngIfElse"],["cornerThrone",""],["points","15 15, 85 15, 85 85, 15 85, 15 15, 85 15",1,"base"],["points","10 20, 20 90, 80 90, 90 20, 65 60, 50 30, 35 60, 10 20",1,"base"],[1,"base",3,"ngClass"],[4,"ngIf","ngIfElse"],["defender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85","class","base no-fill",3,"ngClass",4,"ngIf","ngIfElse"],["soldierDefender",""],["points","80 85, 32.5 37.5, 50 20, 67.5 37.5, 20 85",1,"base","no-fill",3,"ngClass"],[1,"no-fill","mid-stroke","clickable",3,"id","click"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,pte,2,1,"g",1),la(2,fte,2,6,"g",1),fa()),2&e&&(ra("viewBox",t.getViewBox()),Ts(1),ha("ngForOf",t.board),Ts(1),ha("ngForOf",t.getClickables()))},directives:[tp,Jd,rp],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]}),e})();class mte{}mte.PLACEMENT_AFTER_INITIAL_PHASE=()=>$localize`You cannot put a new ring after the tenth turn.`,mte.NO_MARKERS_IN_INITIAL_PHASE=()=>$localize`You cannot put a marker in a ring before placing all of your rings.`,mte.MISSING_CAPTURES=$3.MISSING_CAPTURES,mte.MOVE_DIRECTION_INVALID=()=>$localize`The direction of your move is invalid: a move is made along a straight line.`,mte.CAN_ONLY_CAPTURE_YOUR_MARKERS=()=>$localize`You can only capture your own markers.`,mte.SHOULD_SELECT_PLAYER_RING=()=>$localize`You must pick one of your own rings to move.`,mte.SHOULD_END_MOVE_ON_EMPTY_SPACE=()=>$localize`Your ring must land on an empty space.`,mte.MOVE_SHOULD_NOT_PASS_ABOVE_RING=()=>$localize`A ring can only jump over markers or empty spaces, not over another ring.`,mte.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS=()=>$localize`Your ring must land on the first empty space after a group of markers.`,mte.AMBIGUOUS_CAPTURE_COORD=$3.AMBIGUOUS_CAPTURE_COORD,mte.CAPTURE_SHOULD_TAKE_RING=()=>$localize`When you capture markers, you must take one of your ring as well by clicking on it.`;class yte{constructor(e,t){this.player=e,this.isRing=t}static of(e,t){return e===VK.NONE?yte.EMPTY:t?yte.RINGS[e.value]:yte.MARKERS[e.value]}equals(e){return this===e}flip(){return NW(!1===this.isRing,"cannot flip a ring (it should never happen)"),NW(this.player.isPlayer(),"cannot flip a non-player piece"),yte.of(this.player.getOpponent(),this.isRing)}toString(){switch(this){case yte.UNREACHABLE:return"NONE";case yte.EMPTY:return"EMPTY";case yte.MARKER_ZERO:return"MARKER_ZERO";case yte.MARKER_ONE:return"MARKER_ONE";case yte.RING_ZERO:return"RING_ZERO";default:return Ow.expectToBe(this,yte.RING_ONE),"RING_ONE"}}}yte.encoder=FK.tuple([BK.numberEncoder,FK.booleanEncoder],e=>[e.player,e.isRing],e=>yte.of(e[0],e[1])),yte.UNREACHABLE=new yte(VK.NONE,!1),yte.EMPTY=new yte(VK.NONE,!1),yte.MARKER_ZERO=new yte(BK.ZERO,!1),yte.MARKER_ONE=new yte(BK.ONE,!1),yte.MARKERS=[yte.MARKER_ZERO,yte.MARKER_ONE],yte.RING_ZERO=new yte(BK.ZERO,!0),yte.RING_ONE=new yte(BK.ONE,!0),yte.RINGS=[yte.RING_ZERO,yte.RING_ONE];let vte=(()=>{class e extends E2{constructor(t,n,r){super(r,t,e.SIZE,e.SIZE,[6,4,3,2,1],yte.EMPTY),this.sideRings=n}static getInitialState(){const t=yte.EMPTY,n=yte.UNREACHABLE;return new e([[n,n,n,n,n,n,t,t,t,t,n],[n,n,n,n,t,t,t,t,t,t,t],[n,n,n,t,t,t,t,t,t,t,t],[n,n,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,t],[n,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,t,n],[t,t,t,t,t,t,t,t,t,n,n],[t,t,t,t,t,t,t,t,n,n,n],[t,t,t,t,t,t,t,n,n,n,n],[n,t,t,t,t,n,n,n,n,n,n]],[5,5],0)}isInitialPlacementPhase(){return this.turn<10}countScores(){return this.turn<10?[0,0]:this.sideRings}equals(e){return this===e||this.turn===e.turn&&this.sideRings[0]===e.sideRings[0]&&this.sideRings[1]===e.sideRings[1]&&GK.compareTable(this.board,e.board)}getRingCoords(e){const t=[];return this.forEachCoord((n,r)=>{r.isRing&&r.player===e&&t.push(n)}),t}isOnBoard(e){return!e.isNotInRange(this.width,this.height)&&this.board[e.y][e.x]!==yte.UNREACHABLE}setAtUnsafe(t,n){const r=GK.copyBiArray(this.board);return r[t.y][t.x]=n,new e(r,this.sideRings,this.turn)}}return e.SIZE=11,e})();class _te extends F3{constructor(e,t){if(super(e),5!==e.length)throw new Error("YinshCapture must capture exactly 5 pieces");this.ringTaken=Mw.ofNullable(t)}static of(e,t,n){const r=[],i=rJ.factory.fromMove(e,t).get();for(let s=e;!1===s.equals(t);s=s.getNext(i))r.push(s);return r.push(t),new _te(r,n)}setRingTaken(e){return new _te(this.capturedSpaces,e)}equals(e){return!(!1===super.equals(e)||!1===this.ringTaken.equals(e.ringTaken))}}_te.encoder=new class extends DK{encode(e){return{captured:e.capturedSpaces.map(e=>JX.encoder.encode(e)),ringTaken:JX.encoder.encode(e.ringTaken.get())}}decode(e){const t=e;return NW(null!=t.captured&&null!=t.ringTaken,"Invalid encoded YinshCapture"),new _te(t.captured.map(e=>JX.encoder.decode(e)),JX.encoder.decode(t.ringTaken))}};class Cte extends mJ{constructor(e,t,n,r){super(),this.initialCaptures=e,this.start=t,this.end=n,this.finalCaptures=r}isInitialPlacement(){return this.end.isAbsent()}equals(e){return this===e||!(!1===this.start.equals(e.start)||!1===this.end.equals(e.end)||!1===GK.compareArray(this.initialCaptures,e.initialCaptures)||!1===GK.compareArray(this.finalCaptures,e.finalCaptures))}toString(){return"YinshMove(["+this.capturesToString(this.initialCaptures)+"], "+this.start.toString()+", "+this.end.toString()+", ["+this.capturesToString(this.finalCaptures)+"])"}capturesToString(e){let t="";for(const n of e)""!==t&&(t+=","),t+="["+n.toString()+"]";return t}}Cte.coordOptionalEncoder=L3(JX.encoder),Cte.encoder=new class extends LK{encodeMove(e){const t={moveStart:JX.encoder.encode(e.start),moveEnd:Cte.coordOptionalEncoder.encode(e.end)};return e.initialCaptures.map((e,n)=>{t["initialCapture"+n]=_te.encoder.encode(e)}),e.finalCaptures.map((e,n)=>{t["finalCapture"+n]=_te.encoder.encode(e)}),t}decodeMove(e){const t=e;return NW(null!=t.moveStart,"Invalid encoded YinshMove"),new Cte(this.decodeArray(t,"initialCapture",_te.encoder.decode),JX.encoder.decode(t.moveStart),Cte.coordOptionalEncoder.decode(t.moveEnd),this.decodeArray(t,"finalCapture",_te.encoder.decode))}decodeArray(e,t,n){const r=[];for(let i=0;null!=e[t+i];i++)r.push(n(e[t+i]));return r}};class Ete extends cJ{getBoardValue(e){const t=this.ruler.getGameStatus(e);return t.isEndGame?uJ.fromWinner(t.winner):new uJ(e.gameState.sideRings[0]*BK.ZERO.getScoreModifier()+e.gameState.sideRings[1]*BK.ONE.getScoreModifier())}getListMoves(e){const t=[],n=e.gameState;if(n.isInitialPlacementPhase())for(const[r,i]of n.getCoordsAndContents())i===yte.EMPTY&&t.push(new Cte([],r,Mw.empty(),[]));else{const e=this.ruler;this.getPossibleCaptureCombinations(n).forEach(r=>{const i=e.applyCaptures(n,r);this.getRingMoves(i).forEach(n=>{const s=e.applyRingMoveAndFlip(i,n.start,n.end);this.getPossibleCaptureCombinations(s).forEach(e=>{const i=new Cte(r,n.start,Mw.of(n.end),e);t.push(i)})})})}return t}getPossibleCaptureCombinations(e){const t=this.ruler.getPossibleCaptures(e),n=this.getRingCoords(e);return H3.getPossibleCaptureCombinationsFromPossibleCaptures(t).map(e=>class{static getCombinations(e,t){return NW(e.length>=t,"cannot compute combinations for less elements than needed"),this.getSubsetsOfSize(e,t).map(e=>this.getPermutations(e)).reduce((e,t)=>e.concat(t))}static getPermutations(e){const t=e.length,n=[e.slice()],r=new Array(t).fill(0);let i=1;for(;i<t;)if(r[i]<i){const t=i%2&&r[i],s=e[i];e[i]=e[t],e[t]=s,++r[i],i=1,n.push(e.slice())}else r[i]=0,++i;return n}static getSubsetsOfSize(e,t){return function t(n,r){if(r>=e.length||n<1)return[[]];{const i=[];for(;r<=e.length-n;){const s=e[r];for(const e of t(n-1,r+1))e.push(s),i.push(e);++r}return i}}(t,0)}}.getCombinations(n,e.length).map(t=>e.map((e,n)=>new _te(e.capturedSpaces,t[n])))).reduce((e,t)=>e.concat(t),[])}getRingMoves(e){const t=this.ruler,n=[];for(const r of this.getRingCoords(e))for(const i of t.getRingTargets(e,r))n.push({start:r,end:i});return n}getRingCoords(e){const t=e.getCurrentPlayer().value,n=[];return e.forEachCoord((e,r)=>{r===yte.RINGS[t]&&n.push(e)}),n}}class wte extends PJ{applyLegalMove(e,t,n){return new vte(n.board,n.sideRings,n.turn+1)}applyCaptures(e,t){let n=e;return t.forEach(e=>{n=this.applyCapture(n,e)}),n}applyCapture(e,t){const n=this.applyCaptureWithoutTakingRing(e,t);return this.takeRing(new vte(n,e.sideRings,e.turn),t.ringTaken.get())}takeRing(e,t){const n=e.getCurrentPlayer().value,r=e.setAt(t,yte.EMPTY).board,i=[e.sideRings[0],e.sideRings[1]];return i[n]+=1,new vte(r,i,e.turn)}applyCaptureWithoutTakingRing(e,t){return t.forEach(t=>{e=e.setAt(t,yte.EMPTY)}),e.board}ringSelectionValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)===yte.RINGS[n]?TW.SUCCESS:TW.failure(mte.CAPTURE_SHOULD_TAKE_RING())}applyRingMoveAndFlip(e,t,n){const r=e.getCurrentPlayer().value;let i=e.setAt(t,yte.MARKERS[r]);i=i.setAt(n,yte.RINGS[r]);const s=rJ.factory.fromMove(t,n).get();for(let o=t.getNext(s);!1===o.equals(n);o=o.getNext(s)){const e=i.getPieceAt(o);e!==yte.EMPTY&&(i=i.setAt(o,e.flip()))}return i}isLegal(e,t){if(e.isInitialPlacement())return this.initialPlacementValidity(t,e.start);if(t.isInitialPlacementPhase())return SW.failure(mte.NO_MARKERS_IN_INITIAL_PHASE());const n=this.capturesValidity(t,e.initialCaptures);if(n.isFailure())return n.toFailedFallible();const r=this.applyCaptures(t,e.initialCaptures),i=this.moveValidity(r,e.start,e.end.get());if(i.isFailure())return i.toFailedFallible();const s=this.applyRingMoveAndFlip(r,e.start,e.end.get()),o=this.capturesValidity(s,e.finalCaptures);if(o.isFailure())return o.toFailedFallible();const a=this.applyCaptures(s,e.finalCaptures),l=this.noMoreCapturesValidity(a);return l.isFailure()?l.toFailedFallible():SW.success(a)}initialPlacementValidity(e,t){if(!0!==e.isInitialPlacementPhase())return SW.failure(mte.PLACEMENT_AFTER_INITIAL_PHASE());if(e.getPieceAt(t)!==yte.EMPTY)return SW.failure(lJ.MUST_CLICK_ON_EMPTY_SPACE());const n=e.getCurrentPlayer(),r=[e.sideRings[0],e.sideRings[1]];r[n.value]-=1;const i=e.setAt(t,yte.of(n,!0)).board,s=new vte(i,r,e.turn);return SW.success(s)}moveStartValidity(e,t){const n=e.getCurrentPlayer().value;return e.getPieceAt(t)!==yte.RINGS[n]?TW.failure(mte.SHOULD_SELECT_PLAYER_RING()):TW.SUCCESS}moveValidity(e,t,n){const r=this.moveStartValidity(e,t);if(r.isFailure())return r;if(e.getPieceAt(n)!==yte.EMPTY)return TW.failure(mte.SHOULD_END_MOVE_ON_EMPTY_SPACE());const i=rJ.factory.fromMove(t,n);if(i.isFailure())return TW.failure(mte.MOVE_DIRECTION_INVALID());const s=i.get();let o=!1;for(let a=t.getNext(s);!1===a.equals(n);a=a.getNext(s)){const t=e.getPieceAt(a);if(t===yte.EMPTY){if(o)return TW.failure(mte.MOVE_SHOULD_END_AT_FIRST_EMPTY_SPACE_AFTER_MARKERS())}else{if(t.isRing)return TW.failure(mte.MOVE_SHOULD_NOT_PASS_ABOVE_RING());o=!0}}return TW.SUCCESS}capturesValidity(e,t){let n=e;for(const r of t){const e=this.captureValidity(n,r);if(e.isFailure())return e;n=this.applyCapture(n,r)}return TW.SUCCESS}captureValidity(e,t){const n=e.getCurrentPlayer().value;for(const r of t.capturedSpaces)if(e.getPieceAt(r)!==yte.MARKERS[n])return TW.failure(mte.CAN_ONLY_CAPTURE_YOUR_MARKERS());return e.getPieceAt(t.ringTaken.get())!==yte.RINGS[n]?TW.failure(mte.CAPTURE_SHOULD_TAKE_RING()):TW.SUCCESS}noMoreCapturesValidity(e){const t=e.getCurrentPlayer();return 0===this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).length?TW.SUCCESS:TW.failure(mte.MISSING_CAPTURES())}getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t){const n=[];return e.allLines().forEach(r=>{const i=this.getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,r);i.isPresent()&&n.push(i.get())}),n}getLinePortionWithAtLeastFivePiecesOfPlayer(e,t,n){let r=0;const i=e.getEntranceOnLine(n),s=n.getDirection();let o,a=i;for(o=i;e.isOnBoard(o);o=o.getNext(s)){const n=e.getPieceAt(o);if(n.player===t&&!1===n.isRing)0===r&&(a=o),r+=1;else{if(r>=5)break;r=0}}return r>=5?Mw.of({start:a,end:o,dir:s}):Mw.empty()}getPossibleCaptures(e){const t=e.getCurrentPlayer(),n=[];return this.getLinePortionsWithAtLeastFivePiecesOfPlayer(e,t).forEach(e=>{for(let t=e.start;t.getDistance(e.end)>=5;t=t.getNext(e.dir))n.push(_te.of(t,t.getNext(e.dir,4)))}),n}getRingTargets(e,t){const n=[];for(const r of rJ.factory.all){let i=!1;for(let s=t.getNext(r);e.isOnBoard(s);s=s.getNext(r)){const t=e.getPieceAt(s);if(t===yte.EMPTY){if(n.push(s),i)break}else{if(t.isRing)break;i=!0}}}return n}getGameStatus(e){return e.gameState.isInitialPlacementPhase()?SJ.ONGOING:e.gameState.sideRings[0]>=3?SJ.ZERO_WON:e.gameState.sideRings[1]>=3?SJ.ONE_WON:SJ.ONGOING}}const bte=yte.EMPTY,Ste=yte.UNREACHABLE,Pte=yte.MARKER_ZERO,Ote=yte.RING_ZERO,Tte=yte.MARKER_ONE,Ite=yte.RING_ONE;let kte=(()=>{class e{}return e.MUST_ALIGN_FIVE=()=>$localize`Failed! You need to align 5 markers of your color in order to get them, and to get a ring at the same time.`,e.MUST_CAPTURE_TWO=()=>$localize`Failed! You can capture two rings in total, by capturing two times 5 of your markers. Try again.`,e})();class Ate{constructor(){this.tutorial=[kJ.informational($localize`Goal of the game`,$localize`The goal at Yinsh is to capture three rings in total.
        The rings taken are shown on the top left for the dark player,
        and on the bottom right for the light player. Here, Dark won the game.
        Note that on the board you have two types of pieces for each player:
        rings (empty circles) and markers (full circles).`,new vte([[Ste,Ste,Ste,Ste,Ste,Ste,bte,bte,bte,bte,Ste],[Ste,Ste,Ste,Ste,bte,bte,bte,bte,bte,bte,bte],[Ste,Ste,Ste,Pte,Ite,bte,bte,bte,bte,bte,bte],[Ste,Ste,bte,Pte,bte,Ite,bte,Tte,bte,bte,bte],[Ste,bte,Ote,Tte,bte,bte,Ite,Pte,bte,bte,bte],[Ste,bte,bte,Pte,Tte,bte,bte,bte,bte,bte,Ste],[bte,bte,bte,Pte,bte,bte,bte,Ite,bte,bte,Ste],[bte,bte,bte,Tte,Pte,Ote,bte,bte,bte,Ste,Ste],[bte,bte,bte,bte,bte,bte,bte,bte,Ste,Ste,Ste],[bte,bte,bte,bte,bte,bte,bte,Ste,Ste,Ste,Ste],[Ste,bte,bte,bte,bte,Ste,Ste,Ste,Ste,Ste,Ste]],[3,1],20)),kJ.anyMove($localize`Initial board and placement phase`,$localize`The initial board is empty.
        At the beginning of the game, each player puts one of its ring on the board at their turn.
        This phase stops when all rings have been placed on the board.
        Put one of your ring on the board by clicking the space where you want to place it.`,new vte(vte.getInitialState().board,[5,5],0),new Cte([],new JX(5,5),Mw.empty(),[]),$localize`Congratulations!`),kJ.anyMove($localize`Putting a marker`,$localize`Once the initial phase is done and all rings are on the board, you need to place markers on the board.
        To do so, put a marker in a ring by clicking on that ring.
        Then, the ring must be moved in a straight line, in any direction.
        A ring cannot pass through other rings during its move.
        If it goes over a group of markers, your move must stop at the first empty space after that group.
        All markers in the group are then flipped and their color change.<br/><br/>
        You're playing Dark, do a move.`,new vte([[Ste,Ste,Ste,Ste,Ste,Ste,bte,bte,bte,bte,Ste],[Ste,Ste,Ste,Ste,bte,bte,bte,bte,bte,bte,bte],[Ste,Ste,Ste,Ite,bte,bte,bte,bte,bte,bte,bte],[Ste,Ste,Ite,bte,bte,Ite,bte,bte,bte,bte,bte],[Ste,bte,Ote,Tte,bte,bte,Ite,bte,bte,bte,bte],[Ste,bte,bte,Tte,bte,bte,bte,bte,bte,bte,Ste],[bte,bte,bte,bte,Ote,bte,bte,Ite,bte,bte,Ste],[bte,bte,bte,bte,bte,Ote,bte,bte,bte,Ste,Ste],[bte,bte,bte,Ote,bte,bte,bte,Ste,Ste,Ste,Ste],[bte,bte,bte,bte,bte,bte,bte,Ste,Ste,Ste,Ste],[Ste,bte,bte,bte,bte,Ste,Ste,Ste,Ste,Ste,Ste]],[0,0],20),new Cte([],new JX(2,4),Mw.of(new JX(4,4)),[]),$localize`Congratulations!`),kJ.fromPredicate($localize`Getting a ring by aligning 5 markers`,$localize`Finally, the last mechanic you need is to be able to get a ring from the board in order to gain points.
        To do so, you need to align 5 markers of your color.
        You can then get these markers by clicking on them, and then get one of your ring by clicking on it.
        You will then have one more point.
        You must capture when you can.<br/><br/>
        You're playing Dark, perform a capture!`,new vte([[Ste,Ste,Ste,Ste,Ste,Ste,bte,bte,bte,bte,Ste],[Ste,Ste,Ste,Ste,bte,bte,bte,bte,bte,bte,bte],[Ste,Ste,Ste,Ite,bte,bte,bte,bte,bte,bte,bte],[Ste,Ste,Ite,bte,bte,Ite,bte,bte,bte,bte,bte],[Ste,bte,Pte,Pte,Ote,Tte,Tte,bte,bte,bte,bte],[Ste,bte,bte,Ite,bte,bte,bte,bte,bte,bte,Ste],[bte,bte,bte,bte,Ote,bte,bte,Ite,bte,bte,Ste],[bte,bte,bte,bte,bte,Ote,bte,bte,bte,Ste,Ste],[bte,bte,bte,Ote,bte,bte,bte,Ote,Ste,Ste,Ste],[bte,bte,bte,bte,bte,bte,bte,Ste,Ste,Ste,Ste],[Ste,bte,bte,bte,bte,Ste,Ste,Ste,Ste,Ste,Ste]],[0,0],20),new Cte([],new JX(4,4),Mw.of(new JX(7,4)),[_te.of(new JX(2,4),new JX(6,4),new JX(7,4))]),(e,t)=>1===t.sideRings[BK.ZERO.value]?TW.SUCCESS:TW.failure(kte.MUST_ALIGN_FIVE()),$localize`Congratulations!`),kJ.fromPredicate($localize`Compound captures`,$localize`During a turn, you could have to choose between multiple captures,
        or you could even capture multiple times!
        During the capture selection, if you see that the marker you clicked belongs to two captures, you have to click on a second marker to avoid any ambiguity.<br/><br/>
        Here, you can capture two rings, do it!`,new vte([[Ste,Ste,Ste,Ste,Ste,Ste,bte,bte,bte,bte,Ste],[Ste,Ste,Ste,Ste,Ote,bte,bte,Ite,Ite,Ote,bte],[Ste,Ste,Ste,Ote,bte,bte,Tte,Ite,bte,Ote,bte],[Ste,Ste,bte,Ote,bte,bte,bte,bte,bte,Ite,bte],[Ste,bte,bte,bte,bte,Pte,bte,bte,Ite,bte,bte],[Ste,bte,bte,bte,Pte,Pte,bte,Tte,bte,bte,Ste],[bte,bte,bte,Pte,bte,Pte,bte,bte,bte,bte,Ste],[bte,bte,Pte,bte,bte,Pte,bte,bte,bte,Ste,Ste],[bte,Pte,bte,bte,bte,Pte,bte,bte,Ste,Ste,Ste],[bte,bte,bte,bte,bte,Pte,bte,Ste,Ste,Ste,Ste],[Ste,bte,bte,bte,bte,Ste,Ste,Ste,Ste,Ste,Ste]],[0,0],10),new Cte([_te.of(new JX(5,4),new JX(1,8),new JX(3,2)),_te.of(new JX(5,9),new JX(5,5),new JX(3,3))],new JX(4,1),Mw.of(new JX(4,2)),[]),(e,t)=>2===t.sideRings[BK.ZERO.value]?TW.SUCCESS:TW.failure(kte.MUST_CAPTURE_TWO()),$localize`Congratulations!`)]}}function Mte(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=Sa(2).$implicit,t=Sa(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringOuterSize)}}function Nte(e,t){if(1&e&&(Cn(),ga(0,"circle",10)),2&e){const e=Sa(2),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ia("id","ring_",t,"_",r,""),ha("ngClass",n.ringClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.ringMidSize)}}function Rte(e,t){if(1&e&&(Cn(),ga(0,"circle",9)),2&e){const e=Sa(2).$implicit,t=Sa(2);ra("cx",e.center.x)("cy",e.center.y)("r",t.viewInfo.ringInnerSize)}}function xte(e,t){if(1&e&&(Cn(),ga(0,"circle",11)),2&e){const e=Sa(2),t=e.index,n=e.$implicit,r=Sa().index,i=Sa();Ia("id","marker_",t,"_",r,""),ha("ngClass",n.markerClasses),ra("cx",n.center.x)("cy",n.center.y)("r",i.viewInfo.markerSize)}}function Dte(e,t){if(1&e){const e=va();Cn(),pa(0,"g",3),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa(2).onClick(t.coord)}),ga(1,"polyline",4),pa(2,"g",5),la(3,Mte,1,3,"circle",6),la(4,Nte,1,6,"circle",7),la(5,Rte,1,3,"circle",6),la(6,xte,1,6,"circle",8),fa(),fa()}if(2&e){const e=Sa(),t=e.index,n=e.$implicit,r=Sa().index;Ia("id","click_",t,"_",r,""),Ts(1),Ia("id","space_",t,"_",r,""),ha("ngClass",n.spaceClasses),ra("points",n.coordinates),Ts(1),Ia("id","pieceGroup_",t,"_",r,""),ha("ngClass",n.removedClass),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isRing),Ts(1),ha("ngIf",n.isMarker)}}function Lte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Dte,7,13,"g",2),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",null!=e)}}function Fte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Lte,2,1,"g",1),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}function Ute(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"polyline",12),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),Ia("id","selected_",e.x,"_",e.y,""),ra("points",n.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function Bte(e,t){if(1&e){const e=va();Cn(),pa(0,"polyline",14),Ea("click",function(){Gt(e);const t=Sa().$implicit;return Sa().onClick(t)}),fa()}if(2&e){const e=Sa().$implicit,t=Sa();Ia("id","selectable_",e.x,"_",e.y,""),ra("points",t.viewInfo.spaceInfo[e.y][e.x].coordinates)}}function Vte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,Bte,1,3,"polyline",13),fa()),2&e){const e=Sa();Ts(1),ha("ngIf",e.isPlayerTurn())}}function $te(e,t){if(1&e){const e=va();Cn(),pa(0,"g"),pa(1,"rect",15),Ea("click",function(){const t=Gt(e).$implicit;return Sa().onClick(t)}),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa();Ts(1),ra("x",n.viewInfo.spaceInfo[e.y][e.x].center.x-n.viewInfo.indicatorSize/2)("y",n.viewInfo.spaceInfo[e.y][e.x].center.y-n.viewInfo.indicatorSize/2)("width",n.viewInfo.indicatorSize)("height",n.viewInfo.indicatorSize)}}function zte(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",16),ga(2,"circle",9),ga(3,"circle",17),fa()),2&e){const e=t.index,n=Sa().$implicit,r=Sa();Ts(1),Ia("id","player_",n,"_sideRing_",e+1,""),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringOuterSize),Ts(1),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringInnerSize),Ts(1),ha("ngClass",r.viewInfo.sideRingClass[n]),ra("cx",(0===n?0:1050)+1.2*(0===n?1:-1)*r.viewInfo.ringOuterSize*(e+1))("cy",0===n?300:1260)("r",r.viewInfo.ringMidSize)}}const Hte=function(){return[]};function Gte(e,t){if(1&e&&(Cn(),pa(0,"g"),la(1,zte,4,12,"g",1),fa()),2&e){const e=t.$implicit,n=Sa();Ts(1),ha("ngForOf",wu(1,Hte).constructor(n.viewInfo.sideRings[e]))}}const Wte=function(){return[0,1]};class qte extends tJ{constructor(e){super(e),this.movePhase="MOVE_START",this.moveStart=Mw.empty(),this.moveEnd=Mw.empty(),this.currentlyMoved=[],this.currentCapture=Mw.empty(),this.initialCaptures=[],this.finalCaptures=[],this.possibleCaptures=[],this.viewInfo={spaceInfo:[],selectableCoords:[],selectedCoords:[],targets:[],markerSize:qte.MARKER_SIZE,ringOuterSize:qte.RING_OUTER_SIZE,ringMidSize:qte.RING_MID_SIZE,ringInnerSize:qte.RING_INNER_SIZE,indicatorSize:qte.INDICATOR_SIZE,sideRings:[5,5],sideRingClass:["player0-stroke","player1-stroke"]},this.scores=Mw.of([0,0]),this.rules=new wte(vte),this.availableMinimaxes=[new Ete(this.rules,"YinshMinimax")],this.encoder=Cte.encoder,this.tutorial=(new Ate).tutorial,this.hexaLayout=new iJ(1.5*qte.RING_OUTER_SIZE,new JX(2*qte.RING_OUTER_SIZE,0),aJ.INSTANCE),this.constructedState=this.rules.node.gameState,this.constructedState.allCoords().forEach(e=>{null==this.viewInfo.spaceInfo[e.y]&&(this.viewInfo.spaceInfo[e.y]=[]),this.viewInfo.spaceInfo[e.y][e.x]={coord:e,coordinates:this.getHexaCoordsAt(e),center:this.getCenterAt(e),spaceClasses:[],markerClasses:[],ringClasses:[],isMarker:!1,isRing:!1,removedClass:""}})}updateBoard(){this.cancelMoveAttempt(),this.scores=Mw.of(this.rules.node.gameState.countScores())}updateViewInfo(){this.constructedState.allCoords().forEach(e=>{this.viewInfo.spaceInfo[e.y][e.x].spaceClasses=this.getSpaceClasses(e);const t=this.constructedState.getPieceAt(e);this.viewInfo.spaceInfo[e.y][e.x].removedClass="",this.setRingInfo(e,t),this.setMarkerInfo(e,t)});for(const e of BK.PLAYERS)this.viewInfo.sideRings[e.value]=this.constructedState.sideRings[e.value];switch(this.showCurrentMoveCaptures(),this.showLastMove(),this.viewInfo.targets=[],this.viewInfo.selectableCoords=[],this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.viewInfo.selectableCoords=[];for(const e of this.possibleCaptures)for(const t of e.capturedSpaces)this.viewInfo.selectableCoords.push(t);break;case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer());break;case"MOVE_START":!1===this.rules.node.gameState.isInitialPlacementPhase()&&(this.viewInfo.selectableCoords=this.constructedState.getRingCoords(this.constructedState.getCurrentPlayer()));break;case"MOVE_END":this.viewInfo.targets=this.rules.getRingTargets(this.constructedState,this.moveStart.get())}}showCurrentMoveCaptures(){this.currentCapture.isPresent()&&this.markCurrentCapture(this.currentCapture.get());for(const e of this.initialCaptures)this.markCurrentCapture(e);for(const e of this.finalCaptures)this.markCurrentCapture(e)}getSpaceClasses(e){return this.currentlyMoved.some(t=>t.equals(e))?["moved"]:[]}setRingInfo(e,t){if(t.isRing){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isRing=!0,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[n+"-stroke"]}else this.viewInfo.spaceInfo[e.y][e.x].isRing=!1,this.viewInfo.spaceInfo[e.y][e.x].ringClasses=[]}setMarkerInfo(e,t){if(this.viewInfo.spaceInfo[e.y][e.x].isMarker=!1,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[],t!==yte.EMPTY&&(!t.isRing||t.isRing&&this.moveStart.equalsValue(e))){const n=this.getPlayerClass(t.player);this.viewInfo.spaceInfo[e.y][e.x].isMarker=!0,this.viewInfo.spaceInfo[e.y][e.x].markerClasses=[n]}}cancelMoveAttempt(){this.constructedState=this.rules.node.gameState,this.possibleCaptures=[],this.initialCaptures=[],this.finalCaptures=[],this.viewInfo.selectedCoords=[],this.currentCapture=Mw.empty(),this.moveStart=Mw.empty(),this.moveEnd=Mw.empty(),this.currentlyMoved=[],this.moveToInitialCaptureOrMovePhase()}showLastMove(){const e=this.rules.node.move;if(e.isPresent()){const t=e.get();if(t.isInitialPlacement())this.viewInfo.spaceInfo[t.start.y][t.start.x].spaceClasses=["moved"];else{for(const n of this.coordsBetween(t.start,t.end.get()))this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["moved"];const e=this.currentCapture.isAbsent()&&0===this.initialCaptures.length&&this.moveStart.isAbsent();t.initialCaptures.forEach(t=>this.showLastMoveCapture(t,e)),t.finalCaptures.forEach(t=>this.showLastMoveCapture(t,e))}}}coordsBetween(e,t){const n=[],r=rJ.factory.fromMove(e,t).get();for(let i=e;!i.equals(t);i=i.getNext(r))this.constructedState.getPieceAt(i)!==yte.EMPTY&&n.push(i),n.push(t);return n}showLastMoveCapture(e,t){for(const n of e.capturedSpaces)this.viewInfo.spaceInfo[n.y][n.x].spaceClasses=["captured"],t&&this.markRemovedMarker(n,this.rules.node.gameState.getCurrentPlayer().getOpponent());this.viewInfo.spaceInfo[e.ringTaken.get().y][e.ringTaken.get().x].spaceClasses=["captured"],t&&this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer().getOpponent())}moveToInitialCaptureOrMovePhase(){return this.possibleCaptures=this.rules.getPossibleCaptures(this.constructedState),this.movePhase=0===this.possibleCaptures.length?"MOVE_START":"INITIAL_CAPTURE_SELECT_FIRST",this.updateViewInfo(),TW.SUCCESS}onClick(e){var t=this;return Pw(function*(){const n=t.canUserPlay("#click_"+e.x+"_"+e.y);if(n.isFailure())return t.cancelMove(n.getReason());switch(t.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_FIRST":return t.selectCaptureFirstCoord(e);case"INITIAL_CAPTURE_SELECT_LAST":case"FINAL_CAPTURE_SELECT_LAST":return t.selectCaptureLastCoord(e);case"INITIAL_CAPTURE_SELECT_RING":case"FINAL_CAPTURE_SELECT_RING":return t.selectRing(e);case"MOVE_START":return t.selectMoveStart(e);case"MOVE_END":return t.selectMoveEnd(e)}})()}selectCaptureFirstCoord(e){var t=this;return Pw(function*(){const n=[];if(t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1)t.viewInfo.selectedCoords.push(e),t.moveToCaptureSelectLast(n);else{if(0===n.length)return t.cancelMove(mte.MISSING_CAPTURES());t.selectCapture(n[0])}return TW.SUCCESS})()}moveToCaptureSelectLast(e){this.viewInfo.selectableCoords=[],this.possibleCaptures=e;for(const t of e)for(const e of t.capturedSpaces)this.viewInfo.selectableCoords.push(e);switch(this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":this.movePhase="INITIAL_CAPTURE_SELECT_LAST";break;case"FINAL_CAPTURE_SELECT_FIRST":this.movePhase="FINAL_CAPTURE_SELECT_LAST"}}selectCaptureLastCoord(e){var t=this;return Pw(function*(){const n=[];return t.possibleCaptures.forEach(t=>{t.contains(e)&&n.push(t)}),n.length>1?t.cancelMove(mte.AMBIGUOUS_CAPTURE_COORD()):0===n.length?t.cancelMove(mte.MISSING_CAPTURES()):t.selectCapture(n[0])})()}selectCapture(e){switch(this.currentCapture=Mw.of(e),this.constructedState=new vte(this.rules.applyCaptureWithoutTakingRing(this.constructedState,e),this.constructedState.sideRings,this.constructedState.turn),this.movePhase){case"INITIAL_CAPTURE_SELECT_FIRST":case"INITIAL_CAPTURE_SELECT_LAST":this.movePhase="INITIAL_CAPTURE_SELECT_RING";break;case"FINAL_CAPTURE_SELECT_FIRST":case"FINAL_CAPTURE_SELECT_LAST":this.movePhase="FINAL_CAPTURE_SELECT_RING"}return this.updateViewInfo(),TW.SUCCESS}markCurrentCapture(e){for(const t of e.capturedSpaces)this.viewInfo.selectedCoords.push(t),this.markRemovedMarker(t,this.rules.node.gameState.getCurrentPlayer());e.ringTaken.isPresent()&&(this.viewInfo.selectedCoords.push(e.ringTaken.get()),this.markRemovedRing(e.ringTaken.get(),this.rules.node.gameState.getCurrentPlayer()))}markRemovedMarker(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setMarkerInfo(e,yte.MARKERS[t.value])}markRemovedRing(e,t){this.viewInfo.spaceInfo[e.y][e.x].removedClass="semi-transparent",this.setRingInfo(e,yte.RINGS[t.value])}selectRing(e){var t=this;return Pw(function*(){const n=t.rules.ringSelectionValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.constructedState=t.rules.takeRing(t.constructedState,e);const r=t.currentCapture.get().setRingTaken(e);switch(t.currentCapture=Mw.empty(),t.possibleCaptures=t.rules.getPossibleCaptures(t.constructedState),t.movePhase){case"INITIAL_CAPTURE_SELECT_RING":return t.initialCaptures.push(r),0===t.possibleCaptures.length?t.moveToMovePhase():(t.movePhase="INITIAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),TW.SUCCESS);default:return Ow.expectToBe(t.movePhase,"FINAL_CAPTURE_SELECT_RING"),t.finalCaptures.push(r),0===t.possibleCaptures.length?t.tryMove():(t.movePhase="FINAL_CAPTURE_SELECT_FIRST",t.updateViewInfo(),TW.SUCCESS)}})()}moveToMovePhase(){return this.movePhase="MOVE_START",this.updateViewInfo(),TW.SUCCESS}tryMove(){var e=this;return Pw(function*(){const t=new Cte(e.initialCaptures,e.moveStart.get(),e.moveEnd,e.finalCaptures);return yield e.chooseMove(t,e.rules.node.gameState,e.scores.get())})()}selectMoveStart(e){var t=this;return Pw(function*(){if(t.constructedState.isInitialPlacementPhase()){const n=t.rules.initialPlacementValidity(t.constructedState,e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveStart=Mw.of(e),t.tryMove())}{const n=t.rules.moveStartValidity(t.constructedState,e);if(n.isFailure())return t.cancelMove(n.getReason());t.moveStart=Mw.of(e),t.movePhase="MOVE_END",t.updateViewInfo()}return TW.SUCCESS})()}selectMoveEnd(e){var t=this;return Pw(function*(){const n=t.rules.moveValidity(t.constructedState,t.moveStart.get(),e);return n.isFailure()?t.cancelMove(n.getReason()):(t.moveEnd=Mw.of(e),t.currentlyMoved=t.coordsBetween(t.moveStart.get(),e),t.constructedState=t.rules.applyRingMoveAndFlip(t.constructedState,t.moveStart.get(),e),t.updateViewInfo(),t.moveToFinalCapturePhaseOrTryMove())})()}moveToFinalCapturePhaseOrTryMove(){var e=this;return Pw(function*(){return e.possibleCaptures=e.rules.getPossibleCaptures(e.constructedState),0===e.possibleCaptures.length?e.tryMove():(e.movePhase="FINAL_CAPTURE_SELECT_FIRST",e.updateViewInfo(),TW.SUCCESS)})()}}function jte(e,t){if(1&e&&(pa(0,"option",5),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.urlName),Ts(1),Xa(e.name)}}qte.RING_OUTER_SIZE=40,qte.RING_MID_SIZE=34,qte.RING_INNER_SIZE=28,qte.MARKER_SIZE=qte.RING_INNER_SIZE,qte.INDICATOR_SIZE=10,qte.\u0275fac=function(e){return new(e||qte)(ua(AW))},qte.\u0275cmp=Je({type:qte,selectors:[["app-yinsh"]],features:[Go],decls:6,vars:6,consts:[["xmlns","http://www.w3.org/2000/svg","width","100%","height","auto","viewBox","0 250 1065 1060","preserveAspectRatio","xMidYMid meet"],[4,"ngFor","ngForOf"],[3,"id","click",4,"ngIf"],[3,"id","click"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[3,"id","ngClass"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base no-fill",3,"id","ngClass",4,"ngIf"],["class","base mid-stroke",3,"id","ngClass",4,"ngIf"],[1,"base","no-fill","mid-stroke"],[1,"base","no-fill",3,"id","ngClass"],[1,"base","mid-stroke",3,"id","ngClass"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","selected",3,"id","click"],["pointer-events","fill","class","base no-fill capturable","stroke-linecap","round",3,"id","click",4,"ngIf"],["pointer-events","fill","stroke-linecap","round",1,"base","no-fill","capturable",3,"id","click"],[1,"indicator",3,"click"],[1,"base","no-fill","mid-stroke",3,"id"],[1,"base","no-fill",3,"ngClass"]],template:function(e,t){1&e&&(Cn(),pa(0,"svg",0),la(1,Fte,2,1,"g",1),la(2,Ute,2,3,"g",1),la(3,Vte,2,1,"g",1),la(4,$te,2,4,"g",1),la(5,Gte,2,2,"g",1),fa()),2&e&&(Ts(1),ha("ngForOf",t.viewInfo.spaceInfo),Ts(1),ha("ngForOf",t.viewInfo.selectedCoords),Ts(1),ha("ngForOf",t.viewInfo.selectableCoords),Ts(1),ha("ngForOf",t.viewInfo.targets),Ts(1),ha("ngForOf",wu(5,Wte)))},directives:[tp,rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});let Zte=(()=>{class e{}return e.ABALONE=()=>$localize`Use simple mechanics to push 6 of the opponent's pieces out of the board!`,e.APAGOS=()=>$localize`Very simple game, but, will you be able to win everytime?`,e.AWALE=()=>$localize`The international version of the famous African strategy game!`,e.BRANDHUB=()=>$localize`The Irish version of the Tafl game family!`,e.COERCEO=()=>$localize`Get rid of all of your opponent's pieces on a board that shrinks little by little!`,e.CONSPIRATEURS=()=>$localize`Hide all of your pieces before your opponent does, or risk to be discovered!`,e.DIAM=()=>$localize`Drop your pieces and move them around to align two pieces of the same color across the board to win!`,e.DVONN=()=>$localize`Stack your pieces and control as many stacks as you can to win!`,e.ENCAPSULE=()=>$localize`An enhanced tic-tac-toe where piece can encapsule other and prevent them to win.`,e.EPAMINONDAS=()=>$localize`An antiquity-war inspired game. Be the first to pierce your opponent's lines!`,e.GIPF=()=>$localize`A hexagonal game of alignment. Insert your pieces on the board to capture your opponent's pieces!`,e.GO=()=>$localize`The oldest strategy game still practiced widely. A territory control game.`,e.KAMISADO=()=>$localize`Your goal is simple: reach the last line. But the piece you move depends on your opponent's last move!`,e.LINES_OF_ACTION=()=>$localize`Regroup your pieces to win. But your possible moves will often change!`,e.LODESTONE=()=>$localize`Push and crush your opponent's pieces using magnetic forces!`,e.MARTIAN_CHESS=()=>$localize`Win points by capturing pieces, but you only control pieces on your side of the board!`,e.P4=()=>$localize`The classical 4 in a row game!`,e.PENTAGO=()=>$localize`Drop a piece, then rotate a quadrant. The first player to align 5 pieces wins!`,e.PYLOS=()=>$localize`Overlay your pieces and use two game mechanics to conserve your pieces. First player to run out of pieces loses!`,e.QUARTO=()=>$localize`Create a winning alignment. The problem: you don't pick the piece that you're placing on the board!`,e.QUIXO=()=>$localize`Align 5 of your pieces on a board where pieces slide!`,e.REVERSI=()=>$localize`Sandwich your opponent's pieces to dominate the board!`,e.SAHARA=()=>$localize`Immobilize one of your opponent's pyramids before your opponent does!`,e.SIAM=()=>$localize`Be the first to push a mountain out of the board!`,e.SIX=()=>$localize`Put your hexagonal pieces next to another one, and create one of the 3 victorious shapes to win!`,e.TABLUT=()=>$localize`The Viking board game! Invaders must capture the king, defender must make him escape!`,e.YINSH=()=>$localize`Align your pieces to score points, but beware, pieces can flip!`,e})(),Yte=(()=>{class e{constructor(e,t,n,r,i,s=!0){this.name=e,this.urlName=t,this.component=n,this.creationDate=r,this.description=i,this.display=s}}return e.ALL_GAMES=()=>[new e("MinimaxTesting","MinimaxTesting",J6,new Date("1970-01-01"),"",!1),new e($localize`Four in a Row`,"P4",f8,new Date("2018-08-28"),Zte.P4()),new e($localize`Awalé`,"Awale",_1,new Date("2018-11-29"),Zte.AWALE()),new e($localize`Quarto`,"Quarto",Z7,new Date("2018-12-09"),Zte.QUARTO()),new e($localize`Tablut`,"Tablut",gte,new Date("2018-12-27"),Zte.TABLUT()),new e($localize`Reversi`,"Reversi",b9,new Date("2019-01-16"),Zte.REVERSI()),new e($localize`Go`,"Go",R4,new Date("2019-12-21"),Zte.GO()),new e($localize`Encapsule`,"Encapsule",_3,new Date("2019-12-30"),Zte.ENCAPSULE()),new e($localize`Siam`,"Siam",Pee,new Date("2020-01-11"),Zte.SIAM()),new e($localize`Sahara`,"Sahara",z9,new Date("2020-02-29"),Zte.SAHARA()),new e($localize`Pylos`,"Pylos",r7,new Date("2020-10-02"),Zte.PYLOS()),new e($localize`Kamisado`,"Kamisado",d5,new Date("2020-10-03"),Zte.KAMISADO()),new e($localize`Quixo`,"Quixo",c9,new Date("2020-10-15"),Zte.QUIXO()),new e($localize`Dvonn`,"Dvonn",Y2,new Date("2020-10-21"),Zte.DVONN()),new e($localize`Epaminondas`,"Epaminondas",D3,new Date("2021-01-16"),Zte.EPAMINONDAS()),new e($localize`Gipf`,"Gipf",s4,new Date("2021-02-22"),Zte.GIPF()),new e($localize`Coerceo`,"Coerceo",M0,new Date("2021-03-21"),Zte.COERCEO()),new e($localize`Six`,"Six",Zee,new Date("2021-04-08"),Zte.SIX()),new e($localize`Lines of Action`,"LinesOfAction",O5,new Date("2021-04-28"),Zte.LINES_OF_ACTION()),new e($localize`Pentago`,"Pentago",x8,new Date("2021-05-23"),Zte.PENTAGO()),new e($localize`Abalone`,"Abalone",ZJ,new Date("2021-07-13"),Zte.ABALONE()),new e($localize`Yinsh`,"Yinsh",qte,new Date("2021-07-31"),Zte.YINSH()),new e($localize`Apagos`,"Apagos",c1,new Date("2021-11-04"),Zte.APAGOS()),new e($localize`Diam`,"Diam",_2,new Date("2021-11-30"),Zte.DIAM()),new e($localize`Brandhub`,"Brandhub",n0,new Date("2021-12-07"),Zte.BRANDHUB()),new e($localize`Conspirateurs`,"Conspirateurs",X0,new Date("2021-12-30"),Zte.CONSPIRATEURS()),new e($localize`Lodestone`,"Lodestone",s6,new Date("2022-06-24"),Zte.LODESTONE()),new e($localize`Martian Chess`,"MartianChess",z6,new Date("2022-07-01"),Zte.MARTIAN_CHESS())].sort((e,t)=>e.name.localeCompare(t.name)),e})(),Kte=(()=>{class e{constructor(){this.games=Yte.ALL_GAMES().filter(e=>!0===e.display),this.pickGame=new xu}onChange(e){this.pickGame.emit(e.target.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Je({type:e,selectors:[["app-pick-game"]],outputs:{pickGame:"pickGame"},decls:5,vars:1,consts:function(){let e;return e=$localize`Pick a game`,[[1,"select","is-primary","is-fullwidth"],["id","gameType",3,"change"],["value","","selected",""],e,[3,"value",4,"ngFor","ngForOf"],[3,"value"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"select",1),Ea("change",function(e){return t.onChange(e)}),pa(2,"option",2),sc(3,3),fa(),la(4,jte,2,2,"option",4),fa(),fa()),2&e&&(Ts(4),ha("ngForOf",t.games))},directives:[Pg,kg,tp],encapsulation:2}),e})();function Qte(e,t){if(1&e){const e=va();pa(0,"div",26),pa(1,"div",27),Ea("click",function(){return Gt(e),Sa().closeInfo()}),fa(),pa(2,"div",28),pa(3,"header",29),pa(4,"p",30),Qa(5),fa(),pa(6,"button",31),Ea("click",function(){return Gt(e),Sa().closeInfo()}),fa(),fa(),pa(7,"section",32),pa(8,"div",6),pa(9,"div",33),pa(10,"p",34),ga(11,"img",35),fa(),fa(),pa(12,"div",7),pa(13,"div",13),Qa(14),fa(),fa(),fa(),pa(15,"div",6),pa(16,"div",33),pa(17,"a",36),Ea("click",function(){Gt(e);const t=Sa();return t.createGame(t.gameInfoDetails.get().urlName)}),ga(18,"fa-icon",37),Qa(19,"\xa0"),pa(20,"span"),sc(21,38),fa(),fa(),fa(),pa(22,"div",33),pa(23,"a",36),Ea("click",function(){Gt(e);const t=Sa();return t.createLocalGame(t.gameInfoDetails.get().urlName)}),ga(24,"fa-icon",37),Qa(25,"\xa0"),pa(26,"span"),sc(27,39),fa(),fa(),fa(),pa(28,"div",33),pa(29,"a",36),Ea("click",function(){Gt(e);const t=Sa();return t.createTutorial(t.gameInfoDetails.get().urlName)}),ga(30,"fa-icon",37),Qa(31,"\xa0"),pa(32,"span"),sc(33,40),fa(),fa(),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=Sa();Ts(5),Xa(e.gameInfoDetails.get().name),Ts(6),Ia("src","assets/images/",e.theme,"/",e.gameInfoDetails.get().urlName,".png",_i),Ts(3),Ja(" ",e.gameInfoDetails.get().description," "),Ts(4),ha("icon",e.iconOnlineGame),Ts(6),ha("icon",e.iconLocalGame),Ts(6),ha("icon",e.iconTutorial)}}function Xte(e,t){if(1&e){const e=va();pa(0,"div",8),pa(1,"div",9),pa(2,"p",10),Qa(3),fa(),fa(),pa(4,"div",42),pa(5,"figure",34),pa(6,"img",43),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).openInfo(t)}),fa(),pa(7,"figcaption",44),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).openInfo(t)}),pa(8,"div",45),Qa(9,"?"),fa(),fa(),pa(10,"figcaption",46),pa(11,"a",47),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).createGame(t.urlName)}),ga(12,"fa-icon",37),fa(),pa(13,"a",48),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).createLocalGame(t.urlName)}),ga(14,"fa-icon",37),fa(),pa(15,"a",49),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).createTutorial(t.urlName)}),ga(16,"fa-icon",37),fa(),fa(),fa(),fa(),pa(17,"div",50),Qa(18),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa(2);Ts(3),Xa(e.name),Ts(3),Ta("id","image_",e.urlName,""),Ia("src","assets/images/",n.theme,"/",e.urlName,".png",_i),Ts(5),Ta("id","playOnline_",e.urlName,""),Ts(1),ha("icon",n.iconOnlineGame),Ts(1),Ta("id","playLocally_",e.urlName,""),Ts(1),ha("icon",n.iconLocalGame),Ts(1),Ta("id","startTutorial_",e.urlName,""),Ts(1),ha("icon",n.iconTutorial),Ts(2),Ja(" ",e.description," ")}}function Jte(e,t){if(1&e&&(pa(0,"div",7),la(1,Xte,19,11,"div",41),fa()),2&e){const e=t.$implicit;Ts(1),ha("ngForOf",e)}}let ene=(()=>{class e{constructor(e,t){this.router=e,this.numberOfColumns=4,this.games=[],this.iconOnlineGame=iQ,this.iconLocalGame=nQ,this.iconTutorial=eQ,this.gameInfoDetails=Mw.empty(),this.theme=t.getTheme();const n=Yte.ALL_GAMES().filter(e=>!0===e.display);let r=0;for(let i=0;i<n.length;i++)i<this.numberOfColumns&&this.games.push([]),this.games[r].push(n[i]),r=(r+1)%this.numberOfColumns}createGame(e){var t=this;return Pw(function*(){return t.router.navigate(["/play",e])})()}createLocalGame(e){var t=this;return Pw(function*(){return t.router.navigate(["/local",e])})()}createTutorial(e){return this.router.navigate(["/tutorial",e])}openInfo(e){this.gameInfoDetails=Mw.of(e)}closeInfo(){this.gameInfoDetails=Mw.empty()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(JK))},e.\u0275cmp=Je({type:e,selectors:[["app-welcome"]],decls:33,vars:2,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`EveryBoard`,t=$localize`EveryBoard is a website to play and learn the rules of various abstract strategy games with perfect information.${"\ufffd#6\ufffd\ufffd/#6\ufffd"}:LINE_BREAK: Such games are games that do not include any randomness, agility, or hidden information. These games are played by two players, turn by turn.`,n=$localize`Play online`,r=$localize`Create an online game`,i=$localize`See the game list`,s=$localize`Play offline`,o=$localize`Play`,a=$localize`Learn`,l=$localize`Play online`,c=$localize`Play offline`,u=$localize`Learn the rules`,h=$localize`Play online`,d=$localize`Play offline`,p=$localize`Learn the rules`,[[1,"hero"],[1,"hero-body"],[1,"title"],e,[1,"subtitle"],t,[1,"columns"],[1,"column"],[1,"card"],[1,"card-header"],[1,"card-header-title"],n,[1,"card-content"],[1,"content"],["id","createOnlineGame","routerLink","/play",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],r,["id","seeGameList","routerLink","/lobby",1,"button","is-medium","is-fullwidth","is-primary"],i,s,[1,"content","has-text-centered"],["routerLink","/local",1,"button","is-medium","is-fullwidth","is-primary","mb-1"],o,["routerLink","/tutorial",1,"button","is-medium","is-fullwidth","is-primary"],a,["id","gameInfoModal","class","modal is-active",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],["id","gameInfoModal",1,"modal","is-active"],["id","modalBackground",1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-head","is-primary"],[1,"modal-card-title"],["id","closeInfo","aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"column","is-one-third"],[1,"image"],[3,"src"],[1,"button","is-fullwidth",3,"click"],[3,"icon"],l,c,u,["class","card",4,"ngFor","ngForOf"],[1,"card-image","game-card"],[1,"is-clickable",3,"id","src","click"],[1,"has-text-centered","is-overlay","game-image-text","is-clickable",3,"click"],[1,"is-size-1","has-text-weight-bold"],[1,"has-text-centered","is-overlay","game-image-buttons"],["data-tooltip",h,1,"button",3,"id","click"],["data-tooltip",d,1,"button",3,"id","click"],["data-tooltip",p,1,"button",3,"id","click"],[1,"card-content","is-hidden"]]},template:function(e,t){1&e&&(pa(0,"section",0),pa(1,"div",1),pa(2,"p",2),sc(3,3),fa(),pa(4,"p",4),rc(5,5),ga(6,"br"),ic(),fa(),fa(),pa(7,"div",6),pa(8,"div",7),pa(9,"div",8),pa(10,"header",9),pa(11,"p",10),sc(12,11),fa(),fa(),pa(13,"div",12),pa(14,"div",13),pa(15,"button",14),sc(16,15),fa(),pa(17,"button",16),sc(18,17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",7),pa(20,"div",8),pa(21,"header",9),pa(22,"p",10),sc(23,18),fa(),fa(),pa(24,"div",12),pa(25,"div",19),pa(26,"button",20),sc(27,21),fa(),pa(28,"button",22),sc(29,23),fa(),fa(),fa(),fa(),fa(),fa(),la(30,Qte,34,7,"div",24),pa(31,"div",6),la(32,Jte,2,1,"div",25),fa(),fa()),2&e&&(Ts(30),ha("ngIf",t.gameInfoDetails.isPresent()),Ts(2),ha("ngForOf",t.games))},directives:[m_,rp,tp,MX],encapsulation:2}),e})(),tne=(()=>{class e{constructor(e){this.element=e}ngAfterViewInit(){this.element.nativeElement.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(bc))},e.\u0275dir=st({type:e,selectors:[["","autofocus",""]]}),e})(),nne=(()=>{class e{constructor(e){this.shown=!1,this.input=e.nativeElement.parentNode.previousSibling,e.nativeElement.addEventListener("click",e=>{this.toggle()})}toggle(){this.shown=!this.shown,this.input.setAttribute("type",this.shown?"text":"password"),this.input.focus()}}return e.\u0275fac=function(t){return new(t||e)(ua(bc))},e.\u0275dir=st({type:e,selectors:[["","toggleVisibility",""]]}),e})();function rne(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),sc(2,31),fa(),pa(3,"div",32),Qa(4),fa(),fa()),2&e){const e=Sa();Ts(4),Xa(e.errorMessage)}}const ine=function(){return["/register"]},sne=function(){return["/reset-password"]};let one=(()=>{class e{constructor(e,t){this.router=e,this.connectedUserService=t,this.faEye=rQ,this.loginForm=new sg({email:new ig,password:new ig})}ngOnInit(){var e=this;this.connectedUserService.getUserObs().subscribe(function(){var t=Pw(function*(t){t!==AK.NOT_CONNECTED&&(yield e.redirect())});return function(e){return t.apply(this,arguments)}}())}loginWithEmail(e){var t=this;return Pw(function*(){const n=yield t.connectedUserService.doEmailLogin(e.email,e.password);n.isFailure()&&(t.errorMessage=n.getReason())})()}loginWithGoogle(){var e=this;return Pw(function*(){const t=yield e.connectedUserService.doGoogleLogin();t.isFailure()&&(e.errorMessage=t.getReason())})()}redirect(){var e=this;return Pw(function*(){return e.router.navigate(["/lobby"])})()}canLogin(){return!(""===(this.loginForm.value.email??"")||""===(this.loginForm.value.password??""))}}return e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(MK))},e.\u0275cmp=Je({type:e,selectors:[["app-login"]],decls:49,vars:8,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h;return e=$localize`Log in`,t=$localize`Email`,n=$localize`Email`,r=$localize`Password`,i=$localize`Password`,s=$localize`Log in`,o=$localize`Log in with Google`,a=$localize`No account?`,l=$localize`Register`,c=$localize`Forgot your password?`,u=$localize`Reset your password`,h=$localize`Connection error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","type","text","placeholder",n,"formControlName","email","name","email","type","email","autofocus","","required","",1,"input"],["for","password",1,"label"],r,[1,"control","has-icons-right","is-expanded"],["id","password","type","password","placeholder",i,"formControlName","password","name","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","loginButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],s,["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],o,["class","message is-danger","role","alert",4,"ngIf"],[1,"help","level-right"],a,[3,"routerLink"],l,c,u,["role","alert",1,"message","is-danger"],[1,"message-header"],h,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),sc(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),fa(),fa(),fa(),fa(),pa(12,"div",4),pa(13,"div",5),pa(14,"label",12),sc(15,13),fa(),fa(),pa(16,"div",8),pa(17,"div",9),pa(18,"div",14),ga(19,"input",15),pa(20,"span",16),ga(21,"fa-icon",17),fa(),fa(),fa(),fa(),fa(),pa(22,"div",4),ga(23,"div",5),pa(24,"div",8),pa(25,"div",9),pa(26,"div",10),pa(27,"button",18),Ea("click",function(){return t.loginWithEmail(t.loginForm.value)}),sc(28,19),fa(),fa(),fa(),fa(),fa(),pa(29,"div",4),ga(30,"div",5),pa(31,"div",8),pa(32,"div",9),pa(33,"div",10),pa(34,"button",20),Ea("click",function(){return t.loginWithGoogle()}),sc(35,21),fa(),fa(),fa(),fa(),fa(),la(36,rne,5,1,"div",22),pa(37,"p",23),ma(38),sc(39,24),ya(),Qa(40,"\xa0 "),pa(41,"a",25),sc(42,26),fa(),fa(),pa(43,"p",23),ma(44),sc(45,27),ya(),Qa(46,"\xa0 "),pa(47,"a",25),sc(48,28),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.loginForm),Ts(18),ha("icon",t.faEye),Ts(6),ha("disabled",!t.canLogin()),Ts(9),ha("ngIf",t.errorMessage),Ts(5),ha("routerLink",wu(6,ine)),Ts(6),ha("routerLink",wu(7,sne)))},directives:[pg,Df,_g,rf,xf,Eg,tne,Mg,MX,nne,rp,y_],encapsulation:2}),e})(),ane=(()=>{class e{constructor(e){this.partDAO=e,this.unsubscribe=Mw.empty(),this.activePartsBS=new Em([]),this.activePartsObs=this.activePartsBS.asObservable()}getActivePartsObs(){return this.activePartsObs}startObserving(){NW(this.unsubscribe.isAbsent(),"ActivePartsService: already observing");const e=new BW(e=>{const t=this.activePartsBS.value.concat(...e);this.activePartsBS.next(t)},e=>{const t=this.activePartsBS.value;for(const n of e)t.forEach(e=>{e.id===n.id&&(e.data=n.data)});this.activePartsBS.next(t)},e=>{const t=[];for(const n of this.activePartsBS.value)e.some(e=>e.id===n.id)||t.push(n);this.activePartsBS.next(t)});this.unsubscribe=Mw.of(this.partDAO.observeActiveParts(e))}stopObserving(){NW(this.unsubscribe.isPresent(),"Cannot stop observing active parts when you have not started observing"),this.activePartsBS.next([]),this.unsubscribe.get()(),this.unsubscribe=Mw.empty()}}return e.\u0275fac=function(t){return new(t||e)(Or(DW))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"any"}),e})(),lne=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}navigateToOnlineGameCreation(){var e=this;return Pw(function*(){yield e.router.navigate(["/play",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Je({type:e,selectors:[["app-online-game-selection"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Create an online game`,[[3,"pickGame"],["id","playOnline",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.navigateToOnlineGameCreation()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[Kte],encapsulation:2}),e})(),cne=(()=>{class e{transform(e){return xd(1e3*e.seconds,"HH:mm:ss","en-US")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"firebaseDate",type:e,pure:!0}),e})();const une=["chatDiv"];function hne(e,t){1&e&&(ma(0),sc(1,5),ya())}function dne(e,t){1&e&&sc(0,6),2&e&&(oc(Sa().unreadMessagesText),ac(0))}function pne(e,t){if(1&e){const e=va();pa(0,"button",11),Ea("click",function(){return Gt(e),Sa(2).scrollToBottom()}),Qa(1),fa()}if(2&e){const e=Sa(2);Ts(1),Ja("",e.unreadMessagesText," \u2193")}}function fne(e,t){if(1&e&&(pa(0,"p"),Qa(1),ku(2,"firebaseDate"),pa(3,"b",12),Qa(4),fa(),pa(5,"span",13),Qa(6),fa(),fa()),2&e){const e=t.$implicit;Ts(1),Ja(" [",Au(2,3,e.postedTime),"] "),Ts(3),Ja("",e.sender.name," : "),Ts(2),Xa(e.content)}}function gne(e,t){if(1&e){const e=va();pa(0,"div"),la(1,pne,2,1,"button",7),pa(2,"div",8,9),Ea("scroll",function(){return Gt(e),Sa().updateCurrentScrollPosition()}),la(4,fne,7,5,"p",10),fa(),fa()}if(2&e){const e=Sa();Ts(1),ha("ngIf",e.showUnreadMessagesButton),Ts(3),ha("ngForOf",e.chat)}}const mne=function(){return{standalone:!0}};function yne(e,t){if(1&e){const e=va();pa(0,"form",14),Ea("onSubmit",function(){return Gt(e),Sa().sendMessage()}),pa(1,"div",15),pa(2,"div",16),pa(3,"input",17,18),Ea("ngModelChange",function(t){return Gt(e),Sa().userMessage=t}),fa(),pa(5,"p",19),Qa(6),fa(),fa(),pa(7,"div",20),pa(8,"button",21),Ea("click",function(){return Gt(e),Sa().sendMessage()}),ga(9,"fa-icon",22),fa(),fa(),fa(),pa(10,"div",23),pa(11,"p"),pa(12,"strong"),sc(13,24),fa(),fa(),fa(),fa()}if(2&e){const e=ca(4),t=Sa();Ts(3),ha("ngModel",t.userMessage)("ngModelOptions",wu(4,mne)),Ts(3),Ja("",e.value.length,"/128"),Ts(3),ha("icon",t.faReply)}}let vne=(()=>{class e{constructor(t,n){this.chatService=t,this.connectedUserService=n,this.userMessage="",this.connected=!1,this.chat=[],this.readMessages=0,this.unreadMessagesText="",this.showUnreadMessagesButton=!1,this.visible=!0,this.faReply=sQ,this.isNearBottom=!0,this.notYetScrolled=!0,Tw(e.VERBOSE,"ChatComponent constructor")}ngOnInit(){Tw(e.VERBOSE,`ChatComponent.ngOnInit for chat ${this.chatId}`),NW(null!=this.chatId&&""!==this.chatId,"No chat to join mentionned"),this.loadChatContent()}ngAfterViewChecked(){this.scrollToBottomIfNeeded()}loadChatContent(){const e=e=>{this.updateMessages(e.flatMap(e=>null==e.data.postedTime?[]:[e.data]))},t=new BW(e,e,()=>{});this.chatService.startObserving(this.chatId,t)}updateMessages(e){this.chat=this.chat.concat(e);const t=this.chat.length;!0===this.visible&&!0===this.isNearBottom?(this.readMessages=t,this.updateUnreadMessagesText(0),this.scrollToBottom()):this.updateUnreadMessagesText(t-this.readMessages)}updateUnreadMessagesText(e){this.showUnreadMessagesButton=!(!this.visible||!1!==this.isNearBottom),0===e?(this.unreadMessagesText=$localize`no new message`,this.showUnreadMessagesButton=!1):this.unreadMessagesText=1===e?$localize`1 new message`:$localize`${e} new messages`}scrollToBottomIfNeeded(){this.visible&&(this.isNearBottom||this.notYetScrolled)&&this.scrollToBottom()}updateCurrentScrollPosition(){this.isNearBottom=this.chatDiv.nativeElement.scrollTop+this.chatDiv.nativeElement.offsetHeight>this.chatDiv.nativeElement.scrollHeight-10}scrollToBottom(){null!=this.chatDiv&&(this.updateUnreadMessagesText(0),this.scrollTo(this.chatDiv.nativeElement.scrollHeight),this.notYetScrolled=!1)}scrollTo(e){this.chatDiv.nativeElement.scroll({top:e,left:0,behavior:"smooth"})}sendMessage(){var e=this;return Pw(function*(){const t=e.userMessage;e.userMessage="";const n=e.connectedUserService.user.get().toMinimalUser();yield e.chatService.sendMessage(n,t,e.turn)})()}ngOnDestroy(){this.chatService.stopObserving()}switchChatVisibility(){!0===this.visible?this.visible=!1:(this.visible=!0,this.updateUnreadMessagesText(0),this.scrollToBottom(),this.readMessages=this.chat.length)}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(UW),ua(MK))},e.\u0275cmp=Je({type:e,selectors:[["app-chat"]],viewQuery:function(e,t){if(1&e&&ju(une,5),2&e){let e;qu(e=Zu())&&(t.chatDiv=e.first)}},inputs:{chatId:"chatId",turn:"turn"},decls:7,vars:4,consts:function(){let e,t,n,r;return e=$localize`Hide chat`,t=$localize`Show chat (${"\ufffd0\ufffd"}:INTERPOLATION:)`,n=$localize`Type your message here`,r=$localize`Be polite`,[["id","switchChatVisibilityButton",1,"button","is-primary","is-light","is-fullwidth",3,"click"],[4,"ngIf","ngIfElse"],["showChat",""],[4,"ngIf"],["id","chatForm",3,"onSubmit",4,"ngIf"],e,t,["id","scrollToBottomIndicator","class","notification button is-info is-light is-fullwidth",3,"click",4,"ngIf"],["id","chatDiv",1,"is-fullwidth","block",2,"overflow-y","scroll","max-height","50vh",3,"scroll"],["chatDiv",""],[4,"ngFor","ngForOf"],["id","scrollToBottomIndicator",1,"notification","button","is-info","is-light","is-fullwidth",3,"click"],[1,"chat-sender"],[1,"chat-message"],["id","chatForm",3,"onSubmit"],[1,"field","has-addons","is-fullwidth"],[1,"control","is-expanded"],["id","message","type","text","placeholder",n,"maxlength","128","value","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],["message",""],[1,"help"],[1,"control"],["type","submit","id","send",1,"button","is-primary",3,"click"],[1,"clickable-icon",3,"icon"],[1,"content","is-small"],r]},template:function(e,t){if(1&e&&(pa(0,"div"),pa(1,"button",0),Ea("click",function(){return t.switchChatVisibility()}),la(2,hne,2,0,"ng-container",1),la(3,dne,1,1,"ng-template",null,2,Ku),fa(),la(5,gne,5,2,"div",3),la(6,yne,14,5,"form",4),fa()),2&e){const e=ca(4);Ts(2),ha("ngIf",t.visible)("ngIfElse",e),Ts(3),ha("ngIf",t.visible),Ts(1),ha("ngIf",t.visible)}},directives:[rp,tp,pg,Df,cg,rf,Rg,xf,dg,MX],pipes:[cne],encapsulation:2}),e})();function _ne(e,t){if(1&e&&(ma(0),Qa(1),ya()),2&e){const e=Sa().$implicit;Ts(1),Xa(e.data.playerOne)}}function Cne(e,t){1&e&&(ma(0),sc(1,26),ya())}function Ene(e,t){if(1&e){const e=va();pa(0,"tr",22),Ea("click",function(){const t=Gt(e).$implicit;return Sa(2).joinGame(t.id,t.data.typeGame)}),pa(1,"td",23),Qa(2),fa(),pa(3,"td",23),Qa(4),fa(),pa(5,"td",23),la(6,_ne,2,1,"ng-container",24),la(7,Cne,2,0,"ng-template",null,25,Ku),fa(),pa(9,"td",23),Qa(10),fa(),fa()}if(2&e){const e=t.$implicit,n=t.index,r=ca(8);Ta("id","part_",n,""),Ts(2),Xa(e.data.typeGame),Ts(2),Xa(e.data.playerZero),Ts(2),ha("ngIf",e.data.playerOne)("ngIfElse",r),Ts(4),Xa(e.data.turn)}}function wne(e,t){if(1&e&&(pa(0,"div",13),pa(1,"div",14),pa(2,"table",15),pa(3,"thead"),pa(4,"tr"),pa(5,"th",16),sc(6,17),fa(),pa(7,"th",16),sc(8,18),fa(),pa(9,"th",16),sc(10,19),fa(),pa(11,"th",16),sc(12,20),fa(),fa(),fa(),pa(13,"tbody"),la(14,Ene,11,6,"tr",21),fa(),fa(),fa(),fa()),2&e){const e=Sa();Ts(14),ha("ngForOf",e.activeParts)}}function bne(e,t){1&e&&(pa(0,"div",27),ga(1,"app-online-game-selection",28),fa())}function Sne(e,t){if(1&e&&(pa(0,"li",39),Qa(1),ku(2,"firebaseDate"),fa()),2&e){const e=Sa().$implicit;Oa("id",e.data.username),Ts(1),el("",e.data.username,": ",Au(2,3,e.data.last_changed),"")}}function Pne(e,t){if(1&e&&(ma(0),la(1,Sne,3,5,"li",38),ya()),2&e){const e=t.$implicit;Ts(1),ha("ngIf",e.data.last_changed)}}function One(e,t){if(1&e&&(pa(0,"div",29),pa(1,"div",30),pa(2,"div",31),ga(3,"app-chat",32),fa(),fa(),pa(4,"div",33),pa(5,"div",34),pa(6,"p"),sc(7,35),fa(),pa(8,"ul",36),la(9,Pne,2,1,"ng-container",37),fa(),fa(),fa(),fa()),2&e){const e=Sa();Ts(3),ha("turn",-1),Ts(6),ha("ngForOf",e.activeUsers)}}let Tne=(()=>{class e{constructor(e,t,n){this.router=e,this.userService=t,this.activePartsService=n,this.activeUsers=[],this.activeParts=[],this.currentTab="games"}ngOnInit(){Tw(e.VERBOSE,"lobbyComponent.ngOnInit"),this.activeUsersSub=this.userService.getActiveUsersObs().subscribe(e=>{this.activeUsers=e}),this.activePartsService.startObserving(),this.activePartsSub=this.activePartsService.getActivePartsObs().subscribe(e=>{this.activeParts=e})}ngOnDestroy(){Tw(e.VERBOSE,"lobbyComponent.ngOnDestroy"),this.activeUsersSub.unsubscribe(),this.activePartsService.stopObserving(),this.activePartsSub.unsubscribe(),this.userService.unSubFromActiveUsersObs()}joinGame(e,t){var n=this;return Pw(function*(){yield n.router.navigate(["/play",t,e])})()}selectTab(e){this.currentTab=e}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(f_),ua(zW),ua(ane))},e.\u0275cmp=Je({type:e,selectors:[["app-lobby"]],decls:14,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Games`,t=$localize`Create`,n=$localize`Chat`,r=$localize`Game`,i=$localize`First player`,s=$localize`Second player`,o=$localize`Turn`,a=$localize`Waiting for opponent`,l=$localize`Connected users:`,[[1,"tabs","is-centered"],["ngClass","if (currentTab === 'games') 'is-active'"],["id","tab-games",3,"click"],e,["ngClass","if (currentTab === 'create') 'is-active'"],["id","tab-create",3,"click"],t,["ngClass","if (currentTab === 'chat') 'is-active'"],["id","tab-chat",3,"click"],n,["id","actualGames","class","box",4,"ngIf"],["id","gameCreator","class","box",4,"ngIf"],["id","chatTab","class","columns",4,"ngIf"],["id","actualGames",1,"box"],[1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],r,i,s,o,[3,"id","click",4,"ngFor","ngForOf"],[3,"id","click"],[1,"td"],[4,"ngIf","ngIfElse"],["waitingForOpponent",""],a,["id","gameCreator",1,"box"],["id","online-game-selection"],["id","chatTab",1,"columns"],["id","chatContainerDiv",1,"column","is-12"],["id","chat",1,"box"],["chatId","server",3,"turn"],[1,"column","is-3","is-hidden"],["id","onlineUsers",1,"box"],l,["id","activeUsersList"],[4,"ngFor","ngForOf"],[3,"id",4,"ngIf"],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"ul"),pa(2,"li",1),pa(3,"a",2),Ea("click",function(){return t.selectTab("games")}),sc(4,3),fa(),fa(),pa(5,"li",4),pa(6,"a",5),Ea("click",function(){return t.selectTab("create")}),sc(7,6),fa(),fa(),pa(8,"li",7),pa(9,"a",8),Ea("click",function(){return t.selectTab("chat")}),sc(10,9),fa(),fa(),fa(),fa(),la(11,wne,15,1,"div",10),la(12,bne,2,0,"div",11),la(13,One,10,2,"div",12)),2&e&&(Ts(11),ha("ngIf","games"===t.currentTab),Ts(1),ha("ngIf","create"===t.currentTab),Ts(1),ha("ngIf","chat"===t.currentTab))},directives:[Jd,rp,tp,lne,vne],pipes:[cne],encapsulation:2}),e})(),Ine=(()=>{class e{constructor(e){this.route=e,this.message=e.snapshot.paramMap.get("message")??$localize`This page does not exist.`}}return e.\u0275fac=function(t){return new(t||e)(ua(qy))},e.\u0275cmp=Je({type:e,selectors:[["app-not-found"]],decls:5,vars:1,consts:function(){let e;return e=$localize`Not found`,[[1,"message","is-danger"],[1,"message-header"],e,[1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),sc(2,2),fa(),pa(3,"div",3),Qa(4),fa(),fa()),2&e&&(Ts(4),Xa(t.message))},encapsulation:2}),e})();function kne(e,t){}let Ane=(()=>{class e{constructor(t){this.viewContainerRef=t,Tw(e.VERBOSE,"GameIncluderComponent constructor")}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(au))},e.\u0275cmp=Je({type:e,selectors:[["app-game-includer"]],decls:1,vars:0,template:function(e,t){1&e&&la(0,kne,0,0,"ng-template")},encapsulation:2}),e})(),Mne=(()=>{class e{static NO_MATCHING_GAME(e){return $localize`This game (${e}) does not exist.`}}return e.NOT_YOUR_TURN=()=>$localize`It is not your turn!`,e.NO_CLONING_FEATURE=()=>$localize`You cannot clone a game. This feature might be implemented later.`,e})(),Nne=(()=>{class e{constructor(t,n,r,i,s){this.componentFactoryResolver=t,this.actRoute=n,this.connectedUserService=r,this.router=i,this.messageDisplayer=s,this.players=[Mw.empty(),Mw.empty()],this.endGame=!1,Tw(e.VERBOSE,"GameWrapper.constructed: "+(null!=this.gameIncluder))}getMatchingComponent(t){return Tw(e.VERBOSE,"GameWrapper.getMatchingComponent"),Mw.ofNullable(Yte.ALL_GAMES().find(e=>e.urlName===t)).map(e=>e.component)}afterGameIncluderViewInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"GameWrapper.afterGameIncluderViewInit");const n=yield t.createGameComponent();return n&&t.gameComponent.rules.setInitialBoard(),n})()}createGameComponent(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"GameWrapper.createGameComponent");const n=Ow.getNonNullable(t.actRoute.snapshot.paramMap.get("compo")),r=t.getMatchingComponent(n);if(r.isAbsent())return yield t.router.navigate(["/notFound",Mne.NO_MATCHING_GAME(n)],{skipLocationChange:!0}),!1;NW(null!=t.gameIncluder,"GameIncluder should be present");const i=t.componentFactoryResolver.resolveComponentFactory(r.get()),s=t.gameIncluder.viewContainerRef.createComponent(i);return t.gameComponent=s.instance,t.gameComponent.chooseMove=(e,n,r)=>t.receiveValidMove(e,n,r),t.gameComponent.canUserPlay=e=>t.onUserClick(e),t.gameComponent.isPlayerTurn=()=>t.isPlayerTurn(),t.gameComponent.cancelMoveOnWrapper=e=>{t.onCancelMove(e)},t.gameComponent.observerRole=t.observerRole,t.canPass=t.gameComponent.canPass,!0})()}receiveValidMove(t,n,r){var i=this;return Pw(function*(){if(Tw(e.VERBOSE||!1,{gameWrapper_receiveValidMove_AKA_chooseMove:{move:t,state:n,scores:r}}),!i.isPlayerTurn())return TW.failure(Mne.NOT_YOUR_TURN());if(i.endGame)return TW.failure($localize`The game has ended.`);const s=i.gameComponent.rules.isLegal(t,n);return s.isFailure()?(i.gameComponent.cancelMove(s.getReason()),TW.ofFallible(s)):(i.gameComponent.cancelMoveAttempt(),yield i.onLegalUserMove(t,r),Tw(e.VERBOSE||!1,"GameWrapper.receiveValidMove says: valid move legal"),TW.SUCCESS)})()}onUserClick(e){if(this.observerRole===VK.NONE.value){const e=Mne.NO_CLONING_FEATURE();return TW.failure(e)}return this.isPlayerTurn()?TW.SUCCESS:TW.failure(Mne.NOT_YOUR_TURN())}onCancelMove(e){}isPlayerTurn(){if(this.observerRole===VK.NONE.value||null==this.gameComponent)return!1;const t=this.gameComponent.rules.node.gameState.turn,n=t%2,r=this.getPlayerName();return Tw(e.VERBOSE,{isPlayerTurn:{turn:t,players:this.players,username:r,observer:this.observerRole,areYouPlayer:this.players[n].equalsValue(r),isThereAPlayer:this.players[n]}}),!this.players[n].isPresent()||this.players[n].equalsValue(r)}getBoardHighlight(){return this.endGame?["endgame-bg"]:this.isPlayerTurn()?["player"+this.gameComponent.rules.node.gameState.turn%2+"-bg"]:[]}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(qy),ua(MK),ua(f_),ua(AW))},e.\u0275cmp=Je({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&ju(Ane,5),2&e){let e;qu(e=Zu())&&(t.gameIncluder=e.first)}},decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();class Rne{constructor(e,t,n){this.added=e,this.modified=t,this.removed=n}static from(e,t){const n=new Rne({},{},{});if(null==e)return n.added={...t},n;if(null==t)return n.removed={...e},n;const r=Object.keys(e),i=Object.keys(t),s=r.filter(e=>!1===i.includes(e)),o=r.filter(e=>i.includes(e)),a=i.filter(e=>!1===r.includes(e));return n.addNewKeys(a,t),n.addCommonKeys(o,t,e),n.addRemovedKeys(s,e),n}static differs(e,t){return Rne.from(e,t).countChanges()>0}addNewKeys(e,t){for(const n of e)null!=t[n]&&(this.added[n]=t[n])}addCommonKeys(e,t,n){for(const r of e)this.addCommonKey(r,n[r],t[r])}addCommonKey(e,t,n){if(null==n)null!=t&&(this.removed[e]=t);else if(null==t)this.added[e]=n;else if(["string","boolean","number"].includes(typeof t))t!==n&&(this.modified[e]=n);else if(Array.isArray(t)){if(!Array.isArray(n))throw new Error("Thing should not change type");t.length===n.length?this.addCommonKeyList(e,t,n):this.modified[e]=n}else{NW("object"==typeof t,`ObjectDifference: expected JSON, but got a ${typeof t} in ${e}`),NW("object"==typeof n,`ObjectDifference: expected JSON, but got a ${typeof n} in ${e}`);const r=Rne.from(t,n);r.countChanges()>0&&(this.modified[e]=r)}}addCommonKeyList(e,t,n){let r=!0;for(let i=0;r&&i<t.length;i++)typeof t[i]==typeof n[i]&&"object"==typeof t[i]?Rne.differs(t[i],n[i])&&(r=!1,this.modified[e]=n):t[i]!==n[i]&&(r=!1,this.modified[e]=n)}addRemovedKeys(e,t){for(const n of e)this.removed[n]=t[n]}countChanges(){const e=Object.keys(this.removed).length,t=Object.keys(this.modified).length;return Object.keys(this.added).length+t+e}isPresent(e){return null!=this.added[e]?{state:"added",present:!0}:null!=this.modified[e]?{state:"modified",present:!0}:null!=this.removed[e]?{state:"removed",present:!0}:{state:null,present:!1}}}function xne(e){return 1e3*e.seconds+e.nanoseconds/1e6}function Dne(e,t){return xne(t)-xne(e)}function Lne(e){return R((t,n)=>{Y(e).subscribe(new x(n,()=>n.complete(),f)),!n.closed&&t.subscribe(n)})}let Fne=(()=>{class e{transform(e){const t=e%60,n=(e-t)%3600/60,r=(e-60*n-t)/3600,i=[];if(r>1?i.push($localize`${r} hours`):1===r&&i.push($localize`1 hour`),n>1?i.push($localize`${n} minutes`):1===n&&i.push($localize`1 minute`),t>1?i.push($localize`${t} seconds`):1===t&&i.push($localize`1 second`),0===i.length)return $localize`0 seconds`;if(1===i.length)return i[0];{const e=i.slice(0,-1).join(", "),t=i.slice(-1)[0];return $localize`${e} and ${t}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=ot({name:"humanDuration",type:e,pure:!0}),e})();function Une(e,t){if(1&e&&(ma(0),Qa(1),ya()),2&e){const e=Sa(3);Ts(1),Xa(e.viewInfo.chosenOpponent)}}function Bne(e,t){1&e&&sc(0,44)}function Vne(e,t){if(1&e&&(pa(0,"div",45),pa(1,"div",8),pa(2,"label",46),ma(3),sc(4,47),ya(),pa(5,"output"),Qa(6),ku(7,"humanDuration"),fa(),fa(),pa(8,"div",37),ga(9,"input",48),fa(),fa(),pa(10,"div",8),pa(11,"label",49),rc(12,50),ga(13,"output"),ku(14,"humanDuration"),ic(),fa(),pa(15,"div",37),ga(16,"input",51),fa(),fa(),fa()),2&e){const e=Sa(3);Ts(6),Xa(Au(7,2,e.viewInfo.maximalMoveDuration||0)),Ts(8),oc(Au(14,4,e.viewInfo.totalPartDuration||0)),ac(12)}}function $ne(e,t){1&e&&(pa(0,"div"),rc(1,52),ga(2,"br"),ic(),fa())}function zne(e,t){1&e&&(pa(0,"button",64),sc(1,65),fa())}function Hne(e,t){if(1&e){const e=va();pa(0,"tr",60),Ea("click",function(){const t=Gt(e).$implicit;return Sa(4).selectOpponent(t)}),pa(1,"td",61),Qa(2),fa(),pa(3,"td",62),la(4,zne,2,0,"button",63),fa(),fa()}if(2&e){const e=t.$implicit,n=Sa(4);Ta("id","presenceOf_",e,""),ha("ngClass",n.viewInfo.candidateClasses[e]),Ts(1),ha("id",n.viewInfo.chosenOpponent===e?"selected_"+e:"candidate_"+e),Ts(1),Xa(e),Ts(2),ha("ngIf",n.viewInfo.chosenOpponent!==e)}}function Gne(e,t){if(1&e&&(ma(0),sc(1,53),ya(),pa(2,"div",54),pa(3,"table",55),pa(4,"thead"),pa(5,"tr"),pa(6,"th",56),sc(7,57),fa(),pa(8,"th",56),sc(9,58),fa(),fa(),fa(),pa(10,"tbody"),la(11,Hne,5,5,"tr",59),fa(),fa(),fa()),2&e){const e=Sa(3);Ts(11),ha("ngForOf",e.viewInfo.candidates)}}function Wne(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),Sa(3).changeConfig()}),sc(1,67),fa()}}function qne(e,t){if(1&e){const e=va();pa(0,"div"),pa(1,"h1",4),sc(2,5),fa(),pa(3,"form",6),pa(4,"fieldset",7),pa(5,"div",8),pa(6,"label",9),sc(7,10),fa(),pa(8,"div",11),pa(9,"button",12),Ea("click",function(){return Gt(e),Sa(2).selectFirstPlayer("RANDOM")}),sc(10,13),fa(),pa(11,"button",14),Ea("click",function(){return Gt(e),Sa(2).selectFirstPlayer("CREATOR")}),sc(12,15),fa(),pa(13,"button",16),Ea("click",function(){return Gt(e),Sa(2).selectFirstPlayer("CHOSEN_PLAYER")}),la(14,Une,2,1,"ng-container",17),la(15,Bne,1,0,"ng-template",null,18,Ku),fa(),fa(),fa(),pa(17,"div",8),pa(18,"label",9),sc(19,19),fa(),pa(20,"div",11),pa(21,"div",20),Ea("click",function(){return Gt(e),Sa(2).selectPartType("STANDARD")}),pa(22,"div",21),pa(23,"span"),sc(24,22),fa(),fa(),pa(25,"div",23),pa(26,"div",24),pa(27,"div",25),pa(28,"p"),ma(29),sc(30,26),ya(),pa(31,"strong"),Qa(32),ku(33,"humanDuration"),fa(),ga(34,"br"),ma(35),rc(36,27),ga(37,"strong"),ku(38,"humanDuration"),ic(),ya(),fa(),fa(),fa(),fa(),fa(),pa(39,"div",28),Ea("click",function(){return Gt(e),Sa(2).selectPartType("BLITZ")}),pa(40,"div",21),pa(41,"span"),sc(42,29),fa(),fa(),pa(43,"div",23),pa(44,"div",24),pa(45,"div",25),pa(46,"p"),ma(47),sc(48,30),ya(),pa(49,"strong"),Qa(50),ku(51,"humanDuration"),fa(),ga(52,"br"),ma(53),rc(54,31),ga(55,"strong"),ku(56,"humanDuration"),ic(),ya(),fa(),fa(),fa(),fa(),fa(),pa(57,"button",32),Ea("click",function(){return Gt(e),Sa(2).selectPartType("CUSTOM")}),sc(58,33),fa(),fa(),fa(),la(59,Vne,17,6,"div",34),pa(60,"div",8),pa(61,"label",35),sc(62,36),fa(),pa(63,"div",37),la(64,$ne,3,0,"div",17),la(65,Gne,12,1,"ng-template",null,38,Ku),fa(),fa(),fa(),pa(67,"div",8),pa(68,"div",11),pa(69,"button",39),Ea("click",function(){return Gt(e),Sa(2).proposeConfig()}),sc(70,40),fa(),la(71,Wne,2,0,"button",41),pa(72,"button",42),Ea("click",function(){return Gt(e),Sa(2).cancelGameCreation()}),sc(73,43),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=ca(16),t=ca(66),n=Sa(2);Ts(3),ha("formGroup",n.configFormGroup),Ts(1),ha("disabled",!n.viewInfo.canEditConfig),Ts(5),ha("ngClass",n.viewInfo.firstPlayerClasses.RANDOM),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CREATOR),Ts(2),ha("ngClass",n.viewInfo.firstPlayerClasses.CHOSEN_PLAYER),Ts(1),ha("ngIf",n.viewInfo.chosenOpponent)("ngIfElse",e),Ts(7),ha("ngClass",n.viewInfo.partTypeClasses.STANDARD),Ts(11),Xa(Au(33,19,n.partType.NORMAL_MOVE_DURATION)),Ts(6),oc(Au(38,21,n.partType.NORMAL_PART_DURATION)),ac(36),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.BLITZ),Ts(11),Xa(Au(51,23,n.partType.BLITZ_MOVE_DURATION)),Ts(6),oc(Au(56,25,n.partType.BLITZ_PART_DURATION)),ac(54),Ts(1),ha("ngClass",n.viewInfo.partTypeClasses.CUSTOM),Ts(2),ha("ngIf",n.viewInfo.showCustomTime),Ts(5),ha("ngIf",0===n.viewInfo.candidates.length)("ngIfElse",t),Ts(5),ha("disabled",!n.viewInfo.canProposeConfig),Ts(2),ha("ngIf",n.viewInfo.canReviewConfig)}}function jne(e,t){if(1&e&&(pa(0,"div",74),pa(1,"p"),rc(2,75),ga(3,"br"),ic(),fa(),fa()),2&e){const e=Sa(3);Ts(3),oc(e.viewInfo.creator),ac(2)}}function Zne(e,t){if(1&e&&(pa(0,"span"),sc(1,81),fa()),2&e){const e=Sa(4);Ts(1),oc(e.viewInfo.creator),ac(1)}}function Yne(e,t){1&e&&(pa(0,"span"),sc(1,82),fa())}function Kne(e,t){1&e&&(pa(0,"span"),sc(1,83),fa())}function Qne(e,t){if(1&e){const e=va();pa(0,"div",74),pa(1,"p"),sc(2,76),fa(),pa(3,"ul"),pa(4,"li"),la(5,Zne,2,1,"span",2),la(6,Yne,2,0,"span",2),la(7,Kne,2,0,"span",2),fa(),pa(8,"li"),rc(9,77),ga(10,"strong"),ku(11,"humanDuration"),ic(),fa(),pa(12,"li"),rc(13,78),ga(14,"strong"),ku(15,"humanDuration"),ic(),fa(),fa(),pa(16,"button",79),Ea("click",function(){return Gt(e),Sa(3).acceptConfig()}),sc(17,80),fa(),fa()}if(2&e){const e=Sa(3);Ts(2),oc(e.viewInfo.creator)(e.viewInfo.partTypeName),ac(2),Ts(3),ha("ngIf","CREATOR"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","CHOSEN_PLAYER"===e.viewInfo.firstPlayer),Ts(1),ha("ngIf","RANDOM"===e.viewInfo.firstPlayer),Ts(4),oc(Au(11,7,e.viewInfo.maximalMoveDuration||0)),ac(9),Ts(4),oc(Au(15,9,e.viewInfo.totalPartDuration||0)),ac(13)}}function Xne(e,t){if(1&e&&(pa(0,"div"),pa(1,"div",68),pa(2,"div",69),pa(3,"p"),sc(4,70),fa(),fa(),pa(5,"div",71),la(6,jne,4,1,"div",72),la(7,Qne,18,11,"ng-template",null,73,Ku),fa(),fa(),fa()),2&e){const e=ca(8),t=Sa(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function Jne(e,t){if(1&e&&(ma(0),sc(1,86),ya()),2&e){const e=Sa(3);Ts(1),oc(e.viewInfo.creator),ac(1)}}function ere(e,t){if(1&e&&sc(0,87),2&e){const e=Sa(3);oc(e.viewInfo.creator)(e.viewInfo.chosenOpponent),ac(0)}}function tre(e,t){if(1&e&&(pa(0,"div",68),pa(1,"div",69),pa(2,"p"),sc(3,84),fa(),fa(),pa(4,"div",71),pa(5,"p"),la(6,Jne,2,1,"ng-container",17),la(7,ere,1,2,"ng-template",null,85,Ku),fa(),fa(),fa()),2&e){const e=ca(8),t=Sa(2);Ts(6),ha("ngIf",t.viewInfo.creatorIsModifyingConfig)("ngIfElse",e)}}function nre(e,t){if(1&e&&(pa(0,"div",1),la(1,qne,74,27,"div",2),la(2,Xne,9,2,"div",2),la(3,tre,9,2,"div",3),fa()),2&e){const e=Sa();Ts(1),ha("ngIf",e.viewInfo.userIsCreator),Ts(1),ha("ngIf",e.viewInfo.userIsChosenOpponent),Ts(1),ha("ngIf",e.viewInfo.userIsObserver)}}class rre{constructor(e,t,n,r,i,s,o,a){this.router=e,this.connectedUserService=t,this.gameService=n,this.joinerService=r,this.chatService=i,this.userService=s,this.formBuilder=o,this.messageDisplayer=a,this.partType=RK,this.gameStartNotification=new xu,this.gameStarted=!1,this.gameExists=!1,this.viewInfo={userIsCreator:!1,userIsChosenOpponent:!1,userIsObserver:!1,partType:"STANDARD",partTypeClasses:{STANDARD:["is-selected","is-primary"],BLITZ:[],CUSTOM:[]},firstPlayer:"RANDOM",firstPlayerClasses:{CREATOR:[],RANDOM:["is-selected","is-primary"],CHOSEN_PLAYER:[]},candidateClasses:{},candidates:[]},this.currentJoiner=null,this.ngUnsubscribe=new A,this.allUserInterval=Mw.empty(),this.ownTokenInterval=Mw.empty(),this.selfSubscription=()=>{},this.allDocDeleted=!1,Tw(rre.VERBOSE,"PartCreationComponent constructed")}ngOnInit(){var e=this;return Pw(function*(){Tw(rre.VERBOSE,"PartCreationComponent.ngOnInit for "+e.connectedUserService.user.get().username.get()),e.checkInputs(),e.createForms();const t=e.connectedUserService.user.get().toMinimalUser(),n=yield e.joinerService.joinGame(e.partId,t);if(n.isFailure()){const t=n.getReason();e.messageDisplayer.criticalMessage(t)}else yield e.updateUserDocWithObservedPart(),yield e.startSendingPresenceTokens(),e.gameExists=!0,e.subscribeToJoinerDoc(),e.subscribeToFormElements(),Tw(rre.VERBOSE,"PartCreationComponent.ngOnInit asynchronouseries finisheds")})()}checkInputs(){const e=this.connectedUserService.user;NW(e.isPresent()&&e.get()!==AK.NOT_CONNECTED,"PartCreationComponent should not be created with an empty userName"),NW(""!==this.partId,"PartCreationComponent should not be created with an empty partId")}createForms(){this.configFormGroup=this.formBuilder.group({firstPlayer:[NK.RANDOM.value,uf.required],maximalMoveDuration:[RK.NORMAL_MOVE_DURATION,uf.required],partType:["STANDARD",uf.required],totalPartDuration:[RK.NORMAL_PART_DURATION,uf.required],chosenOpponent:["",uf.required]})}updateUserDocWithObservedPart(){return Tw(rre.VERBOSE,"updateUserDocWithObservedPart of '"+this.partId+"'"),this.connectedUserService.updateObservedPart(this.partId)}subscribeToJoinerDoc(){var e=this;this.joinerService.subscribeToChanges(this.partId,function(){var t=Pw(function*(t){yield e.onCurrentJoinerUpdate(t)});return function(e){return t.apply(this,arguments)}}())}getForm(e){return Ow.getNonNullable(this.configFormGroup.get(e))}subscribeToFormElements(){this.getForm("chosenOpponent").valueChanges.pipe(Lne(this.ngUnsubscribe)).subscribe(e=>{void 0!==this.viewInfo.chosenOpponent&&(this.viewInfo.candidateClasses[this.viewInfo.chosenOpponent]=[]),this.viewInfo.candidateClasses[e]=["is-selected"],this.viewInfo.chosenOpponent=e;const t=Ow.getNonNullable(this.currentJoiner).partStatus;this.viewInfo.canProposeConfig=t!==xK.CONFIG_PROPOSED.value&&""!==e}),this.getForm("partType").valueChanges.pipe(Lne(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.partTypeClasses[this.viewInfo.partType]=[],this.viewInfo.partTypeClasses[e]=["is-primary","is-selected"],this.viewInfo.partType=e,this.viewInfo.showCustomTime="CUSTOM"===e}),this.getForm("maximalMoveDuration").valueChanges.pipe(Lne(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.maximalMoveDuration=e}),this.getForm("totalPartDuration").valueChanges.pipe(Lne(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.totalPartDuration=e}),this.getForm("firstPlayer").valueChanges.pipe(Lne(this.ngUnsubscribe)).subscribe(e=>{this.viewInfo.firstPlayerClasses[this.viewInfo.firstPlayer]=[],this.viewInfo.firstPlayerClasses[e]=["is-primary","is-selected"],this.viewInfo.firstPlayer=e})}updateViewInfo(){const e=Ow.getNonNullable(this.currentJoiner),t=this.connectedUserService.user.get();switch(this.viewInfo.canReviewConfig=e.partStatus===xK.CONFIG_PROPOSED.value,this.viewInfo.canEditConfig=e.partStatus!==xK.CONFIG_PROPOSED.value,this.viewInfo.userIsCreator=t.id===e.creator.id,this.viewInfo.userIsChosenOpponent=t.id===e.chosenOpponent?.id,this.viewInfo.userIsObserver=!1===this.viewInfo.userIsChosenOpponent&&!1===this.viewInfo.userIsCreator,this.viewInfo.creatorIsModifyingConfig=e.partStatus!==xK.CONFIG_PROPOSED.value,this.viewInfo.showCustomTime="CUSTOM"===this.getForm("partType").value,this.viewInfo.creator=e.creator.name,this.viewInfo.candidates=e.candidates.map(e=>e.name),t.id===e.creator.id?this.setDataForCreator(e):(this.viewInfo.maximalMoveDuration=e.maximalMoveDuration,this.viewInfo.totalPartDuration=e.totalPartDuration,this.viewInfo.partType=e.partType,this.viewInfo.chosenOpponent=e.chosenOpponent?.name,this.viewInfo.firstPlayer=e.firstPlayer),e.partType){case"CUSTOM":this.viewInfo.partTypeName=$localize`custom`;break;case"BLITZ":this.viewInfo.partTypeName=$localize`blitz`;break;case"STANDARD":this.viewInfo.partTypeName=$localize`standard`}}setDataForCreator(e){this.viewInfo.maximalMoveDuration=this.viewInfo.maximalMoveDuration??e.maximalMoveDuration,this.viewInfo.totalPartDuration=this.viewInfo.totalPartDuration??e.totalPartDuration;let t=this.viewInfo.chosenOpponent;null==t||""===t?t=e.chosenOpponent?.name??"":!1===e.candidates.some(e=>e.name===t)&&(t=""),this.getForm("chosenOpponent").setValue(t)}selectFirstPlayer(e){this.getForm("firstPlayer").setValue(e)}selectPartType(e){"STANDARD"===e?(this.getForm("maximalMoveDuration").setValue(RK.NORMAL_MOVE_DURATION),this.getForm("totalPartDuration").setValue(RK.NORMAL_PART_DURATION)):"BLITZ"===e&&(this.getForm("maximalMoveDuration").setValue(RK.BLITZ_MOVE_DURATION),this.getForm("totalPartDuration").setValue(RK.BLITZ_PART_DURATION)),this.getForm("partType").setValue(e)}selectOpponent(e){var t=this;return Pw(function*(){Tw(rre.VERBOSE,"PartCreationComponent.setChosenOpponent("+e+")");const n=t.getUserFromName(e);return t.joinerService.setChosenOpponent(n)})()}getUserFromName(e){const t=Ow.getNonNullable(this.currentJoiner).candidates.find(t=>t.name===e);return Ow.getNonNullable(t)}changeConfig(){var e=this;return Pw(function*(){return e.joinerService.reviewConfig()})()}proposeConfig(){var e=this;return Pw(function*(){const t=e.getForm("chosenOpponent").value,n=e.getForm("partType").value,r=e.getForm("maximalMoveDuration").value,i=e.getForm("firstPlayer").value,s=e.getForm("totalPartDuration").value,o=e.getUserFromName(t);return e.joinerService.proposeConfig(o,RK.of(n),r,NK.of(i),s)})()}cancelGameCreation(){var e=this;return Pw(function*(){e.allDocDeleted=!0,yield e.connectedUserService.removeObservedPart(),Tw(rre.VERBOSE,"PartCreationComponent.cancelGameCreation"),yield e.chatService.deleteChat(e.partId),Tw(rre.VERBOSE,"PartCreationComponent.cancelGameCreation: chat deleted"),yield e.joinerService.deleteJoiner(),Tw(rre.VERBOSE,"PartCreationComponent.cancelGameCreation: chat and joiner deleted"),yield e.gameService.deletePart(e.partId),Tw(rre.VERBOSE,"PartCreationComponent.cancelGameCreation: chat, joiner, and part deleted")})()}onCurrentJoinerUpdate(e){var t=this;return Pw(function*(){if(Tw(rre.VERBOSE,{PartCreationComponent_onCurrentJoinerUpdate:{before:JSON.stringify(t.currentJoiner),then:JSON.stringify(e)}}),e.isAbsent())return Tw(rre.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: LAST UPDATE : the game is cancelled"),t.onGameCancelled();if(t.chosenOpponentJustLeft(e.get())){const e=Ow.getNonNullable(t.currentJoiner),n=Ow.getNonNullable(e.chosenOpponent).name;t.messageDisplayer.infoMessage($localize`${n} left the game, please pick another opponent.`)}t.currentJoiner=e.get(),t.allUserInterval.isAbsent()&&(yield t.observeNeededPlayers()),t.updateViewInfo(),t.isGameStarted()&&(Tw(rre.VERBOSE,"PartCreationComponent.onCurrentJoinerUpdate: the game has started"),t.onGameStarted())})()}chosenOpponentJustLeft(e){return null!=this.currentJoiner&&(null!=this.currentJoiner.chosenOpponent&&null==e.chosenOpponent)}onGameCancelled(){var e=this;return Pw(function*(){Tw(rre.VERBOSE,"PartCreationComponent.onGameCancelled"),e.messageDisplayer.infoMessage($localize`The game has been canceled!`),yield e.router.navigate(["/lobby"])})()}isGameStarted(){return Ow.getNonNullable(this.currentJoiner).partStatus===xK.PART_STARTED.value}onGameStarted(){const e=Ow.getNonNullable(this.currentJoiner);Tw(rre.VERBOSE,{partCreationComponent_onGameStarted:{joiner:e}}),this.gameStartNotification.emit(e),this.gameStarted=!0,Tw(rre.VERBOSE,"PartCreationComponent.onGameStarted finished")}observeNeededPlayers(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.currentJoiner),n=e.connectedUserService.user.get().id;Tw(rre.VERBOSE,{PartCreationComponent_updateJoiner:{joiner:t}}),e.allUserInterval=Mw.of(window.setInterval(Pw(function*(){const t=Ow.getNonNullable(e.currentJoiner),r=e.lastToken;n===t.creator.id?yield e.checkCandidatesTokensFreshness(r):yield e.checkCreatorTokenFreshness(r)}),rre.TOKEN_INTERVAL))})()}checkCreatorTokenFreshness(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);(yield t.didUserTimeout(n.creator.id,e))&&(yield t.destroyDocIfPartDidNotStart())})()}destroyDocIfPartDidNotStart(){var e=this;return Pw(function*(){NW(!1==(Ow.getNonNullable(e.currentJoiner).partStatus===xK.PART_STARTED.value),"Should not try to cancelGameCreation when part started!"),NW(!1===e.allDocDeleted,"Should not delete doc twice"),yield e.cancelGameCreation()})()}checkCandidatesTokensFreshness(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);for(const r of n.candidates)(yield t.didUserTimeout(r.id,e))&&(yield t.removeCandidateFromLobby(r.id))})()}didUserTimeout(e,t){var n=this;return Pw(function*(){const r=yield n.userService.getUserLastChanged(e);return r.isAbsent()?(MW.logError("PartCreationComponent","found no user while observing "+e+" !"),!0):Dne(r.get(),t)>rre.TOKEN_TIMEOUT})()}startSendingPresenceTokens(){var e=this;return Pw(function*(){yield e.connectedUserService.sendPresenceToken(),NW(e.ownTokenInterval.isAbsent(),"should not start sending presence tokens twice"),e.ownTokenInterval=Mw.of(window.setInterval(()=>{e.connectedUserService.sendPresenceToken()},rre.TOKEN_INTERVAL));const t=e.connectedUserService.user.get().id;e.selfSubscription=e.userService.observeUser(t,t=>{NW(t.isPresent(),"connected user should exist");const n=t.get();null!=n.last_changed&&(e.lastToken=n.last_changed)})})()}stopSendingPresenceTokensAndObservingUsersIfNeeded(){this.ownTokenInterval.isPresent()&&(window.clearInterval(this.ownTokenInterval.get()),this.ownTokenInterval=Mw.empty()),this.allUserInterval.isPresent()&&window.clearInterval(this.allUserInterval.get()),this.selfSubscription()}removeCandidateFromLobby(e){var t=this;return Pw(function*(){const n=Ow.getNonNullable(t.currentJoiner);NW(-1!==n.candidates.findIndex(t=>t.id===e),"PartCreationComponent: attempting to remove a user not in the lobby");const r=n.candidates.filter(t=>t.id!==e);return n.chosenOpponent?.id===e?t.joinerService.reviewConfigAndRemoveChosenOpponentAndUpdateCandidates(r):t.joinerService.updateCandidates(r)})()}acceptConfig(){var e=this;return Pw(function*(){return Tw(rre.VERBOSE,"PartCreationComponent.acceptConfig"),e.gameService.acceptConfig(e.partId,Ow.getNonNullable(e.currentJoiner))})()}ngOnDestroy(){var e=this;return Pw(function*(){Tw(rre.VERBOSE,"PartCreationComponent.ngOnDestroy"),e.ngUnsubscribe.next(),e.ngUnsubscribe.complete(),e.stopSendingPresenceTokensAndObservingUsersIfNeeded(),e.gameExists&&e.joinerService.unsubscribe();const t=e.connectedUserService.user.get();if(!0!==e.gameStarted){if(null===e.currentJoiner)return void Tw(rre.VERBOSE,"PartCreationComponent.ngOnDestroy: there is no part here");t.id===e.currentJoiner.creator.id?(Tw(rre.VERBOSE,"PartCreationComponent.ngOnDestroy: you(creator) about to cancel creation."),yield e.cancelGameCreation()):!1===e.allDocDeleted&&(Tw(rre.VERBOSE,"PartCreationComponent.ngOnDestroy: you(joiner) about to cancel game joining"),yield e.connectedUserService.removeObservedPart(),yield e.joinerService.cancelJoining(t.toMinimalUser()))}})()}}function ire(e,t){if(1&e){const e=va();pa(0,"button",3),Ea("click",function(){return Gt(e),Sa().addTime()}),sc(1,4),fa()}if(2&e){const e=Sa();Ts(1),oc(e.timeToAdd),ac(1)}}rre.VERBOSE=!1,rre.TOKEN_INTERVAL=5e3,rre.TOKEN_TIMEOUT=2*rre.TOKEN_INTERVAL,rre.\u0275fac=function(e){return new(e||rre)(ua(f_),ua(MK),ua(jK),ua(qK),ua(UW),ua(zW),ua(Fg),ua(AW))},rre.\u0275cmp=Je({type:rre,selectors:[["app-part-creation"]],inputs:{partId:"partId"},outputs:{gameStartNotification:"gameStartNotification"},decls:1,vars:1,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,b,S,P,O,T,I,k,A,M,N,R,x,D;return e=$localize`Game creation`,t=$localize`First player`,n=$localize`Random`,r=$localize`You`,i=$localize`Game type`,s=$localize`Standard`,o=$localize`Maximal turn duration: `,a=$localize`Maximal game duration: ${"\ufffd#37\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#37\ufffd"}:CLOSE_TAG_STRONG:`,l=$localize`Blitz`,c=$localize`Maximal turn duration: `,u=$localize`Maximal game duration: ${"\ufffd#55\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#55\ufffd"}:CLOSE_TAG_STRONG:`,h=$localize`Custom`,d=$localize`Opponents`,p=$localize`Propose configuration`,f=$localize`Cancel game`,g=$localize`The opponent`,m=$localize`Maximal turn duration: `,y=$localize`Maximal game duration: ${"\ufffd#13\ufffd"}:START_TAG_OUTPUT:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#13\ufffd"}:CLOSE_TAG_OUTPUT:`,v=$localize`Potential opponents that join the game will appear here.${"\ufffd#2\ufffd\ufffd/#2\ufffd"}:LINE_BREAK:Wait for an opponent to join, so that you can pick one.`,_=$localize`Click on the opponent against which you would like to play.`,C=$localize`Name`,E=$localize`Actions`,w=$localize`Pick`,b=$localize`Change configuration`,S=$localize`Configuration proposal`,P=$localize`You have been selected as the opponent.${"\ufffd#3\ufffd\ufffd/#3\ufffd"}:LINE_BREAK: ${"\ufffd0\ufffd"}:INTERPOLATION: is modifying the configuration.`,O=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: proposes to play a ${"\ufffd1\ufffd"}:INTERPOLATION_1: game`,T=$localize`a turn lasts at most ${"\ufffd#10\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#10\ufffd"}:CLOSE_TAG_STRONG:`,I=$localize`the game lasts at most ${"\ufffd#14\ufffd"}:START_TAG_STRONG:${"\ufffd0\ufffd"}:INTERPOLATION: per player${"\ufffd/#14\ufffd"}:CLOSE_TAG_STRONG:`,k=$localize`Accept and start`,A=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: plays first`,M=$localize`you play first`,N=$localize`the first player is selected randomly`,R=$localize`One moment...`,x=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: is configuring the game.`,D=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has proposed a configuration to ${"\ufffd1\ufffd"}:INTERPOLATION_1:.`,[["class","box",4,"ngIf"],[1,"box"],[4,"ngIf"],["class","message is-primary",4,"ngIf"],[1,"title"],e,[3,"formGroup"],[3,"disabled"],[1,"field"],["for","firstPlayer",1,"label"],t,[1,"buttons","has-addons"],["id","firstPlayerRandom",1,"button",3,"ngClass","click"],n,["id","firstPlayerCreator",1,"button",3,"ngClass","click"],r,["id","firstPlayerOpponent",1,"button",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["opponentWithoutName",""],i,["id","partTypeStandard",1,"button","dropdown","is-hoverable",3,"ngClass","click"],[1,"dropdown-trigger"],s,["role","menu",1,"dropdown-menu"],[1,"dropdown-content"],[1,"dropdown-item"],o,a,["id","partTypeBlitz",1,"button","dropdown","is-hoverable",3,"ngClass","click"],l,c,u,["id","partTypeCustom",1,"button",3,"ngClass","click"],h,["id","customTime",4,"ngIf"],[1,"label"],d,[1,"control"],["chooseOpponent",""],["id","proposeConfig",1,"button","is-primary",3,"disabled","click"],p,["class","button","id","reviewConfig",3,"click",4,"ngIf"],["id","cancel",1,"button",3,"click"],f,g,["id","customTime"],["for","maximalMoveDuration",1,"label"],m,["step","10","min","10","max","300","name","maximalMoveDuration","formControlName","maximalMoveDuration","type","range",1,"slider","is-circle","is-primary"],["for","totalPartDuration",1,"label"],y,["step","10","min","10","max","3600","name","totalPartDuration","formControlName","totalPartDuration","type","range",1,"slider","is-circle","is-primary"],v,_,["id","chooseOpponent",1,"table-container"],[1,"table","is-fullwidth","is-hoverable","is-striped"],["scope","col",1,"th"],C,E,[3,"id","ngClass","click",4,"ngFor","ngForOf"],[3,"id","ngClass","click"],[1,"td",3,"id"],[1,"td"],["class","button is-primary",4,"ngIf"],[1,"button","is-primary"],w,["id","reviewConfig",1,"button",3,"click"],b,[1,"message","is-primary"],[1,"message-header"],S,[1,"message-body"],["class","content",4,"ngIf","ngIfElse"],["configProposal",""],[1,"content"],P,O,T,I,["id","acceptConfig",1,"button","is-primary",3,"click"],k,A,M,N,R,["proposalSent",""],x,D]},template:function(e,t){1&e&&la(0,nre,4,3,"div",0),2&e&&ha("ngIf",t.viewInfo)},directives:[rp,pg,Df,_g,Jd,rf,mg,xf,Eg,tp],pipes:[Fne],encapsulation:2});let sre=(()=>{class e{constructor(){this.isPaused=!0,this.isSet=!1,this.started=!1,this.outOfTimeAction=new xu,this.addTimeToOpponent=new xu,this.cssClasses=e.SAFE_TIME}ngOnInit(){Tw(e.VERBOSE,"CountDownComponent.ngOnInit ("+this.debugName+")")}setDuration(t){if(Tw(e.VERBOSE,this.debugName+".set("+t+"ms)"),this.started)throw new Error("Should not set a chrono that has already been started ("+this.debugName+")!");this.isSet=!0,this.changeDuration(t)}changeDuration(e){let t=!1;!1===this.isPaused&&(this.pause(),t=!0),this.remainingMs=e,this.displayDuration(),t&&this.resume()}displayDuration(){this.displayedSec=this.remainingMs%6e4,this.displayedMinute=(this.remainingMs-this.displayedSec)/6e4,this.displayedSec=Math.floor(this.displayedSec/1e3)}start(){if(Tw(e.VERBOSE,this.debugName+".start("+this.remainingMs+"ms);"),!1===this.isSet)throw new Error("Should not start a chrono that has not been set!");if(this.started)throw new Error("Should not start chrono that has already been started ("+this.debugName+")");this.started=!0,this.resume()}resume(){if(Tw(e.VERBOSE,this.debugName+".resume("+this.remainingMs+"ms)"),!1===this.isPaused||!1===this.started)throw new Error("Should only resume chrono that are started and paused!");this.startTime=Date.now();const t=this.remainingMs;this.isPaused=!1,this.timeoutHandleGlobal=window.setTimeout(()=>{this.onEndReached()},t),this.countSeconds()}onEndReached(){Tw(e.VERBOSE,this.debugName+".onEndReached"),this.isPaused=!0,this.started=!1,this.clearTimeouts(),this.changeDuration(0),this.outOfTimeAction.emit()}countSeconds(){this.timeoutHandleSec=window.setTimeout(()=>{this.updateShownTime()},1e3)}isIdle(){return!1===this.started||this.isPaused}pause(){if(Tw(e.VERBOSE,this.debugName+".pause("+this.remainingMs+"ms)"),!this.started)throw new Error("Should not pause not started chrono ("+this.debugName+")");if(this.isPaused)throw new Error("Should not pause already paused chrono ("+this.debugName+")");this.clearTimeouts(),this.isPaused=!0,this.updateShownTime()}stop(){if(Tw(e.VERBOSE,this.debugName+".stop("+this.remainingMs+"ms)"),!1===this.started)throw new Error("Should only stop chrono that are started!");this.pause(),this.started=!1,this.isSet=!1}isStarted(){return this.started}getTimeClass(){return!1===this.active?e.PASSIVE_STYLE:this.remainingMs<this.dangerTimeLimit?this.remainingMs%2e3<1e3?e.DANGER_TIME_ODD:e.DANGER_TIME_EVEN:e.SAFE_TIME}updateShownTime(){const e=Date.now();this.remainingMs-=e-this.startTime,this.displayDuration(),this.cssClasses=this.getTimeClass(),this.startTime=e,!1===this.isPaused&&this.countSeconds()}clearTimeouts(){Tw(e.VERBOSE,this.debugName+".clearTimeouts"),null!=this.timeoutHandleSec&&(window.clearTimeout(this.timeoutHandleSec),this.timeoutHandleSec=null),null!=this.timeoutHandleGlobal&&(window.clearTimeout(this.timeoutHandleGlobal),this.timeoutHandleGlobal=null)}addTime(){this.addTimeToOpponent.emit()}ngOnDestroy(){this.clearTimeouts()}}return e.VERBOSE=!1,e.DANGER_TIME_EVEN="has-background-danger has-text-white",e.DANGER_TIME_ODD="has-background-warning has-text-white",e.PASSIVE_STYLE="has-text-passive is-italic",e.SAFE_TIME="",e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Je({type:e,selectors:[["app-count-down"]],inputs:{debugName:"debugName",timeToAdd:"timeToAdd",dangerTimeLimit:"dangerTimeLimit",active:"active",canAddTime:"canAddTime"},outputs:{outOfTimeAction:"outOfTimeAction",addTimeToOpponent:"addTimeToOpponent"},decls:5,vars:7,consts:function(){let e;return e=$localize`Add ${"\ufffd0\ufffd"}:INTERPOLATION:`,[[3,"ngClass"],["id","remainingTime"],["id","addTimeButton","class","button is-small is-fullwidth",3,"click",4,"ngIf"],["id","addTimeButton",1,"button","is-small","is-fullwidth",3,"click"],e]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),Qa(2),ku(3,"number"),fa(),la(4,ire,2,1,"button",2),fa()),2&e&&(ha("ngClass",t.getTimeClass()),Ts(2),el("",t.displayedMinute,":",function(e,t,n,r){const i=e+20,s=zt(),o=Rt(s,i);return Nu(s,Mu(s,i)?Iu(s,Jt(),t,o.transform,n,r,o):o.transform(n,r))}(3,4,t.displayedSec,"2.0-0"),""),Ts(2),ha("ngIf",t.canAddTime))},directives:[Jd,rp],pipes:[op],encapsulation:2}),e})();const ore=["partCreation"],are=["chatComponent"],lre=["chronoZeroGlobal"],cre=["chronoOneGlobal"],ure=["chronoZeroTurn"],hre=["chronoOneTurn"];function dre(e,t){if(1&e){const e=va();pa(0,"app-part-creation",5,6),Ea("gameStartNotification",function(t){return Gt(e),Sa().startGame(t)}),fa()}2&e&&ha("partId",Sa().currentPartId)}function pre(e,t){1&e&&(ma(0),sc(1,40),ya())}function fre(e,t){if(1&e&&(ma(0),sc(1,41),ya()),2&e){const e=Sa(4);Ts(1),oc(e.currentPlayer),ac(1)}}function gre(e,t){if(1&e&&(pa(0,"p",37),la(1,pre,2,0,"ng-container",38),la(2,fre,2,1,"ng-template",null,39,Ku),fa()),2&e){const e=ca(3),t=Sa(3);Ts(1),ha("ngIf",t.currentPlayer===t.getPlayerName())("ngIfElse",e)}}function mre(e,t){if(1&e&&(pa(0,"div",33),pa(1,"p",34),sc(2,35),fa(),la(3,gre,4,2,"p",36),fa()),2&e){const e=Sa(2);Ts(2),oc(e.currentPart.getTurn()+1),ac(2),Ts(1),ha("ngIf",!1===e.endGame)}}function yre(e,t){if(1&e&&(pa(0,"p",42),Qa(1),fa()),2&e){const e=Sa(2);ha("ngClass",e.getPlayerNameClass(0)),Ts(1),Xa(e.players[0].get())}}function vre(e,t){if(1&e&&(pa(0,"p",43),sc(1,44),fa()),2&e){const e=Sa(2);Ts(1),oc(e.gameComponent.scores.get()[0]),ac(1)}}function _re(e,t){if(1&e&&(pa(0,"p",45),Qa(1),fa()),2&e){const e=Sa(2);ha("ngClass",e.getPlayerNameClass(1)),Ts(1),Xa(e.players[1].get())}}function Cre(e,t){if(1&e&&(pa(0,"p",46),sc(1,47),fa()),2&e){const e=Sa(2);Ts(1),oc(e.gameComponent.scores.get()[1]),ac(1)}}function Ere(e,t){if(1&e){const e=va();pa(0,"button",56),Ea("click",function(){return Gt(e),Sa(3).resign()}),sc(1,57),fa()}}function wre(e,t){if(1&e){const e=va();pa(0,"button",58),Ea("click",function(){return Gt(e),Sa(3).proposeDraw()}),sc(1,59),fa()}}function bre(e,t){if(1&e){const e=va();pa(0,"button",60),Ea("click",function(){return Gt(e),Sa(3).acceptDraw()}),sc(1,61),fa()}}function Sre(e,t){if(1&e){const e=va();pa(0,"button",62),Ea("click",function(){return Gt(e),Sa(3).refuseDraw()}),sc(1,63),fa()}}function Pre(e,t){if(1&e){const e=va();pa(0,"button",64),Ea("click",function(){return Gt(e),Sa(3).gameComponent.pass()}),sc(1,65),fa()}}function Ore(e,t){if(1&e){const e=va();pa(0,"button",66),Ea("click",function(){return Gt(e),Sa(3).acceptTakeBack()}),sc(1,67),fa()}}function Tre(e,t){if(1&e){const e=va();pa(0,"button",68),Ea("click",function(){return Gt(e),Sa(3).refuseTakeBack()}),sc(1,69),fa()}}function Ire(e,t){if(1&e){const e=va();pa(0,"button",70),Ea("click",function(){return Gt(e),Sa(3).askTakeBack()}),sc(1,71),fa()}}function kre(e,t){if(1&e&&(ma(0),la(1,Ere,2,0,"button",48),la(2,wre,2,0,"button",49),la(3,bre,2,0,"button",50),la(4,Sre,2,0,"button",51),la(5,Pre,2,0,"button",52),la(6,Ore,2,0,"button",53),la(7,Tre,2,0,"button",54),la(8,Ire,2,0,"button",55),ya()),2&e){const e=Sa(2);Ts(1),ha("ngIf",e.canResign()),Ts(1),ha("ngIf",e.canProposeDraw()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForDrawResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isPlaying()&&e.gameComponent.canPass&&e.currentPlayer===e.getPlayerName()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&e.isOpponentWaitingForTakeBackResponse()),Ts(1),ha("ngIf",!1===e.endGame&&!1===e.isOpponentWaitingForTakeBackResponse()&&e.canAskTakeBack())}}function Are(e,t){1&e&&(pa(0,"div"),pa(1,"p",73),sc(2,74),fa(),fa())}function Mre(e,t){1&e&&(pa(0,"p",78),sc(1,79),fa())}function Nre(e,t){1&e&&(pa(0,"p",80),sc(1,81),fa())}function Rre(e,t){1&e&&(pa(0,"p",82),sc(1,83),fa())}function xre(e,t){if(1&e&&(pa(0,"div"),la(1,Mre,2,0,"p",75),la(2,Nre,2,0,"p",76),la(3,Rre,2,0,"p",77),fa()),2&e){const e=Sa(3);Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getDrawAccepter()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function Dre(e,t){1&e&&(pa(0,"p",86),sc(1,87),fa())}function Lre(e,t){1&e&&(pa(0,"p",88),sc(1,89),fa())}function Fre(e,t){if(1&e&&(pa(0,"p",88),sc(1,90),fa()),2&e){const e=Sa(4);Ts(1),oc(e.currentPart.getWinner().get()),ac(1)}}function Ure(e,t){if(1&e&&(pa(0,"div"),la(1,Dre,2,0,"p",84),la(2,Lre,2,0,"p",85),la(3,Fre,2,1,"p",85),fa()),2&e){const e=Sa(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function Bre(e,t){if(1&e&&(pa(0,"p",86),sc(1,91),fa()),2&e){const e=Sa(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function Vre(e,t){1&e&&(pa(0,"p",88),sc(1,92),fa())}function $re(e,t){if(1&e&&(pa(0,"p",88),sc(1,93),fa()),2&e){const e=Sa(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function zre(e,t){if(1&e&&(pa(0,"div"),la(1,Bre,2,1,"p",84),la(2,Vre,2,0,"p",85),la(3,$re,2,1,"p",85),fa()),2&e){const e=Sa(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()===e.getPlayerName()),Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying())}}function Hre(e,t){1&e&&(pa(0,"p",95),sc(1,96),fa())}function Gre(e,t){if(1&e&&(pa(0,"p",95),sc(1,97),fa()),2&e){const e=Sa(4);Ts(1),oc(e.currentPart.getLoser().get()),ac(1)}}function Wre(e,t){if(1&e&&(pa(0,"div"),la(1,Hre,2,0,"p",94),la(2,Gre,2,1,"p",94),fa()),2&e){const e=Sa(3);Ts(1),ha("ngIf",e.currentPart.getWinner().get()!==e.getPlayerName()&&e.isPlaying()),Ts(1),ha("ngIf",!1===e.isPlaying()||e.currentPart.getWinner().get()===e.getPlayerName())}}function qre(e,t){if(1&e&&(pa(0,"div",72),ga(1,"hr"),la(2,Are,3,0,"div",26),la(3,xre,4,3,"div",26),la(4,Ure,4,3,"div",26),la(5,zre,4,3,"div",26),la(6,Wre,3,2,"div",26),fa()),2&e){const e=Sa(2);Ts(2),ha("ngIf",e.currentPart.isHardDraw()),Ts(1),ha("ngIf",e.currentPart.isAgreedDraw()),Ts(1),ha("ngIf",e.currentPart.isWin()),Ts(1),ha("ngIf",e.currentPart.isTimeout()),Ts(1),ha("ngIf",e.currentPart.isResign())}}function jre(e,t){1&e&&(pa(0,"button",98),sc(1,99),fa())}function Zre(e,t){if(1&e){const e=va();pa(0,"button",100),Ea("click",function(){return Gt(e),Sa(2).proposeRematch()}),sc(1,101),fa()}}function Yre(e,t){if(1&e){const e=va();pa(0,"button",102),Ea("click",function(){return Gt(e),Sa(2).acceptRematch()}),sc(1,103),fa()}}function Kre(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"div",8),pa(2,"div",9),la(3,mre,4,2,"div",10),pa(4,"div",11),la(5,yre,2,2,"p",12),la(6,vre,2,1,"p",13),pa(7,"app-count-down",14,15),Ea("outOfTimeAction",function(){return Gt(e),Sa().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),Sa().addGlobalTime()}),fa(),pa(9,"app-count-down",16,17),Ea("outOfTimeAction",function(){return Gt(e),Sa().reachedOutOfTime(0)})("addTimeToOpponent",function(){return Gt(e),Sa().addTurnTime()}),fa(),fa(),pa(11,"p",18),sc(12,19),fa(),pa(13,"div",11),la(14,_re,2,2,"p",20),la(15,Cre,2,1,"p",21),pa(16,"app-count-down",22,23),Ea("outOfTimeAction",function(){return Gt(e),Sa().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),Sa().addGlobalTime()}),fa(),pa(18,"app-count-down",24,25),Ea("outOfTimeAction",function(){return Gt(e),Sa().reachedOutOfTime(1)})("addTimeToOpponent",function(){return Gt(e),Sa().addTurnTime()}),fa(),fa(),ga(20,"hr"),la(21,kre,9,8,"ng-container",26),la(22,qre,7,5,"div",27),la(23,jre,2,0,"button",28),la(24,Zre,2,0,"button",29),la(25,Yre,2,0,"button",30),fa(),fa(),pa(26,"div",31),pa(27,"div",32),ga(28,"app-game-includer"),fa(),fa(),fa()}if(2&e){const e=Sa();Ts(3),ha("ngIf",e.currentPart),Ts(2),ha("ngIf",e.players[0].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==0)("canAddTime",1===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(5),ha("ngIf",e.players[1].isPresent()),Ts(1),ha("ngIf",e.currentPart&&e.gameComponent&&e.gameComponent.scores.isPresent()),Ts(1),ha("dangerTimeLimit",6e4)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.globalTimeMessage),Ts(2),ha("dangerTimeLimit",15e3)("active",null!=e.currentPart&&e.currentPart.getTurn()%2==1)("canAddTime",0===e.observerRole&&!1===e.endGame)("timeToAdd",e.turnTimeMessage),Ts(3),ha("ngIf",e.isPlaying()),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&!1===e.rematchProposed),Ts(1),ha("ngIf",e.endGame&&e.isPlaying()&&e.rematchProposed&&e.opponentProposedRematch),Ts(1),ha("ngClass",e.getBoardHighlight())}}let Qre=(()=>{class e{}return e.NO_MATCHING_PART=()=>$localize`The game you tried to join does not exist.`,e})();class Xre{constructor(e){this.value=e}}Xre.PRE_START_DOC=new Xre("PRE_START_DOC"),Xre.STARTING_DOC=new Xre("STARTING_DOC"),Xre.DUPLICATE=new Xre("DUPLICATE"),Xre.MOVE_WITHOUT_TIME=new Xre("MOVE_WITHOUT_TIME"),Xre.MOVE=new Xre("MOVE"),Xre.REQUEST=new Xre("REQUEST"),Xre.END_GAME=new Xre("END_GAME"),Xre.END_GAME_WITHOUT_TIME=new Xre("END_GAME_WITHOUT_TIME"),Xre.ACCEPT_TAKE_BACK_WITHOUT_TIME=new Xre("ACCEPT_TAKE_BACK_WITHOUT_TIME");let Jre=(()=>{class e extends Nne{constructor(t,n,r,i,s,o,a){super(t,n,s,r,i),this.userService=o,this.gameService=a,this.gameStarted=!1,this.opponent=null,this.rematchProposed=!1,this.opponentProposedRematch=!1,this.hasUserPlayed=[!1,!1],this.msToSubstract=[0,0],this.opponentSubscription=Mw.empty(),this.OFFLINE_FONT_COLOR={color:"lightgrey"},this.globalTimeMessage=$localize`5 minutes`,this.turnTimeMessage=$localize`30 seconds`,Tw(e.VERBOSE,"OnlineGameWrapperComponent constructed")}extractPartIdFromURL(){return Ow.getNonNullable(this.actRoute.snapshot.paramMap.get("id"))}extractGameNameFromURL(){return Ow.getNonNullable(this.actRoute.snapshot.paramMap.get("compo"))}isPlaying(){return this.observerRole===BK.ZERO.value||this.observerRole===BK.ONE.value}getPlayer(){return BK.of(this.observerRole)}getPlayerName(){return Ow.getNonNullable(this.authUser.username.get())}isPlayer(e){return this.observerRole===e.value}isOpponent(e){return this.observerRole!==e.value}redirectIfPartOrGameIsInvalid(){var e=this;return Pw(function*(){const t=e.extractGameNameFromURL();if(Yte.ALL_GAMES().some(e=>e.urlName===t)){if((yield e.gameService.getPartValidity(e.currentPartId,t)).isFailure()){e.routerEventsSub.unsubscribe();const t=Qre.NO_MATCHING_PART();yield e.router.navigate(["/notFound",t],{skipLocationChange:!0})}}else{e.routerEventsSub.unsubscribe();const n=Mne.NO_MATCHING_GAME(t);yield e.router.navigate(["/notFound",n],{skipLocationChange:!0})}})()}setCurrentPartIdOrRedirect(){return this.currentPartId=this.extractPartIdFromURL(),this.redirectIfPartOrGameIsInvalid()}ngOnInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.ngOnInit"),t.routerEventsSub=t.router.events.subscribe(function(){var e=Pw(function*(e){e instanceof Vm&&(yield t.setCurrentPartIdOrRedirect())});return function(t){return e.apply(this,arguments)}}()),t.userSub=t.connectedUserService.getUserObs().subscribe(e=>{t.authUser=e}),yield t.setCurrentPartIdOrRedirect()})()}startGame(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.startGame"),NW(!1===n.gameStarted,"Should not start already started game"),n.joiner=t,n.gameStarted=!0,window.setTimeout(Pw(function*(){NW(yield n.afterGameIncluderViewInit(),"Game should be created successfully, otherwise part-creation would have redirected"),n.startPart()}),1)})()}startPart(){var t=this;Tw(e.VERBOSE,"OnlineGameWrapperComponent.startPart"),this.gameService.startObserving(this.currentPartId,function(){var e=Pw(function*(e){NW(e.isPresent(),"OnlineGameWrapper observed a part being deleted, this should not happen"),yield t.onCurrentPartUpdate(e.get())});return function(t){return e.apply(this,arguments)}}())}onCurrentPartUpdate(t){var n=this;return Pw(function*(){const r=new xW(n.currentPartId,t);Tw(e.VERBOSE,{OnlineGameWrapperComponent_onCurrentPartUpdate:{before:n.currentPart,then:t.data,before_part_turn:r.data.turn,before_state_turn:n.gameComponent.rules.node.gameState.turn,nbPlayedMoves:r.data.listMoves.length}});const i=n.getUpdateType(r),s=t.turn;Tw(e.VERBOSE,i===Xre.REQUEST?"UpdateType: Request("+Ow.getNonNullable(r.data.request).code+") ("+s+")":"UpdateType: "+i.value+"("+s+")");const o=n.currentPart;switch(n.currentPart=r,i){case Xre.REQUEST:return yield n.onRequest(Ow.getNonNullable(r.data.request),o);case Xre.ACCEPT_TAKE_BACK_WITHOUT_TIME:return void(n.currentPart=o);case Xre.DUPLICATE:return;case Xre.END_GAME_WITHOUT_TIME:return void(n.currentPart=o);case Xre.END_GAME:return n.applyEndGame();case Xre.MOVE_WITHOUT_TIME:return void(n.currentPart=o);case Xre.MOVE:return n.msToSubstract=n.getLastUpdateTime(o,r,i),n.doNewMoves(r);case Xre.PRE_START_DOC:const e=null==n.currentPart||null!=n.currentPart.data.beginning;return void NW(null==o||null==o.data.beginning||e,"old part had no beginning time or new part has, we did not expect this!");default:return NW(i===Xre.STARTING_DOC,"Unexpected update type "+i),n.setChronos(),n.setPlayersDatas(r),n.startCountDownFor(BK.ZERO)}})()}getUpdateType(t){const n=Rne.from(null!=this.currentPart?this.currentPart.data:null,t.data);Tw(e.VERBOSE,{diff:n});const r=n.countChanges();if(0===r)return Xre.DUPLICATE;if(t.data.request){const e=null!=n.removed.lastUpdateTime;return"TakeBackAccepted"===t.data.request.code&&e?Xre.ACCEPT_TAKE_BACK_WITHOUT_TIME:Xre.REQUEST}if(this.isMove(n,r))return 1===t.data.turn?null==t.data.lastUpdateTime?Xre.MOVE_WITHOUT_TIME:Xre.MOVE:null==n.modified.lastUpdateTime?Xre.MOVE_WITHOUT_TIME:Xre.MOVE;if(null==t.data.beginning)return Xre.PRE_START_DOC;if(t.data.result!==RW.UNACHIEVED.value){const e=null==n.modified.lastUpdateTime;return null!=n.modified.turn&&e?Xre.END_GAME_WITHOUT_TIME:Xre.END_GAME}return NW(null!=t.data.beginning&&0===t.data.listMoves.length,"Unexpected update: "+JSON.stringify(n)),Xre.STARTING_DOC}isMove(e,t){if(null!=e.modified.listMoves&&null!=e.modified.turn){const n=3;return t===(e.isPresent("lastUpdateTime").present?1:0)+(e.isPresent("scorePlayerZero").present?1:0)+(e.isPresent("scorePlayerOne").present?1:0)+(e.isPresent("remainingMsForZero").present?1:0)+(e.isPresent("remainingMsForOne").present?1:0)+(null==e.removed.request?0:1)+n}return!1}getLastUpdateTime(e,t,n){const r=this.getMoreRecentTime(e),i=this.getMoreRecentTime(t);NW(null!=r,"TODO: OLD_TIME WAS NULL, UNDO COMMENT AND TEST!"),NW(null!=i,"TODO UPDATE_TIME WAS NULL, UNDO COMMENT AND TEST!");const s=BK.fromTurn(e.data.turn);return this.getTimeUsedForLastTurn(Ow.getNonNullable(r),Ow.getNonNullable(i),n,s)}getMoreRecentTime(e){return e.data.lastUpdateTime??e.data.beginning}getTimeUsedForLastTurn(e,t,n,r){const i=Dne(e,t),s=[0,0];return s[r.value]=i,s}setChronos(){Tw(e.VERBOSE,"onlineGameWrapperComponent.setChronos()"),this.chronoZeroGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoOneGlobal.setDuration(1e3*this.joiner.totalPartDuration),this.chronoZeroTurn.setDuration(1e3*this.joiner.maximalMoveDuration),this.chronoOneTurn.setDuration(1e3*this.joiner.maximalMoveDuration)}didUserPlay(e){return this.hasUserPlayed[e.value]}doNewMoves(e){this.switchPlayer();const t=GK.copyImmutableArray(e.data.listMoves),n=this.gameComponent.rules;for(;n.node.gameState.turn<t.length;){const e=n.node.gameState.turn,r=this.gameComponent.encoder.decode(t[e]),i=n.isLegal(r,n.node.gameState),s="We received an incorrect db move: "+r.toString()+" in "+t+" at turn "+e+'because "'+i.getReasonOr("")+'"';NW(i.isSuccess(),s),n.choose(r)}this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get(),this.gameComponent.updateBoard()}switchPlayer(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.switchPlayer");const t=BK.fromTurn(this.currentPart.data.turn);this.currentPlayer=this.players[this.gameComponent.rules.node.gameState.turn%2].get();const n=t.getOpponent();this.didUserPlay(n)&&this.pauseCountDownsFor(n),this.didUserPlay(t)?(Tw(e.VERBOSE,"OnlineGameWrapperComponent.onCurrentPartUpdate: changing current player"),this.resumeCountDownFor(t)):this.startCountDownFor(t)}resetChronoFor(e){this.pauseCountDownsFor(e),this.resumeCountDownFor(e)}applyEndGame(){const t=this.currentPart,n=BK.fromTurn(t.data.turn);this.endGame=!0,[RW.VICTORY,RW.HARD_DRAW].some(e=>e.value===t.data.result)?this.doNewMoves(this.currentPart):(NW(!0===[RW.RESIGN,RW.TIMEOUT,RW.HARD_DRAW,RW.AGREED_DRAW_BY_ZERO,RW.AGREED_DRAW_BY_ONE].some(e=>e.value===t.data.result),"Unknown type of end game ("+t.data.result+")"),Tw(e.VERBOSE,"endGame est true et winner est "+t.getWinner())),this.stopCountdownsFor(n)}notifyDraw(e,t){this.endGame=!0;const n=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,n,e,[0,0],t,!0)}notifyTimeoutVictory(e,t,n,r){var i=this;return Pw(function*(){i.endGame=!0;const s=i.currentPart.setWinnerAndLoser(e,r);i.currentPart=s,yield i.gameService.notifyTimeout(i.currentPartId,t,n,e,r)})()}notifyVictory(t,n){Tw(e.VERBOSE,"OnlineGameWrapperComponent.notifyVictory");const r=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);r===SJ.ONE_WON?this.currentPart=this.currentPart.setWinnerAndLoser(this.players[1].get(),this.players[0].get()):(NW(r===SJ.ZERO_WON,"impossible to get a victory without winner!"),this.currentPart=this.currentPart.setWinnerAndLoser(this.players[0].get(),this.players[1].get())),this.endGame=!0;const i=this.getPlayer();return this.gameService.updateDBBoard(this.currentPartId,i,t,[0,0],n,!1,this.currentPart.getWinner().get(),this.currentPart.getLoser().get())}canAskTakeBack(){return NW(this.isPlaying(),"Non playing should not call canAskTakeBack"),!(null==this.currentPart||this.currentPart.data.turn<=this.observerRole||this.currentPart.data.request&&"TakeBackRefused"===this.currentPart.data.request.code&&this.currentPart.data.request.data.player===this.getPlayer().getOpponent().value)&&this.getTakeBackRequester()===VK.NONE}isOpponentWaitingForTakeBackResponse(){const e=this.getTakeBackRequester();return!!e.isPlayer()&&this.isOpponent(e)}getTakeBackRequester(){if(null==this.currentPart)return VK.NONE;const e=this.currentPart.data.request;return e&&"TakeBackAsked"===e.code?$K.getPlayer(e):VK.NONE}canProposeDraw(){return NW(this.isPlaying(),"Non playing should not call canProposeDraw"),!(this.endGame||null==this.currentPart||this.currentPart.data.request&&"DrawRefused"===this.currentPart.data.request.code&&$K.getPlayer(this.currentPart.data.request)===this.getPlayer().getOpponent()||this.isOpponentWaitingForDrawResponse())&&this.getDrawRequester()===VK.NONE}isOpponentWaitingForDrawResponse(){const e=this.getDrawRequester();return e!==VK.NONE&&this.isOpponent(e)}getDrawRequester(){if(null==this.currentPart)return VK.NONE;const e=this.currentPart.data.request;return e&&"DrawProposed"===e.code?$K.getPlayer(e):VK.NONE}onRequest(t,n){var r=this;return Pw(function*(){switch(Tw(e.VERBOSE,{called:"OnlineGameWrapper.onRequest(",request:t,oldPart:n}),t.code){case"TakeBackAsked":case"TakeBackRefused":break;case"TakeBackAccepted":r.takeBackTo(r.currentPart.data.turn);break;case"RematchProposed":r.rematchProposed=!0;const n=$K.getPlayer(t).getOpponent();r.isPlayer(n)&&(Tw(e.VERBOSE,"ton adversaire te propose une revanche"),r.opponentProposedRematch=!0);break;case"RematchAccepted":yield r.router.navigate(["/nextGameLoading"]),yield r.router.navigate(["/play",$K.getTypeGame(t),$K.getPartId(t)]);break;case"DrawProposed":case"DrawRefused":break;case"AddTurnTime":const i=3e4,s=BK.of(t.data.player);r.addTurnTimeTo(s,i);break;case"AddGlobalTime":const o=3e5,a=BK.of(t.data.player);r.addGlobalTimeTo(a,o);break;default:Ow.expectToBe(t.code,"DrawAccepted","Unknown RequestType : "+t.code+" for "+JSON.stringify(t)),yield r.acceptDraw()}})()}takeBackTo(e){if(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.gameComponent.rules.node.gameState.turn===e)this.switchPlayer();else{this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get();const t=BK.fromTurn(e);this.resetChronoFor(t)}this.gameComponent.updateBoard()}setPlayersDatas(t){Tw(e.VERBOSE,{OnlineGameWrapper_setPlayersDatas:t}),this.players=[Mw.of(t.data.playerZero),Mw.ofNullable(t.data.playerOne)],NW(null!=t.data.playerOne,"should not setPlayersDatas when players data is not received"),this.currentPlayer=this.players[t.data.turn%2].get();let n=Mw.empty();if(this.players[0].equalsValue(this.getPlayerName())?(this.observerRole=BK.ZERO.value,n=this.players[1]):this.players[1].equalsValue(this.getPlayerName())?(this.observerRole=BK.ONE.value,n=this.players[0]):this.observerRole=VK.NONE.value,n.isPresent()){const e=e=>{this.opponent=e[0].data},t=new BW(e,e,e=>{throw new Error("OnlineGameWrapper: Opponent was deleted, what sorcery is this: "+JSON.stringify(e))});this.opponentSubscription=Mw.of(this.userService.observeUserByUsername(n.get(),t))}}onLegalUserMove(t,n){var r=this;return Pw(function*(){if(Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.onLegalUserMove"),!r.isOpponentWaitingForTakeBackResponse())return r.updateDBBoard(t,r.msToSubstract,n);r.gameComponent.message("You must answer to take back request")})()}updateDBBoard(t,n,r){var i=this;return Pw(function*(){const s=i.gameComponent.encoder.encodeMove(t);Tw(e.VERBOSE,"OnlineGameWrapperComponent.updateDBBoard("+t.toString()+", "+r+")"),i.gameComponent.rules.choose(t);const o=i.gameComponent.rules.getGameStatus(i.gameComponent.rules.node);if(o.isEndGame)return o===SJ.DRAW?i.notifyDraw(s,r):i.notifyVictory(s,r);{const e=i.getPlayer();return i.gameService.updateDBBoard(i.currentPartId,e,s,n,r)}})()}resign(){var e=this;return Pw(function*(){const t=e.getLastIndex(),n=e.getPlayer(),r=e.players[e.observerRole%2].get(),i=e.players[(e.observerRole+1)%2].get();yield e.gameService.resign(e.currentPartId,t,n,i,r)})()}getLastIndex(){return this.currentPart.data.lastUpdate.index}reachedOutOfTime(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"OnlineGameWrapperComponent.reachedOutOfTime("+t+")");const r=n.getLastIndex(),i=n.getPlayer();n.stopCountdownsFor(BK.of(t));const s=Ow.getNonNullable(n.opponent);if(t===n.observerRole){const e=Ow.getNonNullable(s.username);yield n.notifyTimeoutVictory(e,i,r,n.getPlayerName())}else if(NW(!1===n.endGame,"time might be better handled in the future"),n.opponentIsOffline()){const e=Ow.getNonNullable(s.username);yield n.notifyTimeoutVictory(n.getPlayerName(),i,t,e),n.endGame=!0}})()}acceptRematch(){var e=this;return Pw(function*(){NW(e.isPlaying(),"Non playing should not call acceptRematch");const t=new xW(e.currentPartId,e.currentPart.data);return yield e.gameService.acceptRematch(t,e.getLastIndex(),e.getPlayer()),!0})()}proposeRematch(){var e=this;return Pw(function*(){return NW(e.isPlaying(),"Non playing should not call proposeRematch"),yield e.gameService.proposeRematch(e.currentPartId,e.getLastIndex(),e.getPlayer()),!0})()}proposeDraw(){return this.gameService.proposeDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptDraw(){return this.gameService.acceptDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}refuseDraw(){return this.gameService.refuseDraw(this.currentPartId,this.getLastIndex(),this.getPlayer())}askTakeBack(){return this.gameService.askTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}acceptTakeBack(){var e=this;return Pw(function*(){const t=e.getPlayer();yield e.gameService.acceptTakeBack(e.currentPartId,e.currentPart,t,e.msToSubstract),e.msToSubstract=[0,0]})()}refuseTakeBack(){return this.gameService.refuseTakeBack(this.currentPartId,this.getLastIndex(),this.getPlayer())}startCountDownFor(t){Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.startCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),this.hasUserPlayed[t.value]=!0,t===BK.ZERO?(this.chronoZeroGlobal.start(),this.chronoZeroTurn.start()):(this.chronoOneGlobal.start(),this.chronoOneTurn.start())}resumeCountDownFor(t,n=!0){let r;Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.resumeCountDownFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===BK.ZERO?(this.chronoZeroGlobal.changeDuration(Ow.getNonNullable(this.currentPart.data.remainingMsForZero)),this.chronoZeroGlobal.resume(),r=this.chronoZeroTurn):(this.chronoOneGlobal.changeDuration(Ow.getNonNullable(this.currentPart.data.remainingMsForOne)),this.chronoOneGlobal.resume(),r=this.chronoOneTurn),n?(r.setDuration(1e3*this.joiner.maximalMoveDuration),r.start()):r.resume()}pauseCountDownsFor(t,n=!0){let r;Tw(e.VERBOSE,"dans OnlineGameWrapperComponent.pauseCountDownFor("+t.value+") (turn "+this.currentPart.data.turn+")"),t===BK.ZERO?(this.chronoZeroGlobal.pause(),r=this.chronoZeroTurn):(this.chronoOneGlobal.pause(),r=this.chronoOneTurn),n?r.stop():r.pause()}stopCountdownsFor(t){Tw(e.VERBOSE,"cdc::stopCountDownsFor("+t.toString()+") (turn "+this.currentPart.data.turn+")"),t===BK.ZERO?(this.chronoZeroGlobal.isStarted()&&this.chronoZeroGlobal.stop(),this.chronoZeroTurn.isStarted()&&this.chronoZeroTurn.stop()):(this.chronoOneGlobal.isStarted()&&this.chronoOneGlobal.stop(),this.chronoOneTurn.isStarted()&&this.chronoOneTurn.stop())}getPlayerNameClass(e){return this.opponentIsOffline()?"has-text-grey-light":0===e?"has-text-white":"has-text-black"}opponentIsOffline(){return!1}canResign(){return NW(this.isPlaying(),"Non playing should not call canResign"),!(!0===this.endGame||null==this.opponent)}addGlobalTime(){const e=this.getPlayer(),t=this.getLastIndex();return this.gameService.addGlobalTime(this.currentPartId,t,this.currentPart.data,e)}addTurnTime(){const e=this.getPlayer();return this.gameService.addTurnTime(e,this.getLastIndex(),this.currentPartId)}addTurnTimeTo(e,t){const n=BK.fromTurn(this.currentPart.getTurn());this.pauseCountDownsFor(n,!1),e===BK.ZERO?this.chronoZeroTurn.changeDuration(this.chronoZeroTurn.remainingMs+t):this.chronoOneTurn.changeDuration(this.chronoOneTurn.remainingMs+t),this.resumeCountDownFor(n,!1)}addGlobalTimeTo(e,t){e===BK.ZERO?this.chronoZeroGlobal.changeDuration(this.chronoZeroGlobal.remainingMs+t):this.chronoOneGlobal.changeDuration(this.chronoOneGlobal.remainingMs+t)}ngOnDestroy(){this.routerEventsSub.unsubscribe(),this.userSub.unsubscribe(),!0===this.gameStarted&&(this.opponentSubscription.isPresent()&&this.opponentSubscription.get()(),this.gameService.stopObserving())}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(qy),ua(f_),ua(AW),ua(MK),ua(zW),ua(jK))},e.\u0275cmp=Je({type:e,selectors:[["app-online-game-wrapper"]],viewQuery:function(e,t){if(1&e&&(ju(ore,5),ju(are,5),ju(lre,5),ju(cre,5),ju(ure,5),ju(hre,5)),2&e){let e;qu(e=Zu())&&(t.partCreation=e.first),qu(e=Zu())&&(t.chatComponent=e.first),qu(e=Zu())&&(t.chronoZeroGlobal=e.first),qu(e=Zu())&&(t.chronoOneGlobal=e.first),qu(e=Zu())&&(t.chronoZeroTurn=e.first),qu(e=Zu())&&(t.chronoOneTurn=e.first)}},features:[Go],decls:5,vars:4,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p,f,g,m,y,v,_,C,E,w,b,S,P,O,T,I;return e=$localize`vs.`,t=$localize`Turn n°${"\ufffd0\ufffd"}:INTERPOLATION:`,n=$localize`It is your turn.`,r=$localize`It is ${"\ufffd0\ufffd"}:INTERPOLATION:'s turn.`,i=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Resign`,a=$localize`Propose a draw`,l=$localize`Accept draw`,c=$localize`Reject draw`,u=$localize`Pass a turn`,h=$localize`Accept take back`,d=$localize`Reject take back`,p=$localize`Ask to take back one move`,f=$localize`Draw`,g=$localize`You agreed to draw.`,m=$localize`Your draw proposal has been accepted.`,y=$localize`Players agreed to draw.`,v=$localize`You won.`,_=$localize`You lost.`,C=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won.`,E=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit. You won.`,w=$localize`You reached your time limit.`,b=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has reached their time limit.`,S=$localize`You resigned.`,P=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: has resigned.`,O=$localize`Go back to the game list`,T=$localize`Propose to play again`,I=$localize`Accept to play again`,[["id","partCreation",3,"partId","gameStartNotification",4,"ngIf"],["id","game","class","tile is-ancestor",4,"ngIf"],[1,"block","mt-2"],["id","chat",1,"box"],[3,"chatId","turn"],["id","partCreation",3,"partId","gameStartNotification"],["partCreation",""],["id","game",1,"tile","is-ancestor"],[1,"tile","is-parent"],[1,"tile","is-child","box","has-text-centered"],["class","block","id","turnIndicator",4,"ngIf"],[1,"block"],["id","playerZeroIndicator","class","player0-bg",3,"ngClass",4,"ngIf"],["id","scoreZeroIndicator",4,"ngIf"],["debugName","ZERO Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroGlobal",""],["debugName","ZERO Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoZeroTurn",""],[1,"is-size-3"],e,["id","playerOneIndicator","class","player1-bg",3,"ngClass",4,"ngIf"],["id","scoreOneIndicator",4,"ngIf"],["debugName","ONE Global",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneGlobal",""],["debugName","ONE Turn",3,"dangerTimeLimit","active","canAddTime","timeToAdd","outOfTimeAction","addTimeToOpponent"],["chronoOneTurn",""],[4,"ngIf"],["class","block","id","winnerIndicator",4,"ngIf"],["class","button is-primary is-fullwidth mb-1","id","backToServerButton","routerLink","/lobby",4,"ngIf"],["id","proposeRematchButton","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["class","button is-fullwidth is-warning","id","acceptRematchButton",3,"click",4,"ngIf"],["id","board-tile",1,"tile","is-9","is-parent","rounded-div",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","turnIndicator",1,"block"],[1,"subtitle"],t,["class","subtitle","id","currentPlayerIndicator",4,"ngIf"],["id","currentPlayerIndicator",1,"subtitle"],[4,"ngIf","ngIfElse"],["opponentsTurn",""],n,r,["id","playerZeroIndicator",1,"player0-bg",3,"ngClass"],["id","scoreZeroIndicator"],i,["id","playerOneIndicator",1,"player1-bg",3,"ngClass"],["id","scoreOneIndicator"],s,["class","button is-fullwidth mb-1","id","resignButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","proposeDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptDrawButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","refuseDrawButton",3,"click",4,"ngIf"],["class","button is-fullwidth mb-1","id","passButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","id","acceptTakeBackButton",3,"click",4,"ngIf"],["class","button is-warning is-fullwidth mb-1","color","warn","id","refuseTakeBackButton",3,"click",4,"ngIf"],["class","button is-fullwidth","id","askTakeBackButton",3,"click",4,"ngIf"],["id","resignButton",1,"button","is-fullwidth","mb-1",3,"click"],o,["id","proposeDrawButton",1,"button","is-fullwidth","mb-1",3,"click"],a,["id","acceptDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],l,["id","refuseDrawButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],c,["id","passButton",1,"button","is-fullwidth","mb-1",3,"click"],u,["id","acceptTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],h,["color","warn","id","refuseTakeBackButton",1,"button","is-warning","is-fullwidth","mb-1",3,"click"],d,["id","askTakeBackButton",1,"button","is-fullwidth",3,"click"],p,["id","winnerIndicator",1,"block"],["id","hardDrawIndicator",1,"title"],f,["class","title","id","youAgreedToDrawIndicator",4,"ngIf"],["class","title","id","yourOpponentAgreedToDrawIndicator",4,"ngIf"],["class","title","id","playersAgreedToDraw",4,"ngIf"],["id","youAgreedToDrawIndicator",1,"title"],g,["id","yourOpponentAgreedToDrawIndicator",1,"title"],m,["id","playersAgreedToDraw",1,"title"],y,["class","title","id","youWonIndicator",4,"ngIf"],["class","title",4,"ngIf"],["id","youWonIndicator",1,"title"],v,[1,"title"],_,C,E,w,b,["class","title","id","resignIndicator",4,"ngIf"],["id","resignIndicator",1,"title"],S,P,["id","backToServerButton","routerLink","/lobby",1,"button","is-primary","is-fullwidth","mb-1"],O,["id","proposeRematchButton",1,"button","is-fullwidth","mb-1",3,"click"],T,["id","acceptRematchButton",1,"button","is-fullwidth","is-warning",3,"click"],I]},template:function(e,t){1&e&&(la(0,dre,2,1,"app-part-creation",0),la(1,Kre,29,27,"div",1),pa(2,"div",2),pa(3,"div",3),ga(4,"app-chat",4),fa(),fa()),2&e&&(ha("ngIf",!1===t.gameStarted),Ts(1),ha("ngIf",t.gameStarted),Ts(3),ha("chatId",t.currentPartId)("turn",null==t.currentPart?null:t.currentPart.getTurn()))},directives:[rp,vne,rre,sre,Jd,Ane,m_],encapsulation:2}),e})();function eie(e,t){if(1&e&&(pa(0,"option",25),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Xa(e.name)}}function tie(e,t){if(1&e&&(pa(0,"option",25),sc(1,29),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),oc(e),ac(1)}}const nie=function(){return[1,2,3,4,5,6,7,8,9,10,11,12]};function rie(e,t){if(1&e){const e=va();pa(0,"select",26),Ea("ngModelChange",function(t){return Gt(e),Sa(2).aiDepths[0]=t})("change",function(){return Gt(e),Sa(2).updatePlayer(0)}),pa(1,"option",27),sc(2,28),fa(),la(3,tie,2,2,"option",16),fa()}2&e&&(ha("ngModel",Sa(2).aiDepths[0]),Ts(3),ha("ngForOf",wu(2,nie)))}function iie(e,t){if(1&e&&(pa(0,"p",30),sc(1,31),fa()),2&e){const e=Sa(2);Ts(1),oc(e.gameComponent.scores.get()[0]),ac(1)}}function sie(e,t){if(1&e&&(pa(0,"option",25),Qa(1),fa()),2&e){const e=t.$implicit;ha("value",e.name),Ts(1),Xa(e.name)}}function oie(e,t){if(1&e&&(pa(0,"option",25),sc(1,34),fa()),2&e){const e=t.$implicit;ha("value",e),Ts(1),oc(e),ac(1)}}function aie(e,t){if(1&e){const e=va();pa(0,"select",32),Ea("ngModelChange",function(t){return Gt(e),Sa(2).aiDepths[1]=t})("change",function(){return Gt(e),Sa(2).updatePlayer(1)}),pa(1,"option",27),sc(2,33),fa(),la(3,oie,2,2,"option",16),fa()}2&e&&(ha("ngModel",Sa(2).aiDepths[1]),Ts(3),ha("ngForOf",wu(2,nie)))}function lie(e,t){if(1&e&&(pa(0,"p",35),sc(1,36),fa()),2&e){const e=Sa(2);Ts(1),oc(e.gameComponent.scores.get()[1]),ac(1)}}function cie(e,t){if(1&e&&(pa(0,"h4"),sc(1,40),fa()),2&e){const e=Sa(3);Ts(1),oc(e.winner.get()),ac(1)}}function uie(e,t){1&e&&(pa(0,"h4",41),sc(1,42),fa())}function hie(e,t){if(1&e&&(pa(0,"div",37),la(1,cie,2,1,"h4",38),la(2,uie,2,0,"h4",39),fa()),2&e){const e=Sa(2);Ts(1),ha("ngIf",e.winner.isPresent()),Ts(1),ha("ngIf",e.winner.isAbsent())}}function die(e,t){if(1&e){const e=va();pa(0,"div",6),pa(1,"div",7),pa(2,"p",8),sc(3,9),fa(),fa(),pa(4,"div",10),pa(5,"div",11),pa(6,"div",12),pa(7,"select",13),Ea("change",function(){return Gt(e),Sa().updatePlayer(0)})("ngModelChange",function(t){return Gt(e),Sa().playerSelection[0]=t}),pa(8,"option",14),sc(9,15),fa(),la(10,eie,2,2,"option",16),fa(),fa(),pa(11,"div",12),la(12,rie,4,3,"select",17),fa(),la(13,iie,2,1,"p",18),fa(),pa(14,"div",19),pa(15,"div",12),pa(16,"select",20),Ea("change",function(){return Gt(e),Sa().updatePlayer(1)})("ngModelChange",function(t){return Gt(e),Sa().playerSelection[1]=t}),pa(17,"option",14),sc(18,21),fa(),la(19,sie,2,2,"option",16),fa(),fa(),pa(20,"div",12),la(21,aie,4,3,"select",22),fa(),la(22,lie,2,1,"p",23),fa(),fa(),la(23,hie,3,2,"div",24),fa()}if(2&e){const e=Sa();Ts(3),oc(e.gameComponent.rules.node.gameState.turn+1),ac(3),Ts(4),ha("ngModel",e.playerSelection[0]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[0].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(3),ha("ngModel",e.playerSelection[1]),Ts(3),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(2),ha("ngIf",!1===e.players[1].equalsValue("human")),Ts(1),ha("ngIf",e.gameComponent.scores.isPresent()),Ts(1),ha("ngIf",e.endGame)}}function pie(e,t){if(1&e&&(ma(0),Qa(1),ga(2,"br"),ya()),2&e){const e=t.$implicit,n=Sa(3);Ts(1),Ja(" ",e.name+": "+e.getBoardValue(n.gameComponent.rules.node)," ")}}function fie(e,t){if(1&e&&(ma(0),la(1,pie,3,1,"ng-container",48),Qa(2),ga(3,"br"),Qa(4),ga(5,"br"),ya()),2&e){const e=Sa(2);Ts(1),ha("ngForOf",e.gameComponent.availableMinimaxes),Ts(1),Ja(" Created ",e.getCreatedNodes()," nodes."),Ts(2),Ja(" Minimax time: ",e.getMinimaxTime(),"ms.")}}function gie(e,t){if(1&e){const e=va();pa(0,"button",49),Ea("click",function(){return Gt(e),Sa(2).gameComponent.pass()}),sc(1,50),fa()}}function mie(e,t){if(1&e){const e=va();pa(0,"button",51),Ea("click",function(){return Gt(e),Sa(2).takeBack()}),sc(1,52),fa()}}function yie(e,t){if(1&e){const e=va();pa(0,"div",43),la(1,fie,6,3,"ng-container",38),la(2,gie,2,0,"button",44),la(3,mie,2,0,"button",45),pa(4,"button",46),Ea("click",function(){return Gt(e),Sa().restartGame()}),sc(5,47),fa(),fa()}if(2&e){const e=Sa();Ts(1),ha("ngIf",e.gameComponent.rules.node.move),Ts(1),ha("ngIf",!1===e.endGame&&e.gameComponent.canPass),Ts(1),ha("ngIf",e.canTakeBack())}}let vie=(()=>{class e extends Nne{constructor(t,n,r,i,s,o){super(t,n,r,i,s),this.cdr=o,this.aiDepths=["0","0"],this.playerSelection=["human","human"],this.winner=Mw.empty(),this.botTimeOut=1e3,this.players=[Mw.of(this.playerSelection[0]),Mw.of(this.playerSelection[1])],Tw(e.VERBOSE,"LocalGameWrapper.constructor")}getCreatedNodes(){return wJ.createdNodes}getMinimaxTime(){return wJ.minimaxTime}ngAfterViewInit(){var e=this;setTimeout(Pw(function*(){(yield e.afterGameIncluderViewInit())&&(e.restartGame(),e.cdr.detectChanges())}),1)}updatePlayer(e){this.players[e]=Mw.of(this.playerSelection[e]),this.proposeAIToPlay()}onLegalUserMove(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,"LocalGameWrapperComponent.onLegalUserMove"),n.gameComponent.rules.choose(t),n.updateBoard(),n.proposeAIToPlay()})()}updateBoard(){this.gameComponent.updateBoard();const e=this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node);!0===e.isEndGame&&(this.endGame=!0,e.winner.isPlayer()&&(this.winner=Mw.of($localize`Player ${e.winner.value+1}`)))}proposeAIToPlay(){var e=this;const t=this.getPlayingAI();t.isPresent()&&window.setTimeout(Pw(function*(){yield e.doAIMove(t.get())}),this.botTimeOut)}getPlayingAI(){if(this.gameComponent.rules.getGameStatus(this.gameComponent.rules.node).isEndGame)return Mw.empty();const e=this.gameComponent.rules.node.gameState.turn%2;return"0"===this.aiDepths[e]?Mw.empty():Mw.ofNullable(this.gameComponent.availableMinimaxes.find(t=>this.players[e].equalsValue(t.name)))}doAIMove(e){var t=this;return Pw(function*(){const n=t.gameComponent.rules;NW(n.getGameStatus(n.node)===SJ.ONGOING,"IA should not try to play when game is over!");const r=Number.parseInt(t.aiDepths[n.node.gameState.turn%2%2]),i=n.node.findBestMove(r,e,!0);return n.choose(i)?(t.updateBoard(),t.cdr.detectChanges(),t.proposeAIToPlay(),TW.SUCCESS):(t.messageDisplayer.criticalMessage($localize`The AI chose an illegal move! This is an unexpected situation that we logged, we will try to solve this as soon as possible. In the meantime, consider that you won!`),MW.logError("LocalGameWrapper","AI chose illegal move",{name:e.name,move:i.toString()}))})()}canTakeBack(){return this.gameComponent.rules.node.gameState.turn>0}takeBack(){this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get(),this.isAITurn()&&(this.gameComponent.rules.node=this.gameComponent.rules.node.mother.get()),this.gameComponent.updateBoard()}isAITurn(){return this.getPlayingAI().isPresent()}restartGame(){const e=this.gameComponent.rules.stateType.getInitialState();this.gameComponent.rules.node=new bJ(e),this.gameComponent.updateBoard(),this.endGame=!1,this.winner=Mw.empty(),this.proposeAIToPlay()}getPlayerName(){return"human"}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(qy),ua(MK),ua(f_),ua(AW),ua(Yc))},e.\u0275cmp=Je({type:e,selectors:[["app-local-game-wrapper"]],features:[Go],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Turn n°${"\ufffd0\ufffd"}:INTERPOLATION:`,t=$localize`Human`,n=$localize`Human`,r=$localize`Pick the level`,i=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,s=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,o=$localize`Pick the level`,a=$localize`Level ${"\ufffd0\ufffd"}:INTERPOLATION:`,l=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: points`,c=$localize`${"\ufffd0\ufffd"}:INTERPOLATION: won`,u=$localize`Draw`,h=$localize`Start a new game`,d=$localize`Pass a turn`,p=$localize`Take back move`,[[1,"tile","is-ancestor"],[1,"tile","is-3","is-vertical","is-parent"],["class","tile is-child box has-text-centered","id","info",4,"ngIf"],["class","tile is-child box is-vcentered",4,"ngIf"],[1,"tile","is-parent","is-9","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["id","info",1,"tile","is-child","box","has-text-centered"],["id","turnIndicator",1,"block"],[1,"subtitle"],e,["id","playerSelector",1,"columns"],[1,"column","is-6","is-vcentered"],[1,"select"],["id","playerZeroSelect",3,"ngModel","change","ngModelChange"],["selected","","value","human"],t,[3,"value",4,"ngFor","ngForOf"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreOne","class","block",4,"ngIf"],[1,"column","is-6"],["id","playerOneSelect",3,"ngModel","change","ngModelChange"],n,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change",4,"ngIf"],["id","scoreZero","class","block",4,"ngIf"],["class","block","id","gameResult",4,"ngIf"],[3,"value"],["id","aiZeroDepthSelect",3,"ngModel","ngModelChange","change"],["selected","","value","0"],r,i,["id","scoreOne",1,"block"],s,["id","aiOneDepthSelect",3,"ngModel","ngModelChange","change"],o,a,["id","scoreZero",1,"block"],l,["id","gameResult",1,"block"],[4,"ngIf"],["id","draw",4,"ngIf"],c,["id","draw"],u,[1,"tile","is-child","box","is-vcentered"],["id","passButton","class","button is-primary is-fullwidth mb-1",3,"click",4,"ngIf"],["id","takeBack","class","button is-fullwidth mb-1",3,"click",4,"ngIf"],["id","restartButton",1,"button","is-fullwidth",3,"click"],h,[4,"ngFor","ngForOf"],["id","passButton",1,"button","is-primary","is-fullwidth","mb-1",3,"click"],d,["id","takeBack",1,"button","is-fullwidth","mb-1",3,"click"],p]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),la(2,die,24,10,"div",2),la(3,yie,6,3,"div",3),fa(),pa(4,"div",4),pa(5,"div",5),ga(6,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(2),ha("ngIf",t.gameComponent),Ts(1),ha("ngIf",t.gameComponent),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[rp,Jd,Ane,Sg,xf,dg,Pg,kg,tp],encapsulation:2,changeDetection:0}),e})(),_ie=(()=>{class e{}return e.STEP_FINISHED=()=>$localize`Step finished!`,e.INFORMATIONAL_STEP=()=>$localize`This step is not expecting any move from your part.`,e})();function Cie(e,t){if(1&e&&(pa(0,"div",20),pa(1,"div",21),sc(2,22),fa(),pa(3,"div",23),Qa(4),fa(),fa()),2&e){const e=Sa();Ts(4),Xa(e.currentReason.get())}}function Eie(e,t){if(1&e){const e=va();pa(0,"button",24),Ea("click",function(){return Gt(e),Sa().retry()}),sc(1,25),fa()}}function wie(e,t){1&e&&(ma(0),sc(1,30),ya())}function bie(e,t){1&e&&(ma(0),sc(1,31),ya())}function Sie(e,t){if(1&e&&la(0,bie,2,0,"ng-container",27),2&e){Sa();const e=ca(5),t=Sa();ha("ngIf",t.stepFinished&&t.stepFinished[t.stepIndex])("ngIfElse",e)}}function Pie(e,t){1&e&&(ma(0),sc(1,32),ya())}function Oie(e,t){if(1&e){const e=va();pa(0,"button",26),Ea("click",function(){return Gt(e),Sa().next()}),la(1,wie,2,0,"ng-container",27),la(2,Sie,1,2,"ng-template",null,28,Ku),la(4,Pie,2,0,"ng-template",null,29,Ku),fa()}if(2&e){const e=ca(3),t=Sa();Ts(1),ha("ngIf",t.steps[t.stepIndex]&&t.steps[t.stepIndex].isInformation())("ngIfElse",e)}}function Tie(e,t){if(1&e){const e=va();pa(0,"button",33),Ea("click",function(){return Gt(e),Sa().start()}),sc(1,34),fa()}}function Iie(e,t){if(1&e){const e=va();pa(0,"button",35),Ea("click",function(){return Gt(e),Sa().playLocally()}),sc(1,36),fa()}}function kie(e,t){if(1&e){const e=va();pa(0,"button",37),Ea("click",function(){return Gt(e),Sa().createGame()}),sc(1,38),fa()}}function Aie(e,t){if(1&e){const e=va();pa(0,"button",39),Ea("click",function(){return Gt(e),Sa().showSolution()}),sc(1,40),fa()}}function Mie(e,t){if(1&e&&(ma(0),pa(1,"option",42),Qa(2),fa(),ya()),2&e){const e=Sa(),t=e.index,n=e.$implicit;Ts(1),Ta("id","step_",t,""),ha("value",t),Ts(1),Xa(n.title)}}function Nie(e,t){1&e&&(ma(0),Qa(1,"v "),ya())}function Rie(e,t){1&e&&Qa(0,"x ")}function xie(e,t){if(1&e&&(pa(0,"option",43),la(1,Nie,2,0,"ng-container",27),la(2,Rie,1,0,"ng-template",null,44,Ku),pa(4,"span",45),Qa(5),fa(),fa()),2&e){const e=ca(3),t=Sa(),n=t.index,r=t.$implicit,i=Sa();ha("value",n),Ts(1),ha("ngIf",i.stepFinished[n])("ngIfElse",e),Ts(3),Ta("id","step_",n,""),Ts(1),Xa(r.title)}}function Die(e,t){if(1&e&&(ma(0),la(1,Mie,3,3,"ng-container",27),la(2,xie,6,5,"ng-template",null,41,Ku),ya()),2&e){const e=t.index,n=ca(3),r=Sa();Ts(1),ha("ngIf",e===r.stepIndex)("ngIfElse",n)}}let Lie=(()=>{class e extends Nne{constructor(t,n,r,i,s,o){super(t,n,o,r,i),this.cdr=s,this.connectedUserService=o,this.COMPLETED_TUTORIAL_MESSAGE=$localize`Congratulations, you completed the tutorial.`,this.steps=[],this.successfulSteps=0,this.stepIndex=-1,this.currentMessage="",this.currentReason=Mw.empty(),this.moveAttemptMade=!1,this.stepFinished=[],this.tutorialOver=!1,Tw(e.VERBOSE,"TutorialGameWrapperComponent.constructor")}getNumberOfSteps(){return this.steps.length}getCurrentStepTitle(){return this.steps.length>0?this.steps[this.stepIndex].title:""}ngAfterViewInit(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"TutorialGameWrapperComponent.ngAfterViewInit"),(yield t.afterGameIncluderViewInit())&&t.start()})()}start(){this.startTutorial(this.gameComponent.tutorial)}startTutorial(t){Tw(e.VERBOSE,{tutorialGameWrapperComponent_startTutorial:{tutorial:t}}),this.steps=t,this.tutorialOver=!1,this.stepFinished=this.getCompletionArray(),this.successfulSteps=0,this.showStep(0)}getCompletionArray(){return this.steps.map(()=>!1)}changeStep(e){this.showStep(Number.parseInt(e.target.value,10))}showStep(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.showStep("+t+")"),this.moveAttemptMade=!1,this.stepFinished[t]=!1,this.updateSuccessCount(),this.stepIndex=t;const n=this.steps[this.stepIndex];this.currentMessage=n.instruction,this.currentReason=Mw.empty(),this.gameComponent.rules.node=new bJ(n.state,Mw.empty(),n.previousMove),this.gameComponent.updateBoard(),this.cdr.detectChanges()}onLegalUserMove(t){var n=this;return Pw(function*(){Tw(e.VERBOSE,{tutorialGameWrapper_onLegalUserMove:{move:t}});const r=n.steps[n.stepIndex];if(NW(n.gameComponent.rules.choose(t),"It should be impossible to call onLegalUserMove with an illegal move"),Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: legal move"),n.gameComponent.updateBoard(),n.moveAttemptMade=!0,r.isPredicate()){const e=n.gameComponent.rules.node.gameState,i=Ow.getNonNullable(r.predicate)(t,e);i.isSuccess()?n.showStepSuccess(r.getSuccessMessage()):n.currentReason=Mw.of(i.getReason())}else if(r.isAnyMove())Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(r.getSuccessMessage());else{NW(r.isMove(),"cannot reach here with a click step");const i=r;i.acceptedMoves.some(e=>e.equals(t))?(Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: awaited move!"),n.showStepSuccess(i.getSuccessMessage())):(Tw(e.VERBOSE,"tutorialGameWrapper.onLegalUserMove: not the move that was awaited."),n.currentReason=Mw.of(i.getFailureMessage()))}n.cdr.detectChanges()})()}retry(){Tw(e.VERBOSE,"tutorialGameWrapper.retry"),this.moveAttemptMade=!1,this.showStep(this.stepIndex)}onUserClick(t){if(Tw(e.VERBOSE,"tutorialGameWrapper.onUserClick("+t+")"),this.currentReason=Mw.empty(),this.stepFinished[this.stepIndex]||this.moveAttemptMade)return TW.failure(_ie.STEP_FINISHED());const n=this.steps[this.stepIndex];return n.isClick()?(this.gameComponent.updateBoard(),this.moveAttemptMade=!0,Ow.getNonNullable(n.acceptedClicks).some(e=>e===t)?this.showStepSuccess(n.getSuccessMessage()):this.currentMessage=n.getFailureMessage(),TW.SUCCESS):n.isMove()||n.isPredicate()||n.isAnyMove()?(window.setTimeout(()=>{this.cdr.detectChanges()},10),TW.SUCCESS):TW.failure(_ie.INFORMATIONAL_STEP())}onCancelMove(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.onCancelMove("+t+")"),void 0!==t&&(this.currentReason=Mw.of(t)),this.cdr.detectChanges()}showStepSuccess(t){Tw(e.VERBOSE,"tutorialGameWrapperComponent.showStepSuccess()"),this.currentMessage=t,this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()}updateSuccessCount(){let e=0;for(const t of this.stepFinished)t&&e++;this.successfulSteps=e}next(){if(this.steps[this.stepIndex].isInformation()&&(this.stepFinished[this.stepIndex]=!0,this.updateSuccessCount()),this.stepFinished.length===this.successfulSteps)this.currentMessage=this.COMPLETED_TUTORIAL_MESSAGE,this.tutorialOver=!0;else{let e=(this.stepIndex+1)%this.steps.length;for(;!0===this.stepFinished[e];)e=(e+1)%this.steps.length;this.showStep(e)}}showSolution(){var t=this;return Pw(function*(){Tw(e.VERBOSE,"tutorialGameWrapper.showSolution()");const n=t.steps[t.stepIndex];NW(n.hasSolution(),"step must have solution");const r=n,i=r.getSolution();i instanceof mJ?(t.showStep(t.stepIndex),t.gameComponent.rules.choose(i),t.gameComponent.updateBoard()):(t.showStep(t.stepIndex),window.document.querySelector(i).dispatchEvent(new Event("click"))),t.currentMessage=r.getSuccessMessage(),t.moveAttemptMade=!0,t.cdr.detectChanges()})()}playLocally(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/local",t])})()}createGame(){var e=this;return Pw(function*(){const t=Ow.getNonNullable(e.actRoute.snapshot.paramMap.get("compo"));yield e.router.navigate(["/play",t])})()}getPlayerName(){return""}}return e.VERBOSE=!1,e.\u0275fac=function(t){return new(t||e)(ua(_c),ua(qy),ua(f_),ua(AW),ua(Yc),ua(MK))},e.\u0275cmp=Je({type:e,selectors:[["app-tutorial-game-wrapper"]],features:[Go],decls:22,vars:15,consts:function(){let e,t,n,r,i,s,o,a,l;return e=$localize`Failure`,t=$localize`Try again`,n=$localize`Ok`,r=$localize`Continue`,i=$localize`Skip`,s=$localize`Try again`,o=$localize`Play locally`,a=$localize`Create an online game`,l=$localize`See solution`,[[1,"tile","is-ancestor"],[1,"tile","is-5","is-vertical","is-parent"],["id","infos",1,"tile","is-child","box"],[1,"progress","is-primary"],[1,"content","is-medium"],[1,"title"],["id","currentMessage",3,"innerHTML"],["class","message is-danger","role","alert",4,"ngIf"],[1,"block"],["id","retryButton","class","button mr-3",3,"click",4,"ngIf"],["id","nextButton","class","button is-primary mr-3 mb-1",3,"click",4,"ngIf"],["id","restartButton","class","button",3,"click",4,"ngIf"],["id","playLocallyButton","class","button",3,"click",4,"ngIf"],["id","playOnlineButton","class","button",3,"click",4,"ngIf"],["id","showSolutionButton","class","button",3,"click",4,"ngIf"],[1,"select"],["id","steps",3,"change"],[4,"ngFor","ngForOf"],[1,"tile","is-parent","is-7","is-vcentered",3,"ngClass"],["id","board",1,"tile","is-child","box"],["role","alert",1,"message","is-danger"],[1,"message-header"],e,["id","currentReason",1,"message-body"],["id","retryButton",1,"button","mr-3",3,"click"],t,["id","nextButton",1,"button","is-primary","mr-3","mb-1",3,"click"],[4,"ngIf","ngIfElse"],["notInfo",""],["notFinished",""],n,r,i,["id","restartButton",1,"button",3,"click"],s,["id","playLocallyButton",1,"button",3,"click"],o,["id","playOnlineButton",1,"button",3,"click"],a,["id","showSolutionButton",1,"button",3,"click"],l,["otherstep",""],["selected","",3,"id","value"],[3,"value"],["notdone",""],[3,"id"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),ga(3,"progress",3),pa(4,"div",4),pa(5,"p",5),Qa(6),fa(),ga(7,"p",6),fa(),la(8,Cie,5,1,"div",7),pa(9,"div",8),la(10,Eie,2,0,"button",9),la(11,Oie,6,2,"button",10),la(12,Tie,2,0,"button",11),la(13,Iie,2,0,"button",12),la(14,kie,2,0,"button",13),la(15,Aie,2,0,"button",14),pa(16,"div",15),pa(17,"select",16),Ea("change",function(e){return t.changeStep(e)}),la(18,Die,4,2,"ng-container",17),fa(),fa(),fa(),fa(),fa(),pa(19,"div",18),pa(20,"div",19),ga(21,"app-game-includer"),fa(),fa(),fa()),2&e&&(Ts(3),ra("value",t.successfulSteps)("max",t.getNumberOfSteps()),Ts(3),tl("",t.getCurrentStepTitle()," [",t.stepIndex+1,"/",t.getNumberOfSteps(),"]"),Ts(1),ha("innerHTML",t.currentMessage,vi),Ts(1),ha("ngIf",t.currentReason.isPresent()),Ts(2),ha("ngIf",!1===t.tutorialOver&&(t.stepFinished&&!0===t.stepFinished[t.stepIndex]||t.moveAttemptMade)),Ts(1),ha("ngIf",!1===t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.tutorialOver),Ts(1),ha("ngIf",t.moveAttemptMade&&!1===t.stepFinished[t.stepIndex]),Ts(3),ha("ngForOf",t.steps),Ts(1),ha("ngClass",t.getBoardHighlight()))},directives:[rp,tp,Jd,Ane,Pg,kg],encapsulation:2,changeDetection:0}),e})();function Fie(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),sc(2,37),fa(),pa(3,"div",38),Qa(4),fa(),fa()),2&e){const e=Sa();Ts(4),Xa(e.errorMessage)}}const Uie=function(){return["/login"]};let Bie=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.faEye=rQ,this.registrationForm=new sg({email:new ig,username:new ig,password:new ig})}registerWithEmail(){var e=this;return Pw(function*(){const t=e.registrationForm.value.username,n=e.registrationForm.value.email,r=e.registrationForm.value.password;if(null==t||null==n||null==r)e.errorMessage=$localize`There are missing fields in the registration form, please check that you filled in all fields.`;else{const i=yield e.authService.doRegister(t,n,r);if(i.isSuccess()){const t=yield e.authService.sendEmailVerification();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()}else e.errorMessage=i.getReason()}})()}registerWithGoogle(){var e=this;return Pw(function*(){const t=yield e.authService.doGoogleLogin();t.isSuccess()?yield e.router.navigate(["/verify-account"]):e.errorMessage=t.getReason()})()}getPasswordHelpClass(){const e=this.registrationForm.value.password;return null==e||""===e?"":e.length<6?"is-danger":"is-success"}canRegister(){const e=this.registrationForm.value.password??"";return!(""===(this.registrationForm.value.email??"")||""===(this.registrationForm.value.username??"")||""===e||e.length<6)}}return e.\u0275fac=function(t){return new(t||e)(ua(MK),ua(f_))},e.\u0275cmp=Je({type:e,selectors:[["app-register"]],decls:56,vars:7,consts:function(){let e,t,n,r,i,s,o,a,l,c,u,h,d,p;return e=$localize`Registering`,t=$localize`Email`,n=$localize`Email`,r=$localize`A confirmation email will be sent to validate your account.`,i=$localize`Username`,s=$localize`Username`,o=$localize`Password`,a=$localize`Password`,l=$localize`The password should be at least 6 characters long`,c=$localize`Register`,u=$localize`Register with Google`,h=$localize`Have an account?`,d=$localize`Log in`,p=$localize`Registration error`,[[1,"box"],[1,"title"],e,[3,"formGroup"],[1,"field","is-horizontal"],[1,"field-label"],["for","email",1,"label"],t,[1,"field-body"],[1,"field"],[1,"control"],["id","email","formControlName","email","name","email","placeholder",n,"type","email","autofocus","","required","",1,"input"],[1,"help"],r,["for","username",1,"label"],i,["id","username","formControlName","username","name","username","placeholder",s,"type","text","required","",1,"input"],["for","password",1,"label"],o,[1,"control","has-icons-right","is-expanded"],["id","password","formControlName","password","name","password","placeholder",a,"type","password","required","",1,"input"],[1,"icon","is-small","is-right"],["toggleVisibility","",1,"clickable-icon",3,"icon"],["id","passwordHelp",1,"help",3,"ngClass"],l,["id","registerButton",1,"button","is-primary","is-fullwidth",3,"disabled","click"],c,[1,"field-body","is-fullwidth"],["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","googleButton","type","submit",1,"button","is-fullwidth",3,"click"],u,[1,"help","level-right"],h,[3,"routerLink"],d,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],p,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"form",3),pa(4,"div",4),pa(5,"div",5),pa(6,"label",6),sc(7,7),fa(),fa(),pa(8,"div",8),pa(9,"div",9),pa(10,"div",10),ga(11,"input",11),pa(12,"p",12),sc(13,13),fa(),fa(),fa(),fa(),fa(),pa(14,"div",4),pa(15,"div",5),pa(16,"label",14),sc(17,15),fa(),fa(),pa(18,"div",8),pa(19,"div",9),pa(20,"div",10),ga(21,"input",16),fa(),fa(),fa(),fa(),pa(22,"div",4),pa(23,"div",5),pa(24,"label",17),sc(25,18),fa(),fa(),pa(26,"div",8),pa(27,"div",9),pa(28,"div",19),ga(29,"input",20),pa(30,"span",21),ga(31,"fa-icon",22),fa(),pa(32,"p",23),sc(33,24),fa(),fa(),fa(),fa(),fa(),pa(34,"div",4),ga(35,"div",5),pa(36,"div",8),pa(37,"div",9),pa(38,"div",10),pa(39,"button",25),Ea("click",function(){return t.registerWithEmail()}),sc(40,26),fa(),fa(),fa(),fa(),fa(),pa(41,"div",4),ga(42,"div",5),pa(43,"div",27),la(44,Fie,5,1,"div",28),fa(),fa(),pa(45,"div",4),ga(46,"div",5),pa(47,"div",8),pa(48,"button",29),Ea("click",function(){return t.registerWithGoogle()}),sc(49,30),fa(),fa(),fa(),pa(50,"p",31),ma(51),sc(52,32),ya(),Qa(53,"\xa0 "),pa(54,"a",33),sc(55,34),fa(),fa(),fa(),fa()),2&e&&(Ts(3),ha("formGroup",t.registrationForm),Ts(28),ha("icon",t.faEye),Ts(1),ha("ngClass",t.getPasswordHelpClass()),Ts(7),ha("disabled",!t.canRegister()),Ts(5),ha("ngIf",t.errorMessage),Ts(10),ha("routerLink",wu(6,Uie)))},directives:[pg,Df,_g,rf,xf,Eg,tne,Mg,MX,nne,Jd,rp,y_],encapsulation:2}),e})(),Vie=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}playLocally(){var e=this;return Pw(function*(){yield e.router.navigate(["local/"+e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Je({type:e,selectors:[["app-local-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Play offline`,[[3,"pickGame"],["id","playLocally",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.playLocally()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[Kte],encapsulation:2}),e})(),$ie=(()=>{class e{constructor(e){this.router=e}pickGame(e){this.selectedGame=e}launchTutorial(){var e=this;return Pw(function*(){yield e.router.navigate(["/tutorial/",e.selectedGame])})()}}return e.\u0275fac=function(t){return new(t||e)(ua(f_))},e.\u0275cmp=Je({type:e,selectors:[["app-tutorial-game-creation"]],decls:3,vars:1,consts:function(){let e;return e=$localize`Learn the rules`,[[3,"pickGame"],["id","launchTutorial",1,"button","is-primary","is-fullwidth",3,"disabled","click"],e]},template:function(e,t){1&e&&(pa(0,"app-pick-game",0),Ea("pickGame",function(e){return t.pickGame(e)}),fa(),pa(1,"button",1),Ea("click",function(){return t.launchTutorial()}),sc(2,2),fa()),2&e&&(Ts(1),ha("disabled",!t.selectedGame))},directives:[Kte],encapsulation:2}),e})(),zie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Je({type:e,selectors:[["app-next-game-loading"]],decls:2,vars:0,consts:function(){let e;return e=$localize`The replay game is loading, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),sc(1,0),fa())},encapsulation:2}),e})();function Hie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessQueenComponent.HEPTAGON)}}function Gie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessQueenComponent.EIGHT_POINTED_STAR)}}function Wie(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function qie(e,t){if(1&e&&(ma(0),Cn(),ga(1,"circle",6),ga(2,"circle",6),ga(3,"circle",6),ya()),2&e){const e=Sa();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(3)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(2)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(1))}}function jie(e,t){if(1&e&&(Cn(),pa(0,"g"),ga(1,"circle",7),ga(2,"circle",7),ga(3,"circle",7),fa()),2&e){const e=Sa();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.45*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.45*e.MartianChessComponent.SPACE_SIZE)("cy",.55*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.55*e.MartianChessComponent.SPACE_SIZE)("cy",.55*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function Zie(e,t){if(1&e&&(Cn(),pa(0,"g",8),ga(1,"circle",9),ga(2,"circle",9),ga(3,"circle",9),fa()),2&e){const e=Sa();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE-3*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE+3*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}class Yie{constructor(){this.MartianChessQueenComponent=Yie,this.MartianChessComponent=z6,this.horizontalDotsRadius=z6.SPACE_SIZE/15}}function Kie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessDroneComponent.PENTAGON)}}function Qie(e,t){if(1&e&&(Cn(),ga(0,"polygon",4)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessDroneComponent.FOUR_POINTED_STAR_VERTICAL)}}function Xie(e,t){if(1&e&&(Cn(),ga(0,"circle",5)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function Jie(e,t){if(1&e&&(ma(0),Cn(),ga(1,"circle",6),ga(2,"circle",6),ya()),2&e){const e=Sa();Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(2)),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",e.MartianChessComponent.getRadius(1))}}function ese(e,t){if(1&e&&(Cn(),pa(0,"g",7),ga(1,"circle",8),ga(2,"circle",8),fa()),2&e){const e=Sa();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.4*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE),Ts(1),ra("cx",.6*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function tse(e,t){if(1&e&&(Cn(),pa(0,"g",7),ga(1,"circle",9),ga(2,"circle",9),fa()),2&e){const e=Sa();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE-2*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE+2*e.horizontalDotsRadius)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}Yie.HEPTAGON=z6.getRegularPolygon(7),Yie.EIGHT_POINTED_STAR=z6.getNPointedStar(8,0),Yie.\u0275fac=function(e){return new(e||Yie)},Yie.\u0275cmp=Je({type:Yie,selectors:[["","app-martian-chess-queen",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-queen",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,Hie,1,3,"polygon",0),la(1,Gie,1,3,"polygon",0),la(2,Wie,1,5,"circle",1),la(3,qie,4,9,"ng-container",2),la(4,jie,4,9,"g",2),la(5,Zie,4,10,"g",3)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class nse{constructor(){this.MartianChessComponent=z6,this.MartianChessDroneComponent=nse,this.horizontalDotsRadius=z6.SPACE_SIZE/15}}function rse(e,t){if(1&e&&(Cn(),ga(0,"polygon",5)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessPawnComponent.TRIANGLE)}}function ise(e,t){if(1&e&&(Cn(),ga(0,"polygon",5)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("points",e.MartianChessPawnComponent.FOUR_POINTED_STAR_DIAGONAL)}}function sse(e,t){if(1&e&&(Cn(),ga(0,"circle",6)),2&e){const e=Sa();ha("id",e.mainShapeId)("ngClass",e.pieceClasses),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.5*e.MartianChessComponent.SPACE_SIZE-e.MartianChessComponent.STROKE_WIDTH)}}function ose(e,t){if(1&e&&(Cn(),ga(0,"circle",7)),2&e){const e=Sa();ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE+e.getConcreteTriangleYOffset())("r",e.MartianChessComponent.getRadius(1))}}function ase(e,t){if(1&e&&(Cn(),ga(0,"circle",8)),2&e){const e=Sa();ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",.2/3*e.MartianChessComponent.SPACE_SIZE)}}function lse(e,t){if(1&e&&(Cn(),pa(0,"g",9),ga(1,"circle",10),fa()),2&e){const e=Sa();ha("ngClass",e.pieceClasses),Ts(1),ra("cx",.5*e.MartianChessComponent.SPACE_SIZE)("cy",.5*e.MartianChessComponent.SPACE_SIZE)("r",1.5*e.horizontalDotsRadius)}}nse.FOUR_POINTED_STAR_VERTICAL=z6.getNPointedStar(4,0),nse.PENTAGON=z6.getRegularPolygon(5),nse.\u0275fac=function(e){return new(e||nse)},nse.\u0275cmp=Je({type:nse,selectors:[["","app-martian-chess-drone",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-drone",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[3,"ngClass"],[1,"base","mid-stroke"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,Kie,1,3,"polygon",0),la(1,Qie,1,3,"polygon",0),la(2,Xie,1,5,"circle",1),la(3,Jie,3,6,"ng-container",2),la(4,ese,3,7,"g",3),la(5,tse,3,7,"g",3)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});class cse{constructor(){this.MartianChessComponent=z6,this.MartianChessPawnComponent=cse,this.horizontalDotsRadius=z6.SPACE_SIZE/15}static getTriangle(){return z6.getRegularPolygon(3,cse.TRIANGLE_Y_OFFSET)}static yOffsetForVerticalCentering(){const e=z6.getRegularPolygonCoords(3).map(e=>e.y);return(e.reduce((e,t)=>Math.min(e,t))+(100-e.reduce((e,t)=>Math.max(e,t))))/4}getConcreteTriangleYOffset(){return"Polygon"===this.style.shape?cse.TRIANGLE_Y_OFFSET:0}}cse.FOUR_POINTED_STAR_DIAGONAL=z6.getNPointedStar(4,45),cse.TRIANGLE_Y_OFFSET=cse.yOffsetForVerticalCentering(),cse.TRIANGLE=cse.getTriangle(),cse.\u0275fac=function(e){return new(e||cse)},cse.\u0275cmp=Je({type:cse,selectors:[["","app-martian-chess-pawn",""]],inputs:{mainShapeId:"mainShapeId",pieceClasses:"pieceClasses",style:"style"},attrs:["app-martian-chess-pawn",""],decls:6,vars:6,consts:[["class","base","stroke-linecap","round",3,"id","ngClass",4,"ngIf"],["class","base",3,"id","ngClass",4,"ngIf"],["class","base no-fill mid-stroke",4,"ngIf"],["class","base mid-stroke",4,"ngIf"],[3,"ngClass",4,"ngIf"],["stroke-linecap","round",1,"base",3,"id","ngClass"],[1,"base",3,"id","ngClass"],[1,"base","no-fill","mid-stroke"],[1,"base","mid-stroke"],[3,"ngClass"],[1,"base-no-stroke"]],template:function(e,t){1&e&&(la(0,rse,1,3,"polygon",0),la(1,ise,1,3,"polygon",0),la(2,sse,1,5,"circle",1),la(3,ose,1,3,"circle",2),la(4,ase,1,3,"circle",3),la(5,lse,2,4,"g",4)),2&e&&(ha("ngIf","Polygon"===t.style.shape),Ts(1),ha("ngIf","Star"===t.style.shape),Ts(1),ha("ngIf","Circle"===t.style.shape),Ts(1),ha("ngIf","Concentric Circles"===t.style.points),Ts(1),ha("ngIf","Dots"===t.style.points),Ts(1),ha("ngIf","Horizontal Points"===t.style.points))},directives:[rp,Jd],styles:[".base[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8;fill:var(--spaces-fill);stroke-linecap:butt;stroke-linejoin:round}.base-no-stroke[_ngcontent-%COMP%]{stroke:none;fill:var(--base-stroke)}.base-no-fill[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:8}.arrow[_ngcontent-%COMP%]{stroke:var(--base-stroke);stroke-width:3}.text[_ngcontent-%COMP%]{fill:var(--base-stroke)}.white-background[_ngcontent-%COMP%]{fill:#fff}.white-stroke[_ngcontent-%COMP%]{stroke:#fff}.background[_ngcontent-%COMP%]{fill:var(--spaces-fill)}.transparent[_ngcontent-%COMP%]{opacity:0}.background2[_ngcontent-%COMP%]{fill:var(--alt-background-fill)}.background3[_ngcontent-%COMP%]{fill:var(--alt-alt-background-fill)}.player0[_ngcontent-%COMP%]{fill:var(--player0)}.player0-alternate[_ngcontent-%COMP%]{fill:var(--player0-alternate)}.player0-stroke[_ngcontent-%COMP%]{stroke:var(--player0)}.player1[_ngcontent-%COMP%]{fill:var(--player1)}.player1-alternate[_ngcontent-%COMP%]{fill:var(--player1-alternate)}.player1-stroke[_ngcontent-%COMP%]{stroke:var(--player1)}.other-piece[_ngcontent-%COMP%]{fill:var(--nonplayer)}.other-piece-light[_ngcontent-%COMP%]{fill:var(--nonplayer-light)}.other-piece-stroke[_ngcontent-%COMP%]{stroke:var(--nonplayer)}.dashed-stroke[_ngcontent-%COMP%]{stroke-dasharray:2}.pre-captured[_ngcontent-%COMP%]{fill:var(--pre-captured)}.captured[_ngcontent-%COMP%]{fill:var(--captured)}.captured2[_ngcontent-%COMP%]{fill:var(--alt-captured)}.captured-stroke[_ngcontent-%COMP%]{stroke:var(--captured)}.moved[_ngcontent-%COMP%]{fill:var(--moved)}.moved-stroke[_ngcontent-%COMP%]{stroke:var(--moved)}.indicator[_ngcontent-%COMP%]{fill:var(--indicator);stroke:none}.highlighted[_ngcontent-%COMP%]{stroke:var(--selectable)}.highlighted[_ngcontent-%COMP%] > .base-no-stroke[_ngcontent-%COMP%]{fill:var(--selectable)}.last-move[_ngcontent-%COMP%]{stroke:var(--last-move)}.victory[_ngcontent-%COMP%]{fill:var(--victory)}.victory-stroke[_ngcontent-%COMP%]{stroke:var(--victory)}.selected[_ngcontent-%COMP%]{stroke:var(--selected)}.selected-fill[_ngcontent-%COMP%]{fill:var(--selected)}.clickable[_ngcontent-%COMP%]{stroke:var(--clickable)}.clickable-hover[_ngcontent-%COMP%]:hover{stroke:var(--clickable)}.capturable[_ngcontent-%COMP%]{stroke-width:2;stroke:var(--capturable)}.capturable[_ngcontent-%COMP%]:hover{stroke-width:8}.no-fill[_ngcontent-%COMP%]{fill:none}.no-stroke[_ngcontent-%COMP%]{stroke:none}.small-stroke[_ngcontent-%COMP%]{stroke-width:2}.mid-small-stroke[_ngcontent-%COMP%]{stroke-width:3}.mid-stroke[_ngcontent-%COMP%]{stroke-width:5}.normal-stroke[_ngcontent-%COMP%]{stroke-width:8}.semi-transparent[_ngcontent-%COMP%]{fill-opacity:.5;stroke-opacity:.5}.round[_ngcontent-%COMP%]{stroke-linecap:round}.text-big[_ngcontent-%COMP%]{font:50px sans-serif}.text-giant[_ngcontent-%COMP%]{font:3.7rem sans-serif;stroke-width:.37rem;dominant-baseline:central}.text-bold[_ngcontent-%COMP%]{font-weight:bold}.text-medium[_ngcontent-%COMP%]{font:35px sans-serif}.text-center[_ngcontent-%COMP%]{text-anchor:middle}.black-fill[_ngcontent-%COMP%]{fill:#000}svg[_ngcontent-%COMP%]{max-height:calc(100vh - 10rem)}"]});const use={production:!0,test:!1,root:"/",firebaseConfig:{apiKey:"AIzaSyAt5QHXLnm2Uf9X7VN6XPPiSaipoh3oRHo",authDomain:"firestore-c9d47.firebaseapp.com",databaseURL:"https://firestore-c9d47.firebaseio.com",projectId:"firestore-c9d47",storageBucket:"firestore-c9d47.appspot.com",messagingSenderId:"936588361631"},useEmulators:!1};let hse=(()=>{class e{constructor(e){this.authService=e}canActivate(){var e=this;return Pw(function*(){return new Promise(t=>{e.userSub=e.authService.getUserObs().subscribe(function(){var n=Pw(function*(n){yield e.evaluateUserPermission(n).then(t)});return function(e){return n.apply(this,arguments)}}())})})()}ngOnDestroy(){this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(Or(MK))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),dse=(()=>{class e extends hse{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!1!==e.verified||t.router.parseUrl("/verify-account")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MK),Or(f_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function pse(e,t){1&e&&(pa(0,"p",20),sc(1,21),fa())}function fse(e,t){if(1&e){const e=va();pa(0,"div",7),pa(1,"p",8),sc(2,9),fa(),pa(3,"div",10),pa(4,"p",11),sc(5,12),fa(),pa(6,"button",13),Ea("click",function(){return Gt(e),Sa().finalizeEmailVerification()}),sc(7,14),fa(),fa(),pa(8,"div",15),pa(9,"p",11),sc(10,16),fa(),pa(11,"button",17),Ea("click",function(){return Gt(e),Sa().sendEmailVerification()}),sc(12,18),fa(),fa(),la(13,pse,2,0,"p",19),fa()}if(2&e){const e=Sa();Ts(2),oc(e.emailAddress),ac(2),Ts(11),ha("ngIf",e.success)}}function gse(e,t){if(1&e){const e=va();pa(0,"div",24),pa(1,"div",8),sc(2,25),fa(),pa(3,"form",26),pa(4,"div",27),pa(5,"div",28),ga(6,"input",29),fa(),pa(7,"div",28),pa(8,"button",30),Ea("click",function(){Gt(e);const t=Sa(2);return t.pickUsername(t.usernameForm.value)}),sc(9,31),fa(),fa(),fa(),fa(),fa()}if(2&e){const e=Sa(2);Ts(3),ha("formGroup",e.usernameForm)}}const mse=function(){return["/lobby"]};function yse(e,t){1&e&&(pa(0,"div",32),rc(1,33),ga(2,"a",34),ic(),fa()),2&e&&(Ts(2),ha("routerLink",wu(1,mse)))}function vse(e,t){if(1&e&&(ma(0),la(1,gse,10,1,"div",22),la(2,yse,3,2,"div",23),ya()),2&e){const e=Sa();Ts(1),ha("ngIf",!e.success),Ts(1),ha("ngIf",e.success)}}function _se(e,t){if(1&e&&(pa(0,"div",35),pa(1,"div",36),Qa(2),fa(),fa()),2&e){const e=Sa();Ts(2),Xa(e.errorMessage)}}let Cse=(()=>{class e{constructor(e,t){this.authService=e,this.router=t,this.verificationType=null,this.success=!1,this.triedToFinalize=!1,this.usernameForm=new sg({username:new ig})}ngOnInit(){var e=this;return Pw(function*(){e.userSub=e.authService.getUserObs().subscribe(function(){var t=Pw(function*(t){e.emailAddress=t.email.get(),t.username.isAbsent()?e.verificationType="enter-username":(e.verificationType="send-email",!0===e.triedToFinalize&&!1===t.verified&&(e.errorMessage=$localize`You have not verified your email! Click on the link in the verification email.`),!0===t.verified&&(yield e.router.navigate(["/lobby"])))});return function(e){return t.apply(this,arguments)}}())})()}pickUsername(e){var t=this;return Pw(function*(){const n=yield t.authService.setUsername(e.username);n.isSuccess()?t.success=!0:t.errorMessage=n.getReason()})()}sendEmailVerification(){var e=this;return Pw(function*(){const t=yield e.authService.sendEmailVerification();t.isSuccess()?e.success=!0:e.errorMessage=t.getReason()})()}finalizeEmailVerification(){var e=this;return Pw(function*(){e.triedToFinalize=!0,yield e.authService.reloadUser(),window.open(window.location.href,"_self")})()}ngOnDestroy(){null!=this.userSub&&null!=this.userSub.unsubscribe&&this.userSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(ua(MK),ua(f_))},e.\u0275cmp=Je({type:e,selectors:[["app-verify-account"]],decls:7,vars:3,consts:function(){let e,t,n,r,i,s,o,a,l,c,u;return e=$localize`Account verification`,t=$localize`In order to finalize your account, you must click on the link that you should have received on your email address (${"\ufffd0\ufffd"}:INTERPOLATION:). The email could be in your spam folder.`,n=$localize`Once you have verified your email, click on the following button:`,r=$localize`Finalize email verification`,i=$localize`If you have not received the verification email, click on the following button:`,s=$localize`Send verification email again`,o=$localize`The email has been sent`,a=$localize`In order to finalize your account, you must choose a username.`,l=$localize`Username`,c=$localize`Pick username`,u=$localize`Your account has now been finalized, you can go back to the ${"\ufffd#2\ufffd"}:START_LINK:list of games${"\ufffd/#2\ufffd"}:CLOSE_LINK:.`,[[1,"box"],[1,"message","is-info"],[1,"message-header"],e,["class","message-body","id","verificationEmail",4,"ngIf"],[4,"ngIf"],["class","message is-danger",4,"ngIf"],["id","verificationEmail",1,"message-body"],[1,"block"],t,[1,"block","level-left"],[1,"level-item"],n,["id","finalizeVerification",1,"button","is-primary","level-item","is-small",3,"click"],r,[1,"level-left"],i,["id","sendEmail",1,"button","is-warning","level-item","is-small",3,"click"],s,["id","success","class","help is-success",4,"ngIf"],["id","success",1,"help","is-success"],o,["id","askUsername","class","message-body",4,"ngIf"],["id","success","class","message-body",4,"ngIf"],["id","askUsername",1,"message-body"],a,[3,"formGroup"],[1,"field","has-addons"],[1,"control"],["id","username","type","text","placeholder",l,"name","username","required","","formControlName","username",1,"input"],["id","pickUsername",1,"button","is-info",3,"click"],c,["id","success",1,"message-body"],u,[3,"routerLink"],[1,"message","is-danger"],["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"div",1),pa(2,"div",2),sc(3,3),fa(),la(4,fse,14,2,"div",4),la(5,vse,3,2,"ng-container",5),fa(),la(6,_se,3,1,"div",6),fa()),2&e&&(Ts(4),ha("ngIf","send-email"===t.verificationType),Ts(1),ha("ngIf","enter-username"===t.verificationType),Ts(1),ha("ngIf",t.errorMessage))},directives:[rp,pg,Df,_g,rf,Mg,xf,Eg,y_],encapsulation:2}),e})(),Ese=(()=>{class e extends hse{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()?t.router.parseUrl("/login"):!e.verified||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MK),Or(f_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),wse=(()=>{class e extends hse{constructor(e,t){super(e),this.router=t}evaluateUserPermission(e){var t=this;return Pw(function*(){return!1===e.isConnected()||t.router.parseUrl("/")})()}}return e.\u0275fac=function(t){return new(t||e)(Or(MK),Or(f_))},e.\u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function bse(e,t){1&e&&(pa(0,"p",12),sc(1,13),fa())}function Sse(e,t){if(1&e&&(pa(0,"div",14),pa(1,"div",15),sc(2,16),fa(),pa(3,"div",17),Qa(4),fa(),fa()),2&e){const e=Sa();Ts(4),Xa(e.errorMessage.get())}}const Pse=function(){return{standalone:!0}};let Ose=(()=>{class e{constructor(e){this.authService=e,this.success=!1,this.errorMessage=Mw.empty(),this.email=""}resetPassword(){var e=this;return Pw(function*(){NW(""!==e.email,"No email was entered, but it should not be possible to submit the form then!"),e.errorMessage=Mw.empty(),e.success=!1;const t=yield e.authService.sendPasswordResetEmail(e.email);t.isSuccess()?e.success=!0:e.errorMessage=Mw.of(t.getReason())})()}}return e.\u0275fac=function(t){return new(t||e)(ua(MK))},e.\u0275cmp=Je({type:e,selectors:[["app-reset-password"]],decls:12,vars:6,consts:function(){let e,t,n,r,i,s;return e=$localize`Password reset`,t=$localize`Email`,n=$localize`An email will be sent with instruction to reset your password.`,r=$localize`Reset password`,i=$localize`The email has been sent, please follow the instructions from that email.`,s=$localize`Error`,[[1,"box"],[1,"title"],e,[1,"field"],[1,"control"],["id","email","name","email","placeholder",t,"type","email","autofocus","","required","",1,"input",3,"ngModel","ngModelOptions","ngModelChange"],[1,"help"],n,["id","successMessage","class","help is-success",4,"ngIf"],["id","resetPasswordButton",1,"button","is-primary","is-fullwidth","block",3,"disabled","click"],r,["class","message is-danger is-fullwidth","role","alert",4,"ngIf"],["id","successMessage",1,"help","is-success"],i,["role","alert",1,"message","is-danger","is-fullwidth"],[1,"message-header"],s,["id","errorMessage",1,"message-body"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"div",3),pa(4,"div",4),pa(5,"input",5),Ea("ngModelChange",function(e){return t.email=e}),fa(),pa(6,"p",6),sc(7,7),fa(),la(8,bse,2,0,"p",8),fa(),fa(),pa(9,"button",9),Ea("click",function(){return t.resetPassword()}),sc(10,10),fa(),la(11,Sse,5,1,"div",11),fa()),2&e&&(Ts(5),ha("ngModel",t.email)("ngModelOptions",wu(5,Pse)),Ts(3),ha("ngIf",t.success),Ts(1),ha("disabled",""===t.email),Ts(2),ha("ngIf",t.errorMessage.isPresent()))},directives:[rf,tne,Mg,xf,dg,rp],encapsulation:2}),e})();function Tse(e,t){if(1&e&&(pa(0,"option",13),Qa(1),fa()),2&e){const e=t.$implicit,n=Sa();ha("value",e.value)("selected",e.value===n.currentTheme),Ts(1),Ja(" ",e.name," ")}}function Ise(e,t){if(1&e&&(pa(0,"option",13),Qa(1),fa()),2&e){const e=t.$implicit,n=Sa();ha("value",e.value)("selected",e.value===n.currentLanguage),Ts(1),Ja(" ",e.name," ")}}let kse=(()=>{class e{constructor(e,t){this.userSettingsService=e,this.availableLanguages=[{value:"fr",name:"Fran\xe7ais"},{value:"en",name:"English"}],this.availableThemes=[{value:"light",name:$localize`Light`},{value:"dark",name:$localize`Dark`}],this.currentTheme=t.getTheme(),this.currentLanguage=this.userSettingsService.getLanguage()}changeLanguage(e){this.userSettingsService.changeLanguage(e.target.value),this.reload()}changeTheme(e){this.userSettingsService.changeTheme(e.target.value),this.reload()}reload(){window.open(window.location.href,"_self")}}return e.\u0275fac=function(t){return new(t||e)(ua(XK),ua(JK))},e.\u0275cmp=Je({type:e,selectors:[["app-settings"]],decls:17,vars:2,consts:function(){let e,t,n;return e=$localize`User settings`,t=$localize`Theme`,n=$localize`Language`,[[1,"box"],[1,"title"],e,[1,"field"],["for","theme",1,"label"],t,[1,"control"],[1,"select"],["id","theme",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["for","language",1,"label"],n,["id","language",3,"change"],[3,"value","selected"]]},template:function(e,t){1&e&&(pa(0,"div",0),pa(1,"p",1),sc(2,2),fa(),pa(3,"div",3),pa(4,"label",4),sc(5,5),fa(),pa(6,"div",6),pa(7,"div",7),pa(8,"select",8),Ea("change",function(e){return t.changeTheme(e)}),la(9,Tse,2,3,"option",9),fa(),fa(),fa(),fa(),pa(10,"div",3),pa(11,"label",10),sc(12,11),fa(),pa(13,"div",6),pa(14,"div",7),pa(15,"select",12),Ea("change",function(e){return t.changeLanguage(e)}),la(16,Ise,2,3,"option",9),fa(),fa(),fa(),fa(),fa()),2&e&&(Ts(9),ha("ngForOf",t.availableThemes),Ts(7),ha("ngForOf",t.availableLanguages))},directives:[tp,Pg,kg],encapsulation:2}),e})(),Ase=(()=>{class e{}return e.ALREADY_INGAME=()=>$localize`You are already in a game. Finish it or cancel it first.`,e})(),Mse=(()=>{class e{constructor(e,t,n,r,i,s){this.route=e,this.router=t,this.connectedUserService=n,this.messageDisplayer=r,this.partDAO=i,this.gameService=s}ngOnInit(){var e=this;return Pw(function*(){yield e.createGameAndRedirectOrShowError(e.extractGameFromURL())})()}extractGameFromURL(){return Ow.getNonNullable(this.route.snapshot.paramMap.get("compo"))}createGameAndRedirectOrShowError(e){var t=this;return Pw(function*(){const n=t.connectedUserService.user.get();NW(n.isConnected(),"User must be connected and have a username to reach this page");const r=n.toMinimalUser();if(!1===t.gameExists(e))return yield t.router.navigate(["/notFound",Mne.NO_MATCHING_GAME(e)],{skipLocationChange:!0}),!1;if(yield t.canCreateOnlineGame(r.name)){const n=yield t.gameService.createPartJoinerAndChat(r,e);return yield t.router.navigate(["/play",e,n]),!0}return t.messageDisplayer.infoMessage(Ase.ALREADY_INGAME()),yield t.router.navigate(["/lobby"]),!1})()}gameExists(e){return Mw.ofNullable(Yte.ALL_GAMES().find(t=>t.urlName===e)).isPresent()}canCreateOnlineGame(e){var t=this;return Pw(function*(){return!1===(yield t.partDAO.userHasActivePart(e))})()}}return e.\u0275fac=function(t){return new(t||e)(ua(qy),ua(f_),ua(MK),ua(AW),ua(DW),ua(jK))},e.\u0275cmp=Je({type:e,selectors:[["app-online-game-creation"]],decls:2,vars:0,consts:function(){let e;return e=$localize`Creating online game, please wait, it should not take long.`,[e]},template:function(e,t){1&e&&(pa(0,"p"),sc(1,0),fa())},encapsulation:2}),e})();!function(e,t,n){!function(e,t,n){"string"!=typeof t&&(n=t,t=e[cl.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),sl[t]=e,n&&(sl[t][cl.ExtraData]=n)}(e,void 0,void 0)}(bw());const Nse=[{path:"login",component:one},{path:"lobby",component:Tne,canActivate:[dse]},{path:"settings",component:kse},{path:"register",component:Bie,canActivate:[wse]},{path:"reset-password",component:Ose,canActivate:[wse]},{path:"notFound/:message",component:Ine},{path:"nextGameLoading",component:zie,canActivate:[dse]},{path:"verify-account",component:Cse,canActivate:[Ese]},{path:"play",component:lne,canActivate:[dse]},{path:"play/:compo",component:Mse,canActivate:[dse]},{path:"play/:compo/:id",component:Jre,canActivate:[dse]},{path:"local",component:Vie},{path:"local/:compo",component:vie},{path:"tutorial",component:$ie},{path:"tutorial/:compo",component:Lie},{path:"",component:ene},{path:"**",component:Ine}];class Rse{static app(){return function(e,...t){return{ngModule:PI,providers:[{provide:EI,useFactory:SI(e),multi:!0,deps:[vh,zo,dI,...t]}]}}(()=>(use.useEmulators&&(use.firebaseConfig.databaseURL="http://localhost:9000?ns=default"),OI(use.firebaseConfig)))}static firestore(){return function(e,...t){return{ngModule:aW,providers:[{provide:rW,useFactory:iW(e),multi:!0,deps:[vh,zo,dI,CI,[new Nr,AN],[new Nr,sk],...t]}]}}(()=>{const e=gW(),t=e.toJSON().settings.host;return use.useEmulators&&"localhost:8080"!==t&&uW(e,"localhost",8080),e})}static database(){return function(e,...t){return{ngModule:wK,providers:[{provide:vK,useFactory:_K(e),multi:!0,deps:[vh,zo,dI,CI,[new Nr,AN],[new Nr,sk],...t]}]}}(()=>{const e=SK();return use.useEmulators&&!1===e._instanceStarted&&bK(e,"localhost",9e3),e})}static auth(){return function(e,...t){return{ngModule:DN,providers:[{provide:MN,useFactory:NN(e),multi:!0,deps:[vh,zo,dI,CI,[new Nr,sk],...t]}]}}(()=>{const e=UN();return use.useEmulators&&null==e.config.emulator&&LN(e,"http://localhost:9099",{disableWarnings:!0}),e})}}let xse=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=rt({type:e,bootstrap:[qX]}),e.\u0275inj=Se({providers:[MK,jK,qK,zW,UW,DW,JK,{provide:oh,useValue:QK.getLocale()}],imports:[[Rse.app(),Rse.firestore(),Rse.auth(),Rse.database(),Hp,Cm,k_.forRoot(Nse,{useHash:!1}),Lg,Dg,Ew,NX]]}),e})();!function(e,t,n){const r=e.\u0275cmp;r.directiveDefs=()=>t.map(et),r.pipeDefs=()=>n.map(tt)}(z6,[tp,Jd,rp,cse,nse,Yie],[]);"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self;"undefined"!=typeof global&&global;class Dse{constructor(e){this.digits=e}static zero(){return new Dse([0])}static one(){return new Dse([1])}clone(){return new Dse(this.digits.slice())}add(e){const t=this.clone();return t.addToSelf(e),t}addToSelf(e){const t=Math.max(this.digits.length,e.digits.length);let n=0;for(let r=0;r<t;r++){let t=n;r<this.digits.length&&(t+=this.digits[r]),r<e.digits.length&&(t+=e.digits[r]),t>=10?(this.digits[r]=t-10,n=1):(this.digits[r]=t,n=0)}n>0&&(this.digits[t]=1)}toString(){let e="";for(let t=this.digits.length-1;t>=0;t--)e+=this.digits[t];return e}}class Lse{constructor(e){this.powerOfTwos=[e]}getValue(){return this.powerOfTwos[0]}multiplyBy(e){const t=Dse.zero();return this.multiplyByAndAddTo(e,t),t}multiplyByAndAddTo(e,t){for(let n=0;0!==e;e>>>=1,n++)if(1&e){const e=this.getMultipliedByPowerOfTwo(n);t.addToSelf(e)}}getMultipliedByPowerOfTwo(e){for(let t=this.powerOfTwos.length;t<=e;t++){const e=this.powerOfTwos[t-1];this.powerOfTwos[t]=e.add(e)}return this.powerOfTwos[e]}}class Fse{constructor(e){this.base=e,this.exponents=[new Lse(Dse.one())]}toThePowerOf(e){for(let t=this.exponents.length;t<=e;t++){const e=this.exponents[t-1].multiplyBy(this.base);this.exponents[t]=new Lse(e)}return this.exponents[e]}}function Use(e){const t=function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&e.length>n+1){const t=e.charCodeAt(n+1);t>=56320&&t<=57343&&(n++,r=(r-55296<<10)+t-56320+65536)}r<=127?t.push(r):r<=2047?t.push(r>>6&31|192,63&r|128):r<=65535?t.push(r>>12|224,r>>6&63|128,63&r|128):r<=2097151&&t.push(r>>18&7|240,r>>12&63|128,r>>6&63|128,63&r|128)}return t}(e);let n=Bse(t,0),r=Bse(t,102072);return 0==n&&(0==r||1==r)&&(n^=319790063,r^=-1801410264),[n,r]}function Bse(e,t){let n,r=2654435769,i=2654435769;const s=e.length;for(n=0;n+12<=s;n+=12){r=zse(r,qse(e,n,$se.Little)),i=zse(i,qse(e,n+4,$se.Little));const s=Vse(r,i,t=zse(t,qse(e,n+8,$se.Little)));r=s[0],i=s[1],t=s[2]}return r=zse(r,qse(e,n,$se.Little)),i=zse(i,qse(e,n+4,$se.Little)),t=zse(t,s),Vse(r,i,t=zse(t,qse(e,n+8,$se.Little)<<8))[2]}function Vse(e,t,n){return e=Gse(e,t),e=Gse(e,n),e^=n>>>13,t=Gse(t,n),t=Gse(t,e),t^=e<<8,n=Gse(n,e),n=Gse(n,t),n^=t>>>13,e=Gse(e,t),e=Gse(e,n),e^=n>>>12,t=Gse(t,n),t=Gse(t,e),t^=e<<16,n=Gse(n,e),n=Gse(n,t),n^=t>>>5,e=Gse(e,t),e=Gse(e,n),e^=n>>>3,t=Gse(t,n),t=Gse(t,e),t^=e<<10,n=Gse(n,e),n=Gse(n,t),[e,t,n^=t>>>15]}var $se=(()=>(($se=$se||{})[$se.Little=0]="Little",$se[$se.Big=1]="Big",$se))();function zse(e,t){return Hse(e,t)[1]}function Hse(e,t){const n=(65535&e)+(65535&t),r=(e>>>16)+(t>>>16)+(n>>>16);return[r>>>16,r<<16|65535&n]}function Gse(e,t){const n=(65535&e)-(65535&t);return(e>>16)-(t>>16)+(n>>16)<<16|65535&n}function Wse(e,t){return t>=e.length?0:e[t]}function qse(e,t,n){let r=0;if(n===$se.Big)for(let i=0;i<4;i++)r+=Wse(e,t+i)<<24-8*i;else for(let i=0;i<4;i++)r+=Wse(e,t+i)<<8*i;return r}const jse=new Fse(256);function Zse(e,t,n,r,i=[]){const s={},o={},a=function(e,t){const{text:n,block:r}=Yse(e,t);if(void 0===r)return{text:n};{const[e,...t]=r.split("\u241f"),[i,s]=e.split("@@",2);let[o,a]=i.split("|",2);return void 0===a&&(a=o,o=void 0),""===a&&(a=void 0),{text:n,meaning:o,description:a,customId:s,legacyIds:t}}}(e[0],e.raw[0]),l=[a.text],c=[];let u=a.text;for(let p=1;p<e.length;p++){const{text:n,block:r=Kse(p)}=Yse(e[p],e.raw[p]);u+=`{$${r}}${n}`,void 0!==t&&(s[r]=t[p-1],o[r]=i[p-1]),c.push(r),l.push(n)}const h=a.customId||function(e,t=""){let n=Use(e);if(t){const e=Use(t);n=function(e,t){const n=e[0],r=t[0],i=Hse(e[1],t[1]),s=i[0],o=i[1];return[zse(zse(n,r),s),o]}(function(e,t){const n=e[0],r=e[1];return[n<<1|r>>>31,r<<1|n>>>31]}(n),e)}return function(e,t){const n=jse.toThePowerOf(0).multiplyBy(t);return jse.toThePowerOf(4).multiplyByAndAddTo(e,n),n.toString()}(2147483647&n[0],n[1])}(u,a.meaning||""),d=a.legacyIds?a.legacyIds.filter(e=>e!==h):[];return{id:h,legacyIds:d,substitutions:s,substitutionLocations:o,text:u,customId:a.customId,meaning:a.meaning||"",description:a.description||"",messageParts:l,messagePartLocations:r,placeholderNames:c,location:n}}function Yse(e,t){if(":"!==t.charAt(0))return{text:e};{const n=function(e,t){for(let n=1,r=1;n<e.length;n++,r++)if("\\"===t[r])r++;else if(":"===e[n])return n;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(e,t);return{block:e.substring(1,n),text:e.substring(n+1)}}}function Kse(e){return 1===e?"PH":"PH_"+(e-1)}Object.keys({useClass:null}),Object.keys({useFactory:null}),Object.keys({useValue:null}),Object.keys({useExisting:null});class Qse extends Error{constructor(e){super(`No translation found for ${Jse(e)}.`),this.parsedMessage=e,this.type="MissingTranslationError"}}function Xse(e,t){return Object.defineProperty(e,"raw",{value:t}),e}function Jse(e){const t=e.meaning&&` - "${e.meaning}"`,n=e.legacyIds&&e.legacyIds.length>0?` [${e.legacyIds.map(e=>`"${e}"`).join(", ")}]`:"";return`"${e.id}"${n} ("${e.text}"${t})`}function eoe(e,t){try{return function(e,t,n){const r=Zse(t,n);let i=e[r.id];if(void 0!==r.legacyIds)for(let s=0;s<r.legacyIds.length&&void 0===i;s++)i=e[r.legacyIds[s]];if(void 0===i)throw new Qse(r);return[i.messageParts,i.placeholderNames.map(e=>{if(r.substitutions.hasOwnProperty(e))return r.substitutions[e];throw new Error(`There is a placeholder name mismatch with the translation provided for the message ${Jse(r)}.\nThe translation contains a placeholder with name ${e}, which does not exist in the message.`)})]}($localize.TRANSLATIONS,e,t)}catch(n){return console.warn(n.message),[e,t]}}function toe(){use.production&&function(){if(Ah)throw new Error("Cannot enable prod mode after platform setup.");kh=!1}(),$p().bootstrapModule(xse).catch(e=>console.error(e))}const noe=QK.getLocale();"en"!==noe?fetch(use.root+"assets/"+noe+".json").then(e=>e.ok?e.json():{locale:"en",translations:{}}).then(e=>{(function(e){$localize.translate||($localize.translate=eoe),$localize.TRANSLATIONS||($localize.TRANSLATIONS={}),Object.keys(e).forEach(t=>{$localize.TRANSLATIONS[t]=function(e){const t=e.split(/{\$([^}]*)}/),n=[t[0]],r=[];for(let s=1;s<t.length-1;s+=2)r.push(t[s]),n.push(`${t[s+1]}`);const i=n.map(e=>":"===e.charAt(0)?"\\"+e:e);return{text:e,messageParts:Xse(n,i),placeholderNames:r}}(e[t])})})(e.translations),$localize.locale=e.locale,toe()}).catch(function(e){console.log(e)}):toe()}},function(e){e(e.s=6711)}]);